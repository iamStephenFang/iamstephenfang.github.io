{"meta":{"version":1,"warehouse":"4.0.0"},"models":{"Asset":[{"_id":"themes/next/source/css/noscript.styl","path":"css/noscript.styl","modified":1,"renderable":1},{"_id":"themes/next/source/css/main.styl","path":"css/main.styl","modified":1,"renderable":1},{"_id":"themes/next/source/images/alipay.png","path":"images/alipay.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/apple-touch-icon.png","path":"images/apple-touch-icon.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/avatar.gif","path":"images/avatar.gif","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-16x16.png","path":"images/favicon-16x16.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon-32x32.png","path":"images/favicon-32x32.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/favicon.png","path":"images/favicon.png","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","path":"images/logo-algolia-nebula-blue-full.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/logo.svg","path":"images/logo.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/quote-r.svg","path":"images/quote-r.svg","modified":1,"renderable":1},{"_id":"themes/next/source/images/wechat_account.jpg","path":"images/wechat_account.jpg","modified":1,"renderable":1},{"_id":"themes/next/source/images/wechatpay.png","path":"images/wechatpay.png","modified":1,"renderable":1},{"_id":"themes/next/source/js/bookmark.js","path":"js/bookmark.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/comments-buttons.js","path":"js/comments-buttons.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/config.js","path":"js/config.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/comments.js","path":"js/comments.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/motion.js","path":"js/motion.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/next-boot.js","path":"js/next-boot.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/pjax.js","path":"js/pjax.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schedule.js","path":"js/schedule.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/utils.js","path":"js/utils.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/schemes/muse.js","path":"js/schemes/muse.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/nprogress.js","path":"js/third-party/nprogress.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/quicklink.js","path":"js/third-party/quicklink.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/rating.js","path":"js/third-party/rating.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","path":"js/third-party/analytics/baidu-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","path":"js/third-party/analytics/google-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","path":"js/third-party/analytics/growingio.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/chatra.js","path":"js/third-party/chat/chatra.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/gitter.js","path":"js/third-party/chat/gitter.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/chat/tidio.js","path":"js/third-party/chat/tidio.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqus.js","path":"js/third-party/comments/disqus.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/changyan.js","path":"js/third-party/comments/changyan.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","path":"js/third-party/comments/disqusjs.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","path":"js/third-party/comments/gitalk.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/isso.js","path":"js/third-party/comments/isso.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/livere.js","path":"js/third-party/comments/livere.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/comments/utterances.js","path":"js/third-party/comments/utterances.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/math/katex.js","path":"js/third-party/math/katex.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/math/mathjax.js","path":"js/third-party/math/mathjax.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","path":"js/third-party/search/algolia-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/search/local-search.js","path":"js/third-party/search/local-search.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","path":"js/third-party/statistics/firestore.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","path":"js/third-party/statistics/lean-analytics.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","path":"js/third-party/tags/mermaid.js","modified":1,"renderable":1},{"_id":"themes/next/source/js/third-party/tags/pdf.js","path":"js/third-party/tags/pdf.js","modified":1,"renderable":1}],"Cache":[{"_id":"source/.DS_Store","hash":"3ab551b4d73d86dc69de99e1c103e2e1667fd9e3","modified":1653666129087},{"_id":"source/archives/index.md","hash":"2878109bfaf58743c1fe75792f8cbaa974346d29","modified":1586014560247},{"_id":"source/_posts/.DS_Store","hash":"3e0b234400c6fbb2132af1dff20cb4becb02cf19","modified":1645291311917},{"_id":"source/_posts/202206ReadingList.md","hash":"f9ec71e0a9365e7c0affc0ae4e99bd81230e1916","modified":1658681599928},{"_id":"source/_posts/Apple Watch.md","hash":"f8c7e19aa22cb3fa3fe36274ac77e7b3b3c281f6","modified":1658675914454},{"_id":"source/_posts/202205ReadingList.md","hash":"de734635f369c3dbe4990c830be81d3eff622676","modified":1658681271194},{"_id":"source/_posts/Action_Experiment.md","hash":"f73759d6dfb39ce35ee50e4feace16e8b79a768b","modified":1658675906357},{"_id":"source/_posts/202207ReadingList.md","hash":"ddfb35fc9d598ced270bd939556abcc818825847","modified":1660064713530},{"_id":"source/_posts/Design+Code_Vue.js_Learning.md","hash":"362ed5e3be22c455c8da25b23619f8f895993c6a","modified":1658675932936},{"_id":"source/_posts/Design_Thoughts.md","hash":"76e3dec53ae361641d4acb107e03e270e8a7ccbd","modified":1658675924351},{"_id":"source/_posts/Haze-Free.md","hash":"e26ed1108d1f7339ce580d49a40bfa68cf7d3541","modified":1658675984478},{"_id":"source/_posts/Digital_Life.md","hash":"af7d6485c1dcf9d24c9a0472ff37c5b1aa1097cd","modified":1658675946646},{"_id":"source/_posts/Hibernate_Basic.md","hash":"07f87679f0e17c9216c5257b5f2a2357ebac1869","modified":1658675999306},{"_id":"source/_posts/EffectiveObjcTips.md","hash":"4c8cd2f1ee9df988bdd95123a3a1552705dd9400","modified":1658675963329},{"_id":"source/_posts/Mediator_Pattern.md","hash":"31cc86ef60527c11a74609b7652f9b28ad90bcb3","modified":1658676003844},{"_id":"source/_posts/Muzik_GettingStarted.md","hash":"b519503e21e84f67a62cfa0edbbee3f406621f09","modified":1658676012059},{"_id":"source/_posts/Objc_Learning_1.md","hash":"c15cfd15e5ead7c9d26e303304ab4c7a87245e1c","modified":1658676027677},{"_id":"source/_posts/Muzik_Progress.md","hash":"a3f3e18aa80242dc6f0faeb800363c0a26efb6c6","modified":1658676023603},{"_id":"source/_posts/Objc_Learning_3.md","hash":"b36db100d07f85082116259ff1927426e5fc0976","modified":1658676038050},{"_id":"source/_posts/Objc_Learning_2.md","hash":"d64e7e87264658b35874a4cde941e9fbc05a44aa","modified":1658676031331},{"_id":"source/_posts/Objc_Learning_4.md","hash":"17de0a3d0f5d6b34f7c3c730deb23431c921dc55","modified":1658676041169},{"_id":"source/_posts/Objc_Learning_5.md","hash":"04b2f7fdd1f590d2e2ff41e486cf08178622ceff","modified":1658676046197},{"_id":"source/_posts/Objc_Learning_6.md","hash":"6907a6b99396c6e63dcdb4b0495205bf6ef646df","modified":1658676053942},{"_id":"source/_posts/Objc_Learning_8.md","hash":"e402cdfde51b26e20d29724b7278af8faeab401d","modified":1658676061572},{"_id":"source/_posts/Objc_Learning_7.md","hash":"d8eeab7546e050ff7e9a3216698611f135a09559","modified":1658676056341},{"_id":"source/_posts/OpenCV_Grayscale.md","hash":"97afb8156bd9ec2d4b051633a7afcfd194c8bc83","modified":1658676091003},{"_id":"source/_posts/OpenCV_Xcode.md","hash":"2420f0b81f3af3fb0c448147d6e332d1a5db6230","modified":1658676096534},{"_id":"source/_posts/Singleton_Pattern.md","hash":"49bf3eb09903649a9b0cc1cca274a7c5deeaf0a3","modified":1658676102188},{"_id":"source/_posts/OpenCV_Filter.md","hash":"071a8d4289b000830fc5396f51c9e328c5522c3e","modified":1658676067478},{"_id":"source/_posts/Struts_Workflow.md","hash":"34827e9efd584648e24924994178cb1b5fe389d1","modified":1658676110743},{"_id":"source/_posts/Struts_Experiment.md","hash":"0a2108974f41b23e2b19ef7751e468bbe30f90a4","modified":1658676106033},{"_id":"source/_posts/Photo_Library.md","hash":"b8e296f1702863c9a9abd2381415a9d05ec936ef","modified":1658675893051},{"_id":"source/_posts/SwiftUIExploration.md","hash":"1972da21eb8f6ed46dce2ade01232e8c6c366692","modified":1658678472019},{"_id":"source/_posts/WEKA_Association.md","hash":"b135202be1861f8c7838ce4ead32108462c28834","modified":1658676119649},{"_id":"source/categories/index.md","hash":"333e28f7d065f0890d58ff4ffe3d8bf20ad1b086","modified":1586014550727},{"_id":"source/about/index.md","hash":"266a15c9327a2c80b7764cde9b90b9e3b3284098","modified":1594545781853},{"_id":"source/_posts/Yunnan_Travelling.md","hash":"4ddc6fe85f67aa9e7dccf5cc0d857a9ef1b56c25","modified":1658675880328},{"_id":"source/about/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1581357937068},{"_id":"source/tags/index.md","hash":"668a385f1c160a7f2a68b28d80aeb736a9a96918","modified":1586014539795},{"_id":"source/_posts/WWDC22-UIKit.md","hash":"b40b1d28ef94f7e8c423b47fdd7470f37c0ee8a5","modified":1658678330272},{"_id":"themes/next/_vendors.yml","hash":"c352385539c77d3599017304a2e0186983ee254e","modified":1627568980825},{"_id":"themes/next/package.json","hash":"f5dc37928b4939245ffac0ca2d886058eb6252d0","modified":1627568980918},{"_id":"themes/next/LICENSE.md","hash":"68fc9a03d50fd4b5ea97092b05967d1819dea2c4","modified":1627568980822},{"_id":"themes/next/README.md","hash":"fab15a85d9d8d90ecd8879525b9b74fb1c197978","modified":1627568980823},{"_id":"themes/next/.DS_Store","hash":"9457f542cf2c3f2a50b9ecd64858fc6f50b0d0c4","modified":1627571732103},{"_id":"themes/next/docs/AGPL3.md","hash":"0d2b8c5fa8a614723be0767cc3bca39c49578036","modified":1627568980827},{"_id":"themes/next/docs/LICENSE.txt","hash":"f5b14f791b7cfa1d16da981d929152e088a5d1b8","modified":1627568980829},{"_id":"themes/next/_config.yml","hash":"305c6cd22130097673fadecac85de7eff5f23736","modified":1645328275807},{"_id":"themes/next/layout/_layout.njk","hash":"20e4160cd0deb4fa272cc3aed0f43520b3cf4a9c","modified":1627568980853},{"_id":"themes/next/layout/archive.njk","hash":"d759f4d2cf5ddc6875ea250113a00662c1caf6d1","modified":1627568980914},{"_id":"themes/next/layout/category.njk","hash":"0a590e87af50e57b15fc37695c9a3bf4a97c3d92","modified":1627568980914},{"_id":"themes/next/layout/index.njk","hash":"37ec3d1bcd20b8ac1d18e0d68f990450890b46cd","modified":1627568980915},{"_id":"themes/next/layout/post.njk","hash":"6abeb85fb3e4c382ed4bb6049b12a807e6226e67","modified":1627568980917},{"_id":"themes/next/layout/page.njk","hash":"9cd3eca2c468bb46c7c5bf391bea4b025af178f6","modified":1627568980916},{"_id":"themes/next/layout/tag.njk","hash":"6cd707f846bfd6becbcfb060c26958bb4015c31f","modified":1627568980918},{"_id":"themes/next/languages/README.md","hash":"b2567e32805dda79601157351a07e5ca9fe01315","modified":1627568980835},{"_id":"themes/next/languages/de.yml","hash":"4be7b8b76c81bf1853eb36d2e874b17546a0e792","modified":1627568980837},{"_id":"themes/next/languages/ar.yml","hash":"bca66db21c015dbd32970d8708b898518a773e1e","modified":1627568980836},{"_id":"themes/next/languages/fa.yml","hash":"6456d40dd42f44101d9d6e7054e9884e9163f948","modified":1627568980839},{"_id":"themes/next/languages/en.yml","hash":"814d81c27fed736055ee300e0a6505b26ff4313c","modified":1627568980838},{"_id":"themes/next/languages/fr.yml","hash":"b15dc05afdc94de02e5d3fee4f8d3dc5594dd37e","modified":1627568980840},{"_id":"themes/next/languages/id.yml","hash":"14e794db4eca36b257994d81eb513e61d1edcbd6","modified":1627568980841},{"_id":"themes/next/languages/es.yml","hash":"651e3b33d86a7cdb9fd7895ca28279f8b1a24faa","modified":1627568980838},{"_id":"themes/next/languages/ko.yml","hash":"6387357ac2dd498e8b8d630d27050a59180d7e8f","modified":1627568980843},{"_id":"themes/next/languages/it.yml","hash":"c1eeab4992c76bfd436bb205ce58b1cfeef55ee6","modified":1627568980841},{"_id":"themes/next/languages/pt.yml","hash":"63a3e1e728ba5e6e22150de7331bb8a654f34960","modified":1627568980845},{"_id":"themes/next/languages/ja.yml","hash":"d48c4157e0e02e847aac7b513580d3364c81948c","modified":1627568980842},{"_id":"themes/next/languages/pt-BR.yml","hash":"a1f27b3a592fc58f17d247f5563ff4a90a3da5f2","modified":1627568980845},{"_id":"themes/next/languages/nl.yml","hash":"ecb8e39c6225f3c068a5fdd569ee7dafd5c41a1f","modified":1627568980844},{"_id":"themes/next/languages/ru.yml","hash":"e9af1afe529ca747a04b801401d394b2ad696fde","modified":1627568980846},{"_id":"themes/next/languages/si.yml","hash":"2a9861db4547a524b2609c1e7e1061d2e9d48ee4","modified":1627568980847},{"_id":"themes/next/languages/tr.yml","hash":"55b38c7617c24bdc27c9de6cf39f4b191d154fb8","modified":1627568980848},{"_id":"themes/next/languages/vi.yml","hash":"c669c34da544a563ceae3e196addc9df6a78e024","modified":1627568980849},{"_id":"themes/next/languages/zh-HK.yml","hash":"f195bb0502ffe66e850077a1af1033455ea65f93","modified":1627568980851},{"_id":"themes/next/languages/uk.yml","hash":"7dd24580c0865c5a7bc4d391855045366a598936","modified":1627568980848},{"_id":"themes/next/languages/zh-TW.yml","hash":"92256b90028de9a1e79c6bc0e5885b93e7fb4b17","modified":1627568980851},{"_id":"themes/next/languages/zh-CN.yml","hash":"5a3ab21210304efef736e96bad254f789f42c567","modified":1627568980850},{"_id":"themes/next/docs/AUTHORS.md","hash":"a648823121563c34a177ae91f5a774b5e29f01a0","modified":1627568980828},{"_id":"themes/next/docs/ru/README.md","hash":"87edab5a3eb7577a409c01df3f1631de40f8956f","modified":1627568980831},{"_id":"themes/next/source/.DS_Store","hash":"c28e66efded42535a2976bdd9caf8c253b94b947","modified":1627571736804},{"_id":"themes/next/docs/zh-CN/CONTRIBUTING.md","hash":"8ee5ca39ac4a372a5c0f16e344bbe578af4aeae4","modified":1627568980833},{"_id":"themes/next/docs/zh-CN/CODE_OF_CONDUCT.md","hash":"7a06d443f374bd1e84294067a0ac796afd9fbe60","modified":1627568980832},{"_id":"themes/next/docs/zh-CN/README.md","hash":"02bafc6ee86263790603861e356596f0c916e392","modified":1627568980834},{"_id":"themes/next/layout/_macro/post.njk","hash":"b106599106285ecd4c0c1e0ed11c46a36b5a69d5","modified":1627568980855},{"_id":"themes/next/layout/_macro/post-collapse.njk","hash":"1a30d751871dabfa80940042ddb1f77d07d830b9","modified":1627568980854},{"_id":"themes/next/layout/_macro/sidebar.njk","hash":"ba06ad089d01b45b217249af338145881eab3e25","modified":1627568980856},{"_id":"themes/next/layout/_partials/footer.njk","hash":"19713f472972caac33ae5fbcfe9105da61257de4","modified":1627568980858},{"_id":"themes/next/layout/_partials/comments.njk","hash":"c12f8a7497596441503f2541d2f746f2ee7dd594","modified":1627568980857},{"_id":"themes/next/layout/_partials/languages.njk","hash":"e43f22198cccb5f6e306b1ce0d28d12a4fb891f8","modified":1627568980866},{"_id":"themes/next/layout/_partials/widgets.njk","hash":"852a750524decf1efa587cd52b09e387ed8315de","modified":1627568980882},{"_id":"themes/next/layout/_third-party/index.njk","hash":"13e7badc036e989307069f65b179deb107012435","modified":1627568980900},{"_id":"themes/next/layout/_scripts/index.njk","hash":"6668878a0f9a1166c6a879755f54a08d942da870","modified":1627568980884},{"_id":"themes/next/layout/_third-party/rating.njk","hash":"1bcdbc7fde26d6d9ef4e7fa43ffcff5a9506b20e","modified":1627568980905},{"_id":"themes/next/layout/_third-party/nprogress.njk","hash":"80fd1a45e91207fc16df1136e12b8b71b4f65dea","modified":1627568980904},{"_id":"themes/next/scripts/events/index.js","hash":"89091bc943cd8b8c63b8af3d26fb0a027048e9ba","modified":1627568980920},{"_id":"themes/next/scripts/filters/locals.js","hash":"0cd7da6755459d60779f0a7ccf311e26e184d55d","modified":1627568980935},{"_id":"themes/next/scripts/filters/default-injects.js","hash":"872f01cb10e422a648ea505436532e776e92926b","modified":1627568980934},{"_id":"themes/next/layout/_partials/pagination.njk","hash":"9876dbfc15713c7a47d4bcaa301f4757bd978269","modified":1627568980871},{"_id":"themes/next/scripts/filters/minify.js","hash":"99ab10d9aef1ee5ae5e8f3572ac0de25c3cc4416","modified":1627568980936},{"_id":"themes/next/scripts/helpers/engine.js","hash":"b9785bc737470e9b8e910e7da9e8c45c2ead58fa","modified":1627568980938},{"_id":"themes/next/layout/_scripts/vendors.njk","hash":"be80b9fe415a9a09d74c28e230995fd292dfc123","modified":1627568980885},{"_id":"themes/next/scripts/filters/post.js","hash":"42a9b81c5449afa9d67770604478168333c93804","modified":1627568980937},{"_id":"themes/next/scripts/helpers/next-url.js","hash":"a11b71ba0c5012e2cdcab31c15439156b215563e","modified":1627568980941},{"_id":"themes/next/layout/_third-party/quicklink.njk","hash":"0efed71ed530447718c4ea5bbd5fc8695b0b0d5f","modified":1627568980905},{"_id":"themes/next/scripts/helpers/font.js","hash":"3394185a7f0393c16ce52c8028f90da3e9239c55","modified":1627568980939},{"_id":"themes/next/scripts/helpers/next-vendors.js","hash":"afdd6a188a74c188f0dd154fac70efd4080ca262","modified":1627568980942},{"_id":"themes/next/scripts/helpers/next-config.js","hash":"454ed1fac07be972c7ec911092f0995cd925aab3","modified":1627568980940},{"_id":"themes/next/scripts/tags/button.js","hash":"c6ad2ed544fbb25ecb5d820c36e76302504271b7","modified":1627568980943},{"_id":"themes/next/scripts/tags/caniuse.js","hash":"935a311142a409c1896b3ae3f01fe7a9e2db1134","modified":1627568980944},{"_id":"themes/next/scripts/tags/center-quote.js","hash":"92c19d796bdb3320df9caea59bf52df7a95d9da9","modified":1627568980945},{"_id":"themes/next/scripts/tags/label.js","hash":"8a73348186113bae0a51ea2f891c1bb882fab05a","modified":1627568980947},{"_id":"themes/next/scripts/tags/group-pictures.js","hash":"79102d9e9bccff6224e77a77c4d2d363094ae3df","modified":1627568980946},{"_id":"themes/next/scripts/tags/index.js","hash":"17f9451ce1f10f78437f52218757d38d4e1591b0","modified":1627568980947},{"_id":"themes/next/scripts/tags/link-grid.js","hash":"18a483c2d5afd701f6080ffdddf2d1321370336c","modified":1627568980948},{"_id":"themes/next/scripts/tags/mermaid.js","hash":"4fb01ca650fa8b256b8d48f50dc1b18350bd3d6d","modified":1627568980949},{"_id":"themes/next/scripts/tags/note.js","hash":"7b94ddb46b7d4b0fe815f2fbe4bd375f07f55363","modified":1627568980950},{"_id":"themes/next/scripts/tags/pdf.js","hash":"344636b6fd7e27e8831c1e194039afc0d61931cd","modified":1627568980952},{"_id":"themes/next/scripts/tags/tabs.js","hash":"0eabe51da40b4b13e16419c8fe02452d9a4fef73","modified":1627568980953},{"_id":"themes/next/scripts/tags/video.js","hash":"2ee926448583be8f95af1f2884ae2c9c4830151d","modified":1627568980954},{"_id":"themes/next/source/css/_colors.styl","hash":"b37f9847d2f95632e911df670b51921a7d748068","modified":1627568980957},{"_id":"themes/next/source/css/noscript.styl","hash":"76bba5d7916e9930e68215a0fce3a7d81c44510f","modified":1627568981117},{"_id":"themes/next/source/css/main.styl","hash":"78ce791cc4ac95386cf6839ca72f5f7b51f86ee9","modified":1627568981116},{"_id":"themes/next/source/css/_mixins.styl","hash":"acef5acc728f24cb657be8d7010d836b4d556b0e","modified":1627568981073},{"_id":"themes/next/source/images/apple-touch-icon.png","hash":"87a5cb9ef565d1566ccf04e4596955f07f22fc2d","modified":1627571119612},{"_id":"themes/next/source/images/favicon-16x16.png","hash":"45cb5124a39b8882339664bb451896da23b9e45c","modified":1627571134726},{"_id":"themes/next/source/images/favicon-32x32.png","hash":"c0a61653ba05b4bb269a6f3ee89e9895f2aeb9b8","modified":1627571134827},{"_id":"themes/next/source/images/avatar.gif","hash":"2dbc3e2f2d624b2ca1afe6edc2ca17307f1950c8","modified":1627568981120},{"_id":"themes/next/source/images/logo-algolia-nebula-blue-full.svg","hash":"b85e274207b1392782476a0430feac98db1e7da0","modified":1627571167798},{"_id":"themes/next/source/images/logo.svg","hash":"2cb74fd3ea2635e015eabc58a8d488aed6cf6417","modified":1627568981124},{"_id":"themes/next/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1627571146697},{"_id":"themes/next/source/js/bookmark.js","hash":"0f563ffbf05fad30e854e413ab17ff7164ab5a53","modified":1627568981126},{"_id":"themes/next/source/js/comments-buttons.js","hash":"1a7344440321713426a0b2ab17e276b5bdf85ade","modified":1627568981127},{"_id":"themes/next/source/js/config.js","hash":"4c4ebbe3b3f3841a26f9d5af6d0ba8bc6da01c54","modified":1627568981129},{"_id":"themes/next/source/js/next-boot.js","hash":"2ecaa30ec42d28ef769d875cf2d26959b8de7d24","modified":1627568981132},{"_id":"themes/next/source/js/comments.js","hash":"66ae2e26ea36a41b72c638ea8b220296638ae952","modified":1627568981128},{"_id":"themes/next/source/js/motion.js","hash":"6d4bd07a6f8e1b4083119dca0acb5b289533b619","modified":1627568981131},{"_id":"themes/next/source/js/pjax.js","hash":"5bfc1cea214bd31847adc356f37df8e0b6a449df","modified":1627568981134},{"_id":"themes/next/source/js/schedule.js","hash":"71d62fc3584c47ff2d4cc945226e412264399be9","modified":1627568981135},{"_id":"themes/next/layout/_partials/head/head-unique.njk","hash":"49aa8de07918a11399131dfd703418af3f0a1a19","modified":1627568980860},{"_id":"themes/next/layout/_partials/header/index.njk","hash":"53895b3af95667edc5bf5d7356f8a2b4fe091447","modified":1627568980863},{"_id":"themes/next/source/js/utils.js","hash":"2ffeac130c5309bc83b1e9b764dd23688c0cd7db","modified":1627568981165},{"_id":"themes/next/layout/_partials/header/brand.njk","hash":"ffb6c69a9c90793cbe9bf0544b55f7a41c016d8f","modified":1627568980862},{"_id":"themes/next/layout/_partials/head/head.njk","hash":"1084e38df2f05a2f58df7f987e660775e9be1bf2","modified":1627568980861},{"_id":"themes/next/layout/_partials/header/menu.njk","hash":"c9390824b57f23b7c8a5c23a9834514123673766","modified":1627568980864},{"_id":"themes/next/layout/_partials/header/sub-menu.njk","hash":"75a158a5b54a3a76ee6590f5e0e2dd4a9f0be869","modified":1627568980865},{"_id":"themes/next/layout/_partials/page/breadcrumb.njk","hash":"edb3bb6d644b7407673c5ef3a426a244e98fcf89","modified":1627568980867},{"_id":"themes/next/layout/_partials/header/menu-item.njk","hash":"b46f412c0b4f775fd329d50357f722f5d7c1a3ba","modified":1627568980864},{"_id":"themes/next/layout/_partials/page/categories.njk","hash":"17156d99941f28a225951ffdcfa9a115e20dc2d2","modified":1627568980868},{"_id":"themes/next/layout/_partials/page/tags.njk","hash":"a18d1598e36cc72f2b0b24c3cc3c5990dfaa3254","modified":1627568980871},{"_id":"themes/next/layout/_partials/page/schedule.njk","hash":"ca2ccf3cf1874c45712f192ad45dea96fbd9920d","modified":1627568980870},{"_id":"themes/next/layout/_partials/page/page-header.njk","hash":"7ed4f102a1825195cff8d7995bf9219f323a9034","modified":1627568980869},{"_id":"themes/next/layout/_partials/post/post-followme.njk","hash":"154df0bb323c332d8c25343f258ee865e5553423","modified":1627568980874},{"_id":"themes/next/layout/_partials/post/post-footer.njk","hash":"8f14f3f8a1b2998d5114cc56b680fb5c419a6b07","modified":1627568980874},{"_id":"themes/next/layout/_partials/post/post-copyright.njk","hash":"133942922e34abae9e4de7ea5591d77c0caa4b37","modified":1627568980873},{"_id":"themes/next/layout/_partials/post/post-related.njk","hash":"7384e6390067ef2a84e7310d6adb3f6104ed62e2","modified":1627568980876},{"_id":"themes/next/layout/_partials/search/algolia-search.njk","hash":"efb2b6f19df02ba5ae623a1f274fff52aed21e6f","modified":1627568980878},{"_id":"themes/next/layout/_partials/post/post-meta.njk","hash":"cc1a11190b1a55ae8d4252d296803bc19db90bc5","modified":1627568980875},{"_id":"themes/next/layout/_partials/post/post-reward.njk","hash":"002b51d0cae3f2e2e008bdc58be90c728282de5b","modified":1627568980877},{"_id":"themes/next/layout/_partials/search/localsearch.njk","hash":"661f7acae43f0be694266323320f977d84119abe","modified":1627568980880},{"_id":"themes/next/layout/_partials/search/index.njk","hash":"8f6f256ab3b351ffc80f1f3f1d9834e9a7cfac31","modified":1627568980879},{"_id":"themes/next/layout/_partials/sidebar/site-overview.njk","hash":"5994278b3900828fd02d418f99f6c3b4e88e27a9","modified":1627568980882},{"_id":"themes/next/layout/_third-party/analytics/cloudflare.njk","hash":"c978e9efd472c4825f93b83524b11f1c4f7efaab","modified":1627568980888},{"_id":"themes/next/layout/_third-party/analytics/growingio.njk","hash":"8afaa772c390bd9d53a5cff9645ac3168334eb98","modified":1627568980890},{"_id":"themes/next/layout/_third-party/analytics/baidu-analytics.njk","hash":"6215309aee028dcb734452beec448c5afb6c63fc","modified":1627568980887},{"_id":"themes/next/layout/_third-party/analytics/index.njk","hash":"2d36a481a70d5f450f1f166dc556ac1218b18537","modified":1627568980890},{"_id":"themes/next/layout/_third-party/analytics/google-analytics.njk","hash":"d89066ff53879693f023e540d59c86137172c529","modified":1627568980889},{"_id":"themes/next/layout/_third-party/chat/gitter.njk","hash":"f8cc14b7aa949999a1faaeb7855e2f20b59a386d","modified":1627568980892},{"_id":"themes/next/layout/_third-party/chat/chatra.njk","hash":"d7263fca16d0278ccf1f6aa1c6df6902a6344a09","modified":1627568980892},{"_id":"themes/next/layout/_third-party/chat/tidio.njk","hash":"02aab857c27fc103216029be991688b12a73a525","modified":1627568980893},{"_id":"themes/next/layout/_third-party/comments/disqusjs.njk","hash":"0749cb6902baecdfd01f779a2a2513f6d2f6a823","modified":1627568980896},{"_id":"themes/next/layout/_third-party/comments/gitalk.njk","hash":"b63b7e2ede0d3e66e732fa1a06bda9b19e1e85d4","modified":1627568980897},{"_id":"themes/next/layout/_third-party/comments/disqus.njk","hash":"9375b19a89b7fa9474e558d085af5448d4c5c50c","modified":1627568980896},{"_id":"themes/next/layout/_third-party/comments/livere.njk","hash":"3b13b09fba84ec6000886890a6710736a2b8fafe","modified":1627568980899},{"_id":"themes/next/layout/_third-party/comments/isso.njk","hash":"64cc3bdaf644fd32c0d0a247f29f5b6904da9af3","modified":1627568980898},{"_id":"themes/next/layout/_third-party/comments/utterances.njk","hash":"5a94032bc3512a10ad4328fc19ec07b819a1d687","modified":1627568980899},{"_id":"themes/next/layout/_third-party/math/index.njk","hash":"abf37fc55aa86702118e8fdf5bf2d389dd589aa0","modified":1627568980902},{"_id":"themes/next/layout/_third-party/math/katex.njk","hash":"d82c24136bbd3443b85f07f5579845833b594684","modified":1627568980903},{"_id":"themes/next/layout/_third-party/math/mathjax.njk","hash":"3677017fd4572b158311f5f5d870590ab25184e0","modified":1627568980903},{"_id":"themes/next/layout/_third-party/statistics/firestore.njk","hash":"d32ebe94560fa95824478ebbff531bffc47b194d","modified":1627568980910},{"_id":"themes/next/layout/_third-party/statistics/busuanzi-counter.njk","hash":"a4bc501da0f22f7e420f0ca47e83988ce90b1368","modified":1627568980909},{"_id":"themes/next/layout/_third-party/statistics/index.njk","hash":"568ddf7955d11d93fb5e842b403a7ac8b1b7fdb1","modified":1627568980910},{"_id":"themes/next/layout/_third-party/statistics/lean-analytics.njk","hash":"2446e748cdc102c78492216319ac02148db7daf6","modified":1627568980911},{"_id":"themes/next/layout/_third-party/comments/changyan.njk","hash":"d1c950f8fbdf85e7a3eae5463767a89e858e8220","modified":1627568980895},{"_id":"themes/next/layout/_third-party/search/algolia-search.njk","hash":"24ed76e0c72a25ac152820c750a05826a706b6f4","modified":1627568980907},{"_id":"themes/next/layout/_third-party/tags/mermaid.njk","hash":"099e031f52fb8e47b3af5b2684737efc9e643ee7","modified":1627568980912},{"_id":"themes/next/scripts/events/lib/config.js","hash":"92ab6bb3c3122980699f0613dac27a7cabfedecc","modified":1627568980922},{"_id":"themes/next/layout/_third-party/search/localsearch.njk","hash":"3fc91aba5b17a5ae60b8e04707a7da87db4d0340","modified":1627568980907},{"_id":"themes/next/scripts/events/lib/highlight.js","hash":"6aec7b2c38c50989a23bfaa0d560e75c7f553e12","modified":1627568980923},{"_id":"themes/next/scripts/events/lib/utils.js","hash":"b281be775b693f9bf32766c8f6ef703c72ac9b00","modified":1627568980924},{"_id":"themes/next/scripts/events/lib/vendors.js","hash":"13b3301aa9b613975630502d93e6ae82c5293aa8","modified":1627568980925},{"_id":"themes/next/scripts/events/lib/injects.js","hash":"d987709267a1bc6e5014411e9983d7c49c102c16","modified":1627568980923},{"_id":"themes/next/scripts/filters/comment/changyan.js","hash":"aa05e6b3d613a756178b8ba06832ad27499d4c14","modified":1627568980927},{"_id":"themes/next/scripts/filters/comment/common.js","hash":"2486f3e0150c753e5f3af1a3665d074704b8ee2c","modified":1627568980928},{"_id":"themes/next/scripts/filters/comment/default-config.js","hash":"93ee5f9109dad885dc38c49bcee630c10f9dce6e","modified":1627568980929},{"_id":"themes/next/layout/_third-party/tags/pdf.njk","hash":"2c81984cc4f5123103460442f6e046f5b6c97127","modified":1627568980913},{"_id":"themes/next/scripts/filters/comment/disqus.js","hash":"7f71d6b271ba65ff333d5682e7575711d368c0d2","modified":1627568980930},{"_id":"themes/next/scripts/filters/comment/disqusjs.js","hash":"135b87d151055eefdbc711d9e704b112b3214a84","modified":1627568980930},{"_id":"themes/next/scripts/filters/comment/gitalk.js","hash":"7bb7dafdd7f6bca8464b54e17e552ce7f1714195","modified":1627568980931},{"_id":"themes/next/scripts/filters/comment/livere.js","hash":"5a07d8bb52bc1d51a624ca8db54be144566c306b","modified":1627568980933},{"_id":"themes/next/scripts/filters/comment/isso.js","hash":"ff8b5b5145220a17d0ecd9508ba9bd2d3b2da47d","modified":1627568980932},{"_id":"themes/next/scripts/filters/comment/utterances.js","hash":"d3bded697bc32dace689d2a6dfb6eb7514169d15","modified":1627568980934},{"_id":"themes/next/source/css/_variables/Gemini.styl","hash":"96e0a7c2a65ce68215e17e369085b2ea2f1334f2","modified":1627568981111},{"_id":"themes/next/source/css/_variables/Muse.styl","hash":"e3be898f5ebcf435a26542653a9297ff2c71aeb0","modified":1627568981113},{"_id":"themes/next/source/css/_variables/Mist.styl","hash":"e1fbf169b9b6a194b518240cbd06ec3c48b83d61","modified":1627568981112},{"_id":"themes/next/source/css/_variables/Pisces.styl","hash":"c65536a128b9bc9dbe2fbb1b235a3cded2891002","modified":1627568981114},{"_id":"themes/next/source/js/third-party/nprogress.js","hash":"7d56b18a2bdece5468470c70c5f3eb79d4120964","modified":1627568981155},{"_id":"themes/next/source/js/schemes/muse.js","hash":"62f4638674c92dfb72454fee38751d0227d3d225","modified":1627568981137},{"_id":"themes/next/source/css/_variables/base.styl","hash":"32a1b73944561655087d80f025208a84e012b3cf","modified":1627568981115},{"_id":"themes/next/source/css/_common/components/back-to-top.styl","hash":"ece860218125bdb2578f373ed4f5040c9670e4b1","modified":1627568980959},{"_id":"themes/next/source/js/third-party/quicklink.js","hash":"6f58cd7aa8f6f1ab92d5a96551add293f4e55312","modified":1627568981156},{"_id":"themes/next/source/css/_common/components/index.styl","hash":"3c7ae405dd30b9b46494a6b9a6cb1b7ec6138ba9","modified":1627568980960},{"_id":"themes/next/source/js/third-party/rating.js","hash":"4e92c2d107ba47b47826829f9668030d5ea9bfb8","modified":1627568981156},{"_id":"themes/next/source/css/_common/components/back-to-top-sidebar.styl","hash":"d4809783ded05625675b1b4bbd9e99d7f5f7d7f9","modified":1627568980959},{"_id":"themes/next/source/css/_common/scaffolding/base.styl","hash":"8d7ad58c9086161b05843aa7e44973148be33611","modified":1627568981033},{"_id":"themes/next/source/css/_common/outline/mobile.styl","hash":"9f88d350df8115d26c6adbc2025a27ef9a42d7ff","modified":1627568981016},{"_id":"themes/next/source/css/_common/outline/index.styl","hash":"0c9f72ad98807521cbdcee7b5bbe2e884311db39","modified":1627568981013},{"_id":"themes/next/source/css/_common/scaffolding/buttons.styl","hash":"a042571d85ff7265f799004239a45f36b716b8a6","modified":1627568981036},{"_id":"themes/next/source/css/_common/scaffolding/comments.styl","hash":"e4fecc889ba3317a64e9abba5842c79dff9b7827","modified":1627568981038},{"_id":"themes/next/source/css/_common/scaffolding/index.styl","hash":"523fb7b653b87ae37fc91fc8813e4ffad87b0d7e","modified":1627568981046},{"_id":"themes/next/source/css/_common/scaffolding/pagination.styl","hash":"41cba8c4c5637a6b8f1b62e67673b33676f5d734","modified":1627568981052},{"_id":"themes/next/source/css/_common/components/reading-progress.styl","hash":"2a29bf3692f42f84e8f29314e0fb349f86fc727a","modified":1627568980976},{"_id":"themes/next/source/css/_common/scaffolding/normalize.styl","hash":"b56367ea676ea8e8783ea89cd4ab150c7da7a060","modified":1627568981049},{"_id":"themes/next/source/css/_common/scaffolding/toggles.styl","hash":"572a41499391677d84b16d8dbd6a996a3d5ce041","modified":1627568981072},{"_id":"themes/next/source/css/_common/scaffolding/tables.styl","hash":"e840b23d33023e6d45e018f6e84b683dd56efd8d","modified":1627568981053},{"_id":"themes/next/source/css/_schemes/Gemini/index.styl","hash":"fd49b521d67eaccc629f77b4e095cb7310327565","modified":1627568981077},{"_id":"themes/next/source/css/_schemes/Mist/_layout.styl","hash":"5604ac1e161099a4d3e5657d53507268866dc717","modified":1627568981081},{"_id":"themes/next/source/css/_schemes/Mist/_header.styl","hash":"4817e77577896ab5c0da434549917ee703a3f4cf","modified":1627568981079},{"_id":"themes/next/source/css/_schemes/Mist/_menu.styl","hash":"357b899ac0f0dfbbbebf1ea972030c7cefa463ce","modified":1627568981083},{"_id":"themes/next/source/css/_schemes/Mist/_posts-expand.styl","hash":"b332868d76d9f1651efd65abfc0d3c9d699b1a45","modified":1627568981084},{"_id":"themes/next/source/css/_schemes/Mist/index.styl","hash":"ab16a3dcdc0393b9b582ef59dcc13db9320e917c","modified":1627568981086},{"_id":"themes/next/source/css/_schemes/Muse/_header.styl","hash":"06080fd963c904d96c00eff098a284e337953013","modified":1627568981089},{"_id":"themes/next/source/css/_schemes/Muse/_layout.styl","hash":"82a29572dd90451f75358a2ee2522b87304a0bb8","modified":1627568981091},{"_id":"themes/next/source/css/_schemes/Muse/_menu.styl","hash":"8a70d51d8f7cd113e5fbc9f0e70c46a072f282c8","modified":1627568981093},{"_id":"themes/next/source/css/_schemes/Pisces/_header.styl","hash":"be5c46b983df08b9dbac1b4749b1a101b54b6b50","modified":1627568981100},{"_id":"themes/next/source/css/_schemes/Muse/_sidebar.styl","hash":"944364893bd7160d954c10ba931af641c91515a4","modified":1627568981095},{"_id":"themes/next/source/css/_schemes/Muse/index.styl","hash":"6ad168288b213cec357e9b5a97674ff2ef3a910c","modified":1627568981097},{"_id":"themes/next/source/css/_schemes/Pisces/_menu.styl","hash":"72dc825c50357402c342d62ab60fc0c478ab6bc1","modified":1627568981102},{"_id":"themes/next/source/css/_schemes/Muse/_sub-menu.styl","hash":"c48ccd8d6651fe1a01faff8f01179456d39ba9b1","modified":1627568981096},{"_id":"themes/next/source/css/_schemes/Pisces/_layout.styl","hash":"6eee86c8f0175d6c09e434053516cd8556f78d44","modified":1627568981101},{"_id":"themes/next/source/css/_schemes/Pisces/_sidebar.styl","hash":"d9141e6e14a56b5952488101e9a8388c2170e270","modified":1627568981104},{"_id":"themes/next/source/css/_schemes/Pisces/_sub-menu.styl","hash":"778ed2ad5643b93970c95626b325defeb586733f","modified":1627568981107},{"_id":"themes/next/source/css/_schemes/Pisces/index.styl","hash":"8000075b227749a7495eaf417cac6ccfbe441580","modified":1627568981108},{"_id":"themes/next/source/js/third-party/analytics/baidu-analytics.js","hash":"f629acc46ff40c071ffd31b77d5c7616f0fdd778","modified":1627568981140},{"_id":"themes/next/source/js/third-party/analytics/google-analytics.js","hash":"59684383385059dc4f8a1ff85dbbeb703bcdbcb5","modified":1627568981141},{"_id":"themes/next/source/js/third-party/analytics/growingio.js","hash":"78dd3cf04082b7dbe6246e404b2aa8e726922402","modified":1627568981142},{"_id":"themes/next/source/js/third-party/chat/chatra.js","hash":"c32180522788c10e51df1803aa6842ef0432ddc9","modified":1627568981144},{"_id":"themes/next/source/js/third-party/chat/tidio.js","hash":"b0079f6a4601e06ca6fe46e83a2f5af553e9bc3c","modified":1627568981146},{"_id":"themes/next/source/js/third-party/chat/gitter.js","hash":"cc38c94125f90dadde11b5ebac7d8bf99a1a08a2","modified":1627568981145},{"_id":"themes/next/source/js/third-party/comments/disqus.js","hash":"e1cc671b0d524864fd445e3ab4ade9ee6d07e565","modified":1627568981148},{"_id":"themes/next/source/js/third-party/comments/changyan.js","hash":"8c8ebec444c727b704ea41ad88b0b96ed2e4b8d4","modified":1627568981147},{"_id":"themes/next/source/js/third-party/comments/disqusjs.js","hash":"b6c58f098473b526d6a3cd35655caf34b77f7cff","modified":1627568981149},{"_id":"themes/next/source/js/third-party/comments/gitalk.js","hash":"0ec038cf83e8ec067534f16a54041e47a3c1e59a","modified":1627568981149},{"_id":"themes/next/source/js/third-party/comments/isso.js","hash":"753a873b6f566aff5ba77ca23f91b78eb880ca64","modified":1627568981150},{"_id":"themes/next/source/js/third-party/comments/livere.js","hash":"2247d88c934c765c43013337860774aaa99f0b31","modified":1627568981151},{"_id":"themes/next/source/js/third-party/comments/utterances.js","hash":"f67f90eb03e284c82da2b8cf2f1e31801813c16d","modified":1627568981152},{"_id":"themes/next/source/js/third-party/math/mathjax.js","hash":"9771db8b6b2541181a0e463c4bf305276d47657d","modified":1627568981154},{"_id":"themes/next/source/js/third-party/search/algolia-search.js","hash":"ac401e3736d56a3c9cb85ab885744cce0b813c55","modified":1627568981159},{"_id":"themes/next/source/js/third-party/math/katex.js","hash":"83c54ee536e487a1031783443fe0cb63b1b4767e","modified":1627568981153},{"_id":"themes/next/source/js/third-party/search/local-search.js","hash":"b37f1b14aef2402d0c2d88f999ff0ce5ef6823c1","modified":1627568981159},{"_id":"themes/next/source/js/third-party/statistics/firestore.js","hash":"0960f16107ed61452fb0dffc6ed22dc143de34ef","modified":1627568981161},{"_id":"themes/next/source/js/third-party/statistics/lean-analytics.js","hash":"5a928990856b8e456f0663cf3b6b406733672e39","modified":1627568981162},{"_id":"themes/next/source/js/third-party/tags/mermaid.js","hash":"aafb764c64f6cd5a48ad194adf65ac77078242b1","modified":1627568981163},{"_id":"themes/next/source/js/third-party/tags/pdf.js","hash":"af78c22f0e61c8c8aa8794e585e0d632c6d4fcb8","modified":1627568981164},{"_id":"themes/next/source/css/_common/components/pages/categories.styl","hash":"b6e2eb1550a7845cb2adf86081a4ab6c7bde1e68","modified":1627568980963},{"_id":"themes/next/source/css/_common/components/pages/breadcrumb.styl","hash":"8afdc311c6b8db121758371f95cf1c5e77354f42","modified":1627568980962},{"_id":"themes/next/source/css/_common/components/pages/schedule.styl","hash":"6b816c2511242ee503fb5f34cd3e4dcdafc06b85","modified":1627568980965},{"_id":"themes/next/source/css/_common/components/pages/tag-cloud.styl","hash":"1a81d1a71fcf0699629ce6e72dfd0a15f3a2dd0a","modified":1627568980966},{"_id":"themes/next/source/css/_common/components/post/index.styl","hash":"b3fa752f72ca1413289b76c56fbd33a00e3d25d7","modified":1627568980967},{"_id":"themes/next/source/css/_common/components/pages/index.styl","hash":"7504dbc5c70262b048143b2c37d2b5aa2809afa2","modified":1627568980964},{"_id":"themes/next/source/css/_common/components/post/post-collapse.styl","hash":"ec37a36e94ba791663607a5022f763915778578f","modified":1627568980969},{"_id":"themes/next/source/css/_common/components/post/post-body.styl","hash":"5d61dedb3bec1021d52894f9b379e4d0953f6a35","modified":1627568980968},{"_id":"themes/next/source/css/_common/components/post/post-followme.styl","hash":"76d0dfb3a8b873a6180604ac6daecf38b6a963a2","modified":1627568980970},{"_id":"themes/next/source/css/_common/components/post/post-footer.styl","hash":"1d284f3ea03ba9b4feb76b375e539a8e0bccf1c3","modified":1627568980971},{"_id":"themes/next/source/css/_common/components/post/post-gallery.styl","hash":"aa366d37389760c8595529b850f461569577a1c5","modified":1627568980972},{"_id":"themes/next/source/css/_common/components/post/post-header.styl","hash":"2ca4dea5e7785c9b77566d95cabf896d20a42741","modified":1627568980972},{"_id":"themes/next/source/css/_common/components/post/post-nav.styl","hash":"9ac6f477177264c26a46e8333b8456720a0444dc","modified":1627568980973},{"_id":"themes/next/source/css/_common/components/post/post-reward.styl","hash":"07cff69f2d57e6321595f64c16d8b763dc88df6a","modified":1627568980974},{"_id":"themes/next/source/css/_common/components/post/post-widgets.styl","hash":"5b5649b9749e3fd8b63aef22ceeece0a6e1df605","modified":1627568980975},{"_id":"themes/next/source/css/_common/components/third-party/gitalk.styl","hash":"7102f8e819b62cf7d121fd063dc663fd068feaa6","modified":1627568980978},{"_id":"themes/next/source/css/_common/components/third-party/index.styl","hash":"b457756758f0632767e8a560e3033059cbe4a67b","modified":1627568980979},{"_id":"themes/next/source/css/_common/components/third-party/related-posts.styl","hash":"2c534d2b2dbc932ad65d335a720a7ba9612bac04","modified":1627568980981},{"_id":"themes/next/source/css/_common/components/third-party/math.styl","hash":"83c6588c51cd418336f4945813410a100ddfe2a4","modified":1627568980980},{"_id":"themes/next/source/css/_common/components/third-party/search.styl","hash":"2896840ab8ac8ab2a7f76d18df893f290ac31625","modified":1627568980982},{"_id":"themes/next/source/css/_common/components/third-party/utterances.styl","hash":"bf88d9c585d7b00463c46352402cfea415c29493","modified":1627568980983},{"_id":"themes/next/source/css/_common/outline/footer/index.styl","hash":"4f482514230c941c9475e1272188e53a54975463","modified":1627568980987},{"_id":"themes/next/source/css/_common/scaffolding/highlight/copy-code.styl","hash":"83ee4993710fc8daa1c8dbfccd5d5091fd244c30","modified":1627568981042},{"_id":"themes/next/source/css/_common/scaffolding/highlight/index.styl","hash":"08e79881d58d01afab6dbed37ab4f52356564d7e","modified":1627568981044},{"_id":"themes/next/source/css/_common/outline/header/bookmark.styl","hash":"d6d60f02b5e9f89dbfce180b3884030898022664","modified":1627568980989},{"_id":"themes/next/source/css/_common/outline/header/github-banner.styl","hash":"cf194bea1c9e67fde871a04de3bc81df72c54277","modified":1627568980991},{"_id":"themes/next/source/css/_common/outline/header/menu.styl","hash":"392fd53a8dd4e3f33a853ebb24290a622300e0ff","modified":1627568980995},{"_id":"themes/next/source/css/_common/outline/header/index.styl","hash":"f1778d2c56974b96dae429456d5c55be325c4946","modified":1627568980992},{"_id":"themes/next/source/css/_common/outline/header/site-meta.styl","hash":"9a47c9045e443b8d20932f9c564a3a05fa4c6b51","modified":1627568981006},{"_id":"themes/next/source/css/_common/outline/header/site-nav.styl","hash":"bf3ad8b4268f763a1e26377681644887694bc009","modified":1627568981009},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author-links.styl","hash":"52fc98b1435129eb3edb9293ced9e507741f1350","modified":1627568981019},{"_id":"themes/next/source/css/_common/outline/sidebar/index.styl","hash":"eae7b83f1c711ad2ab3a41d89f517445856ffec8","modified":1627568981018},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-author.styl","hash":"5b38ac4a0f1ade0e681aff0e3366c481d9cf3dcd","modified":1627568981020},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-blogroll.styl","hash":"9950c3188a28e1c63b5498b7bdcd14b12ace3e28","modified":1627568981021},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-button.styl","hash":"b926e368f702f8686aaa2eb98d3d2e533418958c","modified":1627568981022},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toc.styl","hash":"6394340c28a21f6aa90e786f3bfe24fb26595653","modified":1627568981026},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-toggle.styl","hash":"432e73bc4f99322af6af1852e0ea6e674919c31a","modified":1627568981027},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-nav.styl","hash":"f7ff85fe6c4efb8ff036fab2c3277b7d8bed69a8","modified":1627568981025},{"_id":"themes/next/source/css/_common/outline/sidebar/site-state.styl","hash":"69eb1c282a8fd5dbab606cc09c34c5dc8e44e753","modified":1627568981029},{"_id":"themes/next/source/css/_common/scaffolding/tags/group-pictures.styl","hash":"393ff96234e4196b569d4b11496774eb78e147de","modified":1627568981060},{"_id":"themes/next/source/css/_common/outline/sidebar/sidebar-dimmer.styl","hash":"fbdb63c6a8887d19b7137325ba7d6806f728139c","modified":1627568981023},{"_id":"themes/next/source/css/_common/scaffolding/tags/blockquote-center.styl","hash":"15a5e273a8137550c93c8d2a60f9fcf86e04a89e","modified":1627568981058},{"_id":"themes/next/source/css/_common/scaffolding/tags/index.styl","hash":"cef4e779473daa3761709958243c6b8a57bbd814","modified":1627568981062},{"_id":"themes/next/source/css/_common/scaffolding/tags/link-grid.styl","hash":"2421500e447822ef1b6826403a3e1df3345641d7","modified":1627568981065},{"_id":"themes/next/source/css/_common/scaffolding/tags/label.styl","hash":"debee14539272fbe3835a7d3853af2230baa3501","modified":1627568981064},{"_id":"themes/next/source/css/_common/scaffolding/tags/pdf.styl","hash":"b49c64f8e9a6ca1c45c0ba98febf1974fdd03616","modified":1627568981069},{"_id":"themes/next/source/css/_common/scaffolding/tags/mermaid.styl","hash":"3c029a003e9bf747e1b9cc7c0c127f6028374876","modified":1627568981067},{"_id":"themes/next/source/css/_common/scaffolding/tags/note.styl","hash":"f53e6c12bd4805888f696386d00668f23cd335e7","modified":1627568981068},{"_id":"themes/next/source/css/_common/scaffolding/tags/tabs.styl","hash":"50b00218e854200c4ec0573a841e226d49c45cba","modified":1627568981071},{"_id":"themes/next/source/images/wechat_account.jpg","hash":"371020e1948f149afa6e350e8e66b11609033b81","modified":1627571151182},{"_id":"themes/next/source/images/favicon.png","hash":"e9194790400e5c55019076a58646a7bbcc3b908d","modified":1627571134900},{"_id":"themes/next/source/images/wechatpay.png","hash":"b591343c131df405794a94f73b70799ecebbae63","modified":1627571151222},{"_id":"themes/next/source/images/alipay.png","hash":"d5e777ff09cb5d7fa3d6313c6b8f40a2556c0381","modified":1627571111260}],"Category":[{"name":"阅读","_id":"cl6mfpp1h0004o76fd0r34u05"},{"name":"技术","_id":"cl6mfpp1p000fo76fdl3d3jap"},{"name":"设计","_id":"cl6mfpp1r000lo76f396f164u"},{"name":"生活","_id":"cl6mfpp3a006wo76f072t7oaj"}],"Data":[],"Page":[{"title":"文章分类","date":"2020-02-07T13:56:26.000Z","type":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 文章分类\ndate: 2020-02-07 21:56:26\ntype: \"categories\"\ncomments: false\n---\n","updated":"2020-04-04T15:35:50.727Z","path":"categories/index.html","layout":"page","_id":"cl6mfpp1a0000o76f6kcu8mm3","content":"","site":{"data":{}},"excerpt":"","more":"","length":0},{"title":"关于本站","date":"2020-02-07T13:52:18.000Z","type":"about","comments":0,"_content":"[StephenFang](https://github.com/iamStephenFang) 使用 [Hexo](https://hexo.io/zh-cn/docs/)  搭建的 [GitHub Pages](https://pages.github.com/)，主要分享技术与设计方面的内容。\n\n如果您对我的博文感兴趣，可以通过以下几种方式与我保持联系。\n\n- GitHub: [iamStephenFang](https://github.com/iamstephenfang) \n- Dribbble: [stephenfang](https://dribbble.com/stephenfang)\n- Unsplash: [stephenfang](https://unsplash.com/@stephenfang)\n- E-Mail: [StephenFang](mailto:fangxuanmiao@gmail.com) \n  \n- Instagram: [iamStephenFang](https://instagram.com/iamstephenfang) \n- Weibo: [iamStephenFang](https://weibo.com/iamstephenfang) \n- Twitter: [Fangxuanmiao](https://twitter.com/fangxuanmiao) ","source":"about/index.md","raw":"---\ntitle: 关于本站\ndate: 2020-02-07 21:52:18\ntype: about\ncomments: false\n---\n[StephenFang](https://github.com/iamStephenFang) 使用 [Hexo](https://hexo.io/zh-cn/docs/)  搭建的 [GitHub Pages](https://pages.github.com/)，主要分享技术与设计方面的内容。\n\n如果您对我的博文感兴趣，可以通过以下几种方式与我保持联系。\n\n- GitHub: [iamStephenFang](https://github.com/iamstephenfang) \n- Dribbble: [stephenfang](https://dribbble.com/stephenfang)\n- Unsplash: [stephenfang](https://unsplash.com/@stephenfang)\n- E-Mail: [StephenFang](mailto:fangxuanmiao@gmail.com) \n  \n- Instagram: [iamStephenFang](https://instagram.com/iamstephenfang) \n- Weibo: [iamStephenFang](https://weibo.com/iamstephenfang) \n- Twitter: [Fangxuanmiao](https://twitter.com/fangxuanmiao) ","updated":"2020-07-12T09:23:01.853Z","path":"about/index.html","layout":"page","_id":"cl6mfpp1f0002o76fe2ebcfu4","content":"<p><a href=\"https://github.com/iamStephenFang\">StephenFang</a> 使用 <a href=\"https://hexo.io/zh-cn/docs/\">Hexo</a>  搭建的 <a href=\"https://pages.github.com/\">GitHub Pages</a>，主要分享技术与设计方面的内容。</p>\n<p>如果您对我的博文感兴趣，可以通过以下几种方式与我保持联系。</p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/iamstephenfang\">iamStephenFang</a> </li>\n<li>Dribbble: <a href=\"https://dribbble.com/stephenfang\">stephenfang</a></li>\n<li>Unsplash: <a href=\"https://unsplash.com/@stephenfang\">stephenfang</a></li>\n<li>E-Mail: <a href=\"mailto:fangxuanmiao@gmail.com\">StephenFang</a> </li>\n<li>Instagram: <a href=\"https://instagram.com/iamstephenfang\">iamStephenFang</a> </li>\n<li>Weibo: <a href=\"https://weibo.com/iamstephenfang\">iamStephenFang</a> </li>\n<li>Twitter: <a href=\"https://twitter.com/fangxuanmiao\">Fangxuanmiao</a> </li>\n</ul>\n","site":{"data":{}},"excerpt":"","more":"<p><a href=\"https://github.com/iamStephenFang\">StephenFang</a> 使用 <a href=\"https://hexo.io/zh-cn/docs/\">Hexo</a>  搭建的 <a href=\"https://pages.github.com/\">GitHub Pages</a>，主要分享技术与设计方面的内容。</p>\n<p>如果您对我的博文感兴趣，可以通过以下几种方式与我保持联系。</p>\n<ul>\n<li>GitHub: <a href=\"https://github.com/iamstephenfang\">iamStephenFang</a> </li>\n<li>Dribbble: <a href=\"https://dribbble.com/stephenfang\">stephenfang</a></li>\n<li>Unsplash: <a href=\"https://unsplash.com/@stephenfang\">stephenfang</a></li>\n<li>E-Mail: <a href=\"mailto:fangxuanmiao@gmail.com\">StephenFang</a> </li>\n<li>Instagram: <a href=\"https://instagram.com/iamstephenfang\">iamStephenFang</a> </li>\n<li>Weibo: <a href=\"https://weibo.com/iamstephenfang\">iamStephenFang</a> </li>\n<li>Twitter: <a href=\"https://twitter.com/fangxuanmiao\">Fangxuanmiao</a> </li>\n</ul>\n","length":219},{"title":"标签","date":"2020-02-07T13:26:23.000Z","type":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2020-02-07 21:26:23\ntype: \"tags\"\ncomments: false\n---\n","updated":"2020-04-04T15:35:39.795Z","path":"tags/index.html","layout":"page","_id":"cl6mfpp1j0006o76f0kv3hc1s","content":"","site":{"data":{}},"excerpt":"","more":"","length":0},{"title":"归档","date":"2020-02-07T13:55:29.000Z","type":"archive","comments":0,"_content":"","source":"archives/index.md","raw":"---\ntitle: 归档\ndate: 2020-02-07 21:55:29\ntype: \"archive\"\ncomments: false\n---\n","updated":"2020-04-04T15:36:00.247Z","path":"archives/index.html","layout":"page","_id":"cl6mfpp1k0008o76fc4zw2nzv","content":"","site":{"data":{}},"excerpt":"","more":"","length":0}],"Post":[{"title":"2022年六月读书摘录","date":"2022-07-15T05:10:12.000Z","copyright":true,"_content":"\n继上个月分享了一些读书摘录之后这个月也没闲着，一共读了五本书。\n- 《长安的荔枝》\n- 《失落的卫星》\n- 《午夜降临前抵达》\n- 《克拉拉与太阳》\n- 《工作、消费主义和新穷人》\n\n<!--more-->\n\n# 《长安的荔枝》\n\n[长安的荔枝](https://movie.douban.com/subject/35651341/)\n\n取材于“一骑红尘妃子笑，无人知是荔枝来”，马伯庸讲故事的能力确实令人惊叹，也很是期待同名的电影作品。\n\n## 第一章\n\n> **唯有早点跟妻子和离，一别两宽，将来事发才不会累及家人。李善德可以趁这最后四个月横行一下，多捞些油水，尽量把香积贷偿清，好歹能给孤女寡妇留下一处宅子。**\n> \n\n## 第二章\n\n> **一番铜臭交易之后，心中那点“昔我往矣”的淡淡离愁，也便没了踪影，倒省了很多苦情文章。**\n> \n\n> **听说百越民风彪悍，生翅者不食幞头，带腿者不食案几，余者无不可入口，果然没有夸张。**\n> \n\n## 第四章\n\n> **自己那二十多年的上林署监事，其实只窥到了朝廷的小小一角。这个坐落着诸多衙署的庞大皇城，比秦岭密林更加错综复杂，它运转的规律比道经更为玄妙。不熟悉的人贸然踏入，就像落入壶口瀑布下的奔腾乱流一样，撞得头破血流**\n> \n\n> **做官之道，其实就三句话：和光同尘，好处均沾，花花轿子众人齐抬。一个人吃独食，是吃不长久的。**\n\n\n# 《失落的卫星》\n\n看了刘子超的书才知道原来旅行文学这么有趣，并不是类似流水账之类的产物。\n从作者文字中窥见了很多人情世故，带着我的思绪去了遥远的中亚。\n\n[失落的卫星](https://book.douban.com/subject/35025453/)\n\n## 序幕 大巴扎、流放者和塔季扬娜\n\n> **哈萨克是俄国十月革命后才产生的概念。当时，苏联把西方的民族国家理论应用到中亚这片民族观念尚处于前现代状态的土地上。哈萨克斯坦，连同其他四个斯坦国一起，诞生于这样的背景下。**\n> \n\n> **1854年，陀思妥耶夫斯基被发配至哈萨克斯坦东部的塞米伊。他刚在西伯利亚的鄂木斯克服刑四年，因此即便是这样闭塞的边疆小镇，也令他欣喜。因为他终于可以摘掉镣铐，同时获准阅读《圣经》之外的书籍。**\n> \n\n> **中国的吉尔吉斯人叫作“柯尔克孜族”；李白据说生于碎叶城，就位于今天吉尔吉斯境内的托克马克。**\n> \n\n### 边城浮世绘\n\n> **“对我这代吉尔吉斯人来说，苏联就像史前时代，与我们无关。”阿拜说，“从父母那里，我听过不少苏联时代的故事，但却无法激起太多共鸣。”**\n> \n\n> **不过，我可以告诉你，不要抨击绿色和平，更不要抨击LGBT——这是我的女友说的。她说，阿拜，如果你想获得诺贝尔文学奖，那你就不要抨击绿色和平，更不要抨击LGBT。”\n“她确实聪明。”**\n> \n\n> **我始终觉得自己流淌着游牧民族的血液——不是草原游牧民族，而是当代游牧民族。这样的人总是不停移动，从世界的一个地方到另一个地方，缺乏归属感，家只不过是当下的落脚之处。对他们来说，旅行不是为了去任何地方，只是为了旅行。最重要的事情是移动。**\n> \n\n### 加加林疗养院\n\n> **所有人的餐食都是一样的——就像那些服务员脸上的表情——具有社会主义的一致性。**\n> \n\n### 杜尚别复调\n\n> **想借此赋予塔吉克人一点犹太民族在他们自己历史中找到的那种悲怆感。相比一个王朝的覆灭，文化根基的丧失更加悲惨。**\n> \n\n> **让人想到后来伊拉克人民推倒萨达姆的雕像。无事可做的男人们一脸仇恨，他们举着拳头，喊着口号，仿佛在进行一场游戏，只是没人相信这场游戏会有任何严重的后果。**\n> \n\n> **但我只是说，你还年轻，还没跨越那道“阴影线”——这是约瑟夫·康拉德说的，你感到烦闷、厌倦、不满、迷茫，这是生活中必将来临的那个时刻。**\n> \n\n### 从帕米尔公路到瓦罕山谷\n\n> **说这话时，司机的表情并没有任何不满，口气中甚至还带着几分理解。警察相信，凭他们的制服，索取是名正言顺的事。司机大概也这么认为。**\n> \n\n> **我想起一路上经过的那些分界线：同样的民族，同样的生活方式，被分割开来，像刀子割开的伤口。**\n> \n\n### 不安的山谷\n\n> **取消宗教、推行民族融合的苏联，宗教和族群的界限变得模糊不清，一种相对平静的关系维持了数十年。可是一旦这种体制濒临溃败，宗教势力和民族主义就会结合在一起，导致惨剧发生。**\n> \n\n> **在《本地人的今与昔》一书中，纳利夫金总结了两个民族之间不太融洽的历史关系：乌兹别克人是定居民族，而吉尔吉斯人是游牧民族。乌兹别克人瞧不起吉尔吉斯人，而又惧怕他们的武力。乌兹别克人大都是农民、工匠、商人，而吉尔吉斯人喜欢在山间放牧，住在传统毡房里。他们不时劫掠乌兹别克人的马匹，只有当他们需要买东西时，才会下到乌兹别克人居住的绿洲城镇。这时，乌兹别克人就会大肆嘲笑吉尔吉斯人的愚昧无知，然后狠狠地敲他们一笔。**\n> \n\n### 通向撒马尔罕的金色之路\n\n> **中国人的丝绸和瓷器传入这里，而粟特人则将制造玻璃和酿造葡萄酒的技艺传入中国。东西方的珠宝、首饰、钱币在这里荟聚，还有用骨头精心雕刻的下棋者。**\n> \n\n> **作为旅行者，我只是机械地从一个遗迹，移动到另一个遗迹，试图从每个遗迹中眺望到一点遥远时代的微暗火光。**\n> \n\n以后每去一个博物馆都可以说成是自己在眺望**遥远时代的微暗火光。**\n\n### 布哈拉的博弈与离散\n\n> **在这里，苏联纪念物是如此之多，而且便宜得惊人。谁又能想到它们曾是一代人的荣誉和骄傲？是那些人用生命加以守护的珍宝？**\n> \n\n### 困守咸海的人\n\n> **咸海王讲起他的治理之道。他时常对工人们说，来到这里，只有一个目的，那就是一门心思地挣钱。他禁止工人喝酒，但也知道，私下里人人都会喝。只要不闹出事来，就应该“睁一只眼闭一只眼”。他管这叫“中国人的智慧”。**\n> \n\n### 突厥斯坦的小人物\n\n> **随着阿拉伯人的征伐，造纸术由中亚传入西亚、北非和欧洲。**\n> \n\n> **我留意了一下画作的时间——1954年。前一年，斯大林刚刚去世，苏联进入“解冻”时期。已经在塔拉兹待了十三年的布雷默，想必也感受到一丝春意——你甚至能在他的画笔中看到一种有意克制的轻松。**\n> \n\n> **他早有准备，说不定在家排练过。那张消瘦的胡茬脸，配合抑扬顿挫的口气，外加耸动的眉骨，活脱脱地展现了一个乌兹别克人的“交易的艺术”，体现了哈萨克人心目中“萨特人”的狡黠。我一时间钦佩不已，于是没再还价，就点头同意了。**\n> \n\n作者笔下不少地区的中亚人都有这般特点，他们的这番特点也是经济水平和历史造成的。\n\n> **帖木儿是一个被高估的英雄人物。他没有为帝国创造出一个生生不息的文化，只是留下一些建筑，供人凭吊而已。一旦他的个人意志退潮，帝国也就随之烂尾。这些建筑——无论是对于宗教，还是人民——意义都非常有限。**\n> \n\n### 草原核爆\n\n> **“你们的祖国是哪里？”“你用什么语言思考，你的祖国就是哪里。”“我们说俄语，可我们生活在哈萨克斯坦。”“我们不属于俄国，不属于哈萨克斯坦，更不属于朝鲜或韩国。”“我们是什么人？”**\n> \n\n> **我沿着指引观看。每看完一部分，大妈就把那部分的照明关掉。虽说博物馆有政府补贴，也收门票，但看来还是资金紧张，不得不省钱度日。**\n> \n\n> **一旦国家的意志退潮，人们就会自然地用脚投票。科学家和军人带着家眷匆匆离开，短短数月内，查干人去楼空。**\n> \n\n### 七河之地\n\n> **在广大的中亚乡村地带，我都目睹了类似情况：相比他们苏联出身的父母，独立后的年轻一代反而更加传统、保守。**\n> \n\n## 尾声 扎尔肯特：进步前哨站\n\n> **苏俄治下的和平促进了中亚的繁荣，但也埋下分裂的种子。独立后，中亚开始对自己的历史和未来有了新的看法，不同的思潮与想法在这片土地上反复激荡。而今天，中国的崛起将会改变这里的引力，为中亚带来不同的前景。**\n> \n\n结尾的爱国情怀反倒是有些突然，不过经过那么多天奔波回到祖国确实会有这番情感。\n\n\n# 《午夜降临前抵达》\n\n读的刘子超的第二本作品，书籍中的一句话我很是喜欢。“旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。”\n\n[午夜降临前抵达](https://book.douban.com/subject/35522033/)\n\n### 第一章 疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\n\n> **不喜欢把每一段行程都安排得严丝合缝的旅行，没有即兴，没有随心所欲，没有突发奇想，旅行更像是一种苦行。**\n> \n\n### 第二章 火车情结，横穿波希米亚，死亡赋格\n\n> **伯格说：“年轻人，这世上还有哪个国家比波兰更习惯与忧伤这种情感妥协共处呢？”**\n> \n\n> **我感到一切战争、屠杀、罪行总会影响到之后的每一个人，无论哪一方，只是以各自不同的方式罢了。**\n> \n\n### 第三章 读艺术史的女孩，塔特拉山，猎人小屋\n\n> **除了酒吧和饭馆，其他公众场合禁止饮酒。一旦被警察发现，可能受到重罚。具体来说，惩戒的程度根据喝酒的多少而定。**\n> \n\n> **山在白天是一种壮美，到了夜晚却令人心悸。那种庞大而未知的存在，不分昼夜地永恒矗立，让我感到自己的渺小和脆弱。如果山愿意，它可以轻而易举地摧毁我，而我此刻还活着，不过依赖于它的垂怜。**\n> \n\n> **旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。**\n> \n\n### 第四章 卫星城，沃利肖像，昨日的世界\n\n> **因为放弃了发掘城市秘密的野心，反而获得了一种轻松自在的心理状态：无须再去看着地图，寻找那些著名景点；也无须为了找到当地人的秘密据点而犯愁；更不用因为自己对这座城市的无知而羞愧。**\n> \n\n> **在维也纳，这类具有历史意义的每一幢房屋的拆除，就像从我们身上夺取了一部分灵魂。**\n> \n\n> **对于这家百年咖啡馆来说，一部好莱坞电影的意义显然算不上重大，它根本不屑把任何电影海报张贴出来。一切都尽量维持着1880年的原貌——那是哈布斯堡王朝最辉煌的时代。**\n> \n\n### 第五章 中国“倒爷”，骑行者俱乐部，土耳其浴室\n\n> **风景缺少的只是赞美。\n——切斯瓦夫·米沃什，《风景》**\n> \n\n> **一个国家的年轻人如果都以拥有“公共层面”的身份为荣，那么这个国家无疑是充满希望的。**\n> \n\n> **我相信过去不曾终结，它仍然在另一个维度上运行。通过旧房子、旧书、旧照片，我们得以窥视那个维度里的吉光片羽。**\n> \n\n### 第六章 挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\n\n> **多次和日本人相遇以后，我总结出了在国外分辨他们的三种方法：一、他们把sorry念成soli；二、他们人手一本日本大宝石出版社的《走遍全球》；三、或者说是一种天赋亦可，他们总能在鸟不拉屎的地方，找到极为正宗的日本料理。**\n> \n\n> **正如米兰·昆德拉所说，生长于一个小国有时候是一种优势。因为身处小国，要么做一个可怜的、眼光狭窄的人，要么成为一个广闻博识的“世界性的人”。**\n> \n\n> **作为少数民族作家，他们不仅是在使用词语，他们是在运用整个存在，运用民族精神和神话，运用记忆、传统和文化来写作。对他们来说，语言就是命运——一个民族的命运。**\n> \n\n### 第一章 古树茶，故乡在塞尔维亚，撒旦的探戈\n\n> **对于那一代匈牙利人来说，迈克尔·杰克逊代表着对美国文化的想象，甚至是对“西方”的想象。因为铁幕粗暴地把“中欧”这一概念取消了，使匈牙利、东德、捷克斯洛伐克、波兰成了与美国和西欧对立的“东欧”。**\n> \n\n> **拍摄一位匈牙利裔的塞尔维亚艺术家坐通勤火车过境。每次，他都在火车过境时进入洗手间，让同一泡尿液撒在两个国家的土地上。**\n> \n\n> **“在莫哈奇失去的远比现在多。”意思是说，最困难的时刻已经过去，以后再遇到的困难算得了什么？借此鼓起自己面对困难和挫折的勇气。**\n> \n\n### 第二章 物理老师的秘密往事，两个哑巴，赖奇克劳动营\n\n> **相比一个没人关心政治的社会，一个人人都热衷参与政治的社会，反而更可怕——只有极权时代才会出现这样的情况。**\n> \n\n> **我喜欢火车站，因为它像一幕话剧的逼真布景，也是一座城市的风情写照。悲欢离合在这里上演，也在这里结束。在火车站，旅行者可以得到关于一座城市的全部想象。**\n> \n\n### 第三章 布尔诺之星，异乡人，冬之旅\n\n> **当然，”玛丽亚笑了，“只是相处一段时间后发现，那种建立在共同生活基础上的固定关系并不是我想要的。”**\n> \n\n### 第四章 弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\n\n> **在旅游已经相当普遍的今天，“游客”（tourist）似乎已经变成一个格调不高的概念，暗含着浅薄、低俗之意。逼格更高的说法是“旅行者”（traveler）。因为“travel”一词，来自古老的拉丁语，与宗教朝圣中的苦行和精神升华有关。在古代，旅行的最初形态和唯一目的就是朝圣。**\n> \n\n> **政治和文学在语言和精神上迥然不同：“对我有益的对他们有害，适合他们的我却觉得难以消受。我们是两种泾渭分明的风格。”**\n> \n\n### 第五章 “舒伯特”号列车，帝国的切片，萨尔茨堡的雨\n\n> **大部分时间，我面对的是近乎荒凉的风景。如果说开车是一种思考形式，那么它更接近冥想，不要求思想过于集中，而是鼓励思绪自由飘荡**\n> \n\n### 第六章 流亡之地，黄金时代，最后的游荡\n\n> **以至于我感到这些游荡在码头的人全都有一种审美上的自觉——他们出现在这里，并非有任何事情要做，而仅仅是出于美学的需要。**\n> \n\n> **工人和穷文人热爱的咖啡馆，已经中产阶级化。如果乔伊斯不幸晚生一百年，他很可能无力负担这里的消费。**\n> \n\n> **这个世界大概本就没有“黄金时代”。尤其是对于作家和艺术家，生活和伟大的作品之间，总存在某种“古老的敌意”。所谓“黄金时代”，只是胜利者事后的“怀乡”，只是对过去浪漫主义的怀想，只是一片树叶或者一粒止痛片，**\n> \n\n> **而我出生在一个巨变中的国度，成长阶段所熟悉的一切都已物是人非。我不得不接受或大或小的变迁，并且乐于像幽灵一样在废墟间游荡。这片广袤的欧洲腹地——这本书写到的所有地方，为我这样的幽灵提供了游荡之所。我不时唏嘘于它们的变化，同时也试图发现那些被时光留下的永恒之物。**\n> \n\n### 后记 在旅行和写作中确认自我\n> **目的地旅行、阅读、寻找素材、日复一日地写作。它也教会了我对作家来说更重要的品质：保持耐心、享受孤独。**\n>\n\n\n# 《克拉拉与太阳》\n\n[克拉拉与太阳](https://book.douban.com/subject/35315153/)\n\n因为豆瓣畅销书的光环就挑出时间看了，随着年岁增长我越来越不愿意读这些文学意义上的小说了。\n这本书讲的确实是一个很与时俱进且新奇的故事，看完之后我也不禁思考人和所谓的人工智能的机器人在意识上区别究竟是什么。\n\n\n## 第四部\n\n> **古往今来，一个世纪又一个世纪，人们彼此陪伴，共同生活，爱着彼此，恨着彼此，却全都是基于一个错误的假设。一种我们过去在懵懵懂懂之中一直固守的迷信。**\n> \n\n## 译后记\n\n> **正是由于自私的欲望与升华的渴望并存，人类的心中才会充满了矛盾、彷徨与痛苦；没有了自私那下坠的重力，一切崇高、向上的人性也就虚无缥缈得失去了分量。自私是人类沉重的负担，但也许在并不遥远的未来，也会是人之所以为人的一个最重要的锚点吧。**\n>\n\n\n# 《工作、消费主义和新穷人》\n\n在哔哩哔哩看到了对于这本书内容的分析，你可以直接批判它就是典型的白左思想书籍，但这本书还是很值得一读。\n\n[工作、消费主义和新穷人](https://book.douban.com/subject/35593780/)\n\n\n### 要么工作，要么死亡\n\n> **在“大量减少”穷人的过程中，工作伦理的贡献是无价的。毕竟，工作伦理主张：无论生活多么悲惨，只要它是由劳动报酬支撑的，就具有道德优越性。**\n> \n\n### 制造生产者\n\n> **除了那些由于世袭或暴富，可以自给自足悠然生活的人以外，“你是谁”这个问题的答案通常指向人们所在的公司以及该公司的能力。**\n> \n\n### 从“更好”到“更多”\n\n> **工作伦理的宣讲力度与潜在劳动者因失去自由产生的抵制情绪成正比。宣讲的目的在于消除抵制。工作伦理是一种工具，目的是使工人们丧失独立性，服从于工厂制度。**\n> \n\n> **大多数美国社会历史学家都认为，推动美国工业前进的是企业精神和跻身上层阶级的愿望，而非工作伦理。**\n> \n\n> **工业社会是以权力冲突拉开序幕，那时的人们为自治和自由而斗争。时过境迁，现在他们只会为了获取更多盈余而斗争。人们默默接受了现存的权力结构，对这种结构的修正被排除在议程之外。越来越多的人认为，从工匠变成工人时失去的人的尊严，只有通过赢得更多盈余才能恢复。这种变迁中，努力工作能使人们道德升华的呼声日益衰弱。现在，衡量人们声望和社会地位的是工资的差别，而不是勤于工作的道德或惰于工作的罪恶。**\n> \n\n### 第二章 从工作伦理到消费美学\n\n> **之所以称之为“生产者社会”，是因为那时人们主要以生产者的身份参与其中。社会塑造其成员的方式由社会分工的需要决定，社会希望其成员有能力和意愿参与社会分工。在当前这个近现代（late-morden）、次现代（second-morden）或后现代（postmorden）阶段，社会主要要求人们以消费者的能力参与其中，首先依照“消费者”角色需要塑造其成员，并期望他们具有消费的能力和意愿。**\n> \n\n> **想要提高消费者的消费能力就不能让他们休息。他们需要不断地接受新的诱惑，持续处于永不枯竭的兴奋之中，持续处于怀疑和不满之中。诱使他们转移注意力的诱饵需要肯定这种怀疑，同时提供一个宣泄的出口：“你以为这就是全部？好戏还在后头呢！**\n> \n\n> **正常运转的消费者社会中，消费者会主动寻求被诱惑。他们的生活从吸引到吸引，从诱惑到诱惑，从吞下一个诱饵到寻找另一个诱饵，每一个新的吸引、诱惑和诱饵都不尽相同，似乎比之前的更加诱人。他们生活于这种轮回，就像他们的先辈，那些生产者，生活于一个传送带和下一个传送带之间。**\n> \n\n### 制造消费者\n\n> **消费者社会中，与其说经济增长取决于“国家生产力”（即健康充裕的劳动力、充实的财政收入、勇往直前具有企业家精神的资本所有者和经营者），不如说取决于消费者的热情和活力。**\n> \n\n> **今天流行的口号是“灵活”，这个越来越时髦的概念代表的是一场几乎没有任何规则的雇佣和解雇游戏，而且在游戏进行时，单方面就可以随时更改规则。**\n> \n\n### 消费者社会的穷人\n\n> **杰里米·希布鲁克（Jeremy Seabrook）曾提醒过他的读者，当今社会依赖于“制造人为的、主观的不满足感”，因为本质上“人们满足于自己拥有的东西才是最可怕的威胁”。于是，人们真正拥有的东西被淡化，被贬低，被较富裕的人锋芒毕露的奢侈消费所掩盖：“富人成为被普遍崇拜的对象”。**\n> \n\n### 福利国家的衰败\n\n> **这个星球上，部分地区已经充满老于世故的消费者，但也还存在广袤的处女地，那里有不需要激发消费欲望就能获得的顺从劳动力，那里的人为了维持生计而卑微地工作。但是，在本地市场，你需要源源不断地创造新的欲望，并保持雇员工资增长，以确保这些欲望能够变成普遍切实的需求。**\n> \n\n### 招致毁灭的成功\n\n> **获得社会帮助并脱离劣势地位的人，不仅失去了回馈的动力，而且变成了最强烈的诋毁者。从某种意义上说，“平权法案”培养的是自己的掘墓人**\n> \n\n### 第四章 工作伦理和新穷人\n\n> **某国整体失业率快速上升时，你看不到证券市场有任何焦虑的迹象，更谈不上恐慌，它们反倒可能表现火爆。**\n> \n\n### 定居者与游牧者\n\n> 显然，最后一类人在出售劳动力时面临的困难最小，他们的潜在买家并不会特别挑剔。“常规劳动者”从事的工作既不需要难以掌握的稀有技能，也不需要面对面与顾客沟通所需的特殊机敏，因此他们可以比较容易地在所有有偿的低技能工作中切换。但出于同样的原因，他们也很容易被弃用，工作不稳定。他们随时可能被替换，这不会给雇主带来什么损失。他们可能在生意不景气时被就地解雇，因为业务回暖时有很多这样的人随时可以上岗。因此，他们没有找麻烦的气力，没有讨价还价的资本，即使有能力也愿意争取更好的就业条件，他们仍没有胜算的机会。\n> \n\n> 这类人很少有抗争的意愿，特别是团结起来一致行动的意愿。所有的情况似乎都对他们不利。他们的工作是脆弱的，肯定不会持续很久，随时可能消失不见；今天的伙伴明天可能就各奔东西，去向遥远的地方……投身于工人的团结和集体抗争，需要付出长期的、充满风险的努力，注定收益不大，成本却高得难以计量。如果这样的状况持续很久，看不到任何改观，那些受雇者的世界观和心态也会相应变化。“\n> \n\n> **如果你喜欢为之工作的公司，并期望未来一直和它携手前行，那么最多在下一轮的“外包”或“裁员”时，你就会受到伤害。总而言之，这种被称为“劳动力市场灵活性”的重要转变，给长期协作的可能性蒙上了一层阴影，更不用说对“共同事业”全心全意、无条件的承诺和忠诚。**\n> \n\n> **求职者仍像以前一样“受缚于土地”，不能自由迁徙，只能依赖本地的工作谋生，资本现在则可以无拘无束地移动，不用在意距离和国界。**\n> \n\n> **资本完全没必要承受本地劳动力日益膨胀的自信（以及日益增长的要求）所带来的不便（和高昂的成本）。长期雇用导致这些定居劳动力越来越勇敢，并且有足够（过多）的时间变得更团结、更强大、更坚固。然而，当游牧资本想要转移到其他地方时，定居的劳动力根本就没有机会阻碍它转移，更不用说将其永久绑定，因此他们没有机会争取自己的权利，实现自己的抱负。**\n> \n\n> **无论从哪个方面看，脆弱性和不稳定性像幽灵一样萦绕在各种工作周围。不同工作的区别仅在于是否能有效防范雇员的反抗：以消极怠工、逃避责任来对抗雇佣关系的脆弱性。没有哪种工作能免除失业，也没有人可以免除近来出现的“长期失业”——这个词现在已经被更准确地描述为“过剩”。如果说“失业”，甚至是长期失业，意味着工作生活的一个阶段，那么“过剩”则更贴近如今失业的本质。它暗示了一场不可逆转的灾难最终到来。它是通向废品站的一张单程票……**\n> \n\n### 从“失业”到“过剩”\n\n> **随着经济周期的每一次轮回，“失业”这个概念的内涵发生了变化，“失业”之下的希望也越来越不切实际。这种体验无情地累加，推动了真正的“范式转变”产生——“过剩”这个新词，替代了“失业”。**\n> \n\n> **如今的精简型、小型化、资本和知识密集型产业，则把劳动力视为生产力提升的制约要素。这是对曾被奉为经典的斯密_里卡多_马克思劳动价值论的直接挑战。**\n> \n\n> **近来重新鼓吹工作伦理的目的，是为了“将值得帮助的穷人和不值得帮助的穷人分开，把责难倾倒给后者，以合理化社会对他们的冷漠”，因此“说明贫穷是个人缺陷的必然后果，进而促成对穷人和被剥夺者的漠不关心”￼。换言之，工作伦理虽然不再是减少贫困的手段，却能帮助调和社会众生和永恒存在的穷人之间的关系，有助于整个社会的安宁平和。**\n> \n\n### 用于底层阶级的工作伦理\n\n> **正如堕入底层是一个选择问题，脱离贫困也是个选择问题——如果作出的是正确的选择。穷人沦为底层阶级是选择的结果，这个观点暗示的是，他们完全可以作出另一种选择，使自己从困境中解脱出来。**\n> \n\n> **在社会日益富裕的过程中，如果贫困仍继续存在并持续扩大，那么工作伦理一定是无效的。但是，如果我们相信，工作伦理之所以无效只是因为其戒律没有得到很好的倾听和遵从，那么，就只能用那些掉队者的道德缺陷或犯罪倾向予以解释**\n> \n\n### 贫穷即犯罪\n\n> **底层阶级冒犯了大多数人珍视的价值观，却又紧紧抓着它们，渴望像其他自力更生的人一样，获得消费生活的乐趣。换句话说，美国人对底层阶级真正的不满意在于，这些人的梦想，他们渴望的生活模式居然和自己如此相似。**\n> \n\n> 近年来的犯罪率上升，不是功能失调或疏忽大意的结果，而是消费者社会自身的产物，这在逻辑上（而非在法律上）是合理的。更重要的是，这也是消费者社会不可避免的产物。消费者需求越大（即市场诱导越有效），消费者社会就越安全，越繁荣。然而，与此同时，那些有欲望并能满足自己欲望的人（已经被诱惑并能按照诱惑的期望行动的人）与那些已经被诱惑却无法按照期望采取行动的人，两者之间的差距越拉越大。\n> \n\n> 市场诱惑，既是伟大的均衡器，也是伟大的分化器。为了取得效果，消费的诱惑、消费更多的理念必须传达到每一个角落，不加区别地传达给每一个愿意聆听的人。然而，总是存在不能够按照诱惑的期望付诸行动的人，他们每天面对着那些获得满足的人展示的令人眼花缭乱的景象。这些人被告知，奢侈的消费是成功的标志，是赢得公众掌声和名誉的捷径。他们还了解到，拥有和消费某些商品，践行这种生活方式，是幸福的必要条件，甚至是实现人类尊严的必要条件。\n> \n\n> **如果消费是衡量成功人生的标准，衡量幸福的标准，甚至是衡量尊严的标准，那么人类欲望的潘多拉之盒已经打开，再多的购买和刺激的感觉，都不能唤回过去“达到标准”带来的满足感：现在根本就没有标准可言。**\n> \n\n### 逐出道德义务的世界\n\n> **在“电视中”的人们死于饥荒和疾病的那片遥远土地上，也诞生了“亚洲小龙”——虽然所有“小龙”加起来也不及亚洲人口的百分之一。它们传达了想要传达的：饥荒和无家可归是他们自己的选择。其他选项是存在的，然而他们缺乏勤奋和决心。字里行间的意思是，穷人应该对自己的命运负责。他们可以像“亚洲小龙”一样，选择勤奋节俭的生活。**\n> \n\n### 殖民主义，还是剩余劳动力输出\n\n> **从一开始，现代就是大迁徙的时代。至今为止，不计其数的人远渡重洋，离开无法生存的故土，去往满载憧憬的异国他乡。随着时间的推移，现代化的热门区域不断变化，热门的线路也不断变化，但总体来说，移民都是从世界上“较发达”（现代化程度较高）的地区向“不发达”（在现代化冲击下还未舍弃其传统的社会经济平衡）的地区流动。**\n> \n\n### 工作和贫穷问题的全球化新维度\n\n> **远方的人遭受苦难直接或间接的源头，或许正是我们此时此地的所作所为，但由于距离遥远，它们并不会引起道德上的共鸣，也不会像身边所见的苦难那样能够引发强烈的行动意愿。**\n> \n\n### 社会问题转为法律和秩序问题\n\n> **“无用之人”大规模聚集并迅速膨胀，看上去会变成持续的、永久的存在。这要求采取更严格的隔离政策和极端的安全措施，以免危及“社会的健康”以及社会系统的“正常运转”。**\n> \n\n> **可以说，监狱是把穷人和失业者（更准确地说，无法就业的人）从“社会问题”范畴转移到法律秩序范畴的过程中采用的手段，是消除他们对于整个社会潜在的破坏性影响的投资。**\n> \n\n### 从社会国家到“安全国家”\n\n> **市场竞争造成的就业环境不稳定，是且将继续是人们对于未来不确定性、对于社会地位和自尊的不安全感的主要根源。**\n> \n\n## 第三部分\n\n### 第六章 新穷人的前景\n\n> **渴望把人类世界变成一个无机的世界，在那里一切都完美运行，按部就班，服从于一个超越个体的系统。然而，向往秩序就是向往死亡，因为生命本身就是不断破坏秩序的过程。或者换句话说：对秩序的渴望是一种堂皇的托辞，是强烈厌世的借口。**\n> \n\n### 失去位置的穷人\n\n> **学识渊博的经济学家忙不迭地立即证明，当工资保持在低水平的时候，“穷人会做更多的工作，实际上生活得更好”，而他们领取高工资时，他们就迷失于无所事事和聚众闹事。**\n> \n\n> **想符合社会规范，成为一个合格的社会成员，就需要对消费市场的诱惑作出及时有效的反应，需要为“清空供给”作出贡献，需要在经济环境出现问题时，积极参与“消费者主导的复苏”。穷人没有体面的收入，没有信用卡和美好前景，他们达不到要求。今天穷人打破的社会规范——使他们“不正常”的规范，是消费能力规范而非就业规范。今天的穷人是“不消费的人”，而非“失业者”。他们首先被定义为有缺陷的消费者，因为他们没有履行最重要的社会责任——积极有效地购买市场提供的商品和服务。消费者社会的资产负债表中，穷人明显是负债，无论如何也不能把他们记入现在或未来的资产。**\n> \n\n### 没有位置，没有道德义务\n\n> **如果穷人试图捍卫福利体系的残存，他们很快就会发现自己没有谈判的筹码，无法传达自己的声音，更不可能给对手造成威胁。他们尤其没有任何能力来打动社会上的普通公民，大众受到了政客的蛊惑，他们被劝说不要因为内心的冲动投票，而要根据自己的利益投票。**\n> \n\n### 工作伦理，还是生活道德\n\n> 收入权利与收入能力脱钩的想法其实并不保守。根据我们的推论，实现它恰恰需要一个非常大的转变。我们将不得不放弃目前生活模式中一些神圣不可侵犯的假设（由于缺少反思，它们显得更加神圣）。例如，效率是一件好事，无论它目的何在，也无论它是否会带来痛苦的副作用。再例如，凡是“经济增长”的东西，即统计意义上“今天比昨天多，明天比今天多”的东西，就是好的，而无视其增长过程中对人类生存环境和自然（全人类共享的生存环境）造成的损害。\n> \n\n> 对那些因为需要作出巨大的转变而反对的人，我们只能再次引用科尼利厄斯的话来回答。当一个采访者问他：“那么，你想要什么？改变人类吗？”，卡斯托利亚蒂斯回答说：“不，没有那么夸张：我希望人类改变，正像他们已经改变过两三次那样。”[8]\n至少现在还有希望，人类能够再次完成同样的壮举。毕竟，正如帕特里克·库里（Patrick Curry）所言，“群体自愿的返璞归真，正成为群体贫困的唯一有意义的替代。\n> \n\n并不认同这样的观点。","source":"_posts/202206ReadingList.md","raw":"---\ntitle: 2022年六月读书摘录\ndate: 2022-07-15 13:10:12\ncategories: \n- 阅读\ntags: \n- 读书\n- 长安的荔枝\n- 马伯庸\n- 失落的卫星\n- 午夜降临前抵达\n- 刘子超\n- 工作、消费主义和新穷人\n- 克拉拉与太阳\ncopyright: true\n---\n\n继上个月分享了一些读书摘录之后这个月也没闲着，一共读了五本书。\n- 《长安的荔枝》\n- 《失落的卫星》\n- 《午夜降临前抵达》\n- 《克拉拉与太阳》\n- 《工作、消费主义和新穷人》\n\n<!--more-->\n\n# 《长安的荔枝》\n\n[长安的荔枝](https://movie.douban.com/subject/35651341/)\n\n取材于“一骑红尘妃子笑，无人知是荔枝来”，马伯庸讲故事的能力确实令人惊叹，也很是期待同名的电影作品。\n\n## 第一章\n\n> **唯有早点跟妻子和离，一别两宽，将来事发才不会累及家人。李善德可以趁这最后四个月横行一下，多捞些油水，尽量把香积贷偿清，好歹能给孤女寡妇留下一处宅子。**\n> \n\n## 第二章\n\n> **一番铜臭交易之后，心中那点“昔我往矣”的淡淡离愁，也便没了踪影，倒省了很多苦情文章。**\n> \n\n> **听说百越民风彪悍，生翅者不食幞头，带腿者不食案几，余者无不可入口，果然没有夸张。**\n> \n\n## 第四章\n\n> **自己那二十多年的上林署监事，其实只窥到了朝廷的小小一角。这个坐落着诸多衙署的庞大皇城，比秦岭密林更加错综复杂，它运转的规律比道经更为玄妙。不熟悉的人贸然踏入，就像落入壶口瀑布下的奔腾乱流一样，撞得头破血流**\n> \n\n> **做官之道，其实就三句话：和光同尘，好处均沾，花花轿子众人齐抬。一个人吃独食，是吃不长久的。**\n\n\n# 《失落的卫星》\n\n看了刘子超的书才知道原来旅行文学这么有趣，并不是类似流水账之类的产物。\n从作者文字中窥见了很多人情世故，带着我的思绪去了遥远的中亚。\n\n[失落的卫星](https://book.douban.com/subject/35025453/)\n\n## 序幕 大巴扎、流放者和塔季扬娜\n\n> **哈萨克是俄国十月革命后才产生的概念。当时，苏联把西方的民族国家理论应用到中亚这片民族观念尚处于前现代状态的土地上。哈萨克斯坦，连同其他四个斯坦国一起，诞生于这样的背景下。**\n> \n\n> **1854年，陀思妥耶夫斯基被发配至哈萨克斯坦东部的塞米伊。他刚在西伯利亚的鄂木斯克服刑四年，因此即便是这样闭塞的边疆小镇，也令他欣喜。因为他终于可以摘掉镣铐，同时获准阅读《圣经》之外的书籍。**\n> \n\n> **中国的吉尔吉斯人叫作“柯尔克孜族”；李白据说生于碎叶城，就位于今天吉尔吉斯境内的托克马克。**\n> \n\n### 边城浮世绘\n\n> **“对我这代吉尔吉斯人来说，苏联就像史前时代，与我们无关。”阿拜说，“从父母那里，我听过不少苏联时代的故事，但却无法激起太多共鸣。”**\n> \n\n> **不过，我可以告诉你，不要抨击绿色和平，更不要抨击LGBT——这是我的女友说的。她说，阿拜，如果你想获得诺贝尔文学奖，那你就不要抨击绿色和平，更不要抨击LGBT。”\n“她确实聪明。”**\n> \n\n> **我始终觉得自己流淌着游牧民族的血液——不是草原游牧民族，而是当代游牧民族。这样的人总是不停移动，从世界的一个地方到另一个地方，缺乏归属感，家只不过是当下的落脚之处。对他们来说，旅行不是为了去任何地方，只是为了旅行。最重要的事情是移动。**\n> \n\n### 加加林疗养院\n\n> **所有人的餐食都是一样的——就像那些服务员脸上的表情——具有社会主义的一致性。**\n> \n\n### 杜尚别复调\n\n> **想借此赋予塔吉克人一点犹太民族在他们自己历史中找到的那种悲怆感。相比一个王朝的覆灭，文化根基的丧失更加悲惨。**\n> \n\n> **让人想到后来伊拉克人民推倒萨达姆的雕像。无事可做的男人们一脸仇恨，他们举着拳头，喊着口号，仿佛在进行一场游戏，只是没人相信这场游戏会有任何严重的后果。**\n> \n\n> **但我只是说，你还年轻，还没跨越那道“阴影线”——这是约瑟夫·康拉德说的，你感到烦闷、厌倦、不满、迷茫，这是生活中必将来临的那个时刻。**\n> \n\n### 从帕米尔公路到瓦罕山谷\n\n> **说这话时，司机的表情并没有任何不满，口气中甚至还带着几分理解。警察相信，凭他们的制服，索取是名正言顺的事。司机大概也这么认为。**\n> \n\n> **我想起一路上经过的那些分界线：同样的民族，同样的生活方式，被分割开来，像刀子割开的伤口。**\n> \n\n### 不安的山谷\n\n> **取消宗教、推行民族融合的苏联，宗教和族群的界限变得模糊不清，一种相对平静的关系维持了数十年。可是一旦这种体制濒临溃败，宗教势力和民族主义就会结合在一起，导致惨剧发生。**\n> \n\n> **在《本地人的今与昔》一书中，纳利夫金总结了两个民族之间不太融洽的历史关系：乌兹别克人是定居民族，而吉尔吉斯人是游牧民族。乌兹别克人瞧不起吉尔吉斯人，而又惧怕他们的武力。乌兹别克人大都是农民、工匠、商人，而吉尔吉斯人喜欢在山间放牧，住在传统毡房里。他们不时劫掠乌兹别克人的马匹，只有当他们需要买东西时，才会下到乌兹别克人居住的绿洲城镇。这时，乌兹别克人就会大肆嘲笑吉尔吉斯人的愚昧无知，然后狠狠地敲他们一笔。**\n> \n\n### 通向撒马尔罕的金色之路\n\n> **中国人的丝绸和瓷器传入这里，而粟特人则将制造玻璃和酿造葡萄酒的技艺传入中国。东西方的珠宝、首饰、钱币在这里荟聚，还有用骨头精心雕刻的下棋者。**\n> \n\n> **作为旅行者，我只是机械地从一个遗迹，移动到另一个遗迹，试图从每个遗迹中眺望到一点遥远时代的微暗火光。**\n> \n\n以后每去一个博物馆都可以说成是自己在眺望**遥远时代的微暗火光。**\n\n### 布哈拉的博弈与离散\n\n> **在这里，苏联纪念物是如此之多，而且便宜得惊人。谁又能想到它们曾是一代人的荣誉和骄傲？是那些人用生命加以守护的珍宝？**\n> \n\n### 困守咸海的人\n\n> **咸海王讲起他的治理之道。他时常对工人们说，来到这里，只有一个目的，那就是一门心思地挣钱。他禁止工人喝酒，但也知道，私下里人人都会喝。只要不闹出事来，就应该“睁一只眼闭一只眼”。他管这叫“中国人的智慧”。**\n> \n\n### 突厥斯坦的小人物\n\n> **随着阿拉伯人的征伐，造纸术由中亚传入西亚、北非和欧洲。**\n> \n\n> **我留意了一下画作的时间——1954年。前一年，斯大林刚刚去世，苏联进入“解冻”时期。已经在塔拉兹待了十三年的布雷默，想必也感受到一丝春意——你甚至能在他的画笔中看到一种有意克制的轻松。**\n> \n\n> **他早有准备，说不定在家排练过。那张消瘦的胡茬脸，配合抑扬顿挫的口气，外加耸动的眉骨，活脱脱地展现了一个乌兹别克人的“交易的艺术”，体现了哈萨克人心目中“萨特人”的狡黠。我一时间钦佩不已，于是没再还价，就点头同意了。**\n> \n\n作者笔下不少地区的中亚人都有这般特点，他们的这番特点也是经济水平和历史造成的。\n\n> **帖木儿是一个被高估的英雄人物。他没有为帝国创造出一个生生不息的文化，只是留下一些建筑，供人凭吊而已。一旦他的个人意志退潮，帝国也就随之烂尾。这些建筑——无论是对于宗教，还是人民——意义都非常有限。**\n> \n\n### 草原核爆\n\n> **“你们的祖国是哪里？”“你用什么语言思考，你的祖国就是哪里。”“我们说俄语，可我们生活在哈萨克斯坦。”“我们不属于俄国，不属于哈萨克斯坦，更不属于朝鲜或韩国。”“我们是什么人？”**\n> \n\n> **我沿着指引观看。每看完一部分，大妈就把那部分的照明关掉。虽说博物馆有政府补贴，也收门票，但看来还是资金紧张，不得不省钱度日。**\n> \n\n> **一旦国家的意志退潮，人们就会自然地用脚投票。科学家和军人带着家眷匆匆离开，短短数月内，查干人去楼空。**\n> \n\n### 七河之地\n\n> **在广大的中亚乡村地带，我都目睹了类似情况：相比他们苏联出身的父母，独立后的年轻一代反而更加传统、保守。**\n> \n\n## 尾声 扎尔肯特：进步前哨站\n\n> **苏俄治下的和平促进了中亚的繁荣，但也埋下分裂的种子。独立后，中亚开始对自己的历史和未来有了新的看法，不同的思潮与想法在这片土地上反复激荡。而今天，中国的崛起将会改变这里的引力，为中亚带来不同的前景。**\n> \n\n结尾的爱国情怀反倒是有些突然，不过经过那么多天奔波回到祖国确实会有这番情感。\n\n\n# 《午夜降临前抵达》\n\n读的刘子超的第二本作品，书籍中的一句话我很是喜欢。“旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。”\n\n[午夜降临前抵达](https://book.douban.com/subject/35522033/)\n\n### 第一章 疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\n\n> **不喜欢把每一段行程都安排得严丝合缝的旅行，没有即兴，没有随心所欲，没有突发奇想，旅行更像是一种苦行。**\n> \n\n### 第二章 火车情结，横穿波希米亚，死亡赋格\n\n> **伯格说：“年轻人，这世上还有哪个国家比波兰更习惯与忧伤这种情感妥协共处呢？”**\n> \n\n> **我感到一切战争、屠杀、罪行总会影响到之后的每一个人，无论哪一方，只是以各自不同的方式罢了。**\n> \n\n### 第三章 读艺术史的女孩，塔特拉山，猎人小屋\n\n> **除了酒吧和饭馆，其他公众场合禁止饮酒。一旦被警察发现，可能受到重罚。具体来说，惩戒的程度根据喝酒的多少而定。**\n> \n\n> **山在白天是一种壮美，到了夜晚却令人心悸。那种庞大而未知的存在，不分昼夜地永恒矗立，让我感到自己的渺小和脆弱。如果山愿意，它可以轻而易举地摧毁我，而我此刻还活着，不过依赖于它的垂怜。**\n> \n\n> **旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。**\n> \n\n### 第四章 卫星城，沃利肖像，昨日的世界\n\n> **因为放弃了发掘城市秘密的野心，反而获得了一种轻松自在的心理状态：无须再去看着地图，寻找那些著名景点；也无须为了找到当地人的秘密据点而犯愁；更不用因为自己对这座城市的无知而羞愧。**\n> \n\n> **在维也纳，这类具有历史意义的每一幢房屋的拆除，就像从我们身上夺取了一部分灵魂。**\n> \n\n> **对于这家百年咖啡馆来说，一部好莱坞电影的意义显然算不上重大，它根本不屑把任何电影海报张贴出来。一切都尽量维持着1880年的原貌——那是哈布斯堡王朝最辉煌的时代。**\n> \n\n### 第五章 中国“倒爷”，骑行者俱乐部，土耳其浴室\n\n> **风景缺少的只是赞美。\n——切斯瓦夫·米沃什，《风景》**\n> \n\n> **一个国家的年轻人如果都以拥有“公共层面”的身份为荣，那么这个国家无疑是充满希望的。**\n> \n\n> **我相信过去不曾终结，它仍然在另一个维度上运行。通过旧房子、旧书、旧照片，我们得以窥视那个维度里的吉光片羽。**\n> \n\n### 第六章 挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\n\n> **多次和日本人相遇以后，我总结出了在国外分辨他们的三种方法：一、他们把sorry念成soli；二、他们人手一本日本大宝石出版社的《走遍全球》；三、或者说是一种天赋亦可，他们总能在鸟不拉屎的地方，找到极为正宗的日本料理。**\n> \n\n> **正如米兰·昆德拉所说，生长于一个小国有时候是一种优势。因为身处小国，要么做一个可怜的、眼光狭窄的人，要么成为一个广闻博识的“世界性的人”。**\n> \n\n> **作为少数民族作家，他们不仅是在使用词语，他们是在运用整个存在，运用民族精神和神话，运用记忆、传统和文化来写作。对他们来说，语言就是命运——一个民族的命运。**\n> \n\n### 第一章 古树茶，故乡在塞尔维亚，撒旦的探戈\n\n> **对于那一代匈牙利人来说，迈克尔·杰克逊代表着对美国文化的想象，甚至是对“西方”的想象。因为铁幕粗暴地把“中欧”这一概念取消了，使匈牙利、东德、捷克斯洛伐克、波兰成了与美国和西欧对立的“东欧”。**\n> \n\n> **拍摄一位匈牙利裔的塞尔维亚艺术家坐通勤火车过境。每次，他都在火车过境时进入洗手间，让同一泡尿液撒在两个国家的土地上。**\n> \n\n> **“在莫哈奇失去的远比现在多。”意思是说，最困难的时刻已经过去，以后再遇到的困难算得了什么？借此鼓起自己面对困难和挫折的勇气。**\n> \n\n### 第二章 物理老师的秘密往事，两个哑巴，赖奇克劳动营\n\n> **相比一个没人关心政治的社会，一个人人都热衷参与政治的社会，反而更可怕——只有极权时代才会出现这样的情况。**\n> \n\n> **我喜欢火车站，因为它像一幕话剧的逼真布景，也是一座城市的风情写照。悲欢离合在这里上演，也在这里结束。在火车站，旅行者可以得到关于一座城市的全部想象。**\n> \n\n### 第三章 布尔诺之星，异乡人，冬之旅\n\n> **当然，”玛丽亚笑了，“只是相处一段时间后发现，那种建立在共同生活基础上的固定关系并不是我想要的。”**\n> \n\n### 第四章 弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\n\n> **在旅游已经相当普遍的今天，“游客”（tourist）似乎已经变成一个格调不高的概念，暗含着浅薄、低俗之意。逼格更高的说法是“旅行者”（traveler）。因为“travel”一词，来自古老的拉丁语，与宗教朝圣中的苦行和精神升华有关。在古代，旅行的最初形态和唯一目的就是朝圣。**\n> \n\n> **政治和文学在语言和精神上迥然不同：“对我有益的对他们有害，适合他们的我却觉得难以消受。我们是两种泾渭分明的风格。”**\n> \n\n### 第五章 “舒伯特”号列车，帝国的切片，萨尔茨堡的雨\n\n> **大部分时间，我面对的是近乎荒凉的风景。如果说开车是一种思考形式，那么它更接近冥想，不要求思想过于集中，而是鼓励思绪自由飘荡**\n> \n\n### 第六章 流亡之地，黄金时代，最后的游荡\n\n> **以至于我感到这些游荡在码头的人全都有一种审美上的自觉——他们出现在这里，并非有任何事情要做，而仅仅是出于美学的需要。**\n> \n\n> **工人和穷文人热爱的咖啡馆，已经中产阶级化。如果乔伊斯不幸晚生一百年，他很可能无力负担这里的消费。**\n> \n\n> **这个世界大概本就没有“黄金时代”。尤其是对于作家和艺术家，生活和伟大的作品之间，总存在某种“古老的敌意”。所谓“黄金时代”，只是胜利者事后的“怀乡”，只是对过去浪漫主义的怀想，只是一片树叶或者一粒止痛片，**\n> \n\n> **而我出生在一个巨变中的国度，成长阶段所熟悉的一切都已物是人非。我不得不接受或大或小的变迁，并且乐于像幽灵一样在废墟间游荡。这片广袤的欧洲腹地——这本书写到的所有地方，为我这样的幽灵提供了游荡之所。我不时唏嘘于它们的变化，同时也试图发现那些被时光留下的永恒之物。**\n> \n\n### 后记 在旅行和写作中确认自我\n> **目的地旅行、阅读、寻找素材、日复一日地写作。它也教会了我对作家来说更重要的品质：保持耐心、享受孤独。**\n>\n\n\n# 《克拉拉与太阳》\n\n[克拉拉与太阳](https://book.douban.com/subject/35315153/)\n\n因为豆瓣畅销书的光环就挑出时间看了，随着年岁增长我越来越不愿意读这些文学意义上的小说了。\n这本书讲的确实是一个很与时俱进且新奇的故事，看完之后我也不禁思考人和所谓的人工智能的机器人在意识上区别究竟是什么。\n\n\n## 第四部\n\n> **古往今来，一个世纪又一个世纪，人们彼此陪伴，共同生活，爱着彼此，恨着彼此，却全都是基于一个错误的假设。一种我们过去在懵懵懂懂之中一直固守的迷信。**\n> \n\n## 译后记\n\n> **正是由于自私的欲望与升华的渴望并存，人类的心中才会充满了矛盾、彷徨与痛苦；没有了自私那下坠的重力，一切崇高、向上的人性也就虚无缥缈得失去了分量。自私是人类沉重的负担，但也许在并不遥远的未来，也会是人之所以为人的一个最重要的锚点吧。**\n>\n\n\n# 《工作、消费主义和新穷人》\n\n在哔哩哔哩看到了对于这本书内容的分析，你可以直接批判它就是典型的白左思想书籍，但这本书还是很值得一读。\n\n[工作、消费主义和新穷人](https://book.douban.com/subject/35593780/)\n\n\n### 要么工作，要么死亡\n\n> **在“大量减少”穷人的过程中，工作伦理的贡献是无价的。毕竟，工作伦理主张：无论生活多么悲惨，只要它是由劳动报酬支撑的，就具有道德优越性。**\n> \n\n### 制造生产者\n\n> **除了那些由于世袭或暴富，可以自给自足悠然生活的人以外，“你是谁”这个问题的答案通常指向人们所在的公司以及该公司的能力。**\n> \n\n### 从“更好”到“更多”\n\n> **工作伦理的宣讲力度与潜在劳动者因失去自由产生的抵制情绪成正比。宣讲的目的在于消除抵制。工作伦理是一种工具，目的是使工人们丧失独立性，服从于工厂制度。**\n> \n\n> **大多数美国社会历史学家都认为，推动美国工业前进的是企业精神和跻身上层阶级的愿望，而非工作伦理。**\n> \n\n> **工业社会是以权力冲突拉开序幕，那时的人们为自治和自由而斗争。时过境迁，现在他们只会为了获取更多盈余而斗争。人们默默接受了现存的权力结构，对这种结构的修正被排除在议程之外。越来越多的人认为，从工匠变成工人时失去的人的尊严，只有通过赢得更多盈余才能恢复。这种变迁中，努力工作能使人们道德升华的呼声日益衰弱。现在，衡量人们声望和社会地位的是工资的差别，而不是勤于工作的道德或惰于工作的罪恶。**\n> \n\n### 第二章 从工作伦理到消费美学\n\n> **之所以称之为“生产者社会”，是因为那时人们主要以生产者的身份参与其中。社会塑造其成员的方式由社会分工的需要决定，社会希望其成员有能力和意愿参与社会分工。在当前这个近现代（late-morden）、次现代（second-morden）或后现代（postmorden）阶段，社会主要要求人们以消费者的能力参与其中，首先依照“消费者”角色需要塑造其成员，并期望他们具有消费的能力和意愿。**\n> \n\n> **想要提高消费者的消费能力就不能让他们休息。他们需要不断地接受新的诱惑，持续处于永不枯竭的兴奋之中，持续处于怀疑和不满之中。诱使他们转移注意力的诱饵需要肯定这种怀疑，同时提供一个宣泄的出口：“你以为这就是全部？好戏还在后头呢！**\n> \n\n> **正常运转的消费者社会中，消费者会主动寻求被诱惑。他们的生活从吸引到吸引，从诱惑到诱惑，从吞下一个诱饵到寻找另一个诱饵，每一个新的吸引、诱惑和诱饵都不尽相同，似乎比之前的更加诱人。他们生活于这种轮回，就像他们的先辈，那些生产者，生活于一个传送带和下一个传送带之间。**\n> \n\n### 制造消费者\n\n> **消费者社会中，与其说经济增长取决于“国家生产力”（即健康充裕的劳动力、充实的财政收入、勇往直前具有企业家精神的资本所有者和经营者），不如说取决于消费者的热情和活力。**\n> \n\n> **今天流行的口号是“灵活”，这个越来越时髦的概念代表的是一场几乎没有任何规则的雇佣和解雇游戏，而且在游戏进行时，单方面就可以随时更改规则。**\n> \n\n### 消费者社会的穷人\n\n> **杰里米·希布鲁克（Jeremy Seabrook）曾提醒过他的读者，当今社会依赖于“制造人为的、主观的不满足感”，因为本质上“人们满足于自己拥有的东西才是最可怕的威胁”。于是，人们真正拥有的东西被淡化，被贬低，被较富裕的人锋芒毕露的奢侈消费所掩盖：“富人成为被普遍崇拜的对象”。**\n> \n\n### 福利国家的衰败\n\n> **这个星球上，部分地区已经充满老于世故的消费者，但也还存在广袤的处女地，那里有不需要激发消费欲望就能获得的顺从劳动力，那里的人为了维持生计而卑微地工作。但是，在本地市场，你需要源源不断地创造新的欲望，并保持雇员工资增长，以确保这些欲望能够变成普遍切实的需求。**\n> \n\n### 招致毁灭的成功\n\n> **获得社会帮助并脱离劣势地位的人，不仅失去了回馈的动力，而且变成了最强烈的诋毁者。从某种意义上说，“平权法案”培养的是自己的掘墓人**\n> \n\n### 第四章 工作伦理和新穷人\n\n> **某国整体失业率快速上升时，你看不到证券市场有任何焦虑的迹象，更谈不上恐慌，它们反倒可能表现火爆。**\n> \n\n### 定居者与游牧者\n\n> 显然，最后一类人在出售劳动力时面临的困难最小，他们的潜在买家并不会特别挑剔。“常规劳动者”从事的工作既不需要难以掌握的稀有技能，也不需要面对面与顾客沟通所需的特殊机敏，因此他们可以比较容易地在所有有偿的低技能工作中切换。但出于同样的原因，他们也很容易被弃用，工作不稳定。他们随时可能被替换，这不会给雇主带来什么损失。他们可能在生意不景气时被就地解雇，因为业务回暖时有很多这样的人随时可以上岗。因此，他们没有找麻烦的气力，没有讨价还价的资本，即使有能力也愿意争取更好的就业条件，他们仍没有胜算的机会。\n> \n\n> 这类人很少有抗争的意愿，特别是团结起来一致行动的意愿。所有的情况似乎都对他们不利。他们的工作是脆弱的，肯定不会持续很久，随时可能消失不见；今天的伙伴明天可能就各奔东西，去向遥远的地方……投身于工人的团结和集体抗争，需要付出长期的、充满风险的努力，注定收益不大，成本却高得难以计量。如果这样的状况持续很久，看不到任何改观，那些受雇者的世界观和心态也会相应变化。“\n> \n\n> **如果你喜欢为之工作的公司，并期望未来一直和它携手前行，那么最多在下一轮的“外包”或“裁员”时，你就会受到伤害。总而言之，这种被称为“劳动力市场灵活性”的重要转变，给长期协作的可能性蒙上了一层阴影，更不用说对“共同事业”全心全意、无条件的承诺和忠诚。**\n> \n\n> **求职者仍像以前一样“受缚于土地”，不能自由迁徙，只能依赖本地的工作谋生，资本现在则可以无拘无束地移动，不用在意距离和国界。**\n> \n\n> **资本完全没必要承受本地劳动力日益膨胀的自信（以及日益增长的要求）所带来的不便（和高昂的成本）。长期雇用导致这些定居劳动力越来越勇敢，并且有足够（过多）的时间变得更团结、更强大、更坚固。然而，当游牧资本想要转移到其他地方时，定居的劳动力根本就没有机会阻碍它转移，更不用说将其永久绑定，因此他们没有机会争取自己的权利，实现自己的抱负。**\n> \n\n> **无论从哪个方面看，脆弱性和不稳定性像幽灵一样萦绕在各种工作周围。不同工作的区别仅在于是否能有效防范雇员的反抗：以消极怠工、逃避责任来对抗雇佣关系的脆弱性。没有哪种工作能免除失业，也没有人可以免除近来出现的“长期失业”——这个词现在已经被更准确地描述为“过剩”。如果说“失业”，甚至是长期失业，意味着工作生活的一个阶段，那么“过剩”则更贴近如今失业的本质。它暗示了一场不可逆转的灾难最终到来。它是通向废品站的一张单程票……**\n> \n\n### 从“失业”到“过剩”\n\n> **随着经济周期的每一次轮回，“失业”这个概念的内涵发生了变化，“失业”之下的希望也越来越不切实际。这种体验无情地累加，推动了真正的“范式转变”产生——“过剩”这个新词，替代了“失业”。**\n> \n\n> **如今的精简型、小型化、资本和知识密集型产业，则把劳动力视为生产力提升的制约要素。这是对曾被奉为经典的斯密_里卡多_马克思劳动价值论的直接挑战。**\n> \n\n> **近来重新鼓吹工作伦理的目的，是为了“将值得帮助的穷人和不值得帮助的穷人分开，把责难倾倒给后者，以合理化社会对他们的冷漠”，因此“说明贫穷是个人缺陷的必然后果，进而促成对穷人和被剥夺者的漠不关心”￼。换言之，工作伦理虽然不再是减少贫困的手段，却能帮助调和社会众生和永恒存在的穷人之间的关系，有助于整个社会的安宁平和。**\n> \n\n### 用于底层阶级的工作伦理\n\n> **正如堕入底层是一个选择问题，脱离贫困也是个选择问题——如果作出的是正确的选择。穷人沦为底层阶级是选择的结果，这个观点暗示的是，他们完全可以作出另一种选择，使自己从困境中解脱出来。**\n> \n\n> **在社会日益富裕的过程中，如果贫困仍继续存在并持续扩大，那么工作伦理一定是无效的。但是，如果我们相信，工作伦理之所以无效只是因为其戒律没有得到很好的倾听和遵从，那么，就只能用那些掉队者的道德缺陷或犯罪倾向予以解释**\n> \n\n### 贫穷即犯罪\n\n> **底层阶级冒犯了大多数人珍视的价值观，却又紧紧抓着它们，渴望像其他自力更生的人一样，获得消费生活的乐趣。换句话说，美国人对底层阶级真正的不满意在于，这些人的梦想，他们渴望的生活模式居然和自己如此相似。**\n> \n\n> 近年来的犯罪率上升，不是功能失调或疏忽大意的结果，而是消费者社会自身的产物，这在逻辑上（而非在法律上）是合理的。更重要的是，这也是消费者社会不可避免的产物。消费者需求越大（即市场诱导越有效），消费者社会就越安全，越繁荣。然而，与此同时，那些有欲望并能满足自己欲望的人（已经被诱惑并能按照诱惑的期望行动的人）与那些已经被诱惑却无法按照期望采取行动的人，两者之间的差距越拉越大。\n> \n\n> 市场诱惑，既是伟大的均衡器，也是伟大的分化器。为了取得效果，消费的诱惑、消费更多的理念必须传达到每一个角落，不加区别地传达给每一个愿意聆听的人。然而，总是存在不能够按照诱惑的期望付诸行动的人，他们每天面对着那些获得满足的人展示的令人眼花缭乱的景象。这些人被告知，奢侈的消费是成功的标志，是赢得公众掌声和名誉的捷径。他们还了解到，拥有和消费某些商品，践行这种生活方式，是幸福的必要条件，甚至是实现人类尊严的必要条件。\n> \n\n> **如果消费是衡量成功人生的标准，衡量幸福的标准，甚至是衡量尊严的标准，那么人类欲望的潘多拉之盒已经打开，再多的购买和刺激的感觉，都不能唤回过去“达到标准”带来的满足感：现在根本就没有标准可言。**\n> \n\n### 逐出道德义务的世界\n\n> **在“电视中”的人们死于饥荒和疾病的那片遥远土地上，也诞生了“亚洲小龙”——虽然所有“小龙”加起来也不及亚洲人口的百分之一。它们传达了想要传达的：饥荒和无家可归是他们自己的选择。其他选项是存在的，然而他们缺乏勤奋和决心。字里行间的意思是，穷人应该对自己的命运负责。他们可以像“亚洲小龙”一样，选择勤奋节俭的生活。**\n> \n\n### 殖民主义，还是剩余劳动力输出\n\n> **从一开始，现代就是大迁徙的时代。至今为止，不计其数的人远渡重洋，离开无法生存的故土，去往满载憧憬的异国他乡。随着时间的推移，现代化的热门区域不断变化，热门的线路也不断变化，但总体来说，移民都是从世界上“较发达”（现代化程度较高）的地区向“不发达”（在现代化冲击下还未舍弃其传统的社会经济平衡）的地区流动。**\n> \n\n### 工作和贫穷问题的全球化新维度\n\n> **远方的人遭受苦难直接或间接的源头，或许正是我们此时此地的所作所为，但由于距离遥远，它们并不会引起道德上的共鸣，也不会像身边所见的苦难那样能够引发强烈的行动意愿。**\n> \n\n### 社会问题转为法律和秩序问题\n\n> **“无用之人”大规模聚集并迅速膨胀，看上去会变成持续的、永久的存在。这要求采取更严格的隔离政策和极端的安全措施，以免危及“社会的健康”以及社会系统的“正常运转”。**\n> \n\n> **可以说，监狱是把穷人和失业者（更准确地说，无法就业的人）从“社会问题”范畴转移到法律秩序范畴的过程中采用的手段，是消除他们对于整个社会潜在的破坏性影响的投资。**\n> \n\n### 从社会国家到“安全国家”\n\n> **市场竞争造成的就业环境不稳定，是且将继续是人们对于未来不确定性、对于社会地位和自尊的不安全感的主要根源。**\n> \n\n## 第三部分\n\n### 第六章 新穷人的前景\n\n> **渴望把人类世界变成一个无机的世界，在那里一切都完美运行，按部就班，服从于一个超越个体的系统。然而，向往秩序就是向往死亡，因为生命本身就是不断破坏秩序的过程。或者换句话说：对秩序的渴望是一种堂皇的托辞，是强烈厌世的借口。**\n> \n\n### 失去位置的穷人\n\n> **学识渊博的经济学家忙不迭地立即证明，当工资保持在低水平的时候，“穷人会做更多的工作，实际上生活得更好”，而他们领取高工资时，他们就迷失于无所事事和聚众闹事。**\n> \n\n> **想符合社会规范，成为一个合格的社会成员，就需要对消费市场的诱惑作出及时有效的反应，需要为“清空供给”作出贡献，需要在经济环境出现问题时，积极参与“消费者主导的复苏”。穷人没有体面的收入，没有信用卡和美好前景，他们达不到要求。今天穷人打破的社会规范——使他们“不正常”的规范，是消费能力规范而非就业规范。今天的穷人是“不消费的人”，而非“失业者”。他们首先被定义为有缺陷的消费者，因为他们没有履行最重要的社会责任——积极有效地购买市场提供的商品和服务。消费者社会的资产负债表中，穷人明显是负债，无论如何也不能把他们记入现在或未来的资产。**\n> \n\n### 没有位置，没有道德义务\n\n> **如果穷人试图捍卫福利体系的残存，他们很快就会发现自己没有谈判的筹码，无法传达自己的声音，更不可能给对手造成威胁。他们尤其没有任何能力来打动社会上的普通公民，大众受到了政客的蛊惑，他们被劝说不要因为内心的冲动投票，而要根据自己的利益投票。**\n> \n\n### 工作伦理，还是生活道德\n\n> 收入权利与收入能力脱钩的想法其实并不保守。根据我们的推论，实现它恰恰需要一个非常大的转变。我们将不得不放弃目前生活模式中一些神圣不可侵犯的假设（由于缺少反思，它们显得更加神圣）。例如，效率是一件好事，无论它目的何在，也无论它是否会带来痛苦的副作用。再例如，凡是“经济增长”的东西，即统计意义上“今天比昨天多，明天比今天多”的东西，就是好的，而无视其增长过程中对人类生存环境和自然（全人类共享的生存环境）造成的损害。\n> \n\n> 对那些因为需要作出巨大的转变而反对的人，我们只能再次引用科尼利厄斯的话来回答。当一个采访者问他：“那么，你想要什么？改变人类吗？”，卡斯托利亚蒂斯回答说：“不，没有那么夸张：我希望人类改变，正像他们已经改变过两三次那样。”[8]\n至少现在还有希望，人类能够再次完成同样的壮举。毕竟，正如帕特里克·库里（Patrick Curry）所言，“群体自愿的返璞归真，正成为群体贫困的唯一有意义的替代。\n> \n\n并不认同这样的观点。","slug":"202206ReadingList","published":1,"updated":"2022-07-24T16:53:19.928Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1c0001o76fa4dkgwde","content":"<p>继上个月分享了一些读书摘录之后这个月也没闲着，一共读了五本书。</p>\n<ul>\n<li>《长安的荔枝》</li>\n<li>《失落的卫星》</li>\n<li>《午夜降临前抵达》</li>\n<li>《克拉拉与太阳》</li>\n<li>《工作、消费主义和新穷人》</li>\n</ul>\n<span id=\"more\"></span>\n\n<h1 id=\"《长安的荔枝》\"><a href=\"#《长安的荔枝》\" class=\"headerlink\" title=\"《长安的荔枝》\"></a>《长安的荔枝》</h1><p><a href=\"https://movie.douban.com/subject/35651341/\">长安的荔枝</a></p>\n<p>取材于“一骑红尘妃子笑，无人知是荔枝来”，马伯庸讲故事的能力确实令人惊叹，也很是期待同名的电影作品。</p>\n<h2 id=\"第一章\"><a href=\"#第一章\" class=\"headerlink\" title=\"第一章\"></a>第一章</h2><blockquote>\n<p><strong>唯有早点跟妻子和离，一别两宽，将来事发才不会累及家人。李善德可以趁这最后四个月横行一下，多捞些油水，尽量把香积贷偿清，好歹能给孤女寡妇留下一处宅子。</strong></p>\n</blockquote>\n<h2 id=\"第二章\"><a href=\"#第二章\" class=\"headerlink\" title=\"第二章\"></a>第二章</h2><blockquote>\n<p><strong>一番铜臭交易之后，心中那点“昔我往矣”的淡淡离愁，也便没了踪影，倒省了很多苦情文章。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>听说百越民风彪悍，生翅者不食幞头，带腿者不食案几，余者无不可入口，果然没有夸张。</strong></p>\n</blockquote>\n<h2 id=\"第四章\"><a href=\"#第四章\" class=\"headerlink\" title=\"第四章\"></a>第四章</h2><blockquote>\n<p><strong>自己那二十多年的上林署监事，其实只窥到了朝廷的小小一角。这个坐落着诸多衙署的庞大皇城，比秦岭密林更加错综复杂，它运转的规律比道经更为玄妙。不熟悉的人贸然踏入，就像落入壶口瀑布下的奔腾乱流一样，撞得头破血流</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>做官之道，其实就三句话：和光同尘，好处均沾，花花轿子众人齐抬。一个人吃独食，是吃不长久的。</strong></p>\n</blockquote>\n<h1 id=\"《失落的卫星》\"><a href=\"#《失落的卫星》\" class=\"headerlink\" title=\"《失落的卫星》\"></a>《失落的卫星》</h1><p>看了刘子超的书才知道原来旅行文学这么有趣，并不是类似流水账之类的产物。<br>从作者文字中窥见了很多人情世故，带着我的思绪去了遥远的中亚。</p>\n<p><a href=\"https://book.douban.com/subject/35025453/\">失落的卫星</a></p>\n<h2 id=\"序幕-大巴扎、流放者和塔季扬娜\"><a href=\"#序幕-大巴扎、流放者和塔季扬娜\" class=\"headerlink\" title=\"序幕 大巴扎、流放者和塔季扬娜\"></a>序幕 大巴扎、流放者和塔季扬娜</h2><blockquote>\n<p><strong>哈萨克是俄国十月革命后才产生的概念。当时，苏联把西方的民族国家理论应用到中亚这片民族观念尚处于前现代状态的土地上。哈萨克斯坦，连同其他四个斯坦国一起，诞生于这样的背景下。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>1854年，陀思妥耶夫斯基被发配至哈萨克斯坦东部的塞米伊。他刚在西伯利亚的鄂木斯克服刑四年，因此即便是这样闭塞的边疆小镇，也令他欣喜。因为他终于可以摘掉镣铐，同时获准阅读《圣经》之外的书籍。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>中国的吉尔吉斯人叫作“柯尔克孜族”；李白据说生于碎叶城，就位于今天吉尔吉斯境内的托克马克。</strong></p>\n</blockquote>\n<h3 id=\"边城浮世绘\"><a href=\"#边城浮世绘\" class=\"headerlink\" title=\"边城浮世绘\"></a>边城浮世绘</h3><blockquote>\n<p><strong>“对我这代吉尔吉斯人来说，苏联就像史前时代，与我们无关。”阿拜说，“从父母那里，我听过不少苏联时代的故事，但却无法激起太多共鸣。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>不过，我可以告诉你，不要抨击绿色和平，更不要抨击LGBT——这是我的女友说的。她说，阿拜，如果你想获得诺贝尔文学奖，那你就不要抨击绿色和平，更不要抨击LGBT。”<br>“她确实聪明。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我始终觉得自己流淌着游牧民族的血液——不是草原游牧民族，而是当代游牧民族。这样的人总是不停移动，从世界的一个地方到另一个地方，缺乏归属感，家只不过是当下的落脚之处。对他们来说，旅行不是为了去任何地方，只是为了旅行。最重要的事情是移动。</strong></p>\n</blockquote>\n<h3 id=\"加加林疗养院\"><a href=\"#加加林疗养院\" class=\"headerlink\" title=\"加加林疗养院\"></a>加加林疗养院</h3><blockquote>\n<p><strong>所有人的餐食都是一样的——就像那些服务员脸上的表情——具有社会主义的一致性。</strong></p>\n</blockquote>\n<h3 id=\"杜尚别复调\"><a href=\"#杜尚别复调\" class=\"headerlink\" title=\"杜尚别复调\"></a>杜尚别复调</h3><blockquote>\n<p><strong>想借此赋予塔吉克人一点犹太民族在他们自己历史中找到的那种悲怆感。相比一个王朝的覆灭，文化根基的丧失更加悲惨。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>让人想到后来伊拉克人民推倒萨达姆的雕像。无事可做的男人们一脸仇恨，他们举着拳头，喊着口号，仿佛在进行一场游戏，只是没人相信这场游戏会有任何严重的后果。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>但我只是说，你还年轻，还没跨越那道“阴影线”——这是约瑟夫·康拉德说的，你感到烦闷、厌倦、不满、迷茫，这是生活中必将来临的那个时刻。</strong></p>\n</blockquote>\n<h3 id=\"从帕米尔公路到瓦罕山谷\"><a href=\"#从帕米尔公路到瓦罕山谷\" class=\"headerlink\" title=\"从帕米尔公路到瓦罕山谷\"></a>从帕米尔公路到瓦罕山谷</h3><blockquote>\n<p><strong>说这话时，司机的表情并没有任何不满，口气中甚至还带着几分理解。警察相信，凭他们的制服，索取是名正言顺的事。司机大概也这么认为。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我想起一路上经过的那些分界线：同样的民族，同样的生活方式，被分割开来，像刀子割开的伤口。</strong></p>\n</blockquote>\n<h3 id=\"不安的山谷\"><a href=\"#不安的山谷\" class=\"headerlink\" title=\"不安的山谷\"></a>不安的山谷</h3><blockquote>\n<p><strong>取消宗教、推行民族融合的苏联，宗教和族群的界限变得模糊不清，一种相对平静的关系维持了数十年。可是一旦这种体制濒临溃败，宗教势力和民族主义就会结合在一起，导致惨剧发生。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在《本地人的今与昔》一书中，纳利夫金总结了两个民族之间不太融洽的历史关系：乌兹别克人是定居民族，而吉尔吉斯人是游牧民族。乌兹别克人瞧不起吉尔吉斯人，而又惧怕他们的武力。乌兹别克人大都是农民、工匠、商人，而吉尔吉斯人喜欢在山间放牧，住在传统毡房里。他们不时劫掠乌兹别克人的马匹，只有当他们需要买东西时，才会下到乌兹别克人居住的绿洲城镇。这时，乌兹别克人就会大肆嘲笑吉尔吉斯人的愚昧无知，然后狠狠地敲他们一笔。</strong></p>\n</blockquote>\n<h3 id=\"通向撒马尔罕的金色之路\"><a href=\"#通向撒马尔罕的金色之路\" class=\"headerlink\" title=\"通向撒马尔罕的金色之路\"></a>通向撒马尔罕的金色之路</h3><blockquote>\n<p><strong>中国人的丝绸和瓷器传入这里，而粟特人则将制造玻璃和酿造葡萄酒的技艺传入中国。东西方的珠宝、首饰、钱币在这里荟聚，还有用骨头精心雕刻的下棋者。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>作为旅行者，我只是机械地从一个遗迹，移动到另一个遗迹，试图从每个遗迹中眺望到一点遥远时代的微暗火光。</strong></p>\n</blockquote>\n<p>以后每去一个博物馆都可以说成是自己在眺望<strong>遥远时代的微暗火光。</strong></p>\n<h3 id=\"布哈拉的博弈与离散\"><a href=\"#布哈拉的博弈与离散\" class=\"headerlink\" title=\"布哈拉的博弈与离散\"></a>布哈拉的博弈与离散</h3><blockquote>\n<p><strong>在这里，苏联纪念物是如此之多，而且便宜得惊人。谁又能想到它们曾是一代人的荣誉和骄傲？是那些人用生命加以守护的珍宝？</strong></p>\n</blockquote>\n<h3 id=\"困守咸海的人\"><a href=\"#困守咸海的人\" class=\"headerlink\" title=\"困守咸海的人\"></a>困守咸海的人</h3><blockquote>\n<p><strong>咸海王讲起他的治理之道。他时常对工人们说，来到这里，只有一个目的，那就是一门心思地挣钱。他禁止工人喝酒，但也知道，私下里人人都会喝。只要不闹出事来，就应该“睁一只眼闭一只眼”。他管这叫“中国人的智慧”。</strong></p>\n</blockquote>\n<h3 id=\"突厥斯坦的小人物\"><a href=\"#突厥斯坦的小人物\" class=\"headerlink\" title=\"突厥斯坦的小人物\"></a>突厥斯坦的小人物</h3><blockquote>\n<p><strong>随着阿拉伯人的征伐，造纸术由中亚传入西亚、北非和欧洲。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我留意了一下画作的时间——1954年。前一年，斯大林刚刚去世，苏联进入“解冻”时期。已经在塔拉兹待了十三年的布雷默，想必也感受到一丝春意——你甚至能在他的画笔中看到一种有意克制的轻松。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>他早有准备，说不定在家排练过。那张消瘦的胡茬脸，配合抑扬顿挫的口气，外加耸动的眉骨，活脱脱地展现了一个乌兹别克人的“交易的艺术”，体现了哈萨克人心目中“萨特人”的狡黠。我一时间钦佩不已，于是没再还价，就点头同意了。</strong></p>\n</blockquote>\n<p>作者笔下不少地区的中亚人都有这般特点，他们的这番特点也是经济水平和历史造成的。</p>\n<blockquote>\n<p><strong>帖木儿是一个被高估的英雄人物。他没有为帝国创造出一个生生不息的文化，只是留下一些建筑，供人凭吊而已。一旦他的个人意志退潮，帝国也就随之烂尾。这些建筑——无论是对于宗教，还是人民——意义都非常有限。</strong></p>\n</blockquote>\n<h3 id=\"草原核爆\"><a href=\"#草原核爆\" class=\"headerlink\" title=\"草原核爆\"></a>草原核爆</h3><blockquote>\n<p><strong>“你们的祖国是哪里？”“你用什么语言思考，你的祖国就是哪里。”“我们说俄语，可我们生活在哈萨克斯坦。”“我们不属于俄国，不属于哈萨克斯坦，更不属于朝鲜或韩国。”“我们是什么人？”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我沿着指引观看。每看完一部分，大妈就把那部分的照明关掉。虽说博物馆有政府补贴，也收门票，但看来还是资金紧张，不得不省钱度日。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>一旦国家的意志退潮，人们就会自然地用脚投票。科学家和军人带着家眷匆匆离开，短短数月内，查干人去楼空。</strong></p>\n</blockquote>\n<h3 id=\"七河之地\"><a href=\"#七河之地\" class=\"headerlink\" title=\"七河之地\"></a>七河之地</h3><blockquote>\n<p><strong>在广大的中亚乡村地带，我都目睹了类似情况：相比他们苏联出身的父母，独立后的年轻一代反而更加传统、保守。</strong></p>\n</blockquote>\n<h2 id=\"尾声-扎尔肯特：进步前哨站\"><a href=\"#尾声-扎尔肯特：进步前哨站\" class=\"headerlink\" title=\"尾声 扎尔肯特：进步前哨站\"></a>尾声 扎尔肯特：进步前哨站</h2><blockquote>\n<p><strong>苏俄治下的和平促进了中亚的繁荣，但也埋下分裂的种子。独立后，中亚开始对自己的历史和未来有了新的看法，不同的思潮与想法在这片土地上反复激荡。而今天，中国的崛起将会改变这里的引力，为中亚带来不同的前景。</strong></p>\n</blockquote>\n<p>结尾的爱国情怀反倒是有些突然，不过经过那么多天奔波回到祖国确实会有这番情感。</p>\n<h1 id=\"《午夜降临前抵达》\"><a href=\"#《午夜降临前抵达》\" class=\"headerlink\" title=\"《午夜降临前抵达》\"></a>《午夜降临前抵达》</h1><p>读的刘子超的第二本作品，书籍中的一句话我很是喜欢。“旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。”</p>\n<p><a href=\"https://book.douban.com/subject/35522033/\">午夜降临前抵达</a></p>\n<h3 id=\"第一章-疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\"><a href=\"#第一章-疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\" class=\"headerlink\" title=\"第一章 疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\"></a>第一章 疆界的消失，德累斯顿大轰炸，老布拉格的幽灵</h3><blockquote>\n<p><strong>不喜欢把每一段行程都安排得严丝合缝的旅行，没有即兴，没有随心所欲，没有突发奇想，旅行更像是一种苦行。</strong></p>\n</blockquote>\n<h3 id=\"第二章-火车情结，横穿波希米亚，死亡赋格\"><a href=\"#第二章-火车情结，横穿波希米亚，死亡赋格\" class=\"headerlink\" title=\"第二章 火车情结，横穿波希米亚，死亡赋格\"></a>第二章 火车情结，横穿波希米亚，死亡赋格</h3><blockquote>\n<p><strong>伯格说：“年轻人，这世上还有哪个国家比波兰更习惯与忧伤这种情感妥协共处呢？”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我感到一切战争、屠杀、罪行总会影响到之后的每一个人，无论哪一方，只是以各自不同的方式罢了。</strong></p>\n</blockquote>\n<h3 id=\"第三章-读艺术史的女孩，塔特拉山，猎人小屋\"><a href=\"#第三章-读艺术史的女孩，塔特拉山，猎人小屋\" class=\"headerlink\" title=\"第三章 读艺术史的女孩，塔特拉山，猎人小屋\"></a>第三章 读艺术史的女孩，塔特拉山，猎人小屋</h3><blockquote>\n<p><strong>除了酒吧和饭馆，其他公众场合禁止饮酒。一旦被警察发现，可能受到重罚。具体来说，惩戒的程度根据喝酒的多少而定。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>山在白天是一种壮美，到了夜晚却令人心悸。那种庞大而未知的存在，不分昼夜地永恒矗立，让我感到自己的渺小和脆弱。如果山愿意，它可以轻而易举地摧毁我，而我此刻还活着，不过依赖于它的垂怜。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。</strong></p>\n</blockquote>\n<h3 id=\"第四章-卫星城，沃利肖像，昨日的世界\"><a href=\"#第四章-卫星城，沃利肖像，昨日的世界\" class=\"headerlink\" title=\"第四章 卫星城，沃利肖像，昨日的世界\"></a>第四章 卫星城，沃利肖像，昨日的世界</h3><blockquote>\n<p><strong>因为放弃了发掘城市秘密的野心，反而获得了一种轻松自在的心理状态：无须再去看着地图，寻找那些著名景点；也无须为了找到当地人的秘密据点而犯愁；更不用因为自己对这座城市的无知而羞愧。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在维也纳，这类具有历史意义的每一幢房屋的拆除，就像从我们身上夺取了一部分灵魂。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>对于这家百年咖啡馆来说，一部好莱坞电影的意义显然算不上重大，它根本不屑把任何电影海报张贴出来。一切都尽量维持着1880年的原貌——那是哈布斯堡王朝最辉煌的时代。</strong></p>\n</blockquote>\n<h3 id=\"第五章-中国“倒爷”，骑行者俱乐部，土耳其浴室\"><a href=\"#第五章-中国“倒爷”，骑行者俱乐部，土耳其浴室\" class=\"headerlink\" title=\"第五章 中国“倒爷”，骑行者俱乐部，土耳其浴室\"></a>第五章 中国“倒爷”，骑行者俱乐部，土耳其浴室</h3><blockquote>\n<p><strong>风景缺少的只是赞美。<br>——切斯瓦夫·米沃什，《风景》</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>一个国家的年轻人如果都以拥有“公共层面”的身份为荣，那么这个国家无疑是充满希望的。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我相信过去不曾终结，它仍然在另一个维度上运行。通过旧房子、旧书、旧照片，我们得以窥视那个维度里的吉光片羽。</strong></p>\n</blockquote>\n<h3 id=\"第六章-挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\"><a href=\"#第六章-挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\" class=\"headerlink\" title=\"第六章 挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\"></a>第六章 挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声</h3><blockquote>\n<p><strong>多次和日本人相遇以后，我总结出了在国外分辨他们的三种方法：一、他们把sorry念成soli；二、他们人手一本日本大宝石出版社的《走遍全球》；三、或者说是一种天赋亦可，他们总能在鸟不拉屎的地方，找到极为正宗的日本料理。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>正如米兰·昆德拉所说，生长于一个小国有时候是一种优势。因为身处小国，要么做一个可怜的、眼光狭窄的人，要么成为一个广闻博识的“世界性的人”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>作为少数民族作家，他们不仅是在使用词语，他们是在运用整个存在，运用民族精神和神话，运用记忆、传统和文化来写作。对他们来说，语言就是命运——一个民族的命运。</strong></p>\n</blockquote>\n<h3 id=\"第一章-古树茶，故乡在塞尔维亚，撒旦的探戈\"><a href=\"#第一章-古树茶，故乡在塞尔维亚，撒旦的探戈\" class=\"headerlink\" title=\"第一章 古树茶，故乡在塞尔维亚，撒旦的探戈\"></a>第一章 古树茶，故乡在塞尔维亚，撒旦的探戈</h3><blockquote>\n<p><strong>对于那一代匈牙利人来说，迈克尔·杰克逊代表着对美国文化的想象，甚至是对“西方”的想象。因为铁幕粗暴地把“中欧”这一概念取消了，使匈牙利、东德、捷克斯洛伐克、波兰成了与美国和西欧对立的“东欧”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>拍摄一位匈牙利裔的塞尔维亚艺术家坐通勤火车过境。每次，他都在火车过境时进入洗手间，让同一泡尿液撒在两个国家的土地上。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>“在莫哈奇失去的远比现在多。”意思是说，最困难的时刻已经过去，以后再遇到的困难算得了什么？借此鼓起自己面对困难和挫折的勇气。</strong></p>\n</blockquote>\n<h3 id=\"第二章-物理老师的秘密往事，两个哑巴，赖奇克劳动营\"><a href=\"#第二章-物理老师的秘密往事，两个哑巴，赖奇克劳动营\" class=\"headerlink\" title=\"第二章 物理老师的秘密往事，两个哑巴，赖奇克劳动营\"></a>第二章 物理老师的秘密往事，两个哑巴，赖奇克劳动营</h3><blockquote>\n<p><strong>相比一个没人关心政治的社会，一个人人都热衷参与政治的社会，反而更可怕——只有极权时代才会出现这样的情况。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我喜欢火车站，因为它像一幕话剧的逼真布景，也是一座城市的风情写照。悲欢离合在这里上演，也在这里结束。在火车站，旅行者可以得到关于一座城市的全部想象。</strong></p>\n</blockquote>\n<h3 id=\"第三章-布尔诺之星，异乡人，冬之旅\"><a href=\"#第三章-布尔诺之星，异乡人，冬之旅\" class=\"headerlink\" title=\"第三章 布尔诺之星，异乡人，冬之旅\"></a>第三章 布尔诺之星，异乡人，冬之旅</h3><blockquote>\n<p><strong>当然，”玛丽亚笑了，“只是相处一段时间后发现，那种建立在共同生活基础上的固定关系并不是我想要的。”</strong></p>\n</blockquote>\n<h3 id=\"第四章-弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\"><a href=\"#第四章-弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\" class=\"headerlink\" title=\"第四章 弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\"></a>第四章 弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语</h3><blockquote>\n<p><strong>在旅游已经相当普遍的今天，“游客”（tourist）似乎已经变成一个格调不高的概念，暗含着浅薄、低俗之意。逼格更高的说法是“旅行者”（traveler）。因为“travel”一词，来自古老的拉丁语，与宗教朝圣中的苦行和精神升华有关。在古代，旅行的最初形态和唯一目的就是朝圣。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>政治和文学在语言和精神上迥然不同：“对我有益的对他们有害，适合他们的我却觉得难以消受。我们是两种泾渭分明的风格。”</strong></p>\n</blockquote>\n<h3 id=\"第五章-“舒伯特”号列车，帝国的切片，萨尔茨堡的雨\"><a href=\"#第五章-“舒伯特”号列车，帝国的切片，萨尔茨堡的雨\" class=\"headerlink\" title=\"第五章 “舒伯特”号列车，帝国的切片，萨尔茨堡的雨\"></a>第五章 “舒伯特”号列车，帝国的切片，萨尔茨堡的雨</h3><blockquote>\n<p><strong>大部分时间，我面对的是近乎荒凉的风景。如果说开车是一种思考形式，那么它更接近冥想，不要求思想过于集中，而是鼓励思绪自由飘荡</strong></p>\n</blockquote>\n<h3 id=\"第六章-流亡之地，黄金时代，最后的游荡\"><a href=\"#第六章-流亡之地，黄金时代，最后的游荡\" class=\"headerlink\" title=\"第六章 流亡之地，黄金时代，最后的游荡\"></a>第六章 流亡之地，黄金时代，最后的游荡</h3><blockquote>\n<p><strong>以至于我感到这些游荡在码头的人全都有一种审美上的自觉——他们出现在这里，并非有任何事情要做，而仅仅是出于美学的需要。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>工人和穷文人热爱的咖啡馆，已经中产阶级化。如果乔伊斯不幸晚生一百年，他很可能无力负担这里的消费。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>这个世界大概本就没有“黄金时代”。尤其是对于作家和艺术家，生活和伟大的作品之间，总存在某种“古老的敌意”。所谓“黄金时代”，只是胜利者事后的“怀乡”，只是对过去浪漫主义的怀想，只是一片树叶或者一粒止痛片，</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>而我出生在一个巨变中的国度，成长阶段所熟悉的一切都已物是人非。我不得不接受或大或小的变迁，并且乐于像幽灵一样在废墟间游荡。这片广袤的欧洲腹地——这本书写到的所有地方，为我这样的幽灵提供了游荡之所。我不时唏嘘于它们的变化，同时也试图发现那些被时光留下的永恒之物。</strong></p>\n</blockquote>\n<h3 id=\"后记-在旅行和写作中确认自我\"><a href=\"#后记-在旅行和写作中确认自我\" class=\"headerlink\" title=\"后记 在旅行和写作中确认自我\"></a>后记 在旅行和写作中确认自我</h3><blockquote>\n<p><strong>目的地旅行、阅读、寻找素材、日复一日地写作。它也教会了我对作家来说更重要的品质：保持耐心、享受孤独。</strong></p>\n</blockquote>\n<h1 id=\"《克拉拉与太阳》\"><a href=\"#《克拉拉与太阳》\" class=\"headerlink\" title=\"《克拉拉与太阳》\"></a>《克拉拉与太阳》</h1><p><a href=\"https://book.douban.com/subject/35315153/\">克拉拉与太阳</a></p>\n<p>因为豆瓣畅销书的光环就挑出时间看了，随着年岁增长我越来越不愿意读这些文学意义上的小说了。<br>这本书讲的确实是一个很与时俱进且新奇的故事，看完之后我也不禁思考人和所谓的人工智能的机器人在意识上区别究竟是什么。</p>\n<h2 id=\"第四部\"><a href=\"#第四部\" class=\"headerlink\" title=\"第四部\"></a>第四部</h2><blockquote>\n<p><strong>古往今来，一个世纪又一个世纪，人们彼此陪伴，共同生活，爱着彼此，恨着彼此，却全都是基于一个错误的假设。一种我们过去在懵懵懂懂之中一直固守的迷信。</strong></p>\n</blockquote>\n<h2 id=\"译后记\"><a href=\"#译后记\" class=\"headerlink\" title=\"译后记\"></a>译后记</h2><blockquote>\n<p><strong>正是由于自私的欲望与升华的渴望并存，人类的心中才会充满了矛盾、彷徨与痛苦；没有了自私那下坠的重力，一切崇高、向上的人性也就虚无缥缈得失去了分量。自私是人类沉重的负担，但也许在并不遥远的未来，也会是人之所以为人的一个最重要的锚点吧。</strong></p>\n</blockquote>\n<h1 id=\"《工作、消费主义和新穷人》\"><a href=\"#《工作、消费主义和新穷人》\" class=\"headerlink\" title=\"《工作、消费主义和新穷人》\"></a>《工作、消费主义和新穷人》</h1><p>在哔哩哔哩看到了对于这本书内容的分析，你可以直接批判它就是典型的白左思想书籍，但这本书还是很值得一读。</p>\n<p><a href=\"https://book.douban.com/subject/35593780/\">工作、消费主义和新穷人</a></p>\n<h3 id=\"要么工作，要么死亡\"><a href=\"#要么工作，要么死亡\" class=\"headerlink\" title=\"要么工作，要么死亡\"></a>要么工作，要么死亡</h3><blockquote>\n<p><strong>在“大量减少”穷人的过程中，工作伦理的贡献是无价的。毕竟，工作伦理主张：无论生活多么悲惨，只要它是由劳动报酬支撑的，就具有道德优越性。</strong></p>\n</blockquote>\n<h3 id=\"制造生产者\"><a href=\"#制造生产者\" class=\"headerlink\" title=\"制造生产者\"></a>制造生产者</h3><blockquote>\n<p><strong>除了那些由于世袭或暴富，可以自给自足悠然生活的人以外，“你是谁”这个问题的答案通常指向人们所在的公司以及该公司的能力。</strong></p>\n</blockquote>\n<h3 id=\"从“更好”到“更多”\"><a href=\"#从“更好”到“更多”\" class=\"headerlink\" title=\"从“更好”到“更多”\"></a>从“更好”到“更多”</h3><blockquote>\n<p><strong>工作伦理的宣讲力度与潜在劳动者因失去自由产生的抵制情绪成正比。宣讲的目的在于消除抵制。工作伦理是一种工具，目的是使工人们丧失独立性，服从于工厂制度。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>大多数美国社会历史学家都认为，推动美国工业前进的是企业精神和跻身上层阶级的愿望，而非工作伦理。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>工业社会是以权力冲突拉开序幕，那时的人们为自治和自由而斗争。时过境迁，现在他们只会为了获取更多盈余而斗争。人们默默接受了现存的权力结构，对这种结构的修正被排除在议程之外。越来越多的人认为，从工匠变成工人时失去的人的尊严，只有通过赢得更多盈余才能恢复。这种变迁中，努力工作能使人们道德升华的呼声日益衰弱。现在，衡量人们声望和社会地位的是工资的差别，而不是勤于工作的道德或惰于工作的罪恶。</strong></p>\n</blockquote>\n<h3 id=\"第二章-从工作伦理到消费美学\"><a href=\"#第二章-从工作伦理到消费美学\" class=\"headerlink\" title=\"第二章 从工作伦理到消费美学\"></a>第二章 从工作伦理到消费美学</h3><blockquote>\n<p><strong>之所以称之为“生产者社会”，是因为那时人们主要以生产者的身份参与其中。社会塑造其成员的方式由社会分工的需要决定，社会希望其成员有能力和意愿参与社会分工。在当前这个近现代（late-morden）、次现代（second-morden）或后现代（postmorden）阶段，社会主要要求人们以消费者的能力参与其中，首先依照“消费者”角色需要塑造其成员，并期望他们具有消费的能力和意愿。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>想要提高消费者的消费能力就不能让他们休息。他们需要不断地接受新的诱惑，持续处于永不枯竭的兴奋之中，持续处于怀疑和不满之中。诱使他们转移注意力的诱饵需要肯定这种怀疑，同时提供一个宣泄的出口：“你以为这就是全部？好戏还在后头呢！</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>正常运转的消费者社会中，消费者会主动寻求被诱惑。他们的生活从吸引到吸引，从诱惑到诱惑，从吞下一个诱饵到寻找另一个诱饵，每一个新的吸引、诱惑和诱饵都不尽相同，似乎比之前的更加诱人。他们生活于这种轮回，就像他们的先辈，那些生产者，生活于一个传送带和下一个传送带之间。</strong></p>\n</blockquote>\n<h3 id=\"制造消费者\"><a href=\"#制造消费者\" class=\"headerlink\" title=\"制造消费者\"></a>制造消费者</h3><blockquote>\n<p><strong>消费者社会中，与其说经济增长取决于“国家生产力”（即健康充裕的劳动力、充实的财政收入、勇往直前具有企业家精神的资本所有者和经营者），不如说取决于消费者的热情和活力。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>今天流行的口号是“灵活”，这个越来越时髦的概念代表的是一场几乎没有任何规则的雇佣和解雇游戏，而且在游戏进行时，单方面就可以随时更改规则。</strong></p>\n</blockquote>\n<h3 id=\"消费者社会的穷人\"><a href=\"#消费者社会的穷人\" class=\"headerlink\" title=\"消费者社会的穷人\"></a>消费者社会的穷人</h3><blockquote>\n<p><strong>杰里米·希布鲁克（Jeremy Seabrook）曾提醒过他的读者，当今社会依赖于“制造人为的、主观的不满足感”，因为本质上“人们满足于自己拥有的东西才是最可怕的威胁”。于是，人们真正拥有的东西被淡化，被贬低，被较富裕的人锋芒毕露的奢侈消费所掩盖：“富人成为被普遍崇拜的对象”。</strong></p>\n</blockquote>\n<h3 id=\"福利国家的衰败\"><a href=\"#福利国家的衰败\" class=\"headerlink\" title=\"福利国家的衰败\"></a>福利国家的衰败</h3><blockquote>\n<p><strong>这个星球上，部分地区已经充满老于世故的消费者，但也还存在广袤的处女地，那里有不需要激发消费欲望就能获得的顺从劳动力，那里的人为了维持生计而卑微地工作。但是，在本地市场，你需要源源不断地创造新的欲望，并保持雇员工资增长，以确保这些欲望能够变成普遍切实的需求。</strong></p>\n</blockquote>\n<h3 id=\"招致毁灭的成功\"><a href=\"#招致毁灭的成功\" class=\"headerlink\" title=\"招致毁灭的成功\"></a>招致毁灭的成功</h3><blockquote>\n<p><strong>获得社会帮助并脱离劣势地位的人，不仅失去了回馈的动力，而且变成了最强烈的诋毁者。从某种意义上说，“平权法案”培养的是自己的掘墓人</strong></p>\n</blockquote>\n<h3 id=\"第四章-工作伦理和新穷人\"><a href=\"#第四章-工作伦理和新穷人\" class=\"headerlink\" title=\"第四章 工作伦理和新穷人\"></a>第四章 工作伦理和新穷人</h3><blockquote>\n<p><strong>某国整体失业率快速上升时，你看不到证券市场有任何焦虑的迹象，更谈不上恐慌，它们反倒可能表现火爆。</strong></p>\n</blockquote>\n<h3 id=\"定居者与游牧者\"><a href=\"#定居者与游牧者\" class=\"headerlink\" title=\"定居者与游牧者\"></a>定居者与游牧者</h3><blockquote>\n<p>显然，最后一类人在出售劳动力时面临的困难最小，他们的潜在买家并不会特别挑剔。“常规劳动者”从事的工作既不需要难以掌握的稀有技能，也不需要面对面与顾客沟通所需的特殊机敏，因此他们可以比较容易地在所有有偿的低技能工作中切换。但出于同样的原因，他们也很容易被弃用，工作不稳定。他们随时可能被替换，这不会给雇主带来什么损失。他们可能在生意不景气时被就地解雇，因为业务回暖时有很多这样的人随时可以上岗。因此，他们没有找麻烦的气力，没有讨价还价的资本，即使有能力也愿意争取更好的就业条件，他们仍没有胜算的机会。</p>\n</blockquote>\n<blockquote>\n<p>这类人很少有抗争的意愿，特别是团结起来一致行动的意愿。所有的情况似乎都对他们不利。他们的工作是脆弱的，肯定不会持续很久，随时可能消失不见；今天的伙伴明天可能就各奔东西，去向遥远的地方……投身于工人的团结和集体抗争，需要付出长期的、充满风险的努力，注定收益不大，成本却高得难以计量。如果这样的状况持续很久，看不到任何改观，那些受雇者的世界观和心态也会相应变化。“</p>\n</blockquote>\n<blockquote>\n<p><strong>如果你喜欢为之工作的公司，并期望未来一直和它携手前行，那么最多在下一轮的“外包”或“裁员”时，你就会受到伤害。总而言之，这种被称为“劳动力市场灵活性”的重要转变，给长期协作的可能性蒙上了一层阴影，更不用说对“共同事业”全心全意、无条件的承诺和忠诚。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>求职者仍像以前一样“受缚于土地”，不能自由迁徙，只能依赖本地的工作谋生，资本现在则可以无拘无束地移动，不用在意距离和国界。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>资本完全没必要承受本地劳动力日益膨胀的自信（以及日益增长的要求）所带来的不便（和高昂的成本）。长期雇用导致这些定居劳动力越来越勇敢，并且有足够（过多）的时间变得更团结、更强大、更坚固。然而，当游牧资本想要转移到其他地方时，定居的劳动力根本就没有机会阻碍它转移，更不用说将其永久绑定，因此他们没有机会争取自己的权利，实现自己的抱负。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>无论从哪个方面看，脆弱性和不稳定性像幽灵一样萦绕在各种工作周围。不同工作的区别仅在于是否能有效防范雇员的反抗：以消极怠工、逃避责任来对抗雇佣关系的脆弱性。没有哪种工作能免除失业，也没有人可以免除近来出现的“长期失业”——这个词现在已经被更准确地描述为“过剩”。如果说“失业”，甚至是长期失业，意味着工作生活的一个阶段，那么“过剩”则更贴近如今失业的本质。它暗示了一场不可逆转的灾难最终到来。它是通向废品站的一张单程票……</strong></p>\n</blockquote>\n<h3 id=\"从“失业”到“过剩”\"><a href=\"#从“失业”到“过剩”\" class=\"headerlink\" title=\"从“失业”到“过剩”\"></a>从“失业”到“过剩”</h3><blockquote>\n<p><strong>随着经济周期的每一次轮回，“失业”这个概念的内涵发生了变化，“失业”之下的希望也越来越不切实际。这种体验无情地累加，推动了真正的“范式转变”产生——“过剩”这个新词，替代了“失业”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>如今的精简型、小型化、资本和知识密集型产业，则把劳动力视为生产力提升的制约要素。这是对曾被奉为经典的斯密_里卡多_马克思劳动价值论的直接挑战。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>近来重新鼓吹工作伦理的目的，是为了“将值得帮助的穷人和不值得帮助的穷人分开，把责难倾倒给后者，以合理化社会对他们的冷漠”，因此“说明贫穷是个人缺陷的必然后果，进而促成对穷人和被剥夺者的漠不关心”￼。换言之，工作伦理虽然不再是减少贫困的手段，却能帮助调和社会众生和永恒存在的穷人之间的关系，有助于整个社会的安宁平和。</strong></p>\n</blockquote>\n<h3 id=\"用于底层阶级的工作伦理\"><a href=\"#用于底层阶级的工作伦理\" class=\"headerlink\" title=\"用于底层阶级的工作伦理\"></a>用于底层阶级的工作伦理</h3><blockquote>\n<p><strong>正如堕入底层是一个选择问题，脱离贫困也是个选择问题——如果作出的是正确的选择。穷人沦为底层阶级是选择的结果，这个观点暗示的是，他们完全可以作出另一种选择，使自己从困境中解脱出来。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在社会日益富裕的过程中，如果贫困仍继续存在并持续扩大，那么工作伦理一定是无效的。但是，如果我们相信，工作伦理之所以无效只是因为其戒律没有得到很好的倾听和遵从，那么，就只能用那些掉队者的道德缺陷或犯罪倾向予以解释</strong></p>\n</blockquote>\n<h3 id=\"贫穷即犯罪\"><a href=\"#贫穷即犯罪\" class=\"headerlink\" title=\"贫穷即犯罪\"></a>贫穷即犯罪</h3><blockquote>\n<p><strong>底层阶级冒犯了大多数人珍视的价值观，却又紧紧抓着它们，渴望像其他自力更生的人一样，获得消费生活的乐趣。换句话说，美国人对底层阶级真正的不满意在于，这些人的梦想，他们渴望的生活模式居然和自己如此相似。</strong></p>\n</blockquote>\n<blockquote>\n<p>近年来的犯罪率上升，不是功能失调或疏忽大意的结果，而是消费者社会自身的产物，这在逻辑上（而非在法律上）是合理的。更重要的是，这也是消费者社会不可避免的产物。消费者需求越大（即市场诱导越有效），消费者社会就越安全，越繁荣。然而，与此同时，那些有欲望并能满足自己欲望的人（已经被诱惑并能按照诱惑的期望行动的人）与那些已经被诱惑却无法按照期望采取行动的人，两者之间的差距越拉越大。</p>\n</blockquote>\n<blockquote>\n<p>市场诱惑，既是伟大的均衡器，也是伟大的分化器。为了取得效果，消费的诱惑、消费更多的理念必须传达到每一个角落，不加区别地传达给每一个愿意聆听的人。然而，总是存在不能够按照诱惑的期望付诸行动的人，他们每天面对着那些获得满足的人展示的令人眼花缭乱的景象。这些人被告知，奢侈的消费是成功的标志，是赢得公众掌声和名誉的捷径。他们还了解到，拥有和消费某些商品，践行这种生活方式，是幸福的必要条件，甚至是实现人类尊严的必要条件。</p>\n</blockquote>\n<blockquote>\n<p><strong>如果消费是衡量成功人生的标准，衡量幸福的标准，甚至是衡量尊严的标准，那么人类欲望的潘多拉之盒已经打开，再多的购买和刺激的感觉，都不能唤回过去“达到标准”带来的满足感：现在根本就没有标准可言。</strong></p>\n</blockquote>\n<h3 id=\"逐出道德义务的世界\"><a href=\"#逐出道德义务的世界\" class=\"headerlink\" title=\"逐出道德义务的世界\"></a>逐出道德义务的世界</h3><blockquote>\n<p><strong>在“电视中”的人们死于饥荒和疾病的那片遥远土地上，也诞生了“亚洲小龙”——虽然所有“小龙”加起来也不及亚洲人口的百分之一。它们传达了想要传达的：饥荒和无家可归是他们自己的选择。其他选项是存在的，然而他们缺乏勤奋和决心。字里行间的意思是，穷人应该对自己的命运负责。他们可以像“亚洲小龙”一样，选择勤奋节俭的生活。</strong></p>\n</blockquote>\n<h3 id=\"殖民主义，还是剩余劳动力输出\"><a href=\"#殖民主义，还是剩余劳动力输出\" class=\"headerlink\" title=\"殖民主义，还是剩余劳动力输出\"></a>殖民主义，还是剩余劳动力输出</h3><blockquote>\n<p><strong>从一开始，现代就是大迁徙的时代。至今为止，不计其数的人远渡重洋，离开无法生存的故土，去往满载憧憬的异国他乡。随着时间的推移，现代化的热门区域不断变化，热门的线路也不断变化，但总体来说，移民都是从世界上“较发达”（现代化程度较高）的地区向“不发达”（在现代化冲击下还未舍弃其传统的社会经济平衡）的地区流动。</strong></p>\n</blockquote>\n<h3 id=\"工作和贫穷问题的全球化新维度\"><a href=\"#工作和贫穷问题的全球化新维度\" class=\"headerlink\" title=\"工作和贫穷问题的全球化新维度\"></a>工作和贫穷问题的全球化新维度</h3><blockquote>\n<p><strong>远方的人遭受苦难直接或间接的源头，或许正是我们此时此地的所作所为，但由于距离遥远，它们并不会引起道德上的共鸣，也不会像身边所见的苦难那样能够引发强烈的行动意愿。</strong></p>\n</blockquote>\n<h3 id=\"社会问题转为法律和秩序问题\"><a href=\"#社会问题转为法律和秩序问题\" class=\"headerlink\" title=\"社会问题转为法律和秩序问题\"></a>社会问题转为法律和秩序问题</h3><blockquote>\n<p><strong>“无用之人”大规模聚集并迅速膨胀，看上去会变成持续的、永久的存在。这要求采取更严格的隔离政策和极端的安全措施，以免危及“社会的健康”以及社会系统的“正常运转”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>可以说，监狱是把穷人和失业者（更准确地说，无法就业的人）从“社会问题”范畴转移到法律秩序范畴的过程中采用的手段，是消除他们对于整个社会潜在的破坏性影响的投资。</strong></p>\n</blockquote>\n<h3 id=\"从社会国家到“安全国家”\"><a href=\"#从社会国家到“安全国家”\" class=\"headerlink\" title=\"从社会国家到“安全国家”\"></a>从社会国家到“安全国家”</h3><blockquote>\n<p><strong>市场竞争造成的就业环境不稳定，是且将继续是人们对于未来不确定性、对于社会地位和自尊的不安全感的主要根源。</strong></p>\n</blockquote>\n<h2 id=\"第三部分\"><a href=\"#第三部分\" class=\"headerlink\" title=\"第三部分\"></a>第三部分</h2><h3 id=\"第六章-新穷人的前景\"><a href=\"#第六章-新穷人的前景\" class=\"headerlink\" title=\"第六章 新穷人的前景\"></a>第六章 新穷人的前景</h3><blockquote>\n<p><strong>渴望把人类世界变成一个无机的世界，在那里一切都完美运行，按部就班，服从于一个超越个体的系统。然而，向往秩序就是向往死亡，因为生命本身就是不断破坏秩序的过程。或者换句话说：对秩序的渴望是一种堂皇的托辞，是强烈厌世的借口。</strong></p>\n</blockquote>\n<h3 id=\"失去位置的穷人\"><a href=\"#失去位置的穷人\" class=\"headerlink\" title=\"失去位置的穷人\"></a>失去位置的穷人</h3><blockquote>\n<p><strong>学识渊博的经济学家忙不迭地立即证明，当工资保持在低水平的时候，“穷人会做更多的工作，实际上生活得更好”，而他们领取高工资时，他们就迷失于无所事事和聚众闹事。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>想符合社会规范，成为一个合格的社会成员，就需要对消费市场的诱惑作出及时有效的反应，需要为“清空供给”作出贡献，需要在经济环境出现问题时，积极参与“消费者主导的复苏”。穷人没有体面的收入，没有信用卡和美好前景，他们达不到要求。今天穷人打破的社会规范——使他们“不正常”的规范，是消费能力规范而非就业规范。今天的穷人是“不消费的人”，而非“失业者”。他们首先被定义为有缺陷的消费者，因为他们没有履行最重要的社会责任——积极有效地购买市场提供的商品和服务。消费者社会的资产负债表中，穷人明显是负债，无论如何也不能把他们记入现在或未来的资产。</strong></p>\n</blockquote>\n<h3 id=\"没有位置，没有道德义务\"><a href=\"#没有位置，没有道德义务\" class=\"headerlink\" title=\"没有位置，没有道德义务\"></a>没有位置，没有道德义务</h3><blockquote>\n<p><strong>如果穷人试图捍卫福利体系的残存，他们很快就会发现自己没有谈判的筹码，无法传达自己的声音，更不可能给对手造成威胁。他们尤其没有任何能力来打动社会上的普通公民，大众受到了政客的蛊惑，他们被劝说不要因为内心的冲动投票，而要根据自己的利益投票。</strong></p>\n</blockquote>\n<h3 id=\"工作伦理，还是生活道德\"><a href=\"#工作伦理，还是生活道德\" class=\"headerlink\" title=\"工作伦理，还是生活道德\"></a>工作伦理，还是生活道德</h3><blockquote>\n<p>收入权利与收入能力脱钩的想法其实并不保守。根据我们的推论，实现它恰恰需要一个非常大的转变。我们将不得不放弃目前生活模式中一些神圣不可侵犯的假设（由于缺少反思，它们显得更加神圣）。例如，效率是一件好事，无论它目的何在，也无论它是否会带来痛苦的副作用。再例如，凡是“经济增长”的东西，即统计意义上“今天比昨天多，明天比今天多”的东西，就是好的，而无视其增长过程中对人类生存环境和自然（全人类共享的生存环境）造成的损害。</p>\n</blockquote>\n<blockquote>\n<p>对那些因为需要作出巨大的转变而反对的人，我们只能再次引用科尼利厄斯的话来回答。当一个采访者问他：“那么，你想要什么？改变人类吗？”，卡斯托利亚蒂斯回答说：“不，没有那么夸张：我希望人类改变，正像他们已经改变过两三次那样。”[8]<br>至少现在还有希望，人类能够再次完成同样的壮举。毕竟，正如帕特里克·库里（Patrick Curry）所言，“群体自愿的返璞归真，正成为群体贫困的唯一有意义的替代。</p>\n</blockquote>\n<p>并不认同这样的观点。</p>\n","site":{"data":{}},"excerpt":"<p>继上个月分享了一些读书摘录之后这个月也没闲着，一共读了五本书。</p>\n<ul>\n<li>《长安的荔枝》</li>\n<li>《失落的卫星》</li>\n<li>《午夜降临前抵达》</li>\n<li>《克拉拉与太阳》</li>\n<li>《工作、消费主义和新穷人》</li>\n</ul>","more":"<h1 id=\"《长安的荔枝》\"><a href=\"#《长安的荔枝》\" class=\"headerlink\" title=\"《长安的荔枝》\"></a>《长安的荔枝》</h1><p><a href=\"https://movie.douban.com/subject/35651341/\">长安的荔枝</a></p>\n<p>取材于“一骑红尘妃子笑，无人知是荔枝来”，马伯庸讲故事的能力确实令人惊叹，也很是期待同名的电影作品。</p>\n<h2 id=\"第一章\"><a href=\"#第一章\" class=\"headerlink\" title=\"第一章\"></a>第一章</h2><blockquote>\n<p><strong>唯有早点跟妻子和离，一别两宽，将来事发才不会累及家人。李善德可以趁这最后四个月横行一下，多捞些油水，尽量把香积贷偿清，好歹能给孤女寡妇留下一处宅子。</strong></p>\n</blockquote>\n<h2 id=\"第二章\"><a href=\"#第二章\" class=\"headerlink\" title=\"第二章\"></a>第二章</h2><blockquote>\n<p><strong>一番铜臭交易之后，心中那点“昔我往矣”的淡淡离愁，也便没了踪影，倒省了很多苦情文章。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>听说百越民风彪悍，生翅者不食幞头，带腿者不食案几，余者无不可入口，果然没有夸张。</strong></p>\n</blockquote>\n<h2 id=\"第四章\"><a href=\"#第四章\" class=\"headerlink\" title=\"第四章\"></a>第四章</h2><blockquote>\n<p><strong>自己那二十多年的上林署监事，其实只窥到了朝廷的小小一角。这个坐落着诸多衙署的庞大皇城，比秦岭密林更加错综复杂，它运转的规律比道经更为玄妙。不熟悉的人贸然踏入，就像落入壶口瀑布下的奔腾乱流一样，撞得头破血流</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>做官之道，其实就三句话：和光同尘，好处均沾，花花轿子众人齐抬。一个人吃独食，是吃不长久的。</strong></p>\n</blockquote>\n<h1 id=\"《失落的卫星》\"><a href=\"#《失落的卫星》\" class=\"headerlink\" title=\"《失落的卫星》\"></a>《失落的卫星》</h1><p>看了刘子超的书才知道原来旅行文学这么有趣，并不是类似流水账之类的产物。<br>从作者文字中窥见了很多人情世故，带着我的思绪去了遥远的中亚。</p>\n<p><a href=\"https://book.douban.com/subject/35025453/\">失落的卫星</a></p>\n<h2 id=\"序幕-大巴扎、流放者和塔季扬娜\"><a href=\"#序幕-大巴扎、流放者和塔季扬娜\" class=\"headerlink\" title=\"序幕 大巴扎、流放者和塔季扬娜\"></a>序幕 大巴扎、流放者和塔季扬娜</h2><blockquote>\n<p><strong>哈萨克是俄国十月革命后才产生的概念。当时，苏联把西方的民族国家理论应用到中亚这片民族观念尚处于前现代状态的土地上。哈萨克斯坦，连同其他四个斯坦国一起，诞生于这样的背景下。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>1854年，陀思妥耶夫斯基被发配至哈萨克斯坦东部的塞米伊。他刚在西伯利亚的鄂木斯克服刑四年，因此即便是这样闭塞的边疆小镇，也令他欣喜。因为他终于可以摘掉镣铐，同时获准阅读《圣经》之外的书籍。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>中国的吉尔吉斯人叫作“柯尔克孜族”；李白据说生于碎叶城，就位于今天吉尔吉斯境内的托克马克。</strong></p>\n</blockquote>\n<h3 id=\"边城浮世绘\"><a href=\"#边城浮世绘\" class=\"headerlink\" title=\"边城浮世绘\"></a>边城浮世绘</h3><blockquote>\n<p><strong>“对我这代吉尔吉斯人来说，苏联就像史前时代，与我们无关。”阿拜说，“从父母那里，我听过不少苏联时代的故事，但却无法激起太多共鸣。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>不过，我可以告诉你，不要抨击绿色和平，更不要抨击LGBT——这是我的女友说的。她说，阿拜，如果你想获得诺贝尔文学奖，那你就不要抨击绿色和平，更不要抨击LGBT。”<br>“她确实聪明。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我始终觉得自己流淌着游牧民族的血液——不是草原游牧民族，而是当代游牧民族。这样的人总是不停移动，从世界的一个地方到另一个地方，缺乏归属感，家只不过是当下的落脚之处。对他们来说，旅行不是为了去任何地方，只是为了旅行。最重要的事情是移动。</strong></p>\n</blockquote>\n<h3 id=\"加加林疗养院\"><a href=\"#加加林疗养院\" class=\"headerlink\" title=\"加加林疗养院\"></a>加加林疗养院</h3><blockquote>\n<p><strong>所有人的餐食都是一样的——就像那些服务员脸上的表情——具有社会主义的一致性。</strong></p>\n</blockquote>\n<h3 id=\"杜尚别复调\"><a href=\"#杜尚别复调\" class=\"headerlink\" title=\"杜尚别复调\"></a>杜尚别复调</h3><blockquote>\n<p><strong>想借此赋予塔吉克人一点犹太民族在他们自己历史中找到的那种悲怆感。相比一个王朝的覆灭，文化根基的丧失更加悲惨。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>让人想到后来伊拉克人民推倒萨达姆的雕像。无事可做的男人们一脸仇恨，他们举着拳头，喊着口号，仿佛在进行一场游戏，只是没人相信这场游戏会有任何严重的后果。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>但我只是说，你还年轻，还没跨越那道“阴影线”——这是约瑟夫·康拉德说的，你感到烦闷、厌倦、不满、迷茫，这是生活中必将来临的那个时刻。</strong></p>\n</blockquote>\n<h3 id=\"从帕米尔公路到瓦罕山谷\"><a href=\"#从帕米尔公路到瓦罕山谷\" class=\"headerlink\" title=\"从帕米尔公路到瓦罕山谷\"></a>从帕米尔公路到瓦罕山谷</h3><blockquote>\n<p><strong>说这话时，司机的表情并没有任何不满，口气中甚至还带着几分理解。警察相信，凭他们的制服，索取是名正言顺的事。司机大概也这么认为。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我想起一路上经过的那些分界线：同样的民族，同样的生活方式，被分割开来，像刀子割开的伤口。</strong></p>\n</blockquote>\n<h3 id=\"不安的山谷\"><a href=\"#不安的山谷\" class=\"headerlink\" title=\"不安的山谷\"></a>不安的山谷</h3><blockquote>\n<p><strong>取消宗教、推行民族融合的苏联，宗教和族群的界限变得模糊不清，一种相对平静的关系维持了数十年。可是一旦这种体制濒临溃败，宗教势力和民族主义就会结合在一起，导致惨剧发生。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在《本地人的今与昔》一书中，纳利夫金总结了两个民族之间不太融洽的历史关系：乌兹别克人是定居民族，而吉尔吉斯人是游牧民族。乌兹别克人瞧不起吉尔吉斯人，而又惧怕他们的武力。乌兹别克人大都是农民、工匠、商人，而吉尔吉斯人喜欢在山间放牧，住在传统毡房里。他们不时劫掠乌兹别克人的马匹，只有当他们需要买东西时，才会下到乌兹别克人居住的绿洲城镇。这时，乌兹别克人就会大肆嘲笑吉尔吉斯人的愚昧无知，然后狠狠地敲他们一笔。</strong></p>\n</blockquote>\n<h3 id=\"通向撒马尔罕的金色之路\"><a href=\"#通向撒马尔罕的金色之路\" class=\"headerlink\" title=\"通向撒马尔罕的金色之路\"></a>通向撒马尔罕的金色之路</h3><blockquote>\n<p><strong>中国人的丝绸和瓷器传入这里，而粟特人则将制造玻璃和酿造葡萄酒的技艺传入中国。东西方的珠宝、首饰、钱币在这里荟聚，还有用骨头精心雕刻的下棋者。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>作为旅行者，我只是机械地从一个遗迹，移动到另一个遗迹，试图从每个遗迹中眺望到一点遥远时代的微暗火光。</strong></p>\n</blockquote>\n<p>以后每去一个博物馆都可以说成是自己在眺望<strong>遥远时代的微暗火光。</strong></p>\n<h3 id=\"布哈拉的博弈与离散\"><a href=\"#布哈拉的博弈与离散\" class=\"headerlink\" title=\"布哈拉的博弈与离散\"></a>布哈拉的博弈与离散</h3><blockquote>\n<p><strong>在这里，苏联纪念物是如此之多，而且便宜得惊人。谁又能想到它们曾是一代人的荣誉和骄傲？是那些人用生命加以守护的珍宝？</strong></p>\n</blockquote>\n<h3 id=\"困守咸海的人\"><a href=\"#困守咸海的人\" class=\"headerlink\" title=\"困守咸海的人\"></a>困守咸海的人</h3><blockquote>\n<p><strong>咸海王讲起他的治理之道。他时常对工人们说，来到这里，只有一个目的，那就是一门心思地挣钱。他禁止工人喝酒，但也知道，私下里人人都会喝。只要不闹出事来，就应该“睁一只眼闭一只眼”。他管这叫“中国人的智慧”。</strong></p>\n</blockquote>\n<h3 id=\"突厥斯坦的小人物\"><a href=\"#突厥斯坦的小人物\" class=\"headerlink\" title=\"突厥斯坦的小人物\"></a>突厥斯坦的小人物</h3><blockquote>\n<p><strong>随着阿拉伯人的征伐，造纸术由中亚传入西亚、北非和欧洲。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我留意了一下画作的时间——1954年。前一年，斯大林刚刚去世，苏联进入“解冻”时期。已经在塔拉兹待了十三年的布雷默，想必也感受到一丝春意——你甚至能在他的画笔中看到一种有意克制的轻松。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>他早有准备，说不定在家排练过。那张消瘦的胡茬脸，配合抑扬顿挫的口气，外加耸动的眉骨，活脱脱地展现了一个乌兹别克人的“交易的艺术”，体现了哈萨克人心目中“萨特人”的狡黠。我一时间钦佩不已，于是没再还价，就点头同意了。</strong></p>\n</blockquote>\n<p>作者笔下不少地区的中亚人都有这般特点，他们的这番特点也是经济水平和历史造成的。</p>\n<blockquote>\n<p><strong>帖木儿是一个被高估的英雄人物。他没有为帝国创造出一个生生不息的文化，只是留下一些建筑，供人凭吊而已。一旦他的个人意志退潮，帝国也就随之烂尾。这些建筑——无论是对于宗教，还是人民——意义都非常有限。</strong></p>\n</blockquote>\n<h3 id=\"草原核爆\"><a href=\"#草原核爆\" class=\"headerlink\" title=\"草原核爆\"></a>草原核爆</h3><blockquote>\n<p><strong>“你们的祖国是哪里？”“你用什么语言思考，你的祖国就是哪里。”“我们说俄语，可我们生活在哈萨克斯坦。”“我们不属于俄国，不属于哈萨克斯坦，更不属于朝鲜或韩国。”“我们是什么人？”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我沿着指引观看。每看完一部分，大妈就把那部分的照明关掉。虽说博物馆有政府补贴，也收门票，但看来还是资金紧张，不得不省钱度日。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>一旦国家的意志退潮，人们就会自然地用脚投票。科学家和军人带着家眷匆匆离开，短短数月内，查干人去楼空。</strong></p>\n</blockquote>\n<h3 id=\"七河之地\"><a href=\"#七河之地\" class=\"headerlink\" title=\"七河之地\"></a>七河之地</h3><blockquote>\n<p><strong>在广大的中亚乡村地带，我都目睹了类似情况：相比他们苏联出身的父母，独立后的年轻一代反而更加传统、保守。</strong></p>\n</blockquote>\n<h2 id=\"尾声-扎尔肯特：进步前哨站\"><a href=\"#尾声-扎尔肯特：进步前哨站\" class=\"headerlink\" title=\"尾声 扎尔肯特：进步前哨站\"></a>尾声 扎尔肯特：进步前哨站</h2><blockquote>\n<p><strong>苏俄治下的和平促进了中亚的繁荣，但也埋下分裂的种子。独立后，中亚开始对自己的历史和未来有了新的看法，不同的思潮与想法在这片土地上反复激荡。而今天，中国的崛起将会改变这里的引力，为中亚带来不同的前景。</strong></p>\n</blockquote>\n<p>结尾的爱国情怀反倒是有些突然，不过经过那么多天奔波回到祖国确实会有这番情感。</p>\n<h1 id=\"《午夜降临前抵达》\"><a href=\"#《午夜降临前抵达》\" class=\"headerlink\" title=\"《午夜降临前抵达》\"></a>《午夜降临前抵达》</h1><p>读的刘子超的第二本作品，书籍中的一句话我很是喜欢。“旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。”</p>\n<p><a href=\"https://book.douban.com/subject/35522033/\">午夜降临前抵达</a></p>\n<h3 id=\"第一章-疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\"><a href=\"#第一章-疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\" class=\"headerlink\" title=\"第一章 疆界的消失，德累斯顿大轰炸，老布拉格的幽灵\"></a>第一章 疆界的消失，德累斯顿大轰炸，老布拉格的幽灵</h3><blockquote>\n<p><strong>不喜欢把每一段行程都安排得严丝合缝的旅行，没有即兴，没有随心所欲，没有突发奇想，旅行更像是一种苦行。</strong></p>\n</blockquote>\n<h3 id=\"第二章-火车情结，横穿波希米亚，死亡赋格\"><a href=\"#第二章-火车情结，横穿波希米亚，死亡赋格\" class=\"headerlink\" title=\"第二章 火车情结，横穿波希米亚，死亡赋格\"></a>第二章 火车情结，横穿波希米亚，死亡赋格</h3><blockquote>\n<p><strong>伯格说：“年轻人，这世上还有哪个国家比波兰更习惯与忧伤这种情感妥协共处呢？”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我感到一切战争、屠杀、罪行总会影响到之后的每一个人，无论哪一方，只是以各自不同的方式罢了。</strong></p>\n</blockquote>\n<h3 id=\"第三章-读艺术史的女孩，塔特拉山，猎人小屋\"><a href=\"#第三章-读艺术史的女孩，塔特拉山，猎人小屋\" class=\"headerlink\" title=\"第三章 读艺术史的女孩，塔特拉山，猎人小屋\"></a>第三章 读艺术史的女孩，塔特拉山，猎人小屋</h3><blockquote>\n<p><strong>除了酒吧和饭馆，其他公众场合禁止饮酒。一旦被警察发现，可能受到重罚。具体来说，惩戒的程度根据喝酒的多少而定。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>山在白天是一种壮美，到了夜晚却令人心悸。那种庞大而未知的存在，不分昼夜地永恒矗立，让我感到自己的渺小和脆弱。如果山愿意，它可以轻而易举地摧毁我，而我此刻还活着，不过依赖于它的垂怜。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>旅行中的相遇，就如同空中交汇的流星，短暂的火花过后，依然是两块丑陋的陨石。我们期待旅途中的相遇，但相遇也注定了分离。</strong></p>\n</blockquote>\n<h3 id=\"第四章-卫星城，沃利肖像，昨日的世界\"><a href=\"#第四章-卫星城，沃利肖像，昨日的世界\" class=\"headerlink\" title=\"第四章 卫星城，沃利肖像，昨日的世界\"></a>第四章 卫星城，沃利肖像，昨日的世界</h3><blockquote>\n<p><strong>因为放弃了发掘城市秘密的野心，反而获得了一种轻松自在的心理状态：无须再去看着地图，寻找那些著名景点；也无须为了找到当地人的秘密据点而犯愁；更不用因为自己对这座城市的无知而羞愧。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在维也纳，这类具有历史意义的每一幢房屋的拆除，就像从我们身上夺取了一部分灵魂。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>对于这家百年咖啡馆来说，一部好莱坞电影的意义显然算不上重大，它根本不屑把任何电影海报张贴出来。一切都尽量维持着1880年的原貌——那是哈布斯堡王朝最辉煌的时代。</strong></p>\n</blockquote>\n<h3 id=\"第五章-中国“倒爷”，骑行者俱乐部，土耳其浴室\"><a href=\"#第五章-中国“倒爷”，骑行者俱乐部，土耳其浴室\" class=\"headerlink\" title=\"第五章 中国“倒爷”，骑行者俱乐部，土耳其浴室\"></a>第五章 中国“倒爷”，骑行者俱乐部，土耳其浴室</h3><blockquote>\n<p><strong>风景缺少的只是赞美。<br>——切斯瓦夫·米沃什，《风景》</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>一个国家的年轻人如果都以拥有“公共层面”的身份为荣，那么这个国家无疑是充满希望的。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我相信过去不曾终结，它仍然在另一个维度上运行。通过旧房子、旧书、旧照片，我们得以窥视那个维度里的吉光片羽。</strong></p>\n</blockquote>\n<h3 id=\"第六章-挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\"><a href=\"#第六章-挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\" class=\"headerlink\" title=\"第六章 挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声\"></a>第六章 挥之不去的饥饿感，分裂的南斯拉夫，湖底的钟声</h3><blockquote>\n<p><strong>多次和日本人相遇以后，我总结出了在国外分辨他们的三种方法：一、他们把sorry念成soli；二、他们人手一本日本大宝石出版社的《走遍全球》；三、或者说是一种天赋亦可，他们总能在鸟不拉屎的地方，找到极为正宗的日本料理。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>正如米兰·昆德拉所说，生长于一个小国有时候是一种优势。因为身处小国，要么做一个可怜的、眼光狭窄的人，要么成为一个广闻博识的“世界性的人”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>作为少数民族作家，他们不仅是在使用词语，他们是在运用整个存在，运用民族精神和神话，运用记忆、传统和文化来写作。对他们来说，语言就是命运——一个民族的命运。</strong></p>\n</blockquote>\n<h3 id=\"第一章-古树茶，故乡在塞尔维亚，撒旦的探戈\"><a href=\"#第一章-古树茶，故乡在塞尔维亚，撒旦的探戈\" class=\"headerlink\" title=\"第一章 古树茶，故乡在塞尔维亚，撒旦的探戈\"></a>第一章 古树茶，故乡在塞尔维亚，撒旦的探戈</h3><blockquote>\n<p><strong>对于那一代匈牙利人来说，迈克尔·杰克逊代表着对美国文化的想象，甚至是对“西方”的想象。因为铁幕粗暴地把“中欧”这一概念取消了，使匈牙利、东德、捷克斯洛伐克、波兰成了与美国和西欧对立的“东欧”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>拍摄一位匈牙利裔的塞尔维亚艺术家坐通勤火车过境。每次，他都在火车过境时进入洗手间，让同一泡尿液撒在两个国家的土地上。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>“在莫哈奇失去的远比现在多。”意思是说，最困难的时刻已经过去，以后再遇到的困难算得了什么？借此鼓起自己面对困难和挫折的勇气。</strong></p>\n</blockquote>\n<h3 id=\"第二章-物理老师的秘密往事，两个哑巴，赖奇克劳动营\"><a href=\"#第二章-物理老师的秘密往事，两个哑巴，赖奇克劳动营\" class=\"headerlink\" title=\"第二章 物理老师的秘密往事，两个哑巴，赖奇克劳动营\"></a>第二章 物理老师的秘密往事，两个哑巴，赖奇克劳动营</h3><blockquote>\n<p><strong>相比一个没人关心政治的社会，一个人人都热衷参与政治的社会，反而更可怕——只有极权时代才会出现这样的情况。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>我喜欢火车站，因为它像一幕话剧的逼真布景，也是一座城市的风情写照。悲欢离合在这里上演，也在这里结束。在火车站，旅行者可以得到关于一座城市的全部想象。</strong></p>\n</blockquote>\n<h3 id=\"第三章-布尔诺之星，异乡人，冬之旅\"><a href=\"#第三章-布尔诺之星，异乡人，冬之旅\" class=\"headerlink\" title=\"第三章 布尔诺之星，异乡人，冬之旅\"></a>第三章 布尔诺之星，异乡人，冬之旅</h3><blockquote>\n<p><strong>当然，”玛丽亚笑了，“只是相处一段时间后发现，那种建立在共同生活基础上的固定关系并不是我想要的。”</strong></p>\n</blockquote>\n<h3 id=\"第四章-弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\"><a href=\"#第四章-弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\" class=\"headerlink\" title=\"第四章 弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语\"></a>第四章 弗罗茨瓦夫与平行世界，叶子和臭鼬，一场风暴的结语</h3><blockquote>\n<p><strong>在旅游已经相当普遍的今天，“游客”（tourist）似乎已经变成一个格调不高的概念，暗含着浅薄、低俗之意。逼格更高的说法是“旅行者”（traveler）。因为“travel”一词，来自古老的拉丁语，与宗教朝圣中的苦行和精神升华有关。在古代，旅行的最初形态和唯一目的就是朝圣。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>政治和文学在语言和精神上迥然不同：“对我有益的对他们有害，适合他们的我却觉得难以消受。我们是两种泾渭分明的风格。”</strong></p>\n</blockquote>\n<h3 id=\"第五章-“舒伯特”号列车，帝国的切片，萨尔茨堡的雨\"><a href=\"#第五章-“舒伯特”号列车，帝国的切片，萨尔茨堡的雨\" class=\"headerlink\" title=\"第五章 “舒伯特”号列车，帝国的切片，萨尔茨堡的雨\"></a>第五章 “舒伯特”号列车，帝国的切片，萨尔茨堡的雨</h3><blockquote>\n<p><strong>大部分时间，我面对的是近乎荒凉的风景。如果说开车是一种思考形式，那么它更接近冥想，不要求思想过于集中，而是鼓励思绪自由飘荡</strong></p>\n</blockquote>\n<h3 id=\"第六章-流亡之地，黄金时代，最后的游荡\"><a href=\"#第六章-流亡之地，黄金时代，最后的游荡\" class=\"headerlink\" title=\"第六章 流亡之地，黄金时代，最后的游荡\"></a>第六章 流亡之地，黄金时代，最后的游荡</h3><blockquote>\n<p><strong>以至于我感到这些游荡在码头的人全都有一种审美上的自觉——他们出现在这里，并非有任何事情要做，而仅仅是出于美学的需要。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>工人和穷文人热爱的咖啡馆，已经中产阶级化。如果乔伊斯不幸晚生一百年，他很可能无力负担这里的消费。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>这个世界大概本就没有“黄金时代”。尤其是对于作家和艺术家，生活和伟大的作品之间，总存在某种“古老的敌意”。所谓“黄金时代”，只是胜利者事后的“怀乡”，只是对过去浪漫主义的怀想，只是一片树叶或者一粒止痛片，</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>而我出生在一个巨变中的国度，成长阶段所熟悉的一切都已物是人非。我不得不接受或大或小的变迁，并且乐于像幽灵一样在废墟间游荡。这片广袤的欧洲腹地——这本书写到的所有地方，为我这样的幽灵提供了游荡之所。我不时唏嘘于它们的变化，同时也试图发现那些被时光留下的永恒之物。</strong></p>\n</blockquote>\n<h3 id=\"后记-在旅行和写作中确认自我\"><a href=\"#后记-在旅行和写作中确认自我\" class=\"headerlink\" title=\"后记 在旅行和写作中确认自我\"></a>后记 在旅行和写作中确认自我</h3><blockquote>\n<p><strong>目的地旅行、阅读、寻找素材、日复一日地写作。它也教会了我对作家来说更重要的品质：保持耐心、享受孤独。</strong></p>\n</blockquote>\n<h1 id=\"《克拉拉与太阳》\"><a href=\"#《克拉拉与太阳》\" class=\"headerlink\" title=\"《克拉拉与太阳》\"></a>《克拉拉与太阳》</h1><p><a href=\"https://book.douban.com/subject/35315153/\">克拉拉与太阳</a></p>\n<p>因为豆瓣畅销书的光环就挑出时间看了，随着年岁增长我越来越不愿意读这些文学意义上的小说了。<br>这本书讲的确实是一个很与时俱进且新奇的故事，看完之后我也不禁思考人和所谓的人工智能的机器人在意识上区别究竟是什么。</p>\n<h2 id=\"第四部\"><a href=\"#第四部\" class=\"headerlink\" title=\"第四部\"></a>第四部</h2><blockquote>\n<p><strong>古往今来，一个世纪又一个世纪，人们彼此陪伴，共同生活，爱着彼此，恨着彼此，却全都是基于一个错误的假设。一种我们过去在懵懵懂懂之中一直固守的迷信。</strong></p>\n</blockquote>\n<h2 id=\"译后记\"><a href=\"#译后记\" class=\"headerlink\" title=\"译后记\"></a>译后记</h2><blockquote>\n<p><strong>正是由于自私的欲望与升华的渴望并存，人类的心中才会充满了矛盾、彷徨与痛苦；没有了自私那下坠的重力，一切崇高、向上的人性也就虚无缥缈得失去了分量。自私是人类沉重的负担，但也许在并不遥远的未来，也会是人之所以为人的一个最重要的锚点吧。</strong></p>\n</blockquote>\n<h1 id=\"《工作、消费主义和新穷人》\"><a href=\"#《工作、消费主义和新穷人》\" class=\"headerlink\" title=\"《工作、消费主义和新穷人》\"></a>《工作、消费主义和新穷人》</h1><p>在哔哩哔哩看到了对于这本书内容的分析，你可以直接批判它就是典型的白左思想书籍，但这本书还是很值得一读。</p>\n<p><a href=\"https://book.douban.com/subject/35593780/\">工作、消费主义和新穷人</a></p>\n<h3 id=\"要么工作，要么死亡\"><a href=\"#要么工作，要么死亡\" class=\"headerlink\" title=\"要么工作，要么死亡\"></a>要么工作，要么死亡</h3><blockquote>\n<p><strong>在“大量减少”穷人的过程中，工作伦理的贡献是无价的。毕竟，工作伦理主张：无论生活多么悲惨，只要它是由劳动报酬支撑的，就具有道德优越性。</strong></p>\n</blockquote>\n<h3 id=\"制造生产者\"><a href=\"#制造生产者\" class=\"headerlink\" title=\"制造生产者\"></a>制造生产者</h3><blockquote>\n<p><strong>除了那些由于世袭或暴富，可以自给自足悠然生活的人以外，“你是谁”这个问题的答案通常指向人们所在的公司以及该公司的能力。</strong></p>\n</blockquote>\n<h3 id=\"从“更好”到“更多”\"><a href=\"#从“更好”到“更多”\" class=\"headerlink\" title=\"从“更好”到“更多”\"></a>从“更好”到“更多”</h3><blockquote>\n<p><strong>工作伦理的宣讲力度与潜在劳动者因失去自由产生的抵制情绪成正比。宣讲的目的在于消除抵制。工作伦理是一种工具，目的是使工人们丧失独立性，服从于工厂制度。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>大多数美国社会历史学家都认为，推动美国工业前进的是企业精神和跻身上层阶级的愿望，而非工作伦理。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>工业社会是以权力冲突拉开序幕，那时的人们为自治和自由而斗争。时过境迁，现在他们只会为了获取更多盈余而斗争。人们默默接受了现存的权力结构，对这种结构的修正被排除在议程之外。越来越多的人认为，从工匠变成工人时失去的人的尊严，只有通过赢得更多盈余才能恢复。这种变迁中，努力工作能使人们道德升华的呼声日益衰弱。现在，衡量人们声望和社会地位的是工资的差别，而不是勤于工作的道德或惰于工作的罪恶。</strong></p>\n</blockquote>\n<h3 id=\"第二章-从工作伦理到消费美学\"><a href=\"#第二章-从工作伦理到消费美学\" class=\"headerlink\" title=\"第二章 从工作伦理到消费美学\"></a>第二章 从工作伦理到消费美学</h3><blockquote>\n<p><strong>之所以称之为“生产者社会”，是因为那时人们主要以生产者的身份参与其中。社会塑造其成员的方式由社会分工的需要决定，社会希望其成员有能力和意愿参与社会分工。在当前这个近现代（late-morden）、次现代（second-morden）或后现代（postmorden）阶段，社会主要要求人们以消费者的能力参与其中，首先依照“消费者”角色需要塑造其成员，并期望他们具有消费的能力和意愿。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>想要提高消费者的消费能力就不能让他们休息。他们需要不断地接受新的诱惑，持续处于永不枯竭的兴奋之中，持续处于怀疑和不满之中。诱使他们转移注意力的诱饵需要肯定这种怀疑，同时提供一个宣泄的出口：“你以为这就是全部？好戏还在后头呢！</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>正常运转的消费者社会中，消费者会主动寻求被诱惑。他们的生活从吸引到吸引，从诱惑到诱惑，从吞下一个诱饵到寻找另一个诱饵，每一个新的吸引、诱惑和诱饵都不尽相同，似乎比之前的更加诱人。他们生活于这种轮回，就像他们的先辈，那些生产者，生活于一个传送带和下一个传送带之间。</strong></p>\n</blockquote>\n<h3 id=\"制造消费者\"><a href=\"#制造消费者\" class=\"headerlink\" title=\"制造消费者\"></a>制造消费者</h3><blockquote>\n<p><strong>消费者社会中，与其说经济增长取决于“国家生产力”（即健康充裕的劳动力、充实的财政收入、勇往直前具有企业家精神的资本所有者和经营者），不如说取决于消费者的热情和活力。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>今天流行的口号是“灵活”，这个越来越时髦的概念代表的是一场几乎没有任何规则的雇佣和解雇游戏，而且在游戏进行时，单方面就可以随时更改规则。</strong></p>\n</blockquote>\n<h3 id=\"消费者社会的穷人\"><a href=\"#消费者社会的穷人\" class=\"headerlink\" title=\"消费者社会的穷人\"></a>消费者社会的穷人</h3><blockquote>\n<p><strong>杰里米·希布鲁克（Jeremy Seabrook）曾提醒过他的读者，当今社会依赖于“制造人为的、主观的不满足感”，因为本质上“人们满足于自己拥有的东西才是最可怕的威胁”。于是，人们真正拥有的东西被淡化，被贬低，被较富裕的人锋芒毕露的奢侈消费所掩盖：“富人成为被普遍崇拜的对象”。</strong></p>\n</blockquote>\n<h3 id=\"福利国家的衰败\"><a href=\"#福利国家的衰败\" class=\"headerlink\" title=\"福利国家的衰败\"></a>福利国家的衰败</h3><blockquote>\n<p><strong>这个星球上，部分地区已经充满老于世故的消费者，但也还存在广袤的处女地，那里有不需要激发消费欲望就能获得的顺从劳动力，那里的人为了维持生计而卑微地工作。但是，在本地市场，你需要源源不断地创造新的欲望，并保持雇员工资增长，以确保这些欲望能够变成普遍切实的需求。</strong></p>\n</blockquote>\n<h3 id=\"招致毁灭的成功\"><a href=\"#招致毁灭的成功\" class=\"headerlink\" title=\"招致毁灭的成功\"></a>招致毁灭的成功</h3><blockquote>\n<p><strong>获得社会帮助并脱离劣势地位的人，不仅失去了回馈的动力，而且变成了最强烈的诋毁者。从某种意义上说，“平权法案”培养的是自己的掘墓人</strong></p>\n</blockquote>\n<h3 id=\"第四章-工作伦理和新穷人\"><a href=\"#第四章-工作伦理和新穷人\" class=\"headerlink\" title=\"第四章 工作伦理和新穷人\"></a>第四章 工作伦理和新穷人</h3><blockquote>\n<p><strong>某国整体失业率快速上升时，你看不到证券市场有任何焦虑的迹象，更谈不上恐慌，它们反倒可能表现火爆。</strong></p>\n</blockquote>\n<h3 id=\"定居者与游牧者\"><a href=\"#定居者与游牧者\" class=\"headerlink\" title=\"定居者与游牧者\"></a>定居者与游牧者</h3><blockquote>\n<p>显然，最后一类人在出售劳动力时面临的困难最小，他们的潜在买家并不会特别挑剔。“常规劳动者”从事的工作既不需要难以掌握的稀有技能，也不需要面对面与顾客沟通所需的特殊机敏，因此他们可以比较容易地在所有有偿的低技能工作中切换。但出于同样的原因，他们也很容易被弃用，工作不稳定。他们随时可能被替换，这不会给雇主带来什么损失。他们可能在生意不景气时被就地解雇，因为业务回暖时有很多这样的人随时可以上岗。因此，他们没有找麻烦的气力，没有讨价还价的资本，即使有能力也愿意争取更好的就业条件，他们仍没有胜算的机会。</p>\n</blockquote>\n<blockquote>\n<p>这类人很少有抗争的意愿，特别是团结起来一致行动的意愿。所有的情况似乎都对他们不利。他们的工作是脆弱的，肯定不会持续很久，随时可能消失不见；今天的伙伴明天可能就各奔东西，去向遥远的地方……投身于工人的团结和集体抗争，需要付出长期的、充满风险的努力，注定收益不大，成本却高得难以计量。如果这样的状况持续很久，看不到任何改观，那些受雇者的世界观和心态也会相应变化。“</p>\n</blockquote>\n<blockquote>\n<p><strong>如果你喜欢为之工作的公司，并期望未来一直和它携手前行，那么最多在下一轮的“外包”或“裁员”时，你就会受到伤害。总而言之，这种被称为“劳动力市场灵活性”的重要转变，给长期协作的可能性蒙上了一层阴影，更不用说对“共同事业”全心全意、无条件的承诺和忠诚。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>求职者仍像以前一样“受缚于土地”，不能自由迁徙，只能依赖本地的工作谋生，资本现在则可以无拘无束地移动，不用在意距离和国界。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>资本完全没必要承受本地劳动力日益膨胀的自信（以及日益增长的要求）所带来的不便（和高昂的成本）。长期雇用导致这些定居劳动力越来越勇敢，并且有足够（过多）的时间变得更团结、更强大、更坚固。然而，当游牧资本想要转移到其他地方时，定居的劳动力根本就没有机会阻碍它转移，更不用说将其永久绑定，因此他们没有机会争取自己的权利，实现自己的抱负。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>无论从哪个方面看，脆弱性和不稳定性像幽灵一样萦绕在各种工作周围。不同工作的区别仅在于是否能有效防范雇员的反抗：以消极怠工、逃避责任来对抗雇佣关系的脆弱性。没有哪种工作能免除失业，也没有人可以免除近来出现的“长期失业”——这个词现在已经被更准确地描述为“过剩”。如果说“失业”，甚至是长期失业，意味着工作生活的一个阶段，那么“过剩”则更贴近如今失业的本质。它暗示了一场不可逆转的灾难最终到来。它是通向废品站的一张单程票……</strong></p>\n</blockquote>\n<h3 id=\"从“失业”到“过剩”\"><a href=\"#从“失业”到“过剩”\" class=\"headerlink\" title=\"从“失业”到“过剩”\"></a>从“失业”到“过剩”</h3><blockquote>\n<p><strong>随着经济周期的每一次轮回，“失业”这个概念的内涵发生了变化，“失业”之下的希望也越来越不切实际。这种体验无情地累加，推动了真正的“范式转变”产生——“过剩”这个新词，替代了“失业”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>如今的精简型、小型化、资本和知识密集型产业，则把劳动力视为生产力提升的制约要素。这是对曾被奉为经典的斯密_里卡多_马克思劳动价值论的直接挑战。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>近来重新鼓吹工作伦理的目的，是为了“将值得帮助的穷人和不值得帮助的穷人分开，把责难倾倒给后者，以合理化社会对他们的冷漠”，因此“说明贫穷是个人缺陷的必然后果，进而促成对穷人和被剥夺者的漠不关心”￼。换言之，工作伦理虽然不再是减少贫困的手段，却能帮助调和社会众生和永恒存在的穷人之间的关系，有助于整个社会的安宁平和。</strong></p>\n</blockquote>\n<h3 id=\"用于底层阶级的工作伦理\"><a href=\"#用于底层阶级的工作伦理\" class=\"headerlink\" title=\"用于底层阶级的工作伦理\"></a>用于底层阶级的工作伦理</h3><blockquote>\n<p><strong>正如堕入底层是一个选择问题，脱离贫困也是个选择问题——如果作出的是正确的选择。穷人沦为底层阶级是选择的结果，这个观点暗示的是，他们完全可以作出另一种选择，使自己从困境中解脱出来。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在社会日益富裕的过程中，如果贫困仍继续存在并持续扩大，那么工作伦理一定是无效的。但是，如果我们相信，工作伦理之所以无效只是因为其戒律没有得到很好的倾听和遵从，那么，就只能用那些掉队者的道德缺陷或犯罪倾向予以解释</strong></p>\n</blockquote>\n<h3 id=\"贫穷即犯罪\"><a href=\"#贫穷即犯罪\" class=\"headerlink\" title=\"贫穷即犯罪\"></a>贫穷即犯罪</h3><blockquote>\n<p><strong>底层阶级冒犯了大多数人珍视的价值观，却又紧紧抓着它们，渴望像其他自力更生的人一样，获得消费生活的乐趣。换句话说，美国人对底层阶级真正的不满意在于，这些人的梦想，他们渴望的生活模式居然和自己如此相似。</strong></p>\n</blockquote>\n<blockquote>\n<p>近年来的犯罪率上升，不是功能失调或疏忽大意的结果，而是消费者社会自身的产物，这在逻辑上（而非在法律上）是合理的。更重要的是，这也是消费者社会不可避免的产物。消费者需求越大（即市场诱导越有效），消费者社会就越安全，越繁荣。然而，与此同时，那些有欲望并能满足自己欲望的人（已经被诱惑并能按照诱惑的期望行动的人）与那些已经被诱惑却无法按照期望采取行动的人，两者之间的差距越拉越大。</p>\n</blockquote>\n<blockquote>\n<p>市场诱惑，既是伟大的均衡器，也是伟大的分化器。为了取得效果，消费的诱惑、消费更多的理念必须传达到每一个角落，不加区别地传达给每一个愿意聆听的人。然而，总是存在不能够按照诱惑的期望付诸行动的人，他们每天面对着那些获得满足的人展示的令人眼花缭乱的景象。这些人被告知，奢侈的消费是成功的标志，是赢得公众掌声和名誉的捷径。他们还了解到，拥有和消费某些商品，践行这种生活方式，是幸福的必要条件，甚至是实现人类尊严的必要条件。</p>\n</blockquote>\n<blockquote>\n<p><strong>如果消费是衡量成功人生的标准，衡量幸福的标准，甚至是衡量尊严的标准，那么人类欲望的潘多拉之盒已经打开，再多的购买和刺激的感觉，都不能唤回过去“达到标准”带来的满足感：现在根本就没有标准可言。</strong></p>\n</blockquote>\n<h3 id=\"逐出道德义务的世界\"><a href=\"#逐出道德义务的世界\" class=\"headerlink\" title=\"逐出道德义务的世界\"></a>逐出道德义务的世界</h3><blockquote>\n<p><strong>在“电视中”的人们死于饥荒和疾病的那片遥远土地上，也诞生了“亚洲小龙”——虽然所有“小龙”加起来也不及亚洲人口的百分之一。它们传达了想要传达的：饥荒和无家可归是他们自己的选择。其他选项是存在的，然而他们缺乏勤奋和决心。字里行间的意思是，穷人应该对自己的命运负责。他们可以像“亚洲小龙”一样，选择勤奋节俭的生活。</strong></p>\n</blockquote>\n<h3 id=\"殖民主义，还是剩余劳动力输出\"><a href=\"#殖民主义，还是剩余劳动力输出\" class=\"headerlink\" title=\"殖民主义，还是剩余劳动力输出\"></a>殖民主义，还是剩余劳动力输出</h3><blockquote>\n<p><strong>从一开始，现代就是大迁徙的时代。至今为止，不计其数的人远渡重洋，离开无法生存的故土，去往满载憧憬的异国他乡。随着时间的推移，现代化的热门区域不断变化，热门的线路也不断变化，但总体来说，移民都是从世界上“较发达”（现代化程度较高）的地区向“不发达”（在现代化冲击下还未舍弃其传统的社会经济平衡）的地区流动。</strong></p>\n</blockquote>\n<h3 id=\"工作和贫穷问题的全球化新维度\"><a href=\"#工作和贫穷问题的全球化新维度\" class=\"headerlink\" title=\"工作和贫穷问题的全球化新维度\"></a>工作和贫穷问题的全球化新维度</h3><blockquote>\n<p><strong>远方的人遭受苦难直接或间接的源头，或许正是我们此时此地的所作所为，但由于距离遥远，它们并不会引起道德上的共鸣，也不会像身边所见的苦难那样能够引发强烈的行动意愿。</strong></p>\n</blockquote>\n<h3 id=\"社会问题转为法律和秩序问题\"><a href=\"#社会问题转为法律和秩序问题\" class=\"headerlink\" title=\"社会问题转为法律和秩序问题\"></a>社会问题转为法律和秩序问题</h3><blockquote>\n<p><strong>“无用之人”大规模聚集并迅速膨胀，看上去会变成持续的、永久的存在。这要求采取更严格的隔离政策和极端的安全措施，以免危及“社会的健康”以及社会系统的“正常运转”。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>可以说，监狱是把穷人和失业者（更准确地说，无法就业的人）从“社会问题”范畴转移到法律秩序范畴的过程中采用的手段，是消除他们对于整个社会潜在的破坏性影响的投资。</strong></p>\n</blockquote>\n<h3 id=\"从社会国家到“安全国家”\"><a href=\"#从社会国家到“安全国家”\" class=\"headerlink\" title=\"从社会国家到“安全国家”\"></a>从社会国家到“安全国家”</h3><blockquote>\n<p><strong>市场竞争造成的就业环境不稳定，是且将继续是人们对于未来不确定性、对于社会地位和自尊的不安全感的主要根源。</strong></p>\n</blockquote>\n<h2 id=\"第三部分\"><a href=\"#第三部分\" class=\"headerlink\" title=\"第三部分\"></a>第三部分</h2><h3 id=\"第六章-新穷人的前景\"><a href=\"#第六章-新穷人的前景\" class=\"headerlink\" title=\"第六章 新穷人的前景\"></a>第六章 新穷人的前景</h3><blockquote>\n<p><strong>渴望把人类世界变成一个无机的世界，在那里一切都完美运行，按部就班，服从于一个超越个体的系统。然而，向往秩序就是向往死亡，因为生命本身就是不断破坏秩序的过程。或者换句话说：对秩序的渴望是一种堂皇的托辞，是强烈厌世的借口。</strong></p>\n</blockquote>\n<h3 id=\"失去位置的穷人\"><a href=\"#失去位置的穷人\" class=\"headerlink\" title=\"失去位置的穷人\"></a>失去位置的穷人</h3><blockquote>\n<p><strong>学识渊博的经济学家忙不迭地立即证明，当工资保持在低水平的时候，“穷人会做更多的工作，实际上生活得更好”，而他们领取高工资时，他们就迷失于无所事事和聚众闹事。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>想符合社会规范，成为一个合格的社会成员，就需要对消费市场的诱惑作出及时有效的反应，需要为“清空供给”作出贡献，需要在经济环境出现问题时，积极参与“消费者主导的复苏”。穷人没有体面的收入，没有信用卡和美好前景，他们达不到要求。今天穷人打破的社会规范——使他们“不正常”的规范，是消费能力规范而非就业规范。今天的穷人是“不消费的人”，而非“失业者”。他们首先被定义为有缺陷的消费者，因为他们没有履行最重要的社会责任——积极有效地购买市场提供的商品和服务。消费者社会的资产负债表中，穷人明显是负债，无论如何也不能把他们记入现在或未来的资产。</strong></p>\n</blockquote>\n<h3 id=\"没有位置，没有道德义务\"><a href=\"#没有位置，没有道德义务\" class=\"headerlink\" title=\"没有位置，没有道德义务\"></a>没有位置，没有道德义务</h3><blockquote>\n<p><strong>如果穷人试图捍卫福利体系的残存，他们很快就会发现自己没有谈判的筹码，无法传达自己的声音，更不可能给对手造成威胁。他们尤其没有任何能力来打动社会上的普通公民，大众受到了政客的蛊惑，他们被劝说不要因为内心的冲动投票，而要根据自己的利益投票。</strong></p>\n</blockquote>\n<h3 id=\"工作伦理，还是生活道德\"><a href=\"#工作伦理，还是生活道德\" class=\"headerlink\" title=\"工作伦理，还是生活道德\"></a>工作伦理，还是生活道德</h3><blockquote>\n<p>收入权利与收入能力脱钩的想法其实并不保守。根据我们的推论，实现它恰恰需要一个非常大的转变。我们将不得不放弃目前生活模式中一些神圣不可侵犯的假设（由于缺少反思，它们显得更加神圣）。例如，效率是一件好事，无论它目的何在，也无论它是否会带来痛苦的副作用。再例如，凡是“经济增长”的东西，即统计意义上“今天比昨天多，明天比今天多”的东西，就是好的，而无视其增长过程中对人类生存环境和自然（全人类共享的生存环境）造成的损害。</p>\n</blockquote>\n<blockquote>\n<p>对那些因为需要作出巨大的转变而反对的人，我们只能再次引用科尼利厄斯的话来回答。当一个采访者问他：“那么，你想要什么？改变人类吗？”，卡斯托利亚蒂斯回答说：“不，没有那么夸张：我希望人类改变，正像他们已经改变过两三次那样。”[8]<br>至少现在还有希望，人类能够再次完成同样的壮举。毕竟，正如帕特里克·库里（Patrick Curry）所言，“群体自愿的返璞归真，正成为群体贫困的唯一有意义的替代。</p>\n</blockquote>\n<p>并不认同这样的观点。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Mon Jul 25 2022 00:53:19 GMT+0800 (中国标准时间)","title":"2022年六月读书摘录","path":"2022/07/15/202206ReadingList/","eyeCatchImage":null,"excerpt":"<p>继上个月分享了一些读书摘录之后这个月也没闲着，一共读了五本书。</p>\n<ul>\n<li>《长安的荔枝》</li>\n<li>《失落的卫星》</li>\n<li>《午夜降临前抵达》</li>\n<li>《克拉拉与太阳》</li>\n<li>《工作、消费主义和新穷人》</li>\n</ul>","date":{"_isAMomentObject":true,"_i":"2022-07-15T05:10:12.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-07-15T05:10:12.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"阅读","tags":["读书","长安的荔枝","马伯庸","失落的卫星","午夜降临前抵达","刘子超","工作、消费主义和新穷人","克拉拉与太阳"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":10793},{"title":"2022年五月读书摘录","date":"2022-06-15T05:10:12.000Z","copyright":true,"_content":"\n最近看社会新闻很是头疼，也想着找一些地方发泄一些情绪，结果发现一旦拿起一本书看烦恼就能够暂时解除，便结束了这个念头。\n今年囫囵吞枣读了不少书，早早达成了一个月读一本书的目标。但是很多书读完一遍过一段时间很难再去梳理，可能等同于没读，于是决定将书里的内容摘出来在博客上分享，也方便自己随时回忆。\n有些书自己什么时候读完的也不记得了，之后每个月会对自己读的书进行一次整理，这起主要是四本书，《乔纳森传》、《平成十二年》、《UNIX传奇》以及《重走》。\n\n<!--more-->\n\n\n# 《UNIX传奇》\n[UNIX传奇](https://book.douban.com/subject/35292726/)\n\n这本书极大激发了我对于计算机研究的兴趣，从作者的讲述中了解到 UNIX 和实验室的发展历程以及这群人和这群人的创造的影响。\n\n原来写代码是有使命感的，让我在专注工作的同时能够感受到写代码给我带来的成就感。\n\n### 1.1 贝尔实验室的物理科学研究\n\n> 现今世界已全然不同，多数人只做未来几个月的规划，功夫都花在了预测下一季度财务状况上。\n> \n\n时常能够在网络上看到对于现今人类不思进取的责难，的确，战争时期的人类在科技领域取得了耀眼的成就，近几十年的发展相较于战争时期再或者是冷战时期可以说发展缓慢。现代社会的法则更聚焦于商业上的成功。\n\n### 1.5 137→127→1127→11276\n\n> 相对于“我的人比你的人强”，我们更加会说“别忘记你的人还做了一件好事”。\n> \n\n在工作过程中需要肯定其他团队的成员的价值，懂得谦虚。\n\n### 3.2 Unix房间\n\n> 独立办公室虽然比开放式区域成本更高，但也给了员工安静平和的空间，让员工可以不受旁边没完没了的噪声影响，专注于工作，还能够保存图书、文件，关上门就能沉思或私聊。\n> \n\n### 3.5 丹尼斯·里奇小传\n\n> 到了1973年，Unix已经从原来的汇编语言改为C语言编写，系统的维护和修改变得更加容易。\n> \n\n### 4.2 系统调用\n\n> **文件只是字节。用户决定这些字节代表什么，而操作系统则只负责存储和取出，不向用户暴露设备属性。**\n> \n\n### 4.5 grep命令\n\n> **grep这个名字来自ed文本编辑器中的命令g/re/p，它列出所有符合正则表达式模式re的行。**\n> \n\n在学习 Linux 的时候接触了这个命令却一直不知道它的历史。\n\n### 4.7 C语言\n\n> **C语言既古怪又有缺点，却获得了巨大的成功。虽然历史上的意外事件肯定有帮助，但C语言显然满足了人们对一种系统实现语言的需求，这种语言需要足够高效，足以取代汇编语言，但又足够抽象和流畅，足以描述各种环境下的算法和交互。**\n> \n\n### 5.2 Yacc，Lex，Make\n\n> **Lint这个名字来自从衣服上捡拾绒毛（lint）的情景。虽然其功能已多被纳入C语言编译器，但其概念体现到了其他语言的类似工具中。**\n> \n\n### 5.3 文档编制\n\n> **也许，今天不会有很多人记得，当机器容量以千字节而不是千兆字节为单位时，时间和空间的利用效率乃是重中之重。每个字节都得斟酌使用，所以在某种程度上，每条指令也得再三推敲，因此，一种能在这两方面都节约的语言不仅优秀，而且是实际需要。**\n> \n\n在日常写代码的过程中只有在 Code Review 的过程中会关注执行效率，会不曾想到在计算机存储和性能吃紧的时候每一次优化都非常有意义。\n\n### 5.6 其他贡献\n\n> **Unix和C语言被广泛采用，导致20世纪80年代和90年代的CPU设计围绕着它们运转，没人成功制造出为其他语言优化的CPU。**\n> \n\n### 6.1 程序员工作台\n\n> **SCCS的基本思想是，程序员签出代码库中的一部分，锁定这部分代码，其他程序员在锁持有者解锁之前不能修改它，这样就避免了多位程序员同时对代码做出不一致的修改。当然还是会出问题，如粗心大意或程序崩溃都可能会导致代码死锁。另外，如果锁定范围太大，就会拖慢同时修改的速度。**\n> \n\n### 6.2 高校授权\n\n> **加利福尼亚大学伯克利分校是最活跃的许可获得者之一，该校的一些研究生对系统做出了重大贡献，最终演化出伯克利软件发行版（Berkeley Software Distribution，BSD）。BSD是由最初的科研版Unix演变而来的两个主要分支之一。**\n> \n\n### 8.1 伯克利软件发行版\n\n> **BSD的后裔如今仍然活跃，FreeBSD、OpenBSD和NetBSD等变种都在继续发展。苹果公司的Darwin（macOS的核心）所使用的NextSTEP也是BSD的衍生版本。**\n> \n\n### 8.3 Minix和Linux\n\n> **我相信API不该有版权。如果API有版权，我们就不会有与Unix相似的各种操作系统，包括Linux在内，因为它们全是基于Unix系统调用接口的独立实现。我们可能也不会有Cygwin这样的软件包，它是Unix实用程序的Windows实现，为Windows用户提供了类似Unix的命令行界面。事实上，如果接口的独立实现可以被宣告所有权的公司所限制，我们就不太可能有很多独立实现。**\n> \n\n### 8.4 Plan 9\n\n> *Plan 9确实为世界贡献了一件无比重要的东西：Unicode的UTF-8编码。\n> \n\n### 8.5 流散\n\n> **朗讯与法国电信公司阿尔卡特（Alcatel）合并成立阿尔卡特-朗讯（Alcatel-Lucent），而阿尔卡特-朗讯又在2016年被诺基亚收购。**\n> \n\n### 9.1 技术方面\n\n> **人们有时会用代码行数来评价软件的生产力。在Unix的世界里，生产力却往往以删除了多少特殊情况或代码行数来衡量。**\n> \n\n> **Unix的高明之处在于选择了足够普适的抽象概念，既能发挥巨大的作用，又不至于在性能上付出太大代价。**\n> \n\n> **Unix哲学是关于如何处理计算任务的编程风格。这是道格·麦基尔罗伊在《贝尔实验室技术杂志》（Bell Labs Technical Journal）Unix特刊的前言中总结出来的。\n（i）让每个程序做好一件事。要做一件新的工作，就构建新程序，而不是通过增加新“特性”使旧程序复杂化。\n（ii）预期每个程序的输出都能成为另一个未知程序的输入。不要用无关的信息来干扰输出。避免使用严格的分栏对齐或二进制输入格式。不要执着于交互式输入。\n（iii）设计和构建软件，甚至是操作系统，要尽早试用，最好是在几周内就用起来。大刀阔斧砍掉笨拙的部件，重建它们。\n（iv）宁可绕道构建用后即弃的工具来减轻编程负担，也别依赖经验欠奉的帮助。**\n> \n\n### 9.2 组织\n\n> **研究人员可以长期甚至年复一年地探索他们认为重要的想法，而不必每隔几个月就向人证明自己在努力。**\n> \n\n没有背负 KPI 的压力，自己确定自己的研究目标，对于自主的人来说无疑是一件幸福的事。\n\n> **再优秀的视频会议系统也无法取代就在隔壁的合作者和随手可得的专家。**\n> \n\n在 WFH 逐渐流行的今天我也仍然相信这一点。之前在诺基亚公司实习的时候 leader 提到有员工会为了沟通一个业务专程从国外飞来，相信面对面的价值也是这家公司的价值观之一。\n\n> **积极的研究者能和师生们讨论技术话题，总能学到有用的东西，为公司树立正面形象。**\n> \n\n> **部门主管应当知晓手下工作的细节，不是为了争论它有多了不起，而是为了能够解释给其他人听，帮助建立联系。**\n> \n\n> **要建立和维持一个组织，使其成员相互喜欢和尊重，并享受彼此的陪伴，这需要付出努力。不能靠管理部门的命令，也不能靠外部顾问来创造。它是在一起工作的乐趣中有机地成长起来的，也是在一起玩耍的乐趣和互相欣赏中成长起来的。**\n> \n\n带一个团队不是团建就足够的，同一家公司同一个部门不同团队的氛围可能都存在较大不同。\n\n没有人离职的团队不一定是最好的团队，但离职率最高的团队一定是有其原因的，领导肯定负有责任。\n\n### 9.3 认可\n\n> **1993年电影《侏罗纪公园》（Jurassic Park）中有个著名场景，13岁的莱克斯·墨菲[Lex Murphy，阿丽亚娜·理查兹（Ariana Richards）饰]说：“这是个Unix系统! 我会用。”她浏览文件系统，找到大门控制装置，锁上了门，从而使大家免于被迅猛龙吃掉（图9-1）。这一幕可以说是极客们的高峰时刻。**\n> \n\n毫不夸张地说这部电影在上映几十年后重映我第一次看印象最深的就是这个镜头。\n\n### 9.4 历史能重演吗\n\n> **似乎可以预见，将会继续有新的语言出现，让编程变得更简单、更安全。同样可以预测，不会只有一种语言，然而每种语言都有得有失，无法满足所有目的。**\n>\n\n\n# 《乔纳森传》\n[乔纳森传](https://book.douban.com/subject/25786645/)\n\n## 第二章 英国的设计教育\n\n> **20世纪20年代德国的包豪斯建筑学派理念，在20世纪50年代被英国设计界采纳并使用，”她说，“例如，在包豪斯，有所谓的基础学年，而英国的设计专业也有。基础学年就是指，学生从零开始学习设计，与以往的知识没有关系，完全从头开始。”**\n> \n\n之前收听 [Anyway.FM](http://Anyway.FM) 有一期节目讲述了包豪斯的意义，节目中推荐了[梁文道老师的包豪斯纪录片](https://www.bilibili.com/s/video/BV1Ka4y1a7a2)，很值得一看。\n\n> **乔纳森以一种不同寻常的方式来到了纽卡斯尔综合性工程技术学院：他错过了开学的第一天，因为当时他要去领一个设计奖，这多多少少让一起入学的同学感到震惊。“新生入学的前两天，他都不在——他带着自己高中时的作品去领取一个设计奖。”汤奇回忆说。**\n> \n\n> **他从不自大，这在学设计的学生中是难得的优点。大多数学设计的学生尽管没多少才华，但是却很自负，而乔纳森完全不一样。做设计的时候，他是真的热爱自己的工作，对于自己的任务，他向来都是全身心投入。”**\n> \n\n## 第三章 伦敦的生活\n\n> **他对人性化技术非常感兴趣。他设计时总是会先追问一样东西应该是什么样的。他拥有去除或无视某些东西的能力，他不关心一个产品的现状是怎样的，或者一个工程师说它必须是什么样的。他可以从基础开始对任何一样产品或用户界面进行设计。**\n> \n\n我认为设计一个 App 和做一个产品也应该是如此，如果只是拿来主义，最终诞生的必然是不如主流产品的产品。\n\n> **这第一台PowerBook有着嵌入式的键盘、中央定点设备以及前倾的手腕放置区（掌托），足以为未来20年笔记本电脑的设立下基本标准，这一事实至今仍然令大家震惊不已。“我们的PowerBook十分成功，”布伦纳说，“这太让我惊讶了。那台机器和设计本身还有那么多的不足之处。我本以为那将成为一次巨大的失败。但今天回过头来看，基本上所有的笔记本电脑都是那样设计的：嵌入式键盘、掌托以及中央定点设备。”**\n> \n\n> **大多数情况下，当他接受设计委托的时候，许多关键性决策已经由内部做好了。乔纳森逐渐相信，要想成就一件史无前例的新事物，就需要从组织内部进行彻底的变化。**\n> \n\n## 第四章 初到苹果\n\n> **布伦纳的这些选择是正确的，比如：制作室和工程团队的分离，松散的管理结构，工作流程中的合作以及向咨询模式的转变。苹果公司的设计团队之所以能做到如此高效，其中一个原因就是保留了布伦纳原始的结构。**\n> \n\n> **1996年，布伦纳成为五角设计旧金山办公室的一员。他和亚马逊合作设计了最早的电子阅读器Kindle，也参与了耐克和惠普很多产品的设计。2007年，布伦纳参与设计了安德烈·罗梅勒（Dr. Dre）品牌的魔音耳机，**\n> \n\n> **诺曼说，在某种程度上，这是“一个结构良好的程序”，但是他也指出了它的缺点。它不仅很慢、麻烦、繁琐，而且不可避免会导致“折衷”。当一个小组想这么做，而另一个小组想那样做，特色逐渐就会被取代，导致产品缺乏凝聚力。**\n> \n\n> **布伦纳说：“商人的想法是创造出每个人都喜欢的东西，这会导致产品走中庸路线。于是就变成了‘能不能达到一致同意’的问题，这就是为什么你很少看到天才的火花的原因。”**\n> \n\n可能用来解释现今时代的苹果很合适。但是我个人很喜欢现在苹果推出的产品，包括 MacBook Pro 上SD卡槽和 MagSafe 接口的回归，不再是设计师的一意孤行而是权衡了用户诉求的产品。\n\n## 第五章 乔布斯重返苹果\n\n> **停产一个比较受欢迎的产品，大多数高管都会思虑再三。牛顿的支持者拿着标语牌和扬声器，涌进苹果公司总部的停车场（其中一条标语写道：我在乎牛顿）。由于像Palm Pilot这样的掌上电脑的成功，掌上电脑的种类不断增加，但是对乔布斯来说，牛顿只是一个分散注意力的东西。他想让苹果公司将精力集中于电脑，这才是它的核心产品。**\n> \n\n> **“每位设计师都有一个自己的计划表，或是自己的设计理念，（对于他们的活动）根本毫无任何控制可言，”设计师道格·萨茨格说，“一位设计师有一个关于便携笔记本应该如何设计的想法，另一位设计师又有一个关于打印机应该如何设计的想法。但是关于下一代苹果超级电脑应该是什么样子的，却根本没有一个协调统一的想法。这个设计团队并没有建立在协调合作的基础之上。每位设计师都各自为战，都有着自己强烈的设计意识。他们看起来就像是在为许多不同的公司进行设计一样。”**\n> \n\n> **在iMac一体机没有软盘驱动器一事上，乔纳森站在苹果一边。他说：“关于新产品没有软盘驱动器这个问题，我不能代表苹果公司回答你。我只能给你我的回答，‘当人在前进的时候，总是需要把一些东西抛在身后。只要我还有一口气在，我就会继续争论下去，软盘驱动器实在是过时的技术了。我听过很多次这样的抱怨，但是如果前进的道路上没有摩擦，你的脚步就不会像自己希望的那样坚定。’”**\n> \n\n> **乔纳森反驳说，把iMac设计成特别的外形并非是故意为之，它的与众不同是设计过程的必然结果。他说：“我认为很多人起初都把设计看作一种有力的区别手段，能将自己的产品与其他产品相区别，我实在讨厌那种观点。那只是以企业为本，而不是以消费者和人为本。我们的目标不只是要突出自己的产品，而是要创造出在未来会受到人们喜爱的产品，了解这一点非常重要。我们的目标实现之后，结果必然就会与众不同。”**\n> \n\n## 第六章 捷报频传\n\n> **“一切都被记录下来，这是非常必要的。因为很多环节都是动态的。”萨利说道，“即使是我在苹果工作的时候，所有的工艺也都已经确定。这就解释了，为什么对于员工来说，苹果能成为一家很适合为之工作的公司。因为他们有指导工作的手册，在生产软件或是硬件的过程中，这些手册会提供帮助。**\n> \n\n> **“仅仅把狂热的激情放在显而易见的事物上是远远不够的，你需要把注意力和热情放在人们容易忽略的细节上，这才是起决定性作用的。”乔纳森说道。**\n> \n\n## 第七章 铁幕背后的设计工作室\n\n> **在苹果公司，乔纳森的角色一直在演变，逐渐由一位设计师变成了管理层的一分子。他不仅负责团队的管理，也开始着手新成员的招募。同时，他也是设计团队与公司其他部门——尤其是管理层——的信息沟通渠道。他与史蒂夫·乔布斯一直关系密切，而现在，他和公司领导层也是如此——所有新产品开发的种类和研究方向都是他们共同决定的。没有他的指示，什么都没法动工，甚至连产品颜色和按键细节都得由他拍板决定。“一切工作都得经过乔纳森的审阅。”一位设计师说。**\n> \n\n> **与苹果的其他部门相比，乔纳森对自己团队非常袒护。“他会独自承担整个团队的过错，”乔达姆·巴克斯说，“对于设计出现的问题，他会把责任揽在自己身上。如果有哪个环节没有达到标准，他会说那是他的过错。他从未抛下团队中的任何一员。”**\n>\n\n# 《平成十二年》\n\n[平成十二年](https://book.douban.com/subject/30413118/)\n\n## 第7章 党派间的较量\n\n> 日本是一面镜子。当你用狭隘的眼光看这个世界时，你人生的道路也会变得狭隘。那些用与时俱进的眼光看世界的人，早已远远地把你甩在身后。\n> \n\n> 如今，中国人研究日本已经不能只看《菊与刀》了。同样，日本人解剖中国也不能只盯着《阿Q正传》。双方都在进步，都在为寻找新方向而努力。愿以邻为鉴，可知兴衰。\n\n\n# 《重走》\n\n[重走](https://book.douban.com/subject/35436901/)\n\n## 序二 一次神游\n\n> **旅行最宝贵的价值在于更好地理解世界和自我。**\n> \n\n> **当我们回想自己的一生，我们会意识到，旅行是一段徐徐展开的经历，它会在往后的岁月不断制造回响。它是你长期的投资，源源不断地给你发放红利。**\n> \n\n### 第四章 在南岳：我见证了中国吸收欧洲成就最后的伟大日子\n\n> **学生作文文法有误，或不改，或改而不评；行文不贯，改，偶或加评；文不达，而有思想，助其达；文字华丽，作老生之谈，指出其空泛；文达而无新解，不评，也不给好分；文达而有新解，小误不足病**\n> \n\n> **宓一生极少与自然山水近接，故恒溺惑于人事，局囿于道德。即如Wordsworth（华兹华斯）之久居Lake Districts（英国湖区）……皆有助成其文章与修养工夫，亦皆宓所未得尝受”**\n> \n\n> **正如人一肚皮的世故，却有一点童心，满脸上的雀斑，却有两汪秋水，一街的电灯和汽车，却有头上的亮月，我们喜欢热闹，但是难忘记清静”**\n>","source":"_posts/202205ReadingList.md","raw":"---\ntitle: 2022年五月读书摘录\ndate: 2022-06-15 13:10:12\ncategories: \n- 阅读\ntags: \n- 读书\n- 乔纳森传\n- 平成十二年\n- UNIX传奇\n- 西南联大\n- 重走\ncopyright: true\n---\n\n最近看社会新闻很是头疼，也想着找一些地方发泄一些情绪，结果发现一旦拿起一本书看烦恼就能够暂时解除，便结束了这个念头。\n今年囫囵吞枣读了不少书，早早达成了一个月读一本书的目标。但是很多书读完一遍过一段时间很难再去梳理，可能等同于没读，于是决定将书里的内容摘出来在博客上分享，也方便自己随时回忆。\n有些书自己什么时候读完的也不记得了，之后每个月会对自己读的书进行一次整理，这起主要是四本书，《乔纳森传》、《平成十二年》、《UNIX传奇》以及《重走》。\n\n<!--more-->\n\n\n# 《UNIX传奇》\n[UNIX传奇](https://book.douban.com/subject/35292726/)\n\n这本书极大激发了我对于计算机研究的兴趣，从作者的讲述中了解到 UNIX 和实验室的发展历程以及这群人和这群人的创造的影响。\n\n原来写代码是有使命感的，让我在专注工作的同时能够感受到写代码给我带来的成就感。\n\n### 1.1 贝尔实验室的物理科学研究\n\n> 现今世界已全然不同，多数人只做未来几个月的规划，功夫都花在了预测下一季度财务状况上。\n> \n\n时常能够在网络上看到对于现今人类不思进取的责难，的确，战争时期的人类在科技领域取得了耀眼的成就，近几十年的发展相较于战争时期再或者是冷战时期可以说发展缓慢。现代社会的法则更聚焦于商业上的成功。\n\n### 1.5 137→127→1127→11276\n\n> 相对于“我的人比你的人强”，我们更加会说“别忘记你的人还做了一件好事”。\n> \n\n在工作过程中需要肯定其他团队的成员的价值，懂得谦虚。\n\n### 3.2 Unix房间\n\n> 独立办公室虽然比开放式区域成本更高，但也给了员工安静平和的空间，让员工可以不受旁边没完没了的噪声影响，专注于工作，还能够保存图书、文件，关上门就能沉思或私聊。\n> \n\n### 3.5 丹尼斯·里奇小传\n\n> 到了1973年，Unix已经从原来的汇编语言改为C语言编写，系统的维护和修改变得更加容易。\n> \n\n### 4.2 系统调用\n\n> **文件只是字节。用户决定这些字节代表什么，而操作系统则只负责存储和取出，不向用户暴露设备属性。**\n> \n\n### 4.5 grep命令\n\n> **grep这个名字来自ed文本编辑器中的命令g/re/p，它列出所有符合正则表达式模式re的行。**\n> \n\n在学习 Linux 的时候接触了这个命令却一直不知道它的历史。\n\n### 4.7 C语言\n\n> **C语言既古怪又有缺点，却获得了巨大的成功。虽然历史上的意外事件肯定有帮助，但C语言显然满足了人们对一种系统实现语言的需求，这种语言需要足够高效，足以取代汇编语言，但又足够抽象和流畅，足以描述各种环境下的算法和交互。**\n> \n\n### 5.2 Yacc，Lex，Make\n\n> **Lint这个名字来自从衣服上捡拾绒毛（lint）的情景。虽然其功能已多被纳入C语言编译器，但其概念体现到了其他语言的类似工具中。**\n> \n\n### 5.3 文档编制\n\n> **也许，今天不会有很多人记得，当机器容量以千字节而不是千兆字节为单位时，时间和空间的利用效率乃是重中之重。每个字节都得斟酌使用，所以在某种程度上，每条指令也得再三推敲，因此，一种能在这两方面都节约的语言不仅优秀，而且是实际需要。**\n> \n\n在日常写代码的过程中只有在 Code Review 的过程中会关注执行效率，会不曾想到在计算机存储和性能吃紧的时候每一次优化都非常有意义。\n\n### 5.6 其他贡献\n\n> **Unix和C语言被广泛采用，导致20世纪80年代和90年代的CPU设计围绕着它们运转，没人成功制造出为其他语言优化的CPU。**\n> \n\n### 6.1 程序员工作台\n\n> **SCCS的基本思想是，程序员签出代码库中的一部分，锁定这部分代码，其他程序员在锁持有者解锁之前不能修改它，这样就避免了多位程序员同时对代码做出不一致的修改。当然还是会出问题，如粗心大意或程序崩溃都可能会导致代码死锁。另外，如果锁定范围太大，就会拖慢同时修改的速度。**\n> \n\n### 6.2 高校授权\n\n> **加利福尼亚大学伯克利分校是最活跃的许可获得者之一，该校的一些研究生对系统做出了重大贡献，最终演化出伯克利软件发行版（Berkeley Software Distribution，BSD）。BSD是由最初的科研版Unix演变而来的两个主要分支之一。**\n> \n\n### 8.1 伯克利软件发行版\n\n> **BSD的后裔如今仍然活跃，FreeBSD、OpenBSD和NetBSD等变种都在继续发展。苹果公司的Darwin（macOS的核心）所使用的NextSTEP也是BSD的衍生版本。**\n> \n\n### 8.3 Minix和Linux\n\n> **我相信API不该有版权。如果API有版权，我们就不会有与Unix相似的各种操作系统，包括Linux在内，因为它们全是基于Unix系统调用接口的独立实现。我们可能也不会有Cygwin这样的软件包，它是Unix实用程序的Windows实现，为Windows用户提供了类似Unix的命令行界面。事实上，如果接口的独立实现可以被宣告所有权的公司所限制，我们就不太可能有很多独立实现。**\n> \n\n### 8.4 Plan 9\n\n> *Plan 9确实为世界贡献了一件无比重要的东西：Unicode的UTF-8编码。\n> \n\n### 8.5 流散\n\n> **朗讯与法国电信公司阿尔卡特（Alcatel）合并成立阿尔卡特-朗讯（Alcatel-Lucent），而阿尔卡特-朗讯又在2016年被诺基亚收购。**\n> \n\n### 9.1 技术方面\n\n> **人们有时会用代码行数来评价软件的生产力。在Unix的世界里，生产力却往往以删除了多少特殊情况或代码行数来衡量。**\n> \n\n> **Unix的高明之处在于选择了足够普适的抽象概念，既能发挥巨大的作用，又不至于在性能上付出太大代价。**\n> \n\n> **Unix哲学是关于如何处理计算任务的编程风格。这是道格·麦基尔罗伊在《贝尔实验室技术杂志》（Bell Labs Technical Journal）Unix特刊的前言中总结出来的。\n（i）让每个程序做好一件事。要做一件新的工作，就构建新程序，而不是通过增加新“特性”使旧程序复杂化。\n（ii）预期每个程序的输出都能成为另一个未知程序的输入。不要用无关的信息来干扰输出。避免使用严格的分栏对齐或二进制输入格式。不要执着于交互式输入。\n（iii）设计和构建软件，甚至是操作系统，要尽早试用，最好是在几周内就用起来。大刀阔斧砍掉笨拙的部件，重建它们。\n（iv）宁可绕道构建用后即弃的工具来减轻编程负担，也别依赖经验欠奉的帮助。**\n> \n\n### 9.2 组织\n\n> **研究人员可以长期甚至年复一年地探索他们认为重要的想法，而不必每隔几个月就向人证明自己在努力。**\n> \n\n没有背负 KPI 的压力，自己确定自己的研究目标，对于自主的人来说无疑是一件幸福的事。\n\n> **再优秀的视频会议系统也无法取代就在隔壁的合作者和随手可得的专家。**\n> \n\n在 WFH 逐渐流行的今天我也仍然相信这一点。之前在诺基亚公司实习的时候 leader 提到有员工会为了沟通一个业务专程从国外飞来，相信面对面的价值也是这家公司的价值观之一。\n\n> **积极的研究者能和师生们讨论技术话题，总能学到有用的东西，为公司树立正面形象。**\n> \n\n> **部门主管应当知晓手下工作的细节，不是为了争论它有多了不起，而是为了能够解释给其他人听，帮助建立联系。**\n> \n\n> **要建立和维持一个组织，使其成员相互喜欢和尊重，并享受彼此的陪伴，这需要付出努力。不能靠管理部门的命令，也不能靠外部顾问来创造。它是在一起工作的乐趣中有机地成长起来的，也是在一起玩耍的乐趣和互相欣赏中成长起来的。**\n> \n\n带一个团队不是团建就足够的，同一家公司同一个部门不同团队的氛围可能都存在较大不同。\n\n没有人离职的团队不一定是最好的团队，但离职率最高的团队一定是有其原因的，领导肯定负有责任。\n\n### 9.3 认可\n\n> **1993年电影《侏罗纪公园》（Jurassic Park）中有个著名场景，13岁的莱克斯·墨菲[Lex Murphy，阿丽亚娜·理查兹（Ariana Richards）饰]说：“这是个Unix系统! 我会用。”她浏览文件系统，找到大门控制装置，锁上了门，从而使大家免于被迅猛龙吃掉（图9-1）。这一幕可以说是极客们的高峰时刻。**\n> \n\n毫不夸张地说这部电影在上映几十年后重映我第一次看印象最深的就是这个镜头。\n\n### 9.4 历史能重演吗\n\n> **似乎可以预见，将会继续有新的语言出现，让编程变得更简单、更安全。同样可以预测，不会只有一种语言，然而每种语言都有得有失，无法满足所有目的。**\n>\n\n\n# 《乔纳森传》\n[乔纳森传](https://book.douban.com/subject/25786645/)\n\n## 第二章 英国的设计教育\n\n> **20世纪20年代德国的包豪斯建筑学派理念，在20世纪50年代被英国设计界采纳并使用，”她说，“例如，在包豪斯，有所谓的基础学年，而英国的设计专业也有。基础学年就是指，学生从零开始学习设计，与以往的知识没有关系，完全从头开始。”**\n> \n\n之前收听 [Anyway.FM](http://Anyway.FM) 有一期节目讲述了包豪斯的意义，节目中推荐了[梁文道老师的包豪斯纪录片](https://www.bilibili.com/s/video/BV1Ka4y1a7a2)，很值得一看。\n\n> **乔纳森以一种不同寻常的方式来到了纽卡斯尔综合性工程技术学院：他错过了开学的第一天，因为当时他要去领一个设计奖，这多多少少让一起入学的同学感到震惊。“新生入学的前两天，他都不在——他带着自己高中时的作品去领取一个设计奖。”汤奇回忆说。**\n> \n\n> **他从不自大，这在学设计的学生中是难得的优点。大多数学设计的学生尽管没多少才华，但是却很自负，而乔纳森完全不一样。做设计的时候，他是真的热爱自己的工作，对于自己的任务，他向来都是全身心投入。”**\n> \n\n## 第三章 伦敦的生活\n\n> **他对人性化技术非常感兴趣。他设计时总是会先追问一样东西应该是什么样的。他拥有去除或无视某些东西的能力，他不关心一个产品的现状是怎样的，或者一个工程师说它必须是什么样的。他可以从基础开始对任何一样产品或用户界面进行设计。**\n> \n\n我认为设计一个 App 和做一个产品也应该是如此，如果只是拿来主义，最终诞生的必然是不如主流产品的产品。\n\n> **这第一台PowerBook有着嵌入式的键盘、中央定点设备以及前倾的手腕放置区（掌托），足以为未来20年笔记本电脑的设立下基本标准，这一事实至今仍然令大家震惊不已。“我们的PowerBook十分成功，”布伦纳说，“这太让我惊讶了。那台机器和设计本身还有那么多的不足之处。我本以为那将成为一次巨大的失败。但今天回过头来看，基本上所有的笔记本电脑都是那样设计的：嵌入式键盘、掌托以及中央定点设备。”**\n> \n\n> **大多数情况下，当他接受设计委托的时候，许多关键性决策已经由内部做好了。乔纳森逐渐相信，要想成就一件史无前例的新事物，就需要从组织内部进行彻底的变化。**\n> \n\n## 第四章 初到苹果\n\n> **布伦纳的这些选择是正确的，比如：制作室和工程团队的分离，松散的管理结构，工作流程中的合作以及向咨询模式的转变。苹果公司的设计团队之所以能做到如此高效，其中一个原因就是保留了布伦纳原始的结构。**\n> \n\n> **1996年，布伦纳成为五角设计旧金山办公室的一员。他和亚马逊合作设计了最早的电子阅读器Kindle，也参与了耐克和惠普很多产品的设计。2007年，布伦纳参与设计了安德烈·罗梅勒（Dr. Dre）品牌的魔音耳机，**\n> \n\n> **诺曼说，在某种程度上，这是“一个结构良好的程序”，但是他也指出了它的缺点。它不仅很慢、麻烦、繁琐，而且不可避免会导致“折衷”。当一个小组想这么做，而另一个小组想那样做，特色逐渐就会被取代，导致产品缺乏凝聚力。**\n> \n\n> **布伦纳说：“商人的想法是创造出每个人都喜欢的东西，这会导致产品走中庸路线。于是就变成了‘能不能达到一致同意’的问题，这就是为什么你很少看到天才的火花的原因。”**\n> \n\n可能用来解释现今时代的苹果很合适。但是我个人很喜欢现在苹果推出的产品，包括 MacBook Pro 上SD卡槽和 MagSafe 接口的回归，不再是设计师的一意孤行而是权衡了用户诉求的产品。\n\n## 第五章 乔布斯重返苹果\n\n> **停产一个比较受欢迎的产品，大多数高管都会思虑再三。牛顿的支持者拿着标语牌和扬声器，涌进苹果公司总部的停车场（其中一条标语写道：我在乎牛顿）。由于像Palm Pilot这样的掌上电脑的成功，掌上电脑的种类不断增加，但是对乔布斯来说，牛顿只是一个分散注意力的东西。他想让苹果公司将精力集中于电脑，这才是它的核心产品。**\n> \n\n> **“每位设计师都有一个自己的计划表，或是自己的设计理念，（对于他们的活动）根本毫无任何控制可言，”设计师道格·萨茨格说，“一位设计师有一个关于便携笔记本应该如何设计的想法，另一位设计师又有一个关于打印机应该如何设计的想法。但是关于下一代苹果超级电脑应该是什么样子的，却根本没有一个协调统一的想法。这个设计团队并没有建立在协调合作的基础之上。每位设计师都各自为战，都有着自己强烈的设计意识。他们看起来就像是在为许多不同的公司进行设计一样。”**\n> \n\n> **在iMac一体机没有软盘驱动器一事上，乔纳森站在苹果一边。他说：“关于新产品没有软盘驱动器这个问题，我不能代表苹果公司回答你。我只能给你我的回答，‘当人在前进的时候，总是需要把一些东西抛在身后。只要我还有一口气在，我就会继续争论下去，软盘驱动器实在是过时的技术了。我听过很多次这样的抱怨，但是如果前进的道路上没有摩擦，你的脚步就不会像自己希望的那样坚定。’”**\n> \n\n> **乔纳森反驳说，把iMac设计成特别的外形并非是故意为之，它的与众不同是设计过程的必然结果。他说：“我认为很多人起初都把设计看作一种有力的区别手段，能将自己的产品与其他产品相区别，我实在讨厌那种观点。那只是以企业为本，而不是以消费者和人为本。我们的目标不只是要突出自己的产品，而是要创造出在未来会受到人们喜爱的产品，了解这一点非常重要。我们的目标实现之后，结果必然就会与众不同。”**\n> \n\n## 第六章 捷报频传\n\n> **“一切都被记录下来，这是非常必要的。因为很多环节都是动态的。”萨利说道，“即使是我在苹果工作的时候，所有的工艺也都已经确定。这就解释了，为什么对于员工来说，苹果能成为一家很适合为之工作的公司。因为他们有指导工作的手册，在生产软件或是硬件的过程中，这些手册会提供帮助。**\n> \n\n> **“仅仅把狂热的激情放在显而易见的事物上是远远不够的，你需要把注意力和热情放在人们容易忽略的细节上，这才是起决定性作用的。”乔纳森说道。**\n> \n\n## 第七章 铁幕背后的设计工作室\n\n> **在苹果公司，乔纳森的角色一直在演变，逐渐由一位设计师变成了管理层的一分子。他不仅负责团队的管理，也开始着手新成员的招募。同时，他也是设计团队与公司其他部门——尤其是管理层——的信息沟通渠道。他与史蒂夫·乔布斯一直关系密切，而现在，他和公司领导层也是如此——所有新产品开发的种类和研究方向都是他们共同决定的。没有他的指示，什么都没法动工，甚至连产品颜色和按键细节都得由他拍板决定。“一切工作都得经过乔纳森的审阅。”一位设计师说。**\n> \n\n> **与苹果的其他部门相比，乔纳森对自己团队非常袒护。“他会独自承担整个团队的过错，”乔达姆·巴克斯说，“对于设计出现的问题，他会把责任揽在自己身上。如果有哪个环节没有达到标准，他会说那是他的过错。他从未抛下团队中的任何一员。”**\n>\n\n# 《平成十二年》\n\n[平成十二年](https://book.douban.com/subject/30413118/)\n\n## 第7章 党派间的较量\n\n> 日本是一面镜子。当你用狭隘的眼光看这个世界时，你人生的道路也会变得狭隘。那些用与时俱进的眼光看世界的人，早已远远地把你甩在身后。\n> \n\n> 如今，中国人研究日本已经不能只看《菊与刀》了。同样，日本人解剖中国也不能只盯着《阿Q正传》。双方都在进步，都在为寻找新方向而努力。愿以邻为鉴，可知兴衰。\n\n\n# 《重走》\n\n[重走](https://book.douban.com/subject/35436901/)\n\n## 序二 一次神游\n\n> **旅行最宝贵的价值在于更好地理解世界和自我。**\n> \n\n> **当我们回想自己的一生，我们会意识到，旅行是一段徐徐展开的经历，它会在往后的岁月不断制造回响。它是你长期的投资，源源不断地给你发放红利。**\n> \n\n### 第四章 在南岳：我见证了中国吸收欧洲成就最后的伟大日子\n\n> **学生作文文法有误，或不改，或改而不评；行文不贯，改，偶或加评；文不达，而有思想，助其达；文字华丽，作老生之谈，指出其空泛；文达而无新解，不评，也不给好分；文达而有新解，小误不足病**\n> \n\n> **宓一生极少与自然山水近接，故恒溺惑于人事，局囿于道德。即如Wordsworth（华兹华斯）之久居Lake Districts（英国湖区）……皆有助成其文章与修养工夫，亦皆宓所未得尝受”**\n> \n\n> **正如人一肚皮的世故，却有一点童心，满脸上的雀斑，却有两汪秋水，一街的电灯和汽车，却有头上的亮月，我们喜欢热闹，但是难忘记清静”**\n>","slug":"202205ReadingList","published":1,"updated":"2022-07-24T16:47:51.194Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1g0003o76f8hbn9xvu","content":"<p>最近看社会新闻很是头疼，也想着找一些地方发泄一些情绪，结果发现一旦拿起一本书看烦恼就能够暂时解除，便结束了这个念头。<br>今年囫囵吞枣读了不少书，早早达成了一个月读一本书的目标。但是很多书读完一遍过一段时间很难再去梳理，可能等同于没读，于是决定将书里的内容摘出来在博客上分享，也方便自己随时回忆。<br>有些书自己什么时候读完的也不记得了，之后每个月会对自己读的书进行一次整理，这起主要是四本书，《乔纳森传》、《平成十二年》、《UNIX传奇》以及《重走》。</p>\n<span id=\"more\"></span>\n\n\n<h1 id=\"《UNIX传奇》\"><a href=\"#《UNIX传奇》\" class=\"headerlink\" title=\"《UNIX传奇》\"></a>《UNIX传奇》</h1><p><a href=\"https://book.douban.com/subject/35292726/\">UNIX传奇</a></p>\n<p>这本书极大激发了我对于计算机研究的兴趣，从作者的讲述中了解到 UNIX 和实验室的发展历程以及这群人和这群人的创造的影响。</p>\n<p>原来写代码是有使命感的，让我在专注工作的同时能够感受到写代码给我带来的成就感。</p>\n<h3 id=\"1-1-贝尔实验室的物理科学研究\"><a href=\"#1-1-贝尔实验室的物理科学研究\" class=\"headerlink\" title=\"1.1 贝尔实验室的物理科学研究\"></a>1.1 贝尔实验室的物理科学研究</h3><blockquote>\n<p>现今世界已全然不同，多数人只做未来几个月的规划，功夫都花在了预测下一季度财务状况上。</p>\n</blockquote>\n<p>时常能够在网络上看到对于现今人类不思进取的责难，的确，战争时期的人类在科技领域取得了耀眼的成就，近几十年的发展相较于战争时期再或者是冷战时期可以说发展缓慢。现代社会的法则更聚焦于商业上的成功。</p>\n<h3 id=\"1-5-137→127→1127→11276\"><a href=\"#1-5-137→127→1127→11276\" class=\"headerlink\" title=\"1.5 137→127→1127→11276\"></a>1.5 137→127→1127→11276</h3><blockquote>\n<p>相对于“我的人比你的人强”，我们更加会说“别忘记你的人还做了一件好事”。</p>\n</blockquote>\n<p>在工作过程中需要肯定其他团队的成员的价值，懂得谦虚。</p>\n<h3 id=\"3-2-Unix房间\"><a href=\"#3-2-Unix房间\" class=\"headerlink\" title=\"3.2 Unix房间\"></a>3.2 Unix房间</h3><blockquote>\n<p>独立办公室虽然比开放式区域成本更高，但也给了员工安静平和的空间，让员工可以不受旁边没完没了的噪声影响，专注于工作，还能够保存图书、文件，关上门就能沉思或私聊。</p>\n</blockquote>\n<h3 id=\"3-5-丹尼斯·里奇小传\"><a href=\"#3-5-丹尼斯·里奇小传\" class=\"headerlink\" title=\"3.5 丹尼斯·里奇小传\"></a>3.5 丹尼斯·里奇小传</h3><blockquote>\n<p>到了1973年，Unix已经从原来的汇编语言改为C语言编写，系统的维护和修改变得更加容易。</p>\n</blockquote>\n<h3 id=\"4-2-系统调用\"><a href=\"#4-2-系统调用\" class=\"headerlink\" title=\"4.2 系统调用\"></a>4.2 系统调用</h3><blockquote>\n<p><strong>文件只是字节。用户决定这些字节代表什么，而操作系统则只负责存储和取出，不向用户暴露设备属性。</strong></p>\n</blockquote>\n<h3 id=\"4-5-grep命令\"><a href=\"#4-5-grep命令\" class=\"headerlink\" title=\"4.5 grep命令\"></a>4.5 grep命令</h3><blockquote>\n<p><strong>grep这个名字来自ed文本编辑器中的命令g/re/p，它列出所有符合正则表达式模式re的行。</strong></p>\n</blockquote>\n<p>在学习 Linux 的时候接触了这个命令却一直不知道它的历史。</p>\n<h3 id=\"4-7-C语言\"><a href=\"#4-7-C语言\" class=\"headerlink\" title=\"4.7 C语言\"></a>4.7 C语言</h3><blockquote>\n<p><strong>C语言既古怪又有缺点，却获得了巨大的成功。虽然历史上的意外事件肯定有帮助，但C语言显然满足了人们对一种系统实现语言的需求，这种语言需要足够高效，足以取代汇编语言，但又足够抽象和流畅，足以描述各种环境下的算法和交互。</strong></p>\n</blockquote>\n<h3 id=\"5-2-Yacc，Lex，Make\"><a href=\"#5-2-Yacc，Lex，Make\" class=\"headerlink\" title=\"5.2 Yacc，Lex，Make\"></a>5.2 Yacc，Lex，Make</h3><blockquote>\n<p><strong>Lint这个名字来自从衣服上捡拾绒毛（lint）的情景。虽然其功能已多被纳入C语言编译器，但其概念体现到了其他语言的类似工具中。</strong></p>\n</blockquote>\n<h3 id=\"5-3-文档编制\"><a href=\"#5-3-文档编制\" class=\"headerlink\" title=\"5.3 文档编制\"></a>5.3 文档编制</h3><blockquote>\n<p><strong>也许，今天不会有很多人记得，当机器容量以千字节而不是千兆字节为单位时，时间和空间的利用效率乃是重中之重。每个字节都得斟酌使用，所以在某种程度上，每条指令也得再三推敲，因此，一种能在这两方面都节约的语言不仅优秀，而且是实际需要。</strong></p>\n</blockquote>\n<p>在日常写代码的过程中只有在 Code Review 的过程中会关注执行效率，会不曾想到在计算机存储和性能吃紧的时候每一次优化都非常有意义。</p>\n<h3 id=\"5-6-其他贡献\"><a href=\"#5-6-其他贡献\" class=\"headerlink\" title=\"5.6 其他贡献\"></a>5.6 其他贡献</h3><blockquote>\n<p><strong>Unix和C语言被广泛采用，导致20世纪80年代和90年代的CPU设计围绕着它们运转，没人成功制造出为其他语言优化的CPU。</strong></p>\n</blockquote>\n<h3 id=\"6-1-程序员工作台\"><a href=\"#6-1-程序员工作台\" class=\"headerlink\" title=\"6.1 程序员工作台\"></a>6.1 程序员工作台</h3><blockquote>\n<p><strong>SCCS的基本思想是，程序员签出代码库中的一部分，锁定这部分代码，其他程序员在锁持有者解锁之前不能修改它，这样就避免了多位程序员同时对代码做出不一致的修改。当然还是会出问题，如粗心大意或程序崩溃都可能会导致代码死锁。另外，如果锁定范围太大，就会拖慢同时修改的速度。</strong></p>\n</blockquote>\n<h3 id=\"6-2-高校授权\"><a href=\"#6-2-高校授权\" class=\"headerlink\" title=\"6.2 高校授权\"></a>6.2 高校授权</h3><blockquote>\n<p><strong>加利福尼亚大学伯克利分校是最活跃的许可获得者之一，该校的一些研究生对系统做出了重大贡献，最终演化出伯克利软件发行版（Berkeley Software Distribution，BSD）。BSD是由最初的科研版Unix演变而来的两个主要分支之一。</strong></p>\n</blockquote>\n<h3 id=\"8-1-伯克利软件发行版\"><a href=\"#8-1-伯克利软件发行版\" class=\"headerlink\" title=\"8.1 伯克利软件发行版\"></a>8.1 伯克利软件发行版</h3><blockquote>\n<p><strong>BSD的后裔如今仍然活跃，FreeBSD、OpenBSD和NetBSD等变种都在继续发展。苹果公司的Darwin（macOS的核心）所使用的NextSTEP也是BSD的衍生版本。</strong></p>\n</blockquote>\n<h3 id=\"8-3-Minix和Linux\"><a href=\"#8-3-Minix和Linux\" class=\"headerlink\" title=\"8.3 Minix和Linux\"></a>8.3 Minix和Linux</h3><blockquote>\n<p><strong>我相信API不该有版权。如果API有版权，我们就不会有与Unix相似的各种操作系统，包括Linux在内，因为它们全是基于Unix系统调用接口的独立实现。我们可能也不会有Cygwin这样的软件包，它是Unix实用程序的Windows实现，为Windows用户提供了类似Unix的命令行界面。事实上，如果接口的独立实现可以被宣告所有权的公司所限制，我们就不太可能有很多独立实现。</strong></p>\n</blockquote>\n<h3 id=\"8-4-Plan-9\"><a href=\"#8-4-Plan-9\" class=\"headerlink\" title=\"8.4 Plan 9\"></a>8.4 Plan 9</h3><blockquote>\n<p>*Plan 9确实为世界贡献了一件无比重要的东西：Unicode的UTF-8编码。</p>\n</blockquote>\n<h3 id=\"8-5-流散\"><a href=\"#8-5-流散\" class=\"headerlink\" title=\"8.5 流散\"></a>8.5 流散</h3><blockquote>\n<p><strong>朗讯与法国电信公司阿尔卡特（Alcatel）合并成立阿尔卡特-朗讯（Alcatel-Lucent），而阿尔卡特-朗讯又在2016年被诺基亚收购。</strong></p>\n</blockquote>\n<h3 id=\"9-1-技术方面\"><a href=\"#9-1-技术方面\" class=\"headerlink\" title=\"9.1 技术方面\"></a>9.1 技术方面</h3><blockquote>\n<p><strong>人们有时会用代码行数来评价软件的生产力。在Unix的世界里，生产力却往往以删除了多少特殊情况或代码行数来衡量。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>Unix的高明之处在于选择了足够普适的抽象概念，既能发挥巨大的作用，又不至于在性能上付出太大代价。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>Unix哲学是关于如何处理计算任务的编程风格。这是道格·麦基尔罗伊在《贝尔实验室技术杂志》（Bell Labs Technical Journal）Unix特刊的前言中总结出来的。<br>（i）让每个程序做好一件事。要做一件新的工作，就构建新程序，而不是通过增加新“特性”使旧程序复杂化。<br>（ii）预期每个程序的输出都能成为另一个未知程序的输入。不要用无关的信息来干扰输出。避免使用严格的分栏对齐或二进制输入格式。不要执着于交互式输入。<br>（iii）设计和构建软件，甚至是操作系统，要尽早试用，最好是在几周内就用起来。大刀阔斧砍掉笨拙的部件，重建它们。<br>（iv）宁可绕道构建用后即弃的工具来减轻编程负担，也别依赖经验欠奉的帮助。</strong></p>\n</blockquote>\n<h3 id=\"9-2-组织\"><a href=\"#9-2-组织\" class=\"headerlink\" title=\"9.2 组织\"></a>9.2 组织</h3><blockquote>\n<p><strong>研究人员可以长期甚至年复一年地探索他们认为重要的想法，而不必每隔几个月就向人证明自己在努力。</strong></p>\n</blockquote>\n<p>没有背负 KPI 的压力，自己确定自己的研究目标，对于自主的人来说无疑是一件幸福的事。</p>\n<blockquote>\n<p><strong>再优秀的视频会议系统也无法取代就在隔壁的合作者和随手可得的专家。</strong></p>\n</blockquote>\n<p>在 WFH 逐渐流行的今天我也仍然相信这一点。之前在诺基亚公司实习的时候 leader 提到有员工会为了沟通一个业务专程从国外飞来，相信面对面的价值也是这家公司的价值观之一。</p>\n<blockquote>\n<p><strong>积极的研究者能和师生们讨论技术话题，总能学到有用的东西，为公司树立正面形象。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>部门主管应当知晓手下工作的细节，不是为了争论它有多了不起，而是为了能够解释给其他人听，帮助建立联系。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>要建立和维持一个组织，使其成员相互喜欢和尊重，并享受彼此的陪伴，这需要付出努力。不能靠管理部门的命令，也不能靠外部顾问来创造。它是在一起工作的乐趣中有机地成长起来的，也是在一起玩耍的乐趣和互相欣赏中成长起来的。</strong></p>\n</blockquote>\n<p>带一个团队不是团建就足够的，同一家公司同一个部门不同团队的氛围可能都存在较大不同。</p>\n<p>没有人离职的团队不一定是最好的团队，但离职率最高的团队一定是有其原因的，领导肯定负有责任。</p>\n<h3 id=\"9-3-认可\"><a href=\"#9-3-认可\" class=\"headerlink\" title=\"9.3 认可\"></a>9.3 认可</h3><blockquote>\n<p><strong>1993年电影《侏罗纪公园》（Jurassic Park）中有个著名场景，13岁的莱克斯·墨菲[Lex Murphy，阿丽亚娜·理查兹（Ariana Richards）饰]说：“这是个Unix系统! 我会用。”她浏览文件系统，找到大门控制装置，锁上了门，从而使大家免于被迅猛龙吃掉（图9-1）。这一幕可以说是极客们的高峰时刻。</strong></p>\n</blockquote>\n<p>毫不夸张地说这部电影在上映几十年后重映我第一次看印象最深的就是这个镜头。</p>\n<h3 id=\"9-4-历史能重演吗\"><a href=\"#9-4-历史能重演吗\" class=\"headerlink\" title=\"9.4 历史能重演吗\"></a>9.4 历史能重演吗</h3><blockquote>\n<p><strong>似乎可以预见，将会继续有新的语言出现，让编程变得更简单、更安全。同样可以预测，不会只有一种语言，然而每种语言都有得有失，无法满足所有目的。</strong></p>\n</blockquote>\n<h1 id=\"《乔纳森传》\"><a href=\"#《乔纳森传》\" class=\"headerlink\" title=\"《乔纳森传》\"></a>《乔纳森传》</h1><p><a href=\"https://book.douban.com/subject/25786645/\">乔纳森传</a></p>\n<h2 id=\"第二章-英国的设计教育\"><a href=\"#第二章-英国的设计教育\" class=\"headerlink\" title=\"第二章 英国的设计教育\"></a>第二章 英国的设计教育</h2><blockquote>\n<p><strong>20世纪20年代德国的包豪斯建筑学派理念，在20世纪50年代被英国设计界采纳并使用，”她说，“例如，在包豪斯，有所谓的基础学年，而英国的设计专业也有。基础学年就是指，学生从零开始学习设计，与以往的知识没有关系，完全从头开始。”</strong></p>\n</blockquote>\n<p>之前收听 <a href=\"http://anyway.fm/\">Anyway.FM</a> 有一期节目讲述了包豪斯的意义，节目中推荐了<a href=\"https://www.bilibili.com/s/video/BV1Ka4y1a7a2\">梁文道老师的包豪斯纪录片</a>，很值得一看。</p>\n<blockquote>\n<p><strong>乔纳森以一种不同寻常的方式来到了纽卡斯尔综合性工程技术学院：他错过了开学的第一天，因为当时他要去领一个设计奖，这多多少少让一起入学的同学感到震惊。“新生入学的前两天，他都不在——他带着自己高中时的作品去领取一个设计奖。”汤奇回忆说。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>他从不自大，这在学设计的学生中是难得的优点。大多数学设计的学生尽管没多少才华，但是却很自负，而乔纳森完全不一样。做设计的时候，他是真的热爱自己的工作，对于自己的任务，他向来都是全身心投入。”</strong></p>\n</blockquote>\n<h2 id=\"第三章-伦敦的生活\"><a href=\"#第三章-伦敦的生活\" class=\"headerlink\" title=\"第三章 伦敦的生活\"></a>第三章 伦敦的生活</h2><blockquote>\n<p><strong>他对人性化技术非常感兴趣。他设计时总是会先追问一样东西应该是什么样的。他拥有去除或无视某些东西的能力，他不关心一个产品的现状是怎样的，或者一个工程师说它必须是什么样的。他可以从基础开始对任何一样产品或用户界面进行设计。</strong></p>\n</blockquote>\n<p>我认为设计一个 App 和做一个产品也应该是如此，如果只是拿来主义，最终诞生的必然是不如主流产品的产品。</p>\n<blockquote>\n<p><strong>这第一台PowerBook有着嵌入式的键盘、中央定点设备以及前倾的手腕放置区（掌托），足以为未来20年笔记本电脑的设立下基本标准，这一事实至今仍然令大家震惊不已。“我们的PowerBook十分成功，”布伦纳说，“这太让我惊讶了。那台机器和设计本身还有那么多的不足之处。我本以为那将成为一次巨大的失败。但今天回过头来看，基本上所有的笔记本电脑都是那样设计的：嵌入式键盘、掌托以及中央定点设备。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>大多数情况下，当他接受设计委托的时候，许多关键性决策已经由内部做好了。乔纳森逐渐相信，要想成就一件史无前例的新事物，就需要从组织内部进行彻底的变化。</strong></p>\n</blockquote>\n<h2 id=\"第四章-初到苹果\"><a href=\"#第四章-初到苹果\" class=\"headerlink\" title=\"第四章 初到苹果\"></a>第四章 初到苹果</h2><blockquote>\n<p><strong>布伦纳的这些选择是正确的，比如：制作室和工程团队的分离，松散的管理结构，工作流程中的合作以及向咨询模式的转变。苹果公司的设计团队之所以能做到如此高效，其中一个原因就是保留了布伦纳原始的结构。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>1996年，布伦纳成为五角设计旧金山办公室的一员。他和亚马逊合作设计了最早的电子阅读器Kindle，也参与了耐克和惠普很多产品的设计。2007年，布伦纳参与设计了安德烈·罗梅勒（Dr. Dre）品牌的魔音耳机，</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>诺曼说，在某种程度上，这是“一个结构良好的程序”，但是他也指出了它的缺点。它不仅很慢、麻烦、繁琐，而且不可避免会导致“折衷”。当一个小组想这么做，而另一个小组想那样做，特色逐渐就会被取代，导致产品缺乏凝聚力。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>布伦纳说：“商人的想法是创造出每个人都喜欢的东西，这会导致产品走中庸路线。于是就变成了‘能不能达到一致同意’的问题，这就是为什么你很少看到天才的火花的原因。”</strong></p>\n</blockquote>\n<p>可能用来解释现今时代的苹果很合适。但是我个人很喜欢现在苹果推出的产品，包括 MacBook Pro 上SD卡槽和 MagSafe 接口的回归，不再是设计师的一意孤行而是权衡了用户诉求的产品。</p>\n<h2 id=\"第五章-乔布斯重返苹果\"><a href=\"#第五章-乔布斯重返苹果\" class=\"headerlink\" title=\"第五章 乔布斯重返苹果\"></a>第五章 乔布斯重返苹果</h2><blockquote>\n<p><strong>停产一个比较受欢迎的产品，大多数高管都会思虑再三。牛顿的支持者拿着标语牌和扬声器，涌进苹果公司总部的停车场（其中一条标语写道：我在乎牛顿）。由于像Palm Pilot这样的掌上电脑的成功，掌上电脑的种类不断增加，但是对乔布斯来说，牛顿只是一个分散注意力的东西。他想让苹果公司将精力集中于电脑，这才是它的核心产品。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>“每位设计师都有一个自己的计划表，或是自己的设计理念，（对于他们的活动）根本毫无任何控制可言，”设计师道格·萨茨格说，“一位设计师有一个关于便携笔记本应该如何设计的想法，另一位设计师又有一个关于打印机应该如何设计的想法。但是关于下一代苹果超级电脑应该是什么样子的，却根本没有一个协调统一的想法。这个设计团队并没有建立在协调合作的基础之上。每位设计师都各自为战，都有着自己强烈的设计意识。他们看起来就像是在为许多不同的公司进行设计一样。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在iMac一体机没有软盘驱动器一事上，乔纳森站在苹果一边。他说：“关于新产品没有软盘驱动器这个问题，我不能代表苹果公司回答你。我只能给你我的回答，‘当人在前进的时候，总是需要把一些东西抛在身后。只要我还有一口气在，我就会继续争论下去，软盘驱动器实在是过时的技术了。我听过很多次这样的抱怨，但是如果前进的道路上没有摩擦，你的脚步就不会像自己希望的那样坚定。’”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>乔纳森反驳说，把iMac设计成特别的外形并非是故意为之，它的与众不同是设计过程的必然结果。他说：“我认为很多人起初都把设计看作一种有力的区别手段，能将自己的产品与其他产品相区别，我实在讨厌那种观点。那只是以企业为本，而不是以消费者和人为本。我们的目标不只是要突出自己的产品，而是要创造出在未来会受到人们喜爱的产品，了解这一点非常重要。我们的目标实现之后，结果必然就会与众不同。”</strong></p>\n</blockquote>\n<h2 id=\"第六章-捷报频传\"><a href=\"#第六章-捷报频传\" class=\"headerlink\" title=\"第六章 捷报频传\"></a>第六章 捷报频传</h2><blockquote>\n<p><strong>“一切都被记录下来，这是非常必要的。因为很多环节都是动态的。”萨利说道，“即使是我在苹果工作的时候，所有的工艺也都已经确定。这就解释了，为什么对于员工来说，苹果能成为一家很适合为之工作的公司。因为他们有指导工作的手册，在生产软件或是硬件的过程中，这些手册会提供帮助。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>“仅仅把狂热的激情放在显而易见的事物上是远远不够的，你需要把注意力和热情放在人们容易忽略的细节上，这才是起决定性作用的。”乔纳森说道。</strong></p>\n</blockquote>\n<h2 id=\"第七章-铁幕背后的设计工作室\"><a href=\"#第七章-铁幕背后的设计工作室\" class=\"headerlink\" title=\"第七章 铁幕背后的设计工作室\"></a>第七章 铁幕背后的设计工作室</h2><blockquote>\n<p><strong>在苹果公司，乔纳森的角色一直在演变，逐渐由一位设计师变成了管理层的一分子。他不仅负责团队的管理，也开始着手新成员的招募。同时，他也是设计团队与公司其他部门——尤其是管理层——的信息沟通渠道。他与史蒂夫·乔布斯一直关系密切，而现在，他和公司领导层也是如此——所有新产品开发的种类和研究方向都是他们共同决定的。没有他的指示，什么都没法动工，甚至连产品颜色和按键细节都得由他拍板决定。“一切工作都得经过乔纳森的审阅。”一位设计师说。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>与苹果的其他部门相比，乔纳森对自己团队非常袒护。“他会独自承担整个团队的过错，”乔达姆·巴克斯说，“对于设计出现的问题，他会把责任揽在自己身上。如果有哪个环节没有达到标准，他会说那是他的过错。他从未抛下团队中的任何一员。”</strong></p>\n</blockquote>\n<h1 id=\"《平成十二年》\"><a href=\"#《平成十二年》\" class=\"headerlink\" title=\"《平成十二年》\"></a>《平成十二年》</h1><p><a href=\"https://book.douban.com/subject/30413118/\">平成十二年</a></p>\n<h2 id=\"第7章-党派间的较量\"><a href=\"#第7章-党派间的较量\" class=\"headerlink\" title=\"第7章 党派间的较量\"></a>第7章 党派间的较量</h2><blockquote>\n<p>日本是一面镜子。当你用狭隘的眼光看这个世界时，你人生的道路也会变得狭隘。那些用与时俱进的眼光看世界的人，早已远远地把你甩在身后。</p>\n</blockquote>\n<blockquote>\n<p>如今，中国人研究日本已经不能只看《菊与刀》了。同样，日本人解剖中国也不能只盯着《阿Q正传》。双方都在进步，都在为寻找新方向而努力。愿以邻为鉴，可知兴衰。</p>\n</blockquote>\n<h1 id=\"《重走》\"><a href=\"#《重走》\" class=\"headerlink\" title=\"《重走》\"></a>《重走》</h1><p><a href=\"https://book.douban.com/subject/35436901/\">重走</a></p>\n<h2 id=\"序二-一次神游\"><a href=\"#序二-一次神游\" class=\"headerlink\" title=\"序二 一次神游\"></a>序二 一次神游</h2><blockquote>\n<p><strong>旅行最宝贵的价值在于更好地理解世界和自我。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>当我们回想自己的一生，我们会意识到，旅行是一段徐徐展开的经历，它会在往后的岁月不断制造回响。它是你长期的投资，源源不断地给你发放红利。</strong></p>\n</blockquote>\n<h3 id=\"第四章-在南岳：我见证了中国吸收欧洲成就最后的伟大日子\"><a href=\"#第四章-在南岳：我见证了中国吸收欧洲成就最后的伟大日子\" class=\"headerlink\" title=\"第四章 在南岳：我见证了中国吸收欧洲成就最后的伟大日子\"></a>第四章 在南岳：我见证了中国吸收欧洲成就最后的伟大日子</h3><blockquote>\n<p><strong>学生作文文法有误，或不改，或改而不评；行文不贯，改，偶或加评；文不达，而有思想，助其达；文字华丽，作老生之谈，指出其空泛；文达而无新解，不评，也不给好分；文达而有新解，小误不足病</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>宓一生极少与自然山水近接，故恒溺惑于人事，局囿于道德。即如Wordsworth（华兹华斯）之久居Lake Districts（英国湖区）……皆有助成其文章与修养工夫，亦皆宓所未得尝受”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>正如人一肚皮的世故，却有一点童心，满脸上的雀斑，却有两汪秋水，一街的电灯和汽车，却有头上的亮月，我们喜欢热闹，但是难忘记清静”</strong></p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>最近看社会新闻很是头疼，也想着找一些地方发泄一些情绪，结果发现一旦拿起一本书看烦恼就能够暂时解除，便结束了这个念头。<br>今年囫囵吞枣读了不少书，早早达成了一个月读一本书的目标。但是很多书读完一遍过一段时间很难再去梳理，可能等同于没读，于是决定将书里的内容摘出来在博客上分享，也方便自己随时回忆。<br>有些书自己什么时候读完的也不记得了，之后每个月会对自己读的书进行一次整理，这起主要是四本书，《乔纳森传》、《平成十二年》、《UNIX传奇》以及《重走》。</p>","more":"<h1 id=\"《UNIX传奇》\"><a href=\"#《UNIX传奇》\" class=\"headerlink\" title=\"《UNIX传奇》\"></a>《UNIX传奇》</h1><p><a href=\"https://book.douban.com/subject/35292726/\">UNIX传奇</a></p>\n<p>这本书极大激发了我对于计算机研究的兴趣，从作者的讲述中了解到 UNIX 和实验室的发展历程以及这群人和这群人的创造的影响。</p>\n<p>原来写代码是有使命感的，让我在专注工作的同时能够感受到写代码给我带来的成就感。</p>\n<h3 id=\"1-1-贝尔实验室的物理科学研究\"><a href=\"#1-1-贝尔实验室的物理科学研究\" class=\"headerlink\" title=\"1.1 贝尔实验室的物理科学研究\"></a>1.1 贝尔实验室的物理科学研究</h3><blockquote>\n<p>现今世界已全然不同，多数人只做未来几个月的规划，功夫都花在了预测下一季度财务状况上。</p>\n</blockquote>\n<p>时常能够在网络上看到对于现今人类不思进取的责难，的确，战争时期的人类在科技领域取得了耀眼的成就，近几十年的发展相较于战争时期再或者是冷战时期可以说发展缓慢。现代社会的法则更聚焦于商业上的成功。</p>\n<h3 id=\"1-5-137→127→1127→11276\"><a href=\"#1-5-137→127→1127→11276\" class=\"headerlink\" title=\"1.5 137→127→1127→11276\"></a>1.5 137→127→1127→11276</h3><blockquote>\n<p>相对于“我的人比你的人强”，我们更加会说“别忘记你的人还做了一件好事”。</p>\n</blockquote>\n<p>在工作过程中需要肯定其他团队的成员的价值，懂得谦虚。</p>\n<h3 id=\"3-2-Unix房间\"><a href=\"#3-2-Unix房间\" class=\"headerlink\" title=\"3.2 Unix房间\"></a>3.2 Unix房间</h3><blockquote>\n<p>独立办公室虽然比开放式区域成本更高，但也给了员工安静平和的空间，让员工可以不受旁边没完没了的噪声影响，专注于工作，还能够保存图书、文件，关上门就能沉思或私聊。</p>\n</blockquote>\n<h3 id=\"3-5-丹尼斯·里奇小传\"><a href=\"#3-5-丹尼斯·里奇小传\" class=\"headerlink\" title=\"3.5 丹尼斯·里奇小传\"></a>3.5 丹尼斯·里奇小传</h3><blockquote>\n<p>到了1973年，Unix已经从原来的汇编语言改为C语言编写，系统的维护和修改变得更加容易。</p>\n</blockquote>\n<h3 id=\"4-2-系统调用\"><a href=\"#4-2-系统调用\" class=\"headerlink\" title=\"4.2 系统调用\"></a>4.2 系统调用</h3><blockquote>\n<p><strong>文件只是字节。用户决定这些字节代表什么，而操作系统则只负责存储和取出，不向用户暴露设备属性。</strong></p>\n</blockquote>\n<h3 id=\"4-5-grep命令\"><a href=\"#4-5-grep命令\" class=\"headerlink\" title=\"4.5 grep命令\"></a>4.5 grep命令</h3><blockquote>\n<p><strong>grep这个名字来自ed文本编辑器中的命令g/re/p，它列出所有符合正则表达式模式re的行。</strong></p>\n</blockquote>\n<p>在学习 Linux 的时候接触了这个命令却一直不知道它的历史。</p>\n<h3 id=\"4-7-C语言\"><a href=\"#4-7-C语言\" class=\"headerlink\" title=\"4.7 C语言\"></a>4.7 C语言</h3><blockquote>\n<p><strong>C语言既古怪又有缺点，却获得了巨大的成功。虽然历史上的意外事件肯定有帮助，但C语言显然满足了人们对一种系统实现语言的需求，这种语言需要足够高效，足以取代汇编语言，但又足够抽象和流畅，足以描述各种环境下的算法和交互。</strong></p>\n</blockquote>\n<h3 id=\"5-2-Yacc，Lex，Make\"><a href=\"#5-2-Yacc，Lex，Make\" class=\"headerlink\" title=\"5.2 Yacc，Lex，Make\"></a>5.2 Yacc，Lex，Make</h3><blockquote>\n<p><strong>Lint这个名字来自从衣服上捡拾绒毛（lint）的情景。虽然其功能已多被纳入C语言编译器，但其概念体现到了其他语言的类似工具中。</strong></p>\n</blockquote>\n<h3 id=\"5-3-文档编制\"><a href=\"#5-3-文档编制\" class=\"headerlink\" title=\"5.3 文档编制\"></a>5.3 文档编制</h3><blockquote>\n<p><strong>也许，今天不会有很多人记得，当机器容量以千字节而不是千兆字节为单位时，时间和空间的利用效率乃是重中之重。每个字节都得斟酌使用，所以在某种程度上，每条指令也得再三推敲，因此，一种能在这两方面都节约的语言不仅优秀，而且是实际需要。</strong></p>\n</blockquote>\n<p>在日常写代码的过程中只有在 Code Review 的过程中会关注执行效率，会不曾想到在计算机存储和性能吃紧的时候每一次优化都非常有意义。</p>\n<h3 id=\"5-6-其他贡献\"><a href=\"#5-6-其他贡献\" class=\"headerlink\" title=\"5.6 其他贡献\"></a>5.6 其他贡献</h3><blockquote>\n<p><strong>Unix和C语言被广泛采用，导致20世纪80年代和90年代的CPU设计围绕着它们运转，没人成功制造出为其他语言优化的CPU。</strong></p>\n</blockquote>\n<h3 id=\"6-1-程序员工作台\"><a href=\"#6-1-程序员工作台\" class=\"headerlink\" title=\"6.1 程序员工作台\"></a>6.1 程序员工作台</h3><blockquote>\n<p><strong>SCCS的基本思想是，程序员签出代码库中的一部分，锁定这部分代码，其他程序员在锁持有者解锁之前不能修改它，这样就避免了多位程序员同时对代码做出不一致的修改。当然还是会出问题，如粗心大意或程序崩溃都可能会导致代码死锁。另外，如果锁定范围太大，就会拖慢同时修改的速度。</strong></p>\n</blockquote>\n<h3 id=\"6-2-高校授权\"><a href=\"#6-2-高校授权\" class=\"headerlink\" title=\"6.2 高校授权\"></a>6.2 高校授权</h3><blockquote>\n<p><strong>加利福尼亚大学伯克利分校是最活跃的许可获得者之一，该校的一些研究生对系统做出了重大贡献，最终演化出伯克利软件发行版（Berkeley Software Distribution，BSD）。BSD是由最初的科研版Unix演变而来的两个主要分支之一。</strong></p>\n</blockquote>\n<h3 id=\"8-1-伯克利软件发行版\"><a href=\"#8-1-伯克利软件发行版\" class=\"headerlink\" title=\"8.1 伯克利软件发行版\"></a>8.1 伯克利软件发行版</h3><blockquote>\n<p><strong>BSD的后裔如今仍然活跃，FreeBSD、OpenBSD和NetBSD等变种都在继续发展。苹果公司的Darwin（macOS的核心）所使用的NextSTEP也是BSD的衍生版本。</strong></p>\n</blockquote>\n<h3 id=\"8-3-Minix和Linux\"><a href=\"#8-3-Minix和Linux\" class=\"headerlink\" title=\"8.3 Minix和Linux\"></a>8.3 Minix和Linux</h3><blockquote>\n<p><strong>我相信API不该有版权。如果API有版权，我们就不会有与Unix相似的各种操作系统，包括Linux在内，因为它们全是基于Unix系统调用接口的独立实现。我们可能也不会有Cygwin这样的软件包，它是Unix实用程序的Windows实现，为Windows用户提供了类似Unix的命令行界面。事实上，如果接口的独立实现可以被宣告所有权的公司所限制，我们就不太可能有很多独立实现。</strong></p>\n</blockquote>\n<h3 id=\"8-4-Plan-9\"><a href=\"#8-4-Plan-9\" class=\"headerlink\" title=\"8.4 Plan 9\"></a>8.4 Plan 9</h3><blockquote>\n<p>*Plan 9确实为世界贡献了一件无比重要的东西：Unicode的UTF-8编码。</p>\n</blockquote>\n<h3 id=\"8-5-流散\"><a href=\"#8-5-流散\" class=\"headerlink\" title=\"8.5 流散\"></a>8.5 流散</h3><blockquote>\n<p><strong>朗讯与法国电信公司阿尔卡特（Alcatel）合并成立阿尔卡特-朗讯（Alcatel-Lucent），而阿尔卡特-朗讯又在2016年被诺基亚收购。</strong></p>\n</blockquote>\n<h3 id=\"9-1-技术方面\"><a href=\"#9-1-技术方面\" class=\"headerlink\" title=\"9.1 技术方面\"></a>9.1 技术方面</h3><blockquote>\n<p><strong>人们有时会用代码行数来评价软件的生产力。在Unix的世界里，生产力却往往以删除了多少特殊情况或代码行数来衡量。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>Unix的高明之处在于选择了足够普适的抽象概念，既能发挥巨大的作用，又不至于在性能上付出太大代价。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>Unix哲学是关于如何处理计算任务的编程风格。这是道格·麦基尔罗伊在《贝尔实验室技术杂志》（Bell Labs Technical Journal）Unix特刊的前言中总结出来的。<br>（i）让每个程序做好一件事。要做一件新的工作，就构建新程序，而不是通过增加新“特性”使旧程序复杂化。<br>（ii）预期每个程序的输出都能成为另一个未知程序的输入。不要用无关的信息来干扰输出。避免使用严格的分栏对齐或二进制输入格式。不要执着于交互式输入。<br>（iii）设计和构建软件，甚至是操作系统，要尽早试用，最好是在几周内就用起来。大刀阔斧砍掉笨拙的部件，重建它们。<br>（iv）宁可绕道构建用后即弃的工具来减轻编程负担，也别依赖经验欠奉的帮助。</strong></p>\n</blockquote>\n<h3 id=\"9-2-组织\"><a href=\"#9-2-组织\" class=\"headerlink\" title=\"9.2 组织\"></a>9.2 组织</h3><blockquote>\n<p><strong>研究人员可以长期甚至年复一年地探索他们认为重要的想法，而不必每隔几个月就向人证明自己在努力。</strong></p>\n</blockquote>\n<p>没有背负 KPI 的压力，自己确定自己的研究目标，对于自主的人来说无疑是一件幸福的事。</p>\n<blockquote>\n<p><strong>再优秀的视频会议系统也无法取代就在隔壁的合作者和随手可得的专家。</strong></p>\n</blockquote>\n<p>在 WFH 逐渐流行的今天我也仍然相信这一点。之前在诺基亚公司实习的时候 leader 提到有员工会为了沟通一个业务专程从国外飞来，相信面对面的价值也是这家公司的价值观之一。</p>\n<blockquote>\n<p><strong>积极的研究者能和师生们讨论技术话题，总能学到有用的东西，为公司树立正面形象。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>部门主管应当知晓手下工作的细节，不是为了争论它有多了不起，而是为了能够解释给其他人听，帮助建立联系。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>要建立和维持一个组织，使其成员相互喜欢和尊重，并享受彼此的陪伴，这需要付出努力。不能靠管理部门的命令，也不能靠外部顾问来创造。它是在一起工作的乐趣中有机地成长起来的，也是在一起玩耍的乐趣和互相欣赏中成长起来的。</strong></p>\n</blockquote>\n<p>带一个团队不是团建就足够的，同一家公司同一个部门不同团队的氛围可能都存在较大不同。</p>\n<p>没有人离职的团队不一定是最好的团队，但离职率最高的团队一定是有其原因的，领导肯定负有责任。</p>\n<h3 id=\"9-3-认可\"><a href=\"#9-3-认可\" class=\"headerlink\" title=\"9.3 认可\"></a>9.3 认可</h3><blockquote>\n<p><strong>1993年电影《侏罗纪公园》（Jurassic Park）中有个著名场景，13岁的莱克斯·墨菲[Lex Murphy，阿丽亚娜·理查兹（Ariana Richards）饰]说：“这是个Unix系统! 我会用。”她浏览文件系统，找到大门控制装置，锁上了门，从而使大家免于被迅猛龙吃掉（图9-1）。这一幕可以说是极客们的高峰时刻。</strong></p>\n</blockquote>\n<p>毫不夸张地说这部电影在上映几十年后重映我第一次看印象最深的就是这个镜头。</p>\n<h3 id=\"9-4-历史能重演吗\"><a href=\"#9-4-历史能重演吗\" class=\"headerlink\" title=\"9.4 历史能重演吗\"></a>9.4 历史能重演吗</h3><blockquote>\n<p><strong>似乎可以预见，将会继续有新的语言出现，让编程变得更简单、更安全。同样可以预测，不会只有一种语言，然而每种语言都有得有失，无法满足所有目的。</strong></p>\n</blockquote>\n<h1 id=\"《乔纳森传》\"><a href=\"#《乔纳森传》\" class=\"headerlink\" title=\"《乔纳森传》\"></a>《乔纳森传》</h1><p><a href=\"https://book.douban.com/subject/25786645/\">乔纳森传</a></p>\n<h2 id=\"第二章-英国的设计教育\"><a href=\"#第二章-英国的设计教育\" class=\"headerlink\" title=\"第二章 英国的设计教育\"></a>第二章 英国的设计教育</h2><blockquote>\n<p><strong>20世纪20年代德国的包豪斯建筑学派理念，在20世纪50年代被英国设计界采纳并使用，”她说，“例如，在包豪斯，有所谓的基础学年，而英国的设计专业也有。基础学年就是指，学生从零开始学习设计，与以往的知识没有关系，完全从头开始。”</strong></p>\n</blockquote>\n<p>之前收听 <a href=\"http://anyway.fm/\">Anyway.FM</a> 有一期节目讲述了包豪斯的意义，节目中推荐了<a href=\"https://www.bilibili.com/s/video/BV1Ka4y1a7a2\">梁文道老师的包豪斯纪录片</a>，很值得一看。</p>\n<blockquote>\n<p><strong>乔纳森以一种不同寻常的方式来到了纽卡斯尔综合性工程技术学院：他错过了开学的第一天，因为当时他要去领一个设计奖，这多多少少让一起入学的同学感到震惊。“新生入学的前两天，他都不在——他带着自己高中时的作品去领取一个设计奖。”汤奇回忆说。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>他从不自大，这在学设计的学生中是难得的优点。大多数学设计的学生尽管没多少才华，但是却很自负，而乔纳森完全不一样。做设计的时候，他是真的热爱自己的工作，对于自己的任务，他向来都是全身心投入。”</strong></p>\n</blockquote>\n<h2 id=\"第三章-伦敦的生活\"><a href=\"#第三章-伦敦的生活\" class=\"headerlink\" title=\"第三章 伦敦的生活\"></a>第三章 伦敦的生活</h2><blockquote>\n<p><strong>他对人性化技术非常感兴趣。他设计时总是会先追问一样东西应该是什么样的。他拥有去除或无视某些东西的能力，他不关心一个产品的现状是怎样的，或者一个工程师说它必须是什么样的。他可以从基础开始对任何一样产品或用户界面进行设计。</strong></p>\n</blockquote>\n<p>我认为设计一个 App 和做一个产品也应该是如此，如果只是拿来主义，最终诞生的必然是不如主流产品的产品。</p>\n<blockquote>\n<p><strong>这第一台PowerBook有着嵌入式的键盘、中央定点设备以及前倾的手腕放置区（掌托），足以为未来20年笔记本电脑的设立下基本标准，这一事实至今仍然令大家震惊不已。“我们的PowerBook十分成功，”布伦纳说，“这太让我惊讶了。那台机器和设计本身还有那么多的不足之处。我本以为那将成为一次巨大的失败。但今天回过头来看，基本上所有的笔记本电脑都是那样设计的：嵌入式键盘、掌托以及中央定点设备。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>大多数情况下，当他接受设计委托的时候，许多关键性决策已经由内部做好了。乔纳森逐渐相信，要想成就一件史无前例的新事物，就需要从组织内部进行彻底的变化。</strong></p>\n</blockquote>\n<h2 id=\"第四章-初到苹果\"><a href=\"#第四章-初到苹果\" class=\"headerlink\" title=\"第四章 初到苹果\"></a>第四章 初到苹果</h2><blockquote>\n<p><strong>布伦纳的这些选择是正确的，比如：制作室和工程团队的分离，松散的管理结构，工作流程中的合作以及向咨询模式的转变。苹果公司的设计团队之所以能做到如此高效，其中一个原因就是保留了布伦纳原始的结构。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>1996年，布伦纳成为五角设计旧金山办公室的一员。他和亚马逊合作设计了最早的电子阅读器Kindle，也参与了耐克和惠普很多产品的设计。2007年，布伦纳参与设计了安德烈·罗梅勒（Dr. Dre）品牌的魔音耳机，</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>诺曼说，在某种程度上，这是“一个结构良好的程序”，但是他也指出了它的缺点。它不仅很慢、麻烦、繁琐，而且不可避免会导致“折衷”。当一个小组想这么做，而另一个小组想那样做，特色逐渐就会被取代，导致产品缺乏凝聚力。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>布伦纳说：“商人的想法是创造出每个人都喜欢的东西，这会导致产品走中庸路线。于是就变成了‘能不能达到一致同意’的问题，这就是为什么你很少看到天才的火花的原因。”</strong></p>\n</blockquote>\n<p>可能用来解释现今时代的苹果很合适。但是我个人很喜欢现在苹果推出的产品，包括 MacBook Pro 上SD卡槽和 MagSafe 接口的回归，不再是设计师的一意孤行而是权衡了用户诉求的产品。</p>\n<h2 id=\"第五章-乔布斯重返苹果\"><a href=\"#第五章-乔布斯重返苹果\" class=\"headerlink\" title=\"第五章 乔布斯重返苹果\"></a>第五章 乔布斯重返苹果</h2><blockquote>\n<p><strong>停产一个比较受欢迎的产品，大多数高管都会思虑再三。牛顿的支持者拿着标语牌和扬声器，涌进苹果公司总部的停车场（其中一条标语写道：我在乎牛顿）。由于像Palm Pilot这样的掌上电脑的成功，掌上电脑的种类不断增加，但是对乔布斯来说，牛顿只是一个分散注意力的东西。他想让苹果公司将精力集中于电脑，这才是它的核心产品。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>“每位设计师都有一个自己的计划表，或是自己的设计理念，（对于他们的活动）根本毫无任何控制可言，”设计师道格·萨茨格说，“一位设计师有一个关于便携笔记本应该如何设计的想法，另一位设计师又有一个关于打印机应该如何设计的想法。但是关于下一代苹果超级电脑应该是什么样子的，却根本没有一个协调统一的想法。这个设计团队并没有建立在协调合作的基础之上。每位设计师都各自为战，都有着自己强烈的设计意识。他们看起来就像是在为许多不同的公司进行设计一样。”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>在iMac一体机没有软盘驱动器一事上，乔纳森站在苹果一边。他说：“关于新产品没有软盘驱动器这个问题，我不能代表苹果公司回答你。我只能给你我的回答，‘当人在前进的时候，总是需要把一些东西抛在身后。只要我还有一口气在，我就会继续争论下去，软盘驱动器实在是过时的技术了。我听过很多次这样的抱怨，但是如果前进的道路上没有摩擦，你的脚步就不会像自己希望的那样坚定。’”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>乔纳森反驳说，把iMac设计成特别的外形并非是故意为之，它的与众不同是设计过程的必然结果。他说：“我认为很多人起初都把设计看作一种有力的区别手段，能将自己的产品与其他产品相区别，我实在讨厌那种观点。那只是以企业为本，而不是以消费者和人为本。我们的目标不只是要突出自己的产品，而是要创造出在未来会受到人们喜爱的产品，了解这一点非常重要。我们的目标实现之后，结果必然就会与众不同。”</strong></p>\n</blockquote>\n<h2 id=\"第六章-捷报频传\"><a href=\"#第六章-捷报频传\" class=\"headerlink\" title=\"第六章 捷报频传\"></a>第六章 捷报频传</h2><blockquote>\n<p><strong>“一切都被记录下来，这是非常必要的。因为很多环节都是动态的。”萨利说道，“即使是我在苹果工作的时候，所有的工艺也都已经确定。这就解释了，为什么对于员工来说，苹果能成为一家很适合为之工作的公司。因为他们有指导工作的手册，在生产软件或是硬件的过程中，这些手册会提供帮助。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>“仅仅把狂热的激情放在显而易见的事物上是远远不够的，你需要把注意力和热情放在人们容易忽略的细节上，这才是起决定性作用的。”乔纳森说道。</strong></p>\n</blockquote>\n<h2 id=\"第七章-铁幕背后的设计工作室\"><a href=\"#第七章-铁幕背后的设计工作室\" class=\"headerlink\" title=\"第七章 铁幕背后的设计工作室\"></a>第七章 铁幕背后的设计工作室</h2><blockquote>\n<p><strong>在苹果公司，乔纳森的角色一直在演变，逐渐由一位设计师变成了管理层的一分子。他不仅负责团队的管理，也开始着手新成员的招募。同时，他也是设计团队与公司其他部门——尤其是管理层——的信息沟通渠道。他与史蒂夫·乔布斯一直关系密切，而现在，他和公司领导层也是如此——所有新产品开发的种类和研究方向都是他们共同决定的。没有他的指示，什么都没法动工，甚至连产品颜色和按键细节都得由他拍板决定。“一切工作都得经过乔纳森的审阅。”一位设计师说。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>与苹果的其他部门相比，乔纳森对自己团队非常袒护。“他会独自承担整个团队的过错，”乔达姆·巴克斯说，“对于设计出现的问题，他会把责任揽在自己身上。如果有哪个环节没有达到标准，他会说那是他的过错。他从未抛下团队中的任何一员。”</strong></p>\n</blockquote>\n<h1 id=\"《平成十二年》\"><a href=\"#《平成十二年》\" class=\"headerlink\" title=\"《平成十二年》\"></a>《平成十二年》</h1><p><a href=\"https://book.douban.com/subject/30413118/\">平成十二年</a></p>\n<h2 id=\"第7章-党派间的较量\"><a href=\"#第7章-党派间的较量\" class=\"headerlink\" title=\"第7章 党派间的较量\"></a>第7章 党派间的较量</h2><blockquote>\n<p>日本是一面镜子。当你用狭隘的眼光看这个世界时，你人生的道路也会变得狭隘。那些用与时俱进的眼光看世界的人，早已远远地把你甩在身后。</p>\n</blockquote>\n<blockquote>\n<p>如今，中国人研究日本已经不能只看《菊与刀》了。同样，日本人解剖中国也不能只盯着《阿Q正传》。双方都在进步，都在为寻找新方向而努力。愿以邻为鉴，可知兴衰。</p>\n</blockquote>\n<h1 id=\"《重走》\"><a href=\"#《重走》\" class=\"headerlink\" title=\"《重走》\"></a>《重走》</h1><p><a href=\"https://book.douban.com/subject/35436901/\">重走</a></p>\n<h2 id=\"序二-一次神游\"><a href=\"#序二-一次神游\" class=\"headerlink\" title=\"序二 一次神游\"></a>序二 一次神游</h2><blockquote>\n<p><strong>旅行最宝贵的价值在于更好地理解世界和自我。</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>当我们回想自己的一生，我们会意识到，旅行是一段徐徐展开的经历，它会在往后的岁月不断制造回响。它是你长期的投资，源源不断地给你发放红利。</strong></p>\n</blockquote>\n<h3 id=\"第四章-在南岳：我见证了中国吸收欧洲成就最后的伟大日子\"><a href=\"#第四章-在南岳：我见证了中国吸收欧洲成就最后的伟大日子\" class=\"headerlink\" title=\"第四章 在南岳：我见证了中国吸收欧洲成就最后的伟大日子\"></a>第四章 在南岳：我见证了中国吸收欧洲成就最后的伟大日子</h3><blockquote>\n<p><strong>学生作文文法有误，或不改，或改而不评；行文不贯，改，偶或加评；文不达，而有思想，助其达；文字华丽，作老生之谈，指出其空泛；文达而无新解，不评，也不给好分；文达而有新解，小误不足病</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>宓一生极少与自然山水近接，故恒溺惑于人事，局囿于道德。即如Wordsworth（华兹华斯）之久居Lake Districts（英国湖区）……皆有助成其文章与修养工夫，亦皆宓所未得尝受”</strong></p>\n</blockquote>\n<blockquote>\n<p><strong>正如人一肚皮的世故，却有一点童心，满脸上的雀斑，却有两汪秋水，一街的电灯和汽车，却有头上的亮月，我们喜欢热闹，但是难忘记清静”</strong></p>\n</blockquote>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Mon Jul 25 2022 00:47:51 GMT+0800 (中国标准时间)","title":"2022年五月读书摘录","path":"2022/06/15/202205ReadingList/","eyeCatchImage":null,"excerpt":"<p>最近看社会新闻很是头疼，也想着找一些地方发泄一些情绪，结果发现一旦拿起一本书看烦恼就能够暂时解除，便结束了这个念头。<br>今年囫囵吞枣读了不少书，早早达成了一个月读一本书的目标。但是很多书读完一遍过一段时间很难再去梳理，可能等同于没读，于是决定将书里的内容摘出来在博客上分享，也方便自己随时回忆。<br>有些书自己什么时候读完的也不记得了，之后每个月会对自己读的书进行一次整理，这起主要是四本书，《乔纳森传》、《平成十二年》、《UNIX传奇》以及《重走》。</p>","date":{"_isAMomentObject":true,"_i":"2022-06-15T05:10:12.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-06-15T05:10:12.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"阅读","tags":["读书","乔纳森传","平成十二年","UNIX传奇","西南联大","重走"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":6310},{"title":"控制器组件 Action 实验","date":"2020-02-26T03:10:20.000Z","_content":"包含 控制器组件 Action 知识梳理、实验步骤、实验整理方面的总结。\n<!--more-->\n\n## 知识梳理\n\n1、Action 类中的默认方法名是 execute()方法，可以被自动调用； \n\n2、在 Action 中也允许定义其它方法名，可以同时定义多个方法，分别处理不同的逻辑；\n\n3、当 Action 中使用了自定义方法，则该 Action 就需要特定的配置，一般有四种调用方式： \n\n- 在 struts.xml 文件中通过 method 属性指定方法名； \n- 使用动态方法调用方式（DMI）； \n- 使用提交按钮的 method 属性； \n- 使用通配符配置 Action； \n\n4、Action 类是多实例的，Action 类的属性是线程安全的； \n\n5、在 JSP 页面中，可以通过 Struts2 标签调用 Action 中对应的 getter 方法，从而输出 Action 的属性值； \n\n6、当一个 Action 处理用户请求结束后，返回一个字符串作为逻辑视图名，再通过 `struts.xml` 文件中的配置将逻辑视图名与物理视图资源关联起来；Struts2默认提供了一系列的结果类型（`struts-default.xml` 配置文件的 result-types 标签里列出了所支持的结果类型），结果类型决定了 Action 处理结束后，将调用哪种视图资源来呈现处理结果。\n\n7、为了让用户开发的 Action 类更规范，Struts2 提供了一个 Action 接口，该接口定义了 Struts2 的 Action 处理类应该实现的规范； \n\n8、Struts2 还为 Action 接口提供了一个实现类：ActionSupport，该类提供了若干默认方法，包括：默认的处理用户请求的方法（excute()方法）、数据校验的方法、添加校验错误信息的方法、获取国际化信息的方法等，部分重要方法列表如下：\n\n![](http://image.stephenfang.me/mweb/java/1.png)\n \n9、Struts2 框架提供了校验器和手工编码两种方式对请求参数进行数据校验，当 Action 类继承了 ActionSupport 类，就可以通过定义名为“<ActionClassName>- <ActionAliasName>-validation.xml”的校验规则文件的方法进行校验器校验， 也可以通过重写 ActionSupport 类的 validate()方法或 validateXxx()方法进行手动校验； \n\n10、在 JSP 页面中使用 Struts2 标签生成的表单，能将域级别的错误信息将自动显示到表单元素处； \n\n11、在 JSP 页面中使用 fielderror 标签，可以集中显示所有的域级错误信息；使用 actionerror 标签，可以显示所有的 Action 级别错误信息；使用 actionmessage 标签，可以显示 Action 消息； \n\n12、Struts2 框架中提供了部分内置的类型转换器，可以将请求参数的 String 类型转换成基本数据类型及对应的包装器类型、日期类型、数组类型、集合类型等，当 Action 类继承了 ActionSupport 类，则内置的类型转换器将默认生效，可以直接使用； \n\n13、如需修改默认的类型转换校验信息，则要在 Action 类的包中声明名为“Action 类名.properties”的局部属性文件； \n\n14、Struts2 框架同时支持自定义类型转换器，将请求参数转换成任意一种类型。\n\n15、Struts2 框架中的 Action 类没有与任何 Servlet API 耦合，因此 Action 类可以脱 离 Servlet 容器环境进行单元测试； \n\n16、ActionContext 是 `com.opensymphony.xwork2` 包中的一个类，该类表示一个 Action 运行时的上下文；\n\n17、当 Action 类需要通过请求、会话或上下文存取属性时，可以通过 ActionContext 类完成， 也可以通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware 完成，而不必调用 Servlet API 中的 HttpServletRequest、 HttpSession 和 ServletContext 对象，从而保持 Action 与 Servlet API 的解耦； \n\n18、在 Action 类中直接访问 Servlet API， 可以通过实现 Struts2 提供的接口： ServletContextAware、ServletRequestAware、ServletResponseAware 完成，也可以通过 ServletActionContext 工具类实现，但 Action 将与 Servlet API 直接耦合。\n\n## 实验总结\n**1、总结 Action 自定义方法的四种调用和配置方式**\n\n- 在 `struts.xml` 文件中通过method属性指定方法名：以actionName.action形式访问，但是要配置多个action较为麻烦\n- 使用动态方法调用方式：以 actionName!methodName.action 形式访问，要注意UserAction下的login和register方法不能有相同的result返回值\n- 使用提交按钮的method属性：以actionName!methodName.action形式访问，但是需要在.jsp页面中配置，只能用于表单中\n- 使用通配符配置Action：以actionName.action形式访问，相对更为普遍的方式\n\n**2、Action 的实例化情况，将 Action 与 Servlet 在实例化情况上进行对比**\n\n在Struts2中每提交一次表单数据Action就被实例化一次，而Servlet在被创建时就被实例化，多次访问页面Servlet不会被多次实例化。\n\n**3、分析 JSP 文件中获取 Action 属性的主要过程**\n\nJSP 文件中获取 Action 属性以JavaBean来实现，所封装的属性和表单的属性一一对应，JavaBean将成为数据传递的载体来进行数据的传递。\n\n**4、观察两次 `loginSuccess.jsp` 页面输出上的区别，分析原因并记录下来**\nredirect采用客户端重定向的方式，而默认的dispatcher采用服务器内部跳转的方式，所以当result的type属性被设置为redirect时无法获取到Action中的count属性而dispatcher的方式可以。\n\n**5、解压缩 Struts2 的核心包 struts2-core-2.3.15.1.jar，找到 struts-`default.xml` 配置文件，在其中的 result-types 标签里列出了 Struts2 所支持的结果类型，查找相关资料，总结这些结果类型的作用和特点，并记录下来；**\n \n- chain：服务器内部跳转，调用其他action,完成自定义的拦截器堆栈和结果。只能请求action,如果请求视图资源会报错。\n- dispatcher: 默认值，服务器内部跳转(跳转到web组件)\n- freemarker：使用Freemarker模板引擎呈现一个视图\n- httpheader：通过设置HTTP headers和status的值来发送错误信息给客户端。\n- redirect: 作客户端重定向(重定向到web组件)\n- redirectAction: 作客户端重定向(重定向到其他Action)\n- stream:用作下载文件或者在浏览器上显示PDF等文档\n- velocity:使用Servlet容器的JspFactory,模拟JSP执行环境,显示Velocity模板,将直接传输到Servlet输出。\n- plaintext:响应以plain形式返回给客户端,相当于`response.setContentType(\"text/plain; charset=\"+charSet);`\n\n**6、总结 Action 类中 validate()方法和 validateXxx()方法的作用**\n\n-  validate()方法：将对页面表单验证的内容写到validate()方法中，实现验证和业务处理内容的分离，validate()方法会对Action类中所有业务方法起作用\n-  validateXxx()方法：当多个表单提交到同一个action页面是，validate()方法对所有表单生效，可以使用validateXxx()方法实现对某一个业务的验证，validate()方法和 validateXxx()方法同时存在时都会起作用；validateXxx()方法的调用优于validate()方法\n\n**7、总结使用校验器校验的方法；在 Struts2 的核心包 xwork-core-**\n**2.3.15.1.jar\\com\\opensymphony\\xwork2\\validator\\validators路径下找到 default.xml 文件，总结校验规则文件中主要元素的作用和配置方法**\n\n- required：必填校验器  \n- requiredstring：必填字符串校验器  \n- stringlength:字符串长度校验器 \n- date:日期校验器  \n- expression：表达式校验器  \n- int:整数校验器 \n- fieldexpression：字段表达式校验器\n- url:网址校验器  \n- regex：正则表达式校验器 \n\n```xml\n<validators>\n  <field name=\"被校验的字段\">\n     <field-validator type=\"校验器的类型\">\n        <param name=\"参数名\">参数值</param>\n         <message> 提示信息</message>\n     </field-validator>\n  </field>\n  <!--下一个要验证的字段--> \n</validators>\n```\n\n```xml\n<valiators>\n  <validator type=\"校验器类型名\">\n     <!--fieldName固定的 N必须大写-->\n     <param name=\"fieldName\">需要被校验的字段</param>\n      <!--下面的param元素可以有0个或者多个--> \n     <param name=\"参数名\">参数值</param>\n    <message key=\"I18NKey\">提示信息</message>\n  </validator>\n</validators>\n```\n\n**8、总结在 Action 中使用国际化资源文件的步骤及方法**\n\n首先创建不同语言环境下的.properties文件，在文件中写入不同key字段的国际化资源，使用ActionSupport类的getText方法，该方法可以接受一个name参数，指定国际化资源文件中的key数值，最后使用native2ascii工具进行处理。\n\n**9、总结 Struts2 中常用的内置类型转换器及其使用方法**\n\n- String:将int,double,boolean,String类型的数组或java.util.Date类型转换成字符串。\n- boolean和Boolean:在字符串与boolean之间转换\n- char/Character:在字符串和字符之间转换\n- int/Integer,float/Float,long/Long,double/Double:在字符串与数值类型之间进行转换 \n- date:在字符串和日期类型之间进行转换，默认格式是:YYYY-MM-DD\n- 数组:由于数组本身就有类型，可以将多个同名参数，转换到数组中(在之前总结的兴趣爱好多选择，如果你选择多个，同时他们name属性相同就自动变为数组)\n- 集合:支持将数据保存到List或者Map集合\n\n**10、观察 Action 中访问 Servlet API 的四种方法，总结四种方法的区别，并记录下来**\n\n- 通过ActionContext类访问：\n使用这种方法访问的前提是必须先要获取ActionContext对象，优点是Action和Servlet API完全解耦，缺点是并不能调用原生的Servlet API\n\n- Action直接访问:\n使用这种方法可以调用原生的Servlet API，但是需要实现对应的接口\n\n- \t通过ServletActionContext访问:\n使用ServletActionContext工具类无需实现接口，就可以直接访问Servlet API，但是会加强Action和Servlet API的耦合，不利于Action的再利用。\n\n- 实现ServletContextAware、ServletRequestAware、ServletResponseAware接口访问:\nAction与Servlet API直接耦合，需要调用ServletContext和ServletRequest等set方法。\n\n## 实验步骤\n### 基础实验\n\n1、新建 Web 工程 struts-prj2，并将 Struts2 中的 8 个核心包添加到工程中； \n\n2、在 struts-prj2 中新建 login.jsp 页面，作为用户登录的视图；新建 loginFail.jsp 页面，作为登录失败的视图；新建 loginSuccess.jsp 页面，作为登录成功的视图;\n\n3、在 struts-prj2 中新建 register.jsp 页面，作为用户注册的视图；新建regFail.jsp 页面，作为注册失败的视图；新建 regSuccess.jsp 页面，作为注册成功的视图;\n\n4、在 struts-prj2 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于 记录用户信息 （可重用“实验二 Struts 基础应用 ”中提高实验里的 UserBean.java 代码）； \n\n5、在 struts-prj2 中新建 cn.edu.zjut.service 包，并在其中创UserService.java， 用于实现登录逻辑和注册逻辑;\n\n6、在 struts-prj2 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，定义login()方法和 register()方法\n\n7、在工程struts-prj2 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，通过 action 标签中 method 属性指定方法名；\n\n8、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； \n\n9、将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 与 register.jsp页面，并记录运行结果； \n\n10、查找相关资料， 尝试使用 Action 自定义方法的其它三种调用和配置方式：动态方法调用方式（DMI）、提交按钮的 method 属性、通配符配置 Action，并记录关键配置和运行结果； \n \n![](http://image.stephenfang.me/mweb/java/DMI.png)\n  \n![](http://image.stephenfang.me/mweb/java/button.png)\n \n![](http://image.stephenfang.me/mweb/java/uni.png)\n\n11、修改 UserAction.java，增加 UserAction 类的构造方法 UserAction()，增加 count属性，用于测试 Action 的实例化情况\n\n![](http://image.stephenfang.me/mweb/java/2.png)\n\n12、修改 `loginSuccess.jsp`，在页面中使用<s:property>标签输出 Action 中的 count 值； \n\n```\n<s:property value=\"count\" />\n```\n\n13、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 并刷新多次，记录运行结果； \n\n![](http://image.stephenfang.me/mweb/java/3.png)\n\n14、修改 struts.xml 文件，将 UserAction 的页面导航设置为 redirect 结果类型；\n\n```\n<result name=\"success\" type=\"redirect\">/loginSuccess.jsp</result>\n```\n\n15、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察登录成功后 loginSuccess.jsp 页面的输出，并记录下来。\n\n![](http://image.stephenfang.me/mweb/java/4.png)\n\n### 提高实验\n1、在 struts-prj2 中修改 UserAction 类，使其继承 ActionSupport 类，并在 UserAction 类中覆盖 ActionSupport 类的 validate()方法， 用于对用户登录的请求参 数 account 和 password 进行校验：若用户名或密码为空，则使用 addFieldError （域 级）添加错误信息。\n\n![](http://image.stephenfang.me/mweb/java/5.png)\n\n2、修改 `struts.xml` 文件，在 Action 的配置中增加 validate()方法校验出错时的页面导航`<result name=\"input\">`\n\n![](http://image.stephenfang.me/mweb/java/6.png)\n\n3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/7.png)\n\n4、修改 `login.jsp` 页面，在表单前增加 fielderror 标签：`<s:fielderror/>`，再通过浏览器访问 login.jsp 页面，观察并记录运行结果\n\n![](http://image.stephenfang.me/mweb/java/8.png)\n\n5、修改 UserAction.java，在调用登录逻辑的 login()方法中，对登录情况进行校验： 若登录成功，使用 addActionMessage()方法添加“登录成功！”的 Action 提示消息，若 登录失败，使用 addActionError()方法添加 Action 级别的错误信息\n\n![](http://image.stephenfang.me/mweb/java/9.png)\n\n6、修改 login.jsp 页面，增加 actionerror 标签（<s:actionerror/>）Action 级别的 错 误信息；修改 `loginSuccess.jsp`，使用 actionmessage 标签`<s:actionmessage/>` 显示 Action 提示消息； \n\n7、修改 `struts.xml` 文件中用户登录的页面导航设置，将登录失败时转向的页面从 loginFail.jsp 修改为 login.jsp； \n\n8、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/10.png)\n\n9、在工程 struts-prj2 中创建“UserAction-login-validation.xml”校验规则文件，使 其与 UserAction 类位于同一目录下，配置校验信息，使用校验器对请求参数进行校验 \n\n10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/11.png)\n\n11、将 login.jsp、 loginSuccess.jsp、 loginFail.jsp 三个页面进行国际化处理，把需要进行国际化的内容 以键值对的形式写入资源文件 `message_zh_CN.properties` 和 `message_en_US.properties` 中； \n\n12、在资源文件中添加校验信息的键值对， 并使用 native2ASCII 工具，将 `message_zh_CN.properties` 重新编码，将中文字符都转化为 unicode 码 \n\n13、在工程 struts-prj2 的 src 目录中创建 `struts.properties` 文件，通过它加载资源文件 \n\n14、修改 `UserAction.java`，使用 ActionSupport 类的 getText()方法，获取国际化资 源文件中的信息 \n\n15、修改 `UserAction-login-validation.xml`，获取国际化资源文件中的信息 \n\n16、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/12.png)\n\n17、修改 `UserBean.java`，将用于保存注册用户生日的变量类型改为 Date 类型，使用 Struts2 内置的类型转换器对请求参数进行校验； \n\n18、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，当用户输入的生日不合法时，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/13.png)\n\n19、在工程 struts-prj2 的 cn.edu.zjut.action 包中创建局部属性文件`UserAction.properties`，修改类型转换的校验信息，并使用 native2ASCII 工具将 `UserAction.properties` 重新编码 \n\n20、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，当用户输入的生日不合法时，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/na.png)\n\n21、参考实验步骤 9，在工程 struts-prj2 的 cn.edu.zjut.action 包中创建 `UserAction-register-validation.xml` 文件，增加校验信息的配置，使用校验器对用户 注册的请求参数进行校验，要求注册时两次密码输入相同、email 地址格式符合要求等； \n\n22、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/14.png)\n\n23、修改 UserAction 类， 将 validate()的方法名改为 validateLogin()， 并增加 validateRegister()方法，参考实验步骤 1，使用手工编码方式对请求参数进行数据校验； \n\n24、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，观察并记录运行结果。\n\n![](http://image.stephenfang.me/mweb/java/15.png)\n\n### 拓展实验\n\n1、在 struts-prj2 中修改 UserAction 类，通过 ActionContext 获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 \n\n2、修改 `loginSuccess.jsp` 页面，从请求、会话和上下文对象中获取属性值并显示 在页面中 \n\n3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/16.png)\n\n**每提交一次刷新，次数就会增加一次，只有重新部署访问次数才会重置** \n\n4、修改 UserAction 类，通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware，获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 \n\n5、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/17.png)\n\n6、修改 UserAction 类，查找相关资料，尝试通过接口：ServletContextAware、 ServletRequestAware、ServletResponseAware 直接访问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；\n\n![](http://image.stephenfang.me/mweb/java/18.png)\n\n![](http://image.stephenfang.me/mweb/java/19.png)\n\n\n7、修改 UserAction 类，查找相关资料，尝试通过 ServletActionContext 工具类直接访 问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；\n\n![](http://image.stephenfang.me/mweb/java/20.png)\n\n![](http://image.stephenfang.me/mweb/java/21.png)\n\n8、尝试利用 Servlet API 添加购物车功能，在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 `Item.java` 用于记录商品信息\n\n9、在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 `ShopppingCart.java` 用于记录用户的购物车信息，为简化操作，在购物车的构造函数中加入商品信息 \n\n10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp `页面， 观察并记录运行结果。\n\n![](http://image.stephenfang.me/mweb/java/22.png)\n","source":"_posts/Action_Experiment.md","raw":"---\ntitle: 控制器组件 Action 实验\ndate: 2020-02-26 11:10:20\ncategories: \n- 技术\ntags: \n- struts\n- JavaEE\n- 总结\n- 实验\n---\n包含 控制器组件 Action 知识梳理、实验步骤、实验整理方面的总结。\n<!--more-->\n\n## 知识梳理\n\n1、Action 类中的默认方法名是 execute()方法，可以被自动调用； \n\n2、在 Action 中也允许定义其它方法名，可以同时定义多个方法，分别处理不同的逻辑；\n\n3、当 Action 中使用了自定义方法，则该 Action 就需要特定的配置，一般有四种调用方式： \n\n- 在 struts.xml 文件中通过 method 属性指定方法名； \n- 使用动态方法调用方式（DMI）； \n- 使用提交按钮的 method 属性； \n- 使用通配符配置 Action； \n\n4、Action 类是多实例的，Action 类的属性是线程安全的； \n\n5、在 JSP 页面中，可以通过 Struts2 标签调用 Action 中对应的 getter 方法，从而输出 Action 的属性值； \n\n6、当一个 Action 处理用户请求结束后，返回一个字符串作为逻辑视图名，再通过 `struts.xml` 文件中的配置将逻辑视图名与物理视图资源关联起来；Struts2默认提供了一系列的结果类型（`struts-default.xml` 配置文件的 result-types 标签里列出了所支持的结果类型），结果类型决定了 Action 处理结束后，将调用哪种视图资源来呈现处理结果。\n\n7、为了让用户开发的 Action 类更规范，Struts2 提供了一个 Action 接口，该接口定义了 Struts2 的 Action 处理类应该实现的规范； \n\n8、Struts2 还为 Action 接口提供了一个实现类：ActionSupport，该类提供了若干默认方法，包括：默认的处理用户请求的方法（excute()方法）、数据校验的方法、添加校验错误信息的方法、获取国际化信息的方法等，部分重要方法列表如下：\n\n![](http://image.stephenfang.me/mweb/java/1.png)\n \n9、Struts2 框架提供了校验器和手工编码两种方式对请求参数进行数据校验，当 Action 类继承了 ActionSupport 类，就可以通过定义名为“<ActionClassName>- <ActionAliasName>-validation.xml”的校验规则文件的方法进行校验器校验， 也可以通过重写 ActionSupport 类的 validate()方法或 validateXxx()方法进行手动校验； \n\n10、在 JSP 页面中使用 Struts2 标签生成的表单，能将域级别的错误信息将自动显示到表单元素处； \n\n11、在 JSP 页面中使用 fielderror 标签，可以集中显示所有的域级错误信息；使用 actionerror 标签，可以显示所有的 Action 级别错误信息；使用 actionmessage 标签，可以显示 Action 消息； \n\n12、Struts2 框架中提供了部分内置的类型转换器，可以将请求参数的 String 类型转换成基本数据类型及对应的包装器类型、日期类型、数组类型、集合类型等，当 Action 类继承了 ActionSupport 类，则内置的类型转换器将默认生效，可以直接使用； \n\n13、如需修改默认的类型转换校验信息，则要在 Action 类的包中声明名为“Action 类名.properties”的局部属性文件； \n\n14、Struts2 框架同时支持自定义类型转换器，将请求参数转换成任意一种类型。\n\n15、Struts2 框架中的 Action 类没有与任何 Servlet API 耦合，因此 Action 类可以脱 离 Servlet 容器环境进行单元测试； \n\n16、ActionContext 是 `com.opensymphony.xwork2` 包中的一个类，该类表示一个 Action 运行时的上下文；\n\n17、当 Action 类需要通过请求、会话或上下文存取属性时，可以通过 ActionContext 类完成， 也可以通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware 完成，而不必调用 Servlet API 中的 HttpServletRequest、 HttpSession 和 ServletContext 对象，从而保持 Action 与 Servlet API 的解耦； \n\n18、在 Action 类中直接访问 Servlet API， 可以通过实现 Struts2 提供的接口： ServletContextAware、ServletRequestAware、ServletResponseAware 完成，也可以通过 ServletActionContext 工具类实现，但 Action 将与 Servlet API 直接耦合。\n\n## 实验总结\n**1、总结 Action 自定义方法的四种调用和配置方式**\n\n- 在 `struts.xml` 文件中通过method属性指定方法名：以actionName.action形式访问，但是要配置多个action较为麻烦\n- 使用动态方法调用方式：以 actionName!methodName.action 形式访问，要注意UserAction下的login和register方法不能有相同的result返回值\n- 使用提交按钮的method属性：以actionName!methodName.action形式访问，但是需要在.jsp页面中配置，只能用于表单中\n- 使用通配符配置Action：以actionName.action形式访问，相对更为普遍的方式\n\n**2、Action 的实例化情况，将 Action 与 Servlet 在实例化情况上进行对比**\n\n在Struts2中每提交一次表单数据Action就被实例化一次，而Servlet在被创建时就被实例化，多次访问页面Servlet不会被多次实例化。\n\n**3、分析 JSP 文件中获取 Action 属性的主要过程**\n\nJSP 文件中获取 Action 属性以JavaBean来实现，所封装的属性和表单的属性一一对应，JavaBean将成为数据传递的载体来进行数据的传递。\n\n**4、观察两次 `loginSuccess.jsp` 页面输出上的区别，分析原因并记录下来**\nredirect采用客户端重定向的方式，而默认的dispatcher采用服务器内部跳转的方式，所以当result的type属性被设置为redirect时无法获取到Action中的count属性而dispatcher的方式可以。\n\n**5、解压缩 Struts2 的核心包 struts2-core-2.3.15.1.jar，找到 struts-`default.xml` 配置文件，在其中的 result-types 标签里列出了 Struts2 所支持的结果类型，查找相关资料，总结这些结果类型的作用和特点，并记录下来；**\n \n- chain：服务器内部跳转，调用其他action,完成自定义的拦截器堆栈和结果。只能请求action,如果请求视图资源会报错。\n- dispatcher: 默认值，服务器内部跳转(跳转到web组件)\n- freemarker：使用Freemarker模板引擎呈现一个视图\n- httpheader：通过设置HTTP headers和status的值来发送错误信息给客户端。\n- redirect: 作客户端重定向(重定向到web组件)\n- redirectAction: 作客户端重定向(重定向到其他Action)\n- stream:用作下载文件或者在浏览器上显示PDF等文档\n- velocity:使用Servlet容器的JspFactory,模拟JSP执行环境,显示Velocity模板,将直接传输到Servlet输出。\n- plaintext:响应以plain形式返回给客户端,相当于`response.setContentType(\"text/plain; charset=\"+charSet);`\n\n**6、总结 Action 类中 validate()方法和 validateXxx()方法的作用**\n\n-  validate()方法：将对页面表单验证的内容写到validate()方法中，实现验证和业务处理内容的分离，validate()方法会对Action类中所有业务方法起作用\n-  validateXxx()方法：当多个表单提交到同一个action页面是，validate()方法对所有表单生效，可以使用validateXxx()方法实现对某一个业务的验证，validate()方法和 validateXxx()方法同时存在时都会起作用；validateXxx()方法的调用优于validate()方法\n\n**7、总结使用校验器校验的方法；在 Struts2 的核心包 xwork-core-**\n**2.3.15.1.jar\\com\\opensymphony\\xwork2\\validator\\validators路径下找到 default.xml 文件，总结校验规则文件中主要元素的作用和配置方法**\n\n- required：必填校验器  \n- requiredstring：必填字符串校验器  \n- stringlength:字符串长度校验器 \n- date:日期校验器  \n- expression：表达式校验器  \n- int:整数校验器 \n- fieldexpression：字段表达式校验器\n- url:网址校验器  \n- regex：正则表达式校验器 \n\n```xml\n<validators>\n  <field name=\"被校验的字段\">\n     <field-validator type=\"校验器的类型\">\n        <param name=\"参数名\">参数值</param>\n         <message> 提示信息</message>\n     </field-validator>\n  </field>\n  <!--下一个要验证的字段--> \n</validators>\n```\n\n```xml\n<valiators>\n  <validator type=\"校验器类型名\">\n     <!--fieldName固定的 N必须大写-->\n     <param name=\"fieldName\">需要被校验的字段</param>\n      <!--下面的param元素可以有0个或者多个--> \n     <param name=\"参数名\">参数值</param>\n    <message key=\"I18NKey\">提示信息</message>\n  </validator>\n</validators>\n```\n\n**8、总结在 Action 中使用国际化资源文件的步骤及方法**\n\n首先创建不同语言环境下的.properties文件，在文件中写入不同key字段的国际化资源，使用ActionSupport类的getText方法，该方法可以接受一个name参数，指定国际化资源文件中的key数值，最后使用native2ascii工具进行处理。\n\n**9、总结 Struts2 中常用的内置类型转换器及其使用方法**\n\n- String:将int,double,boolean,String类型的数组或java.util.Date类型转换成字符串。\n- boolean和Boolean:在字符串与boolean之间转换\n- char/Character:在字符串和字符之间转换\n- int/Integer,float/Float,long/Long,double/Double:在字符串与数值类型之间进行转换 \n- date:在字符串和日期类型之间进行转换，默认格式是:YYYY-MM-DD\n- 数组:由于数组本身就有类型，可以将多个同名参数，转换到数组中(在之前总结的兴趣爱好多选择，如果你选择多个，同时他们name属性相同就自动变为数组)\n- 集合:支持将数据保存到List或者Map集合\n\n**10、观察 Action 中访问 Servlet API 的四种方法，总结四种方法的区别，并记录下来**\n\n- 通过ActionContext类访问：\n使用这种方法访问的前提是必须先要获取ActionContext对象，优点是Action和Servlet API完全解耦，缺点是并不能调用原生的Servlet API\n\n- Action直接访问:\n使用这种方法可以调用原生的Servlet API，但是需要实现对应的接口\n\n- \t通过ServletActionContext访问:\n使用ServletActionContext工具类无需实现接口，就可以直接访问Servlet API，但是会加强Action和Servlet API的耦合，不利于Action的再利用。\n\n- 实现ServletContextAware、ServletRequestAware、ServletResponseAware接口访问:\nAction与Servlet API直接耦合，需要调用ServletContext和ServletRequest等set方法。\n\n## 实验步骤\n### 基础实验\n\n1、新建 Web 工程 struts-prj2，并将 Struts2 中的 8 个核心包添加到工程中； \n\n2、在 struts-prj2 中新建 login.jsp 页面，作为用户登录的视图；新建 loginFail.jsp 页面，作为登录失败的视图；新建 loginSuccess.jsp 页面，作为登录成功的视图;\n\n3、在 struts-prj2 中新建 register.jsp 页面，作为用户注册的视图；新建regFail.jsp 页面，作为注册失败的视图；新建 regSuccess.jsp 页面，作为注册成功的视图;\n\n4、在 struts-prj2 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于 记录用户信息 （可重用“实验二 Struts 基础应用 ”中提高实验里的 UserBean.java 代码）； \n\n5、在 struts-prj2 中新建 cn.edu.zjut.service 包，并在其中创UserService.java， 用于实现登录逻辑和注册逻辑;\n\n6、在 struts-prj2 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，定义login()方法和 register()方法\n\n7、在工程struts-prj2 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，通过 action 标签中 method 属性指定方法名；\n\n8、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； \n\n9、将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 与 register.jsp页面，并记录运行结果； \n\n10、查找相关资料， 尝试使用 Action 自定义方法的其它三种调用和配置方式：动态方法调用方式（DMI）、提交按钮的 method 属性、通配符配置 Action，并记录关键配置和运行结果； \n \n![](http://image.stephenfang.me/mweb/java/DMI.png)\n  \n![](http://image.stephenfang.me/mweb/java/button.png)\n \n![](http://image.stephenfang.me/mweb/java/uni.png)\n\n11、修改 UserAction.java，增加 UserAction 类的构造方法 UserAction()，增加 count属性，用于测试 Action 的实例化情况\n\n![](http://image.stephenfang.me/mweb/java/2.png)\n\n12、修改 `loginSuccess.jsp`，在页面中使用<s:property>标签输出 Action 中的 count 值； \n\n```\n<s:property value=\"count\" />\n```\n\n13、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 并刷新多次，记录运行结果； \n\n![](http://image.stephenfang.me/mweb/java/3.png)\n\n14、修改 struts.xml 文件，将 UserAction 的页面导航设置为 redirect 结果类型；\n\n```\n<result name=\"success\" type=\"redirect\">/loginSuccess.jsp</result>\n```\n\n15、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察登录成功后 loginSuccess.jsp 页面的输出，并记录下来。\n\n![](http://image.stephenfang.me/mweb/java/4.png)\n\n### 提高实验\n1、在 struts-prj2 中修改 UserAction 类，使其继承 ActionSupport 类，并在 UserAction 类中覆盖 ActionSupport 类的 validate()方法， 用于对用户登录的请求参 数 account 和 password 进行校验：若用户名或密码为空，则使用 addFieldError （域 级）添加错误信息。\n\n![](http://image.stephenfang.me/mweb/java/5.png)\n\n2、修改 `struts.xml` 文件，在 Action 的配置中增加 validate()方法校验出错时的页面导航`<result name=\"input\">`\n\n![](http://image.stephenfang.me/mweb/java/6.png)\n\n3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/7.png)\n\n4、修改 `login.jsp` 页面，在表单前增加 fielderror 标签：`<s:fielderror/>`，再通过浏览器访问 login.jsp 页面，观察并记录运行结果\n\n![](http://image.stephenfang.me/mweb/java/8.png)\n\n5、修改 UserAction.java，在调用登录逻辑的 login()方法中，对登录情况进行校验： 若登录成功，使用 addActionMessage()方法添加“登录成功！”的 Action 提示消息，若 登录失败，使用 addActionError()方法添加 Action 级别的错误信息\n\n![](http://image.stephenfang.me/mweb/java/9.png)\n\n6、修改 login.jsp 页面，增加 actionerror 标签（<s:actionerror/>）Action 级别的 错 误信息；修改 `loginSuccess.jsp`，使用 actionmessage 标签`<s:actionmessage/>` 显示 Action 提示消息； \n\n7、修改 `struts.xml` 文件中用户登录的页面导航设置，将登录失败时转向的页面从 loginFail.jsp 修改为 login.jsp； \n\n8、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/10.png)\n\n9、在工程 struts-prj2 中创建“UserAction-login-validation.xml”校验规则文件，使 其与 UserAction 类位于同一目录下，配置校验信息，使用校验器对请求参数进行校验 \n\n10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/11.png)\n\n11、将 login.jsp、 loginSuccess.jsp、 loginFail.jsp 三个页面进行国际化处理，把需要进行国际化的内容 以键值对的形式写入资源文件 `message_zh_CN.properties` 和 `message_en_US.properties` 中； \n\n12、在资源文件中添加校验信息的键值对， 并使用 native2ASCII 工具，将 `message_zh_CN.properties` 重新编码，将中文字符都转化为 unicode 码 \n\n13、在工程 struts-prj2 的 src 目录中创建 `struts.properties` 文件，通过它加载资源文件 \n\n14、修改 `UserAction.java`，使用 ActionSupport 类的 getText()方法，获取国际化资 源文件中的信息 \n\n15、修改 `UserAction-login-validation.xml`，获取国际化资源文件中的信息 \n\n16、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/12.png)\n\n17、修改 `UserBean.java`，将用于保存注册用户生日的变量类型改为 Date 类型，使用 Struts2 内置的类型转换器对请求参数进行校验； \n\n18、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，当用户输入的生日不合法时，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/13.png)\n\n19、在工程 struts-prj2 的 cn.edu.zjut.action 包中创建局部属性文件`UserAction.properties`，修改类型转换的校验信息，并使用 native2ASCII 工具将 `UserAction.properties` 重新编码 \n\n20、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，当用户输入的生日不合法时，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/na.png)\n\n21、参考实验步骤 9，在工程 struts-prj2 的 cn.edu.zjut.action 包中创建 `UserAction-register-validation.xml` 文件，增加校验信息的配置，使用校验器对用户 注册的请求参数进行校验，要求注册时两次密码输入相同、email 地址格式符合要求等； \n\n22、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/14.png)\n\n23、修改 UserAction 类， 将 validate()的方法名改为 validateLogin()， 并增加 validateRegister()方法，参考实验步骤 1，使用手工编码方式对请求参数进行数据校验； \n\n24、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页 面，观察并记录运行结果。\n\n![](http://image.stephenfang.me/mweb/java/15.png)\n\n### 拓展实验\n\n1、在 struts-prj2 中修改 UserAction 类，通过 ActionContext 获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 \n\n2、修改 `loginSuccess.jsp` 页面，从请求、会话和上下文对象中获取属性值并显示 在页面中 \n\n3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/16.png)\n\n**每提交一次刷新，次数就会增加一次，只有重新部署访问次数才会重置** \n\n4、修改 UserAction 类，通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware，获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 \n\n5、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp` 页面，观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/java/17.png)\n\n6、修改 UserAction 类，查找相关资料，尝试通过接口：ServletContextAware、 ServletRequestAware、ServletResponseAware 直接访问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；\n\n![](http://image.stephenfang.me/mweb/java/18.png)\n\n![](http://image.stephenfang.me/mweb/java/19.png)\n\n\n7、修改 UserAction 类，查找相关资料，尝试通过 ServletActionContext 工具类直接访 问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；\n\n![](http://image.stephenfang.me/mweb/java/20.png)\n\n![](http://image.stephenfang.me/mweb/java/21.png)\n\n8、尝试利用 Servlet API 添加购物车功能，在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 `Item.java` 用于记录商品信息\n\n9、在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 `ShopppingCart.java` 用于记录用户的购物车信息，为简化操作，在购物车的构造函数中加入商品信息 \n\n10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 `login.jsp `页面， 观察并记录运行结果。\n\n![](http://image.stephenfang.me/mweb/java/22.png)\n","slug":"Action_Experiment","published":1,"updated":"2022-07-24T15:18:26.357Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1j0007o76fg1h70z6p","content":"<p>包含 控制器组件 Action 知识梳理、实验步骤、实验整理方面的总结。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Action 类中的默认方法名是 execute()方法，可以被自动调用； </p>\n<p>2、在 Action 中也允许定义其它方法名，可以同时定义多个方法，分别处理不同的逻辑；</p>\n<p>3、当 Action 中使用了自定义方法，则该 Action 就需要特定的配置，一般有四种调用方式： </p>\n<ul>\n<li>在 struts.xml 文件中通过 method 属性指定方法名； </li>\n<li>使用动态方法调用方式（DMI）； </li>\n<li>使用提交按钮的 method 属性； </li>\n<li>使用通配符配置 Action； </li>\n</ul>\n<p>4、Action 类是多实例的，Action 类的属性是线程安全的； </p>\n<p>5、在 JSP 页面中，可以通过 Struts2 标签调用 Action 中对应的 getter 方法，从而输出 Action 的属性值； </p>\n<p>6、当一个 Action 处理用户请求结束后，返回一个字符串作为逻辑视图名，再通过 <code>struts.xml</code> 文件中的配置将逻辑视图名与物理视图资源关联起来；Struts2默认提供了一系列的结果类型（<code>struts-default.xml</code> 配置文件的 result-types 标签里列出了所支持的结果类型），结果类型决定了 Action 处理结束后，将调用哪种视图资源来呈现处理结果。</p>\n<p>7、为了让用户开发的 Action 类更规范，Struts2 提供了一个 Action 接口，该接口定义了 Struts2 的 Action 处理类应该实现的规范； </p>\n<p>8、Struts2 还为 Action 接口提供了一个实现类：ActionSupport，该类提供了若干默认方法，包括：默认的处理用户请求的方法（excute()方法）、数据校验的方法、添加校验错误信息的方法、获取国际化信息的方法等，部分重要方法列表如下：</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/1.png\"></p>\n<p>9、Struts2 框架提供了校验器和手工编码两种方式对请求参数进行数据校验，当 Action 类继承了 ActionSupport 类，就可以通过定义名为“<ActionClassName>- <ActionAliasName>-validation.xml”的校验规则文件的方法进行校验器校验， 也可以通过重写 ActionSupport 类的 validate()方法或 validateXxx()方法进行手动校验； </p>\n<p>10、在 JSP 页面中使用 Struts2 标签生成的表单，能将域级别的错误信息将自动显示到表单元素处； </p>\n<p>11、在 JSP 页面中使用 fielderror 标签，可以集中显示所有的域级错误信息；使用 actionerror 标签，可以显示所有的 Action 级别错误信息；使用 actionmessage 标签，可以显示 Action 消息； </p>\n<p>12、Struts2 框架中提供了部分内置的类型转换器，可以将请求参数的 String 类型转换成基本数据类型及对应的包装器类型、日期类型、数组类型、集合类型等，当 Action 类继承了 ActionSupport 类，则内置的类型转换器将默认生效，可以直接使用； </p>\n<p>13、如需修改默认的类型转换校验信息，则要在 Action 类的包中声明名为“Action 类名.properties”的局部属性文件； </p>\n<p>14、Struts2 框架同时支持自定义类型转换器，将请求参数转换成任意一种类型。</p>\n<p>15、Struts2 框架中的 Action 类没有与任何 Servlet API 耦合，因此 Action 类可以脱 离 Servlet 容器环境进行单元测试； </p>\n<p>16、ActionContext 是 <code>com.opensymphony.xwork2</code> 包中的一个类，该类表示一个 Action 运行时的上下文；</p>\n<p>17、当 Action 类需要通过请求、会话或上下文存取属性时，可以通过 ActionContext 类完成， 也可以通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware 完成，而不必调用 Servlet API 中的 HttpServletRequest、 HttpSession 和 ServletContext 对象，从而保持 Action 与 Servlet API 的解耦； </p>\n<p>18、在 Action 类中直接访问 Servlet API， 可以通过实现 Struts2 提供的接口： ServletContextAware、ServletRequestAware、ServletResponseAware 完成，也可以通过 ServletActionContext 工具类实现，但 Action 将与 Servlet API 直接耦合。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p><strong>1、总结 Action 自定义方法的四种调用和配置方式</strong></p>\n<ul>\n<li>在 <code>struts.xml</code> 文件中通过method属性指定方法名：以actionName.action形式访问，但是要配置多个action较为麻烦</li>\n<li>使用动态方法调用方式：以 actionName!methodName.action 形式访问，要注意UserAction下的login和register方法不能有相同的result返回值</li>\n<li>使用提交按钮的method属性：以actionName!methodName.action形式访问，但是需要在.jsp页面中配置，只能用于表单中</li>\n<li>使用通配符配置Action：以actionName.action形式访问，相对更为普遍的方式</li>\n</ul>\n<p><strong>2、Action 的实例化情况，将 Action 与 Servlet 在实例化情况上进行对比</strong></p>\n<p>在Struts2中每提交一次表单数据Action就被实例化一次，而Servlet在被创建时就被实例化，多次访问页面Servlet不会被多次实例化。</p>\n<p><strong>3、分析 JSP 文件中获取 Action 属性的主要过程</strong></p>\n<p>JSP 文件中获取 Action 属性以JavaBean来实现，所封装的属性和表单的属性一一对应，JavaBean将成为数据传递的载体来进行数据的传递。</p>\n<p><strong>4、观察两次 <code>loginSuccess.jsp</code> 页面输出上的区别，分析原因并记录下来</strong><br>redirect采用客户端重定向的方式，而默认的dispatcher采用服务器内部跳转的方式，所以当result的type属性被设置为redirect时无法获取到Action中的count属性而dispatcher的方式可以。</p>\n<p><strong>5、解压缩 Struts2 的核心包 struts2-core-2.3.15.1.jar，找到 struts-<code>default.xml</code> 配置文件，在其中的 result-types 标签里列出了 Struts2 所支持的结果类型，查找相关资料，总结这些结果类型的作用和特点，并记录下来；</strong></p>\n<ul>\n<li>chain：服务器内部跳转，调用其他action,完成自定义的拦截器堆栈和结果。只能请求action,如果请求视图资源会报错。</li>\n<li>dispatcher: 默认值，服务器内部跳转(跳转到web组件)</li>\n<li>freemarker：使用Freemarker模板引擎呈现一个视图</li>\n<li>httpheader：通过设置HTTP headers和status的值来发送错误信息给客户端。</li>\n<li>redirect: 作客户端重定向(重定向到web组件)</li>\n<li>redirectAction: 作客户端重定向(重定向到其他Action)</li>\n<li>stream:用作下载文件或者在浏览器上显示PDF等文档</li>\n<li>velocity:使用Servlet容器的JspFactory,模拟JSP执行环境,显示Velocity模板,将直接传输到Servlet输出。</li>\n<li>plaintext:响应以plain形式返回给客户端,相当于<code>response.setContentType(&quot;text/plain; charset=&quot;+charSet);</code></li>\n</ul>\n<p><strong>6、总结 Action 类中 validate()方法和 validateXxx()方法的作用</strong></p>\n<ul>\n<li> validate()方法：将对页面表单验证的内容写到validate()方法中，实现验证和业务处理内容的分离，validate()方法会对Action类中所有业务方法起作用</li>\n<li> validateXxx()方法：当多个表单提交到同一个action页面是，validate()方法对所有表单生效，可以使用validateXxx()方法实现对某一个业务的验证，validate()方法和 validateXxx()方法同时存在时都会起作用；validateXxx()方法的调用优于validate()方法</li>\n</ul>\n<p><strong>7、总结使用校验器校验的方法；在 Struts2 的核心包 xwork-core-</strong><br><strong>2.3.15.1.jar\\com\\opensymphony\\xwork2\\validator\\validators路径下找到 default.xml 文件，总结校验规则文件中主要元素的作用和配置方法</strong></p>\n<ul>\n<li>required：必填校验器  </li>\n<li>requiredstring：必填字符串校验器  </li>\n<li>stringlength:字符串长度校验器 </li>\n<li>date:日期校验器  </li>\n<li>expression：表达式校验器  </li>\n<li>int:整数校验器 </li>\n<li>fieldexpression：字段表达式校验器</li>\n<li>url:网址校验器  </li>\n<li>regex：正则表达式校验器 </li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">validators</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">field</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;被校验的字段&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">field-validator</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;校验器的类型&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;参数名&quot;</span>&gt;</span>参数值<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">message</span>&gt;</span> 提示信息<span class=\"tag\">&lt;/<span class=\"name\">message</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">field-validator</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">field</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--下一个要验证的字段--&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">valiators</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">validator</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;校验器类型名&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"comment\">&lt;!--fieldName固定的 N必须大写--&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;fieldName&quot;</span>&gt;</span>需要被校验的字段<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--下面的param元素可以有0个或者多个--&gt;</span> </span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;参数名&quot;</span>&gt;</span>参数值<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">message</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;I18NKey&quot;</span>&gt;</span>提示信息<span class=\"tag\">&lt;/<span class=\"name\">message</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">validator</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>8、总结在 Action 中使用国际化资源文件的步骤及方法</strong></p>\n<p>首先创建不同语言环境下的.properties文件，在文件中写入不同key字段的国际化资源，使用ActionSupport类的getText方法，该方法可以接受一个name参数，指定国际化资源文件中的key数值，最后使用native2ascii工具进行处理。</p>\n<p><strong>9、总结 Struts2 中常用的内置类型转换器及其使用方法</strong></p>\n<ul>\n<li>String:将int,double,boolean,String类型的数组或java.util.Date类型转换成字符串。</li>\n<li>boolean和Boolean:在字符串与boolean之间转换</li>\n<li>char/Character:在字符串和字符之间转换</li>\n<li>int/Integer,float/Float,long/Long,double/Double:在字符串与数值类型之间进行转换 </li>\n<li>date:在字符串和日期类型之间进行转换，默认格式是:YYYY-MM-DD</li>\n<li>数组:由于数组本身就有类型，可以将多个同名参数，转换到数组中(在之前总结的兴趣爱好多选择，如果你选择多个，同时他们name属性相同就自动变为数组)</li>\n<li>集合:支持将数据保存到List或者Map集合</li>\n</ul>\n<p><strong>10、观察 Action 中访问 Servlet API 的四种方法，总结四种方法的区别，并记录下来</strong></p>\n<ul>\n<li><p>通过ActionContext类访问：<br>使用这种方法访问的前提是必须先要获取ActionContext对象，优点是Action和Servlet API完全解耦，缺点是并不能调用原生的Servlet API</p>\n</li>\n<li><p>Action直接访问:<br>使用这种方法可以调用原生的Servlet API，但是需要实现对应的接口</p>\n</li>\n<li><pre><code>通过ServletActionContext访问:\n</code></pre>\n<p>使用ServletActionContext工具类无需实现接口，就可以直接访问Servlet API，但是会加强Action和Servlet API的耦合，不利于Action的再利用。</p>\n</li>\n<li><p>实现ServletContextAware、ServletRequestAware、ServletResponseAware接口访问:<br>Action与Servlet API直接耦合，需要调用ServletContext和ServletRequest等set方法。</p>\n</li>\n</ul>\n<h2 id=\"实验步骤\"><a href=\"#实验步骤\" class=\"headerlink\" title=\"实验步骤\"></a>实验步骤</h2><h3 id=\"基础实验\"><a href=\"#基础实验\" class=\"headerlink\" title=\"基础实验\"></a>基础实验</h3><p>1、新建 Web 工程 struts-prj2，并将 Struts2 中的 8 个核心包添加到工程中； </p>\n<p>2、在 struts-prj2 中新建 login.jsp 页面，作为用户登录的视图；新建 loginFail.jsp 页面，作为登录失败的视图；新建 loginSuccess.jsp 页面，作为登录成功的视图;</p>\n<p>3、在 struts-prj2 中新建 register.jsp 页面，作为用户注册的视图；新建regFail.jsp 页面，作为注册失败的视图；新建 regSuccess.jsp 页面，作为注册成功的视图;</p>\n<p>4、在 struts-prj2 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于 记录用户信息 （可重用“实验二 Struts 基础应用 ”中提高实验里的 UserBean.java 代码）； </p>\n<p>5、在 struts-prj2 中新建 cn.edu.zjut.service 包，并在其中创UserService.java， 用于实现登录逻辑和注册逻辑;</p>\n<p>6、在 struts-prj2 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，定义login()方法和 register()方法</p>\n<p>7、在工程struts-prj2 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，通过 action 标签中 method 属性指定方法名；</p>\n<p>8、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； </p>\n<p>9、将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 与 register.jsp页面，并记录运行结果； </p>\n<p>10、查找相关资料， 尝试使用 Action 自定义方法的其它三种调用和配置方式：动态方法调用方式（DMI）、提交按钮的 method 属性、通配符配置 Action，并记录关键配置和运行结果； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/DMI.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/button.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/uni.png\"></p>\n<p>11、修改 UserAction.java，增加 UserAction 类的构造方法 UserAction()，增加 count属性，用于测试 Action 的实例化情况</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/2.png\"></p>\n<p>12、修改 <code>loginSuccess.jsp</code>，在页面中使用&lt;s:property&gt;标签输出 Action 中的 count 值； </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;s:property value=&quot;count&quot; /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>13、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 并刷新多次，记录运行结果； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/3.png\"></p>\n<p>14、修改 struts.xml 文件，将 UserAction 的页面导航设置为 redirect 结果类型；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;result name=&quot;success&quot; type=&quot;redirect&quot;&gt;/loginSuccess.jsp&lt;/result&gt;</span><br></pre></td></tr></table></figure>\n\n<p>15、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察登录成功后 loginSuccess.jsp 页面的输出，并记录下来。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/4.png\"></p>\n<h3 id=\"提高实验\"><a href=\"#提高实验\" class=\"headerlink\" title=\"提高实验\"></a>提高实验</h3><p>1、在 struts-prj2 中修改 UserAction 类，使其继承 ActionSupport 类，并在 UserAction 类中覆盖 ActionSupport 类的 validate()方法， 用于对用户登录的请求参 数 account 和 password 进行校验：若用户名或密码为空，则使用 addFieldError （域 级）添加错误信息。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/5.png\"></p>\n<p>2、修改 <code>struts.xml</code> 文件，在 Action 的配置中增加 validate()方法校验出错时的页面导航<code>&lt;result name=&quot;input&quot;&gt;</code></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/6.png\"></p>\n<p>3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/7.png\"></p>\n<p>4、修改 <code>login.jsp</code> 页面，在表单前增加 fielderror 标签：<code>&lt;s:fielderror/&gt;</code>，再通过浏览器访问 login.jsp 页面，观察并记录运行结果</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/8.png\"></p>\n<p>5、修改 UserAction.java，在调用登录逻辑的 login()方法中，对登录情况进行校验： 若登录成功，使用 addActionMessage()方法添加“登录成功！”的 Action 提示消息，若 登录失败，使用 addActionError()方法添加 Action 级别的错误信息</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/9.png\"></p>\n<p>6、修改 login.jsp 页面，增加 actionerror 标签（&lt;s:actionerror/&gt;）Action 级别的 错 误信息；修改 <code>loginSuccess.jsp</code>，使用 actionmessage 标签<code>&lt;s:actionmessage/&gt;</code> 显示 Action 提示消息； </p>\n<p>7、修改 <code>struts.xml</code> 文件中用户登录的页面导航设置，将登录失败时转向的页面从 loginFail.jsp 修改为 login.jsp； </p>\n<p>8、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/10.png\"></p>\n<p>9、在工程 struts-prj2 中创建“UserAction-login-validation.xml”校验规则文件，使 其与 UserAction 类位于同一目录下，配置校验信息，使用校验器对请求参数进行校验 </p>\n<p>10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/11.png\"></p>\n<p>11、将 login.jsp、 loginSuccess.jsp、 loginFail.jsp 三个页面进行国际化处理，把需要进行国际化的内容 以键值对的形式写入资源文件 <code>message_zh_CN.properties</code> 和 <code>message_en_US.properties</code> 中； </p>\n<p>12、在资源文件中添加校验信息的键值对， 并使用 native2ASCII 工具，将 <code>message_zh_CN.properties</code> 重新编码，将中文字符都转化为 unicode 码 </p>\n<p>13、在工程 struts-prj2 的 src 目录中创建 <code>struts.properties</code> 文件，通过它加载资源文件 </p>\n<p>14、修改 <code>UserAction.java</code>，使用 ActionSupport 类的 getText()方法，获取国际化资 源文件中的信息 </p>\n<p>15、修改 <code>UserAction-login-validation.xml</code>，获取国际化资源文件中的信息 </p>\n<p>16、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/12.png\"></p>\n<p>17、修改 <code>UserBean.java</code>，将用于保存注册用户生日的变量类型改为 Date 类型，使用 Struts2 内置的类型转换器对请求参数进行校验； </p>\n<p>18、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，当用户输入的生日不合法时，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/13.png\"></p>\n<p>19、在工程 struts-prj2 的 cn.edu.zjut.action 包中创建局部属性文件<code>UserAction.properties</code>，修改类型转换的校验信息，并使用 native2ASCII 工具将 <code>UserAction.properties</code> 重新编码 </p>\n<p>20、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，当用户输入的生日不合法时，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/na.png\"></p>\n<p>21、参考实验步骤 9，在工程 struts-prj2 的 cn.edu.zjut.action 包中创建 <code>UserAction-register-validation.xml</code> 文件，增加校验信息的配置，使用校验器对用户 注册的请求参数进行校验，要求注册时两次密码输入相同、email 地址格式符合要求等； </p>\n<p>22、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/14.png\"></p>\n<p>23、修改 UserAction 类， 将 validate()的方法名改为 validateLogin()， 并增加 validateRegister()方法，参考实验步骤 1，使用手工编码方式对请求参数进行数据校验； </p>\n<p>24、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，观察并记录运行结果。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/15.png\"></p>\n<h3 id=\"拓展实验\"><a href=\"#拓展实验\" class=\"headerlink\" title=\"拓展实验\"></a>拓展实验</h3><p>1、在 struts-prj2 中修改 UserAction 类，通过 ActionContext 获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 </p>\n<p>2、修改 <code>loginSuccess.jsp</code> 页面，从请求、会话和上下文对象中获取属性值并显示 在页面中 </p>\n<p>3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/16.png\"></p>\n<p><strong>每提交一次刷新，次数就会增加一次，只有重新部署访问次数才会重置</strong> </p>\n<p>4、修改 UserAction 类，通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware，获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 </p>\n<p>5、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/17.png\"></p>\n<p>6、修改 UserAction 类，查找相关资料，尝试通过接口：ServletContextAware、 ServletRequestAware、ServletResponseAware 直接访问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/18.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/19.png\"></p>\n<p>7、修改 UserAction 类，查找相关资料，尝试通过 ServletActionContext 工具类直接访 问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/20.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/21.png\"></p>\n<p>8、尝试利用 Servlet API 添加购物车功能，在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 <code>Item.java</code> 用于记录商品信息</p>\n<p>9、在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 <code>ShopppingCart.java</code> 用于记录用户的购物车信息，为简化操作，在购物车的构造函数中加入商品信息 </p>\n<p>10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp </code>页面， 观察并记录运行结果。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/22.png\"></p>\n","site":{"data":{}},"excerpt":"<p>包含 控制器组件 Action 知识梳理、实验步骤、实验整理方面的总结。</p>","more":"<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Action 类中的默认方法名是 execute()方法，可以被自动调用； </p>\n<p>2、在 Action 中也允许定义其它方法名，可以同时定义多个方法，分别处理不同的逻辑；</p>\n<p>3、当 Action 中使用了自定义方法，则该 Action 就需要特定的配置，一般有四种调用方式： </p>\n<ul>\n<li>在 struts.xml 文件中通过 method 属性指定方法名； </li>\n<li>使用动态方法调用方式（DMI）； </li>\n<li>使用提交按钮的 method 属性； </li>\n<li>使用通配符配置 Action； </li>\n</ul>\n<p>4、Action 类是多实例的，Action 类的属性是线程安全的； </p>\n<p>5、在 JSP 页面中，可以通过 Struts2 标签调用 Action 中对应的 getter 方法，从而输出 Action 的属性值； </p>\n<p>6、当一个 Action 处理用户请求结束后，返回一个字符串作为逻辑视图名，再通过 <code>struts.xml</code> 文件中的配置将逻辑视图名与物理视图资源关联起来；Struts2默认提供了一系列的结果类型（<code>struts-default.xml</code> 配置文件的 result-types 标签里列出了所支持的结果类型），结果类型决定了 Action 处理结束后，将调用哪种视图资源来呈现处理结果。</p>\n<p>7、为了让用户开发的 Action 类更规范，Struts2 提供了一个 Action 接口，该接口定义了 Struts2 的 Action 处理类应该实现的规范； </p>\n<p>8、Struts2 还为 Action 接口提供了一个实现类：ActionSupport，该类提供了若干默认方法，包括：默认的处理用户请求的方法（excute()方法）、数据校验的方法、添加校验错误信息的方法、获取国际化信息的方法等，部分重要方法列表如下：</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/1.png\"></p>\n<p>9、Struts2 框架提供了校验器和手工编码两种方式对请求参数进行数据校验，当 Action 类继承了 ActionSupport 类，就可以通过定义名为“<ActionClassName>- <ActionAliasName>-validation.xml”的校验规则文件的方法进行校验器校验， 也可以通过重写 ActionSupport 类的 validate()方法或 validateXxx()方法进行手动校验； </p>\n<p>10、在 JSP 页面中使用 Struts2 标签生成的表单，能将域级别的错误信息将自动显示到表单元素处； </p>\n<p>11、在 JSP 页面中使用 fielderror 标签，可以集中显示所有的域级错误信息；使用 actionerror 标签，可以显示所有的 Action 级别错误信息；使用 actionmessage 标签，可以显示 Action 消息； </p>\n<p>12、Struts2 框架中提供了部分内置的类型转换器，可以将请求参数的 String 类型转换成基本数据类型及对应的包装器类型、日期类型、数组类型、集合类型等，当 Action 类继承了 ActionSupport 类，则内置的类型转换器将默认生效，可以直接使用； </p>\n<p>13、如需修改默认的类型转换校验信息，则要在 Action 类的包中声明名为“Action 类名.properties”的局部属性文件； </p>\n<p>14、Struts2 框架同时支持自定义类型转换器，将请求参数转换成任意一种类型。</p>\n<p>15、Struts2 框架中的 Action 类没有与任何 Servlet API 耦合，因此 Action 类可以脱 离 Servlet 容器环境进行单元测试； </p>\n<p>16、ActionContext 是 <code>com.opensymphony.xwork2</code> 包中的一个类，该类表示一个 Action 运行时的上下文；</p>\n<p>17、当 Action 类需要通过请求、会话或上下文存取属性时，可以通过 ActionContext 类完成， 也可以通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware 完成，而不必调用 Servlet API 中的 HttpServletRequest、 HttpSession 和 ServletContext 对象，从而保持 Action 与 Servlet API 的解耦； </p>\n<p>18、在 Action 类中直接访问 Servlet API， 可以通过实现 Struts2 提供的接口： ServletContextAware、ServletRequestAware、ServletResponseAware 完成，也可以通过 ServletActionContext 工具类实现，但 Action 将与 Servlet API 直接耦合。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p><strong>1、总结 Action 自定义方法的四种调用和配置方式</strong></p>\n<ul>\n<li>在 <code>struts.xml</code> 文件中通过method属性指定方法名：以actionName.action形式访问，但是要配置多个action较为麻烦</li>\n<li>使用动态方法调用方式：以 actionName!methodName.action 形式访问，要注意UserAction下的login和register方法不能有相同的result返回值</li>\n<li>使用提交按钮的method属性：以actionName!methodName.action形式访问，但是需要在.jsp页面中配置，只能用于表单中</li>\n<li>使用通配符配置Action：以actionName.action形式访问，相对更为普遍的方式</li>\n</ul>\n<p><strong>2、Action 的实例化情况，将 Action 与 Servlet 在实例化情况上进行对比</strong></p>\n<p>在Struts2中每提交一次表单数据Action就被实例化一次，而Servlet在被创建时就被实例化，多次访问页面Servlet不会被多次实例化。</p>\n<p><strong>3、分析 JSP 文件中获取 Action 属性的主要过程</strong></p>\n<p>JSP 文件中获取 Action 属性以JavaBean来实现，所封装的属性和表单的属性一一对应，JavaBean将成为数据传递的载体来进行数据的传递。</p>\n<p><strong>4、观察两次 <code>loginSuccess.jsp</code> 页面输出上的区别，分析原因并记录下来</strong><br>redirect采用客户端重定向的方式，而默认的dispatcher采用服务器内部跳转的方式，所以当result的type属性被设置为redirect时无法获取到Action中的count属性而dispatcher的方式可以。</p>\n<p><strong>5、解压缩 Struts2 的核心包 struts2-core-2.3.15.1.jar，找到 struts-<code>default.xml</code> 配置文件，在其中的 result-types 标签里列出了 Struts2 所支持的结果类型，查找相关资料，总结这些结果类型的作用和特点，并记录下来；</strong></p>\n<ul>\n<li>chain：服务器内部跳转，调用其他action,完成自定义的拦截器堆栈和结果。只能请求action,如果请求视图资源会报错。</li>\n<li>dispatcher: 默认值，服务器内部跳转(跳转到web组件)</li>\n<li>freemarker：使用Freemarker模板引擎呈现一个视图</li>\n<li>httpheader：通过设置HTTP headers和status的值来发送错误信息给客户端。</li>\n<li>redirect: 作客户端重定向(重定向到web组件)</li>\n<li>redirectAction: 作客户端重定向(重定向到其他Action)</li>\n<li>stream:用作下载文件或者在浏览器上显示PDF等文档</li>\n<li>velocity:使用Servlet容器的JspFactory,模拟JSP执行环境,显示Velocity模板,将直接传输到Servlet输出。</li>\n<li>plaintext:响应以plain形式返回给客户端,相当于<code>response.setContentType(&quot;text/plain; charset=&quot;+charSet);</code></li>\n</ul>\n<p><strong>6、总结 Action 类中 validate()方法和 validateXxx()方法的作用</strong></p>\n<ul>\n<li> validate()方法：将对页面表单验证的内容写到validate()方法中，实现验证和业务处理内容的分离，validate()方法会对Action类中所有业务方法起作用</li>\n<li> validateXxx()方法：当多个表单提交到同一个action页面是，validate()方法对所有表单生效，可以使用validateXxx()方法实现对某一个业务的验证，validate()方法和 validateXxx()方法同时存在时都会起作用；validateXxx()方法的调用优于validate()方法</li>\n</ul>\n<p><strong>7、总结使用校验器校验的方法；在 Struts2 的核心包 xwork-core-</strong><br><strong>2.3.15.1.jar\\com\\opensymphony\\xwork2\\validator\\validators路径下找到 default.xml 文件，总结校验规则文件中主要元素的作用和配置方法</strong></p>\n<ul>\n<li>required：必填校验器  </li>\n<li>requiredstring：必填字符串校验器  </li>\n<li>stringlength:字符串长度校验器 </li>\n<li>date:日期校验器  </li>\n<li>expression：表达式校验器  </li>\n<li>int:整数校验器 </li>\n<li>fieldexpression：字段表达式校验器</li>\n<li>url:网址校验器  </li>\n<li>regex：正则表达式校验器 </li>\n</ul>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">validators</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">field</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;被校验的字段&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">field-validator</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;校验器的类型&quot;</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;参数名&quot;</span>&gt;</span>参数值<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></span><br><span class=\"line\">         <span class=\"tag\">&lt;<span class=\"name\">message</span>&gt;</span> 提示信息<span class=\"tag\">&lt;/<span class=\"name\">message</span>&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;/<span class=\"name\">field-validator</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">field</span>&gt;</span></span><br><span class=\"line\">  <span class=\"comment\">&lt;!--下一个要验证的字段--&gt;</span> </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">valiators</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">validator</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;校验器类型名&quot;</span>&gt;</span></span><br><span class=\"line\">     <span class=\"comment\">&lt;!--fieldName固定的 N必须大写--&gt;</span></span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;fieldName&quot;</span>&gt;</span>需要被校验的字段<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></span><br><span class=\"line\">      <span class=\"comment\">&lt;!--下面的param元素可以有0个或者多个--&gt;</span> </span><br><span class=\"line\">     <span class=\"tag\">&lt;<span class=\"name\">param</span> <span class=\"attr\">name</span>=<span class=\"string\">&quot;参数名&quot;</span>&gt;</span>参数值<span class=\"tag\">&lt;/<span class=\"name\">param</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">message</span> <span class=\"attr\">key</span>=<span class=\"string\">&quot;I18NKey&quot;</span>&gt;</span>提示信息<span class=\"tag\">&lt;/<span class=\"name\">message</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;/<span class=\"name\">validator</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">validators</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p><strong>8、总结在 Action 中使用国际化资源文件的步骤及方法</strong></p>\n<p>首先创建不同语言环境下的.properties文件，在文件中写入不同key字段的国际化资源，使用ActionSupport类的getText方法，该方法可以接受一个name参数，指定国际化资源文件中的key数值，最后使用native2ascii工具进行处理。</p>\n<p><strong>9、总结 Struts2 中常用的内置类型转换器及其使用方法</strong></p>\n<ul>\n<li>String:将int,double,boolean,String类型的数组或java.util.Date类型转换成字符串。</li>\n<li>boolean和Boolean:在字符串与boolean之间转换</li>\n<li>char/Character:在字符串和字符之间转换</li>\n<li>int/Integer,float/Float,long/Long,double/Double:在字符串与数值类型之间进行转换 </li>\n<li>date:在字符串和日期类型之间进行转换，默认格式是:YYYY-MM-DD</li>\n<li>数组:由于数组本身就有类型，可以将多个同名参数，转换到数组中(在之前总结的兴趣爱好多选择，如果你选择多个，同时他们name属性相同就自动变为数组)</li>\n<li>集合:支持将数据保存到List或者Map集合</li>\n</ul>\n<p><strong>10、观察 Action 中访问 Servlet API 的四种方法，总结四种方法的区别，并记录下来</strong></p>\n<ul>\n<li><p>通过ActionContext类访问：<br>使用这种方法访问的前提是必须先要获取ActionContext对象，优点是Action和Servlet API完全解耦，缺点是并不能调用原生的Servlet API</p>\n</li>\n<li><p>Action直接访问:<br>使用这种方法可以调用原生的Servlet API，但是需要实现对应的接口</p>\n</li>\n<li><pre><code>通过ServletActionContext访问:\n</code></pre>\n<p>使用ServletActionContext工具类无需实现接口，就可以直接访问Servlet API，但是会加强Action和Servlet API的耦合，不利于Action的再利用。</p>\n</li>\n<li><p>实现ServletContextAware、ServletRequestAware、ServletResponseAware接口访问:<br>Action与Servlet API直接耦合，需要调用ServletContext和ServletRequest等set方法。</p>\n</li>\n</ul>\n<h2 id=\"实验步骤\"><a href=\"#实验步骤\" class=\"headerlink\" title=\"实验步骤\"></a>实验步骤</h2><h3 id=\"基础实验\"><a href=\"#基础实验\" class=\"headerlink\" title=\"基础实验\"></a>基础实验</h3><p>1、新建 Web 工程 struts-prj2，并将 Struts2 中的 8 个核心包添加到工程中； </p>\n<p>2、在 struts-prj2 中新建 login.jsp 页面，作为用户登录的视图；新建 loginFail.jsp 页面，作为登录失败的视图；新建 loginSuccess.jsp 页面，作为登录成功的视图;</p>\n<p>3、在 struts-prj2 中新建 register.jsp 页面，作为用户注册的视图；新建regFail.jsp 页面，作为注册失败的视图；新建 regSuccess.jsp 页面，作为注册成功的视图;</p>\n<p>4、在 struts-prj2 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于 记录用户信息 （可重用“实验二 Struts 基础应用 ”中提高实验里的 UserBean.java 代码）； </p>\n<p>5、在 struts-prj2 中新建 cn.edu.zjut.service 包，并在其中创UserService.java， 用于实现登录逻辑和注册逻辑;</p>\n<p>6、在 struts-prj2 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，定义login()方法和 register()方法</p>\n<p>7、在工程struts-prj2 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，通过 action 标签中 method 属性指定方法名；</p>\n<p>8、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； </p>\n<p>9、将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 与 register.jsp页面，并记录运行结果； </p>\n<p>10、查找相关资料， 尝试使用 Action 自定义方法的其它三种调用和配置方式：动态方法调用方式（DMI）、提交按钮的 method 属性、通配符配置 Action，并记录关键配置和运行结果； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/DMI.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/button.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/uni.png\"></p>\n<p>11、修改 UserAction.java，增加 UserAction 类的构造方法 UserAction()，增加 count属性，用于测试 Action 的实例化情况</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/2.png\"></p>\n<p>12、修改 <code>loginSuccess.jsp</code>，在页面中使用&lt;s:property&gt;标签输出 Action 中的 count 值； </p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;s:property value=&quot;count&quot; /&gt;</span><br></pre></td></tr></table></figure>\n\n<p>13、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 并刷新多次，记录运行结果； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/3.png\"></p>\n<p>14、修改 struts.xml 文件，将 UserAction 的页面导航设置为 redirect 结果类型；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;result name=&quot;success&quot; type=&quot;redirect&quot;&gt;/loginSuccess.jsp&lt;/result&gt;</span><br></pre></td></tr></table></figure>\n\n<p>15、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察登录成功后 loginSuccess.jsp 页面的输出，并记录下来。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/4.png\"></p>\n<h3 id=\"提高实验\"><a href=\"#提高实验\" class=\"headerlink\" title=\"提高实验\"></a>提高实验</h3><p>1、在 struts-prj2 中修改 UserAction 类，使其继承 ActionSupport 类，并在 UserAction 类中覆盖 ActionSupport 类的 validate()方法， 用于对用户登录的请求参 数 account 和 password 进行校验：若用户名或密码为空，则使用 addFieldError （域 级）添加错误信息。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/5.png\"></p>\n<p>2、修改 <code>struts.xml</code> 文件，在 Action 的配置中增加 validate()方法校验出错时的页面导航<code>&lt;result name=&quot;input&quot;&gt;</code></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/6.png\"></p>\n<p>3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/7.png\"></p>\n<p>4、修改 <code>login.jsp</code> 页面，在表单前增加 fielderror 标签：<code>&lt;s:fielderror/&gt;</code>，再通过浏览器访问 login.jsp 页面，观察并记录运行结果</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/8.png\"></p>\n<p>5、修改 UserAction.java，在调用登录逻辑的 login()方法中，对登录情况进行校验： 若登录成功，使用 addActionMessage()方法添加“登录成功！”的 Action 提示消息，若 登录失败，使用 addActionError()方法添加 Action 级别的错误信息</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/9.png\"></p>\n<p>6、修改 login.jsp 页面，增加 actionerror 标签（&lt;s:actionerror/&gt;）Action 级别的 错 误信息；修改 <code>loginSuccess.jsp</code>，使用 actionmessage 标签<code>&lt;s:actionmessage/&gt;</code> 显示 Action 提示消息； </p>\n<p>7、修改 <code>struts.xml</code> 文件中用户登录的页面导航设置，将登录失败时转向的页面从 loginFail.jsp 修改为 login.jsp； </p>\n<p>8、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/10.png\"></p>\n<p>9、在工程 struts-prj2 中创建“UserAction-login-validation.xml”校验规则文件，使 其与 UserAction 类位于同一目录下，配置校验信息，使用校验器对请求参数进行校验 </p>\n<p>10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 login.jsp 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/11.png\"></p>\n<p>11、将 login.jsp、 loginSuccess.jsp、 loginFail.jsp 三个页面进行国际化处理，把需要进行国际化的内容 以键值对的形式写入资源文件 <code>message_zh_CN.properties</code> 和 <code>message_en_US.properties</code> 中； </p>\n<p>12、在资源文件中添加校验信息的键值对， 并使用 native2ASCII 工具，将 <code>message_zh_CN.properties</code> 重新编码，将中文字符都转化为 unicode 码 </p>\n<p>13、在工程 struts-prj2 的 src 目录中创建 <code>struts.properties</code> 文件，通过它加载资源文件 </p>\n<p>14、修改 <code>UserAction.java</code>，使用 ActionSupport 类的 getText()方法，获取国际化资 源文件中的信息 </p>\n<p>15、修改 <code>UserAction-login-validation.xml</code>，获取国际化资源文件中的信息 </p>\n<p>16、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/12.png\"></p>\n<p>17、修改 <code>UserBean.java</code>，将用于保存注册用户生日的变量类型改为 Date 类型，使用 Struts2 内置的类型转换器对请求参数进行校验； </p>\n<p>18、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，当用户输入的生日不合法时，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/13.png\"></p>\n<p>19、在工程 struts-prj2 的 cn.edu.zjut.action 包中创建局部属性文件<code>UserAction.properties</code>，修改类型转换的校验信息，并使用 native2ASCII 工具将 <code>UserAction.properties</code> 重新编码 </p>\n<p>20、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，当用户输入的生日不合法时，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/na.png\"></p>\n<p>21、参考实验步骤 9，在工程 struts-prj2 的 cn.edu.zjut.action 包中创建 <code>UserAction-register-validation.xml</code> 文件，增加校验信息的配置，使用校验器对用户 注册的请求参数进行校验，要求注册时两次密码输入相同、email 地址格式符合要求等； </p>\n<p>22、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/14.png\"></p>\n<p>23、修改 UserAction 类， 将 validate()的方法名改为 validateLogin()， 并增加 validateRegister()方法，参考实验步骤 1，使用手工编码方式对请求参数进行数据校验； </p>\n<p>24、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页 面，观察并记录运行结果。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/15.png\"></p>\n<h3 id=\"拓展实验\"><a href=\"#拓展实验\" class=\"headerlink\" title=\"拓展实验\"></a>拓展实验</h3><p>1、在 struts-prj2 中修改 UserAction 类，通过 ActionContext 获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 </p>\n<p>2、修改 <code>loginSuccess.jsp</code> 页面，从请求、会话和上下文对象中获取属性值并显示 在页面中 </p>\n<p>3、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/16.png\"></p>\n<p><strong>每提交一次刷新，次数就会增加一次，只有重新部署访问次数才会重置</strong> </p>\n<p>4、修改 UserAction 类，通过实现 Struts 提供的接口：RequestAware、SessionAware 和 ApplicationAware，获取请求、会话和上下文对象相关联的 Map 对象来实现存取属性的功能 </p>\n<p>5、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp</code> 页面，观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/17.png\"></p>\n<p>6、修改 UserAction 类，查找相关资料，尝试通过接口：ServletContextAware、 ServletRequestAware、ServletResponseAware 直接访问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/18.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/19.png\"></p>\n<p>7、修改 UserAction 类，查找相关资料，尝试通过 ServletActionContext 工具类直接访 问 Servlet API，实现以上实验步骤 1-3 的相同功能，重新运行并记录结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/20.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/21.png\"></p>\n<p>8、尝试利用 Servlet API 添加购物车功能，在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 <code>Item.java</code> 用于记录商品信息</p>\n<p>9、在工程 struts-prj2 的 cn.edu.zjut.bean 包中创建 <code>ShopppingCart.java</code> 用于记录用户的购物车信息，为简化操作，在购物车的构造函数中加入商品信息 </p>\n<p>10、重新将 struts-prj2 部署在 Tomcat 服务器上，通过浏览器访问 <code>login.jsp </code>页面， 观察并记录运行结果。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/java/22.png\"></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/java/1.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:18:26 GMT+0800 (中国标准时间)","title":"控制器组件 Action 实验","path":"2020/02/26/Action_Experiment/","eyeCatchImage":"http://image.stephenfang.me/mweb/java/1.png","excerpt":"<p>包含 控制器组件 Action 知识梳理、实验步骤、实验整理方面的总结。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-26T03:10:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-26T03:10:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["struts","JavaEE","总结","实验"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":9345},{"title":"Apple Watch程序设计","date":"2020-02-07T08:45:28.000Z","_content":"\n收录Apple Watch程序设计学习中的若干收获，有基本原则、体验权衡点等。\n<!--more-->\n\n## 基本原则\n\n设计Apple Watch应用程序与设计iOS程序存在很大不同，我们需要了解其是iPhone的功能拓展，它的尺寸带来了新的手势操作和UI/UX 设计。\n\n### **私人联系**\n\nApple Watch可能是第一个与用户建立紧密联系的设备，因此您在设计过程中需要利用这种独特的结合。\n\n### **整体化设计**\n\nForce Touch和Digital Crown是使用户与屏幕上的内容无缝交互的关键组件。在设计应用程序时，目标应该是增强用户的认识，即它们之间的硬件和软件是无法区分的。\n\n### **轻量化交互**\n\nApple Watch中的快速交互对于体验至关重要。动画和声音之间的同步对于用户至关重要。重要的是要考虑到显示的信息应该快速浏览并易于消除。\n\n## Apple Watch体验的权衡点\n\n苹果官方提供了[视频](https://developer.apple.com/videos/play/wwdc2017/808/)讲解了一些技巧。\n\n评估您的应用的最佳方法是考虑实现以下4点\n\n![Apple官方参考](https://images.ctfassets.net/ooa29xqb8tix/6MDnChHFUkSoASwSWm6Woq/cd8c7dfdb89088677467edf5bd21a5a6/Qualities_20of_20Apple_20Watch_20Experiences.jpg)\n\n### **清晰**\n\n用户第一眼就能了解界面所显示的信息。\n\n### **简洁**\n\n直截了当。请记住，您的用户收到应用程序通知并举起手腕之间的时间只有几秒钟。\n\n### **及时**\n\n在尽可能短的时间内向用户显示最相关的信息。这样，您正在使您的应用与用户更加相关。\n\n### **客制化**\n\n如果您的应用程序完成了前三个要素，那么您的用户将感到个人联系。理想情况下，尝试加深与用户的这种关系。","source":"_posts/Apple Watch.md","raw":"---\ntitle: Apple Watch程序设计\ndate: 2020-02-07 16:45:28\ncategories: \n- 设计\ntags: \n- Apple\n- Xcode\n---\n\n收录Apple Watch程序设计学习中的若干收获，有基本原则、体验权衡点等。\n<!--more-->\n\n## 基本原则\n\n设计Apple Watch应用程序与设计iOS程序存在很大不同，我们需要了解其是iPhone的功能拓展，它的尺寸带来了新的手势操作和UI/UX 设计。\n\n### **私人联系**\n\nApple Watch可能是第一个与用户建立紧密联系的设备，因此您在设计过程中需要利用这种独特的结合。\n\n### **整体化设计**\n\nForce Touch和Digital Crown是使用户与屏幕上的内容无缝交互的关键组件。在设计应用程序时，目标应该是增强用户的认识，即它们之间的硬件和软件是无法区分的。\n\n### **轻量化交互**\n\nApple Watch中的快速交互对于体验至关重要。动画和声音之间的同步对于用户至关重要。重要的是要考虑到显示的信息应该快速浏览并易于消除。\n\n## Apple Watch体验的权衡点\n\n苹果官方提供了[视频](https://developer.apple.com/videos/play/wwdc2017/808/)讲解了一些技巧。\n\n评估您的应用的最佳方法是考虑实现以下4点\n\n![Apple官方参考](https://images.ctfassets.net/ooa29xqb8tix/6MDnChHFUkSoASwSWm6Woq/cd8c7dfdb89088677467edf5bd21a5a6/Qualities_20of_20Apple_20Watch_20Experiences.jpg)\n\n### **清晰**\n\n用户第一眼就能了解界面所显示的信息。\n\n### **简洁**\n\n直截了当。请记住，您的用户收到应用程序通知并举起手腕之间的时间只有几秒钟。\n\n### **及时**\n\n在尽可能短的时间内向用户显示最相关的信息。这样，您正在使您的应用与用户更加相关。\n\n### **客制化**\n\n如果您的应用程序完成了前三个要素，那么您的用户将感到个人联系。理想情况下，尝试加深与用户的这种关系。","slug":"Apple Watch","published":1,"updated":"2022-07-24T15:18:34.454Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1l0009o76f1ydl7liw","content":"<p>收录Apple Watch程序设计学习中的若干收获，有基本原则、体验权衡点等。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"基本原则\"><a href=\"#基本原则\" class=\"headerlink\" title=\"基本原则\"></a>基本原则</h2><p>设计Apple Watch应用程序与设计iOS程序存在很大不同，我们需要了解其是iPhone的功能拓展，它的尺寸带来了新的手势操作和UI/UX 设计。</p>\n<h3 id=\"私人联系\"><a href=\"#私人联系\" class=\"headerlink\" title=\"私人联系\"></a><strong>私人联系</strong></h3><p>Apple Watch可能是第一个与用户建立紧密联系的设备，因此您在设计过程中需要利用这种独特的结合。</p>\n<h3 id=\"整体化设计\"><a href=\"#整体化设计\" class=\"headerlink\" title=\"整体化设计\"></a><strong>整体化设计</strong></h3><p>Force Touch和Digital Crown是使用户与屏幕上的内容无缝交互的关键组件。在设计应用程序时，目标应该是增强用户的认识，即它们之间的硬件和软件是无法区分的。</p>\n<h3 id=\"轻量化交互\"><a href=\"#轻量化交互\" class=\"headerlink\" title=\"轻量化交互\"></a><strong>轻量化交互</strong></h3><p>Apple Watch中的快速交互对于体验至关重要。动画和声音之间的同步对于用户至关重要。重要的是要考虑到显示的信息应该快速浏览并易于消除。</p>\n<h2 id=\"Apple-Watch体验的权衡点\"><a href=\"#Apple-Watch体验的权衡点\" class=\"headerlink\" title=\"Apple Watch体验的权衡点\"></a>Apple Watch体验的权衡点</h2><p>苹果官方提供了<a href=\"https://developer.apple.com/videos/play/wwdc2017/808/\">视频</a>讲解了一些技巧。</p>\n<p>评估您的应用的最佳方法是考虑实现以下4点</p>\n<p><img src=\"https://images.ctfassets.net/ooa29xqb8tix/6MDnChHFUkSoASwSWm6Woq/cd8c7dfdb89088677467edf5bd21a5a6/Qualities_20of_20Apple_20Watch_20Experiences.jpg\" alt=\"Apple官方参考\"></p>\n<h3 id=\"清晰\"><a href=\"#清晰\" class=\"headerlink\" title=\"清晰\"></a><strong>清晰</strong></h3><p>用户第一眼就能了解界面所显示的信息。</p>\n<h3 id=\"简洁\"><a href=\"#简洁\" class=\"headerlink\" title=\"简洁\"></a><strong>简洁</strong></h3><p>直截了当。请记住，您的用户收到应用程序通知并举起手腕之间的时间只有几秒钟。</p>\n<h3 id=\"及时\"><a href=\"#及时\" class=\"headerlink\" title=\"及时\"></a><strong>及时</strong></h3><p>在尽可能短的时间内向用户显示最相关的信息。这样，您正在使您的应用与用户更加相关。</p>\n<h3 id=\"客制化\"><a href=\"#客制化\" class=\"headerlink\" title=\"客制化\"></a><strong>客制化</strong></h3><p>如果您的应用程序完成了前三个要素，那么您的用户将感到个人联系。理想情况下，尝试加深与用户的这种关系。</p>\n","site":{"data":{}},"excerpt":"<p>收录Apple Watch程序设计学习中的若干收获，有基本原则、体验权衡点等。</p>","more":"<h2 id=\"基本原则\"><a href=\"#基本原则\" class=\"headerlink\" title=\"基本原则\"></a>基本原则</h2><p>设计Apple Watch应用程序与设计iOS程序存在很大不同，我们需要了解其是iPhone的功能拓展，它的尺寸带来了新的手势操作和UI/UX 设计。</p>\n<h3 id=\"私人联系\"><a href=\"#私人联系\" class=\"headerlink\" title=\"私人联系\"></a><strong>私人联系</strong></h3><p>Apple Watch可能是第一个与用户建立紧密联系的设备，因此您在设计过程中需要利用这种独特的结合。</p>\n<h3 id=\"整体化设计\"><a href=\"#整体化设计\" class=\"headerlink\" title=\"整体化设计\"></a><strong>整体化设计</strong></h3><p>Force Touch和Digital Crown是使用户与屏幕上的内容无缝交互的关键组件。在设计应用程序时，目标应该是增强用户的认识，即它们之间的硬件和软件是无法区分的。</p>\n<h3 id=\"轻量化交互\"><a href=\"#轻量化交互\" class=\"headerlink\" title=\"轻量化交互\"></a><strong>轻量化交互</strong></h3><p>Apple Watch中的快速交互对于体验至关重要。动画和声音之间的同步对于用户至关重要。重要的是要考虑到显示的信息应该快速浏览并易于消除。</p>\n<h2 id=\"Apple-Watch体验的权衡点\"><a href=\"#Apple-Watch体验的权衡点\" class=\"headerlink\" title=\"Apple Watch体验的权衡点\"></a>Apple Watch体验的权衡点</h2><p>苹果官方提供了<a href=\"https://developer.apple.com/videos/play/wwdc2017/808/\">视频</a>讲解了一些技巧。</p>\n<p>评估您的应用的最佳方法是考虑实现以下4点</p>\n<p><img src=\"https://images.ctfassets.net/ooa29xqb8tix/6MDnChHFUkSoASwSWm6Woq/cd8c7dfdb89088677467edf5bd21a5a6/Qualities_20of_20Apple_20Watch_20Experiences.jpg\" alt=\"Apple官方参考\"></p>\n<h3 id=\"清晰\"><a href=\"#清晰\" class=\"headerlink\" title=\"清晰\"></a><strong>清晰</strong></h3><p>用户第一眼就能了解界面所显示的信息。</p>\n<h3 id=\"简洁\"><a href=\"#简洁\" class=\"headerlink\" title=\"简洁\"></a><strong>简洁</strong></h3><p>直截了当。请记住，您的用户收到应用程序通知并举起手腕之间的时间只有几秒钟。</p>\n<h3 id=\"及时\"><a href=\"#及时\" class=\"headerlink\" title=\"及时\"></a><strong>及时</strong></h3><p>在尽可能短的时间内向用户显示最相关的信息。这样，您正在使您的应用与用户更加相关。</p>\n<h3 id=\"客制化\"><a href=\"#客制化\" class=\"headerlink\" title=\"客制化\"></a><strong>客制化</strong></h3><p>如果您的应用程序完成了前三个要素，那么您的用户将感到个人联系。理想情况下，尝试加深与用户的这种关系。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"https://images.ctfassets.net/ooa29xqb8tix/6MDnChHFUkSoASwSWm6Woq/cd8c7dfdb89088677467edf5bd21a5a6/Qualities_20of_20Apple_20Watch_20Experiences.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:18:34 GMT+0800 (中国标准时间)","title":"Apple Watch程序设计","path":"2020/02/07/Apple Watch/","eyeCatchImage":"https://images.ctfassets.net/ooa29xqb8tix/6MDnChHFUkSoASwSWm6Woq/cd8c7dfdb89088677467edf5bd21a5a6/Qualities_20of_20Apple_20Watch_20Experiences.jpg","excerpt":"<p>收录Apple Watch程序设计学习中的若干收获，有基本原则、体验权衡点等。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-07T08:45:28.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-07T08:45:28.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"设计","tags":["Apple","Xcode"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":539},{"title":"Design+Code 的 Vue.js 课程学习摘录","date":"2020-02-10T17:20:20.000Z","_content":"\n收录 Vue.js 课程学习中的若干收获，包含遇到的问题、收获总结等。\n<!--more-->\n\n## 配置组件的data属性\n\n课程初提及的定义**data**的方法经过测试不可行，即如下代码片段。\n\n\n```js\n<script>\nexport default {\n  name: \"SignIn\",\n  data: {\n    isDarkMode: true\n  },\n  methods: {\n    toggleDarkMode() {\n      this.isDarkMode = !this.isDarkMode;\n    }\n  }\n};\n</script>\n```\n\n**data** 包含可以在触发组件更新的数据。\n**methods** 包含可以触发数据更改的函数。\n\n后文中解释了需要作出的更改：\n\n>为了让效果工作，我们需要的data属性是一个函数。这是 Vue组件的规则，并不是`App.vue`的规则。因此需要将当前数据属性替换为：\n\n```js\ndata() {\n  return {\n      isDarkMode: true\n  }\n},\n```\n\n经查阅官方文档，了解到 data 必须是一个函数。\n\n>当我们定义 <button-counter> 组件时，你可能会发现它的 data 并不是直接提供一个对象，取而代之的是，一个组件的 data 选项必须是一个函数，因此每个实例可以维护一份被返回对象的独立的拷贝。如果 Vue 没有这条规则，点击一个按钮就可能会影响到其它所有实例。\n\n解释得非常清楚，学习 `Vue.js` 等前端技术或许可以速成，但文档一定是不可或缺的一块。\n\n## 配置全局样式\n\n可以在CSS `<style> `的开头导入`.css`文件，但对其进行配置可以使其用于整个项目的 Vue 文件。\n`vue.config.js` 是一个可选的配置文件，如果项目的 (和 `package.json` 同级的) 根目录中存在这个文件，那么它会被 `@vue/cli-service` 自动加载。[官方文档](https://cli.vuejs.org/zh/config/#chainwebpack)详细解释了全局 CLI 配置方法。\n教程指导做的是在项目的根目录中创建一个名为`vue.config.js`的文件，并且在此输入以下配置：\n\n```js\n// vue.config.js\nmodule.exports = {\n    css: {\n        loaderOptions: {\n            sass: {\n                data: `\n                    @import \"@/global-styles/colors.scss\";\n                    @import \"@/global-styles/typography.scss\";\n                `\n            }\n        }\n    }\n}\n```\n\n如果使用的是最新版本的 `Vue CLI`，尽管进行了到 **Vue CLI > in Project Tasks > serve** 重新运行任务，还是会提示报错无法运行。\n\n新版本的 `Vue CLI` 提供了 `Dart Sass` 与 `node-sass` 两种类型的 Sass 配置，在`sass-loader`的[implementation](https://github.com/webpack-contrib/sass-loader)中两者有所不同。\n\n原因在于在 `sass-loader ` v7 中，`prependData`选项名是 \"data”，已经不适用。\n默认情况下 `sass` 选项会同时对 `sass` 和 `scss` 语法同时生效，因为 `scss` 语法在内部也是由 sass-loader 处理的，但是在配置 `data` 选项的时候，`scss` 语法会要求语句结尾必须有分号，`sass` 则要求必须没有分号。在这种情况下，我们可以使用 `scss` 选项，对 `scss` 语法进行单独配置。实例代码来自[官方文档](https://cli.vuejs.org/zh/guide/css.html#css-modules)。\n\n```js\n// vue.config.js\nmodule.exports = {\n  css: {\n    loaderOptions: {\n      // 给 sass-loader 传递选项\n      sass: {\n        // @/ 是 src/ 的别名\n        // 假设存在 `src/variables.sass` 这个文件\n        prependData: `@import \"~@/variables.sass\"`\n      },\n      scss: {\n        prependData: `@import \"~@/variables.scss\";`\n      }\n    }\n  }\n}\n```\n","source":"_posts/Design+Code_Vue.js_Learning.md","raw":"---\ntitle: Design+Code 的 Vue.js 课程学习摘录\ndate: 2020-02-11 01:20:20\ncategories: \n- 技术\ntags: \n- Vue.js\n- 前端框架\n---\n\n收录 Vue.js 课程学习中的若干收获，包含遇到的问题、收获总结等。\n<!--more-->\n\n## 配置组件的data属性\n\n课程初提及的定义**data**的方法经过测试不可行，即如下代码片段。\n\n\n```js\n<script>\nexport default {\n  name: \"SignIn\",\n  data: {\n    isDarkMode: true\n  },\n  methods: {\n    toggleDarkMode() {\n      this.isDarkMode = !this.isDarkMode;\n    }\n  }\n};\n</script>\n```\n\n**data** 包含可以在触发组件更新的数据。\n**methods** 包含可以触发数据更改的函数。\n\n后文中解释了需要作出的更改：\n\n>为了让效果工作，我们需要的data属性是一个函数。这是 Vue组件的规则，并不是`App.vue`的规则。因此需要将当前数据属性替换为：\n\n```js\ndata() {\n  return {\n      isDarkMode: true\n  }\n},\n```\n\n经查阅官方文档，了解到 data 必须是一个函数。\n\n>当我们定义 <button-counter> 组件时，你可能会发现它的 data 并不是直接提供一个对象，取而代之的是，一个组件的 data 选项必须是一个函数，因此每个实例可以维护一份被返回对象的独立的拷贝。如果 Vue 没有这条规则，点击一个按钮就可能会影响到其它所有实例。\n\n解释得非常清楚，学习 `Vue.js` 等前端技术或许可以速成，但文档一定是不可或缺的一块。\n\n## 配置全局样式\n\n可以在CSS `<style> `的开头导入`.css`文件，但对其进行配置可以使其用于整个项目的 Vue 文件。\n`vue.config.js` 是一个可选的配置文件，如果项目的 (和 `package.json` 同级的) 根目录中存在这个文件，那么它会被 `@vue/cli-service` 自动加载。[官方文档](https://cli.vuejs.org/zh/config/#chainwebpack)详细解释了全局 CLI 配置方法。\n教程指导做的是在项目的根目录中创建一个名为`vue.config.js`的文件，并且在此输入以下配置：\n\n```js\n// vue.config.js\nmodule.exports = {\n    css: {\n        loaderOptions: {\n            sass: {\n                data: `\n                    @import \"@/global-styles/colors.scss\";\n                    @import \"@/global-styles/typography.scss\";\n                `\n            }\n        }\n    }\n}\n```\n\n如果使用的是最新版本的 `Vue CLI`，尽管进行了到 **Vue CLI > in Project Tasks > serve** 重新运行任务，还是会提示报错无法运行。\n\n新版本的 `Vue CLI` 提供了 `Dart Sass` 与 `node-sass` 两种类型的 Sass 配置，在`sass-loader`的[implementation](https://github.com/webpack-contrib/sass-loader)中两者有所不同。\n\n原因在于在 `sass-loader ` v7 中，`prependData`选项名是 \"data”，已经不适用。\n默认情况下 `sass` 选项会同时对 `sass` 和 `scss` 语法同时生效，因为 `scss` 语法在内部也是由 sass-loader 处理的，但是在配置 `data` 选项的时候，`scss` 语法会要求语句结尾必须有分号，`sass` 则要求必须没有分号。在这种情况下，我们可以使用 `scss` 选项，对 `scss` 语法进行单独配置。实例代码来自[官方文档](https://cli.vuejs.org/zh/guide/css.html#css-modules)。\n\n```js\n// vue.config.js\nmodule.exports = {\n  css: {\n    loaderOptions: {\n      // 给 sass-loader 传递选项\n      sass: {\n        // @/ 是 src/ 的别名\n        // 假设存在 `src/variables.sass` 这个文件\n        prependData: `@import \"~@/variables.sass\"`\n      },\n      scss: {\n        prependData: `@import \"~@/variables.scss\";`\n      }\n    }\n  }\n}\n```\n","slug":"Design+Code_Vue.js_Learning","published":1,"updated":"2022-07-24T15:18:52.936Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1m000ao76f6oofbwih","content":"<p>收录 Vue.js 课程学习中的若干收获，包含遇到的问题、收获总结等。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"配置组件的data属性\"><a href=\"#配置组件的data属性\" class=\"headerlink\" title=\"配置组件的data属性\"></a>配置组件的data属性</h2><p>课程初提及的定义<strong>data</strong>的方法经过测试不可行，即如下代码片段。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&quot;SignIn&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">isDarkMode</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">toggleDarkMode</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.isDarkMode = !<span class=\"built_in\">this</span>.isDarkMode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>data</strong> 包含可以在触发组件更新的数据。<br><strong>methods</strong> 包含可以触发数据更改的函数。</p>\n<p>后文中解释了需要作出的更改：</p>\n<blockquote>\n<p>为了让效果工作，我们需要的data属性是一个函数。这是 Vue组件的规则，并不是<code>App.vue</code>的规则。因此需要将当前数据属性替换为：</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">isDarkMode</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>经查阅官方文档，了解到 data 必须是一个函数。</p>\n<blockquote>\n<p>当我们定义 <button-counter> 组件时，你可能会发现它的 data 并不是直接提供一个对象，取而代之的是，一个组件的 data 选项必须是一个函数，因此每个实例可以维护一份被返回对象的独立的拷贝。如果 Vue 没有这条规则，点击一个按钮就可能会影响到其它所有实例。</p>\n</blockquote>\n<p>解释得非常清楚，学习 <code>Vue.js</code> 等前端技术或许可以速成，但文档一定是不可或缺的一块。</p>\n<h2 id=\"配置全局样式\"><a href=\"#配置全局样式\" class=\"headerlink\" title=\"配置全局样式\"></a>配置全局样式</h2><p>可以在CSS <code>&lt;style&gt; </code>的开头导入<code>.css</code>文件，但对其进行配置可以使其用于整个项目的 Vue 文件。<br><code>vue.config.js</code> 是一个可选的配置文件，如果项目的 (和 <code>package.json</code> 同级的) 根目录中存在这个文件，那么它会被 <code>@vue/cli-service</code> 自动加载。<a href=\"https://cli.vuejs.org/zh/config/#chainwebpack\">官方文档</a>详细解释了全局 CLI 配置方法。<br>教程指导做的是在项目的根目录中创建一个名为<code>vue.config.js</code>的文件，并且在此输入以下配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vue.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">css</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">loaderOptions</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">sass</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">data</span>: <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">                    @import &quot;@/global-styles/colors.scss&quot;;</span></span><br><span class=\"line\"><span class=\"string\">                    @import &quot;@/global-styles/typography.scss&quot;;</span></span><br><span class=\"line\"><span class=\"string\">                `</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果使用的是最新版本的 <code>Vue CLI</code>，尽管进行了到 <strong>Vue CLI &gt; in Project Tasks &gt; serve</strong> 重新运行任务，还是会提示报错无法运行。</p>\n<p>新版本的 <code>Vue CLI</code> 提供了 <code>Dart Sass</code> 与 <code>node-sass</code> 两种类型的 Sass 配置，在<code>sass-loader</code>的<a href=\"https://github.com/webpack-contrib/sass-loader\">implementation</a>中两者有所不同。</p>\n<p>原因在于在 <code>sass-loader </code> v7 中，<code>prependData</code>选项名是 “data”，已经不适用。<br>默认情况下 <code>sass</code> 选项会同时对 <code>sass</code> 和 <code>scss</code> 语法同时生效，因为 <code>scss</code> 语法在内部也是由 sass-loader 处理的，但是在配置 <code>data</code> 选项的时候，<code>scss</code> 语法会要求语句结尾必须有分号，<code>sass</code> 则要求必须没有分号。在这种情况下，我们可以使用 <code>scss</code> 选项，对 <code>scss</code> 语法进行单独配置。实例代码来自<a href=\"https://cli.vuejs.org/zh/guide/css.html#css-modules\">官方文档</a>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vue.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">css</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">loaderOptions</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 给 sass-loader 传递选项</span></span><br><span class=\"line\">      <span class=\"attr\">sass</span>: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// @/ 是 src/ 的别名</span></span><br><span class=\"line\">        <span class=\"comment\">// 假设存在 `src/variables.sass` 这个文件</span></span><br><span class=\"line\">        <span class=\"attr\">prependData</span>: <span class=\"string\">`@import &quot;~@/variables.sass&quot;`</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">scss</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">prependData</span>: <span class=\"string\">`@import &quot;~@/variables.scss&quot;;`</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n","site":{"data":{}},"excerpt":"<p>收录 Vue.js 课程学习中的若干收获，包含遇到的问题、收获总结等。</p>","more":"<h2 id=\"配置组件的data属性\"><a href=\"#配置组件的data属性\" class=\"headerlink\" title=\"配置组件的data属性\"></a>配置组件的data属性</h2><p>课程初提及的定义<strong>data</strong>的方法经过测试不可行，即如下代码片段。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> &#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>: <span class=\"string\">&quot;SignIn&quot;</span>,</span><br><span class=\"line\">  <span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">isDarkMode</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">methods</span>: &#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"title\">toggleDarkMode</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">      <span class=\"built_in\">this</span>.isDarkMode = !<span class=\"built_in\">this</span>.isDarkMode;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<p><strong>data</strong> 包含可以在触发组件更新的数据。<br><strong>methods</strong> 包含可以触发数据更改的函数。</p>\n<p>后文中解释了需要作出的更改：</p>\n<blockquote>\n<p>为了让效果工作，我们需要的data属性是一个函数。这是 Vue组件的规则，并不是<code>App.vue</code>的规则。因此需要将当前数据属性替换为：</p>\n</blockquote>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"title\">data</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> &#123;</span><br><span class=\"line\">      <span class=\"attr\">isDarkMode</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n\n<p>经查阅官方文档，了解到 data 必须是一个函数。</p>\n<blockquote>\n<p>当我们定义 <button-counter> 组件时，你可能会发现它的 data 并不是直接提供一个对象，取而代之的是，一个组件的 data 选项必须是一个函数，因此每个实例可以维护一份被返回对象的独立的拷贝。如果 Vue 没有这条规则，点击一个按钮就可能会影响到其它所有实例。</p>\n</blockquote>\n<p>解释得非常清楚，学习 <code>Vue.js</code> 等前端技术或许可以速成，但文档一定是不可或缺的一块。</p>\n<h2 id=\"配置全局样式\"><a href=\"#配置全局样式\" class=\"headerlink\" title=\"配置全局样式\"></a>配置全局样式</h2><p>可以在CSS <code>&lt;style&gt; </code>的开头导入<code>.css</code>文件，但对其进行配置可以使其用于整个项目的 Vue 文件。<br><code>vue.config.js</code> 是一个可选的配置文件，如果项目的 (和 <code>package.json</code> 同级的) 根目录中存在这个文件，那么它会被 <code>@vue/cli-service</code> 自动加载。<a href=\"https://cli.vuejs.org/zh/config/#chainwebpack\">官方文档</a>详细解释了全局 CLI 配置方法。<br>教程指导做的是在项目的根目录中创建一个名为<code>vue.config.js</code>的文件，并且在此输入以下配置：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vue.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">css</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">loaderOptions</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">sass</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">data</span>: <span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">                    @import &quot;@/global-styles/colors.scss&quot;;</span></span><br><span class=\"line\"><span class=\"string\">                    @import &quot;@/global-styles/typography.scss&quot;;</span></span><br><span class=\"line\"><span class=\"string\">                `</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果使用的是最新版本的 <code>Vue CLI</code>，尽管进行了到 <strong>Vue CLI &gt; in Project Tasks &gt; serve</strong> 重新运行任务，还是会提示报错无法运行。</p>\n<p>新版本的 <code>Vue CLI</code> 提供了 <code>Dart Sass</code> 与 <code>node-sass</code> 两种类型的 Sass 配置，在<code>sass-loader</code>的<a href=\"https://github.com/webpack-contrib/sass-loader\">implementation</a>中两者有所不同。</p>\n<p>原因在于在 <code>sass-loader </code> v7 中，<code>prependData</code>选项名是 “data”，已经不适用。<br>默认情况下 <code>sass</code> 选项会同时对 <code>sass</code> 和 <code>scss</code> 语法同时生效，因为 <code>scss</code> 语法在内部也是由 sass-loader 处理的，但是在配置 <code>data</code> 选项的时候，<code>scss</code> 语法会要求语句结尾必须有分号，<code>sass</code> 则要求必须没有分号。在这种情况下，我们可以使用 <code>scss</code> 选项，对 <code>scss</code> 语法进行单独配置。实例代码来自<a href=\"https://cli.vuejs.org/zh/guide/css.html#css-modules\">官方文档</a>。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// vue.config.js</span></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">css</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">loaderOptions</span>: &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 给 sass-loader 传递选项</span></span><br><span class=\"line\">      <span class=\"attr\">sass</span>: &#123;</span><br><span class=\"line\">        <span class=\"comment\">// @/ 是 src/ 的别名</span></span><br><span class=\"line\">        <span class=\"comment\">// 假设存在 `src/variables.sass` 这个文件</span></span><br><span class=\"line\">        <span class=\"attr\">prependData</span>: <span class=\"string\">`@import &quot;~@/variables.sass&quot;`</span></span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      <span class=\"attr\">scss</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">prependData</span>: <span class=\"string\">`@import &quot;~@/variables.scss&quot;;`</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:18:52 GMT+0800 (中国标准时间)","title":"Design+Code 的 Vue.js 课程学习摘录","path":"2020/02/11/Design+Code_Vue.js_Learning/","eyeCatchImage":null,"excerpt":"<p>收录 Vue.js 课程学习中的若干收获，包含遇到的问题、收获总结等。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-10T17:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-10T17:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Vue.js","前端框架"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":1735},{"title":"设计、摄影与编码的碎碎念","date":"2020-07-04T17:20:20.000Z","copyright":true,"_content":"\n学习了一部分 Design + Code 课程，在 Dribbble 发布了一部分用 Sketch 设计的东西，加之十分喜欢 Notion 这款笔记应用，使得我产生了对于设计与编码的一些零碎的思考。\nNotion招聘的标准为“Designer Who Can Code”，我将其视为也是一种社会需求的反馈，相较于强调编码的能力，他们的团队更强调设计师的属性。随着应用程序的同质化越来越明显，优秀的设计、优秀的交互能够给用户带来耳目一新的体验，有时能够获得更好的回报。\n\n<!--more-->\n\n## 最近的定位\n在学习前端课程的时候，我看到身边的同学虽然掌握着编码的技能却把页面写得一团糟。对于设计师而言，从事前端工程师或许是一个不错的选择，事实也确实如此。如果希望成为一名独立开发者，那么设计的技能更是不可或缺。\n随着 iOS 14 的推出，SwiftUI更是被推到了一个更高优先级的位置上，甚至对于新版本的小部件的适配都需要使用 SwiftUI。上学期自学了 iOS 相关的课程，当时的 SwiftUI 并未完善，在编码的过程中还能遇到 bug，这一点暂且不提，我仍然期待 SwiftUI 的新表现，可以说对于设计师乃至独立开发者而言 SwiftUI 绝对是一个重大利好，开发的门槛进一步降低。\n我的计算机学习生涯带给我的优势又体现在哪里呢，可能是更好的计算机基础，可能是对于算法优化的了解。如果我将自己定位于独立开发者，我会更倾向于做设计导向的App而不是算法导向的App，虽然其中的技术含量可能看起来捉襟见愁，但我认为优秀的设计（不仅仅是界面设计，也包括组织设计）是驱使用户选择的更大诱因。意思并不是算法不重要，而是要对内容进行良好的包装，这一点将用于指导我未来App的开发。\n\n## 最近的设计\n由于并不是设计出身，我自学了 Design + Code 的设计课程，包括Sketch的使用、字体、动画的应用等等，并且学习了少数派的「比身边人多懂一点设计」课程，后者非常推荐没有设计基础的人仔细阅读。目前能做出一些符合我想发的、并不蹩脚的设计，如 App 的 icon 设计、UI设计等等。\n列举两个我发布在 Dribbble 上的作品，第一个是对 Notion 图标的重新设计。由于 Notion 是一款笔记应用，我能够联想到彩色的便签与装帧精美的册子，那如何体现 Notion 的品牌意义呢？我参考了原版 Notion 的图标，为了使得大写字母显得不那么突兀，我为其加上了阴影。最后参照 Logic Pro X等 App 给予其一个恰到好处的倾角。该图标被 Andreas Storm 等人Rebound，也算是一个不小的成就。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.21.51.png)\n另一个设计方案就是我的音乐播放器设计，目前编码已经完成了1/2，是我目前完成的第一个“有设计”的App，至少MockUp看起来还不错。其设计理念十分简洁，一个页面只完成一个类别的功能，充分利用 UIKit，目前仍然有不少功能想做，包括接入 Apple Music、从LyricsKit获取歌词等等，无法确定何时上架。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.33.30.png)\n最后放出我在 Dribbble 的地址： https://dribbble.com/stephenfang\n\n## 最近的摄影\n因为疫情缘故今年并没有出门，连寒假旅行也连带取消了，只能通过 Unsplash 发一些先前的照片，我所理解的低阶摄影（也就是我目前实践的）满足于把画面交代清楚，以不一样的构图拍出比游客照更具有感觉的东西。好的照片应该是能够讲述故事的，这也是街头摄影之所以能打动人的原因，显然我并没有做到，但是我仍在不断尝试让平凡的照片看起来具有不平凡的内容。例如对于物体的拍摄，我希望画面能够传递一定的感情信息，例如以下的猫狗照片，你可能会思考它们此刻在想些什么。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.52.32.png)\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.54.52.png)\n另一个要点就是构图，简单的构图方式可能得到不同的效果。构图方式可以简单复制，而建筑和你的视角则不会。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.56.52.png)\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.59.12.png)\n罗伯特·卡帕说过“如果你拍得不够好，是因为你离得不够近”，不做这句话的过分解读，但我确实能够以此作为我玩摄影的一条箴言。以下为在上海人民英雄纪念碑下拍摄的照片，当时只是感觉自己被震撼到了就按下了快门，没有想到登上了 Unsplash 的信息流推荐，这也促使着我业余时间在该平台下继续深耕。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2014.00.55.png)\n最后放出我在 Unsplash 的地址： https://unsplash.com/@stephenfang","source":"_posts/Design_Thoughts.md","raw":"---\ntitle: 设计、摄影与编码的碎碎念\ndate: 2020-07-05 01:20:20\ncategories: \n- 设计\ntags: \n- iOS\n- UI\n- UX\ncopyright: true\n---\n\n学习了一部分 Design + Code 课程，在 Dribbble 发布了一部分用 Sketch 设计的东西，加之十分喜欢 Notion 这款笔记应用，使得我产生了对于设计与编码的一些零碎的思考。\nNotion招聘的标准为“Designer Who Can Code”，我将其视为也是一种社会需求的反馈，相较于强调编码的能力，他们的团队更强调设计师的属性。随着应用程序的同质化越来越明显，优秀的设计、优秀的交互能够给用户带来耳目一新的体验，有时能够获得更好的回报。\n\n<!--more-->\n\n## 最近的定位\n在学习前端课程的时候，我看到身边的同学虽然掌握着编码的技能却把页面写得一团糟。对于设计师而言，从事前端工程师或许是一个不错的选择，事实也确实如此。如果希望成为一名独立开发者，那么设计的技能更是不可或缺。\n随着 iOS 14 的推出，SwiftUI更是被推到了一个更高优先级的位置上，甚至对于新版本的小部件的适配都需要使用 SwiftUI。上学期自学了 iOS 相关的课程，当时的 SwiftUI 并未完善，在编码的过程中还能遇到 bug，这一点暂且不提，我仍然期待 SwiftUI 的新表现，可以说对于设计师乃至独立开发者而言 SwiftUI 绝对是一个重大利好，开发的门槛进一步降低。\n我的计算机学习生涯带给我的优势又体现在哪里呢，可能是更好的计算机基础，可能是对于算法优化的了解。如果我将自己定位于独立开发者，我会更倾向于做设计导向的App而不是算法导向的App，虽然其中的技术含量可能看起来捉襟见愁，但我认为优秀的设计（不仅仅是界面设计，也包括组织设计）是驱使用户选择的更大诱因。意思并不是算法不重要，而是要对内容进行良好的包装，这一点将用于指导我未来App的开发。\n\n## 最近的设计\n由于并不是设计出身，我自学了 Design + Code 的设计课程，包括Sketch的使用、字体、动画的应用等等，并且学习了少数派的「比身边人多懂一点设计」课程，后者非常推荐没有设计基础的人仔细阅读。目前能做出一些符合我想发的、并不蹩脚的设计，如 App 的 icon 设计、UI设计等等。\n列举两个我发布在 Dribbble 上的作品，第一个是对 Notion 图标的重新设计。由于 Notion 是一款笔记应用，我能够联想到彩色的便签与装帧精美的册子，那如何体现 Notion 的品牌意义呢？我参考了原版 Notion 的图标，为了使得大写字母显得不那么突兀，我为其加上了阴影。最后参照 Logic Pro X等 App 给予其一个恰到好处的倾角。该图标被 Andreas Storm 等人Rebound，也算是一个不小的成就。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.21.51.png)\n另一个设计方案就是我的音乐播放器设计，目前编码已经完成了1/2，是我目前完成的第一个“有设计”的App，至少MockUp看起来还不错。其设计理念十分简洁，一个页面只完成一个类别的功能，充分利用 UIKit，目前仍然有不少功能想做，包括接入 Apple Music、从LyricsKit获取歌词等等，无法确定何时上架。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.33.30.png)\n最后放出我在 Dribbble 的地址： https://dribbble.com/stephenfang\n\n## 最近的摄影\n因为疫情缘故今年并没有出门，连寒假旅行也连带取消了，只能通过 Unsplash 发一些先前的照片，我所理解的低阶摄影（也就是我目前实践的）满足于把画面交代清楚，以不一样的构图拍出比游客照更具有感觉的东西。好的照片应该是能够讲述故事的，这也是街头摄影之所以能打动人的原因，显然我并没有做到，但是我仍在不断尝试让平凡的照片看起来具有不平凡的内容。例如对于物体的拍摄，我希望画面能够传递一定的感情信息，例如以下的猫狗照片，你可能会思考它们此刻在想些什么。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.52.32.png)\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.54.52.png)\n另一个要点就是构图，简单的构图方式可能得到不同的效果。构图方式可以简单复制，而建筑和你的视角则不会。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.56.52.png)\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.59.12.png)\n罗伯特·卡帕说过“如果你拍得不够好，是因为你离得不够近”，不做这句话的过分解读，但我确实能够以此作为我玩摄影的一条箴言。以下为在上海人民英雄纪念碑下拍摄的照片，当时只是感觉自己被震撼到了就按下了快门，没有想到登上了 Unsplash 的信息流推荐，这也促使着我业余时间在该平台下继续深耕。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2014.00.55.png)\n最后放出我在 Unsplash 的地址： https://unsplash.com/@stephenfang","slug":"Design_Thoughts","published":1,"updated":"2022-07-24T15:18:44.351Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1o000do76f0eik87gd","content":"<p>学习了一部分 Design + Code 课程，在 Dribbble 发布了一部分用 Sketch 设计的东西，加之十分喜欢 Notion 这款笔记应用，使得我产生了对于设计与编码的一些零碎的思考。<br>Notion招聘的标准为“Designer Who Can Code”，我将其视为也是一种社会需求的反馈，相较于强调编码的能力，他们的团队更强调设计师的属性。随着应用程序的同质化越来越明显，优秀的设计、优秀的交互能够给用户带来耳目一新的体验，有时能够获得更好的回报。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"最近的定位\"><a href=\"#最近的定位\" class=\"headerlink\" title=\"最近的定位\"></a>最近的定位</h2><p>在学习前端课程的时候，我看到身边的同学虽然掌握着编码的技能却把页面写得一团糟。对于设计师而言，从事前端工程师或许是一个不错的选择，事实也确实如此。如果希望成为一名独立开发者，那么设计的技能更是不可或缺。<br>随着 iOS 14 的推出，SwiftUI更是被推到了一个更高优先级的位置上，甚至对于新版本的小部件的适配都需要使用 SwiftUI。上学期自学了 iOS 相关的课程，当时的 SwiftUI 并未完善，在编码的过程中还能遇到 bug，这一点暂且不提，我仍然期待 SwiftUI 的新表现，可以说对于设计师乃至独立开发者而言 SwiftUI 绝对是一个重大利好，开发的门槛进一步降低。<br>我的计算机学习生涯带给我的优势又体现在哪里呢，可能是更好的计算机基础，可能是对于算法优化的了解。如果我将自己定位于独立开发者，我会更倾向于做设计导向的App而不是算法导向的App，虽然其中的技术含量可能看起来捉襟见愁，但我认为优秀的设计（不仅仅是界面设计，也包括组织设计）是驱使用户选择的更大诱因。意思并不是算法不重要，而是要对内容进行良好的包装，这一点将用于指导我未来App的开发。</p>\n<h2 id=\"最近的设计\"><a href=\"#最近的设计\" class=\"headerlink\" title=\"最近的设计\"></a>最近的设计</h2><p>由于并不是设计出身，我自学了 Design + Code 的设计课程，包括Sketch的使用、字体、动画的应用等等，并且学习了少数派的「比身边人多懂一点设计」课程，后者非常推荐没有设计基础的人仔细阅读。目前能做出一些符合我想发的、并不蹩脚的设计，如 App 的 icon 设计、UI设计等等。<br>列举两个我发布在 Dribbble 上的作品，第一个是对 Notion 图标的重新设计。由于 Notion 是一款笔记应用，我能够联想到彩色的便签与装帧精美的册子，那如何体现 Notion 的品牌意义呢？我参考了原版 Notion 的图标，为了使得大写字母显得不那么突兀，我为其加上了阴影。最后参照 Logic Pro X等 App 给予其一个恰到好处的倾角。该图标被 Andreas Storm 等人Rebound，也算是一个不小的成就。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.21.51.png\"><br>另一个设计方案就是我的音乐播放器设计，目前编码已经完成了1/2，是我目前完成的第一个“有设计”的App，至少MockUp看起来还不错。其设计理念十分简洁，一个页面只完成一个类别的功能，充分利用 UIKit，目前仍然有不少功能想做，包括接入 Apple Music、从LyricsKit获取歌词等等，无法确定何时上架。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.33.30.png\"><br>最后放出我在 Dribbble 的地址： <a href=\"https://dribbble.com/stephenfang\">https://dribbble.com/stephenfang</a></p>\n<h2 id=\"最近的摄影\"><a href=\"#最近的摄影\" class=\"headerlink\" title=\"最近的摄影\"></a>最近的摄影</h2><p>因为疫情缘故今年并没有出门，连寒假旅行也连带取消了，只能通过 Unsplash 发一些先前的照片，我所理解的低阶摄影（也就是我目前实践的）满足于把画面交代清楚，以不一样的构图拍出比游客照更具有感觉的东西。好的照片应该是能够讲述故事的，这也是街头摄影之所以能打动人的原因，显然我并没有做到，但是我仍在不断尝试让平凡的照片看起来具有不平凡的内容。例如对于物体的拍摄，我希望画面能够传递一定的感情信息，例如以下的猫狗照片，你可能会思考它们此刻在想些什么。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.52.32.png\"><br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.54.52.png\"><br>另一个要点就是构图，简单的构图方式可能得到不同的效果。构图方式可以简单复制，而建筑和你的视角则不会。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.56.52.png\"><br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.59.12.png\"><br>罗伯特·卡帕说过“如果你拍得不够好，是因为你离得不够近”，不做这句话的过分解读，但我确实能够以此作为我玩摄影的一条箴言。以下为在上海人民英雄纪念碑下拍摄的照片，当时只是感觉自己被震撼到了就按下了快门，没有想到登上了 Unsplash 的信息流推荐，这也促使着我业余时间在该平台下继续深耕。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2014.00.55.png\"><br>最后放出我在 Unsplash 的地址： <a href=\"https://unsplash.com/@stephenfang\">https://unsplash.com/@stephenfang</a></p>\n","site":{"data":{}},"excerpt":"<p>学习了一部分 Design + Code 课程，在 Dribbble 发布了一部分用 Sketch 设计的东西，加之十分喜欢 Notion 这款笔记应用，使得我产生了对于设计与编码的一些零碎的思考。<br>Notion招聘的标准为“Designer Who Can Code”，我将其视为也是一种社会需求的反馈，相较于强调编码的能力，他们的团队更强调设计师的属性。随着应用程序的同质化越来越明显，优秀的设计、优秀的交互能够给用户带来耳目一新的体验，有时能够获得更好的回报。</p>","more":"<h2 id=\"最近的定位\"><a href=\"#最近的定位\" class=\"headerlink\" title=\"最近的定位\"></a>最近的定位</h2><p>在学习前端课程的时候，我看到身边的同学虽然掌握着编码的技能却把页面写得一团糟。对于设计师而言，从事前端工程师或许是一个不错的选择，事实也确实如此。如果希望成为一名独立开发者，那么设计的技能更是不可或缺。<br>随着 iOS 14 的推出，SwiftUI更是被推到了一个更高优先级的位置上，甚至对于新版本的小部件的适配都需要使用 SwiftUI。上学期自学了 iOS 相关的课程，当时的 SwiftUI 并未完善，在编码的过程中还能遇到 bug，这一点暂且不提，我仍然期待 SwiftUI 的新表现，可以说对于设计师乃至独立开发者而言 SwiftUI 绝对是一个重大利好，开发的门槛进一步降低。<br>我的计算机学习生涯带给我的优势又体现在哪里呢，可能是更好的计算机基础，可能是对于算法优化的了解。如果我将自己定位于独立开发者，我会更倾向于做设计导向的App而不是算法导向的App，虽然其中的技术含量可能看起来捉襟见愁，但我认为优秀的设计（不仅仅是界面设计，也包括组织设计）是驱使用户选择的更大诱因。意思并不是算法不重要，而是要对内容进行良好的包装，这一点将用于指导我未来App的开发。</p>\n<h2 id=\"最近的设计\"><a href=\"#最近的设计\" class=\"headerlink\" title=\"最近的设计\"></a>最近的设计</h2><p>由于并不是设计出身，我自学了 Design + Code 的设计课程，包括Sketch的使用、字体、动画的应用等等，并且学习了少数派的「比身边人多懂一点设计」课程，后者非常推荐没有设计基础的人仔细阅读。目前能做出一些符合我想发的、并不蹩脚的设计，如 App 的 icon 设计、UI设计等等。<br>列举两个我发布在 Dribbble 上的作品，第一个是对 Notion 图标的重新设计。由于 Notion 是一款笔记应用，我能够联想到彩色的便签与装帧精美的册子，那如何体现 Notion 的品牌意义呢？我参考了原版 Notion 的图标，为了使得大写字母显得不那么突兀，我为其加上了阴影。最后参照 Logic Pro X等 App 给予其一个恰到好处的倾角。该图标被 Andreas Storm 等人Rebound，也算是一个不小的成就。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.21.51.png\"><br>另一个设计方案就是我的音乐播放器设计，目前编码已经完成了1/2，是我目前完成的第一个“有设计”的App，至少MockUp看起来还不错。其设计理念十分简洁，一个页面只完成一个类别的功能，充分利用 UIKit，目前仍然有不少功能想做，包括接入 Apple Music、从LyricsKit获取歌词等等，无法确定何时上架。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.33.30.png\"><br>最后放出我在 Dribbble 的地址： <a href=\"https://dribbble.com/stephenfang\">https://dribbble.com/stephenfang</a></p>\n<h2 id=\"最近的摄影\"><a href=\"#最近的摄影\" class=\"headerlink\" title=\"最近的摄影\"></a>最近的摄影</h2><p>因为疫情缘故今年并没有出门，连寒假旅行也连带取消了，只能通过 Unsplash 发一些先前的照片，我所理解的低阶摄影（也就是我目前实践的）满足于把画面交代清楚，以不一样的构图拍出比游客照更具有感觉的东西。好的照片应该是能够讲述故事的，这也是街头摄影之所以能打动人的原因，显然我并没有做到，但是我仍在不断尝试让平凡的照片看起来具有不平凡的内容。例如对于物体的拍摄，我希望画面能够传递一定的感情信息，例如以下的猫狗照片，你可能会思考它们此刻在想些什么。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.52.32.png\"><br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.54.52.png\"><br>另一个要点就是构图，简单的构图方式可能得到不同的效果。构图方式可以简单复制，而建筑和你的视角则不会。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.56.52.png\"><br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2013.59.12.png\"><br>罗伯特·卡帕说过“如果你拍得不够好，是因为你离得不够近”，不做这句话的过分解读，但我确实能够以此作为我玩摄影的一条箴言。以下为在上海人民英雄纪念碑下拍摄的照片，当时只是感觉自己被震撼到了就按下了快门，没有想到登上了 Unsplash 的信息流推荐，这也促使着我业余时间在该平台下继续深耕。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2014.00.55.png\"><br>最后放出我在 Unsplash 的地址： <a href=\"https://unsplash.com/@stephenfang\">https://unsplash.com/@stephenfang</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.21.51.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:18:44 GMT+0800 (中国标准时间)","title":"设计、摄影与编码的碎碎念","path":"2020/07/05/Design_Thoughts/","eyeCatchImage":"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2001.21.51.png","excerpt":"<p>学习了一部分 Design + Code 课程，在 Dribbble 发布了一部分用 Sketch 设计的东西，加之十分喜欢 Notion 这款笔记应用，使得我产生了对于设计与编码的一些零碎的思考。<br>Notion招聘的标准为“Designer Who Can Code”，我将其视为也是一种社会需求的反馈，相较于强调编码的能力，他们的团队更强调设计师的属性。随着应用程序的同质化越来越明显，优秀的设计、优秀的交互能够给用户带来耳目一新的体验，有时能够获得更好的回报。</p>","date":{"_isAMomentObject":true,"_i":"2020-07-04T17:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-04T17:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"设计","tags":["iOS","UI","UX"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":1715},{"title":"2022年七月读书摘录","date":"2022-08-09T17:04:12.000Z","copyright":true,"_content":"\n这个月一共阅读了四本书，分别是\n- 《考试脑科学》\n- 《苦才是人生》\n- 《成为乔布斯》\n- 《失去的三十年》\n回头看读书笔记的时候又帮自己温习了一遍内容。\n\n<!--more-->\n\n# [考试脑科学](https://book.douban.com/subject/33944838//)\n\n这本书提到了不少有意思的概念，包括如何科学用脑，脑的构成以及解释了记忆机制。\n如果你同样对这本书感兴趣，可以阅读知乎上的这一篇[文章](https://zhuanlan.zhihu.com/p/141736616)。\n\n## 第 1 章 记忆究竟是什么\n\n> 无论是从长期记忆里调取信息，还是向长期记忆里保存信息，都需要一个临时储存信息的场所，这就是短期记忆。通常来说，要想让记忆长期保存在人脑中，都要先通过短期记忆这一关。\n> \n\n> 保存长期记忆的部位叫作“大脑皮质”，它相当于人脑的“硬盘”，可以保存我们已经记住的知识。\n> \n\n> 人脑大约会消耗人体总能耗的 20%，但其质量只占不到人体体重的 2%。可见从每单位所需能耗来看，人脑是个不折不扣的耗能大户。\n> \n\n> 答案还是一样的：重新再记忆就可以了。除此之外别无他法，因为人脑的设计机制，本来就是为了能够尽快忘记大量信息。\n> \n\n## 第 2 章 “欺骗”大脑的方法\n\n> 最容易忘记的时间恰巧是刚刚记住的时候——在记住信息后的 4 小时内，我们会一口气忘记大约一半的内容。但在此之后，剩余的记忆却能维持较长时间，它们是逐渐被忘记的。\n> \n\n> 不仅是考试前，在平时的学习过程中也要尽量避免在一天内向脑输入大量新知识。说起来，学习的重点原本就应该放在“复习”上，我会在之后对复习的重要性进行说明。总之，在力所能及的范围内毫无压力地记住自己所能记住的内容，才是符合记忆性质的学习方法。\n> \n\n> 换句话说，那些我们觉得自己已经完全忘记的信息，其实都完整地保存在无意识的世界里，只不过它们属于潜在的痕迹，所以才无法被我们想起来。\n> \n\n> 潜在记忆的保存时间只有 1 个月左右，如果不在 1 个月以内复习学到的知识，潜在记忆就无法发挥作用了。所以，并不是在任何时候复习都有效果，大家最迟也要在 1 个月以内就开始复习。\n> \n\n> 结合海马体的性质，我建议大家按照如下计划展开复习。\n第 1 次复习：学习后的第 2 天\n第 2 次复习：第 1 次复习 1 周后\n第 3 次复习：第 2 次复习 2 周后\n第 4 次复习：第 3 次复习 1 个月后\n> \n\n> 对脑而言，更重要的是“输出”。也就是说，站在海马体的角度，更重要的是得出这种判断：“这个信息竟然会被如此频繁地调用，看来必须要记住它才行。”\n> \n\n## 第 3 章 海马体和 LTP\n\n> 波是“好奇心”的象征。当我们第一次见到某种事物，或者第一次踏入某个地方时，脑中就会自然而然地产生θ波。换句话说，当人对什么东西感兴趣而打开好奇心之门，处于紧张、兴奋或者期待的状态时，θ波就会出现；相反，当对千篇一律的事物感到厌烦、丧失兴趣的时候，θ波就会消失。\n> \n\n> 其实在大家身边有很多能抑制乙酰胆碱发挥作用的药物，比如几乎每个人都吃过的感冒药、止泻药或晕车药等。想必大家都有吃过感冒药后脑袋发晕、很想睡觉的经历吧？这就是人脑中的乙酰胆碱被抑制的证据。所以，如果我们明明在考试前没有感冒，却“以防万一”提前服用了感冒药，那么面临的结果可能会很悲惨。\n> \n\n> 杏仁核紧邻海马体，虽然只有人类小指的指甲那么大，却担当着十分重要的角色：产生喜悦、悲伤、焦虑等情绪。如果说海马体是记忆的工厂，那么杏仁核就是情绪的工厂。激活杏仁核也容易引发神经元的 LTP。换言之，人在情绪高涨时会更容易记忆。\n> \n\n> LTP 无法承受压力，在面对逃避不开的压力时就会减弱。换句话说，记忆力会因为压力而下降。所以从这个角度来看，临阵磨枪的复习方式是非常不合理的。\n> \n\n> 灵活应用能让神经元产生 LTP 的两个秘诀——θ波（兴趣）和杏仁核（情绪）。这样一来，我们的学习效率就会得到非常大的提升了。\n> \n\n> 当肚子饿的时候我们的胃会分泌一种名为食欲刺激激素（ghrelin）的饥饿激素。这种饥饿激素能随血液循环进入海马体，促使海马体神经元产生 LTP。相反，在吃饱后不仅饥饿激素的水平会降低，而且血液还会相对集中于胃部和肠道，这往往会导致脑的活动水平降低。\n> \n\n> 从动物实验的数据来看，虽然自己走动时θ波最容易出现，但是就算自己没有亲自走动，比如乘坐交通工具移动时θ波也会出现。也就是说，即使你只是在公交或地铁里随着车的行进而晃动也没关系，只要脑能感知到正在移动的状态，就会产生θ波。\n> \n\n> 动物在感到寒冷时会产生危机感，因为它们本能地知道，到了冬天就难以捕捉到猎物了。所以在温度略低的房间里学习可以提高效率，夏天在空调冷气较强的房间、冬天在暖气不太充足的房间里学习比较好。\n> \n\n> 当我们产生喜怒哀乐等情绪时，当时的记忆能被很容易地保留下来，这也意味着充分利用杏仁核就能帮助我们加速记忆。\n> \n\n## 第 4 章 不可思议的睡眠\n\n> 在我们睡着时，脑会以各种形式整合信息，然后检查信息的一致性并“整理”过去的记忆。海马体就是在此时对信息进行审查，判断这些信息是否必要。因此，如果不睡觉，就相当于不给海马体整理并选择信息的机会。结果也可想而知，那些因为海马体来不及整理而杂乱无章的信息最终会被全部抛弃。\n> \n\n> 当我们睡着时，浅睡眠和深睡眠会反复交替多次（一般为 4～6 次）。一旦达到了充足的睡眠时间，我们就会在浅睡眠期结束时自然地醒来。但是如果在深睡眠期被闹钟强行叫醒，那么醒来后我们的心情就会变得非常糟糕，精神也会比较恍惚，而且这种意识模糊不清的状态会持续一整天，让人非常难受。\n> \n\n> 顺便一提，不仅夜晚的睡眠具有巩固记忆的效果，午睡也同样有效。如果时间允许，大家可以试着在结束上午的学习后睡一个午觉，半小时左右即可。\n> \n\n> 边睡觉边听录音的所谓的“睡眠学习法”其实并没有什么效果，所以还是不要去打扰在我们睡觉时仍然努力工作的脑比较好。\n> \n\n> 首先，请大家闭上双眼，想象自己正头戴一顶尖尖的三角帽、手里拿着一个水煮蛋。接着，将水煮蛋轻轻抛起，用另一只手接住，然后再次抛起，用最开始抛水煮蛋的手接住。就像这样，把水煮蛋在两手间来回抛接数次后，请再尝试着用自己的惯用手将水煮蛋轻而稳地放在帽尖上。成功后，一边将注意力集中在水煮蛋上，一边缓缓睁开双眼，此时注意力应该就能集中在眼前的书桌上了。一旦我们习惯了使用这样的方法，就可以省略反复抛接的环节，直接将水煮蛋立于帽尖即可集中注意力。\n> \n\n> 如何度过周末也是一个问题。比如，有人喜欢在周末睡个大懒觉，这就相当于主动给自己制造了时差，这简直就是在虐待脑。所以说，休息日也应该和平日一样，尽量在相同的时间起床。即使醒来之后还是特别困也不要睡回笼觉，等到中午再睡个午觉就好了。\n> \n\n> 对于人脑而言，睡觉前的一到两个小时是记忆的黄金时间。我自己也有在晚上睡觉前一定要工作一会儿的习惯。\n> \n\n> - 饭前处于饥饿状态，正适合学习。\n> - 睡觉前也是学习的黄金期。\n> - 早饭或晚饭后处于饱腹状态时，不学习也不要紧。可以读课外书、看电视，或者玩游戏都可以，做一些自己感兴趣的事可以让我们的生活更加丰富多彩。\n> - 午后如果实在困得坚持不住，不妨睡个午觉，不要有什么顾虑。\n> - 如果早就决定要睡午觉，那么应该在午睡前的这段时间内抓紧学习。\n> \n\n## 第 5 章 模糊的大脑\n\n> 人类的神经元通过神经纤维形成回路，但各个神经纤维之间并没有物理性接触。与电路不同，神经回路并不是一个紧密相连的整体，纤维和纤维之间存在着微小的间隙。\n> \n\n> 对某项体育运动和某种乐器的学习也是如此，在学习新事物时一定要循序渐进。如果让一个从来没踢过足球的人从倒钩球开始学习，恐怕他需要花费很长时间才能学会。不，说不定他会在练习中受伤，球技在几个月内都没有任何进步。大家一定要准确地把握自己的学习实力，逐步克服自己的弱点。\n> \n\n> 英国历史学家卡莱尔曾经这样说道：“最重要的就是不要去看远方模糊的目标，而是要做手边最具体的事情。”\n> \n\n> “明白”是一种什么样的状态呢？“明白”换言之就是“能区分”。所以，与其有闲工夫叹息“我不明白、我真的不明白啊”，还不如对知识进行“区分”，回顾自己的学习过程，直至找到自己能理解的地方，然后再从那里重新开始学习。\n> \n\n> “干劲儿”是由人脑中的伏隔核等部位产生的。伏隔核的位置接近人脑中心，它的尺寸非常小，直径甚至不到 1 厘米，但它的性质却比较复杂。要想让伏隔核活跃起来，就必须给予其一定程度的刺激，否则伏隔核是运转不起来的。\n> \n\n> 这种现象被德国精神病学家埃米尔·克雷佩林（Emil Kraepelin）称为“行动兴奋”。一旦开始行动，状态就会渐入佳境，注意力也能集中了——这就是行动兴奋。唤醒伏隔核需要一定时间，所以不管怎么样，先坐到书桌前不间断地学习十分钟再说，这种态度是非常重要的。\n> \n\n> 顺便说一下，有人认为砂糖会使人发胖，其实未必如此。发胖的原因并不一定在于高卡路里，很多时候也许是因为脂肪的摄取量超标。即使正在减肥，我们也可以适量吃点砂糖。\n> \n\n> 平常考试开始后约 30 分钟时，人会开始无法集中注意力。假如这时“结尾努力”能发挥作用，那么就能让我们再次集中注意力。\n> \n\n> 我们并不是因为拥有优秀的脑才能区分出各种绘画风格和投球类型间的细微差别的，而是需要付出努力、接受相应训练才能做到。按照从大到小的顺序，经过有序的训练，任何人都可以辨别出细微的差别。\n> \n\n> 19 世纪的英国政治家迪斯雷利曾这样说：“拥有开阔视野的人，小的失败对他构不成威胁。”如果想让有意义的记忆尽可能长时间地保存在头脑中，大家的目光就不能只局限于眼前的考试，而要以长远的目光制订符合自身情况的长期计划，然后依照长期计划去学习。\n> \n\n> BGM 的效果因人而异。一般来说，BGM 对喜欢音乐的人能起到积极的作用，但是对音乐的狂热爱好者却会起反作用，而对于那些不关心音乐的人来说，BGM 基本不起任何作用。\n> \n\n## 第 6 章 天才的记忆机制\n\n> 我们将那些能轻易回想起来，也就是与自己过去的经验相关的记忆称为“经验记忆”；与此相对，那些缺少契机就难以回想起来的知识或信息类的记忆，我们称之为“知识记忆”。\n> \n\n> 恋爱情感是通过 A10 和前额叶皮质的联动作用产生的。一旦发生联动作用，人脑就会逐渐被恋爱对象占据，除了喜欢的人以外，其他事物都会被脑排除，就连在学校里学习的知识也不例外。\n> \n\n> “回忆”这种行为就像是住在“知识城市”里的人想去拜访朋友（想要想起来的知识），交通越发达，到达朋友家的方式就越多。也就是说，回忆会变得比较容易。\n> \n\n> 知识记忆和经验记忆的区别就在于此，这也类似于穷乡僻壤和大城市间的差异。偏远地区交通不发达，即使有路也不好走，所以很难到达目的地。这也正是知识记忆不容易被人想起来的原因之一。\n经验记忆是由很多记忆组合而成的（细致稠密的道路网）。即便是像“今天早上吃了煎蛋”这样简单的经验记忆，也是由“煎蛋的味道、气味、颜色，吃煎蛋时餐桌的摆设、坐在椅子上的感觉，一家人围着餐桌吃饭时谈话的内容”等众多难以逐一解析的元素交织而成的，“信息大城市”的关联程度更可想而知。因此，我们很容易想起经验记忆也是理所当然的。\n> \n\n> 即使是我们特别喜欢的电视游戏，一旦被编入学校的课程且每周都安排考试，恐怕大家都恨不得马上扔掉游戏机吧。其实，无论学习什么内容都一样，问题不在于数学本身，“被强制学习”才是关键所在。\n> \n\n> *你想记住哪些信息，就把哪些信息讲给自己的朋友或者家人听——这就是形成经验记忆的最简单的方法。一旦输出了自己已经记住的信息，各方面的关键词就会关联起来，记忆也能因此实现精致化 **\n> \n\n> 实际上，脑是不会感到疲劳的。如果大家在学习的时候感到疲劳了，那么恐怕不是因为脑，而是因为眼睛或肩膀等身体部位感到疲劳了。\n为什么这么说呢？人脑的机制决定了它即使不分昼夜地一直工作也不会筋疲力尽。这是理所当然的，因为人脑一旦休息了，就连我们的呼吸也会跟着停止。脑非常坚韧，即使一生不停地工作也不会感到疲惫，它原本就是被大自然这样设计出来的。因此，大家也不要有所顾虑了，让我们不断地刺激它吧。\n> \n\n> 知识记忆和经验记忆可以用“What is”来说明，相对地，方法记忆则可以说是关于“How to”的记忆。\n> \n\n> 这三兄弟的地位并不平等，它们有上下等级之分。\n如下页图所示，最下面的一层是方法记忆，中间的一层是知识记忆，最上面的一层是经验记忆，我称之为“记忆三兄弟的金字塔结构”。层级越靠下，记忆就越原始，其对于生命存续的意义也就越重要。而越靠上的层级就越是得到了高度发展并具有丰富内容的记忆。\n> \n\n> 这一结构也同样适用于动物的演化过程。在演化方面，越是古老的原始动物，它们的方法记忆（三兄弟中的老大）就越发达；相反，越是高等动物，其位于上层的记忆就越发达。毋庸置疑，人类与其他动物相比，自然是位于金字塔顶端的经验记忆的能力比较高，甚至有些研究人员认为只有人类才拥有“经验记忆”5。\n> \n\n> 比如现在的小学，老师会在孩子们 10 岁之前教他们九九乘法表，目的就在于充分调动孩子们发达的知识记忆，让他们牢记这些基础知识。这个年龄段的孩子虽然理解不了比较难的逻辑，但是在文字的排列、绘画以及音乐方面往往能够发挥出超强的记忆能力，比如小学生记忆动漫人物和游戏角色的能力就着实令人惊叹。这种能力会在迎来第二性征发育期的初高中时期衰退，而脑也会逐渐开始重视经验记忆。\n> \n\n> \"自由”这个词，只要运用于社会之中，就同时也意味着“责任”。不理解其约束的人，恐怕连歌颂自由的自由都得不到。\n> \n\n# [苦才是人生](https://book.douban.com/subject/10801462/)\n\n这本书放在书架里很久，终于有时间时间开始读。之前了解到这本书是因为是当时的畅销书，且生活上遇到了一些问题期望寻求开解，这本书也被大狗熊老师推荐过。\n抛开佛教主旨，这本书仍然是一本不错的通俗读物。我了解到梁文道老师等一些名人皈依了佛教，家里人都是虔诚的佛教徒，于是阅读这本书不会有抵触感，但是确实是第一次接触这类读物。\n\n### 追求错了，当然痛苦\n\n> “人的奇怪之处真是太多了：急于成长，然后又哀叹失去的童年；以健康换取金钱，不久后又用金钱恢复健康；活着时认为死离自己很远，临死前又仿佛从未活够；明明对未来焦虑不已，却又无视眼下的幸福。”\n> \n\n### 有一种感动叫守口如瓶\n\n> 一、“隐秘自己之功德”。自己纵然具有很多功德，也不能在别人面前夸夸其谈，炫耀自己如何了不起。倘若自己宣说自己的功德，多半是我慢的一种显现，别人不一定对你生信心，反而会有各种各样的想法。\n> \n\n> 二、“隐秘他人之过失”。我们有时看不惯别人，是因为自身修行不够。其实，别人说我们的过失，我们可能闷闷不乐，当面说了不高兴，背后说了也不高兴，两三天都不想吃饭。那么推己及人，自己又为何爱说别人的过失呢？\n> \n\n> 三、“隐秘未来之计划”。计划还没有实现之前，就四处宣扬的话，很容易遇到违缘，半途夭折。世间一切本是无常，所以，做事若没有十拿九稳的把握，最好先不要到处说。\n> \n\n### 为别人着想，是最大的利己\n\n> 人格不好的人，在任何地方都惹是生非，就算坐车去往某地，一路上也会跟好多人吵架。这样的人离开之后，大家都觉得很舒服，好像祛除了眼翳一样，得吃顿饭庆祝庆祝。\n> \n\n> 不管你是做什么的，如果始终想着自己，别人不一定看得上你，但若尽心尽力地帮助别人，大家就会对你另眼相看。所以，一个人若想自己得利益，就要先为别人着想。\n> \n\n### 对朋友要看在眼里，放在心里\n\n> 交友应寻找情义深长、稳重可靠之人。有些人今天对这个好，明天对那个好，跟谁都只有三分钟热情，这种说变就变的人，往往不可深交。\n> \n\n### 宁与君子结怨，不与小人为友\n\n> 日常生活中，我们宁与君子结怨仇，也莫与小人结亲友。因为，即使与正直的君子结下了怨仇，但他们遇到对众生有利之事，也不会因为与你有矛盾就从中作梗，反而会尽力相助。但狡猾的小人却截然相反，且不说与其结怨会遭报复，就算与之结为亲友，也无法避免他们的暗算。\n> \n\n### “愚者学问常宣扬，穷人财富喜炫耀”\n\n> 不过，愚者生来喜欢卖弄，有一点财富或学问，都要尽数抖搂出来，恨不得在家门口挂牌，广而告之“我家有银三百两”；少有功德之人，也将奖章佩戴于胸前，好让世人知晓“我是立过功的”；有些研究学问的人，有“一斤”智慧，偏自诩有“两斤半”，可到了真正要运用时，却里里外外遍寻不得。\n> \n\n### 不知道就说不知道\n\n> 这种坦言“不知道”，不但无损于他的科学家形象，反而更凸显了他严谨的治学态度，不禁令人肃然起敬。\n> \n\n### 什么都想要，会累死你\n\n> 生活的轻松快乐，要从充实内心做起，而不是盲目地攀比、追求。大千世界，万种诱惑，什么都想要，会累死你。该放就放，才会快乐一生。\n> \n\n### 感谢无常，让我们少受折磨\n\n> 当你明白名利的无常，一旦失去就不会觉得天崩地裂；当你懂得感情的无常，遇到变故也不会寻死觅活；当你懂得生命的无常，亲人去世也可以坦然面对。\n> \n\n### 八风吹不动\n\n> 如今很多人，喜欢口口声声说：“一切得失都不存在。”但实际上，他平时的所作所为，完全是为了“得”而奔波、害怕“失”而操劳，有各种各样的得失和犹豫。\n> \n\n### 说话算数\n\n> 极度欢喜的时候，不要许诺给别人东西；极度愤怒的时候，不要回复别人的书信。\n> \n\n> 先承诺再观察，是愚者的举动；先观察再承诺，才是智者的行为。如《量理宝藏论》云：“先许后察愚者举，先察后许智者轨。”\n> \n\n### 哪些“闲事”必须管\n\n> 真正的随缘，并非什么都不做，一味地等着老天安排，而是要全心全力地付出，对结果如何却不太在意。所以，随缘是一种洞彻万法的智慧，而不是一种消极逃避的心态。\n> \n\n### 生老病死不过才一个轮回\n\n> 诸人羡慕得长寿，又复恐惧成衰老，畏惧衰老望长寿，此乃愚者之邪念。”一味地渴望长寿、畏惧衰老，这是愚人的邪念。\n> \n\n## 第八章 为什么我们的日子过得那么难\n\n### 世人最大的毛病，就是没有无常观\n\n> 急急忙忙苦追求，寒寒暖暖度春秋，\n朝朝暮暮营家计，昧昧昏昏白了头。\n是是非非何日了，烦烦恼恼几时休，\n明明白白一条路，万万千千不肯修。\n> \n\n### 人80%的痛苦都与金钱息息相关\n\n> 《杂阿含经》、《善生子经》中都提到了，我们所赚的钱应该分为四份：一份用于衣食温饱；两份用于投资营利；还有一份要储蓄起来，以备不时之需。\n> \n\n### 修心是一门技术\n\n> 世间上的万事万物，无一不是心所生的虚幻假象，但芸芸众生信以为真，颠倒地将其执为实有，导致各种痛苦此起彼伏。\n> \n\n### 难得知足\n\n> 对苏东坡来说，多大的福都能享，多大的罪都能受，而且不以其苦。林语堂管他叫“不可救药的乐观主义者”，这种乐观主义正是来源于知足少欲。\n> \n\n> 内心没有太多贪欲，才能享受到生活中的美好。过于贪恋、执著金钱，一辈子都会活得很累。\n> \n\n### 钱越多，欲望应该越少\n\n> 幸福的根本，并不在于你拥有了多少金钱，而在于你减轻了多少欲望。欲望少了，虽卧地上，犹为安乐；欲望多了，虽处天堂，亦不称意。\n> \n\n### 越攀比，越吃亏\n\n> 《金刚经》也说：“应无所住而生其心。”就是在劝我们，人应该无所执著地活着。\n> \n\n### 布施，只会让你越来越富\n\n> 佛陀说“发财的因不是别的，而是布施”，这句话确实真实不虚。舍得、舍得，有舍才有得；舍不得、舍不得，不舍则不得。\n> \n\n## 附录 大欢喜——索达吉堪布开示录\n\n> 善待生命有几种方式：上等的，是用自己的一生为一切众生造福；中等的，为了自己而行善积德；下等的，不做损害其他众生的事，毕竟所有的生命都同等珍贵。\n> \n\n> “随缘”这个词，禅宗里也经常讲，世间人也经常说，但不少人都误解了它的定义，以为随缘就是什么都不用做，只等老天来安排一切，这样的话，你就会错过许多机会。真正的随缘，是需要全心全力的付出，但对结果如何却不太在意。\n> \n\n> 如今很多寺院里，天天都有人拜佛，我虽不敢说所有的人都是如此，但有些人确实带有迷信色彩。为什么呢？因为他们连自己为何要拜佛都弄不清楚。\n> \n\n> 其实，我们应该反过来想：当这个事情成功了，都是别人的贡献；失败的时候，则是自己的过失。我们藏地就有一句著名的格言：“亏损失败自己接受，胜利利益奉献他人。”这种精神非常伟大，理应成为我们为人处世的准绳。\n> \n\n> 自杀的原因若追究起来，不外乎以下几种：一、不懂聚际必散，尤其在感情上缘分尽了，今天两人在一起，明天却分手了，自己就实在接受不了；二、不懂高际必堕，原来高高在上的地位一旦失去，便丧失了活下去的意义；三、不懂生际必死，自己最亲近的人若死了，或者自己得了绝症，拿到病危通知时，完全没有勇气面对；四、不懂积际必尽，辛辛苦苦积累的财富，若是某一天突然没有了，自己就开始痛不欲生。以上这林林总总的痛苦，若能明白无常四边的道理，就会全部迎刃而解。\n> \n\n> 我们平时在处理问题时，不但会看事情的正面，对负面也考虑得比较多。这样一来，提前若有最坏的打算，将来一旦事情真正发生了，到时也有面对的勇气和能力。\n>\n\n# [成为乔布斯](https://book.douban.com/subject/26849305/)\n\n这本书自诩相较于《乔布斯传》从更多的角度描绘了乔布斯的画像，我认为从故事编排而言不如《乔布斯传》吸引人。\n对于家庭第一、热爱工作等乔布斯的这些观点作者给予了肯定，在这本书里掺杂了一些作者的个人情感。\n\n## 第三章 突破与崩塌\n\n> 盖茨对世界最大的贡献不是微软，不是MS-DOS操作系统或Windows操作系统，不是上亿人都在使用的Office办公软件，而是他的那份声明，他率先提出软件本身是有价值的。\n> \n\n> 有一小部分人因为执着的热爱而选择留下，他们愿意不惜一切代价，只是为了在史蒂夫手下工作，享受高压环境里的酣畅淋漓。项目结束后，史蒂夫将46位关键成员的签名刻在了每台麦金塔机箱的内部。\n> \n\n> “人才是公司运作的关键所在，编写软件、设计硬件的人才都是公司的宝贵财富。我们和竞争对手比的不是规模，而是创意和想法。我们每雇用一个人，都是在为公司的未来添砖加瓦。”\n> \n\n> 软件行业，一位杰出的程序员至少能顶25个普通程序员，因此我们不遗余力地要招聘世界上最优秀的程序员，在25∶1的行业里，无论优秀人才多么昂贵都是值得的。”\n> \n\n> 麦克尼利始终注视着窗外，发掘世界到底需要什么，史蒂夫却始终只看着镜子里的自己。\n> \n\n## 第五章 无心插柳\n\n> 提到皮克斯，人们首先想到的并不是我们的电脑或软件，而是你做的那些短片，那些短片就是皮克斯的身份与象征，如果皮克斯不再制作短片，把整个动画部门全都裁掉，那就等于告诉世界皮克斯已经完蛋了。所以他们永远都不会裁动画部门。\n> \n\n> 他们都成长于中产阶级家庭，相似的成长背景越来越重要，他们有了自己的孩子后，尽管财富越来越多，他们依然尽可能像普通家庭那样培养孩子。\n> \n\n## 第九章 也许他们已经疯了\n\n> “公司是人类最神奇的发明之一，公司的架构非常强大。但即便如此，我创建公司的目的只是为了产品，而不是为了钱，我想和真正有意思、有智慧、有创造力的人才共同合作打造产品。创建公司不仅仅是为了打造一个产品，公司是才华的汇聚，是能力的体现，是文化的浸染，是观点的碰撞，是大家共同合作源源不断地打造出一个又一个伟大的产品。”才华的汇聚，能力的体现，文化的浸染，观点的碰撞，史蒂夫正在打造的苹果公司将拥有以上所有特点，苹果的产品同样如此。\n> \n\n## 第十一章 做到最好\n\n> 史蒂夫在1998年曾告诉我，苹果公司存在的唯一价值就是打造产品，如今他的公司打造的不仅仅是产品，还有全方位的用户体验。从技术开发、设计到在线和实体商店，苹果公司做的每一件事都是为了给用户创造良好的体验\n> \n\n## 第十五章 整机\n\n> 记得和他聊过对公司成功与否的定义，我们都同意成功与否的判断因素不是股价。那是不是销售的电脑数量呢？也不是，如果按销量来算的话， Windows显然更成功。我们得出的结论是，成功与否主要看我们是否对自己设计、打造的产品感到自豪。我们是否感到自豪呢？\n> \n\n> 以前，技术的发展是由军队、大企业等推动的，只有这些资金雄厚的实体才买得起先进的零部件。但现在情况变了，技术的发展是由普通消费者来推动的。\n> \n\n## 第十七章 “告诉他们我就是个混蛋”\n\n> 第一，漂亮的财务数据；第二，别人无法轻易取代的与众不同之处；第三，持续发展，随着技术与市场的演变而不断演变，不会因为一位领袖的离开而停滞不前。\n>\n\n# [失去的三十年](https://book.douban.com/subject/35849016/)\n\n以邻为鉴，可知兴衰。泡沫经济以来的历史很值得中国人的关注。\n在得知了安倍前首相逝世之后才接触到的这本书，以作者的观点安倍经济学并不是万金油并没有让日本走出泥潭，目前来看日本未来的经济走向还是未知数。\n\n### 人们并没有意识到是国民背负着重担\n\n> 为了稳定日本的金融体系，纳税人付出了巨大的代价。也许有人会说：“事到如今，这样算也没用。”确实，即使计算了，也不能挽回这些负担。\n> \n\n### 逆时代潮流而回归日本的工厂\n\n> 日本经济从2002年1月开始恢复并逐渐繁荣起来。这是日本在二战后最长的一次经济繁荣，持续了73个月，一直到2008年2月。\n> \n\n> 第二章中讲过，当时世界制造业的发展趋势是采用水平分工的生产方式，而日本企业的这种做法无疑是与世界潮流背道而驰。然而，日本企业认为这种方式是防止技术外流、优质高效的生产方式。\n> \n\n### 在硅谷感受了日本的落后\n\n> 在硅谷，我还切实感受到了美国与印度的分工协作。在临近帕罗奥多的圣何塞，有一家名叫“思科”的公司，世界上第一台路由器就是由这家公司生产的，而在这家公司附近活动的几乎都是印度人。\n> \n\n### 美国房价暴涨，丰田车大卖\n\n> 像苹果公司这样采用水平分工生产方式的制造业、谷歌这类IT相关的新服务行业，或者金融等领域的企业，已经成为美国产业的中心。因此，汽车产业的衰退已经不是多么重大的问题了，不会撼动美国的政治。\n> \n\n> 假设你现在全额贷款买了一套价值10万美元的房子，如果这套房子的价格涨了一倍，同时利息下降了一半，此时你以新的价格抵押房子，获取最高限额的现金贷款，然后用这笔现金还完房贷的话，那么你手上就还会剩下10万美元的现金，而且要支付的利息还和以前一样。\n> \n\n> 丰田汽车卖得好，是因为车子本身的故障少，而且其经销商的服务也完善。但是也不仅仅是车的原因，日元贬值让日本车的价格更实惠，所以日本车的销量好。这一点也不容忽视。\n此外，如果美国没有发生房地产泡沫，丰田汽车也不可能有如此大的市场。除去美国房地产泡沫的因素，很难想象丰田能实现如此惊人的利润增长。\n> \n\n### 雷曼事件后的全球范围内的货币宽松政策和欧元危机\n\n> 确实，即使实行量化宽松政策，也不会引起物品或服务等商品价格的通货膨胀，但是很容易引发资产泡沫。也就是说，在发达国家，商品价格的通货膨胀（流动通货膨胀）已经消失，取而代之的是资产价格的通货膨胀（存量通货膨胀）。\n> \n\n### 贸易赤字逐渐扩大\n\n> 日本拥有巨额的海外资产，这些资产带来的资产收入盈余可以维持巨额的收入收支顺差，从这个角度来看，日本就没有必要过于执着于追求贸易收支的顺差。在这一点上，日本人必须要转变想法。\n> \n\n### 欧元危机导致日元升值，日本股价下跌\n\n> 制造业的海外转移势必会引起很大的问题，其中最为严重的就是国内就业机会大幅减少。但是，要想解决就业机会减少的这一问题，最关键的办法并不是阻止制造业的海外转移，而是要在国内建立起新的产业。\n> \n\n## 第八章 安倍经济学和异次元货币宽松政策带来了什么\n\n### 异次元量化宽松货币政策没能增加货币供给量\n\n> 货币供应量是指在某一个特定时间点中，货币资产的总量，而货币基数也就是所谓的基础货币。\n> \n\n> 货币政策也是一样的道理。如果整个经济环境健康，且市场上有资金需求，那么就可以通过货币政策来刺激投资等支出。但是，当经济不景气，市场上没有资金需求时，无论多么宽松的货币政策都不会刺激支出。\n> \n\n### 安倍经济学并没有让日本经济实现增长\n\n> 日元贬值，企业利润会增长；汇率稳定，或者日元升值，企业利润就会下降。\n> \n\n### 宽松货币政策的出口在哪里\n\n> 一直以来，日本的财政依靠通货紧缩和低利率压缩了利息支出，勉强维持了下来。如果利率恢复到正常的水平，仅仅是支付利息，日本财政都难以应付。\n> \n\n## 第九章 日本未来应该做的事\n\n### 日本面临的问题并不是“摆脱通货紧缩”\n\n> 物价上涨率过低并不是真正的问题，日本的产业结构和经济体制未能适应时代的变化，才是日本经济停滞的根本原因。\n> \n\n### 必须解决劳动力不足的问题\n\n> 要想解决未来劳动力供求失衡的问题，首先应该考虑的措施就是提高老年人的劳动参与率。\n> \n\n> 想提高生育期女性的劳动参与率，必须有完善的育儿支援等政策。这绝非易事。\n> \n\n> 本国劳动力如此短缺的情况下，依然拒绝移民，显然是十分不现实的。日本政府必须从根本上改变思想。\n> \n\n> 仅仅指出日本“不愿意接收移民”，并不能回答一切问题。日本还必须承认移民，允许移民融入日本社会，授予他们选举权，提供社会保障服务等。这是世界性的常识。在人才方面，日本必须打开国门。\n> \n\n> 政府就必须必须为此考虑各种各样的应对措施和制度。对于可能出现的混乱，尽早做到周密的准备，才能防患于未然。因为接收移民是改变社会结构的重要问题，政府必须进行充分的讨论和准备。\n> \n\n### 如何应对社会保障支出的增加\n\n> 要想推进以上这些措施，就需要改变日本的社会结构，因为这些问题仅仅在社会保障的框架内是无法解决的。\n此外，不是单纯依靠增加个人负担、降低养老金发放额来解决问题，政府还必须考虑提高系统的效率。\n> \n\n> 本来，执政是为了实现政策，然而在日本执政才是目标，政策只是必要的装饰。\n> \n\n### 新兴产业的出现才是解决问题的关键\n\n> 日本的制造业应该将生产部门单独分出来，委托给新兴国家的企业去做，自己专门进行产品开发、设计等核心领域。在全球水平分工的大环境中，加快推动“制造业的服务产业化”。\n> \n\n> 政府不应该干预产业结构调整的过程。政府应该做的是放宽限制，让市场发挥自身作用。\n> \n\n> 根据贝叶斯方法，在没有任何信息的情况下，对某一事件的概率判断可以用“先验概率”来表示。但是，随着事态的发展，我们会得到各种各样的信息，从而修正概率判断，此时修正后的概率被称为“后验概率”。\n>","source":"_posts/202207ReadingList.md","raw":"---\ntitle: 2022年七月读书摘录\ndate: 2022-08-10 01:04:12\ncategories: \n- 阅读\ntags: \n- 读书\n- 考试脑科学\n- 苦才是人生\n- 成为乔布斯\n- 失去的三十年\ncopyright: true\n---\n\n这个月一共阅读了四本书，分别是\n- 《考试脑科学》\n- 《苦才是人生》\n- 《成为乔布斯》\n- 《失去的三十年》\n回头看读书笔记的时候又帮自己温习了一遍内容。\n\n<!--more-->\n\n# [考试脑科学](https://book.douban.com/subject/33944838//)\n\n这本书提到了不少有意思的概念，包括如何科学用脑，脑的构成以及解释了记忆机制。\n如果你同样对这本书感兴趣，可以阅读知乎上的这一篇[文章](https://zhuanlan.zhihu.com/p/141736616)。\n\n## 第 1 章 记忆究竟是什么\n\n> 无论是从长期记忆里调取信息，还是向长期记忆里保存信息，都需要一个临时储存信息的场所，这就是短期记忆。通常来说，要想让记忆长期保存在人脑中，都要先通过短期记忆这一关。\n> \n\n> 保存长期记忆的部位叫作“大脑皮质”，它相当于人脑的“硬盘”，可以保存我们已经记住的知识。\n> \n\n> 人脑大约会消耗人体总能耗的 20%，但其质量只占不到人体体重的 2%。可见从每单位所需能耗来看，人脑是个不折不扣的耗能大户。\n> \n\n> 答案还是一样的：重新再记忆就可以了。除此之外别无他法，因为人脑的设计机制，本来就是为了能够尽快忘记大量信息。\n> \n\n## 第 2 章 “欺骗”大脑的方法\n\n> 最容易忘记的时间恰巧是刚刚记住的时候——在记住信息后的 4 小时内，我们会一口气忘记大约一半的内容。但在此之后，剩余的记忆却能维持较长时间，它们是逐渐被忘记的。\n> \n\n> 不仅是考试前，在平时的学习过程中也要尽量避免在一天内向脑输入大量新知识。说起来，学习的重点原本就应该放在“复习”上，我会在之后对复习的重要性进行说明。总之，在力所能及的范围内毫无压力地记住自己所能记住的内容，才是符合记忆性质的学习方法。\n> \n\n> 换句话说，那些我们觉得自己已经完全忘记的信息，其实都完整地保存在无意识的世界里，只不过它们属于潜在的痕迹，所以才无法被我们想起来。\n> \n\n> 潜在记忆的保存时间只有 1 个月左右，如果不在 1 个月以内复习学到的知识，潜在记忆就无法发挥作用了。所以，并不是在任何时候复习都有效果，大家最迟也要在 1 个月以内就开始复习。\n> \n\n> 结合海马体的性质，我建议大家按照如下计划展开复习。\n第 1 次复习：学习后的第 2 天\n第 2 次复习：第 1 次复习 1 周后\n第 3 次复习：第 2 次复习 2 周后\n第 4 次复习：第 3 次复习 1 个月后\n> \n\n> 对脑而言，更重要的是“输出”。也就是说，站在海马体的角度，更重要的是得出这种判断：“这个信息竟然会被如此频繁地调用，看来必须要记住它才行。”\n> \n\n## 第 3 章 海马体和 LTP\n\n> 波是“好奇心”的象征。当我们第一次见到某种事物，或者第一次踏入某个地方时，脑中就会自然而然地产生θ波。换句话说，当人对什么东西感兴趣而打开好奇心之门，处于紧张、兴奋或者期待的状态时，θ波就会出现；相反，当对千篇一律的事物感到厌烦、丧失兴趣的时候，θ波就会消失。\n> \n\n> 其实在大家身边有很多能抑制乙酰胆碱发挥作用的药物，比如几乎每个人都吃过的感冒药、止泻药或晕车药等。想必大家都有吃过感冒药后脑袋发晕、很想睡觉的经历吧？这就是人脑中的乙酰胆碱被抑制的证据。所以，如果我们明明在考试前没有感冒，却“以防万一”提前服用了感冒药，那么面临的结果可能会很悲惨。\n> \n\n> 杏仁核紧邻海马体，虽然只有人类小指的指甲那么大，却担当着十分重要的角色：产生喜悦、悲伤、焦虑等情绪。如果说海马体是记忆的工厂，那么杏仁核就是情绪的工厂。激活杏仁核也容易引发神经元的 LTP。换言之，人在情绪高涨时会更容易记忆。\n> \n\n> LTP 无法承受压力，在面对逃避不开的压力时就会减弱。换句话说，记忆力会因为压力而下降。所以从这个角度来看，临阵磨枪的复习方式是非常不合理的。\n> \n\n> 灵活应用能让神经元产生 LTP 的两个秘诀——θ波（兴趣）和杏仁核（情绪）。这样一来，我们的学习效率就会得到非常大的提升了。\n> \n\n> 当肚子饿的时候我们的胃会分泌一种名为食欲刺激激素（ghrelin）的饥饿激素。这种饥饿激素能随血液循环进入海马体，促使海马体神经元产生 LTP。相反，在吃饱后不仅饥饿激素的水平会降低，而且血液还会相对集中于胃部和肠道，这往往会导致脑的活动水平降低。\n> \n\n> 从动物实验的数据来看，虽然自己走动时θ波最容易出现，但是就算自己没有亲自走动，比如乘坐交通工具移动时θ波也会出现。也就是说，即使你只是在公交或地铁里随着车的行进而晃动也没关系，只要脑能感知到正在移动的状态，就会产生θ波。\n> \n\n> 动物在感到寒冷时会产生危机感，因为它们本能地知道，到了冬天就难以捕捉到猎物了。所以在温度略低的房间里学习可以提高效率，夏天在空调冷气较强的房间、冬天在暖气不太充足的房间里学习比较好。\n> \n\n> 当我们产生喜怒哀乐等情绪时，当时的记忆能被很容易地保留下来，这也意味着充分利用杏仁核就能帮助我们加速记忆。\n> \n\n## 第 4 章 不可思议的睡眠\n\n> 在我们睡着时，脑会以各种形式整合信息，然后检查信息的一致性并“整理”过去的记忆。海马体就是在此时对信息进行审查，判断这些信息是否必要。因此，如果不睡觉，就相当于不给海马体整理并选择信息的机会。结果也可想而知，那些因为海马体来不及整理而杂乱无章的信息最终会被全部抛弃。\n> \n\n> 当我们睡着时，浅睡眠和深睡眠会反复交替多次（一般为 4～6 次）。一旦达到了充足的睡眠时间，我们就会在浅睡眠期结束时自然地醒来。但是如果在深睡眠期被闹钟强行叫醒，那么醒来后我们的心情就会变得非常糟糕，精神也会比较恍惚，而且这种意识模糊不清的状态会持续一整天，让人非常难受。\n> \n\n> 顺便一提，不仅夜晚的睡眠具有巩固记忆的效果，午睡也同样有效。如果时间允许，大家可以试着在结束上午的学习后睡一个午觉，半小时左右即可。\n> \n\n> 边睡觉边听录音的所谓的“睡眠学习法”其实并没有什么效果，所以还是不要去打扰在我们睡觉时仍然努力工作的脑比较好。\n> \n\n> 首先，请大家闭上双眼，想象自己正头戴一顶尖尖的三角帽、手里拿着一个水煮蛋。接着，将水煮蛋轻轻抛起，用另一只手接住，然后再次抛起，用最开始抛水煮蛋的手接住。就像这样，把水煮蛋在两手间来回抛接数次后，请再尝试着用自己的惯用手将水煮蛋轻而稳地放在帽尖上。成功后，一边将注意力集中在水煮蛋上，一边缓缓睁开双眼，此时注意力应该就能集中在眼前的书桌上了。一旦我们习惯了使用这样的方法，就可以省略反复抛接的环节，直接将水煮蛋立于帽尖即可集中注意力。\n> \n\n> 如何度过周末也是一个问题。比如，有人喜欢在周末睡个大懒觉，这就相当于主动给自己制造了时差，这简直就是在虐待脑。所以说，休息日也应该和平日一样，尽量在相同的时间起床。即使醒来之后还是特别困也不要睡回笼觉，等到中午再睡个午觉就好了。\n> \n\n> 对于人脑而言，睡觉前的一到两个小时是记忆的黄金时间。我自己也有在晚上睡觉前一定要工作一会儿的习惯。\n> \n\n> - 饭前处于饥饿状态，正适合学习。\n> - 睡觉前也是学习的黄金期。\n> - 早饭或晚饭后处于饱腹状态时，不学习也不要紧。可以读课外书、看电视，或者玩游戏都可以，做一些自己感兴趣的事可以让我们的生活更加丰富多彩。\n> - 午后如果实在困得坚持不住，不妨睡个午觉，不要有什么顾虑。\n> - 如果早就决定要睡午觉，那么应该在午睡前的这段时间内抓紧学习。\n> \n\n## 第 5 章 模糊的大脑\n\n> 人类的神经元通过神经纤维形成回路，但各个神经纤维之间并没有物理性接触。与电路不同，神经回路并不是一个紧密相连的整体，纤维和纤维之间存在着微小的间隙。\n> \n\n> 对某项体育运动和某种乐器的学习也是如此，在学习新事物时一定要循序渐进。如果让一个从来没踢过足球的人从倒钩球开始学习，恐怕他需要花费很长时间才能学会。不，说不定他会在练习中受伤，球技在几个月内都没有任何进步。大家一定要准确地把握自己的学习实力，逐步克服自己的弱点。\n> \n\n> 英国历史学家卡莱尔曾经这样说道：“最重要的就是不要去看远方模糊的目标，而是要做手边最具体的事情。”\n> \n\n> “明白”是一种什么样的状态呢？“明白”换言之就是“能区分”。所以，与其有闲工夫叹息“我不明白、我真的不明白啊”，还不如对知识进行“区分”，回顾自己的学习过程，直至找到自己能理解的地方，然后再从那里重新开始学习。\n> \n\n> “干劲儿”是由人脑中的伏隔核等部位产生的。伏隔核的位置接近人脑中心，它的尺寸非常小，直径甚至不到 1 厘米，但它的性质却比较复杂。要想让伏隔核活跃起来，就必须给予其一定程度的刺激，否则伏隔核是运转不起来的。\n> \n\n> 这种现象被德国精神病学家埃米尔·克雷佩林（Emil Kraepelin）称为“行动兴奋”。一旦开始行动，状态就会渐入佳境，注意力也能集中了——这就是行动兴奋。唤醒伏隔核需要一定时间，所以不管怎么样，先坐到书桌前不间断地学习十分钟再说，这种态度是非常重要的。\n> \n\n> 顺便说一下，有人认为砂糖会使人发胖，其实未必如此。发胖的原因并不一定在于高卡路里，很多时候也许是因为脂肪的摄取量超标。即使正在减肥，我们也可以适量吃点砂糖。\n> \n\n> 平常考试开始后约 30 分钟时，人会开始无法集中注意力。假如这时“结尾努力”能发挥作用，那么就能让我们再次集中注意力。\n> \n\n> 我们并不是因为拥有优秀的脑才能区分出各种绘画风格和投球类型间的细微差别的，而是需要付出努力、接受相应训练才能做到。按照从大到小的顺序，经过有序的训练，任何人都可以辨别出细微的差别。\n> \n\n> 19 世纪的英国政治家迪斯雷利曾这样说：“拥有开阔视野的人，小的失败对他构不成威胁。”如果想让有意义的记忆尽可能长时间地保存在头脑中，大家的目光就不能只局限于眼前的考试，而要以长远的目光制订符合自身情况的长期计划，然后依照长期计划去学习。\n> \n\n> BGM 的效果因人而异。一般来说，BGM 对喜欢音乐的人能起到积极的作用，但是对音乐的狂热爱好者却会起反作用，而对于那些不关心音乐的人来说，BGM 基本不起任何作用。\n> \n\n## 第 6 章 天才的记忆机制\n\n> 我们将那些能轻易回想起来，也就是与自己过去的经验相关的记忆称为“经验记忆”；与此相对，那些缺少契机就难以回想起来的知识或信息类的记忆，我们称之为“知识记忆”。\n> \n\n> 恋爱情感是通过 A10 和前额叶皮质的联动作用产生的。一旦发生联动作用，人脑就会逐渐被恋爱对象占据，除了喜欢的人以外，其他事物都会被脑排除，就连在学校里学习的知识也不例外。\n> \n\n> “回忆”这种行为就像是住在“知识城市”里的人想去拜访朋友（想要想起来的知识），交通越发达，到达朋友家的方式就越多。也就是说，回忆会变得比较容易。\n> \n\n> 知识记忆和经验记忆的区别就在于此，这也类似于穷乡僻壤和大城市间的差异。偏远地区交通不发达，即使有路也不好走，所以很难到达目的地。这也正是知识记忆不容易被人想起来的原因之一。\n经验记忆是由很多记忆组合而成的（细致稠密的道路网）。即便是像“今天早上吃了煎蛋”这样简单的经验记忆，也是由“煎蛋的味道、气味、颜色，吃煎蛋时餐桌的摆设、坐在椅子上的感觉，一家人围着餐桌吃饭时谈话的内容”等众多难以逐一解析的元素交织而成的，“信息大城市”的关联程度更可想而知。因此，我们很容易想起经验记忆也是理所当然的。\n> \n\n> 即使是我们特别喜欢的电视游戏，一旦被编入学校的课程且每周都安排考试，恐怕大家都恨不得马上扔掉游戏机吧。其实，无论学习什么内容都一样，问题不在于数学本身，“被强制学习”才是关键所在。\n> \n\n> *你想记住哪些信息，就把哪些信息讲给自己的朋友或者家人听——这就是形成经验记忆的最简单的方法。一旦输出了自己已经记住的信息，各方面的关键词就会关联起来，记忆也能因此实现精致化 **\n> \n\n> 实际上，脑是不会感到疲劳的。如果大家在学习的时候感到疲劳了，那么恐怕不是因为脑，而是因为眼睛或肩膀等身体部位感到疲劳了。\n为什么这么说呢？人脑的机制决定了它即使不分昼夜地一直工作也不会筋疲力尽。这是理所当然的，因为人脑一旦休息了，就连我们的呼吸也会跟着停止。脑非常坚韧，即使一生不停地工作也不会感到疲惫，它原本就是被大自然这样设计出来的。因此，大家也不要有所顾虑了，让我们不断地刺激它吧。\n> \n\n> 知识记忆和经验记忆可以用“What is”来说明，相对地，方法记忆则可以说是关于“How to”的记忆。\n> \n\n> 这三兄弟的地位并不平等，它们有上下等级之分。\n如下页图所示，最下面的一层是方法记忆，中间的一层是知识记忆，最上面的一层是经验记忆，我称之为“记忆三兄弟的金字塔结构”。层级越靠下，记忆就越原始，其对于生命存续的意义也就越重要。而越靠上的层级就越是得到了高度发展并具有丰富内容的记忆。\n> \n\n> 这一结构也同样适用于动物的演化过程。在演化方面，越是古老的原始动物，它们的方法记忆（三兄弟中的老大）就越发达；相反，越是高等动物，其位于上层的记忆就越发达。毋庸置疑，人类与其他动物相比，自然是位于金字塔顶端的经验记忆的能力比较高，甚至有些研究人员认为只有人类才拥有“经验记忆”5。\n> \n\n> 比如现在的小学，老师会在孩子们 10 岁之前教他们九九乘法表，目的就在于充分调动孩子们发达的知识记忆，让他们牢记这些基础知识。这个年龄段的孩子虽然理解不了比较难的逻辑，但是在文字的排列、绘画以及音乐方面往往能够发挥出超强的记忆能力，比如小学生记忆动漫人物和游戏角色的能力就着实令人惊叹。这种能力会在迎来第二性征发育期的初高中时期衰退，而脑也会逐渐开始重视经验记忆。\n> \n\n> \"自由”这个词，只要运用于社会之中，就同时也意味着“责任”。不理解其约束的人，恐怕连歌颂自由的自由都得不到。\n> \n\n# [苦才是人生](https://book.douban.com/subject/10801462/)\n\n这本书放在书架里很久，终于有时间时间开始读。之前了解到这本书是因为是当时的畅销书，且生活上遇到了一些问题期望寻求开解，这本书也被大狗熊老师推荐过。\n抛开佛教主旨，这本书仍然是一本不错的通俗读物。我了解到梁文道老师等一些名人皈依了佛教，家里人都是虔诚的佛教徒，于是阅读这本书不会有抵触感，但是确实是第一次接触这类读物。\n\n### 追求错了，当然痛苦\n\n> “人的奇怪之处真是太多了：急于成长，然后又哀叹失去的童年；以健康换取金钱，不久后又用金钱恢复健康；活着时认为死离自己很远，临死前又仿佛从未活够；明明对未来焦虑不已，却又无视眼下的幸福。”\n> \n\n### 有一种感动叫守口如瓶\n\n> 一、“隐秘自己之功德”。自己纵然具有很多功德，也不能在别人面前夸夸其谈，炫耀自己如何了不起。倘若自己宣说自己的功德，多半是我慢的一种显现，别人不一定对你生信心，反而会有各种各样的想法。\n> \n\n> 二、“隐秘他人之过失”。我们有时看不惯别人，是因为自身修行不够。其实，别人说我们的过失，我们可能闷闷不乐，当面说了不高兴，背后说了也不高兴，两三天都不想吃饭。那么推己及人，自己又为何爱说别人的过失呢？\n> \n\n> 三、“隐秘未来之计划”。计划还没有实现之前，就四处宣扬的话，很容易遇到违缘，半途夭折。世间一切本是无常，所以，做事若没有十拿九稳的把握，最好先不要到处说。\n> \n\n### 为别人着想，是最大的利己\n\n> 人格不好的人，在任何地方都惹是生非，就算坐车去往某地，一路上也会跟好多人吵架。这样的人离开之后，大家都觉得很舒服，好像祛除了眼翳一样，得吃顿饭庆祝庆祝。\n> \n\n> 不管你是做什么的，如果始终想着自己，别人不一定看得上你，但若尽心尽力地帮助别人，大家就会对你另眼相看。所以，一个人若想自己得利益，就要先为别人着想。\n> \n\n### 对朋友要看在眼里，放在心里\n\n> 交友应寻找情义深长、稳重可靠之人。有些人今天对这个好，明天对那个好，跟谁都只有三分钟热情，这种说变就变的人，往往不可深交。\n> \n\n### 宁与君子结怨，不与小人为友\n\n> 日常生活中，我们宁与君子结怨仇，也莫与小人结亲友。因为，即使与正直的君子结下了怨仇，但他们遇到对众生有利之事，也不会因为与你有矛盾就从中作梗，反而会尽力相助。但狡猾的小人却截然相反，且不说与其结怨会遭报复，就算与之结为亲友，也无法避免他们的暗算。\n> \n\n### “愚者学问常宣扬，穷人财富喜炫耀”\n\n> 不过，愚者生来喜欢卖弄，有一点财富或学问，都要尽数抖搂出来，恨不得在家门口挂牌，广而告之“我家有银三百两”；少有功德之人，也将奖章佩戴于胸前，好让世人知晓“我是立过功的”；有些研究学问的人，有“一斤”智慧，偏自诩有“两斤半”，可到了真正要运用时，却里里外外遍寻不得。\n> \n\n### 不知道就说不知道\n\n> 这种坦言“不知道”，不但无损于他的科学家形象，反而更凸显了他严谨的治学态度，不禁令人肃然起敬。\n> \n\n### 什么都想要，会累死你\n\n> 生活的轻松快乐，要从充实内心做起，而不是盲目地攀比、追求。大千世界，万种诱惑，什么都想要，会累死你。该放就放，才会快乐一生。\n> \n\n### 感谢无常，让我们少受折磨\n\n> 当你明白名利的无常，一旦失去就不会觉得天崩地裂；当你懂得感情的无常，遇到变故也不会寻死觅活；当你懂得生命的无常，亲人去世也可以坦然面对。\n> \n\n### 八风吹不动\n\n> 如今很多人，喜欢口口声声说：“一切得失都不存在。”但实际上，他平时的所作所为，完全是为了“得”而奔波、害怕“失”而操劳，有各种各样的得失和犹豫。\n> \n\n### 说话算数\n\n> 极度欢喜的时候，不要许诺给别人东西；极度愤怒的时候，不要回复别人的书信。\n> \n\n> 先承诺再观察，是愚者的举动；先观察再承诺，才是智者的行为。如《量理宝藏论》云：“先许后察愚者举，先察后许智者轨。”\n> \n\n### 哪些“闲事”必须管\n\n> 真正的随缘，并非什么都不做，一味地等着老天安排，而是要全心全力地付出，对结果如何却不太在意。所以，随缘是一种洞彻万法的智慧，而不是一种消极逃避的心态。\n> \n\n### 生老病死不过才一个轮回\n\n> 诸人羡慕得长寿，又复恐惧成衰老，畏惧衰老望长寿，此乃愚者之邪念。”一味地渴望长寿、畏惧衰老，这是愚人的邪念。\n> \n\n## 第八章 为什么我们的日子过得那么难\n\n### 世人最大的毛病，就是没有无常观\n\n> 急急忙忙苦追求，寒寒暖暖度春秋，\n朝朝暮暮营家计，昧昧昏昏白了头。\n是是非非何日了，烦烦恼恼几时休，\n明明白白一条路，万万千千不肯修。\n> \n\n### 人80%的痛苦都与金钱息息相关\n\n> 《杂阿含经》、《善生子经》中都提到了，我们所赚的钱应该分为四份：一份用于衣食温饱；两份用于投资营利；还有一份要储蓄起来，以备不时之需。\n> \n\n### 修心是一门技术\n\n> 世间上的万事万物，无一不是心所生的虚幻假象，但芸芸众生信以为真，颠倒地将其执为实有，导致各种痛苦此起彼伏。\n> \n\n### 难得知足\n\n> 对苏东坡来说，多大的福都能享，多大的罪都能受，而且不以其苦。林语堂管他叫“不可救药的乐观主义者”，这种乐观主义正是来源于知足少欲。\n> \n\n> 内心没有太多贪欲，才能享受到生活中的美好。过于贪恋、执著金钱，一辈子都会活得很累。\n> \n\n### 钱越多，欲望应该越少\n\n> 幸福的根本，并不在于你拥有了多少金钱，而在于你减轻了多少欲望。欲望少了，虽卧地上，犹为安乐；欲望多了，虽处天堂，亦不称意。\n> \n\n### 越攀比，越吃亏\n\n> 《金刚经》也说：“应无所住而生其心。”就是在劝我们，人应该无所执著地活着。\n> \n\n### 布施，只会让你越来越富\n\n> 佛陀说“发财的因不是别的，而是布施”，这句话确实真实不虚。舍得、舍得，有舍才有得；舍不得、舍不得，不舍则不得。\n> \n\n## 附录 大欢喜——索达吉堪布开示录\n\n> 善待生命有几种方式：上等的，是用自己的一生为一切众生造福；中等的，为了自己而行善积德；下等的，不做损害其他众生的事，毕竟所有的生命都同等珍贵。\n> \n\n> “随缘”这个词，禅宗里也经常讲，世间人也经常说，但不少人都误解了它的定义，以为随缘就是什么都不用做，只等老天来安排一切，这样的话，你就会错过许多机会。真正的随缘，是需要全心全力的付出，但对结果如何却不太在意。\n> \n\n> 如今很多寺院里，天天都有人拜佛，我虽不敢说所有的人都是如此，但有些人确实带有迷信色彩。为什么呢？因为他们连自己为何要拜佛都弄不清楚。\n> \n\n> 其实，我们应该反过来想：当这个事情成功了，都是别人的贡献；失败的时候，则是自己的过失。我们藏地就有一句著名的格言：“亏损失败自己接受，胜利利益奉献他人。”这种精神非常伟大，理应成为我们为人处世的准绳。\n> \n\n> 自杀的原因若追究起来，不外乎以下几种：一、不懂聚际必散，尤其在感情上缘分尽了，今天两人在一起，明天却分手了，自己就实在接受不了；二、不懂高际必堕，原来高高在上的地位一旦失去，便丧失了活下去的意义；三、不懂生际必死，自己最亲近的人若死了，或者自己得了绝症，拿到病危通知时，完全没有勇气面对；四、不懂积际必尽，辛辛苦苦积累的财富，若是某一天突然没有了，自己就开始痛不欲生。以上这林林总总的痛苦，若能明白无常四边的道理，就会全部迎刃而解。\n> \n\n> 我们平时在处理问题时，不但会看事情的正面，对负面也考虑得比较多。这样一来，提前若有最坏的打算，将来一旦事情真正发生了，到时也有面对的勇气和能力。\n>\n\n# [成为乔布斯](https://book.douban.com/subject/26849305/)\n\n这本书自诩相较于《乔布斯传》从更多的角度描绘了乔布斯的画像，我认为从故事编排而言不如《乔布斯传》吸引人。\n对于家庭第一、热爱工作等乔布斯的这些观点作者给予了肯定，在这本书里掺杂了一些作者的个人情感。\n\n## 第三章 突破与崩塌\n\n> 盖茨对世界最大的贡献不是微软，不是MS-DOS操作系统或Windows操作系统，不是上亿人都在使用的Office办公软件，而是他的那份声明，他率先提出软件本身是有价值的。\n> \n\n> 有一小部分人因为执着的热爱而选择留下，他们愿意不惜一切代价，只是为了在史蒂夫手下工作，享受高压环境里的酣畅淋漓。项目结束后，史蒂夫将46位关键成员的签名刻在了每台麦金塔机箱的内部。\n> \n\n> “人才是公司运作的关键所在，编写软件、设计硬件的人才都是公司的宝贵财富。我们和竞争对手比的不是规模，而是创意和想法。我们每雇用一个人，都是在为公司的未来添砖加瓦。”\n> \n\n> 软件行业，一位杰出的程序员至少能顶25个普通程序员，因此我们不遗余力地要招聘世界上最优秀的程序员，在25∶1的行业里，无论优秀人才多么昂贵都是值得的。”\n> \n\n> 麦克尼利始终注视着窗外，发掘世界到底需要什么，史蒂夫却始终只看着镜子里的自己。\n> \n\n## 第五章 无心插柳\n\n> 提到皮克斯，人们首先想到的并不是我们的电脑或软件，而是你做的那些短片，那些短片就是皮克斯的身份与象征，如果皮克斯不再制作短片，把整个动画部门全都裁掉，那就等于告诉世界皮克斯已经完蛋了。所以他们永远都不会裁动画部门。\n> \n\n> 他们都成长于中产阶级家庭，相似的成长背景越来越重要，他们有了自己的孩子后，尽管财富越来越多，他们依然尽可能像普通家庭那样培养孩子。\n> \n\n## 第九章 也许他们已经疯了\n\n> “公司是人类最神奇的发明之一，公司的架构非常强大。但即便如此，我创建公司的目的只是为了产品，而不是为了钱，我想和真正有意思、有智慧、有创造力的人才共同合作打造产品。创建公司不仅仅是为了打造一个产品，公司是才华的汇聚，是能力的体现，是文化的浸染，是观点的碰撞，是大家共同合作源源不断地打造出一个又一个伟大的产品。”才华的汇聚，能力的体现，文化的浸染，观点的碰撞，史蒂夫正在打造的苹果公司将拥有以上所有特点，苹果的产品同样如此。\n> \n\n## 第十一章 做到最好\n\n> 史蒂夫在1998年曾告诉我，苹果公司存在的唯一价值就是打造产品，如今他的公司打造的不仅仅是产品，还有全方位的用户体验。从技术开发、设计到在线和实体商店，苹果公司做的每一件事都是为了给用户创造良好的体验\n> \n\n## 第十五章 整机\n\n> 记得和他聊过对公司成功与否的定义，我们都同意成功与否的判断因素不是股价。那是不是销售的电脑数量呢？也不是，如果按销量来算的话， Windows显然更成功。我们得出的结论是，成功与否主要看我们是否对自己设计、打造的产品感到自豪。我们是否感到自豪呢？\n> \n\n> 以前，技术的发展是由军队、大企业等推动的，只有这些资金雄厚的实体才买得起先进的零部件。但现在情况变了，技术的发展是由普通消费者来推动的。\n> \n\n## 第十七章 “告诉他们我就是个混蛋”\n\n> 第一，漂亮的财务数据；第二，别人无法轻易取代的与众不同之处；第三，持续发展，随着技术与市场的演变而不断演变，不会因为一位领袖的离开而停滞不前。\n>\n\n# [失去的三十年](https://book.douban.com/subject/35849016/)\n\n以邻为鉴，可知兴衰。泡沫经济以来的历史很值得中国人的关注。\n在得知了安倍前首相逝世之后才接触到的这本书，以作者的观点安倍经济学并不是万金油并没有让日本走出泥潭，目前来看日本未来的经济走向还是未知数。\n\n### 人们并没有意识到是国民背负着重担\n\n> 为了稳定日本的金融体系，纳税人付出了巨大的代价。也许有人会说：“事到如今，这样算也没用。”确实，即使计算了，也不能挽回这些负担。\n> \n\n### 逆时代潮流而回归日本的工厂\n\n> 日本经济从2002年1月开始恢复并逐渐繁荣起来。这是日本在二战后最长的一次经济繁荣，持续了73个月，一直到2008年2月。\n> \n\n> 第二章中讲过，当时世界制造业的发展趋势是采用水平分工的生产方式，而日本企业的这种做法无疑是与世界潮流背道而驰。然而，日本企业认为这种方式是防止技术外流、优质高效的生产方式。\n> \n\n### 在硅谷感受了日本的落后\n\n> 在硅谷，我还切实感受到了美国与印度的分工协作。在临近帕罗奥多的圣何塞，有一家名叫“思科”的公司，世界上第一台路由器就是由这家公司生产的，而在这家公司附近活动的几乎都是印度人。\n> \n\n### 美国房价暴涨，丰田车大卖\n\n> 像苹果公司这样采用水平分工生产方式的制造业、谷歌这类IT相关的新服务行业，或者金融等领域的企业，已经成为美国产业的中心。因此，汽车产业的衰退已经不是多么重大的问题了，不会撼动美国的政治。\n> \n\n> 假设你现在全额贷款买了一套价值10万美元的房子，如果这套房子的价格涨了一倍，同时利息下降了一半，此时你以新的价格抵押房子，获取最高限额的现金贷款，然后用这笔现金还完房贷的话，那么你手上就还会剩下10万美元的现金，而且要支付的利息还和以前一样。\n> \n\n> 丰田汽车卖得好，是因为车子本身的故障少，而且其经销商的服务也完善。但是也不仅仅是车的原因，日元贬值让日本车的价格更实惠，所以日本车的销量好。这一点也不容忽视。\n此外，如果美国没有发生房地产泡沫，丰田汽车也不可能有如此大的市场。除去美国房地产泡沫的因素，很难想象丰田能实现如此惊人的利润增长。\n> \n\n### 雷曼事件后的全球范围内的货币宽松政策和欧元危机\n\n> 确实，即使实行量化宽松政策，也不会引起物品或服务等商品价格的通货膨胀，但是很容易引发资产泡沫。也就是说，在发达国家，商品价格的通货膨胀（流动通货膨胀）已经消失，取而代之的是资产价格的通货膨胀（存量通货膨胀）。\n> \n\n### 贸易赤字逐渐扩大\n\n> 日本拥有巨额的海外资产，这些资产带来的资产收入盈余可以维持巨额的收入收支顺差，从这个角度来看，日本就没有必要过于执着于追求贸易收支的顺差。在这一点上，日本人必须要转变想法。\n> \n\n### 欧元危机导致日元升值，日本股价下跌\n\n> 制造业的海外转移势必会引起很大的问题，其中最为严重的就是国内就业机会大幅减少。但是，要想解决就业机会减少的这一问题，最关键的办法并不是阻止制造业的海外转移，而是要在国内建立起新的产业。\n> \n\n## 第八章 安倍经济学和异次元货币宽松政策带来了什么\n\n### 异次元量化宽松货币政策没能增加货币供给量\n\n> 货币供应量是指在某一个特定时间点中，货币资产的总量，而货币基数也就是所谓的基础货币。\n> \n\n> 货币政策也是一样的道理。如果整个经济环境健康，且市场上有资金需求，那么就可以通过货币政策来刺激投资等支出。但是，当经济不景气，市场上没有资金需求时，无论多么宽松的货币政策都不会刺激支出。\n> \n\n### 安倍经济学并没有让日本经济实现增长\n\n> 日元贬值，企业利润会增长；汇率稳定，或者日元升值，企业利润就会下降。\n> \n\n### 宽松货币政策的出口在哪里\n\n> 一直以来，日本的财政依靠通货紧缩和低利率压缩了利息支出，勉强维持了下来。如果利率恢复到正常的水平，仅仅是支付利息，日本财政都难以应付。\n> \n\n## 第九章 日本未来应该做的事\n\n### 日本面临的问题并不是“摆脱通货紧缩”\n\n> 物价上涨率过低并不是真正的问题，日本的产业结构和经济体制未能适应时代的变化，才是日本经济停滞的根本原因。\n> \n\n### 必须解决劳动力不足的问题\n\n> 要想解决未来劳动力供求失衡的问题，首先应该考虑的措施就是提高老年人的劳动参与率。\n> \n\n> 想提高生育期女性的劳动参与率，必须有完善的育儿支援等政策。这绝非易事。\n> \n\n> 本国劳动力如此短缺的情况下，依然拒绝移民，显然是十分不现实的。日本政府必须从根本上改变思想。\n> \n\n> 仅仅指出日本“不愿意接收移民”，并不能回答一切问题。日本还必须承认移民，允许移民融入日本社会，授予他们选举权，提供社会保障服务等。这是世界性的常识。在人才方面，日本必须打开国门。\n> \n\n> 政府就必须必须为此考虑各种各样的应对措施和制度。对于可能出现的混乱，尽早做到周密的准备，才能防患于未然。因为接收移民是改变社会结构的重要问题，政府必须进行充分的讨论和准备。\n> \n\n### 如何应对社会保障支出的增加\n\n> 要想推进以上这些措施，就需要改变日本的社会结构，因为这些问题仅仅在社会保障的框架内是无法解决的。\n此外，不是单纯依靠增加个人负担、降低养老金发放额来解决问题，政府还必须考虑提高系统的效率。\n> \n\n> 本来，执政是为了实现政策，然而在日本执政才是目标，政策只是必要的装饰。\n> \n\n### 新兴产业的出现才是解决问题的关键\n\n> 日本的制造业应该将生产部门单独分出来，委托给新兴国家的企业去做，自己专门进行产品开发、设计等核心领域。在全球水平分工的大环境中，加快推动“制造业的服务产业化”。\n> \n\n> 政府不应该干预产业结构调整的过程。政府应该做的是放宽限制，让市场发挥自身作用。\n> \n\n> 根据贝叶斯方法，在没有任何信息的情况下，对某一事件的概率判断可以用“先验概率”来表示。但是，随着事态的发展，我们会得到各种各样的信息，从而修正概率判断，此时修正后的概率被称为“后验概率”。\n>","slug":"202207ReadingList","published":1,"updated":"2022-08-09T17:05:13.530Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1o000eo76fguus7ny0","content":"<p>这个月一共阅读了四本书，分别是</p>\n<ul>\n<li>《考试脑科学》</li>\n<li>《苦才是人生》</li>\n<li>《成为乔布斯》</li>\n<li>《失去的三十年》<br>回头看读书笔记的时候又帮自己温习了一遍内容。</li>\n</ul>\n<span id=\"more\"></span>\n\n<h1 id=\"考试脑科学\"><a href=\"#考试脑科学\" class=\"headerlink\" title=\"考试脑科学\"></a><a href=\"https://book.douban.com/subject/33944838//\">考试脑科学</a></h1><p>这本书提到了不少有意思的概念，包括如何科学用脑，脑的构成以及解释了记忆机制。<br>如果你同样对这本书感兴趣，可以阅读知乎上的这一篇<a href=\"https://zhuanlan.zhihu.com/p/141736616\">文章</a>。</p>\n<h2 id=\"第-1-章-记忆究竟是什么\"><a href=\"#第-1-章-记忆究竟是什么\" class=\"headerlink\" title=\"第 1 章 记忆究竟是什么\"></a>第 1 章 记忆究竟是什么</h2><blockquote>\n<p>无论是从长期记忆里调取信息，还是向长期记忆里保存信息，都需要一个临时储存信息的场所，这就是短期记忆。通常来说，要想让记忆长期保存在人脑中，都要先通过短期记忆这一关。</p>\n</blockquote>\n<blockquote>\n<p>保存长期记忆的部位叫作“大脑皮质”，它相当于人脑的“硬盘”，可以保存我们已经记住的知识。</p>\n</blockquote>\n<blockquote>\n<p>人脑大约会消耗人体总能耗的 20%，但其质量只占不到人体体重的 2%。可见从每单位所需能耗来看，人脑是个不折不扣的耗能大户。</p>\n</blockquote>\n<blockquote>\n<p>答案还是一样的：重新再记忆就可以了。除此之外别无他法，因为人脑的设计机制，本来就是为了能够尽快忘记大量信息。</p>\n</blockquote>\n<h2 id=\"第-2-章-“欺骗”大脑的方法\"><a href=\"#第-2-章-“欺骗”大脑的方法\" class=\"headerlink\" title=\"第 2 章 “欺骗”大脑的方法\"></a>第 2 章 “欺骗”大脑的方法</h2><blockquote>\n<p>最容易忘记的时间恰巧是刚刚记住的时候——在记住信息后的 4 小时内，我们会一口气忘记大约一半的内容。但在此之后，剩余的记忆却能维持较长时间，它们是逐渐被忘记的。</p>\n</blockquote>\n<blockquote>\n<p>不仅是考试前，在平时的学习过程中也要尽量避免在一天内向脑输入大量新知识。说起来，学习的重点原本就应该放在“复习”上，我会在之后对复习的重要性进行说明。总之，在力所能及的范围内毫无压力地记住自己所能记住的内容，才是符合记忆性质的学习方法。</p>\n</blockquote>\n<blockquote>\n<p>换句话说，那些我们觉得自己已经完全忘记的信息，其实都完整地保存在无意识的世界里，只不过它们属于潜在的痕迹，所以才无法被我们想起来。</p>\n</blockquote>\n<blockquote>\n<p>潜在记忆的保存时间只有 1 个月左右，如果不在 1 个月以内复习学到的知识，潜在记忆就无法发挥作用了。所以，并不是在任何时候复习都有效果，大家最迟也要在 1 个月以内就开始复习。</p>\n</blockquote>\n<blockquote>\n<p>结合海马体的性质，我建议大家按照如下计划展开复习。<br>第 1 次复习：学习后的第 2 天<br>第 2 次复习：第 1 次复习 1 周后<br>第 3 次复习：第 2 次复习 2 周后<br>第 4 次复习：第 3 次复习 1 个月后</p>\n</blockquote>\n<blockquote>\n<p>对脑而言，更重要的是“输出”。也就是说，站在海马体的角度，更重要的是得出这种判断：“这个信息竟然会被如此频繁地调用，看来必须要记住它才行。”</p>\n</blockquote>\n<h2 id=\"第-3-章-海马体和-LTP\"><a href=\"#第-3-章-海马体和-LTP\" class=\"headerlink\" title=\"第 3 章 海马体和 LTP\"></a>第 3 章 海马体和 LTP</h2><blockquote>\n<p>波是“好奇心”的象征。当我们第一次见到某种事物，或者第一次踏入某个地方时，脑中就会自然而然地产生θ波。换句话说，当人对什么东西感兴趣而打开好奇心之门，处于紧张、兴奋或者期待的状态时，θ波就会出现；相反，当对千篇一律的事物感到厌烦、丧失兴趣的时候，θ波就会消失。</p>\n</blockquote>\n<blockquote>\n<p>其实在大家身边有很多能抑制乙酰胆碱发挥作用的药物，比如几乎每个人都吃过的感冒药、止泻药或晕车药等。想必大家都有吃过感冒药后脑袋发晕、很想睡觉的经历吧？这就是人脑中的乙酰胆碱被抑制的证据。所以，如果我们明明在考试前没有感冒，却“以防万一”提前服用了感冒药，那么面临的结果可能会很悲惨。</p>\n</blockquote>\n<blockquote>\n<p>杏仁核紧邻海马体，虽然只有人类小指的指甲那么大，却担当着十分重要的角色：产生喜悦、悲伤、焦虑等情绪。如果说海马体是记忆的工厂，那么杏仁核就是情绪的工厂。激活杏仁核也容易引发神经元的 LTP。换言之，人在情绪高涨时会更容易记忆。</p>\n</blockquote>\n<blockquote>\n<p>LTP 无法承受压力，在面对逃避不开的压力时就会减弱。换句话说，记忆力会因为压力而下降。所以从这个角度来看，临阵磨枪的复习方式是非常不合理的。</p>\n</blockquote>\n<blockquote>\n<p>灵活应用能让神经元产生 LTP 的两个秘诀——θ波（兴趣）和杏仁核（情绪）。这样一来，我们的学习效率就会得到非常大的提升了。</p>\n</blockquote>\n<blockquote>\n<p>当肚子饿的时候我们的胃会分泌一种名为食欲刺激激素（ghrelin）的饥饿激素。这种饥饿激素能随血液循环进入海马体，促使海马体神经元产生 LTP。相反，在吃饱后不仅饥饿激素的水平会降低，而且血液还会相对集中于胃部和肠道，这往往会导致脑的活动水平降低。</p>\n</blockquote>\n<blockquote>\n<p>从动物实验的数据来看，虽然自己走动时θ波最容易出现，但是就算自己没有亲自走动，比如乘坐交通工具移动时θ波也会出现。也就是说，即使你只是在公交或地铁里随着车的行进而晃动也没关系，只要脑能感知到正在移动的状态，就会产生θ波。</p>\n</blockquote>\n<blockquote>\n<p>动物在感到寒冷时会产生危机感，因为它们本能地知道，到了冬天就难以捕捉到猎物了。所以在温度略低的房间里学习可以提高效率，夏天在空调冷气较强的房间、冬天在暖气不太充足的房间里学习比较好。</p>\n</blockquote>\n<blockquote>\n<p>当我们产生喜怒哀乐等情绪时，当时的记忆能被很容易地保留下来，这也意味着充分利用杏仁核就能帮助我们加速记忆。</p>\n</blockquote>\n<h2 id=\"第-4-章-不可思议的睡眠\"><a href=\"#第-4-章-不可思议的睡眠\" class=\"headerlink\" title=\"第 4 章 不可思议的睡眠\"></a>第 4 章 不可思议的睡眠</h2><blockquote>\n<p>在我们睡着时，脑会以各种形式整合信息，然后检查信息的一致性并“整理”过去的记忆。海马体就是在此时对信息进行审查，判断这些信息是否必要。因此，如果不睡觉，就相当于不给海马体整理并选择信息的机会。结果也可想而知，那些因为海马体来不及整理而杂乱无章的信息最终会被全部抛弃。</p>\n</blockquote>\n<blockquote>\n<p>当我们睡着时，浅睡眠和深睡眠会反复交替多次（一般为 4～6 次）。一旦达到了充足的睡眠时间，我们就会在浅睡眠期结束时自然地醒来。但是如果在深睡眠期被闹钟强行叫醒，那么醒来后我们的心情就会变得非常糟糕，精神也会比较恍惚，而且这种意识模糊不清的状态会持续一整天，让人非常难受。</p>\n</blockquote>\n<blockquote>\n<p>顺便一提，不仅夜晚的睡眠具有巩固记忆的效果，午睡也同样有效。如果时间允许，大家可以试着在结束上午的学习后睡一个午觉，半小时左右即可。</p>\n</blockquote>\n<blockquote>\n<p>边睡觉边听录音的所谓的“睡眠学习法”其实并没有什么效果，所以还是不要去打扰在我们睡觉时仍然努力工作的脑比较好。</p>\n</blockquote>\n<blockquote>\n<p>首先，请大家闭上双眼，想象自己正头戴一顶尖尖的三角帽、手里拿着一个水煮蛋。接着，将水煮蛋轻轻抛起，用另一只手接住，然后再次抛起，用最开始抛水煮蛋的手接住。就像这样，把水煮蛋在两手间来回抛接数次后，请再尝试着用自己的惯用手将水煮蛋轻而稳地放在帽尖上。成功后，一边将注意力集中在水煮蛋上，一边缓缓睁开双眼，此时注意力应该就能集中在眼前的书桌上了。一旦我们习惯了使用这样的方法，就可以省略反复抛接的环节，直接将水煮蛋立于帽尖即可集中注意力。</p>\n</blockquote>\n<blockquote>\n<p>如何度过周末也是一个问题。比如，有人喜欢在周末睡个大懒觉，这就相当于主动给自己制造了时差，这简直就是在虐待脑。所以说，休息日也应该和平日一样，尽量在相同的时间起床。即使醒来之后还是特别困也不要睡回笼觉，等到中午再睡个午觉就好了。</p>\n</blockquote>\n<blockquote>\n<p>对于人脑而言，睡觉前的一到两个小时是记忆的黄金时间。我自己也有在晚上睡觉前一定要工作一会儿的习惯。</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>饭前处于饥饿状态，正适合学习。</li>\n<li>睡觉前也是学习的黄金期。</li>\n<li>早饭或晚饭后处于饱腹状态时，不学习也不要紧。可以读课外书、看电视，或者玩游戏都可以，做一些自己感兴趣的事可以让我们的生活更加丰富多彩。</li>\n<li>午后如果实在困得坚持不住，不妨睡个午觉，不要有什么顾虑。</li>\n<li>如果早就决定要睡午觉，那么应该在午睡前的这段时间内抓紧学习。</li>\n</ul>\n</blockquote>\n<h2 id=\"第-5-章-模糊的大脑\"><a href=\"#第-5-章-模糊的大脑\" class=\"headerlink\" title=\"第 5 章 模糊的大脑\"></a>第 5 章 模糊的大脑</h2><blockquote>\n<p>人类的神经元通过神经纤维形成回路，但各个神经纤维之间并没有物理性接触。与电路不同，神经回路并不是一个紧密相连的整体，纤维和纤维之间存在着微小的间隙。</p>\n</blockquote>\n<blockquote>\n<p>对某项体育运动和某种乐器的学习也是如此，在学习新事物时一定要循序渐进。如果让一个从来没踢过足球的人从倒钩球开始学习，恐怕他需要花费很长时间才能学会。不，说不定他会在练习中受伤，球技在几个月内都没有任何进步。大家一定要准确地把握自己的学习实力，逐步克服自己的弱点。</p>\n</blockquote>\n<blockquote>\n<p>英国历史学家卡莱尔曾经这样说道：“最重要的就是不要去看远方模糊的目标，而是要做手边最具体的事情。”</p>\n</blockquote>\n<blockquote>\n<p>“明白”是一种什么样的状态呢？“明白”换言之就是“能区分”。所以，与其有闲工夫叹息“我不明白、我真的不明白啊”，还不如对知识进行“区分”，回顾自己的学习过程，直至找到自己能理解的地方，然后再从那里重新开始学习。</p>\n</blockquote>\n<blockquote>\n<p>“干劲儿”是由人脑中的伏隔核等部位产生的。伏隔核的位置接近人脑中心，它的尺寸非常小，直径甚至不到 1 厘米，但它的性质却比较复杂。要想让伏隔核活跃起来，就必须给予其一定程度的刺激，否则伏隔核是运转不起来的。</p>\n</blockquote>\n<blockquote>\n<p>这种现象被德国精神病学家埃米尔·克雷佩林（Emil Kraepelin）称为“行动兴奋”。一旦开始行动，状态就会渐入佳境，注意力也能集中了——这就是行动兴奋。唤醒伏隔核需要一定时间，所以不管怎么样，先坐到书桌前不间断地学习十分钟再说，这种态度是非常重要的。</p>\n</blockquote>\n<blockquote>\n<p>顺便说一下，有人认为砂糖会使人发胖，其实未必如此。发胖的原因并不一定在于高卡路里，很多时候也许是因为脂肪的摄取量超标。即使正在减肥，我们也可以适量吃点砂糖。</p>\n</blockquote>\n<blockquote>\n<p>平常考试开始后约 30 分钟时，人会开始无法集中注意力。假如这时“结尾努力”能发挥作用，那么就能让我们再次集中注意力。</p>\n</blockquote>\n<blockquote>\n<p>我们并不是因为拥有优秀的脑才能区分出各种绘画风格和投球类型间的细微差别的，而是需要付出努力、接受相应训练才能做到。按照从大到小的顺序，经过有序的训练，任何人都可以辨别出细微的差别。</p>\n</blockquote>\n<blockquote>\n<p>19 世纪的英国政治家迪斯雷利曾这样说：“拥有开阔视野的人，小的失败对他构不成威胁。”如果想让有意义的记忆尽可能长时间地保存在头脑中，大家的目光就不能只局限于眼前的考试，而要以长远的目光制订符合自身情况的长期计划，然后依照长期计划去学习。</p>\n</blockquote>\n<blockquote>\n<p>BGM 的效果因人而异。一般来说，BGM 对喜欢音乐的人能起到积极的作用，但是对音乐的狂热爱好者却会起反作用，而对于那些不关心音乐的人来说，BGM 基本不起任何作用。</p>\n</blockquote>\n<h2 id=\"第-6-章-天才的记忆机制\"><a href=\"#第-6-章-天才的记忆机制\" class=\"headerlink\" title=\"第 6 章 天才的记忆机制\"></a>第 6 章 天才的记忆机制</h2><blockquote>\n<p>我们将那些能轻易回想起来，也就是与自己过去的经验相关的记忆称为“经验记忆”；与此相对，那些缺少契机就难以回想起来的知识或信息类的记忆，我们称之为“知识记忆”。</p>\n</blockquote>\n<blockquote>\n<p>恋爱情感是通过 A10 和前额叶皮质的联动作用产生的。一旦发生联动作用，人脑就会逐渐被恋爱对象占据，除了喜欢的人以外，其他事物都会被脑排除，就连在学校里学习的知识也不例外。</p>\n</blockquote>\n<blockquote>\n<p>“回忆”这种行为就像是住在“知识城市”里的人想去拜访朋友（想要想起来的知识），交通越发达，到达朋友家的方式就越多。也就是说，回忆会变得比较容易。</p>\n</blockquote>\n<blockquote>\n<p>知识记忆和经验记忆的区别就在于此，这也类似于穷乡僻壤和大城市间的差异。偏远地区交通不发达，即使有路也不好走，所以很难到达目的地。这也正是知识记忆不容易被人想起来的原因之一。<br>经验记忆是由很多记忆组合而成的（细致稠密的道路网）。即便是像“今天早上吃了煎蛋”这样简单的经验记忆，也是由“煎蛋的味道、气味、颜色，吃煎蛋时餐桌的摆设、坐在椅子上的感觉，一家人围着餐桌吃饭时谈话的内容”等众多难以逐一解析的元素交织而成的，“信息大城市”的关联程度更可想而知。因此，我们很容易想起经验记忆也是理所当然的。</p>\n</blockquote>\n<blockquote>\n<p>即使是我们特别喜欢的电视游戏，一旦被编入学校的课程且每周都安排考试，恐怕大家都恨不得马上扔掉游戏机吧。其实，无论学习什么内容都一样，问题不在于数学本身，“被强制学习”才是关键所在。</p>\n</blockquote>\n<blockquote>\n<p>*你想记住哪些信息，就把哪些信息讲给自己的朋友或者家人听——这就是形成经验记忆的最简单的方法。一旦输出了自己已经记住的信息，各方面的关键词就会关联起来，记忆也能因此实现精致化 **</p>\n</blockquote>\n<blockquote>\n<p>实际上，脑是不会感到疲劳的。如果大家在学习的时候感到疲劳了，那么恐怕不是因为脑，而是因为眼睛或肩膀等身体部位感到疲劳了。<br>为什么这么说呢？人脑的机制决定了它即使不分昼夜地一直工作也不会筋疲力尽。这是理所当然的，因为人脑一旦休息了，就连我们的呼吸也会跟着停止。脑非常坚韧，即使一生不停地工作也不会感到疲惫，它原本就是被大自然这样设计出来的。因此，大家也不要有所顾虑了，让我们不断地刺激它吧。</p>\n</blockquote>\n<blockquote>\n<p>知识记忆和经验记忆可以用“What is”来说明，相对地，方法记忆则可以说是关于“How to”的记忆。</p>\n</blockquote>\n<blockquote>\n<p>这三兄弟的地位并不平等，它们有上下等级之分。<br>如下页图所示，最下面的一层是方法记忆，中间的一层是知识记忆，最上面的一层是经验记忆，我称之为“记忆三兄弟的金字塔结构”。层级越靠下，记忆就越原始，其对于生命存续的意义也就越重要。而越靠上的层级就越是得到了高度发展并具有丰富内容的记忆。</p>\n</blockquote>\n<blockquote>\n<p>这一结构也同样适用于动物的演化过程。在演化方面，越是古老的原始动物，它们的方法记忆（三兄弟中的老大）就越发达；相反，越是高等动物，其位于上层的记忆就越发达。毋庸置疑，人类与其他动物相比，自然是位于金字塔顶端的经验记忆的能力比较高，甚至有些研究人员认为只有人类才拥有“经验记忆”5。</p>\n</blockquote>\n<blockquote>\n<p>比如现在的小学，老师会在孩子们 10 岁之前教他们九九乘法表，目的就在于充分调动孩子们发达的知识记忆，让他们牢记这些基础知识。这个年龄段的孩子虽然理解不了比较难的逻辑，但是在文字的排列、绘画以及音乐方面往往能够发挥出超强的记忆能力，比如小学生记忆动漫人物和游戏角色的能力就着实令人惊叹。这种能力会在迎来第二性征发育期的初高中时期衰退，而脑也会逐渐开始重视经验记忆。</p>\n</blockquote>\n<blockquote>\n<p>“自由”这个词，只要运用于社会之中，就同时也意味着“责任”。不理解其约束的人，恐怕连歌颂自由的自由都得不到。</p>\n</blockquote>\n<h1 id=\"苦才是人生\"><a href=\"#苦才是人生\" class=\"headerlink\" title=\"苦才是人生\"></a><a href=\"https://book.douban.com/subject/10801462/\">苦才是人生</a></h1><p>这本书放在书架里很久，终于有时间时间开始读。之前了解到这本书是因为是当时的畅销书，且生活上遇到了一些问题期望寻求开解，这本书也被大狗熊老师推荐过。<br>抛开佛教主旨，这本书仍然是一本不错的通俗读物。我了解到梁文道老师等一些名人皈依了佛教，家里人都是虔诚的佛教徒，于是阅读这本书不会有抵触感，但是确实是第一次接触这类读物。</p>\n<h3 id=\"追求错了，当然痛苦\"><a href=\"#追求错了，当然痛苦\" class=\"headerlink\" title=\"追求错了，当然痛苦\"></a>追求错了，当然痛苦</h3><blockquote>\n<p>“人的奇怪之处真是太多了：急于成长，然后又哀叹失去的童年；以健康换取金钱，不久后又用金钱恢复健康；活着时认为死离自己很远，临死前又仿佛从未活够；明明对未来焦虑不已，却又无视眼下的幸福。”</p>\n</blockquote>\n<h3 id=\"有一种感动叫守口如瓶\"><a href=\"#有一种感动叫守口如瓶\" class=\"headerlink\" title=\"有一种感动叫守口如瓶\"></a>有一种感动叫守口如瓶</h3><blockquote>\n<p>一、“隐秘自己之功德”。自己纵然具有很多功德，也不能在别人面前夸夸其谈，炫耀自己如何了不起。倘若自己宣说自己的功德，多半是我慢的一种显现，别人不一定对你生信心，反而会有各种各样的想法。</p>\n</blockquote>\n<blockquote>\n<p>二、“隐秘他人之过失”。我们有时看不惯别人，是因为自身修行不够。其实，别人说我们的过失，我们可能闷闷不乐，当面说了不高兴，背后说了也不高兴，两三天都不想吃饭。那么推己及人，自己又为何爱说别人的过失呢？</p>\n</blockquote>\n<blockquote>\n<p>三、“隐秘未来之计划”。计划还没有实现之前，就四处宣扬的话，很容易遇到违缘，半途夭折。世间一切本是无常，所以，做事若没有十拿九稳的把握，最好先不要到处说。</p>\n</blockquote>\n<h3 id=\"为别人着想，是最大的利己\"><a href=\"#为别人着想，是最大的利己\" class=\"headerlink\" title=\"为别人着想，是最大的利己\"></a>为别人着想，是最大的利己</h3><blockquote>\n<p>人格不好的人，在任何地方都惹是生非，就算坐车去往某地，一路上也会跟好多人吵架。这样的人离开之后，大家都觉得很舒服，好像祛除了眼翳一样，得吃顿饭庆祝庆祝。</p>\n</blockquote>\n<blockquote>\n<p>不管你是做什么的，如果始终想着自己，别人不一定看得上你，但若尽心尽力地帮助别人，大家就会对你另眼相看。所以，一个人若想自己得利益，就要先为别人着想。</p>\n</blockquote>\n<h3 id=\"对朋友要看在眼里，放在心里\"><a href=\"#对朋友要看在眼里，放在心里\" class=\"headerlink\" title=\"对朋友要看在眼里，放在心里\"></a>对朋友要看在眼里，放在心里</h3><blockquote>\n<p>交友应寻找情义深长、稳重可靠之人。有些人今天对这个好，明天对那个好，跟谁都只有三分钟热情，这种说变就变的人，往往不可深交。</p>\n</blockquote>\n<h3 id=\"宁与君子结怨，不与小人为友\"><a href=\"#宁与君子结怨，不与小人为友\" class=\"headerlink\" title=\"宁与君子结怨，不与小人为友\"></a>宁与君子结怨，不与小人为友</h3><blockquote>\n<p>日常生活中，我们宁与君子结怨仇，也莫与小人结亲友。因为，即使与正直的君子结下了怨仇，但他们遇到对众生有利之事，也不会因为与你有矛盾就从中作梗，反而会尽力相助。但狡猾的小人却截然相反，且不说与其结怨会遭报复，就算与之结为亲友，也无法避免他们的暗算。</p>\n</blockquote>\n<h3 id=\"“愚者学问常宣扬，穷人财富喜炫耀”\"><a href=\"#“愚者学问常宣扬，穷人财富喜炫耀”\" class=\"headerlink\" title=\"“愚者学问常宣扬，穷人财富喜炫耀”\"></a>“愚者学问常宣扬，穷人财富喜炫耀”</h3><blockquote>\n<p>不过，愚者生来喜欢卖弄，有一点财富或学问，都要尽数抖搂出来，恨不得在家门口挂牌，广而告之“我家有银三百两”；少有功德之人，也将奖章佩戴于胸前，好让世人知晓“我是立过功的”；有些研究学问的人，有“一斤”智慧，偏自诩有“两斤半”，可到了真正要运用时，却里里外外遍寻不得。</p>\n</blockquote>\n<h3 id=\"不知道就说不知道\"><a href=\"#不知道就说不知道\" class=\"headerlink\" title=\"不知道就说不知道\"></a>不知道就说不知道</h3><blockquote>\n<p>这种坦言“不知道”，不但无损于他的科学家形象，反而更凸显了他严谨的治学态度，不禁令人肃然起敬。</p>\n</blockquote>\n<h3 id=\"什么都想要，会累死你\"><a href=\"#什么都想要，会累死你\" class=\"headerlink\" title=\"什么都想要，会累死你\"></a>什么都想要，会累死你</h3><blockquote>\n<p>生活的轻松快乐，要从充实内心做起，而不是盲目地攀比、追求。大千世界，万种诱惑，什么都想要，会累死你。该放就放，才会快乐一生。</p>\n</blockquote>\n<h3 id=\"感谢无常，让我们少受折磨\"><a href=\"#感谢无常，让我们少受折磨\" class=\"headerlink\" title=\"感谢无常，让我们少受折磨\"></a>感谢无常，让我们少受折磨</h3><blockquote>\n<p>当你明白名利的无常，一旦失去就不会觉得天崩地裂；当你懂得感情的无常，遇到变故也不会寻死觅活；当你懂得生命的无常，亲人去世也可以坦然面对。</p>\n</blockquote>\n<h3 id=\"八风吹不动\"><a href=\"#八风吹不动\" class=\"headerlink\" title=\"八风吹不动\"></a>八风吹不动</h3><blockquote>\n<p>如今很多人，喜欢口口声声说：“一切得失都不存在。”但实际上，他平时的所作所为，完全是为了“得”而奔波、害怕“失”而操劳，有各种各样的得失和犹豫。</p>\n</blockquote>\n<h3 id=\"说话算数\"><a href=\"#说话算数\" class=\"headerlink\" title=\"说话算数\"></a>说话算数</h3><blockquote>\n<p>极度欢喜的时候，不要许诺给别人东西；极度愤怒的时候，不要回复别人的书信。</p>\n</blockquote>\n<blockquote>\n<p>先承诺再观察，是愚者的举动；先观察再承诺，才是智者的行为。如《量理宝藏论》云：“先许后察愚者举，先察后许智者轨。”</p>\n</blockquote>\n<h3 id=\"哪些“闲事”必须管\"><a href=\"#哪些“闲事”必须管\" class=\"headerlink\" title=\"哪些“闲事”必须管\"></a>哪些“闲事”必须管</h3><blockquote>\n<p>真正的随缘，并非什么都不做，一味地等着老天安排，而是要全心全力地付出，对结果如何却不太在意。所以，随缘是一种洞彻万法的智慧，而不是一种消极逃避的心态。</p>\n</blockquote>\n<h3 id=\"生老病死不过才一个轮回\"><a href=\"#生老病死不过才一个轮回\" class=\"headerlink\" title=\"生老病死不过才一个轮回\"></a>生老病死不过才一个轮回</h3><blockquote>\n<p>诸人羡慕得长寿，又复恐惧成衰老，畏惧衰老望长寿，此乃愚者之邪念。”一味地渴望长寿、畏惧衰老，这是愚人的邪念。</p>\n</blockquote>\n<h2 id=\"第八章-为什么我们的日子过得那么难\"><a href=\"#第八章-为什么我们的日子过得那么难\" class=\"headerlink\" title=\"第八章 为什么我们的日子过得那么难\"></a>第八章 为什么我们的日子过得那么难</h2><h3 id=\"世人最大的毛病，就是没有无常观\"><a href=\"#世人最大的毛病，就是没有无常观\" class=\"headerlink\" title=\"世人最大的毛病，就是没有无常观\"></a>世人最大的毛病，就是没有无常观</h3><blockquote>\n<p>急急忙忙苦追求，寒寒暖暖度春秋，<br>朝朝暮暮营家计，昧昧昏昏白了头。<br>是是非非何日了，烦烦恼恼几时休，<br>明明白白一条路，万万千千不肯修。</p>\n</blockquote>\n<h3 id=\"人80-的痛苦都与金钱息息相关\"><a href=\"#人80-的痛苦都与金钱息息相关\" class=\"headerlink\" title=\"人80%的痛苦都与金钱息息相关\"></a>人80%的痛苦都与金钱息息相关</h3><blockquote>\n<p>《杂阿含经》、《善生子经》中都提到了，我们所赚的钱应该分为四份：一份用于衣食温饱；两份用于投资营利；还有一份要储蓄起来，以备不时之需。</p>\n</blockquote>\n<h3 id=\"修心是一门技术\"><a href=\"#修心是一门技术\" class=\"headerlink\" title=\"修心是一门技术\"></a>修心是一门技术</h3><blockquote>\n<p>世间上的万事万物，无一不是心所生的虚幻假象，但芸芸众生信以为真，颠倒地将其执为实有，导致各种痛苦此起彼伏。</p>\n</blockquote>\n<h3 id=\"难得知足\"><a href=\"#难得知足\" class=\"headerlink\" title=\"难得知足\"></a>难得知足</h3><blockquote>\n<p>对苏东坡来说，多大的福都能享，多大的罪都能受，而且不以其苦。林语堂管他叫“不可救药的乐观主义者”，这种乐观主义正是来源于知足少欲。</p>\n</blockquote>\n<blockquote>\n<p>内心没有太多贪欲，才能享受到生活中的美好。过于贪恋、执著金钱，一辈子都会活得很累。</p>\n</blockquote>\n<h3 id=\"钱越多，欲望应该越少\"><a href=\"#钱越多，欲望应该越少\" class=\"headerlink\" title=\"钱越多，欲望应该越少\"></a>钱越多，欲望应该越少</h3><blockquote>\n<p>幸福的根本，并不在于你拥有了多少金钱，而在于你减轻了多少欲望。欲望少了，虽卧地上，犹为安乐；欲望多了，虽处天堂，亦不称意。</p>\n</blockquote>\n<h3 id=\"越攀比，越吃亏\"><a href=\"#越攀比，越吃亏\" class=\"headerlink\" title=\"越攀比，越吃亏\"></a>越攀比，越吃亏</h3><blockquote>\n<p>《金刚经》也说：“应无所住而生其心。”就是在劝我们，人应该无所执著地活着。</p>\n</blockquote>\n<h3 id=\"布施，只会让你越来越富\"><a href=\"#布施，只会让你越来越富\" class=\"headerlink\" title=\"布施，只会让你越来越富\"></a>布施，只会让你越来越富</h3><blockquote>\n<p>佛陀说“发财的因不是别的，而是布施”，这句话确实真实不虚。舍得、舍得，有舍才有得；舍不得、舍不得，不舍则不得。</p>\n</blockquote>\n<h2 id=\"附录-大欢喜——索达吉堪布开示录\"><a href=\"#附录-大欢喜——索达吉堪布开示录\" class=\"headerlink\" title=\"附录 大欢喜——索达吉堪布开示录\"></a>附录 大欢喜——索达吉堪布开示录</h2><blockquote>\n<p>善待生命有几种方式：上等的，是用自己的一生为一切众生造福；中等的，为了自己而行善积德；下等的，不做损害其他众生的事，毕竟所有的生命都同等珍贵。</p>\n</blockquote>\n<blockquote>\n<p>“随缘”这个词，禅宗里也经常讲，世间人也经常说，但不少人都误解了它的定义，以为随缘就是什么都不用做，只等老天来安排一切，这样的话，你就会错过许多机会。真正的随缘，是需要全心全力的付出，但对结果如何却不太在意。</p>\n</blockquote>\n<blockquote>\n<p>如今很多寺院里，天天都有人拜佛，我虽不敢说所有的人都是如此，但有些人确实带有迷信色彩。为什么呢？因为他们连自己为何要拜佛都弄不清楚。</p>\n</blockquote>\n<blockquote>\n<p>其实，我们应该反过来想：当这个事情成功了，都是别人的贡献；失败的时候，则是自己的过失。我们藏地就有一句著名的格言：“亏损失败自己接受，胜利利益奉献他人。”这种精神非常伟大，理应成为我们为人处世的准绳。</p>\n</blockquote>\n<blockquote>\n<p>自杀的原因若追究起来，不外乎以下几种：一、不懂聚际必散，尤其在感情上缘分尽了，今天两人在一起，明天却分手了，自己就实在接受不了；二、不懂高际必堕，原来高高在上的地位一旦失去，便丧失了活下去的意义；三、不懂生际必死，自己最亲近的人若死了，或者自己得了绝症，拿到病危通知时，完全没有勇气面对；四、不懂积际必尽，辛辛苦苦积累的财富，若是某一天突然没有了，自己就开始痛不欲生。以上这林林总总的痛苦，若能明白无常四边的道理，就会全部迎刃而解。</p>\n</blockquote>\n<blockquote>\n<p>我们平时在处理问题时，不但会看事情的正面，对负面也考虑得比较多。这样一来，提前若有最坏的打算，将来一旦事情真正发生了，到时也有面对的勇气和能力。</p>\n</blockquote>\n<h1 id=\"成为乔布斯\"><a href=\"#成为乔布斯\" class=\"headerlink\" title=\"成为乔布斯\"></a><a href=\"https://book.douban.com/subject/26849305/\">成为乔布斯</a></h1><p>这本书自诩相较于《乔布斯传》从更多的角度描绘了乔布斯的画像，我认为从故事编排而言不如《乔布斯传》吸引人。<br>对于家庭第一、热爱工作等乔布斯的这些观点作者给予了肯定，在这本书里掺杂了一些作者的个人情感。</p>\n<h2 id=\"第三章-突破与崩塌\"><a href=\"#第三章-突破与崩塌\" class=\"headerlink\" title=\"第三章 突破与崩塌\"></a>第三章 突破与崩塌</h2><blockquote>\n<p>盖茨对世界最大的贡献不是微软，不是MS-DOS操作系统或Windows操作系统，不是上亿人都在使用的Office办公软件，而是他的那份声明，他率先提出软件本身是有价值的。</p>\n</blockquote>\n<blockquote>\n<p>有一小部分人因为执着的热爱而选择留下，他们愿意不惜一切代价，只是为了在史蒂夫手下工作，享受高压环境里的酣畅淋漓。项目结束后，史蒂夫将46位关键成员的签名刻在了每台麦金塔机箱的内部。</p>\n</blockquote>\n<blockquote>\n<p>“人才是公司运作的关键所在，编写软件、设计硬件的人才都是公司的宝贵财富。我们和竞争对手比的不是规模，而是创意和想法。我们每雇用一个人，都是在为公司的未来添砖加瓦。”</p>\n</blockquote>\n<blockquote>\n<p>软件行业，一位杰出的程序员至少能顶25个普通程序员，因此我们不遗余力地要招聘世界上最优秀的程序员，在25∶1的行业里，无论优秀人才多么昂贵都是值得的。”</p>\n</blockquote>\n<blockquote>\n<p>麦克尼利始终注视着窗外，发掘世界到底需要什么，史蒂夫却始终只看着镜子里的自己。</p>\n</blockquote>\n<h2 id=\"第五章-无心插柳\"><a href=\"#第五章-无心插柳\" class=\"headerlink\" title=\"第五章 无心插柳\"></a>第五章 无心插柳</h2><blockquote>\n<p>提到皮克斯，人们首先想到的并不是我们的电脑或软件，而是你做的那些短片，那些短片就是皮克斯的身份与象征，如果皮克斯不再制作短片，把整个动画部门全都裁掉，那就等于告诉世界皮克斯已经完蛋了。所以他们永远都不会裁动画部门。</p>\n</blockquote>\n<blockquote>\n<p>他们都成长于中产阶级家庭，相似的成长背景越来越重要，他们有了自己的孩子后，尽管财富越来越多，他们依然尽可能像普通家庭那样培养孩子。</p>\n</blockquote>\n<h2 id=\"第九章-也许他们已经疯了\"><a href=\"#第九章-也许他们已经疯了\" class=\"headerlink\" title=\"第九章 也许他们已经疯了\"></a>第九章 也许他们已经疯了</h2><blockquote>\n<p>“公司是人类最神奇的发明之一，公司的架构非常强大。但即便如此，我创建公司的目的只是为了产品，而不是为了钱，我想和真正有意思、有智慧、有创造力的人才共同合作打造产品。创建公司不仅仅是为了打造一个产品，公司是才华的汇聚，是能力的体现，是文化的浸染，是观点的碰撞，是大家共同合作源源不断地打造出一个又一个伟大的产品。”才华的汇聚，能力的体现，文化的浸染，观点的碰撞，史蒂夫正在打造的苹果公司将拥有以上所有特点，苹果的产品同样如此。</p>\n</blockquote>\n<h2 id=\"第十一章-做到最好\"><a href=\"#第十一章-做到最好\" class=\"headerlink\" title=\"第十一章 做到最好\"></a>第十一章 做到最好</h2><blockquote>\n<p>史蒂夫在1998年曾告诉我，苹果公司存在的唯一价值就是打造产品，如今他的公司打造的不仅仅是产品，还有全方位的用户体验。从技术开发、设计到在线和实体商店，苹果公司做的每一件事都是为了给用户创造良好的体验</p>\n</blockquote>\n<h2 id=\"第十五章-整机\"><a href=\"#第十五章-整机\" class=\"headerlink\" title=\"第十五章 整机\"></a>第十五章 整机</h2><blockquote>\n<p>记得和他聊过对公司成功与否的定义，我们都同意成功与否的判断因素不是股价。那是不是销售的电脑数量呢？也不是，如果按销量来算的话， Windows显然更成功。我们得出的结论是，成功与否主要看我们是否对自己设计、打造的产品感到自豪。我们是否感到自豪呢？</p>\n</blockquote>\n<blockquote>\n<p>以前，技术的发展是由军队、大企业等推动的，只有这些资金雄厚的实体才买得起先进的零部件。但现在情况变了，技术的发展是由普通消费者来推动的。</p>\n</blockquote>\n<h2 id=\"第十七章-“告诉他们我就是个混蛋”\"><a href=\"#第十七章-“告诉他们我就是个混蛋”\" class=\"headerlink\" title=\"第十七章 “告诉他们我就是个混蛋”\"></a>第十七章 “告诉他们我就是个混蛋”</h2><blockquote>\n<p>第一，漂亮的财务数据；第二，别人无法轻易取代的与众不同之处；第三，持续发展，随着技术与市场的演变而不断演变，不会因为一位领袖的离开而停滞不前。</p>\n</blockquote>\n<h1 id=\"失去的三十年\"><a href=\"#失去的三十年\" class=\"headerlink\" title=\"失去的三十年\"></a><a href=\"https://book.douban.com/subject/35849016/\">失去的三十年</a></h1><p>以邻为鉴，可知兴衰。泡沫经济以来的历史很值得中国人的关注。<br>在得知了安倍前首相逝世之后才接触到的这本书，以作者的观点安倍经济学并不是万金油并没有让日本走出泥潭，目前来看日本未来的经济走向还是未知数。</p>\n<h3 id=\"人们并没有意识到是国民背负着重担\"><a href=\"#人们并没有意识到是国民背负着重担\" class=\"headerlink\" title=\"人们并没有意识到是国民背负着重担\"></a>人们并没有意识到是国民背负着重担</h3><blockquote>\n<p>为了稳定日本的金融体系，纳税人付出了巨大的代价。也许有人会说：“事到如今，这样算也没用。”确实，即使计算了，也不能挽回这些负担。</p>\n</blockquote>\n<h3 id=\"逆时代潮流而回归日本的工厂\"><a href=\"#逆时代潮流而回归日本的工厂\" class=\"headerlink\" title=\"逆时代潮流而回归日本的工厂\"></a>逆时代潮流而回归日本的工厂</h3><blockquote>\n<p>日本经济从2002年1月开始恢复并逐渐繁荣起来。这是日本在二战后最长的一次经济繁荣，持续了73个月，一直到2008年2月。</p>\n</blockquote>\n<blockquote>\n<p>第二章中讲过，当时世界制造业的发展趋势是采用水平分工的生产方式，而日本企业的这种做法无疑是与世界潮流背道而驰。然而，日本企业认为这种方式是防止技术外流、优质高效的生产方式。</p>\n</blockquote>\n<h3 id=\"在硅谷感受了日本的落后\"><a href=\"#在硅谷感受了日本的落后\" class=\"headerlink\" title=\"在硅谷感受了日本的落后\"></a>在硅谷感受了日本的落后</h3><blockquote>\n<p>在硅谷，我还切实感受到了美国与印度的分工协作。在临近帕罗奥多的圣何塞，有一家名叫“思科”的公司，世界上第一台路由器就是由这家公司生产的，而在这家公司附近活动的几乎都是印度人。</p>\n</blockquote>\n<h3 id=\"美国房价暴涨，丰田车大卖\"><a href=\"#美国房价暴涨，丰田车大卖\" class=\"headerlink\" title=\"美国房价暴涨，丰田车大卖\"></a>美国房价暴涨，丰田车大卖</h3><blockquote>\n<p>像苹果公司这样采用水平分工生产方式的制造业、谷歌这类IT相关的新服务行业，或者金融等领域的企业，已经成为美国产业的中心。因此，汽车产业的衰退已经不是多么重大的问题了，不会撼动美国的政治。</p>\n</blockquote>\n<blockquote>\n<p>假设你现在全额贷款买了一套价值10万美元的房子，如果这套房子的价格涨了一倍，同时利息下降了一半，此时你以新的价格抵押房子，获取最高限额的现金贷款，然后用这笔现金还完房贷的话，那么你手上就还会剩下10万美元的现金，而且要支付的利息还和以前一样。</p>\n</blockquote>\n<blockquote>\n<p>丰田汽车卖得好，是因为车子本身的故障少，而且其经销商的服务也完善。但是也不仅仅是车的原因，日元贬值让日本车的价格更实惠，所以日本车的销量好。这一点也不容忽视。<br>此外，如果美国没有发生房地产泡沫，丰田汽车也不可能有如此大的市场。除去美国房地产泡沫的因素，很难想象丰田能实现如此惊人的利润增长。</p>\n</blockquote>\n<h3 id=\"雷曼事件后的全球范围内的货币宽松政策和欧元危机\"><a href=\"#雷曼事件后的全球范围内的货币宽松政策和欧元危机\" class=\"headerlink\" title=\"雷曼事件后的全球范围内的货币宽松政策和欧元危机\"></a>雷曼事件后的全球范围内的货币宽松政策和欧元危机</h3><blockquote>\n<p>确实，即使实行量化宽松政策，也不会引起物品或服务等商品价格的通货膨胀，但是很容易引发资产泡沫。也就是说，在发达国家，商品价格的通货膨胀（流动通货膨胀）已经消失，取而代之的是资产价格的通货膨胀（存量通货膨胀）。</p>\n</blockquote>\n<h3 id=\"贸易赤字逐渐扩大\"><a href=\"#贸易赤字逐渐扩大\" class=\"headerlink\" title=\"贸易赤字逐渐扩大\"></a>贸易赤字逐渐扩大</h3><blockquote>\n<p>日本拥有巨额的海外资产，这些资产带来的资产收入盈余可以维持巨额的收入收支顺差，从这个角度来看，日本就没有必要过于执着于追求贸易收支的顺差。在这一点上，日本人必须要转变想法。</p>\n</blockquote>\n<h3 id=\"欧元危机导致日元升值，日本股价下跌\"><a href=\"#欧元危机导致日元升值，日本股价下跌\" class=\"headerlink\" title=\"欧元危机导致日元升值，日本股价下跌\"></a>欧元危机导致日元升值，日本股价下跌</h3><blockquote>\n<p>制造业的海外转移势必会引起很大的问题，其中最为严重的就是国内就业机会大幅减少。但是，要想解决就业机会减少的这一问题，最关键的办法并不是阻止制造业的海外转移，而是要在国内建立起新的产业。</p>\n</blockquote>\n<h2 id=\"第八章-安倍经济学和异次元货币宽松政策带来了什么\"><a href=\"#第八章-安倍经济学和异次元货币宽松政策带来了什么\" class=\"headerlink\" title=\"第八章 安倍经济学和异次元货币宽松政策带来了什么\"></a>第八章 安倍经济学和异次元货币宽松政策带来了什么</h2><h3 id=\"异次元量化宽松货币政策没能增加货币供给量\"><a href=\"#异次元量化宽松货币政策没能增加货币供给量\" class=\"headerlink\" title=\"异次元量化宽松货币政策没能增加货币供给量\"></a>异次元量化宽松货币政策没能增加货币供给量</h3><blockquote>\n<p>货币供应量是指在某一个特定时间点中，货币资产的总量，而货币基数也就是所谓的基础货币。</p>\n</blockquote>\n<blockquote>\n<p>货币政策也是一样的道理。如果整个经济环境健康，且市场上有资金需求，那么就可以通过货币政策来刺激投资等支出。但是，当经济不景气，市场上没有资金需求时，无论多么宽松的货币政策都不会刺激支出。</p>\n</blockquote>\n<h3 id=\"安倍经济学并没有让日本经济实现增长\"><a href=\"#安倍经济学并没有让日本经济实现增长\" class=\"headerlink\" title=\"安倍经济学并没有让日本经济实现增长\"></a>安倍经济学并没有让日本经济实现增长</h3><blockquote>\n<p>日元贬值，企业利润会增长；汇率稳定，或者日元升值，企业利润就会下降。</p>\n</blockquote>\n<h3 id=\"宽松货币政策的出口在哪里\"><a href=\"#宽松货币政策的出口在哪里\" class=\"headerlink\" title=\"宽松货币政策的出口在哪里\"></a>宽松货币政策的出口在哪里</h3><blockquote>\n<p>一直以来，日本的财政依靠通货紧缩和低利率压缩了利息支出，勉强维持了下来。如果利率恢复到正常的水平，仅仅是支付利息，日本财政都难以应付。</p>\n</blockquote>\n<h2 id=\"第九章-日本未来应该做的事\"><a href=\"#第九章-日本未来应该做的事\" class=\"headerlink\" title=\"第九章 日本未来应该做的事\"></a>第九章 日本未来应该做的事</h2><h3 id=\"日本面临的问题并不是“摆脱通货紧缩”\"><a href=\"#日本面临的问题并不是“摆脱通货紧缩”\" class=\"headerlink\" title=\"日本面临的问题并不是“摆脱通货紧缩”\"></a>日本面临的问题并不是“摆脱通货紧缩”</h3><blockquote>\n<p>物价上涨率过低并不是真正的问题，日本的产业结构和经济体制未能适应时代的变化，才是日本经济停滞的根本原因。</p>\n</blockquote>\n<h3 id=\"必须解决劳动力不足的问题\"><a href=\"#必须解决劳动力不足的问题\" class=\"headerlink\" title=\"必须解决劳动力不足的问题\"></a>必须解决劳动力不足的问题</h3><blockquote>\n<p>要想解决未来劳动力供求失衡的问题，首先应该考虑的措施就是提高老年人的劳动参与率。</p>\n</blockquote>\n<blockquote>\n<p>想提高生育期女性的劳动参与率，必须有完善的育儿支援等政策。这绝非易事。</p>\n</blockquote>\n<blockquote>\n<p>本国劳动力如此短缺的情况下，依然拒绝移民，显然是十分不现实的。日本政府必须从根本上改变思想。</p>\n</blockquote>\n<blockquote>\n<p>仅仅指出日本“不愿意接收移民”，并不能回答一切问题。日本还必须承认移民，允许移民融入日本社会，授予他们选举权，提供社会保障服务等。这是世界性的常识。在人才方面，日本必须打开国门。</p>\n</blockquote>\n<blockquote>\n<p>政府就必须必须为此考虑各种各样的应对措施和制度。对于可能出现的混乱，尽早做到周密的准备，才能防患于未然。因为接收移民是改变社会结构的重要问题，政府必须进行充分的讨论和准备。</p>\n</blockquote>\n<h3 id=\"如何应对社会保障支出的增加\"><a href=\"#如何应对社会保障支出的增加\" class=\"headerlink\" title=\"如何应对社会保障支出的增加\"></a>如何应对社会保障支出的增加</h3><blockquote>\n<p>要想推进以上这些措施，就需要改变日本的社会结构，因为这些问题仅仅在社会保障的框架内是无法解决的。<br>此外，不是单纯依靠增加个人负担、降低养老金发放额来解决问题，政府还必须考虑提高系统的效率。</p>\n</blockquote>\n<blockquote>\n<p>本来，执政是为了实现政策，然而在日本执政才是目标，政策只是必要的装饰。</p>\n</blockquote>\n<h3 id=\"新兴产业的出现才是解决问题的关键\"><a href=\"#新兴产业的出现才是解决问题的关键\" class=\"headerlink\" title=\"新兴产业的出现才是解决问题的关键\"></a>新兴产业的出现才是解决问题的关键</h3><blockquote>\n<p>日本的制造业应该将生产部门单独分出来，委托给新兴国家的企业去做，自己专门进行产品开发、设计等核心领域。在全球水平分工的大环境中，加快推动“制造业的服务产业化”。</p>\n</blockquote>\n<blockquote>\n<p>政府不应该干预产业结构调整的过程。政府应该做的是放宽限制，让市场发挥自身作用。</p>\n</blockquote>\n<blockquote>\n<p>根据贝叶斯方法，在没有任何信息的情况下，对某一事件的概率判断可以用“先验概率”来表示。但是，随着事态的发展，我们会得到各种各样的信息，从而修正概率判断，此时修正后的概率被称为“后验概率”。</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>这个月一共阅读了四本书，分别是</p>\n<ul>\n<li>《考试脑科学》</li>\n<li>《苦才是人生》</li>\n<li>《成为乔布斯》</li>\n<li>《失去的三十年》<br>回头看读书笔记的时候又帮自己温习了一遍内容。</li>\n</ul>","more":"<h1 id=\"考试脑科学\"><a href=\"#考试脑科学\" class=\"headerlink\" title=\"考试脑科学\"></a><a href=\"https://book.douban.com/subject/33944838//\">考试脑科学</a></h1><p>这本书提到了不少有意思的概念，包括如何科学用脑，脑的构成以及解释了记忆机制。<br>如果你同样对这本书感兴趣，可以阅读知乎上的这一篇<a href=\"https://zhuanlan.zhihu.com/p/141736616\">文章</a>。</p>\n<h2 id=\"第-1-章-记忆究竟是什么\"><a href=\"#第-1-章-记忆究竟是什么\" class=\"headerlink\" title=\"第 1 章 记忆究竟是什么\"></a>第 1 章 记忆究竟是什么</h2><blockquote>\n<p>无论是从长期记忆里调取信息，还是向长期记忆里保存信息，都需要一个临时储存信息的场所，这就是短期记忆。通常来说，要想让记忆长期保存在人脑中，都要先通过短期记忆这一关。</p>\n</blockquote>\n<blockquote>\n<p>保存长期记忆的部位叫作“大脑皮质”，它相当于人脑的“硬盘”，可以保存我们已经记住的知识。</p>\n</blockquote>\n<blockquote>\n<p>人脑大约会消耗人体总能耗的 20%，但其质量只占不到人体体重的 2%。可见从每单位所需能耗来看，人脑是个不折不扣的耗能大户。</p>\n</blockquote>\n<blockquote>\n<p>答案还是一样的：重新再记忆就可以了。除此之外别无他法，因为人脑的设计机制，本来就是为了能够尽快忘记大量信息。</p>\n</blockquote>\n<h2 id=\"第-2-章-“欺骗”大脑的方法\"><a href=\"#第-2-章-“欺骗”大脑的方法\" class=\"headerlink\" title=\"第 2 章 “欺骗”大脑的方法\"></a>第 2 章 “欺骗”大脑的方法</h2><blockquote>\n<p>最容易忘记的时间恰巧是刚刚记住的时候——在记住信息后的 4 小时内，我们会一口气忘记大约一半的内容。但在此之后，剩余的记忆却能维持较长时间，它们是逐渐被忘记的。</p>\n</blockquote>\n<blockquote>\n<p>不仅是考试前，在平时的学习过程中也要尽量避免在一天内向脑输入大量新知识。说起来，学习的重点原本就应该放在“复习”上，我会在之后对复习的重要性进行说明。总之，在力所能及的范围内毫无压力地记住自己所能记住的内容，才是符合记忆性质的学习方法。</p>\n</blockquote>\n<blockquote>\n<p>换句话说，那些我们觉得自己已经完全忘记的信息，其实都完整地保存在无意识的世界里，只不过它们属于潜在的痕迹，所以才无法被我们想起来。</p>\n</blockquote>\n<blockquote>\n<p>潜在记忆的保存时间只有 1 个月左右，如果不在 1 个月以内复习学到的知识，潜在记忆就无法发挥作用了。所以，并不是在任何时候复习都有效果，大家最迟也要在 1 个月以内就开始复习。</p>\n</blockquote>\n<blockquote>\n<p>结合海马体的性质，我建议大家按照如下计划展开复习。<br>第 1 次复习：学习后的第 2 天<br>第 2 次复习：第 1 次复习 1 周后<br>第 3 次复习：第 2 次复习 2 周后<br>第 4 次复习：第 3 次复习 1 个月后</p>\n</blockquote>\n<blockquote>\n<p>对脑而言，更重要的是“输出”。也就是说，站在海马体的角度，更重要的是得出这种判断：“这个信息竟然会被如此频繁地调用，看来必须要记住它才行。”</p>\n</blockquote>\n<h2 id=\"第-3-章-海马体和-LTP\"><a href=\"#第-3-章-海马体和-LTP\" class=\"headerlink\" title=\"第 3 章 海马体和 LTP\"></a>第 3 章 海马体和 LTP</h2><blockquote>\n<p>波是“好奇心”的象征。当我们第一次见到某种事物，或者第一次踏入某个地方时，脑中就会自然而然地产生θ波。换句话说，当人对什么东西感兴趣而打开好奇心之门，处于紧张、兴奋或者期待的状态时，θ波就会出现；相反，当对千篇一律的事物感到厌烦、丧失兴趣的时候，θ波就会消失。</p>\n</blockquote>\n<blockquote>\n<p>其实在大家身边有很多能抑制乙酰胆碱发挥作用的药物，比如几乎每个人都吃过的感冒药、止泻药或晕车药等。想必大家都有吃过感冒药后脑袋发晕、很想睡觉的经历吧？这就是人脑中的乙酰胆碱被抑制的证据。所以，如果我们明明在考试前没有感冒，却“以防万一”提前服用了感冒药，那么面临的结果可能会很悲惨。</p>\n</blockquote>\n<blockquote>\n<p>杏仁核紧邻海马体，虽然只有人类小指的指甲那么大，却担当着十分重要的角色：产生喜悦、悲伤、焦虑等情绪。如果说海马体是记忆的工厂，那么杏仁核就是情绪的工厂。激活杏仁核也容易引发神经元的 LTP。换言之，人在情绪高涨时会更容易记忆。</p>\n</blockquote>\n<blockquote>\n<p>LTP 无法承受压力，在面对逃避不开的压力时就会减弱。换句话说，记忆力会因为压力而下降。所以从这个角度来看，临阵磨枪的复习方式是非常不合理的。</p>\n</blockquote>\n<blockquote>\n<p>灵活应用能让神经元产生 LTP 的两个秘诀——θ波（兴趣）和杏仁核（情绪）。这样一来，我们的学习效率就会得到非常大的提升了。</p>\n</blockquote>\n<blockquote>\n<p>当肚子饿的时候我们的胃会分泌一种名为食欲刺激激素（ghrelin）的饥饿激素。这种饥饿激素能随血液循环进入海马体，促使海马体神经元产生 LTP。相反，在吃饱后不仅饥饿激素的水平会降低，而且血液还会相对集中于胃部和肠道，这往往会导致脑的活动水平降低。</p>\n</blockquote>\n<blockquote>\n<p>从动物实验的数据来看，虽然自己走动时θ波最容易出现，但是就算自己没有亲自走动，比如乘坐交通工具移动时θ波也会出现。也就是说，即使你只是在公交或地铁里随着车的行进而晃动也没关系，只要脑能感知到正在移动的状态，就会产生θ波。</p>\n</blockquote>\n<blockquote>\n<p>动物在感到寒冷时会产生危机感，因为它们本能地知道，到了冬天就难以捕捉到猎物了。所以在温度略低的房间里学习可以提高效率，夏天在空调冷气较强的房间、冬天在暖气不太充足的房间里学习比较好。</p>\n</blockquote>\n<blockquote>\n<p>当我们产生喜怒哀乐等情绪时，当时的记忆能被很容易地保留下来，这也意味着充分利用杏仁核就能帮助我们加速记忆。</p>\n</blockquote>\n<h2 id=\"第-4-章-不可思议的睡眠\"><a href=\"#第-4-章-不可思议的睡眠\" class=\"headerlink\" title=\"第 4 章 不可思议的睡眠\"></a>第 4 章 不可思议的睡眠</h2><blockquote>\n<p>在我们睡着时，脑会以各种形式整合信息，然后检查信息的一致性并“整理”过去的记忆。海马体就是在此时对信息进行审查，判断这些信息是否必要。因此，如果不睡觉，就相当于不给海马体整理并选择信息的机会。结果也可想而知，那些因为海马体来不及整理而杂乱无章的信息最终会被全部抛弃。</p>\n</blockquote>\n<blockquote>\n<p>当我们睡着时，浅睡眠和深睡眠会反复交替多次（一般为 4～6 次）。一旦达到了充足的睡眠时间，我们就会在浅睡眠期结束时自然地醒来。但是如果在深睡眠期被闹钟强行叫醒，那么醒来后我们的心情就会变得非常糟糕，精神也会比较恍惚，而且这种意识模糊不清的状态会持续一整天，让人非常难受。</p>\n</blockquote>\n<blockquote>\n<p>顺便一提，不仅夜晚的睡眠具有巩固记忆的效果，午睡也同样有效。如果时间允许，大家可以试着在结束上午的学习后睡一个午觉，半小时左右即可。</p>\n</blockquote>\n<blockquote>\n<p>边睡觉边听录音的所谓的“睡眠学习法”其实并没有什么效果，所以还是不要去打扰在我们睡觉时仍然努力工作的脑比较好。</p>\n</blockquote>\n<blockquote>\n<p>首先，请大家闭上双眼，想象自己正头戴一顶尖尖的三角帽、手里拿着一个水煮蛋。接着，将水煮蛋轻轻抛起，用另一只手接住，然后再次抛起，用最开始抛水煮蛋的手接住。就像这样，把水煮蛋在两手间来回抛接数次后，请再尝试着用自己的惯用手将水煮蛋轻而稳地放在帽尖上。成功后，一边将注意力集中在水煮蛋上，一边缓缓睁开双眼，此时注意力应该就能集中在眼前的书桌上了。一旦我们习惯了使用这样的方法，就可以省略反复抛接的环节，直接将水煮蛋立于帽尖即可集中注意力。</p>\n</blockquote>\n<blockquote>\n<p>如何度过周末也是一个问题。比如，有人喜欢在周末睡个大懒觉，这就相当于主动给自己制造了时差，这简直就是在虐待脑。所以说，休息日也应该和平日一样，尽量在相同的时间起床。即使醒来之后还是特别困也不要睡回笼觉，等到中午再睡个午觉就好了。</p>\n</blockquote>\n<blockquote>\n<p>对于人脑而言，睡觉前的一到两个小时是记忆的黄金时间。我自己也有在晚上睡觉前一定要工作一会儿的习惯。</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>饭前处于饥饿状态，正适合学习。</li>\n<li>睡觉前也是学习的黄金期。</li>\n<li>早饭或晚饭后处于饱腹状态时，不学习也不要紧。可以读课外书、看电视，或者玩游戏都可以，做一些自己感兴趣的事可以让我们的生活更加丰富多彩。</li>\n<li>午后如果实在困得坚持不住，不妨睡个午觉，不要有什么顾虑。</li>\n<li>如果早就决定要睡午觉，那么应该在午睡前的这段时间内抓紧学习。</li>\n</ul>\n</blockquote>\n<h2 id=\"第-5-章-模糊的大脑\"><a href=\"#第-5-章-模糊的大脑\" class=\"headerlink\" title=\"第 5 章 模糊的大脑\"></a>第 5 章 模糊的大脑</h2><blockquote>\n<p>人类的神经元通过神经纤维形成回路，但各个神经纤维之间并没有物理性接触。与电路不同，神经回路并不是一个紧密相连的整体，纤维和纤维之间存在着微小的间隙。</p>\n</blockquote>\n<blockquote>\n<p>对某项体育运动和某种乐器的学习也是如此，在学习新事物时一定要循序渐进。如果让一个从来没踢过足球的人从倒钩球开始学习，恐怕他需要花费很长时间才能学会。不，说不定他会在练习中受伤，球技在几个月内都没有任何进步。大家一定要准确地把握自己的学习实力，逐步克服自己的弱点。</p>\n</blockquote>\n<blockquote>\n<p>英国历史学家卡莱尔曾经这样说道：“最重要的就是不要去看远方模糊的目标，而是要做手边最具体的事情。”</p>\n</blockquote>\n<blockquote>\n<p>“明白”是一种什么样的状态呢？“明白”换言之就是“能区分”。所以，与其有闲工夫叹息“我不明白、我真的不明白啊”，还不如对知识进行“区分”，回顾自己的学习过程，直至找到自己能理解的地方，然后再从那里重新开始学习。</p>\n</blockquote>\n<blockquote>\n<p>“干劲儿”是由人脑中的伏隔核等部位产生的。伏隔核的位置接近人脑中心，它的尺寸非常小，直径甚至不到 1 厘米，但它的性质却比较复杂。要想让伏隔核活跃起来，就必须给予其一定程度的刺激，否则伏隔核是运转不起来的。</p>\n</blockquote>\n<blockquote>\n<p>这种现象被德国精神病学家埃米尔·克雷佩林（Emil Kraepelin）称为“行动兴奋”。一旦开始行动，状态就会渐入佳境，注意力也能集中了——这就是行动兴奋。唤醒伏隔核需要一定时间，所以不管怎么样，先坐到书桌前不间断地学习十分钟再说，这种态度是非常重要的。</p>\n</blockquote>\n<blockquote>\n<p>顺便说一下，有人认为砂糖会使人发胖，其实未必如此。发胖的原因并不一定在于高卡路里，很多时候也许是因为脂肪的摄取量超标。即使正在减肥，我们也可以适量吃点砂糖。</p>\n</blockquote>\n<blockquote>\n<p>平常考试开始后约 30 分钟时，人会开始无法集中注意力。假如这时“结尾努力”能发挥作用，那么就能让我们再次集中注意力。</p>\n</blockquote>\n<blockquote>\n<p>我们并不是因为拥有优秀的脑才能区分出各种绘画风格和投球类型间的细微差别的，而是需要付出努力、接受相应训练才能做到。按照从大到小的顺序，经过有序的训练，任何人都可以辨别出细微的差别。</p>\n</blockquote>\n<blockquote>\n<p>19 世纪的英国政治家迪斯雷利曾这样说：“拥有开阔视野的人，小的失败对他构不成威胁。”如果想让有意义的记忆尽可能长时间地保存在头脑中，大家的目光就不能只局限于眼前的考试，而要以长远的目光制订符合自身情况的长期计划，然后依照长期计划去学习。</p>\n</blockquote>\n<blockquote>\n<p>BGM 的效果因人而异。一般来说，BGM 对喜欢音乐的人能起到积极的作用，但是对音乐的狂热爱好者却会起反作用，而对于那些不关心音乐的人来说，BGM 基本不起任何作用。</p>\n</blockquote>\n<h2 id=\"第-6-章-天才的记忆机制\"><a href=\"#第-6-章-天才的记忆机制\" class=\"headerlink\" title=\"第 6 章 天才的记忆机制\"></a>第 6 章 天才的记忆机制</h2><blockquote>\n<p>我们将那些能轻易回想起来，也就是与自己过去的经验相关的记忆称为“经验记忆”；与此相对，那些缺少契机就难以回想起来的知识或信息类的记忆，我们称之为“知识记忆”。</p>\n</blockquote>\n<blockquote>\n<p>恋爱情感是通过 A10 和前额叶皮质的联动作用产生的。一旦发生联动作用，人脑就会逐渐被恋爱对象占据，除了喜欢的人以外，其他事物都会被脑排除，就连在学校里学习的知识也不例外。</p>\n</blockquote>\n<blockquote>\n<p>“回忆”这种行为就像是住在“知识城市”里的人想去拜访朋友（想要想起来的知识），交通越发达，到达朋友家的方式就越多。也就是说，回忆会变得比较容易。</p>\n</blockquote>\n<blockquote>\n<p>知识记忆和经验记忆的区别就在于此，这也类似于穷乡僻壤和大城市间的差异。偏远地区交通不发达，即使有路也不好走，所以很难到达目的地。这也正是知识记忆不容易被人想起来的原因之一。<br>经验记忆是由很多记忆组合而成的（细致稠密的道路网）。即便是像“今天早上吃了煎蛋”这样简单的经验记忆，也是由“煎蛋的味道、气味、颜色，吃煎蛋时餐桌的摆设、坐在椅子上的感觉，一家人围着餐桌吃饭时谈话的内容”等众多难以逐一解析的元素交织而成的，“信息大城市”的关联程度更可想而知。因此，我们很容易想起经验记忆也是理所当然的。</p>\n</blockquote>\n<blockquote>\n<p>即使是我们特别喜欢的电视游戏，一旦被编入学校的课程且每周都安排考试，恐怕大家都恨不得马上扔掉游戏机吧。其实，无论学习什么内容都一样，问题不在于数学本身，“被强制学习”才是关键所在。</p>\n</blockquote>\n<blockquote>\n<p>*你想记住哪些信息，就把哪些信息讲给自己的朋友或者家人听——这就是形成经验记忆的最简单的方法。一旦输出了自己已经记住的信息，各方面的关键词就会关联起来，记忆也能因此实现精致化 **</p>\n</blockquote>\n<blockquote>\n<p>实际上，脑是不会感到疲劳的。如果大家在学习的时候感到疲劳了，那么恐怕不是因为脑，而是因为眼睛或肩膀等身体部位感到疲劳了。<br>为什么这么说呢？人脑的机制决定了它即使不分昼夜地一直工作也不会筋疲力尽。这是理所当然的，因为人脑一旦休息了，就连我们的呼吸也会跟着停止。脑非常坚韧，即使一生不停地工作也不会感到疲惫，它原本就是被大自然这样设计出来的。因此，大家也不要有所顾虑了，让我们不断地刺激它吧。</p>\n</blockquote>\n<blockquote>\n<p>知识记忆和经验记忆可以用“What is”来说明，相对地，方法记忆则可以说是关于“How to”的记忆。</p>\n</blockquote>\n<blockquote>\n<p>这三兄弟的地位并不平等，它们有上下等级之分。<br>如下页图所示，最下面的一层是方法记忆，中间的一层是知识记忆，最上面的一层是经验记忆，我称之为“记忆三兄弟的金字塔结构”。层级越靠下，记忆就越原始，其对于生命存续的意义也就越重要。而越靠上的层级就越是得到了高度发展并具有丰富内容的记忆。</p>\n</blockquote>\n<blockquote>\n<p>这一结构也同样适用于动物的演化过程。在演化方面，越是古老的原始动物，它们的方法记忆（三兄弟中的老大）就越发达；相反，越是高等动物，其位于上层的记忆就越发达。毋庸置疑，人类与其他动物相比，自然是位于金字塔顶端的经验记忆的能力比较高，甚至有些研究人员认为只有人类才拥有“经验记忆”5。</p>\n</blockquote>\n<blockquote>\n<p>比如现在的小学，老师会在孩子们 10 岁之前教他们九九乘法表，目的就在于充分调动孩子们发达的知识记忆，让他们牢记这些基础知识。这个年龄段的孩子虽然理解不了比较难的逻辑，但是在文字的排列、绘画以及音乐方面往往能够发挥出超强的记忆能力，比如小学生记忆动漫人物和游戏角色的能力就着实令人惊叹。这种能力会在迎来第二性征发育期的初高中时期衰退，而脑也会逐渐开始重视经验记忆。</p>\n</blockquote>\n<blockquote>\n<p>“自由”这个词，只要运用于社会之中，就同时也意味着“责任”。不理解其约束的人，恐怕连歌颂自由的自由都得不到。</p>\n</blockquote>\n<h1 id=\"苦才是人生\"><a href=\"#苦才是人生\" class=\"headerlink\" title=\"苦才是人生\"></a><a href=\"https://book.douban.com/subject/10801462/\">苦才是人生</a></h1><p>这本书放在书架里很久，终于有时间时间开始读。之前了解到这本书是因为是当时的畅销书，且生活上遇到了一些问题期望寻求开解，这本书也被大狗熊老师推荐过。<br>抛开佛教主旨，这本书仍然是一本不错的通俗读物。我了解到梁文道老师等一些名人皈依了佛教，家里人都是虔诚的佛教徒，于是阅读这本书不会有抵触感，但是确实是第一次接触这类读物。</p>\n<h3 id=\"追求错了，当然痛苦\"><a href=\"#追求错了，当然痛苦\" class=\"headerlink\" title=\"追求错了，当然痛苦\"></a>追求错了，当然痛苦</h3><blockquote>\n<p>“人的奇怪之处真是太多了：急于成长，然后又哀叹失去的童年；以健康换取金钱，不久后又用金钱恢复健康；活着时认为死离自己很远，临死前又仿佛从未活够；明明对未来焦虑不已，却又无视眼下的幸福。”</p>\n</blockquote>\n<h3 id=\"有一种感动叫守口如瓶\"><a href=\"#有一种感动叫守口如瓶\" class=\"headerlink\" title=\"有一种感动叫守口如瓶\"></a>有一种感动叫守口如瓶</h3><blockquote>\n<p>一、“隐秘自己之功德”。自己纵然具有很多功德，也不能在别人面前夸夸其谈，炫耀自己如何了不起。倘若自己宣说自己的功德，多半是我慢的一种显现，别人不一定对你生信心，反而会有各种各样的想法。</p>\n</blockquote>\n<blockquote>\n<p>二、“隐秘他人之过失”。我们有时看不惯别人，是因为自身修行不够。其实，别人说我们的过失，我们可能闷闷不乐，当面说了不高兴，背后说了也不高兴，两三天都不想吃饭。那么推己及人，自己又为何爱说别人的过失呢？</p>\n</blockquote>\n<blockquote>\n<p>三、“隐秘未来之计划”。计划还没有实现之前，就四处宣扬的话，很容易遇到违缘，半途夭折。世间一切本是无常，所以，做事若没有十拿九稳的把握，最好先不要到处说。</p>\n</blockquote>\n<h3 id=\"为别人着想，是最大的利己\"><a href=\"#为别人着想，是最大的利己\" class=\"headerlink\" title=\"为别人着想，是最大的利己\"></a>为别人着想，是最大的利己</h3><blockquote>\n<p>人格不好的人，在任何地方都惹是生非，就算坐车去往某地，一路上也会跟好多人吵架。这样的人离开之后，大家都觉得很舒服，好像祛除了眼翳一样，得吃顿饭庆祝庆祝。</p>\n</blockquote>\n<blockquote>\n<p>不管你是做什么的，如果始终想着自己，别人不一定看得上你，但若尽心尽力地帮助别人，大家就会对你另眼相看。所以，一个人若想自己得利益，就要先为别人着想。</p>\n</blockquote>\n<h3 id=\"对朋友要看在眼里，放在心里\"><a href=\"#对朋友要看在眼里，放在心里\" class=\"headerlink\" title=\"对朋友要看在眼里，放在心里\"></a>对朋友要看在眼里，放在心里</h3><blockquote>\n<p>交友应寻找情义深长、稳重可靠之人。有些人今天对这个好，明天对那个好，跟谁都只有三分钟热情，这种说变就变的人，往往不可深交。</p>\n</blockquote>\n<h3 id=\"宁与君子结怨，不与小人为友\"><a href=\"#宁与君子结怨，不与小人为友\" class=\"headerlink\" title=\"宁与君子结怨，不与小人为友\"></a>宁与君子结怨，不与小人为友</h3><blockquote>\n<p>日常生活中，我们宁与君子结怨仇，也莫与小人结亲友。因为，即使与正直的君子结下了怨仇，但他们遇到对众生有利之事，也不会因为与你有矛盾就从中作梗，反而会尽力相助。但狡猾的小人却截然相反，且不说与其结怨会遭报复，就算与之结为亲友，也无法避免他们的暗算。</p>\n</blockquote>\n<h3 id=\"“愚者学问常宣扬，穷人财富喜炫耀”\"><a href=\"#“愚者学问常宣扬，穷人财富喜炫耀”\" class=\"headerlink\" title=\"“愚者学问常宣扬，穷人财富喜炫耀”\"></a>“愚者学问常宣扬，穷人财富喜炫耀”</h3><blockquote>\n<p>不过，愚者生来喜欢卖弄，有一点财富或学问，都要尽数抖搂出来，恨不得在家门口挂牌，广而告之“我家有银三百两”；少有功德之人，也将奖章佩戴于胸前，好让世人知晓“我是立过功的”；有些研究学问的人，有“一斤”智慧，偏自诩有“两斤半”，可到了真正要运用时，却里里外外遍寻不得。</p>\n</blockquote>\n<h3 id=\"不知道就说不知道\"><a href=\"#不知道就说不知道\" class=\"headerlink\" title=\"不知道就说不知道\"></a>不知道就说不知道</h3><blockquote>\n<p>这种坦言“不知道”，不但无损于他的科学家形象，反而更凸显了他严谨的治学态度，不禁令人肃然起敬。</p>\n</blockquote>\n<h3 id=\"什么都想要，会累死你\"><a href=\"#什么都想要，会累死你\" class=\"headerlink\" title=\"什么都想要，会累死你\"></a>什么都想要，会累死你</h3><blockquote>\n<p>生活的轻松快乐，要从充实内心做起，而不是盲目地攀比、追求。大千世界，万种诱惑，什么都想要，会累死你。该放就放，才会快乐一生。</p>\n</blockquote>\n<h3 id=\"感谢无常，让我们少受折磨\"><a href=\"#感谢无常，让我们少受折磨\" class=\"headerlink\" title=\"感谢无常，让我们少受折磨\"></a>感谢无常，让我们少受折磨</h3><blockquote>\n<p>当你明白名利的无常，一旦失去就不会觉得天崩地裂；当你懂得感情的无常，遇到变故也不会寻死觅活；当你懂得生命的无常，亲人去世也可以坦然面对。</p>\n</blockquote>\n<h3 id=\"八风吹不动\"><a href=\"#八风吹不动\" class=\"headerlink\" title=\"八风吹不动\"></a>八风吹不动</h3><blockquote>\n<p>如今很多人，喜欢口口声声说：“一切得失都不存在。”但实际上，他平时的所作所为，完全是为了“得”而奔波、害怕“失”而操劳，有各种各样的得失和犹豫。</p>\n</blockquote>\n<h3 id=\"说话算数\"><a href=\"#说话算数\" class=\"headerlink\" title=\"说话算数\"></a>说话算数</h3><blockquote>\n<p>极度欢喜的时候，不要许诺给别人东西；极度愤怒的时候，不要回复别人的书信。</p>\n</blockquote>\n<blockquote>\n<p>先承诺再观察，是愚者的举动；先观察再承诺，才是智者的行为。如《量理宝藏论》云：“先许后察愚者举，先察后许智者轨。”</p>\n</blockquote>\n<h3 id=\"哪些“闲事”必须管\"><a href=\"#哪些“闲事”必须管\" class=\"headerlink\" title=\"哪些“闲事”必须管\"></a>哪些“闲事”必须管</h3><blockquote>\n<p>真正的随缘，并非什么都不做，一味地等着老天安排，而是要全心全力地付出，对结果如何却不太在意。所以，随缘是一种洞彻万法的智慧，而不是一种消极逃避的心态。</p>\n</blockquote>\n<h3 id=\"生老病死不过才一个轮回\"><a href=\"#生老病死不过才一个轮回\" class=\"headerlink\" title=\"生老病死不过才一个轮回\"></a>生老病死不过才一个轮回</h3><blockquote>\n<p>诸人羡慕得长寿，又复恐惧成衰老，畏惧衰老望长寿，此乃愚者之邪念。”一味地渴望长寿、畏惧衰老，这是愚人的邪念。</p>\n</blockquote>\n<h2 id=\"第八章-为什么我们的日子过得那么难\"><a href=\"#第八章-为什么我们的日子过得那么难\" class=\"headerlink\" title=\"第八章 为什么我们的日子过得那么难\"></a>第八章 为什么我们的日子过得那么难</h2><h3 id=\"世人最大的毛病，就是没有无常观\"><a href=\"#世人最大的毛病，就是没有无常观\" class=\"headerlink\" title=\"世人最大的毛病，就是没有无常观\"></a>世人最大的毛病，就是没有无常观</h3><blockquote>\n<p>急急忙忙苦追求，寒寒暖暖度春秋，<br>朝朝暮暮营家计，昧昧昏昏白了头。<br>是是非非何日了，烦烦恼恼几时休，<br>明明白白一条路，万万千千不肯修。</p>\n</blockquote>\n<h3 id=\"人80-的痛苦都与金钱息息相关\"><a href=\"#人80-的痛苦都与金钱息息相关\" class=\"headerlink\" title=\"人80%的痛苦都与金钱息息相关\"></a>人80%的痛苦都与金钱息息相关</h3><blockquote>\n<p>《杂阿含经》、《善生子经》中都提到了，我们所赚的钱应该分为四份：一份用于衣食温饱；两份用于投资营利；还有一份要储蓄起来，以备不时之需。</p>\n</blockquote>\n<h3 id=\"修心是一门技术\"><a href=\"#修心是一门技术\" class=\"headerlink\" title=\"修心是一门技术\"></a>修心是一门技术</h3><blockquote>\n<p>世间上的万事万物，无一不是心所生的虚幻假象，但芸芸众生信以为真，颠倒地将其执为实有，导致各种痛苦此起彼伏。</p>\n</blockquote>\n<h3 id=\"难得知足\"><a href=\"#难得知足\" class=\"headerlink\" title=\"难得知足\"></a>难得知足</h3><blockquote>\n<p>对苏东坡来说，多大的福都能享，多大的罪都能受，而且不以其苦。林语堂管他叫“不可救药的乐观主义者”，这种乐观主义正是来源于知足少欲。</p>\n</blockquote>\n<blockquote>\n<p>内心没有太多贪欲，才能享受到生活中的美好。过于贪恋、执著金钱，一辈子都会活得很累。</p>\n</blockquote>\n<h3 id=\"钱越多，欲望应该越少\"><a href=\"#钱越多，欲望应该越少\" class=\"headerlink\" title=\"钱越多，欲望应该越少\"></a>钱越多，欲望应该越少</h3><blockquote>\n<p>幸福的根本，并不在于你拥有了多少金钱，而在于你减轻了多少欲望。欲望少了，虽卧地上，犹为安乐；欲望多了，虽处天堂，亦不称意。</p>\n</blockquote>\n<h3 id=\"越攀比，越吃亏\"><a href=\"#越攀比，越吃亏\" class=\"headerlink\" title=\"越攀比，越吃亏\"></a>越攀比，越吃亏</h3><blockquote>\n<p>《金刚经》也说：“应无所住而生其心。”就是在劝我们，人应该无所执著地活着。</p>\n</blockquote>\n<h3 id=\"布施，只会让你越来越富\"><a href=\"#布施，只会让你越来越富\" class=\"headerlink\" title=\"布施，只会让你越来越富\"></a>布施，只会让你越来越富</h3><blockquote>\n<p>佛陀说“发财的因不是别的，而是布施”，这句话确实真实不虚。舍得、舍得，有舍才有得；舍不得、舍不得，不舍则不得。</p>\n</blockquote>\n<h2 id=\"附录-大欢喜——索达吉堪布开示录\"><a href=\"#附录-大欢喜——索达吉堪布开示录\" class=\"headerlink\" title=\"附录 大欢喜——索达吉堪布开示录\"></a>附录 大欢喜——索达吉堪布开示录</h2><blockquote>\n<p>善待生命有几种方式：上等的，是用自己的一生为一切众生造福；中等的，为了自己而行善积德；下等的，不做损害其他众生的事，毕竟所有的生命都同等珍贵。</p>\n</blockquote>\n<blockquote>\n<p>“随缘”这个词，禅宗里也经常讲，世间人也经常说，但不少人都误解了它的定义，以为随缘就是什么都不用做，只等老天来安排一切，这样的话，你就会错过许多机会。真正的随缘，是需要全心全力的付出，但对结果如何却不太在意。</p>\n</blockquote>\n<blockquote>\n<p>如今很多寺院里，天天都有人拜佛，我虽不敢说所有的人都是如此，但有些人确实带有迷信色彩。为什么呢？因为他们连自己为何要拜佛都弄不清楚。</p>\n</blockquote>\n<blockquote>\n<p>其实，我们应该反过来想：当这个事情成功了，都是别人的贡献；失败的时候，则是自己的过失。我们藏地就有一句著名的格言：“亏损失败自己接受，胜利利益奉献他人。”这种精神非常伟大，理应成为我们为人处世的准绳。</p>\n</blockquote>\n<blockquote>\n<p>自杀的原因若追究起来，不外乎以下几种：一、不懂聚际必散，尤其在感情上缘分尽了，今天两人在一起，明天却分手了，自己就实在接受不了；二、不懂高际必堕，原来高高在上的地位一旦失去，便丧失了活下去的意义；三、不懂生际必死，自己最亲近的人若死了，或者自己得了绝症，拿到病危通知时，完全没有勇气面对；四、不懂积际必尽，辛辛苦苦积累的财富，若是某一天突然没有了，自己就开始痛不欲生。以上这林林总总的痛苦，若能明白无常四边的道理，就会全部迎刃而解。</p>\n</blockquote>\n<blockquote>\n<p>我们平时在处理问题时，不但会看事情的正面，对负面也考虑得比较多。这样一来，提前若有最坏的打算，将来一旦事情真正发生了，到时也有面对的勇气和能力。</p>\n</blockquote>\n<h1 id=\"成为乔布斯\"><a href=\"#成为乔布斯\" class=\"headerlink\" title=\"成为乔布斯\"></a><a href=\"https://book.douban.com/subject/26849305/\">成为乔布斯</a></h1><p>这本书自诩相较于《乔布斯传》从更多的角度描绘了乔布斯的画像，我认为从故事编排而言不如《乔布斯传》吸引人。<br>对于家庭第一、热爱工作等乔布斯的这些观点作者给予了肯定，在这本书里掺杂了一些作者的个人情感。</p>\n<h2 id=\"第三章-突破与崩塌\"><a href=\"#第三章-突破与崩塌\" class=\"headerlink\" title=\"第三章 突破与崩塌\"></a>第三章 突破与崩塌</h2><blockquote>\n<p>盖茨对世界最大的贡献不是微软，不是MS-DOS操作系统或Windows操作系统，不是上亿人都在使用的Office办公软件，而是他的那份声明，他率先提出软件本身是有价值的。</p>\n</blockquote>\n<blockquote>\n<p>有一小部分人因为执着的热爱而选择留下，他们愿意不惜一切代价，只是为了在史蒂夫手下工作，享受高压环境里的酣畅淋漓。项目结束后，史蒂夫将46位关键成员的签名刻在了每台麦金塔机箱的内部。</p>\n</blockquote>\n<blockquote>\n<p>“人才是公司运作的关键所在，编写软件、设计硬件的人才都是公司的宝贵财富。我们和竞争对手比的不是规模，而是创意和想法。我们每雇用一个人，都是在为公司的未来添砖加瓦。”</p>\n</blockquote>\n<blockquote>\n<p>软件行业，一位杰出的程序员至少能顶25个普通程序员，因此我们不遗余力地要招聘世界上最优秀的程序员，在25∶1的行业里，无论优秀人才多么昂贵都是值得的。”</p>\n</blockquote>\n<blockquote>\n<p>麦克尼利始终注视着窗外，发掘世界到底需要什么，史蒂夫却始终只看着镜子里的自己。</p>\n</blockquote>\n<h2 id=\"第五章-无心插柳\"><a href=\"#第五章-无心插柳\" class=\"headerlink\" title=\"第五章 无心插柳\"></a>第五章 无心插柳</h2><blockquote>\n<p>提到皮克斯，人们首先想到的并不是我们的电脑或软件，而是你做的那些短片，那些短片就是皮克斯的身份与象征，如果皮克斯不再制作短片，把整个动画部门全都裁掉，那就等于告诉世界皮克斯已经完蛋了。所以他们永远都不会裁动画部门。</p>\n</blockquote>\n<blockquote>\n<p>他们都成长于中产阶级家庭，相似的成长背景越来越重要，他们有了自己的孩子后，尽管财富越来越多，他们依然尽可能像普通家庭那样培养孩子。</p>\n</blockquote>\n<h2 id=\"第九章-也许他们已经疯了\"><a href=\"#第九章-也许他们已经疯了\" class=\"headerlink\" title=\"第九章 也许他们已经疯了\"></a>第九章 也许他们已经疯了</h2><blockquote>\n<p>“公司是人类最神奇的发明之一，公司的架构非常强大。但即便如此，我创建公司的目的只是为了产品，而不是为了钱，我想和真正有意思、有智慧、有创造力的人才共同合作打造产品。创建公司不仅仅是为了打造一个产品，公司是才华的汇聚，是能力的体现，是文化的浸染，是观点的碰撞，是大家共同合作源源不断地打造出一个又一个伟大的产品。”才华的汇聚，能力的体现，文化的浸染，观点的碰撞，史蒂夫正在打造的苹果公司将拥有以上所有特点，苹果的产品同样如此。</p>\n</blockquote>\n<h2 id=\"第十一章-做到最好\"><a href=\"#第十一章-做到最好\" class=\"headerlink\" title=\"第十一章 做到最好\"></a>第十一章 做到最好</h2><blockquote>\n<p>史蒂夫在1998年曾告诉我，苹果公司存在的唯一价值就是打造产品，如今他的公司打造的不仅仅是产品，还有全方位的用户体验。从技术开发、设计到在线和实体商店，苹果公司做的每一件事都是为了给用户创造良好的体验</p>\n</blockquote>\n<h2 id=\"第十五章-整机\"><a href=\"#第十五章-整机\" class=\"headerlink\" title=\"第十五章 整机\"></a>第十五章 整机</h2><blockquote>\n<p>记得和他聊过对公司成功与否的定义，我们都同意成功与否的判断因素不是股价。那是不是销售的电脑数量呢？也不是，如果按销量来算的话， Windows显然更成功。我们得出的结论是，成功与否主要看我们是否对自己设计、打造的产品感到自豪。我们是否感到自豪呢？</p>\n</blockquote>\n<blockquote>\n<p>以前，技术的发展是由军队、大企业等推动的，只有这些资金雄厚的实体才买得起先进的零部件。但现在情况变了，技术的发展是由普通消费者来推动的。</p>\n</blockquote>\n<h2 id=\"第十七章-“告诉他们我就是个混蛋”\"><a href=\"#第十七章-“告诉他们我就是个混蛋”\" class=\"headerlink\" title=\"第十七章 “告诉他们我就是个混蛋”\"></a>第十七章 “告诉他们我就是个混蛋”</h2><blockquote>\n<p>第一，漂亮的财务数据；第二，别人无法轻易取代的与众不同之处；第三，持续发展，随着技术与市场的演变而不断演变，不会因为一位领袖的离开而停滞不前。</p>\n</blockquote>\n<h1 id=\"失去的三十年\"><a href=\"#失去的三十年\" class=\"headerlink\" title=\"失去的三十年\"></a><a href=\"https://book.douban.com/subject/35849016/\">失去的三十年</a></h1><p>以邻为鉴，可知兴衰。泡沫经济以来的历史很值得中国人的关注。<br>在得知了安倍前首相逝世之后才接触到的这本书，以作者的观点安倍经济学并不是万金油并没有让日本走出泥潭，目前来看日本未来的经济走向还是未知数。</p>\n<h3 id=\"人们并没有意识到是国民背负着重担\"><a href=\"#人们并没有意识到是国民背负着重担\" class=\"headerlink\" title=\"人们并没有意识到是国民背负着重担\"></a>人们并没有意识到是国民背负着重担</h3><blockquote>\n<p>为了稳定日本的金融体系，纳税人付出了巨大的代价。也许有人会说：“事到如今，这样算也没用。”确实，即使计算了，也不能挽回这些负担。</p>\n</blockquote>\n<h3 id=\"逆时代潮流而回归日本的工厂\"><a href=\"#逆时代潮流而回归日本的工厂\" class=\"headerlink\" title=\"逆时代潮流而回归日本的工厂\"></a>逆时代潮流而回归日本的工厂</h3><blockquote>\n<p>日本经济从2002年1月开始恢复并逐渐繁荣起来。这是日本在二战后最长的一次经济繁荣，持续了73个月，一直到2008年2月。</p>\n</blockquote>\n<blockquote>\n<p>第二章中讲过，当时世界制造业的发展趋势是采用水平分工的生产方式，而日本企业的这种做法无疑是与世界潮流背道而驰。然而，日本企业认为这种方式是防止技术外流、优质高效的生产方式。</p>\n</blockquote>\n<h3 id=\"在硅谷感受了日本的落后\"><a href=\"#在硅谷感受了日本的落后\" class=\"headerlink\" title=\"在硅谷感受了日本的落后\"></a>在硅谷感受了日本的落后</h3><blockquote>\n<p>在硅谷，我还切实感受到了美国与印度的分工协作。在临近帕罗奥多的圣何塞，有一家名叫“思科”的公司，世界上第一台路由器就是由这家公司生产的，而在这家公司附近活动的几乎都是印度人。</p>\n</blockquote>\n<h3 id=\"美国房价暴涨，丰田车大卖\"><a href=\"#美国房价暴涨，丰田车大卖\" class=\"headerlink\" title=\"美国房价暴涨，丰田车大卖\"></a>美国房价暴涨，丰田车大卖</h3><blockquote>\n<p>像苹果公司这样采用水平分工生产方式的制造业、谷歌这类IT相关的新服务行业，或者金融等领域的企业，已经成为美国产业的中心。因此，汽车产业的衰退已经不是多么重大的问题了，不会撼动美国的政治。</p>\n</blockquote>\n<blockquote>\n<p>假设你现在全额贷款买了一套价值10万美元的房子，如果这套房子的价格涨了一倍，同时利息下降了一半，此时你以新的价格抵押房子，获取最高限额的现金贷款，然后用这笔现金还完房贷的话，那么你手上就还会剩下10万美元的现金，而且要支付的利息还和以前一样。</p>\n</blockquote>\n<blockquote>\n<p>丰田汽车卖得好，是因为车子本身的故障少，而且其经销商的服务也完善。但是也不仅仅是车的原因，日元贬值让日本车的价格更实惠，所以日本车的销量好。这一点也不容忽视。<br>此外，如果美国没有发生房地产泡沫，丰田汽车也不可能有如此大的市场。除去美国房地产泡沫的因素，很难想象丰田能实现如此惊人的利润增长。</p>\n</blockquote>\n<h3 id=\"雷曼事件后的全球范围内的货币宽松政策和欧元危机\"><a href=\"#雷曼事件后的全球范围内的货币宽松政策和欧元危机\" class=\"headerlink\" title=\"雷曼事件后的全球范围内的货币宽松政策和欧元危机\"></a>雷曼事件后的全球范围内的货币宽松政策和欧元危机</h3><blockquote>\n<p>确实，即使实行量化宽松政策，也不会引起物品或服务等商品价格的通货膨胀，但是很容易引发资产泡沫。也就是说，在发达国家，商品价格的通货膨胀（流动通货膨胀）已经消失，取而代之的是资产价格的通货膨胀（存量通货膨胀）。</p>\n</blockquote>\n<h3 id=\"贸易赤字逐渐扩大\"><a href=\"#贸易赤字逐渐扩大\" class=\"headerlink\" title=\"贸易赤字逐渐扩大\"></a>贸易赤字逐渐扩大</h3><blockquote>\n<p>日本拥有巨额的海外资产，这些资产带来的资产收入盈余可以维持巨额的收入收支顺差，从这个角度来看，日本就没有必要过于执着于追求贸易收支的顺差。在这一点上，日本人必须要转变想法。</p>\n</blockquote>\n<h3 id=\"欧元危机导致日元升值，日本股价下跌\"><a href=\"#欧元危机导致日元升值，日本股价下跌\" class=\"headerlink\" title=\"欧元危机导致日元升值，日本股价下跌\"></a>欧元危机导致日元升值，日本股价下跌</h3><blockquote>\n<p>制造业的海外转移势必会引起很大的问题，其中最为严重的就是国内就业机会大幅减少。但是，要想解决就业机会减少的这一问题，最关键的办法并不是阻止制造业的海外转移，而是要在国内建立起新的产业。</p>\n</blockquote>\n<h2 id=\"第八章-安倍经济学和异次元货币宽松政策带来了什么\"><a href=\"#第八章-安倍经济学和异次元货币宽松政策带来了什么\" class=\"headerlink\" title=\"第八章 安倍经济学和异次元货币宽松政策带来了什么\"></a>第八章 安倍经济学和异次元货币宽松政策带来了什么</h2><h3 id=\"异次元量化宽松货币政策没能增加货币供给量\"><a href=\"#异次元量化宽松货币政策没能增加货币供给量\" class=\"headerlink\" title=\"异次元量化宽松货币政策没能增加货币供给量\"></a>异次元量化宽松货币政策没能增加货币供给量</h3><blockquote>\n<p>货币供应量是指在某一个特定时间点中，货币资产的总量，而货币基数也就是所谓的基础货币。</p>\n</blockquote>\n<blockquote>\n<p>货币政策也是一样的道理。如果整个经济环境健康，且市场上有资金需求，那么就可以通过货币政策来刺激投资等支出。但是，当经济不景气，市场上没有资金需求时，无论多么宽松的货币政策都不会刺激支出。</p>\n</blockquote>\n<h3 id=\"安倍经济学并没有让日本经济实现增长\"><a href=\"#安倍经济学并没有让日本经济实现增长\" class=\"headerlink\" title=\"安倍经济学并没有让日本经济实现增长\"></a>安倍经济学并没有让日本经济实现增长</h3><blockquote>\n<p>日元贬值，企业利润会增长；汇率稳定，或者日元升值，企业利润就会下降。</p>\n</blockquote>\n<h3 id=\"宽松货币政策的出口在哪里\"><a href=\"#宽松货币政策的出口在哪里\" class=\"headerlink\" title=\"宽松货币政策的出口在哪里\"></a>宽松货币政策的出口在哪里</h3><blockquote>\n<p>一直以来，日本的财政依靠通货紧缩和低利率压缩了利息支出，勉强维持了下来。如果利率恢复到正常的水平，仅仅是支付利息，日本财政都难以应付。</p>\n</blockquote>\n<h2 id=\"第九章-日本未来应该做的事\"><a href=\"#第九章-日本未来应该做的事\" class=\"headerlink\" title=\"第九章 日本未来应该做的事\"></a>第九章 日本未来应该做的事</h2><h3 id=\"日本面临的问题并不是“摆脱通货紧缩”\"><a href=\"#日本面临的问题并不是“摆脱通货紧缩”\" class=\"headerlink\" title=\"日本面临的问题并不是“摆脱通货紧缩”\"></a>日本面临的问题并不是“摆脱通货紧缩”</h3><blockquote>\n<p>物价上涨率过低并不是真正的问题，日本的产业结构和经济体制未能适应时代的变化，才是日本经济停滞的根本原因。</p>\n</blockquote>\n<h3 id=\"必须解决劳动力不足的问题\"><a href=\"#必须解决劳动力不足的问题\" class=\"headerlink\" title=\"必须解决劳动力不足的问题\"></a>必须解决劳动力不足的问题</h3><blockquote>\n<p>要想解决未来劳动力供求失衡的问题，首先应该考虑的措施就是提高老年人的劳动参与率。</p>\n</blockquote>\n<blockquote>\n<p>想提高生育期女性的劳动参与率，必须有完善的育儿支援等政策。这绝非易事。</p>\n</blockquote>\n<blockquote>\n<p>本国劳动力如此短缺的情况下，依然拒绝移民，显然是十分不现实的。日本政府必须从根本上改变思想。</p>\n</blockquote>\n<blockquote>\n<p>仅仅指出日本“不愿意接收移民”，并不能回答一切问题。日本还必须承认移民，允许移民融入日本社会，授予他们选举权，提供社会保障服务等。这是世界性的常识。在人才方面，日本必须打开国门。</p>\n</blockquote>\n<blockquote>\n<p>政府就必须必须为此考虑各种各样的应对措施和制度。对于可能出现的混乱，尽早做到周密的准备，才能防患于未然。因为接收移民是改变社会结构的重要问题，政府必须进行充分的讨论和准备。</p>\n</blockquote>\n<h3 id=\"如何应对社会保障支出的增加\"><a href=\"#如何应对社会保障支出的增加\" class=\"headerlink\" title=\"如何应对社会保障支出的增加\"></a>如何应对社会保障支出的增加</h3><blockquote>\n<p>要想推进以上这些措施，就需要改变日本的社会结构，因为这些问题仅仅在社会保障的框架内是无法解决的。<br>此外，不是单纯依靠增加个人负担、降低养老金发放额来解决问题，政府还必须考虑提高系统的效率。</p>\n</blockquote>\n<blockquote>\n<p>本来，执政是为了实现政策，然而在日本执政才是目标，政策只是必要的装饰。</p>\n</blockquote>\n<h3 id=\"新兴产业的出现才是解决问题的关键\"><a href=\"#新兴产业的出现才是解决问题的关键\" class=\"headerlink\" title=\"新兴产业的出现才是解决问题的关键\"></a>新兴产业的出现才是解决问题的关键</h3><blockquote>\n<p>日本的制造业应该将生产部门单独分出来，委托给新兴国家的企业去做，自己专门进行产品开发、设计等核心领域。在全球水平分工的大环境中，加快推动“制造业的服务产业化”。</p>\n</blockquote>\n<blockquote>\n<p>政府不应该干预产业结构调整的过程。政府应该做的是放宽限制，让市场发挥自身作用。</p>\n</blockquote>\n<blockquote>\n<p>根据贝叶斯方法，在没有任何信息的情况下，对某一事件的概率判断可以用“先验概率”来表示。但是，随着事态的发展，我们会得到各种各样的信息，从而修正概率判断，此时修正后的概率被称为“后验概率”。</p>\n</blockquote>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Wed Aug 10 2022 01:05:13 GMT+0800 (中国标准时间)","title":"2022年七月读书摘录","path":"2022/08/10/202207ReadingList/","eyeCatchImage":null,"excerpt":"<p>这个月一共阅读了四本书，分别是</p>\n<ul>\n<li>《考试脑科学》</li>\n<li>《苦才是人生》</li>\n<li>《成为乔布斯》</li>\n<li>《失去的三十年》<br>回头看读书笔记的时候又帮自己温习了一遍内容。</li>\n</ul>","date":{"_isAMomentObject":true,"_i":"2022-08-09T17:04:12.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-08-09T17:04:12.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"阅读","tags":["读书","考试脑科学","苦才是人生","成为乔布斯","失去的三十年"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":11419},{"title":"数字生活启示录","date":"2020-04-11T18:43:20.000Z","copyright":true,"_content":"\n\n\n尼古拉·尼葛洛庞帝在他1995年发布的的著作《Being Digital》中描绘了未来数字生活的诸多情景，其中VR、AI、智能家居、个人助理等，无一不是近几年研究的热门领域，这些技术的出现深深影响了现代人的日常生活，换句话说，数字生活成为了当今时代人们生活的一部分。\n\n<!--more-->\n\n![image.stephenfang.me/mweb/s1496668.jpg](http://image.stephenfang.me/mweb/s1496668.jpg)\n\n尼古拉·尼葛洛庞帝的《数字化生存》封面\n\n## 拥抱数字生活\n\n当我和朋友谈及「数字生活」这个话题的时候，我们认为，每个人都有自己处理数字生活的方式，但没有一个客观固定的标准。我们每天都会在数码设备上花费不少的时间，但如何妥善安排自己的数码生活却不被重视。\n\n本文开篇之所以用拥抱一词，是因为笔者认为在当今时代，大部分人对于数字内容的汲取和吸收并不是一个被动的过程，相反，是一个开放、主动接受的过程。如何让自己个性化的需求得到满足，其背后的思路是拥抱数字生活的关键。\n\n本文将以乱序的方式回忆和总结我所体验过的数字生活，希望我的这篇文章能给予你一点启发，让你能够以正确的打开方式享受数字时代带来的便利。当然，你完全可以把本文看作敝人的碎碎念，若有不合您想法的观点还请包容。\n\n## 开始数字生活\n\n作为一个平凡人，我勉强认为自己比较擅长鼓捣手机，并在鼓捣的过程中有所感悟。然而我也走过一些弯路，曾经下载过盗版的App，执着于哪款手机更优，庆幸的是这些我的行为或想法能够得到纠正，日常使用习惯也进而得到了培养。\n\n![image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg](http://image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg)\n\n我所折腾过的一些数码物件\n\n![image.stephenfang.me/mweb/Untitled.png](http://image.stephenfang.me/mweb/Untitled.png)\n\n我所折腾过的一些数码物件\n\n引用经济学的一个重要原则，\n\n> “Rational people think at the margin“\n\n即理性的人会从边际去考虑问题。假设你是理性的人，当你在决定更新一台设备时。会尝试从边际成本考虑它会带给你的价值，若你的手头不充裕且更新只能给你的工作流带来5%的提升，那大可不必做这样的决断。手机就是现代人的工具，其最大的价值为其存储的数据带来的价值，你应该做的是让你的手机为你创造价值，而不是被其禁锢。\n\n作为一个工具，那手机必然存在其好处及劣处，且每个人对于手机都有不同的使用习惯和评价标准，你完全可以认为某手机是你当下最好的选择，但他人也完全有理由认为你的看法是错误的。即使你是某个品牌的死忠，也应该客观看待其他厂商推出的各类产品，所谓“信仰”只是一种调侃，而为黑而黑更是没有意义。手机是如此，生活中的许多琐事亦是如此。\n\n![image.stephenfang.me/mweb/IMG_1485.jpeg](http://image.stephenfang.me/mweb/IMG_1485.jpeg)\n\n我的iPod touch\n\n我的真正意义上的数字生活起始于2010年购买的一台iPod touch (4th genration)。我至今仍清楚记得它的配置：阉割版的A4 芯片、3.5 英寸 Retina 屏幕、iOS 4、聊胜于无的摄像头、8GB的存储空间。当时的我对于 Apple 生态一无所知，同步iPod中的内容也是由一家Apple授权店的小哥帮忙完成。\n\n在使用iPod touch的过程中，我逐渐熟悉Apple的生态系统，令我记忆深刻的体验有第一次购买付费App，第一次给设备越狱，第一次在设备上玩在线联机游戏、第一次使用云服务等等。在iPod touch之后我对数码产品的兴趣愈发浓厚，且不仅仅限于iOS设备、Android设备，几年间，手中的设备换了一台又一台，安装的App换了一批又一批，我也逐步走进与计算机打交道的行业。\n\n## 关于App的回忆\n\nApp Store是Apple生态的一个重要组成部分，相当一部分人选择Apple的平台看重的是优秀的iOS独占App。和很多人一样，我购买iPod touch的理由很大程度上是为了游戏。十年后的今天，我的手机中鲜有游戏，虽然有时也会在闲暇时间与朋友来上两把吃鸡，但是再也不会像以前一样为了打通Angry Birds费尽心思。\n\n![image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg](http://image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg)\n\niOS 4时代的 App Store\n\niOS 4时代的游戏以单机、逻辑简单的小游戏为主，但也不乏许多知名的大作，较为出名的有Infinity Blade系列、Asphalt系列，我当时最喜欢的是Gameloft开发的Rainbow Six手游，其最大的特色就是能够以蓝牙联机的方式与好友对战，还记得每天中午都会和班上的同学去学校的阁楼玩几盘联机游戏。然而Cut the Rope、Fruit Ninja、Angry Birds、Doodle Jump才是我对于那个时期最真实的回忆。\n\n## 关于效率\n\n现在的我会仍会刻意给所有的App分门别类，然而刚接触 iOS 时我总把首屏留给系统默认App，并且总是在结束App的使用后习惯性将它在后台清除，同时我还会出于自己对 Google 的向往，在自己的手机中安装所有 Google 系的App，这些行为在现在看来是相当愚蠢。\n\n![image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg](http://image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg)\n\niOS 6时代我的 iPod touch\n\n![image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg](http://image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg)\n\n装满所有 Google 系 App 的 iPhone\n\n首先，更好的应用排布会带来更高的利用效率，试想一下你需要使用某个App记录信息，然而在不使用搜索的情况下每次都要滚动到第二屏，甚至还需要点开一个文件夹才能打开它，还有找不到App的风险，这势必会浪费一部分时间，让你显得手忙脚乱，可能你连需要记录什么都忘了。\n\n![image.stephenfang.me/mweb/s26872396.jpg](http://image.stephenfang.me/mweb/s26872396.jpg)\n\n山下英子的断舍离封面\n\n另外一种想法是我在读了《断舍离》这本书后感悟的，首先简要说明这本书的一个重要观点：\n\n- 断舍离非常简单，只需要以自己而不是物品为主角，去思考什么东西最适合现在的自己。只要是不符合这两个标准的东西，就立即淘汰或是送人。\n\n反映在数字生活中即为保留最近需要用到的App，删除不必须要的内容。目前我在我的手机上保留了80个左右的App，显然我不可能每天用到其中的绝大多数App。有统计学的数据显示，智能手机用户平均每个月将会使用超过30个软件，而平均到每天，将会有10个软件被用户登录。\n\n对于我而言，不会用到的App可以看作是手机的一种“负担”，把它们从我的主屏幕中删除可以看似一种“解脱”，你可以将其看做为一种“伪哲学“，正如许多人对于《断舍离》这本书的看法。时刻保持自己的设备有最高的效率面对工作或学习有如时刻使自己保持清醒的头脑面对生活。\n\n## 关于正版\n\n前几天听说最新版本的 iOS 系统再次能够「越狱」了，然而对此新闻感到兴奋的人寥寥无几。从某种角度来说，「越狱」也是当时导致盗版猖獗的一大原因，然而「越狱」的最重要意义却是让 iOS 设备更具个性化，如 iOS 5 时期我会通过「越狱」去为自己的设备增加通知中心的功能，在 iOS 4 时期我会通过「越狱」给我的iPod touch增加虚拟内存。\n\n![http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg](http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg)\n\n“Jailbreak”界面\n\n![http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg](http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg)\n\n“奔跑的大菠萝”\n\niOS 的付费购买体系目前已经十分成熟，你可以通过各种支付方式获得你需要的App。在没有支付能力的小学时期我可能会为了一款想玩的游戏下载盗版，但我深知这样的想法是错误的，我会告诉自己我需要某一个APP，它为我创造了价值，我乐意为其付费，于是具备消费能力之后我督促自己禁止使用盗版的内容。\n\n为内容付费是一种闭环，没有投入就没有产出，如果开发者的投入没有回报，很可能导致的结果就是软件停止更新，或比喻为劣币驱逐良币，试想一下应用商店充斥着隐含各种广告的App，相信这种局面都是你我所不愿意看到的。自然，我不会去鄙视用盗版的人，他们很可能是迫不得已，诚然，一些大公司的营收不会因为缺少了一部分人的支出而受重大影响，但我认为用着盗版还大肆夸耀就有些不合情理了。\n\n微软推出的 Office 365 是一个很有趣的例子，在高中的时候我开始每年为 Office 365 付费，我完全厌倦了 WPS 恼人的广告机制，能够用到正版 Office 令我十分开心，然而这样的行为当时为许多人所不解。近年来使用正版 Office 的成本不断降低，愿意使用正版的人群也逐渐壮大，微软也在努力提升该产品的价值，现在你能够以每年 70多元的价格购买到 Office 套件的全部功能，如果你确定Office能够提供你工作中的便利，那么其价格完全不构成经济上的负担，何况这其中还包括完善的云服务，我认为这是消费者与产品提供商实现的一种协调。当然如果你使用的是Mac，你完全可以用 Apple 的 iWork 套件替代 Office 的工作流，总是有合适的方案替代最坏的使用盗版的方案。你如果觉得购买 Mac 上的 Apps 太贵，可以选择订阅性质的 Setapp，只要你对于设备生产力的界定在“爱奇艺“之上，这些举措都是有意义的。\n\n![http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png](http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png)\n\n采用订阅收费制度的Setapp\n\n我想表达的并不是一种说教，更多的是一种意识。你可能喜欢观看美剧，但出于各方面原因你无法使用到网飞等平台的服务，但你可以选择的是想办法使用到这种服务，正可谓“办法总比困难多”，或者你可以在某些方面支持你所喜爱的作品。最次的方案则是“偷偷地看“，不是为自己享有盗版而感到自豪。你愿意为一杯奶茶带来的味蕾刺激付费，却不愿意为能够提升你的效率、生活品质的内容而付费，这听起来是不是很荒谬？\n\n## 关于多样性\n\n“如果你想要学习一些自己感兴趣的内容，你必须经历一段痛苦的，学习自己不想学习内容的经历。“这是我对于学习这一件事最真切的感悟。在互联网时代，互联网就是你最好的老师，你可以通过互联网检索到你任何感兴趣的问题的答案，同时你也可以通过互联网学习到任何你想学习的内容，尽管你搜索到的内容很大几率是错误的，且检索到的课程质量可能良莠不齐，但并不影响这个结论的正确性，你需要做的是提高自己辨别正误信息的能力以及提高自己接受新事物的能力。\n\n回到这段开头这一句话，当你拥有了学习自己所喜欢内容的时间和机会，不应该以“没有空”等类似理由搪塞自己，而应该通过互联网的力量让自己的求知欲得到满足。当你不理解思维导图如何完成就尝试去学习和实践它，当你对咖啡文化感兴趣就去了解它的历史和发展状况，当你充满求知欲时就刷上一天的维基百科。\n\n我的一位高中同学对任何知识都满怀好奇，无论是他所不熟悉的电竞领域还是他所了解的电影市场，凡是能够引起讨论的内容他都略知一二，我暂且认定他的学习方法称之为“杂学”。起初我对这种学习方式不以为然，认为学习的重要方法在于精而不是杂，渐渐地，我开始觉得这种方式在信息爆炸的年代存在其合理性。\n\n![http://image.stephenfang.me/mweb/s1429010.jpg](http://image.stephenfang.me/mweb/s1429010.jpg)\n\n许多人的理财启蒙读物——《富爸爸，穷爸爸》\n\n首先，他的学习内容仍然是以兴趣为第一导向，对于乏味、无用的内容他一概不学，确保了学习过程的积极性和主动性；其次，在阅读了《富爸爸穷爸爸》这本书后，我认为当时我当时的观点与书中穷爸爸对于停留在某种体制内、在某一方面成为专家的观点无异，而书中的富爸爸则倡导学习各方的知识，如财务知识、交谈经验等，这一出发点对该书的作者产生了深刻的影响，促成了其人生中的诸多机会，同时也造就了该书作者的经济地位——这也就是我想说的，求知欲以及交叉学科知识产生的影响。\n\n![http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg](http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg)\n\n12年我的音乐资料库\n\n人在学习和探索的过程中很可能会推翻许多固有的认知，很多年以前，我曾对日本的音乐抱有偏见，但通过数年对于日本音乐、文化的学习，我了解到坂本龙一、玉置浩二这样的大师，喜爱上re:plus这样的小众乐队，痴迷于押尾光太郎的指弹，见证过Aimer的迅速发展，我所学到的一切都引起了我对日本音乐的尊重。然而不仅仅是音乐，我对很多事物的看法都在互联网的影响下产生很大改观。我在本文最后呼吁大家走出“XX无用论”的泥淖，大胆拥抱新鲜事物，积极表达求知欲望，如尝试「GTD工作法」、「量化自我」等方法将大有裨益，至于某些具体的方法论不在此文中引述，读者可以期待本人未来的分享。\n\n## 尾声\n\n本文至此就告一段落了，显然，笔者想表达的观点和内容还有很多，对于具体的方法论会在之后的文章阐述，还请继续期待和支持。\n\n### 引用\n\n[https://bi.qq.com/a/20170613/059340.htm](https://bi.qq.com/a/20170613/059340.htm)\n\n[https://en.wikiversity.org/wiki/10_Principles_of_Economics](https://en.wikiversity.org/wiki/10_Principles_of_Economics)\n\n[https://www.ifanr.com/app/727935](https://www.ifanr.com/app/727935)","source":"_posts/Digital_Life.md","raw":"---\ntitle: 数字生活启示录\ndate: 2020-04-12 02:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- 数字生活\ncopyright: true\n---\n\n\n\n尼古拉·尼葛洛庞帝在他1995年发布的的著作《Being Digital》中描绘了未来数字生活的诸多情景，其中VR、AI、智能家居、个人助理等，无一不是近几年研究的热门领域，这些技术的出现深深影响了现代人的日常生活，换句话说，数字生活成为了当今时代人们生活的一部分。\n\n<!--more-->\n\n![image.stephenfang.me/mweb/s1496668.jpg](http://image.stephenfang.me/mweb/s1496668.jpg)\n\n尼古拉·尼葛洛庞帝的《数字化生存》封面\n\n## 拥抱数字生活\n\n当我和朋友谈及「数字生活」这个话题的时候，我们认为，每个人都有自己处理数字生活的方式，但没有一个客观固定的标准。我们每天都会在数码设备上花费不少的时间，但如何妥善安排自己的数码生活却不被重视。\n\n本文开篇之所以用拥抱一词，是因为笔者认为在当今时代，大部分人对于数字内容的汲取和吸收并不是一个被动的过程，相反，是一个开放、主动接受的过程。如何让自己个性化的需求得到满足，其背后的思路是拥抱数字生活的关键。\n\n本文将以乱序的方式回忆和总结我所体验过的数字生活，希望我的这篇文章能给予你一点启发，让你能够以正确的打开方式享受数字时代带来的便利。当然，你完全可以把本文看作敝人的碎碎念，若有不合您想法的观点还请包容。\n\n## 开始数字生活\n\n作为一个平凡人，我勉强认为自己比较擅长鼓捣手机，并在鼓捣的过程中有所感悟。然而我也走过一些弯路，曾经下载过盗版的App，执着于哪款手机更优，庆幸的是这些我的行为或想法能够得到纠正，日常使用习惯也进而得到了培养。\n\n![image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg](http://image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg)\n\n我所折腾过的一些数码物件\n\n![image.stephenfang.me/mweb/Untitled.png](http://image.stephenfang.me/mweb/Untitled.png)\n\n我所折腾过的一些数码物件\n\n引用经济学的一个重要原则，\n\n> “Rational people think at the margin“\n\n即理性的人会从边际去考虑问题。假设你是理性的人，当你在决定更新一台设备时。会尝试从边际成本考虑它会带给你的价值，若你的手头不充裕且更新只能给你的工作流带来5%的提升，那大可不必做这样的决断。手机就是现代人的工具，其最大的价值为其存储的数据带来的价值，你应该做的是让你的手机为你创造价值，而不是被其禁锢。\n\n作为一个工具，那手机必然存在其好处及劣处，且每个人对于手机都有不同的使用习惯和评价标准，你完全可以认为某手机是你当下最好的选择，但他人也完全有理由认为你的看法是错误的。即使你是某个品牌的死忠，也应该客观看待其他厂商推出的各类产品，所谓“信仰”只是一种调侃，而为黑而黑更是没有意义。手机是如此，生活中的许多琐事亦是如此。\n\n![image.stephenfang.me/mweb/IMG_1485.jpeg](http://image.stephenfang.me/mweb/IMG_1485.jpeg)\n\n我的iPod touch\n\n我的真正意义上的数字生活起始于2010年购买的一台iPod touch (4th genration)。我至今仍清楚记得它的配置：阉割版的A4 芯片、3.5 英寸 Retina 屏幕、iOS 4、聊胜于无的摄像头、8GB的存储空间。当时的我对于 Apple 生态一无所知，同步iPod中的内容也是由一家Apple授权店的小哥帮忙完成。\n\n在使用iPod touch的过程中，我逐渐熟悉Apple的生态系统，令我记忆深刻的体验有第一次购买付费App，第一次给设备越狱，第一次在设备上玩在线联机游戏、第一次使用云服务等等。在iPod touch之后我对数码产品的兴趣愈发浓厚，且不仅仅限于iOS设备、Android设备，几年间，手中的设备换了一台又一台，安装的App换了一批又一批，我也逐步走进与计算机打交道的行业。\n\n## 关于App的回忆\n\nApp Store是Apple生态的一个重要组成部分，相当一部分人选择Apple的平台看重的是优秀的iOS独占App。和很多人一样，我购买iPod touch的理由很大程度上是为了游戏。十年后的今天，我的手机中鲜有游戏，虽然有时也会在闲暇时间与朋友来上两把吃鸡，但是再也不会像以前一样为了打通Angry Birds费尽心思。\n\n![image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg](http://image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg)\n\niOS 4时代的 App Store\n\niOS 4时代的游戏以单机、逻辑简单的小游戏为主，但也不乏许多知名的大作，较为出名的有Infinity Blade系列、Asphalt系列，我当时最喜欢的是Gameloft开发的Rainbow Six手游，其最大的特色就是能够以蓝牙联机的方式与好友对战，还记得每天中午都会和班上的同学去学校的阁楼玩几盘联机游戏。然而Cut the Rope、Fruit Ninja、Angry Birds、Doodle Jump才是我对于那个时期最真实的回忆。\n\n## 关于效率\n\n现在的我会仍会刻意给所有的App分门别类，然而刚接触 iOS 时我总把首屏留给系统默认App，并且总是在结束App的使用后习惯性将它在后台清除，同时我还会出于自己对 Google 的向往，在自己的手机中安装所有 Google 系的App，这些行为在现在看来是相当愚蠢。\n\n![image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg](http://image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg)\n\niOS 6时代我的 iPod touch\n\n![image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg](http://image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg)\n\n装满所有 Google 系 App 的 iPhone\n\n首先，更好的应用排布会带来更高的利用效率，试想一下你需要使用某个App记录信息，然而在不使用搜索的情况下每次都要滚动到第二屏，甚至还需要点开一个文件夹才能打开它，还有找不到App的风险，这势必会浪费一部分时间，让你显得手忙脚乱，可能你连需要记录什么都忘了。\n\n![image.stephenfang.me/mweb/s26872396.jpg](http://image.stephenfang.me/mweb/s26872396.jpg)\n\n山下英子的断舍离封面\n\n另外一种想法是我在读了《断舍离》这本书后感悟的，首先简要说明这本书的一个重要观点：\n\n- 断舍离非常简单，只需要以自己而不是物品为主角，去思考什么东西最适合现在的自己。只要是不符合这两个标准的东西，就立即淘汰或是送人。\n\n反映在数字生活中即为保留最近需要用到的App，删除不必须要的内容。目前我在我的手机上保留了80个左右的App，显然我不可能每天用到其中的绝大多数App。有统计学的数据显示，智能手机用户平均每个月将会使用超过30个软件，而平均到每天，将会有10个软件被用户登录。\n\n对于我而言，不会用到的App可以看作是手机的一种“负担”，把它们从我的主屏幕中删除可以看似一种“解脱”，你可以将其看做为一种“伪哲学“，正如许多人对于《断舍离》这本书的看法。时刻保持自己的设备有最高的效率面对工作或学习有如时刻使自己保持清醒的头脑面对生活。\n\n## 关于正版\n\n前几天听说最新版本的 iOS 系统再次能够「越狱」了，然而对此新闻感到兴奋的人寥寥无几。从某种角度来说，「越狱」也是当时导致盗版猖獗的一大原因，然而「越狱」的最重要意义却是让 iOS 设备更具个性化，如 iOS 5 时期我会通过「越狱」去为自己的设备增加通知中心的功能，在 iOS 4 时期我会通过「越狱」给我的iPod touch增加虚拟内存。\n\n![http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg](http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg)\n\n“Jailbreak”界面\n\n![http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg](http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg)\n\n“奔跑的大菠萝”\n\niOS 的付费购买体系目前已经十分成熟，你可以通过各种支付方式获得你需要的App。在没有支付能力的小学时期我可能会为了一款想玩的游戏下载盗版，但我深知这样的想法是错误的，我会告诉自己我需要某一个APP，它为我创造了价值，我乐意为其付费，于是具备消费能力之后我督促自己禁止使用盗版的内容。\n\n为内容付费是一种闭环，没有投入就没有产出，如果开发者的投入没有回报，很可能导致的结果就是软件停止更新，或比喻为劣币驱逐良币，试想一下应用商店充斥着隐含各种广告的App，相信这种局面都是你我所不愿意看到的。自然，我不会去鄙视用盗版的人，他们很可能是迫不得已，诚然，一些大公司的营收不会因为缺少了一部分人的支出而受重大影响，但我认为用着盗版还大肆夸耀就有些不合情理了。\n\n微软推出的 Office 365 是一个很有趣的例子，在高中的时候我开始每年为 Office 365 付费，我完全厌倦了 WPS 恼人的广告机制，能够用到正版 Office 令我十分开心，然而这样的行为当时为许多人所不解。近年来使用正版 Office 的成本不断降低，愿意使用正版的人群也逐渐壮大，微软也在努力提升该产品的价值，现在你能够以每年 70多元的价格购买到 Office 套件的全部功能，如果你确定Office能够提供你工作中的便利，那么其价格完全不构成经济上的负担，何况这其中还包括完善的云服务，我认为这是消费者与产品提供商实现的一种协调。当然如果你使用的是Mac，你完全可以用 Apple 的 iWork 套件替代 Office 的工作流，总是有合适的方案替代最坏的使用盗版的方案。你如果觉得购买 Mac 上的 Apps 太贵，可以选择订阅性质的 Setapp，只要你对于设备生产力的界定在“爱奇艺“之上，这些举措都是有意义的。\n\n![http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png](http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png)\n\n采用订阅收费制度的Setapp\n\n我想表达的并不是一种说教，更多的是一种意识。你可能喜欢观看美剧，但出于各方面原因你无法使用到网飞等平台的服务，但你可以选择的是想办法使用到这种服务，正可谓“办法总比困难多”，或者你可以在某些方面支持你所喜爱的作品。最次的方案则是“偷偷地看“，不是为自己享有盗版而感到自豪。你愿意为一杯奶茶带来的味蕾刺激付费，却不愿意为能够提升你的效率、生活品质的内容而付费，这听起来是不是很荒谬？\n\n## 关于多样性\n\n“如果你想要学习一些自己感兴趣的内容，你必须经历一段痛苦的，学习自己不想学习内容的经历。“这是我对于学习这一件事最真切的感悟。在互联网时代，互联网就是你最好的老师，你可以通过互联网检索到你任何感兴趣的问题的答案，同时你也可以通过互联网学习到任何你想学习的内容，尽管你搜索到的内容很大几率是错误的，且检索到的课程质量可能良莠不齐，但并不影响这个结论的正确性，你需要做的是提高自己辨别正误信息的能力以及提高自己接受新事物的能力。\n\n回到这段开头这一句话，当你拥有了学习自己所喜欢内容的时间和机会，不应该以“没有空”等类似理由搪塞自己，而应该通过互联网的力量让自己的求知欲得到满足。当你不理解思维导图如何完成就尝试去学习和实践它，当你对咖啡文化感兴趣就去了解它的历史和发展状况，当你充满求知欲时就刷上一天的维基百科。\n\n我的一位高中同学对任何知识都满怀好奇，无论是他所不熟悉的电竞领域还是他所了解的电影市场，凡是能够引起讨论的内容他都略知一二，我暂且认定他的学习方法称之为“杂学”。起初我对这种学习方式不以为然，认为学习的重要方法在于精而不是杂，渐渐地，我开始觉得这种方式在信息爆炸的年代存在其合理性。\n\n![http://image.stephenfang.me/mweb/s1429010.jpg](http://image.stephenfang.me/mweb/s1429010.jpg)\n\n许多人的理财启蒙读物——《富爸爸，穷爸爸》\n\n首先，他的学习内容仍然是以兴趣为第一导向，对于乏味、无用的内容他一概不学，确保了学习过程的积极性和主动性；其次，在阅读了《富爸爸穷爸爸》这本书后，我认为当时我当时的观点与书中穷爸爸对于停留在某种体制内、在某一方面成为专家的观点无异，而书中的富爸爸则倡导学习各方的知识，如财务知识、交谈经验等，这一出发点对该书的作者产生了深刻的影响，促成了其人生中的诸多机会，同时也造就了该书作者的经济地位——这也就是我想说的，求知欲以及交叉学科知识产生的影响。\n\n![http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg](http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg)\n\n12年我的音乐资料库\n\n人在学习和探索的过程中很可能会推翻许多固有的认知，很多年以前，我曾对日本的音乐抱有偏见，但通过数年对于日本音乐、文化的学习，我了解到坂本龙一、玉置浩二这样的大师，喜爱上re:plus这样的小众乐队，痴迷于押尾光太郎的指弹，见证过Aimer的迅速发展，我所学到的一切都引起了我对日本音乐的尊重。然而不仅仅是音乐，我对很多事物的看法都在互联网的影响下产生很大改观。我在本文最后呼吁大家走出“XX无用论”的泥淖，大胆拥抱新鲜事物，积极表达求知欲望，如尝试「GTD工作法」、「量化自我」等方法将大有裨益，至于某些具体的方法论不在此文中引述，读者可以期待本人未来的分享。\n\n## 尾声\n\n本文至此就告一段落了，显然，笔者想表达的观点和内容还有很多，对于具体的方法论会在之后的文章阐述，还请继续期待和支持。\n\n### 引用\n\n[https://bi.qq.com/a/20170613/059340.htm](https://bi.qq.com/a/20170613/059340.htm)\n\n[https://en.wikiversity.org/wiki/10_Principles_of_Economics](https://en.wikiversity.org/wiki/10_Principles_of_Economics)\n\n[https://www.ifanr.com/app/727935](https://www.ifanr.com/app/727935)","slug":"Digital_Life","published":1,"updated":"2022-07-24T15:19:06.646Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1q000io76fapdcbkak","content":"<p>尼古拉·尼葛洛庞帝在他1995年发布的的著作《Being Digital》中描绘了未来数字生活的诸多情景，其中VR、AI、智能家居、个人助理等，无一不是近几年研究的热门领域，这些技术的出现深深影响了现代人的日常生活，换句话说，数字生活成为了当今时代人们生活的一部分。</p>\n<span id=\"more\"></span>\n\n<p><img src=\"http://image.stephenfang.me/mweb/s1496668.jpg\" alt=\"image.stephenfang.me/mweb/s1496668.jpg\"></p>\n<p>尼古拉·尼葛洛庞帝的《数字化生存》封面</p>\n<h2 id=\"拥抱数字生活\"><a href=\"#拥抱数字生活\" class=\"headerlink\" title=\"拥抱数字生活\"></a>拥抱数字生活</h2><p>当我和朋友谈及「数字生活」这个话题的时候，我们认为，每个人都有自己处理数字生活的方式，但没有一个客观固定的标准。我们每天都会在数码设备上花费不少的时间，但如何妥善安排自己的数码生活却不被重视。</p>\n<p>本文开篇之所以用拥抱一词，是因为笔者认为在当今时代，大部分人对于数字内容的汲取和吸收并不是一个被动的过程，相反，是一个开放、主动接受的过程。如何让自己个性化的需求得到满足，其背后的思路是拥抱数字生活的关键。</p>\n<p>本文将以乱序的方式回忆和总结我所体验过的数字生活，希望我的这篇文章能给予你一点启发，让你能够以正确的打开方式享受数字时代带来的便利。当然，你完全可以把本文看作敝人的碎碎念，若有不合您想法的观点还请包容。</p>\n<h2 id=\"开始数字生活\"><a href=\"#开始数字生活\" class=\"headerlink\" title=\"开始数字生活\"></a>开始数字生活</h2><p>作为一个平凡人，我勉强认为自己比较擅长鼓捣手机，并在鼓捣的过程中有所感悟。然而我也走过一些弯路，曾经下载过盗版的App，执着于哪款手机更优，庆幸的是这些我的行为或想法能够得到纠正，日常使用习惯也进而得到了培养。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg\" alt=\"image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg\"></p>\n<p>我所折腾过的一些数码物件</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled.png\" alt=\"image.stephenfang.me/mweb/Untitled.png\"></p>\n<p>我所折腾过的一些数码物件</p>\n<p>引用经济学的一个重要原则，</p>\n<blockquote>\n<p>“Rational people think at the margin“</p>\n</blockquote>\n<p>即理性的人会从边际去考虑问题。假设你是理性的人，当你在决定更新一台设备时。会尝试从边际成本考虑它会带给你的价值，若你的手头不充裕且更新只能给你的工作流带来5%的提升，那大可不必做这样的决断。手机就是现代人的工具，其最大的价值为其存储的数据带来的价值，你应该做的是让你的手机为你创造价值，而不是被其禁锢。</p>\n<p>作为一个工具，那手机必然存在其好处及劣处，且每个人对于手机都有不同的使用习惯和评价标准，你完全可以认为某手机是你当下最好的选择，但他人也完全有理由认为你的看法是错误的。即使你是某个品牌的死忠，也应该客观看待其他厂商推出的各类产品，所谓“信仰”只是一种调侃，而为黑而黑更是没有意义。手机是如此，生活中的许多琐事亦是如此。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/IMG_1485.jpeg\" alt=\"image.stephenfang.me/mweb/IMG_1485.jpeg\"></p>\n<p>我的iPod touch</p>\n<p>我的真正意义上的数字生活起始于2010年购买的一台iPod touch (4th genration)。我至今仍清楚记得它的配置：阉割版的A4 芯片、3.5 英寸 Retina 屏幕、iOS 4、聊胜于无的摄像头、8GB的存储空间。当时的我对于 Apple 生态一无所知，同步iPod中的内容也是由一家Apple授权店的小哥帮忙完成。</p>\n<p>在使用iPod touch的过程中，我逐渐熟悉Apple的生态系统，令我记忆深刻的体验有第一次购买付费App，第一次给设备越狱，第一次在设备上玩在线联机游戏、第一次使用云服务等等。在iPod touch之后我对数码产品的兴趣愈发浓厚，且不仅仅限于iOS设备、Android设备，几年间，手中的设备换了一台又一台，安装的App换了一批又一批，我也逐步走进与计算机打交道的行业。</p>\n<h2 id=\"关于App的回忆\"><a href=\"#关于App的回忆\" class=\"headerlink\" title=\"关于App的回忆\"></a>关于App的回忆</h2><p>App Store是Apple生态的一个重要组成部分，相当一部分人选择Apple的平台看重的是优秀的iOS独占App。和很多人一样，我购买iPod touch的理由很大程度上是为了游戏。十年后的今天，我的手机中鲜有游戏，虽然有时也会在闲暇时间与朋友来上两把吃鸡，但是再也不会像以前一样为了打通Angry Birds费尽心思。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg\" alt=\"image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg\"></p>\n<p>iOS 4时代的 App Store</p>\n<p>iOS 4时代的游戏以单机、逻辑简单的小游戏为主，但也不乏许多知名的大作，较为出名的有Infinity Blade系列、Asphalt系列，我当时最喜欢的是Gameloft开发的Rainbow Six手游，其最大的特色就是能够以蓝牙联机的方式与好友对战，还记得每天中午都会和班上的同学去学校的阁楼玩几盘联机游戏。然而Cut the Rope、Fruit Ninja、Angry Birds、Doodle Jump才是我对于那个时期最真实的回忆。</p>\n<h2 id=\"关于效率\"><a href=\"#关于效率\" class=\"headerlink\" title=\"关于效率\"></a>关于效率</h2><p>现在的我会仍会刻意给所有的App分门别类，然而刚接触 iOS 时我总把首屏留给系统默认App，并且总是在结束App的使用后习惯性将它在后台清除，同时我还会出于自己对 Google 的向往，在自己的手机中安装所有 Google 系的App，这些行为在现在看来是相当愚蠢。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg\" alt=\"image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg\"></p>\n<p>iOS 6时代我的 iPod touch</p>\n<p><img src=\"http://image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg\" alt=\"image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg\"></p>\n<p>装满所有 Google 系 App 的 iPhone</p>\n<p>首先，更好的应用排布会带来更高的利用效率，试想一下你需要使用某个App记录信息，然而在不使用搜索的情况下每次都要滚动到第二屏，甚至还需要点开一个文件夹才能打开它，还有找不到App的风险，这势必会浪费一部分时间，让你显得手忙脚乱，可能你连需要记录什么都忘了。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/s26872396.jpg\" alt=\"image.stephenfang.me/mweb/s26872396.jpg\"></p>\n<p>山下英子的断舍离封面</p>\n<p>另外一种想法是我在读了《断舍离》这本书后感悟的，首先简要说明这本书的一个重要观点：</p>\n<ul>\n<li>断舍离非常简单，只需要以自己而不是物品为主角，去思考什么东西最适合现在的自己。只要是不符合这两个标准的东西，就立即淘汰或是送人。</li>\n</ul>\n<p>反映在数字生活中即为保留最近需要用到的App，删除不必须要的内容。目前我在我的手机上保留了80个左右的App，显然我不可能每天用到其中的绝大多数App。有统计学的数据显示，智能手机用户平均每个月将会使用超过30个软件，而平均到每天，将会有10个软件被用户登录。</p>\n<p>对于我而言，不会用到的App可以看作是手机的一种“负担”，把它们从我的主屏幕中删除可以看似一种“解脱”，你可以将其看做为一种“伪哲学“，正如许多人对于《断舍离》这本书的看法。时刻保持自己的设备有最高的效率面对工作或学习有如时刻使自己保持清醒的头脑面对生活。</p>\n<h2 id=\"关于正版\"><a href=\"#关于正版\" class=\"headerlink\" title=\"关于正版\"></a>关于正版</h2><p>前几天听说最新版本的 iOS 系统再次能够「越狱」了，然而对此新闻感到兴奋的人寥寥无几。从某种角度来说，「越狱」也是当时导致盗版猖獗的一大原因，然而「越狱」的最重要意义却是让 iOS 设备更具个性化，如 iOS 5 时期我会通过「越狱」去为自己的设备增加通知中心的功能，在 iOS 4 时期我会通过「越狱」给我的iPod touch增加虚拟内存。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg\" alt=\"http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg\"></p>\n<p>“Jailbreak”界面</p>\n<p><img src=\"http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg\" alt=\"http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg\"></p>\n<p>“奔跑的大菠萝”</p>\n<p>iOS 的付费购买体系目前已经十分成熟，你可以通过各种支付方式获得你需要的App。在没有支付能力的小学时期我可能会为了一款想玩的游戏下载盗版，但我深知这样的想法是错误的，我会告诉自己我需要某一个APP，它为我创造了价值，我乐意为其付费，于是具备消费能力之后我督促自己禁止使用盗版的内容。</p>\n<p>为内容付费是一种闭环，没有投入就没有产出，如果开发者的投入没有回报，很可能导致的结果就是软件停止更新，或比喻为劣币驱逐良币，试想一下应用商店充斥着隐含各种广告的App，相信这种局面都是你我所不愿意看到的。自然，我不会去鄙视用盗版的人，他们很可能是迫不得已，诚然，一些大公司的营收不会因为缺少了一部分人的支出而受重大影响，但我认为用着盗版还大肆夸耀就有些不合情理了。</p>\n<p>微软推出的 Office 365 是一个很有趣的例子，在高中的时候我开始每年为 Office 365 付费，我完全厌倦了 WPS 恼人的广告机制，能够用到正版 Office 令我十分开心，然而这样的行为当时为许多人所不解。近年来使用正版 Office 的成本不断降低，愿意使用正版的人群也逐渐壮大，微软也在努力提升该产品的价值，现在你能够以每年 70多元的价格购买到 Office 套件的全部功能，如果你确定Office能够提供你工作中的便利，那么其价格完全不构成经济上的负担，何况这其中还包括完善的云服务，我认为这是消费者与产品提供商实现的一种协调。当然如果你使用的是Mac，你完全可以用 Apple 的 iWork 套件替代 Office 的工作流，总是有合适的方案替代最坏的使用盗版的方案。你如果觉得购买 Mac 上的 Apps 太贵，可以选择订阅性质的 Setapp，只要你对于设备生产力的界定在“爱奇艺“之上，这些举措都是有意义的。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png\" alt=\"http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png\"></p>\n<p>采用订阅收费制度的Setapp</p>\n<p>我想表达的并不是一种说教，更多的是一种意识。你可能喜欢观看美剧，但出于各方面原因你无法使用到网飞等平台的服务，但你可以选择的是想办法使用到这种服务，正可谓“办法总比困难多”，或者你可以在某些方面支持你所喜爱的作品。最次的方案则是“偷偷地看“，不是为自己享有盗版而感到自豪。你愿意为一杯奶茶带来的味蕾刺激付费，却不愿意为能够提升你的效率、生活品质的内容而付费，这听起来是不是很荒谬？</p>\n<h2 id=\"关于多样性\"><a href=\"#关于多样性\" class=\"headerlink\" title=\"关于多样性\"></a>关于多样性</h2><p>“如果你想要学习一些自己感兴趣的内容，你必须经历一段痛苦的，学习自己不想学习内容的经历。“这是我对于学习这一件事最真切的感悟。在互联网时代，互联网就是你最好的老师，你可以通过互联网检索到你任何感兴趣的问题的答案，同时你也可以通过互联网学习到任何你想学习的内容，尽管你搜索到的内容很大几率是错误的，且检索到的课程质量可能良莠不齐，但并不影响这个结论的正确性，你需要做的是提高自己辨别正误信息的能力以及提高自己接受新事物的能力。</p>\n<p>回到这段开头这一句话，当你拥有了学习自己所喜欢内容的时间和机会，不应该以“没有空”等类似理由搪塞自己，而应该通过互联网的力量让自己的求知欲得到满足。当你不理解思维导图如何完成就尝试去学习和实践它，当你对咖啡文化感兴趣就去了解它的历史和发展状况，当你充满求知欲时就刷上一天的维基百科。</p>\n<p>我的一位高中同学对任何知识都满怀好奇，无论是他所不熟悉的电竞领域还是他所了解的电影市场，凡是能够引起讨论的内容他都略知一二，我暂且认定他的学习方法称之为“杂学”。起初我对这种学习方式不以为然，认为学习的重要方法在于精而不是杂，渐渐地，我开始觉得这种方式在信息爆炸的年代存在其合理性。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/s1429010.jpg\" alt=\"http://image.stephenfang.me/mweb/s1429010.jpg\"></p>\n<p>许多人的理财启蒙读物——《富爸爸，穷爸爸》</p>\n<p>首先，他的学习内容仍然是以兴趣为第一导向，对于乏味、无用的内容他一概不学，确保了学习过程的积极性和主动性；其次，在阅读了《富爸爸穷爸爸》这本书后，我认为当时我当时的观点与书中穷爸爸对于停留在某种体制内、在某一方面成为专家的观点无异，而书中的富爸爸则倡导学习各方的知识，如财务知识、交谈经验等，这一出发点对该书的作者产生了深刻的影响，促成了其人生中的诸多机会，同时也造就了该书作者的经济地位——这也就是我想说的，求知欲以及交叉学科知识产生的影响。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg\" alt=\"http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg\"></p>\n<p>12年我的音乐资料库</p>\n<p>人在学习和探索的过程中很可能会推翻许多固有的认知，很多年以前，我曾对日本的音乐抱有偏见，但通过数年对于日本音乐、文化的学习，我了解到坂本龙一、玉置浩二这样的大师，喜爱上re:plus这样的小众乐队，痴迷于押尾光太郎的指弹，见证过Aimer的迅速发展，我所学到的一切都引起了我对日本音乐的尊重。然而不仅仅是音乐，我对很多事物的看法都在互联网的影响下产生很大改观。我在本文最后呼吁大家走出“XX无用论”的泥淖，大胆拥抱新鲜事物，积极表达求知欲望，如尝试「GTD工作法」、「量化自我」等方法将大有裨益，至于某些具体的方法论不在此文中引述，读者可以期待本人未来的分享。</p>\n<h2 id=\"尾声\"><a href=\"#尾声\" class=\"headerlink\" title=\"尾声\"></a>尾声</h2><p>本文至此就告一段落了，显然，笔者想表达的观点和内容还有很多，对于具体的方法论会在之后的文章阐述，还请继续期待和支持。</p>\n<h3 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h3><p><a href=\"https://bi.qq.com/a/20170613/059340.htm\">https://bi.qq.com/a/20170613/059340.htm</a></p>\n<p><a href=\"https://en.wikiversity.org/wiki/10_Principles_of_Economics\">https://en.wikiversity.org/wiki/10_Principles_of_Economics</a></p>\n<p><a href=\"https://www.ifanr.com/app/727935\">https://www.ifanr.com/app/727935</a></p>\n","site":{"data":{}},"excerpt":"<p>尼古拉·尼葛洛庞帝在他1995年发布的的著作《Being Digital》中描绘了未来数字生活的诸多情景，其中VR、AI、智能家居、个人助理等，无一不是近几年研究的热门领域，这些技术的出现深深影响了现代人的日常生活，换句话说，数字生活成为了当今时代人们生活的一部分。</p>","more":"<p><img src=\"http://image.stephenfang.me/mweb/s1496668.jpg\" alt=\"image.stephenfang.me/mweb/s1496668.jpg\"></p>\n<p>尼古拉·尼葛洛庞帝的《数字化生存》封面</p>\n<h2 id=\"拥抱数字生活\"><a href=\"#拥抱数字生活\" class=\"headerlink\" title=\"拥抱数字生活\"></a>拥抱数字生活</h2><p>当我和朋友谈及「数字生活」这个话题的时候，我们认为，每个人都有自己处理数字生活的方式，但没有一个客观固定的标准。我们每天都会在数码设备上花费不少的时间，但如何妥善安排自己的数码生活却不被重视。</p>\n<p>本文开篇之所以用拥抱一词，是因为笔者认为在当今时代，大部分人对于数字内容的汲取和吸收并不是一个被动的过程，相反，是一个开放、主动接受的过程。如何让自己个性化的需求得到满足，其背后的思路是拥抱数字生活的关键。</p>\n<p>本文将以乱序的方式回忆和总结我所体验过的数字生活，希望我的这篇文章能给予你一点启发，让你能够以正确的打开方式享受数字时代带来的便利。当然，你完全可以把本文看作敝人的碎碎念，若有不合您想法的观点还请包容。</p>\n<h2 id=\"开始数字生活\"><a href=\"#开始数字生活\" class=\"headerlink\" title=\"开始数字生活\"></a>开始数字生活</h2><p>作为一个平凡人，我勉强认为自己比较擅长鼓捣手机，并在鼓捣的过程中有所感悟。然而我也走过一些弯路，曾经下载过盗版的App，执着于哪款手机更优，庆幸的是这些我的行为或想法能够得到纠正，日常使用习惯也进而得到了培养。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg\" alt=\"image.stephenfang.me/mweb/C68FD435-10A6-449C-8DEB-329A9F4BEC24.jpeg\"></p>\n<p>我所折腾过的一些数码物件</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled.png\" alt=\"image.stephenfang.me/mweb/Untitled.png\"></p>\n<p>我所折腾过的一些数码物件</p>\n<p>引用经济学的一个重要原则，</p>\n<blockquote>\n<p>“Rational people think at the margin“</p>\n</blockquote>\n<p>即理性的人会从边际去考虑问题。假设你是理性的人，当你在决定更新一台设备时。会尝试从边际成本考虑它会带给你的价值，若你的手头不充裕且更新只能给你的工作流带来5%的提升，那大可不必做这样的决断。手机就是现代人的工具，其最大的价值为其存储的数据带来的价值，你应该做的是让你的手机为你创造价值，而不是被其禁锢。</p>\n<p>作为一个工具，那手机必然存在其好处及劣处，且每个人对于手机都有不同的使用习惯和评价标准，你完全可以认为某手机是你当下最好的选择，但他人也完全有理由认为你的看法是错误的。即使你是某个品牌的死忠，也应该客观看待其他厂商推出的各类产品，所谓“信仰”只是一种调侃，而为黑而黑更是没有意义。手机是如此，生活中的许多琐事亦是如此。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/IMG_1485.jpeg\" alt=\"image.stephenfang.me/mweb/IMG_1485.jpeg\"></p>\n<p>我的iPod touch</p>\n<p>我的真正意义上的数字生活起始于2010年购买的一台iPod touch (4th genration)。我至今仍清楚记得它的配置：阉割版的A4 芯片、3.5 英寸 Retina 屏幕、iOS 4、聊胜于无的摄像头、8GB的存储空间。当时的我对于 Apple 生态一无所知，同步iPod中的内容也是由一家Apple授权店的小哥帮忙完成。</p>\n<p>在使用iPod touch的过程中，我逐渐熟悉Apple的生态系统，令我记忆深刻的体验有第一次购买付费App，第一次给设备越狱，第一次在设备上玩在线联机游戏、第一次使用云服务等等。在iPod touch之后我对数码产品的兴趣愈发浓厚，且不仅仅限于iOS设备、Android设备，几年间，手中的设备换了一台又一台，安装的App换了一批又一批，我也逐步走进与计算机打交道的行业。</p>\n<h2 id=\"关于App的回忆\"><a href=\"#关于App的回忆\" class=\"headerlink\" title=\"关于App的回忆\"></a>关于App的回忆</h2><p>App Store是Apple生态的一个重要组成部分，相当一部分人选择Apple的平台看重的是优秀的iOS独占App。和很多人一样，我购买iPod touch的理由很大程度上是为了游戏。十年后的今天，我的手机中鲜有游戏，虽然有时也会在闲暇时间与朋友来上两把吃鸡，但是再也不会像以前一样为了打通Angry Birds费尽心思。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg\" alt=\"image.stephenfang.me/mweb/06CBDF84-B70A-4412-8F67-2D3C7CFD4E85.jpeg\"></p>\n<p>iOS 4时代的 App Store</p>\n<p>iOS 4时代的游戏以单机、逻辑简单的小游戏为主，但也不乏许多知名的大作，较为出名的有Infinity Blade系列、Asphalt系列，我当时最喜欢的是Gameloft开发的Rainbow Six手游，其最大的特色就是能够以蓝牙联机的方式与好友对战，还记得每天中午都会和班上的同学去学校的阁楼玩几盘联机游戏。然而Cut the Rope、Fruit Ninja、Angry Birds、Doodle Jump才是我对于那个时期最真实的回忆。</p>\n<h2 id=\"关于效率\"><a href=\"#关于效率\" class=\"headerlink\" title=\"关于效率\"></a>关于效率</h2><p>现在的我会仍会刻意给所有的App分门别类，然而刚接触 iOS 时我总把首屏留给系统默认App，并且总是在结束App的使用后习惯性将它在后台清除，同时我还会出于自己对 Google 的向往，在自己的手机中安装所有 Google 系的App，这些行为在现在看来是相当愚蠢。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg\" alt=\"image.stephenfang.me/mweb/0A5E372C-83FF-429D-8B1D-12749EEB60DE.jpeg\"></p>\n<p>iOS 6时代我的 iPod touch</p>\n<p><img src=\"http://image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg\" alt=\"image.stephenfang.me/mweb/604EE641-9BC7-48BA-BC4B-06DE45144E0A.jpeg\"></p>\n<p>装满所有 Google 系 App 的 iPhone</p>\n<p>首先，更好的应用排布会带来更高的利用效率，试想一下你需要使用某个App记录信息，然而在不使用搜索的情况下每次都要滚动到第二屏，甚至还需要点开一个文件夹才能打开它，还有找不到App的风险，这势必会浪费一部分时间，让你显得手忙脚乱，可能你连需要记录什么都忘了。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/s26872396.jpg\" alt=\"image.stephenfang.me/mweb/s26872396.jpg\"></p>\n<p>山下英子的断舍离封面</p>\n<p>另外一种想法是我在读了《断舍离》这本书后感悟的，首先简要说明这本书的一个重要观点：</p>\n<ul>\n<li>断舍离非常简单，只需要以自己而不是物品为主角，去思考什么东西最适合现在的自己。只要是不符合这两个标准的东西，就立即淘汰或是送人。</li>\n</ul>\n<p>反映在数字生活中即为保留最近需要用到的App，删除不必须要的内容。目前我在我的手机上保留了80个左右的App，显然我不可能每天用到其中的绝大多数App。有统计学的数据显示，智能手机用户平均每个月将会使用超过30个软件，而平均到每天，将会有10个软件被用户登录。</p>\n<p>对于我而言，不会用到的App可以看作是手机的一种“负担”，把它们从我的主屏幕中删除可以看似一种“解脱”，你可以将其看做为一种“伪哲学“，正如许多人对于《断舍离》这本书的看法。时刻保持自己的设备有最高的效率面对工作或学习有如时刻使自己保持清醒的头脑面对生活。</p>\n<h2 id=\"关于正版\"><a href=\"#关于正版\" class=\"headerlink\" title=\"关于正版\"></a>关于正版</h2><p>前几天听说最新版本的 iOS 系统再次能够「越狱」了，然而对此新闻感到兴奋的人寥寥无几。从某种角度来说，「越狱」也是当时导致盗版猖獗的一大原因，然而「越狱」的最重要意义却是让 iOS 设备更具个性化，如 iOS 5 时期我会通过「越狱」去为自己的设备增加通知中心的功能，在 iOS 4 时期我会通过「越狱」给我的iPod touch增加虚拟内存。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg\" alt=\"http://image.stephenfang.me/mweb/223F237B-B3BB-4BF5-8361-F037537C98EC.jpeg\"></p>\n<p>“Jailbreak”界面</p>\n<p><img src=\"http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg\" alt=\"http://image.stephenfang.me/mweb/C215DC38-4A0D-42F6-94A8-37EEE9EBD3C6.jpeg\"></p>\n<p>“奔跑的大菠萝”</p>\n<p>iOS 的付费购买体系目前已经十分成熟，你可以通过各种支付方式获得你需要的App。在没有支付能力的小学时期我可能会为了一款想玩的游戏下载盗版，但我深知这样的想法是错误的，我会告诉自己我需要某一个APP，它为我创造了价值，我乐意为其付费，于是具备消费能力之后我督促自己禁止使用盗版的内容。</p>\n<p>为内容付费是一种闭环，没有投入就没有产出，如果开发者的投入没有回报，很可能导致的结果就是软件停止更新，或比喻为劣币驱逐良币，试想一下应用商店充斥着隐含各种广告的App，相信这种局面都是你我所不愿意看到的。自然，我不会去鄙视用盗版的人，他们很可能是迫不得已，诚然，一些大公司的营收不会因为缺少了一部分人的支出而受重大影响，但我认为用着盗版还大肆夸耀就有些不合情理了。</p>\n<p>微软推出的 Office 365 是一个很有趣的例子，在高中的时候我开始每年为 Office 365 付费，我完全厌倦了 WPS 恼人的广告机制，能够用到正版 Office 令我十分开心，然而这样的行为当时为许多人所不解。近年来使用正版 Office 的成本不断降低，愿意使用正版的人群也逐渐壮大，微软也在努力提升该产品的价值，现在你能够以每年 70多元的价格购买到 Office 套件的全部功能，如果你确定Office能够提供你工作中的便利，那么其价格完全不构成经济上的负担，何况这其中还包括完善的云服务，我认为这是消费者与产品提供商实现的一种协调。当然如果你使用的是Mac，你完全可以用 Apple 的 iWork 套件替代 Office 的工作流，总是有合适的方案替代最坏的使用盗版的方案。你如果觉得购买 Mac 上的 Apps 太贵，可以选择订阅性质的 Setapp，只要你对于设备生产力的界定在“爱奇艺“之上，这些举措都是有意义的。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png\" alt=\"http://image.stephenfang.me/mweb/Xnip2020-04-12_00-33-00.png\"></p>\n<p>采用订阅收费制度的Setapp</p>\n<p>我想表达的并不是一种说教，更多的是一种意识。你可能喜欢观看美剧，但出于各方面原因你无法使用到网飞等平台的服务，但你可以选择的是想办法使用到这种服务，正可谓“办法总比困难多”，或者你可以在某些方面支持你所喜爱的作品。最次的方案则是“偷偷地看“，不是为自己享有盗版而感到自豪。你愿意为一杯奶茶带来的味蕾刺激付费，却不愿意为能够提升你的效率、生活品质的内容而付费，这听起来是不是很荒谬？</p>\n<h2 id=\"关于多样性\"><a href=\"#关于多样性\" class=\"headerlink\" title=\"关于多样性\"></a>关于多样性</h2><p>“如果你想要学习一些自己感兴趣的内容，你必须经历一段痛苦的，学习自己不想学习内容的经历。“这是我对于学习这一件事最真切的感悟。在互联网时代，互联网就是你最好的老师，你可以通过互联网检索到你任何感兴趣的问题的答案，同时你也可以通过互联网学习到任何你想学习的内容，尽管你搜索到的内容很大几率是错误的，且检索到的课程质量可能良莠不齐，但并不影响这个结论的正确性，你需要做的是提高自己辨别正误信息的能力以及提高自己接受新事物的能力。</p>\n<p>回到这段开头这一句话，当你拥有了学习自己所喜欢内容的时间和机会，不应该以“没有空”等类似理由搪塞自己，而应该通过互联网的力量让自己的求知欲得到满足。当你不理解思维导图如何完成就尝试去学习和实践它，当你对咖啡文化感兴趣就去了解它的历史和发展状况，当你充满求知欲时就刷上一天的维基百科。</p>\n<p>我的一位高中同学对任何知识都满怀好奇，无论是他所不熟悉的电竞领域还是他所了解的电影市场，凡是能够引起讨论的内容他都略知一二，我暂且认定他的学习方法称之为“杂学”。起初我对这种学习方式不以为然，认为学习的重要方法在于精而不是杂，渐渐地，我开始觉得这种方式在信息爆炸的年代存在其合理性。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/s1429010.jpg\" alt=\"http://image.stephenfang.me/mweb/s1429010.jpg\"></p>\n<p>许多人的理财启蒙读物——《富爸爸，穷爸爸》</p>\n<p>首先，他的学习内容仍然是以兴趣为第一导向，对于乏味、无用的内容他一概不学，确保了学习过程的积极性和主动性；其次，在阅读了《富爸爸穷爸爸》这本书后，我认为当时我当时的观点与书中穷爸爸对于停留在某种体制内、在某一方面成为专家的观点无异，而书中的富爸爸则倡导学习各方的知识，如财务知识、交谈经验等，这一出发点对该书的作者产生了深刻的影响，促成了其人生中的诸多机会，同时也造就了该书作者的经济地位——这也就是我想说的，求知欲以及交叉学科知识产生的影响。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg\" alt=\"http://image.stephenfang.me/mweb/999FB844-A92A-4852-BA27-6BC0091DCB8C.jpg\"></p>\n<p>12年我的音乐资料库</p>\n<p>人在学习和探索的过程中很可能会推翻许多固有的认知，很多年以前，我曾对日本的音乐抱有偏见，但通过数年对于日本音乐、文化的学习，我了解到坂本龙一、玉置浩二这样的大师，喜爱上re:plus这样的小众乐队，痴迷于押尾光太郎的指弹，见证过Aimer的迅速发展，我所学到的一切都引起了我对日本音乐的尊重。然而不仅仅是音乐，我对很多事物的看法都在互联网的影响下产生很大改观。我在本文最后呼吁大家走出“XX无用论”的泥淖，大胆拥抱新鲜事物，积极表达求知欲望，如尝试「GTD工作法」、「量化自我」等方法将大有裨益，至于某些具体的方法论不在此文中引述，读者可以期待本人未来的分享。</p>\n<h2 id=\"尾声\"><a href=\"#尾声\" class=\"headerlink\" title=\"尾声\"></a>尾声</h2><p>本文至此就告一段落了，显然，笔者想表达的观点和内容还有很多，对于具体的方法论会在之后的文章阐述，还请继续期待和支持。</p>\n<h3 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h3><p><a href=\"https://bi.qq.com/a/20170613/059340.htm\">https://bi.qq.com/a/20170613/059340.htm</a></p>\n<p><a href=\"https://en.wikiversity.org/wiki/10_Principles_of_Economics\">https://en.wikiversity.org/wiki/10_Principles_of_Economics</a></p>\n<p><a href=\"https://www.ifanr.com/app/727935\">https://www.ifanr.com/app/727935</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/s1496668.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:19:06 GMT+0800 (中国标准时间)","title":"数字生活启示录","path":"2020/04/12/Digital_Life/","eyeCatchImage":"http://image.stephenfang.me/mweb/s1496668.jpg","excerpt":"<p>尼古拉·尼葛洛庞帝在他1995年发布的的著作《Being Digital》中描绘了未来数字生活的诸多情景，其中VR、AI、智能家居、个人助理等，无一不是近几年研究的热门领域，这些技术的出现深深影响了现代人的日常生活，换句话说，数字生活成为了当今时代人们生活的一部分。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-11T18:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-11T18:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","数字生活"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":4701},{"title":"iOS 图像处理 App - OpenCV 与 Swift 开发","date":"2020-07-01T01:20:20.000Z","copyright":true,"_content":"\n本篇内容主要包含在 iOS 项目项目中添加 OpenCV 库、Objective-C++ 与 Swift 的结合使用，及桥接文件的添加等等，为 OpenCV 系列的第四篇文章。\n<!--more-->\n\n## 目的\n本学期选修了 OpenCV 相关课程，最后课程设计为完成一个图像去雾功能的小程序。作为一个具备 iOS 相关基础的程序员，我没有选用老师推荐的 Qt 平台，而是选择在 iOS 平台上实现算法的应用。最终实现效果还不错，而其中去雾算法参考了何凯明博士的论文[Kaiming He. Single Image Haze Removal Using Dark Channel Prior](http://kaiminghe.com/publications/cvpr09.pdf)，不在本文的讨论范畴，本文主要对Objective-C++ 与 Swift 的结合开发做一个总结。\n\n## 环境\n- Swift 5\n- iOS 13.4\n- Xcode 11.5\n- OpenCV Framework 4.3.0\n\n## 配置\nOpenCV Package 可以通过以下两种方式添加到 iOS 项目当中：\n\n1. 使用 CocoaPods 添加\nProfile 中添加 OpenCV：\n\n```\ntarget 'Haze-Free' do\n  use_frameworks!\n  pod 'OpenCV'\nend\n```\n\n2.自行下载并添加\n在官网下载相应版本的[iOS Pack](https://opencv.org/releases/)，解压后得到一个 opencv2.framework 库，创建项目并右键添加文件到项目。\n\n## 桥接\nOpenCV 框架由 C++ 进行编码，通过将 C++ 代码插入 Objective-C 就成为了 Objective-C++ 代码。但是 Swift 本身与 Objective-C / Objective-C++ 并不兼容，所以需要一个Bridging Header 将 OpenCV 的功能接口暴露给 Swift。\n以下为简单的示意图。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.18.30.png)\n\n添加一个 Objective-C 文件到项目中将其命名为“OpenCvWrapper”，包含```OpenCvWrapper.h```与```OpenCvWrapper.m```两个文件，需要将文件扩展名“.m”改为“.mm”。如果自动弹出提示是否添加 Bridging-Header 文件选择添加；如果没有提示，则手动添加一个 Bridging-Header 文件，即添加一个头文件（Header file），重命名为“项目名-Bridging-Header.h”（本例中为：Haze-Free-Bridging-Header.h），部分项目结构图如下。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.54.22.png)\n\n## 业务逻辑\n如果你对 C++ 和 Objective-C 有一定了解，那完全能够理解以下的步骤。\n其中 Bridging-Header 对 Objective-C++ 类及方法进行定义，而 OpenCVWrapper 主要面向具体定义的类及方法实现。\n假设我需要对图片进行灰度化处理，需要调用的 OpenCV 函数为\n```c++\ncvtColor(source, target, COLOR_BGR2GRAY);\n```\n我尝试在```OpenCvWrapper.h```中声明实现的方法。\n```c++\n+(UIImage *) makeGary: (UIImage *) image;\n```\n显然 Swift 无法接受 Mat 类型的数据，若需要对图像进行处理并在 View 中显示，需要的是ImageView 获取到 image，换言之，我们需要进行 UIImage 与 Mat 之间的类型转换，而 OpenCV iOS 框架中就做了这样的事情。所以我们的```OpenCvWrapper.mm```看起来会是这样。\n\n```c++\n#import <opencv2/opencv.hpp>\n#import <opencv2/imgcodecs/ios.h>\n#import \"OpenCvWrapper.h\"\n\nusing namespace cv;\n\n@implementation OpenCvWrapper\n\n+(UIImage *) makeGary: (UIImage *) image\n{\n    Mat source,target;\n    UIImageToMat(image,source);\n    \n    if(source.channels() == 1) return image;\n    cvtColor(source, target, COLOR_BGR2GRAY);\n    \n    return MatToUIImage(target);\n}\n@end\n```\n接下来需要做的事情就轻车熟路了，只需要通过```OpenCvWrapper.makeGary(image)```方法即可返回一个经过处理的 UIImage 对象。\n\n## 改进\n我给予了 Haze-Free 图像处理App三种图像处理功能，分别是去雾、灰度化与中值滤波，考虑到处理图像本身需要一定的等待时间，我添加了 UIActivityIndicatorView 并放置了一个无法交互的 UIView 在需要的时候出现，同时 GCD 也可以加以运用，以下为部分改进后的代码。\n```swift\n    private let queue = DispatchQueue(label: \"process-queue\", qos: .userInitiated)\n    \n    enum ProcessType {\n        case toGrayScale, toHazeFree, toSoftFilter\n    }\n\n   override func viewWillAppear(_ animated: Bool) {\n        super.viewWillAppear(true)\n        self.loadingOverlayView.isHidden = true\n    }\n    \n    @IBAction func toGrayScale(_ sender: Any) {\n        processImage(withType: .toGrayScale)\n    }\n    \n    @IBAction func toHazeFree(_ sender: Any) {\n        processImage(withType: .toHazeFree)\n    }\n    \n    @IBAction func toSoftFilter(_ sender: Any) {\n        processImage(withType: .toSoftFilter)\n    }\n    \n    private func processImage(withType type: ProcessType) {\n        self.loadingOverlayView.isHidden = false\n        let image = self.demoImageView.image!\n        queue.async {\n            let processed: UIImage\n            switch type {\n            case .toHazeFree:\n                processed = OpenCvWrapper.hazeFree(image)\n            case .toSoftFilter:\n                processed = OpenCvWrapper.softFilter(image)\n            case .toGrayScale:\n                processed = OpenCvWrapper.makeGary(image)\n            }\n            self.processed = processed\n            DispatchQueue.main.async {\n                self.performSegue(withIdentifier: \"SavingPhoto\", sender: nil)\n            }\n        }\n    }\n```\n\n## 错误\n在写 App 的过程中遇到了一个重大问题，去雾算法验证无误后始终无法得到正确的去雾图像，于是开始对去雾步骤中所有的阶段性图像打断点，一一验证得到的图像结果。最后根据StackOverFlow 上的解释以及断点结果查明了原因，原因出在 ```UIImageToMat``` 方法返回的Mat 类型上。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.40.11.png)\n```UIImageToMat``` 方法返回的Mat类型为 ```CV_8UC4```，而程序中需要的 Mat 格式为 ```CV_8UC3```，需要使用```cvtColor()``` 方法对其进行转换，改正后程序正常运行。\n在使用 SFSymbols 时遇到了一些bug，UIButton的 image 使用 SFSymbol出现了无法显示Background 的问题，Debug View Hierarchy也看不出来名堂，最后只好换了自定义的icon。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.25.png)\n\n\n## App 总结\n### UI总结\n研究了iOS的设计原则后，针对该程序设计了以下页面，包含欢迎页面、权限获取页面、图像浏览页面、图像处理页面与图像分享页面，尽最大程度减少不同页面之间的耦合，使整体的页面逻辑更加清晰。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.56.25.png)\n在对iOS开发框架进行实践后，为 App 增加了中值滤波和灰度转换的功能，同时嵌入了Unsplash 获取图像的SDK，使得程序不仅能够从相册、相机获取图像，还能够直接从 Unsplash 无版权图像网站通过关键字检索获取图像。同时新增了图像分享的入口。为了适应新的变化将页面进行了部分重组，使其更加符合开发需求。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.58.22.png)\n未来可能会考虑将该项目进行开源，现阶段仍然希望其具备更多的功能，以下为软件的运行测试。\n\n### 页面逻辑\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.44.23.png)\n- 开启App后进入引导页面，提示用户使用该App需遵守相关用户协议。\n- 点击开始处理后跳转至第二个页面，页面显示提示需要选择图像\n- 点击选择图像后，用户需要在三种图像获取图形中做出选择，或选择取消\n\n### 运行测试\n\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.46.41.png)\n- 处理相册图片实例，点选最近拍摄的照片，程序在本视图中加载此图像\n- 点击三个处理按钮中的最右者，即中值滤波效果，视图会进行跳转\n- 新的视图包含了保存和分享图像的功能，若点击保存，程序会将图像写入相册并告知用户\n\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.50.png)\n- 尝试从相册加载一张新图像，可以看到图像中的树林被雾霾覆盖\n- 点击最左侧的去雾操作，由于去雾操作运算量较大，并且为了避免用户在运算过程中点按按钮，整个可操作区域不可点按，同时有活动指示环展示加载进度\n- 需要注意的是三个图像操作都采用了多线程的方式\n- 处理完成图像后可以点击分享按钮使用系统内建的分享服务进行图像的分享\n\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.54.28.png)\n- 尝试从相机拍摄一张图像\n- 点击拍摄按钮后图像被获取，可以使用该图像进行处理\n- 在视图中加载图像后尝试点击中间的灰度化图像处理\n- 图像灰度化操作完成可以预览效果和保存、分享\n\n\n\n## 参考\n[1] Kaiming He. Single Image Haze Removal Using Dark Channel Prior [D]. 2009,CVPR\n[2] Alexander Shishkov, Kirill Kornyakov. Instant OpenCV for iOS (English Edition) [M]. Packt Publishing, 2013\n[3] Matthijs Hollemans. The iOS Apprentice [M]. Razeware LLC, 2014\n","source":"_posts/Haze-Free.md","raw":"---\ntitle: iOS 图像处理 App - OpenCV 与 Swift 开发\ndate: 2020-07-01 09:20:20\ncategories: \n- 技术\ntags: \n- iOS\n- OpenCV\n- Swift\ncopyright: true\n---\n\n本篇内容主要包含在 iOS 项目项目中添加 OpenCV 库、Objective-C++ 与 Swift 的结合使用，及桥接文件的添加等等，为 OpenCV 系列的第四篇文章。\n<!--more-->\n\n## 目的\n本学期选修了 OpenCV 相关课程，最后课程设计为完成一个图像去雾功能的小程序。作为一个具备 iOS 相关基础的程序员，我没有选用老师推荐的 Qt 平台，而是选择在 iOS 平台上实现算法的应用。最终实现效果还不错，而其中去雾算法参考了何凯明博士的论文[Kaiming He. Single Image Haze Removal Using Dark Channel Prior](http://kaiminghe.com/publications/cvpr09.pdf)，不在本文的讨论范畴，本文主要对Objective-C++ 与 Swift 的结合开发做一个总结。\n\n## 环境\n- Swift 5\n- iOS 13.4\n- Xcode 11.5\n- OpenCV Framework 4.3.0\n\n## 配置\nOpenCV Package 可以通过以下两种方式添加到 iOS 项目当中：\n\n1. 使用 CocoaPods 添加\nProfile 中添加 OpenCV：\n\n```\ntarget 'Haze-Free' do\n  use_frameworks!\n  pod 'OpenCV'\nend\n```\n\n2.自行下载并添加\n在官网下载相应版本的[iOS Pack](https://opencv.org/releases/)，解压后得到一个 opencv2.framework 库，创建项目并右键添加文件到项目。\n\n## 桥接\nOpenCV 框架由 C++ 进行编码，通过将 C++ 代码插入 Objective-C 就成为了 Objective-C++ 代码。但是 Swift 本身与 Objective-C / Objective-C++ 并不兼容，所以需要一个Bridging Header 将 OpenCV 的功能接口暴露给 Swift。\n以下为简单的示意图。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.18.30.png)\n\n添加一个 Objective-C 文件到项目中将其命名为“OpenCvWrapper”，包含```OpenCvWrapper.h```与```OpenCvWrapper.m```两个文件，需要将文件扩展名“.m”改为“.mm”。如果自动弹出提示是否添加 Bridging-Header 文件选择添加；如果没有提示，则手动添加一个 Bridging-Header 文件，即添加一个头文件（Header file），重命名为“项目名-Bridging-Header.h”（本例中为：Haze-Free-Bridging-Header.h），部分项目结构图如下。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.54.22.png)\n\n## 业务逻辑\n如果你对 C++ 和 Objective-C 有一定了解，那完全能够理解以下的步骤。\n其中 Bridging-Header 对 Objective-C++ 类及方法进行定义，而 OpenCVWrapper 主要面向具体定义的类及方法实现。\n假设我需要对图片进行灰度化处理，需要调用的 OpenCV 函数为\n```c++\ncvtColor(source, target, COLOR_BGR2GRAY);\n```\n我尝试在```OpenCvWrapper.h```中声明实现的方法。\n```c++\n+(UIImage *) makeGary: (UIImage *) image;\n```\n显然 Swift 无法接受 Mat 类型的数据，若需要对图像进行处理并在 View 中显示，需要的是ImageView 获取到 image，换言之，我们需要进行 UIImage 与 Mat 之间的类型转换，而 OpenCV iOS 框架中就做了这样的事情。所以我们的```OpenCvWrapper.mm```看起来会是这样。\n\n```c++\n#import <opencv2/opencv.hpp>\n#import <opencv2/imgcodecs/ios.h>\n#import \"OpenCvWrapper.h\"\n\nusing namespace cv;\n\n@implementation OpenCvWrapper\n\n+(UIImage *) makeGary: (UIImage *) image\n{\n    Mat source,target;\n    UIImageToMat(image,source);\n    \n    if(source.channels() == 1) return image;\n    cvtColor(source, target, COLOR_BGR2GRAY);\n    \n    return MatToUIImage(target);\n}\n@end\n```\n接下来需要做的事情就轻车熟路了，只需要通过```OpenCvWrapper.makeGary(image)```方法即可返回一个经过处理的 UIImage 对象。\n\n## 改进\n我给予了 Haze-Free 图像处理App三种图像处理功能，分别是去雾、灰度化与中值滤波，考虑到处理图像本身需要一定的等待时间，我添加了 UIActivityIndicatorView 并放置了一个无法交互的 UIView 在需要的时候出现，同时 GCD 也可以加以运用，以下为部分改进后的代码。\n```swift\n    private let queue = DispatchQueue(label: \"process-queue\", qos: .userInitiated)\n    \n    enum ProcessType {\n        case toGrayScale, toHazeFree, toSoftFilter\n    }\n\n   override func viewWillAppear(_ animated: Bool) {\n        super.viewWillAppear(true)\n        self.loadingOverlayView.isHidden = true\n    }\n    \n    @IBAction func toGrayScale(_ sender: Any) {\n        processImage(withType: .toGrayScale)\n    }\n    \n    @IBAction func toHazeFree(_ sender: Any) {\n        processImage(withType: .toHazeFree)\n    }\n    \n    @IBAction func toSoftFilter(_ sender: Any) {\n        processImage(withType: .toSoftFilter)\n    }\n    \n    private func processImage(withType type: ProcessType) {\n        self.loadingOverlayView.isHidden = false\n        let image = self.demoImageView.image!\n        queue.async {\n            let processed: UIImage\n            switch type {\n            case .toHazeFree:\n                processed = OpenCvWrapper.hazeFree(image)\n            case .toSoftFilter:\n                processed = OpenCvWrapper.softFilter(image)\n            case .toGrayScale:\n                processed = OpenCvWrapper.makeGary(image)\n            }\n            self.processed = processed\n            DispatchQueue.main.async {\n                self.performSegue(withIdentifier: \"SavingPhoto\", sender: nil)\n            }\n        }\n    }\n```\n\n## 错误\n在写 App 的过程中遇到了一个重大问题，去雾算法验证无误后始终无法得到正确的去雾图像，于是开始对去雾步骤中所有的阶段性图像打断点，一一验证得到的图像结果。最后根据StackOverFlow 上的解释以及断点结果查明了原因，原因出在 ```UIImageToMat``` 方法返回的Mat 类型上。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.40.11.png)\n```UIImageToMat``` 方法返回的Mat类型为 ```CV_8UC4```，而程序中需要的 Mat 格式为 ```CV_8UC3```，需要使用```cvtColor()``` 方法对其进行转换，改正后程序正常运行。\n在使用 SFSymbols 时遇到了一些bug，UIButton的 image 使用 SFSymbol出现了无法显示Background 的问题，Debug View Hierarchy也看不出来名堂，最后只好换了自定义的icon。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.25.png)\n\n\n## App 总结\n### UI总结\n研究了iOS的设计原则后，针对该程序设计了以下页面，包含欢迎页面、权限获取页面、图像浏览页面、图像处理页面与图像分享页面，尽最大程度减少不同页面之间的耦合，使整体的页面逻辑更加清晰。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.56.25.png)\n在对iOS开发框架进行实践后，为 App 增加了中值滤波和灰度转换的功能，同时嵌入了Unsplash 获取图像的SDK，使得程序不仅能够从相册、相机获取图像，还能够直接从 Unsplash 无版权图像网站通过关键字检索获取图像。同时新增了图像分享的入口。为了适应新的变化将页面进行了部分重组，使其更加符合开发需求。\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.58.22.png)\n未来可能会考虑将该项目进行开源，现阶段仍然希望其具备更多的功能，以下为软件的运行测试。\n\n### 页面逻辑\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.44.23.png)\n- 开启App后进入引导页面，提示用户使用该App需遵守相关用户协议。\n- 点击开始处理后跳转至第二个页面，页面显示提示需要选择图像\n- 点击选择图像后，用户需要在三种图像获取图形中做出选择，或选择取消\n\n### 运行测试\n\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.46.41.png)\n- 处理相册图片实例，点选最近拍摄的照片，程序在本视图中加载此图像\n- 点击三个处理按钮中的最右者，即中值滤波效果，视图会进行跳转\n- 新的视图包含了保存和分享图像的功能，若点击保存，程序会将图像写入相册并告知用户\n\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.50.png)\n- 尝试从相册加载一张新图像，可以看到图像中的树林被雾霾覆盖\n- 点击最左侧的去雾操作，由于去雾操作运算量较大，并且为了避免用户在运算过程中点按按钮，整个可操作区域不可点按，同时有活动指示环展示加载进度\n- 需要注意的是三个图像操作都采用了多线程的方式\n- 处理完成图像后可以点击分享按钮使用系统内建的分享服务进行图像的分享\n\n![](http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.54.28.png)\n- 尝试从相机拍摄一张图像\n- 点击拍摄按钮后图像被获取，可以使用该图像进行处理\n- 在视图中加载图像后尝试点击中间的灰度化图像处理\n- 图像灰度化操作完成可以预览效果和保存、分享\n\n\n\n## 参考\n[1] Kaiming He. Single Image Haze Removal Using Dark Channel Prior [D]. 2009,CVPR\n[2] Alexander Shishkov, Kirill Kornyakov. Instant OpenCV for iOS (English Edition) [M]. Packt Publishing, 2013\n[3] Matthijs Hollemans. The iOS Apprentice [M]. Razeware LLC, 2014\n","slug":"Haze-Free","published":1,"updated":"2022-07-24T15:19:44.478Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1q000jo76f5spw3w86","content":"<p>本篇内容主要包含在 iOS 项目项目中添加 OpenCV 库、Objective-C++ 与 Swift 的结合使用，及桥接文件的添加等等，为 OpenCV 系列的第四篇文章。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"目的\"><a href=\"#目的\" class=\"headerlink\" title=\"目的\"></a>目的</h2><p>本学期选修了 OpenCV 相关课程，最后课程设计为完成一个图像去雾功能的小程序。作为一个具备 iOS 相关基础的程序员，我没有选用老师推荐的 Qt 平台，而是选择在 iOS 平台上实现算法的应用。最终实现效果还不错，而其中去雾算法参考了何凯明博士的论文<a href=\"http://kaiminghe.com/publications/cvpr09.pdf\">Kaiming He. Single Image Haze Removal Using Dark Channel Prior</a>，不在本文的讨论范畴，本文主要对Objective-C++ 与 Swift 的结合开发做一个总结。</p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li>Swift 5</li>\n<li>iOS 13.4</li>\n<li>Xcode 11.5</li>\n<li>OpenCV Framework 4.3.0</li>\n</ul>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>OpenCV Package 可以通过以下两种方式添加到 iOS 项目当中：</p>\n<ol>\n<li>使用 CocoaPods 添加<br>Profile 中添加 OpenCV：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target &#x27;Haze-Free&#x27; do</span><br><span class=\"line\">  use_frameworks!</span><br><span class=\"line\">  pod &#x27;OpenCV&#x27;</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<p>2.自行下载并添加<br>在官网下载相应版本的<a href=\"https://opencv.org/releases/\">iOS Pack</a>，解压后得到一个 opencv2.framework 库，创建项目并右键添加文件到项目。</p>\n<h2 id=\"桥接\"><a href=\"#桥接\" class=\"headerlink\" title=\"桥接\"></a>桥接</h2><p>OpenCV 框架由 C++ 进行编码，通过将 C++ 代码插入 Objective-C 就成为了 Objective-C++ 代码。但是 Swift 本身与 Objective-C / Objective-C++ 并不兼容，所以需要一个Bridging Header 将 OpenCV 的功能接口暴露给 Swift。<br>以下为简单的示意图。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.18.30.png\"></p>\n<p>添加一个 Objective-C 文件到项目中将其命名为“OpenCvWrapper”，包含<code>OpenCvWrapper.h</code>与<code>OpenCvWrapper.m</code>两个文件，需要将文件扩展名“.m”改为“.mm”。如果自动弹出提示是否添加 Bridging-Header 文件选择添加；如果没有提示，则手动添加一个 Bridging-Header 文件，即添加一个头文件（Header file），重命名为“项目名-Bridging-Header.h”（本例中为：Haze-Free-Bridging-Header.h），部分项目结构图如下。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.54.22.png\"></p>\n<h2 id=\"业务逻辑\"><a href=\"#业务逻辑\" class=\"headerlink\" title=\"业务逻辑\"></a>业务逻辑</h2><p>如果你对 C++ 和 Objective-C 有一定了解，那完全能够理解以下的步骤。<br>其中 Bridging-Header 对 Objective-C++ 类及方法进行定义，而 OpenCVWrapper 主要面向具体定义的类及方法实现。<br>假设我需要对图片进行灰度化处理，需要调用的 OpenCV 函数为</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cvtColor</span>(source, target, COLOR_BGR2GRAY);</span><br></pre></td></tr></table></figure>\n<p>我尝试在<code>OpenCvWrapper.h</code>中声明实现的方法。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+(UIImage *) makeGary: (UIImage *) image;</span><br></pre></td></tr></table></figure>\n<p>显然 Swift 无法接受 Mat 类型的数据，若需要对图像进行处理并在 View 中显示，需要的是ImageView 获取到 image，换言之，我们需要进行 UIImage 与 Mat 之间的类型转换，而 OpenCV iOS 框架中就做了这样的事情。所以我们的<code>OpenCvWrapper.mm</code>看起来会是这样。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;opencv2/imgcodecs/ios.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;OpenCvWrapper.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> cv;</span><br><span class=\"line\"></span><br><span class=\"line\">@implementation OpenCvWrapper</span><br><span class=\"line\"></span><br><span class=\"line\">+(UIImage *) makeGary: (UIImage *) image</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Mat source,target;</span><br><span class=\"line\">    <span class=\"built_in\">UIImageToMat</span>(image,source);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(source.<span class=\"built_in\">channels</span>() == <span class=\"number\">1</span>) <span class=\"keyword\">return</span> image;</span><br><span class=\"line\">    <span class=\"built_in\">cvtColor</span>(source, target, COLOR_BGR2GRAY);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">MatToUIImage</span>(target);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@end</span><br></pre></td></tr></table></figure>\n<p>接下来需要做的事情就轻车熟路了，只需要通过<code>OpenCvWrapper.makeGary(image)</code>方法即可返回一个经过处理的 UIImage 对象。</p>\n<h2 id=\"改进\"><a href=\"#改进\" class=\"headerlink\" title=\"改进\"></a>改进</h2><p>我给予了 Haze-Free 图像处理App三种图像处理功能，分别是去雾、灰度化与中值滤波，考虑到处理图像本身需要一定的等待时间，我添加了 UIActivityIndicatorView 并放置了一个无法交互的 UIView 在需要的时候出现，同时 GCD 也可以加以运用，以下为部分改进后的代码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> queue <span class=\"operator\">=</span> <span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">&quot;process-queue&quot;</span>, qos: .userInitiated)</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">ProcessType</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> toGrayScale, toHazeFree, toSoftFilter</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewWillAppear</span>(<span class=\"keyword\">_</span> <span class=\"params\">animated</span>: <span class=\"type\">Bool</span>)</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">super</span>.viewWillAppear(<span class=\"literal\">true</span>)</span><br><span class=\"line\">     <span class=\"keyword\">self</span>.loadingOverlayView.isHidden <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toGrayScale</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"keyword\">Any</span>)</span> &#123;</span><br><span class=\"line\">     processImage(withType: .toGrayScale)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toHazeFree</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"keyword\">Any</span>)</span> &#123;</span><br><span class=\"line\">     processImage(withType: .toHazeFree)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toSoftFilter</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"keyword\">Any</span>)</span> &#123;</span><br><span class=\"line\">     processImage(withType: .toSoftFilter)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">processImage</span>(<span class=\"params\">withType</span> <span class=\"params\">type</span>: <span class=\"type\">ProcessType</span>)</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">self</span>.loadingOverlayView.isHidden <span class=\"operator\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">     <span class=\"keyword\">let</span> image <span class=\"operator\">=</span> <span class=\"keyword\">self</span>.demoImageView.image<span class=\"operator\">!</span></span><br><span class=\"line\">     queue.async &#123;</span><br><span class=\"line\">         <span class=\"keyword\">let</span> processed: <span class=\"type\">UIImage</span></span><br><span class=\"line\">         <span class=\"keyword\">switch</span> type &#123;</span><br><span class=\"line\">         <span class=\"keyword\">case</span> .toHazeFree:</span><br><span class=\"line\">             processed <span class=\"operator\">=</span> <span class=\"type\">OpenCvWrapper</span>.hazeFree(image)</span><br><span class=\"line\">         <span class=\"keyword\">case</span> .toSoftFilter:</span><br><span class=\"line\">             processed <span class=\"operator\">=</span> <span class=\"type\">OpenCvWrapper</span>.softFilter(image)</span><br><span class=\"line\">         <span class=\"keyword\">case</span> .toGrayScale:</span><br><span class=\"line\">             processed <span class=\"operator\">=</span> <span class=\"type\">OpenCvWrapper</span>.makeGary(image)</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"keyword\">self</span>.processed <span class=\"operator\">=</span> processed</span><br><span class=\"line\">         <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">             <span class=\"keyword\">self</span>.performSegue(withIdentifier: <span class=\"string\">&quot;SavingPhoto&quot;</span>, sender: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><p>在写 App 的过程中遇到了一个重大问题，去雾算法验证无误后始终无法得到正确的去雾图像，于是开始对去雾步骤中所有的阶段性图像打断点，一一验证得到的图像结果。最后根据StackOverFlow 上的解释以及断点结果查明了原因，原因出在 <code>UIImageToMat</code> 方法返回的Mat 类型上。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.40.11.png\"><br><code>UIImageToMat</code> 方法返回的Mat类型为 <code>CV_8UC4</code>，而程序中需要的 Mat 格式为 <code>CV_8UC3</code>，需要使用<code>cvtColor()</code> 方法对其进行转换，改正后程序正常运行。<br>在使用 SFSymbols 时遇到了一些bug，UIButton的 image 使用 SFSymbol出现了无法显示Background 的问题，Debug View Hierarchy也看不出来名堂，最后只好换了自定义的icon。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.25.png\"></p>\n<h2 id=\"App-总结\"><a href=\"#App-总结\" class=\"headerlink\" title=\"App 总结\"></a>App 总结</h2><h3 id=\"UI总结\"><a href=\"#UI总结\" class=\"headerlink\" title=\"UI总结\"></a>UI总结</h3><p>研究了iOS的设计原则后，针对该程序设计了以下页面，包含欢迎页面、权限获取页面、图像浏览页面、图像处理页面与图像分享页面，尽最大程度减少不同页面之间的耦合，使整体的页面逻辑更加清晰。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.56.25.png\"><br>在对iOS开发框架进行实践后，为 App 增加了中值滤波和灰度转换的功能，同时嵌入了Unsplash 获取图像的SDK，使得程序不仅能够从相册、相机获取图像，还能够直接从 Unsplash 无版权图像网站通过关键字检索获取图像。同时新增了图像分享的入口。为了适应新的变化将页面进行了部分重组，使其更加符合开发需求。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.58.22.png\"><br>未来可能会考虑将该项目进行开源，现阶段仍然希望其具备更多的功能，以下为软件的运行测试。</p>\n<h3 id=\"页面逻辑\"><a href=\"#页面逻辑\" class=\"headerlink\" title=\"页面逻辑\"></a>页面逻辑</h3><p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.44.23.png\"></p>\n<ul>\n<li>开启App后进入引导页面，提示用户使用该App需遵守相关用户协议。</li>\n<li>点击开始处理后跳转至第二个页面，页面显示提示需要选择图像</li>\n<li>点击选择图像后，用户需要在三种图像获取图形中做出选择，或选择取消</li>\n</ul>\n<h3 id=\"运行测试\"><a href=\"#运行测试\" class=\"headerlink\" title=\"运行测试\"></a>运行测试</h3><p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.46.41.png\"></p>\n<ul>\n<li>处理相册图片实例，点选最近拍摄的照片，程序在本视图中加载此图像</li>\n<li>点击三个处理按钮中的最右者，即中值滤波效果，视图会进行跳转</li>\n<li>新的视图包含了保存和分享图像的功能，若点击保存，程序会将图像写入相册并告知用户</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.50.png\"></p>\n<ul>\n<li>尝试从相册加载一张新图像，可以看到图像中的树林被雾霾覆盖</li>\n<li>点击最左侧的去雾操作，由于去雾操作运算量较大，并且为了避免用户在运算过程中点按按钮，整个可操作区域不可点按，同时有活动指示环展示加载进度</li>\n<li>需要注意的是三个图像操作都采用了多线程的方式</li>\n<li>处理完成图像后可以点击分享按钮使用系统内建的分享服务进行图像的分享</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.54.28.png\"></p>\n<ul>\n<li>尝试从相机拍摄一张图像</li>\n<li>点击拍摄按钮后图像被获取，可以使用该图像进行处理</li>\n<li>在视图中加载图像后尝试点击中间的灰度化图像处理</li>\n<li>图像灰度化操作完成可以预览效果和保存、分享</li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p>[1] Kaiming He. Single Image Haze Removal Using Dark Channel Prior [D]. 2009,CVPR<br>[2] Alexander Shishkov, Kirill Kornyakov. Instant OpenCV for iOS (English Edition) [M]. Packt Publishing, 2013<br>[3] Matthijs Hollemans. The iOS Apprentice [M]. Razeware LLC, 2014</p>\n","site":{"data":{}},"excerpt":"<p>本篇内容主要包含在 iOS 项目项目中添加 OpenCV 库、Objective-C++ 与 Swift 的结合使用，及桥接文件的添加等等，为 OpenCV 系列的第四篇文章。</p>","more":"<h2 id=\"目的\"><a href=\"#目的\" class=\"headerlink\" title=\"目的\"></a>目的</h2><p>本学期选修了 OpenCV 相关课程，最后课程设计为完成一个图像去雾功能的小程序。作为一个具备 iOS 相关基础的程序员，我没有选用老师推荐的 Qt 平台，而是选择在 iOS 平台上实现算法的应用。最终实现效果还不错，而其中去雾算法参考了何凯明博士的论文<a href=\"http://kaiminghe.com/publications/cvpr09.pdf\">Kaiming He. Single Image Haze Removal Using Dark Channel Prior</a>，不在本文的讨论范畴，本文主要对Objective-C++ 与 Swift 的结合开发做一个总结。</p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li>Swift 5</li>\n<li>iOS 13.4</li>\n<li>Xcode 11.5</li>\n<li>OpenCV Framework 4.3.0</li>\n</ul>\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>OpenCV Package 可以通过以下两种方式添加到 iOS 项目当中：</p>\n<ol>\n<li>使用 CocoaPods 添加<br>Profile 中添加 OpenCV：</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">target &#x27;Haze-Free&#x27; do</span><br><span class=\"line\">  use_frameworks!</span><br><span class=\"line\">  pod &#x27;OpenCV&#x27;</span><br><span class=\"line\">end</span><br></pre></td></tr></table></figure>\n\n<p>2.自行下载并添加<br>在官网下载相应版本的<a href=\"https://opencv.org/releases/\">iOS Pack</a>，解压后得到一个 opencv2.framework 库，创建项目并右键添加文件到项目。</p>\n<h2 id=\"桥接\"><a href=\"#桥接\" class=\"headerlink\" title=\"桥接\"></a>桥接</h2><p>OpenCV 框架由 C++ 进行编码，通过将 C++ 代码插入 Objective-C 就成为了 Objective-C++ 代码。但是 Swift 本身与 Objective-C / Objective-C++ 并不兼容，所以需要一个Bridging Header 将 OpenCV 的功能接口暴露给 Swift。<br>以下为简单的示意图。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.18.30.png\"></p>\n<p>添加一个 Objective-C 文件到项目中将其命名为“OpenCvWrapper”，包含<code>OpenCvWrapper.h</code>与<code>OpenCvWrapper.m</code>两个文件，需要将文件扩展名“.m”改为“.mm”。如果自动弹出提示是否添加 Bridging-Header 文件选择添加；如果没有提示，则手动添加一个 Bridging-Header 文件，即添加一个头文件（Header file），重命名为“项目名-Bridging-Header.h”（本例中为：Haze-Free-Bridging-Header.h），部分项目结构图如下。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.54.22.png\"></p>\n<h2 id=\"业务逻辑\"><a href=\"#业务逻辑\" class=\"headerlink\" title=\"业务逻辑\"></a>业务逻辑</h2><p>如果你对 C++ 和 Objective-C 有一定了解，那完全能够理解以下的步骤。<br>其中 Bridging-Header 对 Objective-C++ 类及方法进行定义，而 OpenCVWrapper 主要面向具体定义的类及方法实现。<br>假设我需要对图片进行灰度化处理，需要调用的 OpenCV 函数为</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">cvtColor</span>(source, target, COLOR_BGR2GRAY);</span><br></pre></td></tr></table></figure>\n<p>我尝试在<code>OpenCvWrapper.h</code>中声明实现的方法。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+(UIImage *) makeGary: (UIImage *) image;</span><br></pre></td></tr></table></figure>\n<p>显然 Swift 无法接受 Mat 类型的数据，若需要对图像进行处理并在 View 中显示，需要的是ImageView 获取到 image，换言之，我们需要进行 UIImage 与 Mat 之间的类型转换，而 OpenCV iOS 框架中就做了这样的事情。所以我们的<code>OpenCvWrapper.mm</code>看起来会是这样。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;opencv2/imgcodecs/ios.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;OpenCvWrapper.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> cv;</span><br><span class=\"line\"></span><br><span class=\"line\">@implementation OpenCvWrapper</span><br><span class=\"line\"></span><br><span class=\"line\">+(UIImage *) makeGary: (UIImage *) image</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Mat source,target;</span><br><span class=\"line\">    <span class=\"built_in\">UIImageToMat</span>(image,source);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span>(source.<span class=\"built_in\">channels</span>() == <span class=\"number\">1</span>) <span class=\"keyword\">return</span> image;</span><br><span class=\"line\">    <span class=\"built_in\">cvtColor</span>(source, target, COLOR_BGR2GRAY);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">MatToUIImage</span>(target);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">@end</span><br></pre></td></tr></table></figure>\n<p>接下来需要做的事情就轻车熟路了，只需要通过<code>OpenCvWrapper.makeGary(image)</code>方法即可返回一个经过处理的 UIImage 对象。</p>\n<h2 id=\"改进\"><a href=\"#改进\" class=\"headerlink\" title=\"改进\"></a>改进</h2><p>我给予了 Haze-Free 图像处理App三种图像处理功能，分别是去雾、灰度化与中值滤波，考虑到处理图像本身需要一定的等待时间，我添加了 UIActivityIndicatorView 并放置了一个无法交互的 UIView 在需要的时候出现，同时 GCD 也可以加以运用，以下为部分改进后的代码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> queue <span class=\"operator\">=</span> <span class=\"type\">DispatchQueue</span>(label: <span class=\"string\">&quot;process-queue&quot;</span>, qos: .userInitiated)</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">ProcessType</span> </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">case</span> toGrayScale, toHazeFree, toSoftFilter</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewWillAppear</span>(<span class=\"keyword\">_</span> <span class=\"params\">animated</span>: <span class=\"type\">Bool</span>)</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">super</span>.viewWillAppear(<span class=\"literal\">true</span>)</span><br><span class=\"line\">     <span class=\"keyword\">self</span>.loadingOverlayView.isHidden <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toGrayScale</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"keyword\">Any</span>)</span> &#123;</span><br><span class=\"line\">     processImage(withType: .toGrayScale)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toHazeFree</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"keyword\">Any</span>)</span> &#123;</span><br><span class=\"line\">     processImage(withType: .toHazeFree)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">@IBAction</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">toSoftFilter</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"keyword\">Any</span>)</span> &#123;</span><br><span class=\"line\">     processImage(withType: .toSoftFilter)</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\"> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">processImage</span>(<span class=\"params\">withType</span> <span class=\"params\">type</span>: <span class=\"type\">ProcessType</span>)</span> &#123;</span><br><span class=\"line\">     <span class=\"keyword\">self</span>.loadingOverlayView.isHidden <span class=\"operator\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">     <span class=\"keyword\">let</span> image <span class=\"operator\">=</span> <span class=\"keyword\">self</span>.demoImageView.image<span class=\"operator\">!</span></span><br><span class=\"line\">     queue.async &#123;</span><br><span class=\"line\">         <span class=\"keyword\">let</span> processed: <span class=\"type\">UIImage</span></span><br><span class=\"line\">         <span class=\"keyword\">switch</span> type &#123;</span><br><span class=\"line\">         <span class=\"keyword\">case</span> .toHazeFree:</span><br><span class=\"line\">             processed <span class=\"operator\">=</span> <span class=\"type\">OpenCvWrapper</span>.hazeFree(image)</span><br><span class=\"line\">         <span class=\"keyword\">case</span> .toSoftFilter:</span><br><span class=\"line\">             processed <span class=\"operator\">=</span> <span class=\"type\">OpenCvWrapper</span>.softFilter(image)</span><br><span class=\"line\">         <span class=\"keyword\">case</span> .toGrayScale:</span><br><span class=\"line\">             processed <span class=\"operator\">=</span> <span class=\"type\">OpenCvWrapper</span>.makeGary(image)</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">         <span class=\"keyword\">self</span>.processed <span class=\"operator\">=</span> processed</span><br><span class=\"line\">         <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">             <span class=\"keyword\">self</span>.performSegue(withIdentifier: <span class=\"string\">&quot;SavingPhoto&quot;</span>, sender: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"错误\"><a href=\"#错误\" class=\"headerlink\" title=\"错误\"></a>错误</h2><p>在写 App 的过程中遇到了一个重大问题，去雾算法验证无误后始终无法得到正确的去雾图像，于是开始对去雾步骤中所有的阶段性图像打断点，一一验证得到的图像结果。最后根据StackOverFlow 上的解释以及断点结果查明了原因，原因出在 <code>UIImageToMat</code> 方法返回的Mat 类型上。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.40.11.png\"><br><code>UIImageToMat</code> 方法返回的Mat类型为 <code>CV_8UC4</code>，而程序中需要的 Mat 格式为 <code>CV_8UC3</code>，需要使用<code>cvtColor()</code> 方法对其进行转换，改正后程序正常运行。<br>在使用 SFSymbols 时遇到了一些bug，UIButton的 image 使用 SFSymbol出现了无法显示Background 的问题，Debug View Hierarchy也看不出来名堂，最后只好换了自定义的icon。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.25.png\"></p>\n<h2 id=\"App-总结\"><a href=\"#App-总结\" class=\"headerlink\" title=\"App 总结\"></a>App 总结</h2><h3 id=\"UI总结\"><a href=\"#UI总结\" class=\"headerlink\" title=\"UI总结\"></a>UI总结</h3><p>研究了iOS的设计原则后，针对该程序设计了以下页面，包含欢迎页面、权限获取页面、图像浏览页面、图像处理页面与图像分享页面，尽最大程度减少不同页面之间的耦合，使整体的页面逻辑更加清晰。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.56.25.png\"><br>在对iOS开发框架进行实践后，为 App 增加了中值滤波和灰度转换的功能，同时嵌入了Unsplash 获取图像的SDK，使得程序不仅能够从相册、相机获取图像，还能够直接从 Unsplash 无版权图像网站通过关键字检索获取图像。同时新增了图像分享的入口。为了适应新的变化将页面进行了部分重组，使其更加符合开发需求。<br><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.58.22.png\"><br>未来可能会考虑将该项目进行开源，现阶段仍然希望其具备更多的功能，以下为软件的运行测试。</p>\n<h3 id=\"页面逻辑\"><a href=\"#页面逻辑\" class=\"headerlink\" title=\"页面逻辑\"></a>页面逻辑</h3><p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.44.23.png\"></p>\n<ul>\n<li>开启App后进入引导页面，提示用户使用该App需遵守相关用户协议。</li>\n<li>点击开始处理后跳转至第二个页面，页面显示提示需要选择图像</li>\n<li>点击选择图像后，用户需要在三种图像获取图形中做出选择，或选择取消</li>\n</ul>\n<h3 id=\"运行测试\"><a href=\"#运行测试\" class=\"headerlink\" title=\"运行测试\"></a>运行测试</h3><p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.46.41.png\"></p>\n<ul>\n<li>处理相册图片实例，点选最近拍摄的照片，程序在本视图中加载此图像</li>\n<li>点击三个处理按钮中的最右者，即中值滤波效果，视图会进行跳转</li>\n<li>新的视图包含了保存和分享图像的功能，若点击保存，程序会将图像写入相册并告知用户</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.51.50.png\"></p>\n<ul>\n<li>尝试从相册加载一张新图像，可以看到图像中的树林被雾霾覆盖</li>\n<li>点击最左侧的去雾操作，由于去雾操作运算量较大，并且为了避免用户在运算过程中点按按钮，整个可操作区域不可点按，同时有活动指示环展示加载进度</li>\n<li>需要注意的是三个图像操作都采用了多线程的方式</li>\n<li>处理完成图像后可以点击分享按钮使用系统内建的分享服务进行图像的分享</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2016.54.28.png\"></p>\n<ul>\n<li>尝试从相机拍摄一张图像</li>\n<li>点击拍摄按钮后图像被获取，可以使用该图像进行处理</li>\n<li>在视图中加载图像后尝试点击中间的灰度化图像处理</li>\n<li>图像灰度化操作完成可以预览效果和保存、分享</li>\n</ul>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p>[1] Kaiming He. Single Image Haze Removal Using Dark Channel Prior [D]. 2009,CVPR<br>[2] Alexander Shishkov, Kirill Kornyakov. Instant OpenCV for iOS (English Edition) [M]. Packt Publishing, 2013<br>[3] Matthijs Hollemans. The iOS Apprentice [M]. Razeware LLC, 2014</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.18.30.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:19:44 GMT+0800 (中国标准时间)","title":"iOS 图像处理 App - OpenCV 与 Swift 开发","path":"2020/07/01/Haze-Free/","eyeCatchImage":"http://image.stephenfang.me/%E6%88%AA%E5%9B%BE2020-07-12%20at%2015.18.30.png","excerpt":"<p>本篇内容主要包含在 iOS 项目项目中添加 OpenCV 库、Objective-C++ 与 Swift 的结合使用，及桥接文件的添加等等，为 OpenCV 系列的第四篇文章。</p>","date":{"_isAMomentObject":true,"_i":"2020-07-01T01:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-01T01:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","OpenCV","Swift"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":4308},{"title":"Effective Objective-C 总结","date":"2021-07-12T03:34:32.000Z","copyright":true,"_content":"\n准备开始写 Objective-C 之前花了一些时间重新阅读这本经典的《Effective Objective-C》，在阅读的过程中对重点内容进行了一些摘录，在方便自己复习的同时将相关内容在博客分享出来供参考。\n\n<!--more-->\n\n## 第一节\n\n- Objective-C 采用了动态绑定的消息结构，在运行时检查对象的类型，运行期环境决定了接受消息后需要执行的代码。\n- Objective-C 对象所占内存分配在堆空间中，分配在堆空间中的内存必须直接管理。\n- 定义中不含*的变量分配在栈空间上，分配在栈的用于保存变量的内存会在栈帧弹出时自动清理。\n- 如果需要存储int、float、double、char等非对象类型推荐使用结构体。\n\n## 第二节\n\n- 在 .h 文件中使用@class 标识需要引入的类并且在 .m 文件中引入相关头文件，该种方式被称为向前声明，简单的说，将引入头文件的时机尽量向后可以减短编译的时间，并且能够解决互相引用问题。尽量不要引入头文件，降低类之间的耦合。\n- 有时无法使用向前声明，比如要声明某个类遵循一项协议。此时应尽量把“该类遵循某协议〞的这条声明移至“class-continuation 分类” 中。如果不行就把协议单独放在一个头文件中然后将其引人。\n\n## 第三节\n\n- 尽量使用字面量语法创建字符串、数值、数组、字典\n\n```objectivec\nNSNumber *intNumber = @1;\nNSNumber *floatNumber = @1.1f;\nNSNumber *doubleNumber = @1.123456;\nNSNumber *boolNumber = @YES;\nNSNumber *charNumber = @'a';\n\nint numberInt = 5;\nfloat numberFloat = 1.23f;\n\nNSArray *animals = @[@\"cat\", @\"dog\", @\"mouse\"];\nNSString *dog = @\"shiba\";\n\nNSDictionary *personData = @{@\"firstName\" : @\"Stephen\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t @\"lastName\" : @\"Fang\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t @\"gender\" : @\"male\"};\n```\n\n- NSArray 的 arrayWithObjects 方法依次处理各个参数直到发现nil，而如果使用字面量的方法在创建时就会抛出异常终止程序执行，需要确保创建的数组与字典中不含有nil\n- 尽量使用取下标的方式来访问数组或字典中的元素\n\n```objectivec\nNSString *dog = animals[1];\nNSString *lastName = personData[@\"lastName\"];\n```\n\n## 第四节\n\n- #define预处理指令声明全局变量尽量少用，编译器只会执行查找和替换操作，不会产生重复定义的警告信息\n- 尽量使用 static const 声明的方式来完成变量的声明，static表示该变量在定义此变量的编译单元中可见，而static const不会创建符号，只是将变量替换为常量\n\n```objectivec\nstatic const NSTimeInterval kAnimationDuration = 0.3;\n```\n\n- 编译器看到extern关键字得知全局符号表中包含该符号无需查看该定义就允许只用该常量，该类常量只可以定义一次，命名最好使用与之相关的类名作为前缀\n\n```objectivec\n// In the header file\nextern NSString *const EOCStringConstant;\n\n// In the implementation file \nNSString *const EOCStringConstant = @\"DEMO\";\n```\n\n## 第五节\n\n- 保证枚举由底层数据类型实现，不采用编译器所选类型\n- 凡是需要以按位或操作来组合的枚举都应使用NS_OPTIONS定义，若枚举不需要相互组合应使用NS_ENUM来定义\n\n```objectivec\ntypedef NS_ENUM(NSUInteger, STFFeedPageType) {\n    STFFeedPageTypeNone = 0,             // 未知\n    STFFeedPageTypeFollow = 1,           // 关注页\n    STFFeedPageTypeRecommend = 2,        // 推荐页\n    STFFeedPageTypeFeatured = 3,         // 精选页\n};\n\ntypedef NS_OPTIONS(NSUInteger, AgoraAudioSessionOperationRestriction) {\n    /** No restriction, the SDK has full control of the audio session operations. */\n    AgoraAudioSessionOperationRestrictionNone              = 0,\n    /** The SDK does not change the audio session category. */\n    AgoraAudioSessionOperationRestrictionSetCategory       = 1,\n    /** The SDK does not change any setting of the audio session (category, mode, categoryOptions). */\n    AgoraAudioSessionOperationRestrictionConfigureSession  = 1 << 1,\n    /** The SDK keeps the audio session active when leaving a channel. */\n    AgoraAudioSessionOperationRestrictionDeactivateSession = 1 << 2,\n    /** The SDK does not configure the audio session anymore. */\n    AgoraAudioSessionOperationRestrictionAll               = 1 << 7\n};\n```\n\n- 处理枚举类型的switch语句不要实现default分支\n\n## 第六节\n\n- 在iOS中一般不使用atomic，因为同步锁会带来较大的开销，且无法保证线程安全\n- 尽量使用@property语法定义对象封装的数据\n- 在设置属性对应的实例变量时需要遵从属性声明的语义\n- 针对CGFloat、NSInteger此类纯量类型采用assign声明即可\n- copy类型用于保护NSString*类型的封装性，在ARC下直接访问一个声明为copy的属性并不会直接拷贝而是保留新值释放旧值\n\n## 第七节\n\n- 在对象内部尽量直接访问实例变量\n    - 速度更快且生成的代码会直接访问对象实例变量的那块内存\n    - 不会调用“设置方法”\n    - 不会触发KVO，但需要确定是否会产生问题\n    - 通过给getter、setter设置断点可以进行监控和确定访问时机\n- 在写入实例变量时可以通过属性写入，读取实例变量时直接访问，可以作为一种折中方案\n- 在初始化方法及dealloc方法中，应该直接通过实例变量读取数据，即_\n- 懒加载方式中必须使用getter的方式访问属性，如果在没有用getter的情况下直接访问实例变量会导致得到是尚未设置好的变量\n\n```objectivec\n- (STFComponent*)component {\n\t\tif (!_component) {\n\t\t\t\t\t_component = [SFComponent new];\n\t\t\t}\n\t\t\treturn _component;\n\t\t}\n```\n\n## 第八节\n\n- == 操作符对比的是两个指针本身并非所指对象\n- NSString类实现了一个等同判断方法即isEqualToString，执行该方法的速度快于执行isEqual\n- 检测对象的等同性需要提供 isEqual 与 hash 方法，NSObject对于两个方法默认实现是仅当指针值完全相等才返回相等，需要针对具体的需求制定检测方案\n- 编写hash方法时需要使用计算速度快且哈希碰撞低的算法\n\n```objectivec\n- （BOOL）isEqual:(id)object {\n\t\tif (self == object) return YES; // 指向同一个对象必然相等\n\t\tif ([self class] != [object class]) return NO; //不属于同一个类不相等\n\n\t\t// 检测每一个属性是否相等\n\t\tSTFPerson *someone = (STFPerson*) object;\n\t\tif (![_firstName isEqualToString:someone.firstName])\n\t\t\treturn NO;\n\t\tif (![_lastName isEqualToString:someone.lastName])\n\t\t\treturn NO;\n\t\tif (![_age != someone.age])\n\t\t\treturn NO;\n\t\treturn YES;\n\t}\n\n - (NSUInteger)hash {\n\t\tNSUInteger firstNameHash = [_firstName hash]；\n\t\tNSUInteger lastNameHash = [_lastName hash]；\n\t\tNSUInteger ageHash = [_ageHash hash]；\n\t\treturn firstNameHash ^ lastNameHash ^ ageHash；\n\t}\n```\n\n- NSArray有等同性判定方法\"isEqualToArray:\"，而NSDictionary有等同性判定方法\"isEqualToDictionary:\"， NSArray检测方式为首先核对两个数组包含对象的个数是否相等，若相等在每个对应位置调用\"isEqual:\"方法\n- 在编写判定方法时应一并覆写\"isEqual:\"方法，如果接收该消息的对象与受测参数来自一个类就调用自己编写的判定方法，负责交由超类判定\n\n```objectivec\n-  (BOOL)isEqual:(id)object {\n\t\tif ([self class] == [object class]) \n\t\t\t\treturn [self isEqualToPerson:(STFPerson*)object];\n\t\t} else {\n\t\t\t\treturn [super isEqual: object];\n\t\t}\n```\n\n## 第九节\n\n- UIButton类使用者无需关系创建出来的按钮属于哪个子类也无需考虑按钮绘制方式等细节\n- 类族的使用需要遵循以下原则\n    - 子类应该继承自类族的抽象基类\n    - 子类应该定义自己的数据存储方式\n    - 子类应该覆写超类文档中需要覆写的方法\n\n## 第十节\n\n- 在其他做法不可行的条件下可以选用关联对象，因为这种做法同样会引入难以查找的bug（不建议使用）\n\n## 第十一节\n\n- 在编译期就能决定运行时所需要调用的函数为静态绑定，而所需要调用的函数直到运行期才能确定为动态绑定\n- runtime决定了对象收到消息后调用哪个方法，甚至在程序运行时可以改变。发送给对象的所有消息都由动态信息派发系统处理\n- objc_msgSend函数根据receive和selector的类型调用适当的方法，通过查找每个类中的“表格”查找需要执行的方法并跳转至相应的实现\n- 尾调用优化在函数的最后一项是调用另一个函数时生效，编译器生成跳转至另一个函数所需的指令码\n\n## 第十二节\n\n- 消息转发分为两个阶段\n    - 第一阶段：动态方法解析\n    - 第二阶段：消息转发机制\n  \n    ![](http://image.stephenfang.me/mweb/Untitled.png)\n\n- receiver在每一步都有机会处理消息且步骤越往后处理消息的代价越大\n- 如果对象没有办法响应某个selector则进入消息转发流程,runtime的动态方法解析可以在需要某个方法时将其加入类中，对象可以将无法解析的selector转交给其他对象处理。这一步结束后若仍然无法处理selector则启动消息转发机制\n\n## 第十三节\n\n- 在runtime中可以向类中新增或替换selector对应的方法实现，但一般只用于调试\n- method swizzling，即使用另一份实现替换原有的方法实现，可以用于向原有的实现中添加新功能\n\n## 第十四节\n\n- 每个Objective-C对象实例都有指向Class对象的指针，每个对象结构体的首个成员是Class类的变量，该变量定义了对象所属的类，通常称为\"is a\"指针\n- isMemberOfClass 判断对象是否为某个特定类的实例，isKindOfClass 判断对象是否是某类或派生类的实例\n- 动态类型特性可以用于从 collection 中获取对象（类型信息查询方法）\n- 假设名为SomeClass的子类继承自NSObject可以得到以下继承体系\n\n![](http://image.stephenfang.me/mweb/Untitled1.png)\n\n## 第十五节\n\n- 类名、分类名都应该加上相应的前缀，如果使用三方库编写自己的代码并分发尤其需要注意重复符号问题\n\n![](http://image.stephenfang.me/mweb/Untitled2.png)\n\n## 第十六节\n\n- 在类中实现一个designated initializer，尽量在文档中指明初始化需要调用该方法\n- 若designated initializer不同于超类则需覆写超类对应方法\n- 如果超类的初始化方法不适用于子类应覆写超类方法并抛出异常\n\n## 第十七节\n\n- 实现description方法能够返回一个有意义的字符串来描述实例，需要打印出类的名字和指针地址因为有时候会用到\n- 使用NSDictionary来编写description方法使代码更容易维护\n\n![](http://image.stephenfang.me/mweb/Untitled3.png)\n\n- 在调试时打印更为详尽的对象描述信息应实现debugDescription方法\n\n![](http://image.stephenfang.me/mweb/Untitled4.png)\n\n## 第十八节\n\n- 尽量创建不可变对象，把对外公开的属性设置为只读且在必要时对外公布属性\n- 某属性仅用于对象内部修改应将其从readonly改为readwrite属性\n- 可变的collection不应作为属性公开，而应提供相关方法修改可变的collection\n\n## 第十九节\n\n如果从其他框架中继承子类务必遵循命名惯例，如从UIView中继承自定义子类则类名末尾词为View，若创建自定义委托协议末尾应跟上Delegate一词。\n\n![](http://image.stephenfang.me/mweb/Untitled5.png)\n\n## 第二十节\n\n- 适当给私有方法加上前缀可以很容易将其与公共方法进行区分\n- 不应使用一个下划线做私有方法的前缀，如 _resetViewController 方法已经被苹果实现\n\n## 第二十一节\n\n- Objective-C对于异常采取的态度为：只有在极为罕见的情况下才抛出异常，并在异常抛出后无需考虑恢复问题，应用程序此时应该退出。异常应该运用于极其严重的问题\n\n![](http://image.stephenfang.me/mweb/Untitled6.png)\n\n```objectivec\n- (BOOL)doSomething:(NSError**) error\n\n- (BOOL)doSomething:(NSError**) error {\n\t// do something that may cause an error\n\n\tif ( /* there was an error */ ) {\n\t\t\tif (error) {\n\t\t\t\t\t*error = [NSErrorerrorwithDomain:domain code:code userInfo:userInfo];\n\t\t\t}\n\t\t\treturn NO;\n\t\t} else {\n\t\treturn YES;\n\t\t}\n}\n\nNSError *error = nil;\nBOOL ret = [object doSomething: &error];\nif (ret) {\n     // handle error \n}\n```\n\n![](http://image.stephenfang.me/mweb/Untitled7.png)\n\n传递给方法的是个指针，指针本身指向另一个指向NSError对象的指针，或认为其为一个直接指向NSError对象的指针。在 ARC 中，指针所指向的对象会在方法执行完毕后自动释放。\n\n## 第二十二节\n\n- 使自己的类支持拷贝操作需要实现NSCopying协议，该协议只有一个方法且不必担心zone参数。覆写copy方法真正需要实现的是copyWithZone方法。\n\n```objectivec\n- (id)copyWithZone:(NSZone*)zone\n\n- (id)copyWithZone:(NSZone*)zone {\n\t\tSTFPerson *copy = [[self class] allocWithZone:zone]initWithFirstName:_firstName andLastName:_lastName];\n\t\treturn copy;\n}\n```\n\n- 在可变对象上调用copy会返回一个不可变类的实例，可能会把NSMutableArray对象当作NSArray返回，为了安全起见使用copy和mutableCopy这两个方法复制对象\n- 深拷贝与浅拷贝\n    - 深拷贝：拷贝对象自身时一并拷贝其底层数据，需要新增一个专门执行深拷贝的方法\n    - 浅拷贝：只拷贝容器对象本身不拷贝其中数据；Foundation框架所有collection类执行拷贝的默认情况；实现copyWithZone方法\n    - 图解：\n\n   ![](http://image.stephenfang.me/mweb/Untitled8.png)\n\n## 第二十三节\n\n   ![](http://image.stephenfang.me/mweb/Untitled9.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled10.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled11.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled12.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled13.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled14.png)\n\n存放委托对象的属性需要为weak（在对象销毁时自动清空）或unsafe_unretained（不需要自动清空）。\n\n   ![](http://image.stephenfang.me/mweb/Untitled15.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled16.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled17.png)\n\n- 某个对象从另一个对象获取数据可以使用委托模式，亦成为数据源模式，数据的流动如上图所示\n- 如果有必要可以实现有段位的结构体将委托对象是否能响应相关协议的信息缓存至其中\n\n## 第二十四条\n\n- 通过分类机制将代码划分为易于管理的小块\n\n   ![](http://image.stephenfang.me/mweb/Untitled18.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled19.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled20.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled21.png)\n\n- 可以创建名为Private的分类并将私有方法放在里面，这个分类的方法只在类和框架内部使用无需对外公布\n\n## 第二十五条\n\n- 向第三方类中添加分类时给分类名与方法名加上前缀\n\n   ![](http://image.stephenfang.me/mweb/Untitled22.png)\n\n## 第二十六条\n\n- 在实现分类时所有属性都应该定义在主接口内，类所封装的所有数据都应该定义在主接口内\n\n   ![](http://image.stephenfang.me/mweb/Untitled23.png)\n\n## 第二十七条\n\n- class-continuation 分类中可以定义方法和实例变量，如下方式中_anotherInstanceVariable 是隐藏的状态\n\n    ```objectivec\n    @interface STFPerson() {\n    \t\tNSString *_anInstanceVariable;\n    }\n    // Methods declaration\n    @end\n\n    @implementation STFPerson {\n    \tint _anotherInstanceVariable;\n    }\n    // Methods implementation \n    @end\n    ```\n\n   ![](http://image.stephenfang.me/mweb/Untitled24.png)\n\n- WebKit、CoreAnimation 底层大部分代码用C++编写，对外展示的为Objective-C接口\n\n   ![](http://image.stephenfang.me/mweb/Untitled25.png)\n\n- 上图方式可以随意调用setFirstName与setLastName方法与点语法设置属性，同时外界无法修改对象，完成了类型的拓展\n\n   ![](http://image.stephenfang.me/mweb/Untitled26.png)\n\n    - 不需要在公共接口中声明类遵从了私有协议，而应该改到 class-continuation 分类内进行声明\n\n## 第二十八条\n\n- 协议可以在某种程度上提供匿名类型，具体的对象类型淡化成为遵从某个协议的id类型，协议离规定对象应该实现的方法。下图中与数据库连接相关的类名称就无法泄漏\n\n    ![](http://image.stephenfang.me/mweb/Untitled27.png)\n\n- 使用匿名对象实现类型名称的隐藏，需要注意的是对象需要能够响应定义在协议中的方法\n- 下图中其中sectionInfo为匿名对象，把section数组中返回的内部状态对象视为遵从NSFetchedResultsSectionInfo的匿名对象，隐藏了相关实现细节。\n\n    ![](http://image.stephenfang.me/mweb/Untitled28.png)\n\n## 第二十九条\n\n- 对象创建完成后引用计数至少为1，如果需要保留该对象需要调用retain方法，如果不再需要该对象则调用release、autorelease方法，当引用计数归零时对象被回收\n\n    ![](http://image.stephenfang.me/mweb/Untitled29.png)\n\n- 为了避免使用无效对象一般在完成调用release之后清空指针，保证不会出现指向无效对象的指针\n\n    ```objectivec\n    NSNumber *number = [[NSNumber alloc]initWithInt: 1234];\n    [array addObject: number];\n    [number release];\n    number = nil;\n    ```\n\n## 第三十条\n\n- ARC会自动执行retain、release、autorelease等操作，不能直接对这些方法（还包括dealloc）进行调用\n- ARC在调用这些方法并不通过Objective-C消息派发机制，而是直接调用底层C语言版本，能够带来更好的性能\n- 若方法名以以下的几个四个词语开头则表示返回的对象归调用者所有，反之返回的对象会自动释放\n    - copy\n    - mutableCopy\n    - new\n    - alloc\n\n## 第三十一条\n\n   ![](http://image.stephenfang.me/mweb/Untitled30.png)\n\n- 如果对象持有文件描述符等系统资源，应该专门写一个方法释放此类资源，用完使用close方法\n- 执行异步任务的方法和只能在正常状态下执行的方法不应在dealloc中调用\n\n## 第三十二条\n\n- ARC不生成安全处理异常所需的清理代码，开启编译器标志后可以生成这种代码但是会导致应用程序变大，且会降低运行效率\n\n   ![](http://image.stephenfang.me/mweb/Untitled31.png)\n\n## 第三十三条\n\n- 当指向EOCClassA的实例引用移除后unsafe_unretained属性仍然指向已经回收的实例，而weak属性指向nil\n\n    ![](http://image.stephenfang.me/mweb/Untitled32.png)\n\n## 第三十四条\n\n系统会自动创建一些线程，如主线程或GCD机制中的线程都有自动释放池，这些线程都有autoreleasepool，每次执行event loop就会将其清空\n\n   ![](http://image.stephenfang.me/mweb/Untitled33.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled34.png)\n\n## 第三十五条\n\n- 系统在回收对象时可以将其转化为僵尸对象，通过环境变量NSZombieEnabled可以开启该功能，或在Xcode中开启\n\n![](http://image.stephenfang.me/mweb/Untitled35.png)\n\n- 系统修改对象的isa指针指向特殊的僵尸类可以时该对象成为僵尸对鲜花，僵尸类能够响应所有的selector，在打印一条包含消息内容及接受者的消息后终止应用程序\n\n## 第三十六条\n\n在 ARC 下调用查询对象当前引用计数的方法会触发崩溃\n\n    ```objectivec\n    - (NSUInteger)retainCount\n    ```\n\n事实上该方法不应该调用，方法返回的retainCount是某个给定时间点上的数值，并未考虑系统会稍后清空自动释放池，无法反应对象生命期的全貌。\n\n## 第三十七条\n\n- Block与定义它的函数共享同一个范围内的信息，块自有其相关类型，可以将块赋值给变量并使用它\n\n    ```objectivec\n    void (^someBlock) () = ^ {\n    \t\t// Block implementation\n    };\n\n    int other = 10;\n    int (^addBlock) (int a, int b) = ^ (int a, int b) {\n    \t\treturn other + a + b;\n    };\n    int sum = addBlock(1, 2);\n    ```\n\n    - 需要在Block内修改的变量需要加上 _block 修饰符，如果将块定义在Objective-C类的实例方法中，除了可以访问类的所有的实例变量外还可以使用self变量且无需添加_block。\n    - 定义Block的时候分配的内存区域在栈上，即块只在定义的范围内有效，可以创建不会捕捉任何状态的全局块\n\n![](http://image.stephenfang.me/mweb/Untitled36.png)\n\n![](http://image.stephenfang.me/mweb/Untitled37.png)\n\n## 第三十八条\n\n![](http://image.stephenfang.me/mweb/Untitled38.png)\n\n- 以下展示了SDWebImage中Block的写法\n\n    ```objectivec\n    typedef void(^SDWebImageDownloaderProgressBlock)(NSUInteger receivedSize, long long expectedSize);\n    typedef void(^SDWebImageDownloaderCompletedBlock)(UIImage *image, NSData *data, NSError *error, BOOL finished);\n\n    ****- (void)setImageWithURL:(NSURL *)url placeholderImage:(UIImage *)placeholder options:(SDWebImageOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletedBlock)completedBlock;\n    - (id<SDWebImageOperation>)downloadImageWithURL:(NSURL *)url\n                                            options:(SDWebImageDownloaderOptions)options\n                                           progress:(SDWebImageDownloaderProgressBlock)progressBlock\n                                          completed:(SDWebImageDownloaderCompletedBlock)completedBlock;\n\n    - (id<SDWebImageOperation>)downloadImageWithURL:(NSURL *)url\n                                    timeOutInterval:(NSTimeInterval)timeOutInterval\n                                            options:(SDWebImageDownloaderOptions)options\n                                           progress:(SDWebImageDownloaderProgressBlock)progressBlock\n                                          completed:(SDWebImageDownloaderCompletedBlock)completedBlock;\n    ```\n\n## 第三十九条\n\n- 简洁程度上Delegate与Block的对比\n\n   ![](http://image.stephenfang.me/mweb/Untitled39.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled40.png)\n\n- 处理多个请求时Delegate与Block的对比\n\n   ![](http://image.stephenfang.me/mweb/Untitled41.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled42.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled43.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled44.png)\n\n- 在处理请求时采用两个独立的处理Block（1/2）\n\n   ![](http://image.stephenfang.me/mweb/Untitled45.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled46.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled47.png)\n\n- 在处理请求时采用同一个处理Block，令Block更为灵活但更为冗长\n\n   ![](http://image.stephenfang.me/mweb/Untitled48.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled49.png)\n\n## 第四十条\n\n大部分网络通信库写法\n\n   ![](http://image.stephenfang.me/mweb/Untitled50.png)\n\n为了使得在下载完成后通过以下方法执行调用者指定的Block，需要将completion handler保存至实例变量，一旦运行完completion handler之后没有必要对其进行保留，从而避免出现retain cycle\n\n   ![](http://image.stephenfang.me/mweb/Untitled51.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled52.png)\n\n## 第四十一条\n\n- 串行队列，将读取操作与写入操作安排到同个队列中保证数据同步，可以将设置方法由同步派发改为异步执派发\n\n   ![](http://image.stephenfang.me/mweb/Untitled53.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled54.png)\n\n    - 并发队列，读取与写入操作可以随时执行\n\n   ![](http://image.stephenfang.me/mweb/Untitled55.png)\n\n    创建栅栏使得barrier块单独执行不与其他Block并行，对并发队列有意义，因为串行Block按顺序逐个执行\n\n   ![](http://image.stephenfang.me/mweb/Untitled56.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled57.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled58.png)\n\n## 第四十二条\n\n- performSelector接受的参数类型为id，限定了传入参数必须是对象，不能是整数或者浮点数，并且最多只能接受两个参数\n\n   ![](http://image.stephenfang.me/mweb/Untitled59.png)\n\n- 延后执行某项任务，优先使用GCD的方式\n\n   ![](http://image.stephenfang.me/mweb/Untitled60.png)\n\n- 把任务放到主线程上执行，把任务封装至Block中用GCD相关方法更为合适\n\n   ![](http://image.stephenfang.me/mweb/Untitled61.png)\n\n- performSelector在内存管理方面存在缺失，无法确定将执行的Selector具体是什么\n\n## 第四十三条\n\n- GCD是纯C的API，操作队列是Objective-C的对象\n- Block是轻量级的书籍结构而Operation是重量级的Objective-C对象\n- 在执行后台任务时GCD并不一定是最佳方式\n- 使用NSOperation与NSOperationQueue有以下好处，能够实现纯GCD具备的绝大部分功能\n\n   ![](http://image.stephenfang.me/mweb/Untitled62.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled63.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled64.png)\n\n- NSNotificationCenter 的 addObserverForName: 方法接受的参数是块而不是Selector\n\n   ![](http://image.stephenfang.me/mweb/Untitled65.png)\n\n- 确定哪一种方法的最好方式是测试性能\n\n    ## 第四十四条\n\n- dispatch group 能够将任务分组，调用者可以等待这组任务执行完毕同时也可以在提供回调函数之后继续执行\n- 如下函数是dispatch_async的变体\n\n![](http://image.stephenfang.me/mweb/Untitled66.png)\n\n- 如下函数用于等待 dispatch group 执行完毕，timeout 参数表示阻塞时间，若执行时间短于timeout返回0\n\n![](http://image.stephenfang.me/mweb/Untitled67.png)\n\n- 如下函数中可以传入在特定线程上执行的Block\n\n![](http://image.stephenfang.me/mweb/Untitled68.png)\n\n- 令数组每个对象都执行某个任务，并且等待每个任务都执行完毕可以使用如下GCD特性\n\n![](http://image.stephenfang.me/mweb/Untitled69.png)\n\n- 若当前线程不阻塞可以使用notify函数取代wait\n\n![](http://image.stephenfang.me/mweb/Untitled70.png)\n\n- 区分任务的优先级放置于不同的线程执行，同时将所有任务归于一个dispatch group，并且在执行完毕后获得通知（并发队列）\n\n![](http://image.stephenfang.me/mweb/Untitled71.png)\n\n- 将任务提交到串行队列中并用dispatch group 跟踪执行情况\n\n![](http://image.stephenfang.me/mweb/Untitled72.png)\n\n![](http://image.stephenfang.me/mweb/Untitled73.png)\n\n## 第四十五条\n\n- 常用的一种共享单例的方法\n\n   ![](http://image.stephenfang.me/mweb/Untitled74.png)\n\n- 使用GCD实现共享单例的方法\n\n   ![](http://image.stephenfang.me/mweb/Untitled75.png)\n\n- 使用 dispatch_once 能够简化代码并且彻底保证线程安全开发者无需关心加锁或同步，所有问题都由GCD在底层进行处理，static 作用域能够保证编译器在每次执行该方法时复用该变量而不是重复创建\n\n## 第四十六条\n\n- dispatch_get_current_queue 函数尽量不要使用\n\n## 第四十七条\n\n- 框架指一系列代码被封装为动态库，并且在其中放入描述接口的头文件，iOS平台的系统框架仍然采用了动态库\n- iOS应用程序不允许在其中包含动态库于是就出现了静态库\n- 关于静态库与动态库的了解可以参考 [细说iOS静态库和动态库](https://juejin.cn/post/6844904031937101838)\n\n- Cocoa 本身并不是框架而是集成了一批创建应用程序时需要用到的框架\n- Objective-C编程的一个重要特点是经常需要用到底层的C语言级API\n- CoreAnimation 使用Objective-C进行编写，而 CoreGraphics 框架采用C语言进行编写，两者均为 UI 框架之下的一等框架\n\n## 第四十八条\n\n- 遍历方式\n    - for循环\n\n   ![](http://image.stephenfang.me/mweb/Untitled76.png)\n\n    字典与 set 均无顺序，无法根据下标访问数值。于是需要获取字典内所有键或 set 内所有对象，从而产生空间上的额外开销。然而执行反向遍历时 for 循环会更为方便。\n\n    - NSEnumerator\n\n    ```objectivec\n    // Dictionary\n    NSDictionary *dict = /* ... */;\n    NSEnumerator *enumerator = [dict keyEnumerator];\n    id key;\n    while ((key = [enumerator nextObject]) != nil) {\n    \tid value = dict[key];\n    \t// do something here\n    }\n\n    // Set\n    NSSet *set = /* ... */;\n    NSEnumerator *enumerator = [set objectEnumerator];\n    id object;\n    while ((object = [enumerator nextObject]) != nil) {\n    \t// do something here\n    }\n\n    // Array\n    NSArray *array = /* ... */;\n    NSEnumerator *enumerator = [array reverseObjectEnumerator];\n    id object;\n    while ((object = [enumerator nextObject]) != nil) {\n    \t// do something here\n    }\n    ```\n\n    对于所有的collection都可以采用这套语法，在读法上更容易被理解\n\n    - for in 快速遍历\n\n    ```objectivec\n    // Dictionary\n    NSDictionary *dict = /* ... */;\n    for (id key in dict) {\n    \tid value = dict[key];\n    \t// do something here\n    }\n\n    // Set\n    NSSet *set = /* ... */;\n    for (id object in set) {\n    \t// do something here\n    }\n\n    // Array\n    NSArray *array = /* ... */;\n    for (id object in array) {\n    \t// do something here\n    }\n    for (id object in [array reverseObjectEnumerator]) {\n    \t// do something here\n    }\n    ```\n\n    某个支持快速遍历的类的对象遵从 NSFastEnumeration 协议可以实现对象的迭代，而NSEnumerator 也实现了该协议，该遍历方法无法获取遍历操作针对的下标。\n\n    - 基于Block的遍历\n\n    ```objectivec\n    // Dictionary\n    NSDictionary *dict = /* ... */;\n    [array enumerateKeysAndObjectsUsingBlock:\n    \t^(id key, id object, BOOL *stop) {\n    \t\t// do something here\n    \t\t\tif (shouldStopHere) {\n    \t\t\t\t*stop = YES;\n    \t\t}\n    }];\n\n    // Set\n    NSSet *set = /* ... */;\n    [array enumerateObjectsUsingBlock:\n    \t^(id object, BOOL *stop) {\n    \t\t// do something here\n    \t\t\tif (shouldStopHere) {\n    \t\t\t\t*stop = YES;\n    \t\t}\n    }];\n\n    // Array\n    NSArray *array = /* ... */;\n    [array enumerateObjectsUsingBlock:\n    \t^(id object, NSUInteger idx, BOOL *stop) {\n    \t\t// do something here\n    \t\t\tif (shouldStopHere) {\n    \t\t\t\t*stop = YES;\n    \t\t}\n    }];\n    ```\n\n    使得遍历能够从Block中获取信息，并且可以在遍历数组获取数组的下标。\n\n    NSEnumerationOptions 类型为enum，如果开启了NSEnumerationConcurrent 底层会使用GCD处理出发执行事宜，采用其他方法很难实现。\n\n## 第四十九条\n\n- 使用桥接技术可以实现定义在Foundation框架内的Objective-C类与CoreFoundation 框架中的 C 数据结构的相互转换\n\n    ```objectivec\n    NSArray *anNSArray = @[@1, @2, @3, @4, @5];\n    CFArrayRef *aCGArray = (__bridge CFArrayRef)anNSArray;\n    NSLog(@\"size of array = %li\", CFArrayGetCount(aCFArray)); \n\n    gradientLayer.colors = @[(__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.95].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.95].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.72].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.45].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.28].CGColor,\n                                                ]; \n    ```\n\n- __bridge 含义为ARC具备该对象的所有权，__bridge_retained表示ARC交出该对象的所有权， 通过__bridge告诉ARC如何处理转换涉及的Objective-C对象\n- Foundation 框架中的 Objective-C 类具备的某些功能是 CoreFoundation 框架中的 C语言数据结构不具备的\n\n## 第五十条\n\n- NSCache 在系统资源耗尽时能够自动删减缓存，采用LRU策略\n- NSCache并不会直接拷贝键，而是保留键\n- NSCache是线程安全的，多个线程可以同时访问NSCache\n- NSCache可以设置针对对象个数以及总成本的上限\n\n缓存的一般用法\n\n   ![](http://image.stephenfang.me/mweb/Untitled77.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled78.png)\n\n加入 NSPurgeable 的缓存用法\n\n   ![](http://image.stephenfang.me/mweb/Untitled79.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled80.png)\n\n- 重复计算会带来性能开销的数据值得被放入缓存，从而提高应用程序的响应速度\n- NSPurgeableData 与 NSCache 一起使用能够实现自动清除数据的功能\n\n## 第五十一条\n\n- load 方法并不像普通的方法那样，她不遵从继承规则，如果某个类本身不实现load方法那么无论其各级超类是否实现此方法系统都不会调用\n- load 与 initialize 方法务必精简实现，因为会产生阻塞从而使得应用程序无响应\n- initialize 方法在程序首次用该类前调用一次，并且使用runtime进行调用，只应该用来设置内部数据而不应该调用其他方法\n- 如果某个类本身不实现 initialize 方法然而超类完成了就会调用超类的实现方法，如下图中初始化子类后由于该类未覆写该方法于是需要执行父类的实现代码，于是得到了通常的子类实现方法\n\n![](http://image.stephenfang.me/mweb/Untitled81.png)\n\n![](http://image.stephenfang.me/mweb/Untitled82.png)\n\n![](http://image.stephenfang.me/mweb/Untitled83.png)\n\n## 第五十二条\n\n- NSTimer 对象会保留目标直到计时器失效，需要调用invalidate方法令其失效\n\n   ![](http://image.stephenfang.me/mweb/Untitled84.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled85.png)\n\n- 反复执行的计时器容易引入retain cycle，可以使用 Block 的方式打破，需要注意的是必须创建分类来加入相关实现代码","source":"_posts/EffectiveObjcTips.md","raw":"---\ntitle: Effective Objective-C 总结\ndate: 21-07-14 14:21:22\ncategories: \n- 技术\ntags: \n- iOS\n- Objective-C\n- Xcode\ncopyright: true\n---\n\n准备开始写 Objective-C 之前花了一些时间重新阅读这本经典的《Effective Objective-C》，在阅读的过程中对重点内容进行了一些摘录，在方便自己复习的同时将相关内容在博客分享出来供参考。\n\n<!--more-->\n\n## 第一节\n\n- Objective-C 采用了动态绑定的消息结构，在运行时检查对象的类型，运行期环境决定了接受消息后需要执行的代码。\n- Objective-C 对象所占内存分配在堆空间中，分配在堆空间中的内存必须直接管理。\n- 定义中不含*的变量分配在栈空间上，分配在栈的用于保存变量的内存会在栈帧弹出时自动清理。\n- 如果需要存储int、float、double、char等非对象类型推荐使用结构体。\n\n## 第二节\n\n- 在 .h 文件中使用@class 标识需要引入的类并且在 .m 文件中引入相关头文件，该种方式被称为向前声明，简单的说，将引入头文件的时机尽量向后可以减短编译的时间，并且能够解决互相引用问题。尽量不要引入头文件，降低类之间的耦合。\n- 有时无法使用向前声明，比如要声明某个类遵循一项协议。此时应尽量把“该类遵循某协议〞的这条声明移至“class-continuation 分类” 中。如果不行就把协议单独放在一个头文件中然后将其引人。\n\n## 第三节\n\n- 尽量使用字面量语法创建字符串、数值、数组、字典\n\n```objectivec\nNSNumber *intNumber = @1;\nNSNumber *floatNumber = @1.1f;\nNSNumber *doubleNumber = @1.123456;\nNSNumber *boolNumber = @YES;\nNSNumber *charNumber = @'a';\n\nint numberInt = 5;\nfloat numberFloat = 1.23f;\n\nNSArray *animals = @[@\"cat\", @\"dog\", @\"mouse\"];\nNSString *dog = @\"shiba\";\n\nNSDictionary *personData = @{@\"firstName\" : @\"Stephen\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t @\"lastName\" : @\"Fang\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t @\"gender\" : @\"male\"};\n```\n\n- NSArray 的 arrayWithObjects 方法依次处理各个参数直到发现nil，而如果使用字面量的方法在创建时就会抛出异常终止程序执行，需要确保创建的数组与字典中不含有nil\n- 尽量使用取下标的方式来访问数组或字典中的元素\n\n```objectivec\nNSString *dog = animals[1];\nNSString *lastName = personData[@\"lastName\"];\n```\n\n## 第四节\n\n- #define预处理指令声明全局变量尽量少用，编译器只会执行查找和替换操作，不会产生重复定义的警告信息\n- 尽量使用 static const 声明的方式来完成变量的声明，static表示该变量在定义此变量的编译单元中可见，而static const不会创建符号，只是将变量替换为常量\n\n```objectivec\nstatic const NSTimeInterval kAnimationDuration = 0.3;\n```\n\n- 编译器看到extern关键字得知全局符号表中包含该符号无需查看该定义就允许只用该常量，该类常量只可以定义一次，命名最好使用与之相关的类名作为前缀\n\n```objectivec\n// In the header file\nextern NSString *const EOCStringConstant;\n\n// In the implementation file \nNSString *const EOCStringConstant = @\"DEMO\";\n```\n\n## 第五节\n\n- 保证枚举由底层数据类型实现，不采用编译器所选类型\n- 凡是需要以按位或操作来组合的枚举都应使用NS_OPTIONS定义，若枚举不需要相互组合应使用NS_ENUM来定义\n\n```objectivec\ntypedef NS_ENUM(NSUInteger, STFFeedPageType) {\n    STFFeedPageTypeNone = 0,             // 未知\n    STFFeedPageTypeFollow = 1,           // 关注页\n    STFFeedPageTypeRecommend = 2,        // 推荐页\n    STFFeedPageTypeFeatured = 3,         // 精选页\n};\n\ntypedef NS_OPTIONS(NSUInteger, AgoraAudioSessionOperationRestriction) {\n    /** No restriction, the SDK has full control of the audio session operations. */\n    AgoraAudioSessionOperationRestrictionNone              = 0,\n    /** The SDK does not change the audio session category. */\n    AgoraAudioSessionOperationRestrictionSetCategory       = 1,\n    /** The SDK does not change any setting of the audio session (category, mode, categoryOptions). */\n    AgoraAudioSessionOperationRestrictionConfigureSession  = 1 << 1,\n    /** The SDK keeps the audio session active when leaving a channel. */\n    AgoraAudioSessionOperationRestrictionDeactivateSession = 1 << 2,\n    /** The SDK does not configure the audio session anymore. */\n    AgoraAudioSessionOperationRestrictionAll               = 1 << 7\n};\n```\n\n- 处理枚举类型的switch语句不要实现default分支\n\n## 第六节\n\n- 在iOS中一般不使用atomic，因为同步锁会带来较大的开销，且无法保证线程安全\n- 尽量使用@property语法定义对象封装的数据\n- 在设置属性对应的实例变量时需要遵从属性声明的语义\n- 针对CGFloat、NSInteger此类纯量类型采用assign声明即可\n- copy类型用于保护NSString*类型的封装性，在ARC下直接访问一个声明为copy的属性并不会直接拷贝而是保留新值释放旧值\n\n## 第七节\n\n- 在对象内部尽量直接访问实例变量\n    - 速度更快且生成的代码会直接访问对象实例变量的那块内存\n    - 不会调用“设置方法”\n    - 不会触发KVO，但需要确定是否会产生问题\n    - 通过给getter、setter设置断点可以进行监控和确定访问时机\n- 在写入实例变量时可以通过属性写入，读取实例变量时直接访问，可以作为一种折中方案\n- 在初始化方法及dealloc方法中，应该直接通过实例变量读取数据，即_\n- 懒加载方式中必须使用getter的方式访问属性，如果在没有用getter的情况下直接访问实例变量会导致得到是尚未设置好的变量\n\n```objectivec\n- (STFComponent*)component {\n\t\tif (!_component) {\n\t\t\t\t\t_component = [SFComponent new];\n\t\t\t}\n\t\t\treturn _component;\n\t\t}\n```\n\n## 第八节\n\n- == 操作符对比的是两个指针本身并非所指对象\n- NSString类实现了一个等同判断方法即isEqualToString，执行该方法的速度快于执行isEqual\n- 检测对象的等同性需要提供 isEqual 与 hash 方法，NSObject对于两个方法默认实现是仅当指针值完全相等才返回相等，需要针对具体的需求制定检测方案\n- 编写hash方法时需要使用计算速度快且哈希碰撞低的算法\n\n```objectivec\n- （BOOL）isEqual:(id)object {\n\t\tif (self == object) return YES; // 指向同一个对象必然相等\n\t\tif ([self class] != [object class]) return NO; //不属于同一个类不相等\n\n\t\t// 检测每一个属性是否相等\n\t\tSTFPerson *someone = (STFPerson*) object;\n\t\tif (![_firstName isEqualToString:someone.firstName])\n\t\t\treturn NO;\n\t\tif (![_lastName isEqualToString:someone.lastName])\n\t\t\treturn NO;\n\t\tif (![_age != someone.age])\n\t\t\treturn NO;\n\t\treturn YES;\n\t}\n\n - (NSUInteger)hash {\n\t\tNSUInteger firstNameHash = [_firstName hash]；\n\t\tNSUInteger lastNameHash = [_lastName hash]；\n\t\tNSUInteger ageHash = [_ageHash hash]；\n\t\treturn firstNameHash ^ lastNameHash ^ ageHash；\n\t}\n```\n\n- NSArray有等同性判定方法\"isEqualToArray:\"，而NSDictionary有等同性判定方法\"isEqualToDictionary:\"， NSArray检测方式为首先核对两个数组包含对象的个数是否相等，若相等在每个对应位置调用\"isEqual:\"方法\n- 在编写判定方法时应一并覆写\"isEqual:\"方法，如果接收该消息的对象与受测参数来自一个类就调用自己编写的判定方法，负责交由超类判定\n\n```objectivec\n-  (BOOL)isEqual:(id)object {\n\t\tif ([self class] == [object class]) \n\t\t\t\treturn [self isEqualToPerson:(STFPerson*)object];\n\t\t} else {\n\t\t\t\treturn [super isEqual: object];\n\t\t}\n```\n\n## 第九节\n\n- UIButton类使用者无需关系创建出来的按钮属于哪个子类也无需考虑按钮绘制方式等细节\n- 类族的使用需要遵循以下原则\n    - 子类应该继承自类族的抽象基类\n    - 子类应该定义自己的数据存储方式\n    - 子类应该覆写超类文档中需要覆写的方法\n\n## 第十节\n\n- 在其他做法不可行的条件下可以选用关联对象，因为这种做法同样会引入难以查找的bug（不建议使用）\n\n## 第十一节\n\n- 在编译期就能决定运行时所需要调用的函数为静态绑定，而所需要调用的函数直到运行期才能确定为动态绑定\n- runtime决定了对象收到消息后调用哪个方法，甚至在程序运行时可以改变。发送给对象的所有消息都由动态信息派发系统处理\n- objc_msgSend函数根据receive和selector的类型调用适当的方法，通过查找每个类中的“表格”查找需要执行的方法并跳转至相应的实现\n- 尾调用优化在函数的最后一项是调用另一个函数时生效，编译器生成跳转至另一个函数所需的指令码\n\n## 第十二节\n\n- 消息转发分为两个阶段\n    - 第一阶段：动态方法解析\n    - 第二阶段：消息转发机制\n  \n    ![](http://image.stephenfang.me/mweb/Untitled.png)\n\n- receiver在每一步都有机会处理消息且步骤越往后处理消息的代价越大\n- 如果对象没有办法响应某个selector则进入消息转发流程,runtime的动态方法解析可以在需要某个方法时将其加入类中，对象可以将无法解析的selector转交给其他对象处理。这一步结束后若仍然无法处理selector则启动消息转发机制\n\n## 第十三节\n\n- 在runtime中可以向类中新增或替换selector对应的方法实现，但一般只用于调试\n- method swizzling，即使用另一份实现替换原有的方法实现，可以用于向原有的实现中添加新功能\n\n## 第十四节\n\n- 每个Objective-C对象实例都有指向Class对象的指针，每个对象结构体的首个成员是Class类的变量，该变量定义了对象所属的类，通常称为\"is a\"指针\n- isMemberOfClass 判断对象是否为某个特定类的实例，isKindOfClass 判断对象是否是某类或派生类的实例\n- 动态类型特性可以用于从 collection 中获取对象（类型信息查询方法）\n- 假设名为SomeClass的子类继承自NSObject可以得到以下继承体系\n\n![](http://image.stephenfang.me/mweb/Untitled1.png)\n\n## 第十五节\n\n- 类名、分类名都应该加上相应的前缀，如果使用三方库编写自己的代码并分发尤其需要注意重复符号问题\n\n![](http://image.stephenfang.me/mweb/Untitled2.png)\n\n## 第十六节\n\n- 在类中实现一个designated initializer，尽量在文档中指明初始化需要调用该方法\n- 若designated initializer不同于超类则需覆写超类对应方法\n- 如果超类的初始化方法不适用于子类应覆写超类方法并抛出异常\n\n## 第十七节\n\n- 实现description方法能够返回一个有意义的字符串来描述实例，需要打印出类的名字和指针地址因为有时候会用到\n- 使用NSDictionary来编写description方法使代码更容易维护\n\n![](http://image.stephenfang.me/mweb/Untitled3.png)\n\n- 在调试时打印更为详尽的对象描述信息应实现debugDescription方法\n\n![](http://image.stephenfang.me/mweb/Untitled4.png)\n\n## 第十八节\n\n- 尽量创建不可变对象，把对外公开的属性设置为只读且在必要时对外公布属性\n- 某属性仅用于对象内部修改应将其从readonly改为readwrite属性\n- 可变的collection不应作为属性公开，而应提供相关方法修改可变的collection\n\n## 第十九节\n\n如果从其他框架中继承子类务必遵循命名惯例，如从UIView中继承自定义子类则类名末尾词为View，若创建自定义委托协议末尾应跟上Delegate一词。\n\n![](http://image.stephenfang.me/mweb/Untitled5.png)\n\n## 第二十节\n\n- 适当给私有方法加上前缀可以很容易将其与公共方法进行区分\n- 不应使用一个下划线做私有方法的前缀，如 _resetViewController 方法已经被苹果实现\n\n## 第二十一节\n\n- Objective-C对于异常采取的态度为：只有在极为罕见的情况下才抛出异常，并在异常抛出后无需考虑恢复问题，应用程序此时应该退出。异常应该运用于极其严重的问题\n\n![](http://image.stephenfang.me/mweb/Untitled6.png)\n\n```objectivec\n- (BOOL)doSomething:(NSError**) error\n\n- (BOOL)doSomething:(NSError**) error {\n\t// do something that may cause an error\n\n\tif ( /* there was an error */ ) {\n\t\t\tif (error) {\n\t\t\t\t\t*error = [NSErrorerrorwithDomain:domain code:code userInfo:userInfo];\n\t\t\t}\n\t\t\treturn NO;\n\t\t} else {\n\t\treturn YES;\n\t\t}\n}\n\nNSError *error = nil;\nBOOL ret = [object doSomething: &error];\nif (ret) {\n     // handle error \n}\n```\n\n![](http://image.stephenfang.me/mweb/Untitled7.png)\n\n传递给方法的是个指针，指针本身指向另一个指向NSError对象的指针，或认为其为一个直接指向NSError对象的指针。在 ARC 中，指针所指向的对象会在方法执行完毕后自动释放。\n\n## 第二十二节\n\n- 使自己的类支持拷贝操作需要实现NSCopying协议，该协议只有一个方法且不必担心zone参数。覆写copy方法真正需要实现的是copyWithZone方法。\n\n```objectivec\n- (id)copyWithZone:(NSZone*)zone\n\n- (id)copyWithZone:(NSZone*)zone {\n\t\tSTFPerson *copy = [[self class] allocWithZone:zone]initWithFirstName:_firstName andLastName:_lastName];\n\t\treturn copy;\n}\n```\n\n- 在可变对象上调用copy会返回一个不可变类的实例，可能会把NSMutableArray对象当作NSArray返回，为了安全起见使用copy和mutableCopy这两个方法复制对象\n- 深拷贝与浅拷贝\n    - 深拷贝：拷贝对象自身时一并拷贝其底层数据，需要新增一个专门执行深拷贝的方法\n    - 浅拷贝：只拷贝容器对象本身不拷贝其中数据；Foundation框架所有collection类执行拷贝的默认情况；实现copyWithZone方法\n    - 图解：\n\n   ![](http://image.stephenfang.me/mweb/Untitled8.png)\n\n## 第二十三节\n\n   ![](http://image.stephenfang.me/mweb/Untitled9.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled10.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled11.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled12.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled13.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled14.png)\n\n存放委托对象的属性需要为weak（在对象销毁时自动清空）或unsafe_unretained（不需要自动清空）。\n\n   ![](http://image.stephenfang.me/mweb/Untitled15.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled16.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled17.png)\n\n- 某个对象从另一个对象获取数据可以使用委托模式，亦成为数据源模式，数据的流动如上图所示\n- 如果有必要可以实现有段位的结构体将委托对象是否能响应相关协议的信息缓存至其中\n\n## 第二十四条\n\n- 通过分类机制将代码划分为易于管理的小块\n\n   ![](http://image.stephenfang.me/mweb/Untitled18.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled19.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled20.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled21.png)\n\n- 可以创建名为Private的分类并将私有方法放在里面，这个分类的方法只在类和框架内部使用无需对外公布\n\n## 第二十五条\n\n- 向第三方类中添加分类时给分类名与方法名加上前缀\n\n   ![](http://image.stephenfang.me/mweb/Untitled22.png)\n\n## 第二十六条\n\n- 在实现分类时所有属性都应该定义在主接口内，类所封装的所有数据都应该定义在主接口内\n\n   ![](http://image.stephenfang.me/mweb/Untitled23.png)\n\n## 第二十七条\n\n- class-continuation 分类中可以定义方法和实例变量，如下方式中_anotherInstanceVariable 是隐藏的状态\n\n    ```objectivec\n    @interface STFPerson() {\n    \t\tNSString *_anInstanceVariable;\n    }\n    // Methods declaration\n    @end\n\n    @implementation STFPerson {\n    \tint _anotherInstanceVariable;\n    }\n    // Methods implementation \n    @end\n    ```\n\n   ![](http://image.stephenfang.me/mweb/Untitled24.png)\n\n- WebKit、CoreAnimation 底层大部分代码用C++编写，对外展示的为Objective-C接口\n\n   ![](http://image.stephenfang.me/mweb/Untitled25.png)\n\n- 上图方式可以随意调用setFirstName与setLastName方法与点语法设置属性，同时外界无法修改对象，完成了类型的拓展\n\n   ![](http://image.stephenfang.me/mweb/Untitled26.png)\n\n    - 不需要在公共接口中声明类遵从了私有协议，而应该改到 class-continuation 分类内进行声明\n\n## 第二十八条\n\n- 协议可以在某种程度上提供匿名类型，具体的对象类型淡化成为遵从某个协议的id类型，协议离规定对象应该实现的方法。下图中与数据库连接相关的类名称就无法泄漏\n\n    ![](http://image.stephenfang.me/mweb/Untitled27.png)\n\n- 使用匿名对象实现类型名称的隐藏，需要注意的是对象需要能够响应定义在协议中的方法\n- 下图中其中sectionInfo为匿名对象，把section数组中返回的内部状态对象视为遵从NSFetchedResultsSectionInfo的匿名对象，隐藏了相关实现细节。\n\n    ![](http://image.stephenfang.me/mweb/Untitled28.png)\n\n## 第二十九条\n\n- 对象创建完成后引用计数至少为1，如果需要保留该对象需要调用retain方法，如果不再需要该对象则调用release、autorelease方法，当引用计数归零时对象被回收\n\n    ![](http://image.stephenfang.me/mweb/Untitled29.png)\n\n- 为了避免使用无效对象一般在完成调用release之后清空指针，保证不会出现指向无效对象的指针\n\n    ```objectivec\n    NSNumber *number = [[NSNumber alloc]initWithInt: 1234];\n    [array addObject: number];\n    [number release];\n    number = nil;\n    ```\n\n## 第三十条\n\n- ARC会自动执行retain、release、autorelease等操作，不能直接对这些方法（还包括dealloc）进行调用\n- ARC在调用这些方法并不通过Objective-C消息派发机制，而是直接调用底层C语言版本，能够带来更好的性能\n- 若方法名以以下的几个四个词语开头则表示返回的对象归调用者所有，反之返回的对象会自动释放\n    - copy\n    - mutableCopy\n    - new\n    - alloc\n\n## 第三十一条\n\n   ![](http://image.stephenfang.me/mweb/Untitled30.png)\n\n- 如果对象持有文件描述符等系统资源，应该专门写一个方法释放此类资源，用完使用close方法\n- 执行异步任务的方法和只能在正常状态下执行的方法不应在dealloc中调用\n\n## 第三十二条\n\n- ARC不生成安全处理异常所需的清理代码，开启编译器标志后可以生成这种代码但是会导致应用程序变大，且会降低运行效率\n\n   ![](http://image.stephenfang.me/mweb/Untitled31.png)\n\n## 第三十三条\n\n- 当指向EOCClassA的实例引用移除后unsafe_unretained属性仍然指向已经回收的实例，而weak属性指向nil\n\n    ![](http://image.stephenfang.me/mweb/Untitled32.png)\n\n## 第三十四条\n\n系统会自动创建一些线程，如主线程或GCD机制中的线程都有自动释放池，这些线程都有autoreleasepool，每次执行event loop就会将其清空\n\n   ![](http://image.stephenfang.me/mweb/Untitled33.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled34.png)\n\n## 第三十五条\n\n- 系统在回收对象时可以将其转化为僵尸对象，通过环境变量NSZombieEnabled可以开启该功能，或在Xcode中开启\n\n![](http://image.stephenfang.me/mweb/Untitled35.png)\n\n- 系统修改对象的isa指针指向特殊的僵尸类可以时该对象成为僵尸对鲜花，僵尸类能够响应所有的selector，在打印一条包含消息内容及接受者的消息后终止应用程序\n\n## 第三十六条\n\n在 ARC 下调用查询对象当前引用计数的方法会触发崩溃\n\n    ```objectivec\n    - (NSUInteger)retainCount\n    ```\n\n事实上该方法不应该调用，方法返回的retainCount是某个给定时间点上的数值，并未考虑系统会稍后清空自动释放池，无法反应对象生命期的全貌。\n\n## 第三十七条\n\n- Block与定义它的函数共享同一个范围内的信息，块自有其相关类型，可以将块赋值给变量并使用它\n\n    ```objectivec\n    void (^someBlock) () = ^ {\n    \t\t// Block implementation\n    };\n\n    int other = 10;\n    int (^addBlock) (int a, int b) = ^ (int a, int b) {\n    \t\treturn other + a + b;\n    };\n    int sum = addBlock(1, 2);\n    ```\n\n    - 需要在Block内修改的变量需要加上 _block 修饰符，如果将块定义在Objective-C类的实例方法中，除了可以访问类的所有的实例变量外还可以使用self变量且无需添加_block。\n    - 定义Block的时候分配的内存区域在栈上，即块只在定义的范围内有效，可以创建不会捕捉任何状态的全局块\n\n![](http://image.stephenfang.me/mweb/Untitled36.png)\n\n![](http://image.stephenfang.me/mweb/Untitled37.png)\n\n## 第三十八条\n\n![](http://image.stephenfang.me/mweb/Untitled38.png)\n\n- 以下展示了SDWebImage中Block的写法\n\n    ```objectivec\n    typedef void(^SDWebImageDownloaderProgressBlock)(NSUInteger receivedSize, long long expectedSize);\n    typedef void(^SDWebImageDownloaderCompletedBlock)(UIImage *image, NSData *data, NSError *error, BOOL finished);\n\n    ****- (void)setImageWithURL:(NSURL *)url placeholderImage:(UIImage *)placeholder options:(SDWebImageOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletedBlock)completedBlock;\n    - (id<SDWebImageOperation>)downloadImageWithURL:(NSURL *)url\n                                            options:(SDWebImageDownloaderOptions)options\n                                           progress:(SDWebImageDownloaderProgressBlock)progressBlock\n                                          completed:(SDWebImageDownloaderCompletedBlock)completedBlock;\n\n    - (id<SDWebImageOperation>)downloadImageWithURL:(NSURL *)url\n                                    timeOutInterval:(NSTimeInterval)timeOutInterval\n                                            options:(SDWebImageDownloaderOptions)options\n                                           progress:(SDWebImageDownloaderProgressBlock)progressBlock\n                                          completed:(SDWebImageDownloaderCompletedBlock)completedBlock;\n    ```\n\n## 第三十九条\n\n- 简洁程度上Delegate与Block的对比\n\n   ![](http://image.stephenfang.me/mweb/Untitled39.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled40.png)\n\n- 处理多个请求时Delegate与Block的对比\n\n   ![](http://image.stephenfang.me/mweb/Untitled41.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled42.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled43.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled44.png)\n\n- 在处理请求时采用两个独立的处理Block（1/2）\n\n   ![](http://image.stephenfang.me/mweb/Untitled45.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled46.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled47.png)\n\n- 在处理请求时采用同一个处理Block，令Block更为灵活但更为冗长\n\n   ![](http://image.stephenfang.me/mweb/Untitled48.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled49.png)\n\n## 第四十条\n\n大部分网络通信库写法\n\n   ![](http://image.stephenfang.me/mweb/Untitled50.png)\n\n为了使得在下载完成后通过以下方法执行调用者指定的Block，需要将completion handler保存至实例变量，一旦运行完completion handler之后没有必要对其进行保留，从而避免出现retain cycle\n\n   ![](http://image.stephenfang.me/mweb/Untitled51.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled52.png)\n\n## 第四十一条\n\n- 串行队列，将读取操作与写入操作安排到同个队列中保证数据同步，可以将设置方法由同步派发改为异步执派发\n\n   ![](http://image.stephenfang.me/mweb/Untitled53.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled54.png)\n\n    - 并发队列，读取与写入操作可以随时执行\n\n   ![](http://image.stephenfang.me/mweb/Untitled55.png)\n\n    创建栅栏使得barrier块单独执行不与其他Block并行，对并发队列有意义，因为串行Block按顺序逐个执行\n\n   ![](http://image.stephenfang.me/mweb/Untitled56.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled57.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled58.png)\n\n## 第四十二条\n\n- performSelector接受的参数类型为id，限定了传入参数必须是对象，不能是整数或者浮点数，并且最多只能接受两个参数\n\n   ![](http://image.stephenfang.me/mweb/Untitled59.png)\n\n- 延后执行某项任务，优先使用GCD的方式\n\n   ![](http://image.stephenfang.me/mweb/Untitled60.png)\n\n- 把任务放到主线程上执行，把任务封装至Block中用GCD相关方法更为合适\n\n   ![](http://image.stephenfang.me/mweb/Untitled61.png)\n\n- performSelector在内存管理方面存在缺失，无法确定将执行的Selector具体是什么\n\n## 第四十三条\n\n- GCD是纯C的API，操作队列是Objective-C的对象\n- Block是轻量级的书籍结构而Operation是重量级的Objective-C对象\n- 在执行后台任务时GCD并不一定是最佳方式\n- 使用NSOperation与NSOperationQueue有以下好处，能够实现纯GCD具备的绝大部分功能\n\n   ![](http://image.stephenfang.me/mweb/Untitled62.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled63.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled64.png)\n\n- NSNotificationCenter 的 addObserverForName: 方法接受的参数是块而不是Selector\n\n   ![](http://image.stephenfang.me/mweb/Untitled65.png)\n\n- 确定哪一种方法的最好方式是测试性能\n\n    ## 第四十四条\n\n- dispatch group 能够将任务分组，调用者可以等待这组任务执行完毕同时也可以在提供回调函数之后继续执行\n- 如下函数是dispatch_async的变体\n\n![](http://image.stephenfang.me/mweb/Untitled66.png)\n\n- 如下函数用于等待 dispatch group 执行完毕，timeout 参数表示阻塞时间，若执行时间短于timeout返回0\n\n![](http://image.stephenfang.me/mweb/Untitled67.png)\n\n- 如下函数中可以传入在特定线程上执行的Block\n\n![](http://image.stephenfang.me/mweb/Untitled68.png)\n\n- 令数组每个对象都执行某个任务，并且等待每个任务都执行完毕可以使用如下GCD特性\n\n![](http://image.stephenfang.me/mweb/Untitled69.png)\n\n- 若当前线程不阻塞可以使用notify函数取代wait\n\n![](http://image.stephenfang.me/mweb/Untitled70.png)\n\n- 区分任务的优先级放置于不同的线程执行，同时将所有任务归于一个dispatch group，并且在执行完毕后获得通知（并发队列）\n\n![](http://image.stephenfang.me/mweb/Untitled71.png)\n\n- 将任务提交到串行队列中并用dispatch group 跟踪执行情况\n\n![](http://image.stephenfang.me/mweb/Untitled72.png)\n\n![](http://image.stephenfang.me/mweb/Untitled73.png)\n\n## 第四十五条\n\n- 常用的一种共享单例的方法\n\n   ![](http://image.stephenfang.me/mweb/Untitled74.png)\n\n- 使用GCD实现共享单例的方法\n\n   ![](http://image.stephenfang.me/mweb/Untitled75.png)\n\n- 使用 dispatch_once 能够简化代码并且彻底保证线程安全开发者无需关心加锁或同步，所有问题都由GCD在底层进行处理，static 作用域能够保证编译器在每次执行该方法时复用该变量而不是重复创建\n\n## 第四十六条\n\n- dispatch_get_current_queue 函数尽量不要使用\n\n## 第四十七条\n\n- 框架指一系列代码被封装为动态库，并且在其中放入描述接口的头文件，iOS平台的系统框架仍然采用了动态库\n- iOS应用程序不允许在其中包含动态库于是就出现了静态库\n- 关于静态库与动态库的了解可以参考 [细说iOS静态库和动态库](https://juejin.cn/post/6844904031937101838)\n\n- Cocoa 本身并不是框架而是集成了一批创建应用程序时需要用到的框架\n- Objective-C编程的一个重要特点是经常需要用到底层的C语言级API\n- CoreAnimation 使用Objective-C进行编写，而 CoreGraphics 框架采用C语言进行编写，两者均为 UI 框架之下的一等框架\n\n## 第四十八条\n\n- 遍历方式\n    - for循环\n\n   ![](http://image.stephenfang.me/mweb/Untitled76.png)\n\n    字典与 set 均无顺序，无法根据下标访问数值。于是需要获取字典内所有键或 set 内所有对象，从而产生空间上的额外开销。然而执行反向遍历时 for 循环会更为方便。\n\n    - NSEnumerator\n\n    ```objectivec\n    // Dictionary\n    NSDictionary *dict = /* ... */;\n    NSEnumerator *enumerator = [dict keyEnumerator];\n    id key;\n    while ((key = [enumerator nextObject]) != nil) {\n    \tid value = dict[key];\n    \t// do something here\n    }\n\n    // Set\n    NSSet *set = /* ... */;\n    NSEnumerator *enumerator = [set objectEnumerator];\n    id object;\n    while ((object = [enumerator nextObject]) != nil) {\n    \t// do something here\n    }\n\n    // Array\n    NSArray *array = /* ... */;\n    NSEnumerator *enumerator = [array reverseObjectEnumerator];\n    id object;\n    while ((object = [enumerator nextObject]) != nil) {\n    \t// do something here\n    }\n    ```\n\n    对于所有的collection都可以采用这套语法，在读法上更容易被理解\n\n    - for in 快速遍历\n\n    ```objectivec\n    // Dictionary\n    NSDictionary *dict = /* ... */;\n    for (id key in dict) {\n    \tid value = dict[key];\n    \t// do something here\n    }\n\n    // Set\n    NSSet *set = /* ... */;\n    for (id object in set) {\n    \t// do something here\n    }\n\n    // Array\n    NSArray *array = /* ... */;\n    for (id object in array) {\n    \t// do something here\n    }\n    for (id object in [array reverseObjectEnumerator]) {\n    \t// do something here\n    }\n    ```\n\n    某个支持快速遍历的类的对象遵从 NSFastEnumeration 协议可以实现对象的迭代，而NSEnumerator 也实现了该协议，该遍历方法无法获取遍历操作针对的下标。\n\n    - 基于Block的遍历\n\n    ```objectivec\n    // Dictionary\n    NSDictionary *dict = /* ... */;\n    [array enumerateKeysAndObjectsUsingBlock:\n    \t^(id key, id object, BOOL *stop) {\n    \t\t// do something here\n    \t\t\tif (shouldStopHere) {\n    \t\t\t\t*stop = YES;\n    \t\t}\n    }];\n\n    // Set\n    NSSet *set = /* ... */;\n    [array enumerateObjectsUsingBlock:\n    \t^(id object, BOOL *stop) {\n    \t\t// do something here\n    \t\t\tif (shouldStopHere) {\n    \t\t\t\t*stop = YES;\n    \t\t}\n    }];\n\n    // Array\n    NSArray *array = /* ... */;\n    [array enumerateObjectsUsingBlock:\n    \t^(id object, NSUInteger idx, BOOL *stop) {\n    \t\t// do something here\n    \t\t\tif (shouldStopHere) {\n    \t\t\t\t*stop = YES;\n    \t\t}\n    }];\n    ```\n\n    使得遍历能够从Block中获取信息，并且可以在遍历数组获取数组的下标。\n\n    NSEnumerationOptions 类型为enum，如果开启了NSEnumerationConcurrent 底层会使用GCD处理出发执行事宜，采用其他方法很难实现。\n\n## 第四十九条\n\n- 使用桥接技术可以实现定义在Foundation框架内的Objective-C类与CoreFoundation 框架中的 C 数据结构的相互转换\n\n    ```objectivec\n    NSArray *anNSArray = @[@1, @2, @3, @4, @5];\n    CFArrayRef *aCGArray = (__bridge CFArrayRef)anNSArray;\n    NSLog(@\"size of array = %li\", CFArrayGetCount(aCFArray)); \n\n    gradientLayer.colors = @[(__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.95].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.95].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.72].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.45].CGColor,\n                                                (__bridge id)[UIColor ne_colorWithHexString:@\"000000\" alpha:0.28].CGColor,\n                                                ]; \n    ```\n\n- __bridge 含义为ARC具备该对象的所有权，__bridge_retained表示ARC交出该对象的所有权， 通过__bridge告诉ARC如何处理转换涉及的Objective-C对象\n- Foundation 框架中的 Objective-C 类具备的某些功能是 CoreFoundation 框架中的 C语言数据结构不具备的\n\n## 第五十条\n\n- NSCache 在系统资源耗尽时能够自动删减缓存，采用LRU策略\n- NSCache并不会直接拷贝键，而是保留键\n- NSCache是线程安全的，多个线程可以同时访问NSCache\n- NSCache可以设置针对对象个数以及总成本的上限\n\n缓存的一般用法\n\n   ![](http://image.stephenfang.me/mweb/Untitled77.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled78.png)\n\n加入 NSPurgeable 的缓存用法\n\n   ![](http://image.stephenfang.me/mweb/Untitled79.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled80.png)\n\n- 重复计算会带来性能开销的数据值得被放入缓存，从而提高应用程序的响应速度\n- NSPurgeableData 与 NSCache 一起使用能够实现自动清除数据的功能\n\n## 第五十一条\n\n- load 方法并不像普通的方法那样，她不遵从继承规则，如果某个类本身不实现load方法那么无论其各级超类是否实现此方法系统都不会调用\n- load 与 initialize 方法务必精简实现，因为会产生阻塞从而使得应用程序无响应\n- initialize 方法在程序首次用该类前调用一次，并且使用runtime进行调用，只应该用来设置内部数据而不应该调用其他方法\n- 如果某个类本身不实现 initialize 方法然而超类完成了就会调用超类的实现方法，如下图中初始化子类后由于该类未覆写该方法于是需要执行父类的实现代码，于是得到了通常的子类实现方法\n\n![](http://image.stephenfang.me/mweb/Untitled81.png)\n\n![](http://image.stephenfang.me/mweb/Untitled82.png)\n\n![](http://image.stephenfang.me/mweb/Untitled83.png)\n\n## 第五十二条\n\n- NSTimer 对象会保留目标直到计时器失效，需要调用invalidate方法令其失效\n\n   ![](http://image.stephenfang.me/mweb/Untitled84.png)\n\n   ![](http://image.stephenfang.me/mweb/Untitled85.png)\n\n- 反复执行的计时器容易引入retain cycle，可以使用 Block 的方式打破，需要注意的是必须创建分类来加入相关实现代码","slug":"EffectiveObjcTips","published":1,"updated":"2022-07-24T15:19:23.329Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1s000no76fhrax6tc4","content":"<p>准备开始写 Objective-C 之前花了一些时间重新阅读这本经典的《Effective Objective-C》，在阅读的过程中对重点内容进行了一些摘录，在方便自己复习的同时将相关内容在博客分享出来供参考。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"第一节\"><a href=\"#第一节\" class=\"headerlink\" title=\"第一节\"></a>第一节</h2><ul>\n<li>Objective-C 采用了动态绑定的消息结构，在运行时检查对象的类型，运行期环境决定了接受消息后需要执行的代码。</li>\n<li>Objective-C 对象所占内存分配在堆空间中，分配在堆空间中的内存必须直接管理。</li>\n<li>定义中不含*的变量分配在栈空间上，分配在栈的用于保存变量的内存会在栈帧弹出时自动清理。</li>\n<li>如果需要存储int、float、double、char等非对象类型推荐使用结构体。</li>\n</ul>\n<h2 id=\"第二节\"><a href=\"#第二节\" class=\"headerlink\" title=\"第二节\"></a>第二节</h2><ul>\n<li>在 .h 文件中使用@class 标识需要引入的类并且在 .m 文件中引入相关头文件，该种方式被称为向前声明，简单的说，将引入头文件的时机尽量向后可以减短编译的时间，并且能够解决互相引用问题。尽量不要引入头文件，降低类之间的耦合。</li>\n<li>有时无法使用向前声明，比如要声明某个类遵循一项协议。此时应尽量把“该类遵循某协议〞的这条声明移至“class-continuation 分类” 中。如果不行就把协议单独放在一个头文件中然后将其引人。</li>\n</ul>\n<h2 id=\"第三节\"><a href=\"#第三节\" class=\"headerlink\" title=\"第三节\"></a>第三节</h2><ul>\n<li>尽量使用字面量语法创建字符串、数值、数组、字典</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSNumber</span> *intNumber = @<span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *floatNumber = @<span class=\"number\">1.1</span>f;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *doubleNumber = @<span class=\"number\">1.123456</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *boolNumber = @YES;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *charNumber = @<span class=\"string\">&#x27;a&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> numberInt = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"keyword\">float</span> numberFloat = <span class=\"number\">1.23</span>f;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *animals = @[<span class=\"string\">@&quot;cat&quot;</span>, <span class=\"string\">@&quot;dog&quot;</span>, <span class=\"string\">@&quot;mouse&quot;</span>];</span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *dog = <span class=\"string\">@&quot;shiba&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *personData = @&#123;<span class=\"string\">@&quot;firstName&quot;</span> : <span class=\"string\">@&quot;Stephen&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t <span class=\"string\">@&quot;lastName&quot;</span> : <span class=\"string\">@&quot;Fang&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t <span class=\"string\">@&quot;gender&quot;</span> : <span class=\"string\">@&quot;male&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>NSArray 的 arrayWithObjects 方法依次处理各个参数直到发现nil，而如果使用字面量的方法在创建时就会抛出异常终止程序执行，需要确保创建的数组与字典中不含有nil</li>\n<li>尽量使用取下标的方式来访问数组或字典中的元素</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *dog = animals[<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *lastName = personData[<span class=\"string\">@&quot;lastName&quot;</span>];</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第四节\"><a href=\"#第四节\" class=\"headerlink\" title=\"第四节\"></a>第四节</h2><ul>\n<li>#define预处理指令声明全局变量尽量少用，编译器只会执行查找和替换操作，不会产生重复定义的警告信息</li>\n<li>尽量使用 static const 声明的方式来完成变量的声明，static表示该变量在定义此变量的编译单元中可见，而static const不会创建符号，只是将变量替换为常量</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">const</span> <span class=\"built_in\">NSTimeInterval</span> kAnimationDuration = <span class=\"number\">0.3</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编译器看到extern关键字得知全局符号表中包含该符号无需查看该定义就允许只用该常量，该类常量只可以定义一次，命名最好使用与之相关的类名作为前缀</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// In the header file</span></span><br><span class=\"line\"><span class=\"keyword\">extern</span> <span class=\"built_in\">NSString</span> *<span class=\"keyword\">const</span> EOCStringConstant;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// In the implementation file </span></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *<span class=\"keyword\">const</span> EOCStringConstant = <span class=\"string\">@&quot;DEMO&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第五节\"><a href=\"#第五节\" class=\"headerlink\" title=\"第五节\"></a>第五节</h2><ul>\n<li>保证枚举由底层数据类型实现，不采用编译器所选类型</li>\n<li>凡是需要以按位或操作来组合的枚举都应使用NS_OPTIONS定义，若枚举不需要相互组合应使用NS_ENUM来定义</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSUInteger</span>, STFFeedPageType) &#123;</span><br><span class=\"line\">    STFFeedPageTypeNone = <span class=\"number\">0</span>,             <span class=\"comment\">// 未知</span></span><br><span class=\"line\">    STFFeedPageTypeFollow = <span class=\"number\">1</span>,           <span class=\"comment\">// 关注页</span></span><br><span class=\"line\">    STFFeedPageTypeRecommend = <span class=\"number\">2</span>,        <span class=\"comment\">// 推荐页</span></span><br><span class=\"line\">    STFFeedPageTypeFeatured = <span class=\"number\">3</span>,         <span class=\"comment\">// 精选页</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_OPTIONS</span>(<span class=\"built_in\">NSUInteger</span>, AgoraAudioSessionOperationRestriction) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/** No restriction, the SDK has full control of the audio session operations. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionNone              = <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK does not change the audio session category. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionSetCategory       = <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK does not change any setting of the audio session (category, mode, categoryOptions). */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionConfigureSession  = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK keeps the audio session active when leaving a channel. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionDeactivateSession = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK does not configure the audio session anymore. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionAll               = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">7</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>处理枚举类型的switch语句不要实现default分支</li>\n</ul>\n<h2 id=\"第六节\"><a href=\"#第六节\" class=\"headerlink\" title=\"第六节\"></a>第六节</h2><ul>\n<li>在iOS中一般不使用atomic，因为同步锁会带来较大的开销，且无法保证线程安全</li>\n<li>尽量使用@property语法定义对象封装的数据</li>\n<li>在设置属性对应的实例变量时需要遵从属性声明的语义</li>\n<li>针对CGFloat、NSInteger此类纯量类型采用assign声明即可</li>\n<li>copy类型用于保护NSString*类型的封装性，在ARC下直接访问一个声明为copy的属性并不会直接拷贝而是保留新值释放旧值</li>\n</ul>\n<h2 id=\"第七节\"><a href=\"#第七节\" class=\"headerlink\" title=\"第七节\"></a>第七节</h2><ul>\n<li>在对象内部尽量直接访问实例变量<ul>\n<li>速度更快且生成的代码会直接访问对象实例变量的那块内存</li>\n<li>不会调用“设置方法”</li>\n<li>不会触发KVO，但需要确定是否会产生问题</li>\n<li>通过给getter、setter设置断点可以进行监控和确定访问时机</li>\n</ul>\n</li>\n<li>在写入实例变量时可以通过属性写入，读取实例变量时直接访问，可以作为一种折中方案</li>\n<li>在初始化方法及dealloc方法中，应该直接通过实例变量读取数据，即_</li>\n<li>懒加载方式中必须使用getter的方式访问属性，如果在没有用getter的情况下直接访问实例变量会导致得到是尚未设置好的变量</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (STFComponent*)component &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!_component) &#123;</span><br><span class=\"line\">\t\t\t\t\t_component = [SFComponent new];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> _component;</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第八节\"><a href=\"#第八节\" class=\"headerlink\" title=\"第八节\"></a>第八节</h2><ul>\n<li>== 操作符对比的是两个指针本身并非所指对象</li>\n<li>NSString类实现了一个等同判断方法即isEqualToString，执行该方法的速度快于执行isEqual</li>\n<li>检测对象的等同性需要提供 isEqual 与 hash 方法，NSObject对于两个方法默认实现是仅当指针值完全相等才返回相等，需要针对具体的需求制定检测方案</li>\n<li>编写hash方法时需要使用计算速度快且哈希碰撞低的算法</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- （<span class=\"built_in\">BOOL</span>）isEqual:(<span class=\"keyword\">id</span>)object &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> == object) <span class=\"keyword\">return</span> <span class=\"literal\">YES</span>; <span class=\"comment\">// 指向同一个对象必然相等</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] != [object <span class=\"keyword\">class</span>]) <span class=\"keyword\">return</span> <span class=\"literal\">NO</span>; <span class=\"comment\">//不属于同一个类不相等</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 检测每一个属性是否相等</span></span><br><span class=\"line\">\t\tSTFPerson *someone = (STFPerson*) object;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (![_firstName isEqualToString:someone.firstName])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (![_lastName isEqualToString:someone.lastName])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (![_age != someone.age])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> - (<span class=\"built_in\">NSUInteger</span>)hash &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSUInteger</span> firstNameHash = [_firstName hash]；</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSUInteger</span> lastNameHash = [_lastName hash]；</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSUInteger</span> ageHash = [_ageHash hash]；</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> firstNameHash ^ lastNameHash ^ ageHash；</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>NSArray有等同性判定方法”isEqualToArray:”，而NSDictionary有等同性判定方法”isEqualToDictionary:”， NSArray检测方式为首先核对两个数组包含对象的个数是否相等，若相等在每个对应位置调用”isEqual:”方法</li>\n<li>在编写判定方法时应一并覆写”isEqual:”方法，如果接收该消息的对象与受测参数来自一个类就调用自己编写的判定方法，负责交由超类判定</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-  (<span class=\"built_in\">BOOL</span>)isEqual:(<span class=\"keyword\">id</span>)object &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] == [object <span class=\"keyword\">class</span>]) </span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> [<span class=\"keyword\">self</span> isEqualToPerson:(STFPerson*)object];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> [<span class=\"keyword\">super</span> isEqual: object];</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第九节\"><a href=\"#第九节\" class=\"headerlink\" title=\"第九节\"></a>第九节</h2><ul>\n<li>UIButton类使用者无需关系创建出来的按钮属于哪个子类也无需考虑按钮绘制方式等细节</li>\n<li>类族的使用需要遵循以下原则<ul>\n<li>子类应该继承自类族的抽象基类</li>\n<li>子类应该定义自己的数据存储方式</li>\n<li>子类应该覆写超类文档中需要覆写的方法</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第十节\"><a href=\"#第十节\" class=\"headerlink\" title=\"第十节\"></a>第十节</h2><ul>\n<li>在其他做法不可行的条件下可以选用关联对象，因为这种做法同样会引入难以查找的bug（不建议使用）</li>\n</ul>\n<h2 id=\"第十一节\"><a href=\"#第十一节\" class=\"headerlink\" title=\"第十一节\"></a>第十一节</h2><ul>\n<li>在编译期就能决定运行时所需要调用的函数为静态绑定，而所需要调用的函数直到运行期才能确定为动态绑定</li>\n<li>runtime决定了对象收到消息后调用哪个方法，甚至在程序运行时可以改变。发送给对象的所有消息都由动态信息派发系统处理</li>\n<li>objc_msgSend函数根据receive和selector的类型调用适当的方法，通过查找每个类中的“表格”查找需要执行的方法并跳转至相应的实现</li>\n<li>尾调用优化在函数的最后一项是调用另一个函数时生效，编译器生成跳转至另一个函数所需的指令码</li>\n</ul>\n<h2 id=\"第十二节\"><a href=\"#第十二节\" class=\"headerlink\" title=\"第十二节\"></a>第十二节</h2><ul>\n<li><p>消息转发分为两个阶段</p>\n<ul>\n<li>第一阶段：动态方法解析</li>\n<li>第二阶段：消息转发机制</li>\n</ul>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled.png\"></p>\n</li>\n<li><p>receiver在每一步都有机会处理消息且步骤越往后处理消息的代价越大</p>\n</li>\n<li><p>如果对象没有办法响应某个selector则进入消息转发流程,runtime的动态方法解析可以在需要某个方法时将其加入类中，对象可以将无法解析的selector转交给其他对象处理。这一步结束后若仍然无法处理selector则启动消息转发机制</p>\n</li>\n</ul>\n<h2 id=\"第十三节\"><a href=\"#第十三节\" class=\"headerlink\" title=\"第十三节\"></a>第十三节</h2><ul>\n<li>在runtime中可以向类中新增或替换selector对应的方法实现，但一般只用于调试</li>\n<li>method swizzling，即使用另一份实现替换原有的方法实现，可以用于向原有的实现中添加新功能</li>\n</ul>\n<h2 id=\"第十四节\"><a href=\"#第十四节\" class=\"headerlink\" title=\"第十四节\"></a>第十四节</h2><ul>\n<li>每个Objective-C对象实例都有指向Class对象的指针，每个对象结构体的首个成员是Class类的变量，该变量定义了对象所属的类，通常称为”is a”指针</li>\n<li>isMemberOfClass 判断对象是否为某个特定类的实例，isKindOfClass 判断对象是否是某类或派生类的实例</li>\n<li>动态类型特性可以用于从 collection 中获取对象（类型信息查询方法）</li>\n<li>假设名为SomeClass的子类继承自NSObject可以得到以下继承体系</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled1.png\"></p>\n<h2 id=\"第十五节\"><a href=\"#第十五节\" class=\"headerlink\" title=\"第十五节\"></a>第十五节</h2><ul>\n<li>类名、分类名都应该加上相应的前缀，如果使用三方库编写自己的代码并分发尤其需要注意重复符号问题</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled2.png\"></p>\n<h2 id=\"第十六节\"><a href=\"#第十六节\" class=\"headerlink\" title=\"第十六节\"></a>第十六节</h2><ul>\n<li>在类中实现一个designated initializer，尽量在文档中指明初始化需要调用该方法</li>\n<li>若designated initializer不同于超类则需覆写超类对应方法</li>\n<li>如果超类的初始化方法不适用于子类应覆写超类方法并抛出异常</li>\n</ul>\n<h2 id=\"第十七节\"><a href=\"#第十七节\" class=\"headerlink\" title=\"第十七节\"></a>第十七节</h2><ul>\n<li>实现description方法能够返回一个有意义的字符串来描述实例，需要打印出类的名字和指针地址因为有时候会用到</li>\n<li>使用NSDictionary来编写description方法使代码更容易维护</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled3.png\"></p>\n<ul>\n<li>在调试时打印更为详尽的对象描述信息应实现debugDescription方法</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled4.png\"></p>\n<h2 id=\"第十八节\"><a href=\"#第十八节\" class=\"headerlink\" title=\"第十八节\"></a>第十八节</h2><ul>\n<li>尽量创建不可变对象，把对外公开的属性设置为只读且在必要时对外公布属性</li>\n<li>某属性仅用于对象内部修改应将其从readonly改为readwrite属性</li>\n<li>可变的collection不应作为属性公开，而应提供相关方法修改可变的collection</li>\n</ul>\n<h2 id=\"第十九节\"><a href=\"#第十九节\" class=\"headerlink\" title=\"第十九节\"></a>第十九节</h2><p>如果从其他框架中继承子类务必遵循命名惯例，如从UIView中继承自定义子类则类名末尾词为View，若创建自定义委托协议末尾应跟上Delegate一词。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled5.png\"></p>\n<h2 id=\"第二十节\"><a href=\"#第二十节\" class=\"headerlink\" title=\"第二十节\"></a>第二十节</h2><ul>\n<li>适当给私有方法加上前缀可以很容易将其与公共方法进行区分</li>\n<li>不应使用一个下划线做私有方法的前缀，如 _resetViewController 方法已经被苹果实现</li>\n</ul>\n<h2 id=\"第二十一节\"><a href=\"#第二十一节\" class=\"headerlink\" title=\"第二十一节\"></a>第二十一节</h2><ul>\n<li>Objective-C对于异常采取的态度为：只有在极为罕见的情况下才抛出异常，并在异常抛出后无需考虑恢复问题，应用程序此时应该退出。异常应该运用于极其严重的问题</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled6.png\"></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)doSomething:(<span class=\"built_in\">NSError</span>**) error</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)doSomething:(<span class=\"built_in\">NSError</span>**) error &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something that may cause an error</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ( <span class=\"comment\">/* there was an error */</span> ) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">\t\t\t\t\t*error = [<span class=\"built_in\">NSErrorerrorwithDomain</span>:domain code:code userInfo:userInfo];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSError</span> *error = <span class=\"literal\">nil</span>;</span><br><span class=\"line\"><span class=\"built_in\">BOOL</span> ret = [object doSomething: &amp;error];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (ret) &#123;</span><br><span class=\"line\">     <span class=\"comment\">// handle error </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled7.png\"></p>\n<p>传递给方法的是个指针，指针本身指向另一个指向NSError对象的指针，或认为其为一个直接指向NSError对象的指针。在 ARC 中，指针所指向的对象会在方法执行完毕后自动释放。</p>\n<h2 id=\"第二十二节\"><a href=\"#第二十二节\" class=\"headerlink\" title=\"第二十二节\"></a>第二十二节</h2><ul>\n<li>使自己的类支持拷贝操作需要实现NSCopying协议，该协议只有一个方法且不必担心zone参数。覆写copy方法真正需要实现的是copyWithZone方法。</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"built_in\">NSZone</span>*)zone</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"built_in\">NSZone</span>*)zone &#123;</span><br><span class=\"line\">\t\tSTFPerson *<span class=\"keyword\">copy</span> = [[<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] allocWithZone:zone]initWithFirstName:_firstName andLastName:_lastName];</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">copy</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在可变对象上调用copy会返回一个不可变类的实例，可能会把NSMutableArray对象当作NSArray返回，为了安全起见使用copy和mutableCopy这两个方法复制对象</p>\n</li>\n<li><p>深拷贝与浅拷贝</p>\n<ul>\n<li>深拷贝：拷贝对象自身时一并拷贝其底层数据，需要新增一个专门执行深拷贝的方法</li>\n<li>浅拷贝：只拷贝容器对象本身不拷贝其中数据；Foundation框架所有collection类执行拷贝的默认情况；实现copyWithZone方法</li>\n<li>图解：</li>\n</ul>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled8.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十三节\"><a href=\"#第二十三节\" class=\"headerlink\" title=\"第二十三节\"></a>第二十三节</h2><p>   <img src=\"http://image.stephenfang.me/mweb/Untitled9.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled10.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled11.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled12.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled13.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled14.png\"></p>\n<p>存放委托对象的属性需要为weak（在对象销毁时自动清空）或unsafe_unretained（不需要自动清空）。</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled15.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled16.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled17.png\"></p>\n<ul>\n<li>某个对象从另一个对象获取数据可以使用委托模式，亦成为数据源模式，数据的流动如上图所示</li>\n<li>如果有必要可以实现有段位的结构体将委托对象是否能响应相关协议的信息缓存至其中</li>\n</ul>\n<h2 id=\"第二十四条\"><a href=\"#第二十四条\" class=\"headerlink\" title=\"第二十四条\"></a>第二十四条</h2><ul>\n<li><p>通过分类机制将代码划分为易于管理的小块</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled18.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled19.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled20.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled21.png\"></p>\n</li>\n<li><p>可以创建名为Private的分类并将私有方法放在里面，这个分类的方法只在类和框架内部使用无需对外公布</p>\n</li>\n</ul>\n<h2 id=\"第二十五条\"><a href=\"#第二十五条\" class=\"headerlink\" title=\"第二十五条\"></a>第二十五条</h2><ul>\n<li><p>向第三方类中添加分类时给分类名与方法名加上前缀</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled22.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十六条\"><a href=\"#第二十六条\" class=\"headerlink\" title=\"第二十六条\"></a>第二十六条</h2><ul>\n<li><p>在实现分类时所有属性都应该定义在主接口内，类所封装的所有数据都应该定义在主接口内</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled23.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十七条\"><a href=\"#第二十七条\" class=\"headerlink\" title=\"第二十七条\"></a>第二十七条</h2><ul>\n<li><p>class-continuation 分类中可以定义方法和实例变量，如下方式中_anotherInstanceVariable 是隐藏的状态</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">STFPerson</span>() </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSString</span> *_anInstanceVariable;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Methods declaration</span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">STFPerson</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> _anotherInstanceVariable;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Methods implementation </span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled24.png\"></p>\n</li>\n<li><p>WebKit、CoreAnimation 底层大部分代码用C++编写，对外展示的为Objective-C接口</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled25.png\"></p>\n</li>\n<li><p>上图方式可以随意调用setFirstName与setLastName方法与点语法设置属性，同时外界无法修改对象，完成了类型的拓展</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled26.png\"></p>\n<ul>\n<li>不需要在公共接口中声明类遵从了私有协议，而应该改到 class-continuation 分类内进行声明</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第二十八条\"><a href=\"#第二十八条\" class=\"headerlink\" title=\"第二十八条\"></a>第二十八条</h2><ul>\n<li><p>协议可以在某种程度上提供匿名类型，具体的对象类型淡化成为遵从某个协议的id类型，协议离规定对象应该实现的方法。下图中与数据库连接相关的类名称就无法泄漏</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled27.png\"></p>\n</li>\n<li><p>使用匿名对象实现类型名称的隐藏，需要注意的是对象需要能够响应定义在协议中的方法</p>\n</li>\n<li><p>下图中其中sectionInfo为匿名对象，把section数组中返回的内部状态对象视为遵从NSFetchedResultsSectionInfo的匿名对象，隐藏了相关实现细节。</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled28.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十九条\"><a href=\"#第二十九条\" class=\"headerlink\" title=\"第二十九条\"></a>第二十九条</h2><ul>\n<li><p>对象创建完成后引用计数至少为1，如果需要保留该对象需要调用retain方法，如果不再需要该对象则调用release、autorelease方法，当引用计数归零时对象被回收</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled29.png\"></p>\n</li>\n<li><p>为了避免使用无效对象一般在完成调用release之后清空指针，保证不会出现指向无效对象的指针</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSNumber</span> *number = [[<span class=\"built_in\">NSNumber</span> alloc]initWithInt: <span class=\"number\">1234</span>];</span><br><span class=\"line\">[array addObject: number];</span><br><span class=\"line\">[number release];</span><br><span class=\"line\">number = <span class=\"literal\">nil</span>;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"第三十条\"><a href=\"#第三十条\" class=\"headerlink\" title=\"第三十条\"></a>第三十条</h2><ul>\n<li>ARC会自动执行retain、release、autorelease等操作，不能直接对这些方法（还包括dealloc）进行调用</li>\n<li>ARC在调用这些方法并不通过Objective-C消息派发机制，而是直接调用底层C语言版本，能够带来更好的性能</li>\n<li>若方法名以以下的几个四个词语开头则表示返回的对象归调用者所有，反之返回的对象会自动释放<ul>\n<li>copy</li>\n<li>mutableCopy</li>\n<li>new</li>\n<li>alloc</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第三十一条\"><a href=\"#第三十一条\" class=\"headerlink\" title=\"第三十一条\"></a>第三十一条</h2><p>   <img src=\"http://image.stephenfang.me/mweb/Untitled30.png\"></p>\n<ul>\n<li>如果对象持有文件描述符等系统资源，应该专门写一个方法释放此类资源，用完使用close方法</li>\n<li>执行异步任务的方法和只能在正常状态下执行的方法不应在dealloc中调用</li>\n</ul>\n<h2 id=\"第三十二条\"><a href=\"#第三十二条\" class=\"headerlink\" title=\"第三十二条\"></a>第三十二条</h2><ul>\n<li><p>ARC不生成安全处理异常所需的清理代码，开启编译器标志后可以生成这种代码但是会导致应用程序变大，且会降低运行效率</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled31.png\"></p>\n</li>\n</ul>\n<h2 id=\"第三十三条\"><a href=\"#第三十三条\" class=\"headerlink\" title=\"第三十三条\"></a>第三十三条</h2><ul>\n<li><p>当指向EOCClassA的实例引用移除后unsafe_unretained属性仍然指向已经回收的实例，而weak属性指向nil</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled32.png\"></p>\n</li>\n</ul>\n<h2 id=\"第三十四条\"><a href=\"#第三十四条\" class=\"headerlink\" title=\"第三十四条\"></a>第三十四条</h2><p>系统会自动创建一些线程，如主线程或GCD机制中的线程都有自动释放池，这些线程都有autoreleasepool，每次执行event loop就会将其清空</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled33.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled34.png\"></p>\n<h2 id=\"第三十五条\"><a href=\"#第三十五条\" class=\"headerlink\" title=\"第三十五条\"></a>第三十五条</h2><ul>\n<li>系统在回收对象时可以将其转化为僵尸对象，通过环境变量NSZombieEnabled可以开启该功能，或在Xcode中开启</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled35.png\"></p>\n<ul>\n<li>系统修改对象的isa指针指向特殊的僵尸类可以时该对象成为僵尸对鲜花，僵尸类能够响应所有的selector，在打印一条包含消息内容及接受者的消息后终止应用程序</li>\n</ul>\n<h2 id=\"第三十六条\"><a href=\"#第三十六条\" class=\"headerlink\" title=\"第三十六条\"></a>第三十六条</h2><p>在 ARC 下调用查询对象当前引用计数的方法会触发崩溃</p>\n<pre><code><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSUInteger</span>)retainCount</span><br></pre></td></tr></table></figure>\n</code></pre>\n<p>事实上该方法不应该调用，方法返回的retainCount是某个给定时间点上的数值，并未考虑系统会稍后清空自动释放池，无法反应对象生命期的全貌。</p>\n<h2 id=\"第三十七条\"><a href=\"#第三十七条\" class=\"headerlink\" title=\"第三十七条\"></a>第三十七条</h2><ul>\n<li><p>Block与定义它的函数共享同一个范围内的信息，块自有其相关类型，可以将块赋值给变量并使用它</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> (^someBlock) () = ^ &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Block implementation</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> other = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> (^addBlock) (<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b) = ^ (<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> other + a + b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">int</span> sum = addBlock(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>需要在Block内修改的变量需要加上 _block 修饰符，如果将块定义在Objective-C类的实例方法中，除了可以访问类的所有的实例变量外还可以使用self变量且无需添加_block。</li>\n<li>定义Block的时候分配的内存区域在栈上，即块只在定义的范围内有效，可以创建不会捕捉任何状态的全局块</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled36.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled37.png\"></p>\n<h2 id=\"第三十八条\"><a href=\"#第三十八条\" class=\"headerlink\" title=\"第三十八条\"></a>第三十八条</h2><p><img src=\"http://image.stephenfang.me/mweb/Untitled38.png\"></p>\n<ul>\n<li><p>以下展示了SDWebImage中Block的写法</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">void</span>(^SDWebImageDownloaderProgressBlock)(<span class=\"built_in\">NSUInteger</span> receivedSize, <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> expectedSize);</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">void</span>(^SDWebImageDownloaderCompletedBlock)(<span class=\"built_in\">UIImage</span> *image, <span class=\"built_in\">NSData</span> *data, <span class=\"built_in\">NSError</span> *error, <span class=\"built_in\">BOOL</span> finished);</span><br><span class=\"line\"></span><br><span class=\"line\">****- (<span class=\"keyword\">void</span>)setImageWithURL:(<span class=\"built_in\">NSURL</span> *)url placeholderImage:(<span class=\"built_in\">UIImage</span> *)placeholder options:(SDWebImageOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletedBlock)completedBlock;</span><br><span class=\"line\">- (<span class=\"keyword\">id</span>&lt;SDWebImageOperation&gt;)downloadImageWithURL:(<span class=\"built_in\">NSURL</span> *)url</span><br><span class=\"line\">                                        options:(SDWebImageDownloaderOptions)options</span><br><span class=\"line\">                                       progress:(SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class=\"line\">                                      completed:(SDWebImageDownloaderCompletedBlock)completedBlock;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">id</span>&lt;SDWebImageOperation&gt;)downloadImageWithURL:(<span class=\"built_in\">NSURL</span> *)url</span><br><span class=\"line\">                                timeOutInterval:(<span class=\"built_in\">NSTimeInterval</span>)timeOutInterval</span><br><span class=\"line\">                                        options:(SDWebImageDownloaderOptions)options</span><br><span class=\"line\">                                       progress:(SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class=\"line\">                                      completed:(SDWebImageDownloaderCompletedBlock)completedBlock;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"第三十九条\"><a href=\"#第三十九条\" class=\"headerlink\" title=\"第三十九条\"></a>第三十九条</h2><ul>\n<li><p>简洁程度上Delegate与Block的对比</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled39.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled40.png\"></p>\n</li>\n<li><p>处理多个请求时Delegate与Block的对比</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled41.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled42.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled43.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled44.png\"></p>\n</li>\n<li><p>在处理请求时采用两个独立的处理Block（1/2）</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled45.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled46.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled47.png\"></p>\n</li>\n<li><p>在处理请求时采用同一个处理Block，令Block更为灵活但更为冗长</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled48.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled49.png\"></p>\n</li>\n</ul>\n<h2 id=\"第四十条\"><a href=\"#第四十条\" class=\"headerlink\" title=\"第四十条\"></a>第四十条</h2><p>大部分网络通信库写法</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled50.png\"></p>\n<p>为了使得在下载完成后通过以下方法执行调用者指定的Block，需要将completion handler保存至实例变量，一旦运行完completion handler之后没有必要对其进行保留，从而避免出现retain cycle</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled51.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled52.png\"></p>\n<h2 id=\"第四十一条\"><a href=\"#第四十一条\" class=\"headerlink\" title=\"第四十一条\"></a>第四十一条</h2><ul>\n<li><p>串行队列，将读取操作与写入操作安排到同个队列中保证数据同步，可以将设置方法由同步派发改为异步执派发</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled53.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled54.png\"></p>\n<ul>\n<li>并发队列，读取与写入操作可以随时执行</li>\n</ul>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled55.png\"></p>\n<p>  创建栅栏使得barrier块单独执行不与其他Block并行，对并发队列有意义，因为串行Block按顺序逐个执行</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled56.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled57.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled58.png\"></p>\n</li>\n</ul>\n<h2 id=\"第四十二条\"><a href=\"#第四十二条\" class=\"headerlink\" title=\"第四十二条\"></a>第四十二条</h2><ul>\n<li><p>performSelector接受的参数类型为id，限定了传入参数必须是对象，不能是整数或者浮点数，并且最多只能接受两个参数</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled59.png\"></p>\n</li>\n<li><p>延后执行某项任务，优先使用GCD的方式</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled60.png\"></p>\n</li>\n<li><p>把任务放到主线程上执行，把任务封装至Block中用GCD相关方法更为合适</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled61.png\"></p>\n</li>\n<li><p>performSelector在内存管理方面存在缺失，无法确定将执行的Selector具体是什么</p>\n</li>\n</ul>\n<h2 id=\"第四十三条\"><a href=\"#第四十三条\" class=\"headerlink\" title=\"第四十三条\"></a>第四十三条</h2><ul>\n<li><p>GCD是纯C的API，操作队列是Objective-C的对象</p>\n</li>\n<li><p>Block是轻量级的书籍结构而Operation是重量级的Objective-C对象</p>\n</li>\n<li><p>在执行后台任务时GCD并不一定是最佳方式</p>\n</li>\n<li><p>使用NSOperation与NSOperationQueue有以下好处，能够实现纯GCD具备的绝大部分功能</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled62.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled63.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled64.png\"></p>\n</li>\n<li><p>NSNotificationCenter 的 addObserverForName: 方法接受的参数是块而不是Selector</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled65.png\"></p>\n</li>\n<li><p>确定哪一种方法的最好方式是测试性能</p>\n<h2 id=\"第四十四条\"><a href=\"#第四十四条\" class=\"headerlink\" title=\"第四十四条\"></a>第四十四条</h2></li>\n<li><p>dispatch group 能够将任务分组，调用者可以等待这组任务执行完毕同时也可以在提供回调函数之后继续执行</p>\n</li>\n<li><p>如下函数是dispatch_async的变体</p>\n</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled66.png\"></p>\n<ul>\n<li>如下函数用于等待 dispatch group 执行完毕，timeout 参数表示阻塞时间，若执行时间短于timeout返回0</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled67.png\"></p>\n<ul>\n<li>如下函数中可以传入在特定线程上执行的Block</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled68.png\"></p>\n<ul>\n<li>令数组每个对象都执行某个任务，并且等待每个任务都执行完毕可以使用如下GCD特性</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled69.png\"></p>\n<ul>\n<li>若当前线程不阻塞可以使用notify函数取代wait</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled70.png\"></p>\n<ul>\n<li>区分任务的优先级放置于不同的线程执行，同时将所有任务归于一个dispatch group，并且在执行完毕后获得通知（并发队列）</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled71.png\"></p>\n<ul>\n<li>将任务提交到串行队列中并用dispatch group 跟踪执行情况</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled72.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled73.png\"></p>\n<h2 id=\"第四十五条\"><a href=\"#第四十五条\" class=\"headerlink\" title=\"第四十五条\"></a>第四十五条</h2><ul>\n<li><p>常用的一种共享单例的方法</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled74.png\"></p>\n</li>\n<li><p>使用GCD实现共享单例的方法</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled75.png\"></p>\n</li>\n<li><p>使用 dispatch_once 能够简化代码并且彻底保证线程安全开发者无需关心加锁或同步，所有问题都由GCD在底层进行处理，static 作用域能够保证编译器在每次执行该方法时复用该变量而不是重复创建</p>\n</li>\n</ul>\n<h2 id=\"第四十六条\"><a href=\"#第四十六条\" class=\"headerlink\" title=\"第四十六条\"></a>第四十六条</h2><ul>\n<li>dispatch_get_current_queue 函数尽量不要使用</li>\n</ul>\n<h2 id=\"第四十七条\"><a href=\"#第四十七条\" class=\"headerlink\" title=\"第四十七条\"></a>第四十七条</h2><ul>\n<li><p>框架指一系列代码被封装为动态库，并且在其中放入描述接口的头文件，iOS平台的系统框架仍然采用了动态库</p>\n</li>\n<li><p>iOS应用程序不允许在其中包含动态库于是就出现了静态库</p>\n</li>\n<li><p>关于静态库与动态库的了解可以参考 <a href=\"https://juejin.cn/post/6844904031937101838\">细说iOS静态库和动态库</a></p>\n</li>\n<li><p>Cocoa 本身并不是框架而是集成了一批创建应用程序时需要用到的框架</p>\n</li>\n<li><p>Objective-C编程的一个重要特点是经常需要用到底层的C语言级API</p>\n</li>\n<li><p>CoreAnimation 使用Objective-C进行编写，而 CoreGraphics 框架采用C语言进行编写，两者均为 UI 框架之下的一等框架</p>\n</li>\n</ul>\n<h2 id=\"第四十八条\"><a href=\"#第四十八条\" class=\"headerlink\" title=\"第四十八条\"></a>第四十八条</h2><ul>\n<li><p>遍历方式</p>\n<ul>\n<li>for循环</li>\n</ul>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled76.png\"></p>\n<p>  字典与 set 均无顺序，无法根据下标访问数值。于是需要获取字典内所有键或 set 内所有对象，从而产生空间上的额外开销。然而执行反向遍历时 for 循环会更为方便。</p>\n<ul>\n<li>NSEnumerator</li>\n</ul>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dictionary</span></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *dict = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSEnumerator</span> *enumerator = [dict keyEnumerator];</span><br><span class=\"line\"><span class=\"keyword\">id</span> key;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ((key = [enumerator nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">id</span> value = dict[key];</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set</span></span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSEnumerator</span> *enumerator = [set objectEnumerator];</span><br><span class=\"line\"><span class=\"keyword\">id</span> object;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ((object = [enumerator nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Array</span></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *array = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSEnumerator</span> *enumerator = [array reverseObjectEnumerator];</span><br><span class=\"line\"><span class=\"keyword\">id</span> object;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ((object = [enumerator nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  对于所有的collection都可以采用这套语法，在读法上更容易被理解</p>\n<ul>\n<li>for in 快速遍历</li>\n</ul>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dictionary</span></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *dict = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> key <span class=\"keyword\">in</span> dict) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">id</span> value = dict[key];</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set</span></span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> object <span class=\"keyword\">in</span> set) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Array</span></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *array = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> object <span class=\"keyword\">in</span> array) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> object <span class=\"keyword\">in</span> [array reverseObjectEnumerator]) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  某个支持快速遍历的类的对象遵从 NSFastEnumeration 协议可以实现对象的迭代，而NSEnumerator 也实现了该协议，该遍历方法无法获取遍历操作针对的下标。</p>\n<ul>\n<li>基于Block的遍历</li>\n</ul>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dictionary</span></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *dict = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\">[array enumerateKeysAndObjectsUsingBlock:</span><br><span class=\"line\">\t^(<span class=\"keyword\">id</span> key, <span class=\"keyword\">id</span> object, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (shouldStopHere) &#123;</span><br><span class=\"line\">\t\t\t\t*stop = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set</span></span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\">[array enumerateObjectsUsingBlock:</span><br><span class=\"line\">\t^(<span class=\"keyword\">id</span> object, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (shouldStopHere) &#123;</span><br><span class=\"line\">\t\t\t\t*stop = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Array</span></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *array = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\">[array enumerateObjectsUsingBlock:</span><br><span class=\"line\">\t^(<span class=\"keyword\">id</span> object, <span class=\"built_in\">NSUInteger</span> idx, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (shouldStopHere) &#123;</span><br><span class=\"line\">\t\t\t\t*stop = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n\n<p>  使得遍历能够从Block中获取信息，并且可以在遍历数组获取数组的下标。</p>\n<p>  NSEnumerationOptions 类型为enum，如果开启了NSEnumerationConcurrent 底层会使用GCD处理出发执行事宜，采用其他方法很难实现。</p>\n</li>\n</ul>\n<h2 id=\"第四十九条\"><a href=\"#第四十九条\" class=\"headerlink\" title=\"第四十九条\"></a>第四十九条</h2><ul>\n<li><p>使用桥接技术可以实现定义在Foundation框架内的Objective-C类与CoreFoundation 框架中的 C 数据结构的相互转换</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSArray</span> *anNSArray = @[@<span class=\"number\">1</span>, @<span class=\"number\">2</span>, @<span class=\"number\">3</span>, @<span class=\"number\">4</span>, @<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"built_in\">CFArrayRef</span> *aCGArray = (__bridge <span class=\"built_in\">CFArrayRef</span>)anNSArray;</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;size of array = %li&quot;</span>, <span class=\"built_in\">CFArrayGetCount</span>(aCFArray)); </span><br><span class=\"line\"></span><br><span class=\"line\">gradientLayer.colors = @[(__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.95</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.95</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.72</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.45</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.28</span>].CGColor,</span><br><span class=\"line\">                                            ]; </span><br></pre></td></tr></table></figure></li>\n<li><p>__bridge 含义为ARC具备该对象的所有权，__bridge_retained表示ARC交出该对象的所有权， 通过__bridge告诉ARC如何处理转换涉及的Objective-C对象</p>\n</li>\n<li><p>Foundation 框架中的 Objective-C 类具备的某些功能是 CoreFoundation 框架中的 C语言数据结构不具备的</p>\n</li>\n</ul>\n<h2 id=\"第五十条\"><a href=\"#第五十条\" class=\"headerlink\" title=\"第五十条\"></a>第五十条</h2><ul>\n<li>NSCache 在系统资源耗尽时能够自动删减缓存，采用LRU策略</li>\n<li>NSCache并不会直接拷贝键，而是保留键</li>\n<li>NSCache是线程安全的，多个线程可以同时访问NSCache</li>\n<li>NSCache可以设置针对对象个数以及总成本的上限</li>\n</ul>\n<p>缓存的一般用法</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled77.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled78.png\"></p>\n<p>加入 NSPurgeable 的缓存用法</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled79.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled80.png\"></p>\n<ul>\n<li>重复计算会带来性能开销的数据值得被放入缓存，从而提高应用程序的响应速度</li>\n<li>NSPurgeableData 与 NSCache 一起使用能够实现自动清除数据的功能</li>\n</ul>\n<h2 id=\"第五十一条\"><a href=\"#第五十一条\" class=\"headerlink\" title=\"第五十一条\"></a>第五十一条</h2><ul>\n<li>load 方法并不像普通的方法那样，她不遵从继承规则，如果某个类本身不实现load方法那么无论其各级超类是否实现此方法系统都不会调用</li>\n<li>load 与 initialize 方法务必精简实现，因为会产生阻塞从而使得应用程序无响应</li>\n<li>initialize 方法在程序首次用该类前调用一次，并且使用runtime进行调用，只应该用来设置内部数据而不应该调用其他方法</li>\n<li>如果某个类本身不实现 initialize 方法然而超类完成了就会调用超类的实现方法，如下图中初始化子类后由于该类未覆写该方法于是需要执行父类的实现代码，于是得到了通常的子类实现方法</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled81.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled82.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled83.png\"></p>\n<h2 id=\"第五十二条\"><a href=\"#第五十二条\" class=\"headerlink\" title=\"第五十二条\"></a>第五十二条</h2><ul>\n<li><p>NSTimer 对象会保留目标直到计时器失效，需要调用invalidate方法令其失效</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled84.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled85.png\"></p>\n</li>\n<li><p>反复执行的计时器容易引入retain cycle，可以使用 Block 的方式打破，需要注意的是必须创建分类来加入相关实现代码</p>\n</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>准备开始写 Objective-C 之前花了一些时间重新阅读这本经典的《Effective Objective-C》，在阅读的过程中对重点内容进行了一些摘录，在方便自己复习的同时将相关内容在博客分享出来供参考。</p>","more":"<h2 id=\"第一节\"><a href=\"#第一节\" class=\"headerlink\" title=\"第一节\"></a>第一节</h2><ul>\n<li>Objective-C 采用了动态绑定的消息结构，在运行时检查对象的类型，运行期环境决定了接受消息后需要执行的代码。</li>\n<li>Objective-C 对象所占内存分配在堆空间中，分配在堆空间中的内存必须直接管理。</li>\n<li>定义中不含*的变量分配在栈空间上，分配在栈的用于保存变量的内存会在栈帧弹出时自动清理。</li>\n<li>如果需要存储int、float、double、char等非对象类型推荐使用结构体。</li>\n</ul>\n<h2 id=\"第二节\"><a href=\"#第二节\" class=\"headerlink\" title=\"第二节\"></a>第二节</h2><ul>\n<li>在 .h 文件中使用@class 标识需要引入的类并且在 .m 文件中引入相关头文件，该种方式被称为向前声明，简单的说，将引入头文件的时机尽量向后可以减短编译的时间，并且能够解决互相引用问题。尽量不要引入头文件，降低类之间的耦合。</li>\n<li>有时无法使用向前声明，比如要声明某个类遵循一项协议。此时应尽量把“该类遵循某协议〞的这条声明移至“class-continuation 分类” 中。如果不行就把协议单独放在一个头文件中然后将其引人。</li>\n</ul>\n<h2 id=\"第三节\"><a href=\"#第三节\" class=\"headerlink\" title=\"第三节\"></a>第三节</h2><ul>\n<li>尽量使用字面量语法创建字符串、数值、数组、字典</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSNumber</span> *intNumber = @<span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *floatNumber = @<span class=\"number\">1.1</span>f;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *doubleNumber = @<span class=\"number\">1.123456</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *boolNumber = @YES;</span><br><span class=\"line\"><span class=\"built_in\">NSNumber</span> *charNumber = @<span class=\"string\">&#x27;a&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> numberInt = <span class=\"number\">5</span>;</span><br><span class=\"line\"><span class=\"keyword\">float</span> numberFloat = <span class=\"number\">1.23</span>f;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *animals = @[<span class=\"string\">@&quot;cat&quot;</span>, <span class=\"string\">@&quot;dog&quot;</span>, <span class=\"string\">@&quot;mouse&quot;</span>];</span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *dog = <span class=\"string\">@&quot;shiba&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *personData = @&#123;<span class=\"string\">@&quot;firstName&quot;</span> : <span class=\"string\">@&quot;Stephen&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t <span class=\"string\">@&quot;lastName&quot;</span> : <span class=\"string\">@&quot;Fang&quot;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t\t\t <span class=\"string\">@&quot;gender&quot;</span> : <span class=\"string\">@&quot;male&quot;</span>&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>NSArray 的 arrayWithObjects 方法依次处理各个参数直到发现nil，而如果使用字面量的方法在创建时就会抛出异常终止程序执行，需要确保创建的数组与字典中不含有nil</li>\n<li>尽量使用取下标的方式来访问数组或字典中的元素</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSString</span> *dog = animals[<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *lastName = personData[<span class=\"string\">@&quot;lastName&quot;</span>];</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第四节\"><a href=\"#第四节\" class=\"headerlink\" title=\"第四节\"></a>第四节</h2><ul>\n<li>#define预处理指令声明全局变量尽量少用，编译器只会执行查找和替换操作，不会产生重复定义的警告信息</li>\n<li>尽量使用 static const 声明的方式来完成变量的声明，static表示该变量在定义此变量的编译单元中可见，而static const不会创建符号，只是将变量替换为常量</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">const</span> <span class=\"built_in\">NSTimeInterval</span> kAnimationDuration = <span class=\"number\">0.3</span>;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>编译器看到extern关键字得知全局符号表中包含该符号无需查看该定义就允许只用该常量，该类常量只可以定义一次，命名最好使用与之相关的类名作为前缀</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// In the header file</span></span><br><span class=\"line\"><span class=\"keyword\">extern</span> <span class=\"built_in\">NSString</span> *<span class=\"keyword\">const</span> EOCStringConstant;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// In the implementation file </span></span><br><span class=\"line\"><span class=\"built_in\">NSString</span> *<span class=\"keyword\">const</span> EOCStringConstant = <span class=\"string\">@&quot;DEMO&quot;</span>;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第五节\"><a href=\"#第五节\" class=\"headerlink\" title=\"第五节\"></a>第五节</h2><ul>\n<li>保证枚举由底层数据类型实现，不采用编译器所选类型</li>\n<li>凡是需要以按位或操作来组合的枚举都应使用NS_OPTIONS定义，若枚举不需要相互组合应使用NS_ENUM来定义</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSUInteger</span>, STFFeedPageType) &#123;</span><br><span class=\"line\">    STFFeedPageTypeNone = <span class=\"number\">0</span>,             <span class=\"comment\">// 未知</span></span><br><span class=\"line\">    STFFeedPageTypeFollow = <span class=\"number\">1</span>,           <span class=\"comment\">// 关注页</span></span><br><span class=\"line\">    STFFeedPageTypeRecommend = <span class=\"number\">2</span>,        <span class=\"comment\">// 推荐页</span></span><br><span class=\"line\">    STFFeedPageTypeFeatured = <span class=\"number\">3</span>,         <span class=\"comment\">// 精选页</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_OPTIONS</span>(<span class=\"built_in\">NSUInteger</span>, AgoraAudioSessionOperationRestriction) &#123;</span><br><span class=\"line\">    <span class=\"comment\">/** No restriction, the SDK has full control of the audio session operations. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionNone              = <span class=\"number\">0</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK does not change the audio session category. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionSetCategory       = <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK does not change any setting of the audio session (category, mode, categoryOptions). */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionConfigureSession  = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">1</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK keeps the audio session active when leaving a channel. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionDeactivateSession = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">2</span>,</span><br><span class=\"line\">    <span class=\"comment\">/** The SDK does not configure the audio session anymore. */</span></span><br><span class=\"line\">    AgoraAudioSessionOperationRestrictionAll               = <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">7</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>处理枚举类型的switch语句不要实现default分支</li>\n</ul>\n<h2 id=\"第六节\"><a href=\"#第六节\" class=\"headerlink\" title=\"第六节\"></a>第六节</h2><ul>\n<li>在iOS中一般不使用atomic，因为同步锁会带来较大的开销，且无法保证线程安全</li>\n<li>尽量使用@property语法定义对象封装的数据</li>\n<li>在设置属性对应的实例变量时需要遵从属性声明的语义</li>\n<li>针对CGFloat、NSInteger此类纯量类型采用assign声明即可</li>\n<li>copy类型用于保护NSString*类型的封装性，在ARC下直接访问一个声明为copy的属性并不会直接拷贝而是保留新值释放旧值</li>\n</ul>\n<h2 id=\"第七节\"><a href=\"#第七节\" class=\"headerlink\" title=\"第七节\"></a>第七节</h2><ul>\n<li>在对象内部尽量直接访问实例变量<ul>\n<li>速度更快且生成的代码会直接访问对象实例变量的那块内存</li>\n<li>不会调用“设置方法”</li>\n<li>不会触发KVO，但需要确定是否会产生问题</li>\n<li>通过给getter、setter设置断点可以进行监控和确定访问时机</li>\n</ul>\n</li>\n<li>在写入实例变量时可以通过属性写入，读取实例变量时直接访问，可以作为一种折中方案</li>\n<li>在初始化方法及dealloc方法中，应该直接通过实例变量读取数据，即_</li>\n<li>懒加载方式中必须使用getter的方式访问属性，如果在没有用getter的情况下直接访问实例变量会导致得到是尚未设置好的变量</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (STFComponent*)component &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!_component) &#123;</span><br><span class=\"line\">\t\t\t\t\t_component = [SFComponent new];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> _component;</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第八节\"><a href=\"#第八节\" class=\"headerlink\" title=\"第八节\"></a>第八节</h2><ul>\n<li>== 操作符对比的是两个指针本身并非所指对象</li>\n<li>NSString类实现了一个等同判断方法即isEqualToString，执行该方法的速度快于执行isEqual</li>\n<li>检测对象的等同性需要提供 isEqual 与 hash 方法，NSObject对于两个方法默认实现是仅当指针值完全相等才返回相等，需要针对具体的需求制定检测方案</li>\n<li>编写hash方法时需要使用计算速度快且哈希碰撞低的算法</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- （<span class=\"built_in\">BOOL</span>）isEqual:(<span class=\"keyword\">id</span>)object &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"keyword\">self</span> == object) <span class=\"keyword\">return</span> <span class=\"literal\">YES</span>; <span class=\"comment\">// 指向同一个对象必然相等</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] != [object <span class=\"keyword\">class</span>]) <span class=\"keyword\">return</span> <span class=\"literal\">NO</span>; <span class=\"comment\">//不属于同一个类不相等</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">// 检测每一个属性是否相等</span></span><br><span class=\"line\">\t\tSTFPerson *someone = (STFPerson*) object;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (![_firstName isEqualToString:someone.firstName])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (![_lastName isEqualToString:someone.lastName])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (![_age != someone.age])</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> - (<span class=\"built_in\">NSUInteger</span>)hash &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSUInteger</span> firstNameHash = [_firstName hash]；</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSUInteger</span> lastNameHash = [_lastName hash]；</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSUInteger</span> ageHash = [_ageHash hash]；</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> firstNameHash ^ lastNameHash ^ ageHash；</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>NSArray有等同性判定方法”isEqualToArray:”，而NSDictionary有等同性判定方法”isEqualToDictionary:”， NSArray检测方式为首先核对两个数组包含对象的个数是否相等，若相等在每个对应位置调用”isEqual:”方法</li>\n<li>在编写判定方法时应一并覆写”isEqual:”方法，如果接收该消息的对象与受测参数来自一个类就调用自己编写的判定方法，负责交由超类判定</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-  (<span class=\"built_in\">BOOL</span>)isEqual:(<span class=\"keyword\">id</span>)object &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ([<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] == [object <span class=\"keyword\">class</span>]) </span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> [<span class=\"keyword\">self</span> isEqualToPerson:(STFPerson*)object];</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> [<span class=\"keyword\">super</span> isEqual: object];</span><br><span class=\"line\">\t\t&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"第九节\"><a href=\"#第九节\" class=\"headerlink\" title=\"第九节\"></a>第九节</h2><ul>\n<li>UIButton类使用者无需关系创建出来的按钮属于哪个子类也无需考虑按钮绘制方式等细节</li>\n<li>类族的使用需要遵循以下原则<ul>\n<li>子类应该继承自类族的抽象基类</li>\n<li>子类应该定义自己的数据存储方式</li>\n<li>子类应该覆写超类文档中需要覆写的方法</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第十节\"><a href=\"#第十节\" class=\"headerlink\" title=\"第十节\"></a>第十节</h2><ul>\n<li>在其他做法不可行的条件下可以选用关联对象，因为这种做法同样会引入难以查找的bug（不建议使用）</li>\n</ul>\n<h2 id=\"第十一节\"><a href=\"#第十一节\" class=\"headerlink\" title=\"第十一节\"></a>第十一节</h2><ul>\n<li>在编译期就能决定运行时所需要调用的函数为静态绑定，而所需要调用的函数直到运行期才能确定为动态绑定</li>\n<li>runtime决定了对象收到消息后调用哪个方法，甚至在程序运行时可以改变。发送给对象的所有消息都由动态信息派发系统处理</li>\n<li>objc_msgSend函数根据receive和selector的类型调用适当的方法，通过查找每个类中的“表格”查找需要执行的方法并跳转至相应的实现</li>\n<li>尾调用优化在函数的最后一项是调用另一个函数时生效，编译器生成跳转至另一个函数所需的指令码</li>\n</ul>\n<h2 id=\"第十二节\"><a href=\"#第十二节\" class=\"headerlink\" title=\"第十二节\"></a>第十二节</h2><ul>\n<li><p>消息转发分为两个阶段</p>\n<ul>\n<li>第一阶段：动态方法解析</li>\n<li>第二阶段：消息转发机制</li>\n</ul>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled.png\"></p>\n</li>\n<li><p>receiver在每一步都有机会处理消息且步骤越往后处理消息的代价越大</p>\n</li>\n<li><p>如果对象没有办法响应某个selector则进入消息转发流程,runtime的动态方法解析可以在需要某个方法时将其加入类中，对象可以将无法解析的selector转交给其他对象处理。这一步结束后若仍然无法处理selector则启动消息转发机制</p>\n</li>\n</ul>\n<h2 id=\"第十三节\"><a href=\"#第十三节\" class=\"headerlink\" title=\"第十三节\"></a>第十三节</h2><ul>\n<li>在runtime中可以向类中新增或替换selector对应的方法实现，但一般只用于调试</li>\n<li>method swizzling，即使用另一份实现替换原有的方法实现，可以用于向原有的实现中添加新功能</li>\n</ul>\n<h2 id=\"第十四节\"><a href=\"#第十四节\" class=\"headerlink\" title=\"第十四节\"></a>第十四节</h2><ul>\n<li>每个Objective-C对象实例都有指向Class对象的指针，每个对象结构体的首个成员是Class类的变量，该变量定义了对象所属的类，通常称为”is a”指针</li>\n<li>isMemberOfClass 判断对象是否为某个特定类的实例，isKindOfClass 判断对象是否是某类或派生类的实例</li>\n<li>动态类型特性可以用于从 collection 中获取对象（类型信息查询方法）</li>\n<li>假设名为SomeClass的子类继承自NSObject可以得到以下继承体系</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled1.png\"></p>\n<h2 id=\"第十五节\"><a href=\"#第十五节\" class=\"headerlink\" title=\"第十五节\"></a>第十五节</h2><ul>\n<li>类名、分类名都应该加上相应的前缀，如果使用三方库编写自己的代码并分发尤其需要注意重复符号问题</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled2.png\"></p>\n<h2 id=\"第十六节\"><a href=\"#第十六节\" class=\"headerlink\" title=\"第十六节\"></a>第十六节</h2><ul>\n<li>在类中实现一个designated initializer，尽量在文档中指明初始化需要调用该方法</li>\n<li>若designated initializer不同于超类则需覆写超类对应方法</li>\n<li>如果超类的初始化方法不适用于子类应覆写超类方法并抛出异常</li>\n</ul>\n<h2 id=\"第十七节\"><a href=\"#第十七节\" class=\"headerlink\" title=\"第十七节\"></a>第十七节</h2><ul>\n<li>实现description方法能够返回一个有意义的字符串来描述实例，需要打印出类的名字和指针地址因为有时候会用到</li>\n<li>使用NSDictionary来编写description方法使代码更容易维护</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled3.png\"></p>\n<ul>\n<li>在调试时打印更为详尽的对象描述信息应实现debugDescription方法</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled4.png\"></p>\n<h2 id=\"第十八节\"><a href=\"#第十八节\" class=\"headerlink\" title=\"第十八节\"></a>第十八节</h2><ul>\n<li>尽量创建不可变对象，把对外公开的属性设置为只读且在必要时对外公布属性</li>\n<li>某属性仅用于对象内部修改应将其从readonly改为readwrite属性</li>\n<li>可变的collection不应作为属性公开，而应提供相关方法修改可变的collection</li>\n</ul>\n<h2 id=\"第十九节\"><a href=\"#第十九节\" class=\"headerlink\" title=\"第十九节\"></a>第十九节</h2><p>如果从其他框架中继承子类务必遵循命名惯例，如从UIView中继承自定义子类则类名末尾词为View，若创建自定义委托协议末尾应跟上Delegate一词。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled5.png\"></p>\n<h2 id=\"第二十节\"><a href=\"#第二十节\" class=\"headerlink\" title=\"第二十节\"></a>第二十节</h2><ul>\n<li>适当给私有方法加上前缀可以很容易将其与公共方法进行区分</li>\n<li>不应使用一个下划线做私有方法的前缀，如 _resetViewController 方法已经被苹果实现</li>\n</ul>\n<h2 id=\"第二十一节\"><a href=\"#第二十一节\" class=\"headerlink\" title=\"第二十一节\"></a>第二十一节</h2><ul>\n<li>Objective-C对于异常采取的态度为：只有在极为罕见的情况下才抛出异常，并在异常抛出后无需考虑恢复问题，应用程序此时应该退出。异常应该运用于极其严重的问题</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled6.png\"></p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)doSomething:(<span class=\"built_in\">NSError</span>**) error</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"built_in\">BOOL</span>)doSomething:(<span class=\"built_in\">NSError</span>**) error &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something that may cause an error</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ( <span class=\"comment\">/* there was an error */</span> ) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (error) &#123;</span><br><span class=\"line\">\t\t\t\t\t*error = [<span class=\"built_in\">NSErrorerrorwithDomain</span>:domain code:code userInfo:userInfo];</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NO</span>;</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">NSError</span> *error = <span class=\"literal\">nil</span>;</span><br><span class=\"line\"><span class=\"built_in\">BOOL</span> ret = [object doSomething: &amp;error];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (ret) &#123;</span><br><span class=\"line\">     <span class=\"comment\">// handle error </span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled7.png\"></p>\n<p>传递给方法的是个指针，指针本身指向另一个指向NSError对象的指针，或认为其为一个直接指向NSError对象的指针。在 ARC 中，指针所指向的对象会在方法执行完毕后自动释放。</p>\n<h2 id=\"第二十二节\"><a href=\"#第二十二节\" class=\"headerlink\" title=\"第二十二节\"></a>第二十二节</h2><ul>\n<li>使自己的类支持拷贝操作需要实现NSCopying协议，该协议只有一个方法且不必担心zone参数。覆写copy方法真正需要实现的是copyWithZone方法。</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"built_in\">NSZone</span>*)zone</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"built_in\">NSZone</span>*)zone &#123;</span><br><span class=\"line\">\t\tSTFPerson *<span class=\"keyword\">copy</span> = [[<span class=\"keyword\">self</span> <span class=\"keyword\">class</span>] allocWithZone:zone]initWithFirstName:_firstName andLastName:_lastName];</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">copy</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li><p>在可变对象上调用copy会返回一个不可变类的实例，可能会把NSMutableArray对象当作NSArray返回，为了安全起见使用copy和mutableCopy这两个方法复制对象</p>\n</li>\n<li><p>深拷贝与浅拷贝</p>\n<ul>\n<li>深拷贝：拷贝对象自身时一并拷贝其底层数据，需要新增一个专门执行深拷贝的方法</li>\n<li>浅拷贝：只拷贝容器对象本身不拷贝其中数据；Foundation框架所有collection类执行拷贝的默认情况；实现copyWithZone方法</li>\n<li>图解：</li>\n</ul>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled8.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十三节\"><a href=\"#第二十三节\" class=\"headerlink\" title=\"第二十三节\"></a>第二十三节</h2><p>   <img src=\"http://image.stephenfang.me/mweb/Untitled9.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled10.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled11.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled12.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled13.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled14.png\"></p>\n<p>存放委托对象的属性需要为weak（在对象销毁时自动清空）或unsafe_unretained（不需要自动清空）。</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled15.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled16.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled17.png\"></p>\n<ul>\n<li>某个对象从另一个对象获取数据可以使用委托模式，亦成为数据源模式，数据的流动如上图所示</li>\n<li>如果有必要可以实现有段位的结构体将委托对象是否能响应相关协议的信息缓存至其中</li>\n</ul>\n<h2 id=\"第二十四条\"><a href=\"#第二十四条\" class=\"headerlink\" title=\"第二十四条\"></a>第二十四条</h2><ul>\n<li><p>通过分类机制将代码划分为易于管理的小块</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled18.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled19.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled20.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled21.png\"></p>\n</li>\n<li><p>可以创建名为Private的分类并将私有方法放在里面，这个分类的方法只在类和框架内部使用无需对外公布</p>\n</li>\n</ul>\n<h2 id=\"第二十五条\"><a href=\"#第二十五条\" class=\"headerlink\" title=\"第二十五条\"></a>第二十五条</h2><ul>\n<li><p>向第三方类中添加分类时给分类名与方法名加上前缀</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled22.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十六条\"><a href=\"#第二十六条\" class=\"headerlink\" title=\"第二十六条\"></a>第二十六条</h2><ul>\n<li><p>在实现分类时所有属性都应该定义在主接口内，类所封装的所有数据都应该定义在主接口内</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled23.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十七条\"><a href=\"#第二十七条\" class=\"headerlink\" title=\"第二十七条\"></a>第二十七条</h2><ul>\n<li><p>class-continuation 分类中可以定义方法和实例变量，如下方式中_anotherInstanceVariable 是隐藏的状态</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">STFPerson</span>() </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">NSString</span> *_anInstanceVariable;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Methods declaration</span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">STFPerson</span> </span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">int</span> _anotherInstanceVariable;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// Methods implementation </span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled24.png\"></p>\n</li>\n<li><p>WebKit、CoreAnimation 底层大部分代码用C++编写，对外展示的为Objective-C接口</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled25.png\"></p>\n</li>\n<li><p>上图方式可以随意调用setFirstName与setLastName方法与点语法设置属性，同时外界无法修改对象，完成了类型的拓展</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled26.png\"></p>\n<ul>\n<li>不需要在公共接口中声明类遵从了私有协议，而应该改到 class-continuation 分类内进行声明</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第二十八条\"><a href=\"#第二十八条\" class=\"headerlink\" title=\"第二十八条\"></a>第二十八条</h2><ul>\n<li><p>协议可以在某种程度上提供匿名类型，具体的对象类型淡化成为遵从某个协议的id类型，协议离规定对象应该实现的方法。下图中与数据库连接相关的类名称就无法泄漏</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled27.png\"></p>\n</li>\n<li><p>使用匿名对象实现类型名称的隐藏，需要注意的是对象需要能够响应定义在协议中的方法</p>\n</li>\n<li><p>下图中其中sectionInfo为匿名对象，把section数组中返回的内部状态对象视为遵从NSFetchedResultsSectionInfo的匿名对象，隐藏了相关实现细节。</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled28.png\"></p>\n</li>\n</ul>\n<h2 id=\"第二十九条\"><a href=\"#第二十九条\" class=\"headerlink\" title=\"第二十九条\"></a>第二十九条</h2><ul>\n<li><p>对象创建完成后引用计数至少为1，如果需要保留该对象需要调用retain方法，如果不再需要该对象则调用release、autorelease方法，当引用计数归零时对象被回收</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled29.png\"></p>\n</li>\n<li><p>为了避免使用无效对象一般在完成调用release之后清空指针，保证不会出现指向无效对象的指针</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSNumber</span> *number = [[<span class=\"built_in\">NSNumber</span> alloc]initWithInt: <span class=\"number\">1234</span>];</span><br><span class=\"line\">[array addObject: number];</span><br><span class=\"line\">[number release];</span><br><span class=\"line\">number = <span class=\"literal\">nil</span>;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"第三十条\"><a href=\"#第三十条\" class=\"headerlink\" title=\"第三十条\"></a>第三十条</h2><ul>\n<li>ARC会自动执行retain、release、autorelease等操作，不能直接对这些方法（还包括dealloc）进行调用</li>\n<li>ARC在调用这些方法并不通过Objective-C消息派发机制，而是直接调用底层C语言版本，能够带来更好的性能</li>\n<li>若方法名以以下的几个四个词语开头则表示返回的对象归调用者所有，反之返回的对象会自动释放<ul>\n<li>copy</li>\n<li>mutableCopy</li>\n<li>new</li>\n<li>alloc</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"第三十一条\"><a href=\"#第三十一条\" class=\"headerlink\" title=\"第三十一条\"></a>第三十一条</h2><p>   <img src=\"http://image.stephenfang.me/mweb/Untitled30.png\"></p>\n<ul>\n<li>如果对象持有文件描述符等系统资源，应该专门写一个方法释放此类资源，用完使用close方法</li>\n<li>执行异步任务的方法和只能在正常状态下执行的方法不应在dealloc中调用</li>\n</ul>\n<h2 id=\"第三十二条\"><a href=\"#第三十二条\" class=\"headerlink\" title=\"第三十二条\"></a>第三十二条</h2><ul>\n<li><p>ARC不生成安全处理异常所需的清理代码，开启编译器标志后可以生成这种代码但是会导致应用程序变大，且会降低运行效率</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled31.png\"></p>\n</li>\n</ul>\n<h2 id=\"第三十三条\"><a href=\"#第三十三条\" class=\"headerlink\" title=\"第三十三条\"></a>第三十三条</h2><ul>\n<li><p>当指向EOCClassA的实例引用移除后unsafe_unretained属性仍然指向已经回收的实例，而weak属性指向nil</p>\n<p>  <img src=\"http://image.stephenfang.me/mweb/Untitled32.png\"></p>\n</li>\n</ul>\n<h2 id=\"第三十四条\"><a href=\"#第三十四条\" class=\"headerlink\" title=\"第三十四条\"></a>第三十四条</h2><p>系统会自动创建一些线程，如主线程或GCD机制中的线程都有自动释放池，这些线程都有autoreleasepool，每次执行event loop就会将其清空</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled33.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled34.png\"></p>\n<h2 id=\"第三十五条\"><a href=\"#第三十五条\" class=\"headerlink\" title=\"第三十五条\"></a>第三十五条</h2><ul>\n<li>系统在回收对象时可以将其转化为僵尸对象，通过环境变量NSZombieEnabled可以开启该功能，或在Xcode中开启</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled35.png\"></p>\n<ul>\n<li>系统修改对象的isa指针指向特殊的僵尸类可以时该对象成为僵尸对鲜花，僵尸类能够响应所有的selector，在打印一条包含消息内容及接受者的消息后终止应用程序</li>\n</ul>\n<h2 id=\"第三十六条\"><a href=\"#第三十六条\" class=\"headerlink\" title=\"第三十六条\"></a>第三十六条</h2><p>在 ARC 下调用查询对象当前引用计数的方法会触发崩溃</p>\n<pre><code><figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSUInteger</span>)retainCount</span><br></pre></td></tr></table></figure>\n</code></pre>\n<p>事实上该方法不应该调用，方法返回的retainCount是某个给定时间点上的数值，并未考虑系统会稍后清空自动释放池，无法反应对象生命期的全貌。</p>\n<h2 id=\"第三十七条\"><a href=\"#第三十七条\" class=\"headerlink\" title=\"第三十七条\"></a>第三十七条</h2><ul>\n<li><p>Block与定义它的函数共享同一个范围内的信息，块自有其相关类型，可以将块赋值给变量并使用它</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> (^someBlock) () = ^ &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Block implementation</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> other = <span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"keyword\">int</span> (^addBlock) (<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b) = ^ (<span class=\"keyword\">int</span> a, <span class=\"keyword\">int</span> b) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> other + a + b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"><span class=\"keyword\">int</span> sum = addBlock(<span class=\"number\">1</span>, <span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>需要在Block内修改的变量需要加上 _block 修饰符，如果将块定义在Objective-C类的实例方法中，除了可以访问类的所有的实例变量外还可以使用self变量且无需添加_block。</li>\n<li>定义Block的时候分配的内存区域在栈上，即块只在定义的范围内有效，可以创建不会捕捉任何状态的全局块</li>\n</ul>\n</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled36.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled37.png\"></p>\n<h2 id=\"第三十八条\"><a href=\"#第三十八条\" class=\"headerlink\" title=\"第三十八条\"></a>第三十八条</h2><p><img src=\"http://image.stephenfang.me/mweb/Untitled38.png\"></p>\n<ul>\n<li><p>以下展示了SDWebImage中Block的写法</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">void</span>(^SDWebImageDownloaderProgressBlock)(<span class=\"built_in\">NSUInteger</span> receivedSize, <span class=\"keyword\">long</span> <span class=\"keyword\">long</span> expectedSize);</span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"keyword\">void</span>(^SDWebImageDownloaderCompletedBlock)(<span class=\"built_in\">UIImage</span> *image, <span class=\"built_in\">NSData</span> *data, <span class=\"built_in\">NSError</span> *error, <span class=\"built_in\">BOOL</span> finished);</span><br><span class=\"line\"></span><br><span class=\"line\">****- (<span class=\"keyword\">void</span>)setImageWithURL:(<span class=\"built_in\">NSURL</span> *)url placeholderImage:(<span class=\"built_in\">UIImage</span> *)placeholder options:(SDWebImageOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletedBlock)completedBlock;</span><br><span class=\"line\">- (<span class=\"keyword\">id</span>&lt;SDWebImageOperation&gt;)downloadImageWithURL:(<span class=\"built_in\">NSURL</span> *)url</span><br><span class=\"line\">                                        options:(SDWebImageDownloaderOptions)options</span><br><span class=\"line\">                                       progress:(SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class=\"line\">                                      completed:(SDWebImageDownloaderCompletedBlock)completedBlock;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">id</span>&lt;SDWebImageOperation&gt;)downloadImageWithURL:(<span class=\"built_in\">NSURL</span> *)url</span><br><span class=\"line\">                                timeOutInterval:(<span class=\"built_in\">NSTimeInterval</span>)timeOutInterval</span><br><span class=\"line\">                                        options:(SDWebImageDownloaderOptions)options</span><br><span class=\"line\">                                       progress:(SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class=\"line\">                                      completed:(SDWebImageDownloaderCompletedBlock)completedBlock;</span><br></pre></td></tr></table></figure></li>\n</ul>\n<h2 id=\"第三十九条\"><a href=\"#第三十九条\" class=\"headerlink\" title=\"第三十九条\"></a>第三十九条</h2><ul>\n<li><p>简洁程度上Delegate与Block的对比</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled39.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled40.png\"></p>\n</li>\n<li><p>处理多个请求时Delegate与Block的对比</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled41.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled42.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled43.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled44.png\"></p>\n</li>\n<li><p>在处理请求时采用两个独立的处理Block（1/2）</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled45.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled46.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled47.png\"></p>\n</li>\n<li><p>在处理请求时采用同一个处理Block，令Block更为灵活但更为冗长</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled48.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled49.png\"></p>\n</li>\n</ul>\n<h2 id=\"第四十条\"><a href=\"#第四十条\" class=\"headerlink\" title=\"第四十条\"></a>第四十条</h2><p>大部分网络通信库写法</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled50.png\"></p>\n<p>为了使得在下载完成后通过以下方法执行调用者指定的Block，需要将completion handler保存至实例变量，一旦运行完completion handler之后没有必要对其进行保留，从而避免出现retain cycle</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled51.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled52.png\"></p>\n<h2 id=\"第四十一条\"><a href=\"#第四十一条\" class=\"headerlink\" title=\"第四十一条\"></a>第四十一条</h2><ul>\n<li><p>串行队列，将读取操作与写入操作安排到同个队列中保证数据同步，可以将设置方法由同步派发改为异步执派发</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled53.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled54.png\"></p>\n<ul>\n<li>并发队列，读取与写入操作可以随时执行</li>\n</ul>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled55.png\"></p>\n<p>  创建栅栏使得barrier块单独执行不与其他Block并行，对并发队列有意义，因为串行Block按顺序逐个执行</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled56.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled57.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled58.png\"></p>\n</li>\n</ul>\n<h2 id=\"第四十二条\"><a href=\"#第四十二条\" class=\"headerlink\" title=\"第四十二条\"></a>第四十二条</h2><ul>\n<li><p>performSelector接受的参数类型为id，限定了传入参数必须是对象，不能是整数或者浮点数，并且最多只能接受两个参数</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled59.png\"></p>\n</li>\n<li><p>延后执行某项任务，优先使用GCD的方式</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled60.png\"></p>\n</li>\n<li><p>把任务放到主线程上执行，把任务封装至Block中用GCD相关方法更为合适</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled61.png\"></p>\n</li>\n<li><p>performSelector在内存管理方面存在缺失，无法确定将执行的Selector具体是什么</p>\n</li>\n</ul>\n<h2 id=\"第四十三条\"><a href=\"#第四十三条\" class=\"headerlink\" title=\"第四十三条\"></a>第四十三条</h2><ul>\n<li><p>GCD是纯C的API，操作队列是Objective-C的对象</p>\n</li>\n<li><p>Block是轻量级的书籍结构而Operation是重量级的Objective-C对象</p>\n</li>\n<li><p>在执行后台任务时GCD并不一定是最佳方式</p>\n</li>\n<li><p>使用NSOperation与NSOperationQueue有以下好处，能够实现纯GCD具备的绝大部分功能</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled62.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled63.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled64.png\"></p>\n</li>\n<li><p>NSNotificationCenter 的 addObserverForName: 方法接受的参数是块而不是Selector</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled65.png\"></p>\n</li>\n<li><p>确定哪一种方法的最好方式是测试性能</p>\n<h2 id=\"第四十四条\"><a href=\"#第四十四条\" class=\"headerlink\" title=\"第四十四条\"></a>第四十四条</h2></li>\n<li><p>dispatch group 能够将任务分组，调用者可以等待这组任务执行完毕同时也可以在提供回调函数之后继续执行</p>\n</li>\n<li><p>如下函数是dispatch_async的变体</p>\n</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled66.png\"></p>\n<ul>\n<li>如下函数用于等待 dispatch group 执行完毕，timeout 参数表示阻塞时间，若执行时间短于timeout返回0</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled67.png\"></p>\n<ul>\n<li>如下函数中可以传入在特定线程上执行的Block</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled68.png\"></p>\n<ul>\n<li>令数组每个对象都执行某个任务，并且等待每个任务都执行完毕可以使用如下GCD特性</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled69.png\"></p>\n<ul>\n<li>若当前线程不阻塞可以使用notify函数取代wait</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled70.png\"></p>\n<ul>\n<li>区分任务的优先级放置于不同的线程执行，同时将所有任务归于一个dispatch group，并且在执行完毕后获得通知（并发队列）</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled71.png\"></p>\n<ul>\n<li>将任务提交到串行队列中并用dispatch group 跟踪执行情况</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled72.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled73.png\"></p>\n<h2 id=\"第四十五条\"><a href=\"#第四十五条\" class=\"headerlink\" title=\"第四十五条\"></a>第四十五条</h2><ul>\n<li><p>常用的一种共享单例的方法</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled74.png\"></p>\n</li>\n<li><p>使用GCD实现共享单例的方法</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled75.png\"></p>\n</li>\n<li><p>使用 dispatch_once 能够简化代码并且彻底保证线程安全开发者无需关心加锁或同步，所有问题都由GCD在底层进行处理，static 作用域能够保证编译器在每次执行该方法时复用该变量而不是重复创建</p>\n</li>\n</ul>\n<h2 id=\"第四十六条\"><a href=\"#第四十六条\" class=\"headerlink\" title=\"第四十六条\"></a>第四十六条</h2><ul>\n<li>dispatch_get_current_queue 函数尽量不要使用</li>\n</ul>\n<h2 id=\"第四十七条\"><a href=\"#第四十七条\" class=\"headerlink\" title=\"第四十七条\"></a>第四十七条</h2><ul>\n<li><p>框架指一系列代码被封装为动态库，并且在其中放入描述接口的头文件，iOS平台的系统框架仍然采用了动态库</p>\n</li>\n<li><p>iOS应用程序不允许在其中包含动态库于是就出现了静态库</p>\n</li>\n<li><p>关于静态库与动态库的了解可以参考 <a href=\"https://juejin.cn/post/6844904031937101838\">细说iOS静态库和动态库</a></p>\n</li>\n<li><p>Cocoa 本身并不是框架而是集成了一批创建应用程序时需要用到的框架</p>\n</li>\n<li><p>Objective-C编程的一个重要特点是经常需要用到底层的C语言级API</p>\n</li>\n<li><p>CoreAnimation 使用Objective-C进行编写，而 CoreGraphics 框架采用C语言进行编写，两者均为 UI 框架之下的一等框架</p>\n</li>\n</ul>\n<h2 id=\"第四十八条\"><a href=\"#第四十八条\" class=\"headerlink\" title=\"第四十八条\"></a>第四十八条</h2><ul>\n<li><p>遍历方式</p>\n<ul>\n<li>for循环</li>\n</ul>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled76.png\"></p>\n<p>  字典与 set 均无顺序，无法根据下标访问数值。于是需要获取字典内所有键或 set 内所有对象，从而产生空间上的额外开销。然而执行反向遍历时 for 循环会更为方便。</p>\n<ul>\n<li>NSEnumerator</li>\n</ul>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dictionary</span></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *dict = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSEnumerator</span> *enumerator = [dict keyEnumerator];</span><br><span class=\"line\"><span class=\"keyword\">id</span> key;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ((key = [enumerator nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">id</span> value = dict[key];</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set</span></span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSEnumerator</span> *enumerator = [set objectEnumerator];</span><br><span class=\"line\"><span class=\"keyword\">id</span> object;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ((object = [enumerator nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Array</span></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *array = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"built_in\">NSEnumerator</span> *enumerator = [array reverseObjectEnumerator];</span><br><span class=\"line\"><span class=\"keyword\">id</span> object;</span><br><span class=\"line\"><span class=\"keyword\">while</span> ((object = [enumerator nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  对于所有的collection都可以采用这套语法，在读法上更容易被理解</p>\n<ul>\n<li>for in 快速遍历</li>\n</ul>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dictionary</span></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *dict = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> key <span class=\"keyword\">in</span> dict) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">id</span> value = dict[key];</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set</span></span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> object <span class=\"keyword\">in</span> set) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Array</span></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *array = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> object <span class=\"keyword\">in</span> array) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">for</span> (<span class=\"keyword\">id</span> object <span class=\"keyword\">in</span> [array reverseObjectEnumerator]) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>  某个支持快速遍历的类的对象遵从 NSFastEnumeration 协议可以实现对象的迭代，而NSEnumerator 也实现了该协议，该遍历方法无法获取遍历操作针对的下标。</p>\n<ul>\n<li>基于Block的遍历</li>\n</ul>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Dictionary</span></span><br><span class=\"line\"><span class=\"built_in\">NSDictionary</span> *dict = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\">[array enumerateKeysAndObjectsUsingBlock:</span><br><span class=\"line\">\t^(<span class=\"keyword\">id</span> key, <span class=\"keyword\">id</span> object, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (shouldStopHere) &#123;</span><br><span class=\"line\">\t\t\t\t*stop = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set</span></span><br><span class=\"line\"><span class=\"built_in\">NSSet</span> *set = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\">[array enumerateObjectsUsingBlock:</span><br><span class=\"line\">\t^(<span class=\"keyword\">id</span> object, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (shouldStopHere) &#123;</span><br><span class=\"line\">\t\t\t\t*stop = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Array</span></span><br><span class=\"line\"><span class=\"built_in\">NSArray</span> *array = <span class=\"comment\">/* ... */</span>;</span><br><span class=\"line\">[array enumerateObjectsUsingBlock:</span><br><span class=\"line\">\t^(<span class=\"keyword\">id</span> object, <span class=\"built_in\">NSUInteger</span> idx, <span class=\"built_in\">BOOL</span> *stop) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// do something here</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (shouldStopHere) &#123;</span><br><span class=\"line\">\t\t\t\t*stop = <span class=\"literal\">YES</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">&#125;];</span><br></pre></td></tr></table></figure>\n\n<p>  使得遍历能够从Block中获取信息，并且可以在遍历数组获取数组的下标。</p>\n<p>  NSEnumerationOptions 类型为enum，如果开启了NSEnumerationConcurrent 底层会使用GCD处理出发执行事宜，采用其他方法很难实现。</p>\n</li>\n</ul>\n<h2 id=\"第四十九条\"><a href=\"#第四十九条\" class=\"headerlink\" title=\"第四十九条\"></a>第四十九条</h2><ul>\n<li><p>使用桥接技术可以实现定义在Foundation框架内的Objective-C类与CoreFoundation 框架中的 C 数据结构的相互转换</p>\n  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSArray</span> *anNSArray = @[@<span class=\"number\">1</span>, @<span class=\"number\">2</span>, @<span class=\"number\">3</span>, @<span class=\"number\">4</span>, @<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"built_in\">CFArrayRef</span> *aCGArray = (__bridge <span class=\"built_in\">CFArrayRef</span>)anNSArray;</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;size of array = %li&quot;</span>, <span class=\"built_in\">CFArrayGetCount</span>(aCFArray)); </span><br><span class=\"line\"></span><br><span class=\"line\">gradientLayer.colors = @[(__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.95</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.95</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.72</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.45</span>].CGColor,</span><br><span class=\"line\">                                            (__bridge <span class=\"keyword\">id</span>)[<span class=\"built_in\">UIColor</span> ne_colorWithHexString:<span class=\"string\">@&quot;000000&quot;</span> alpha:<span class=\"number\">0.28</span>].CGColor,</span><br><span class=\"line\">                                            ]; </span><br></pre></td></tr></table></figure></li>\n<li><p>__bridge 含义为ARC具备该对象的所有权，__bridge_retained表示ARC交出该对象的所有权， 通过__bridge告诉ARC如何处理转换涉及的Objective-C对象</p>\n</li>\n<li><p>Foundation 框架中的 Objective-C 类具备的某些功能是 CoreFoundation 框架中的 C语言数据结构不具备的</p>\n</li>\n</ul>\n<h2 id=\"第五十条\"><a href=\"#第五十条\" class=\"headerlink\" title=\"第五十条\"></a>第五十条</h2><ul>\n<li>NSCache 在系统资源耗尽时能够自动删减缓存，采用LRU策略</li>\n<li>NSCache并不会直接拷贝键，而是保留键</li>\n<li>NSCache是线程安全的，多个线程可以同时访问NSCache</li>\n<li>NSCache可以设置针对对象个数以及总成本的上限</li>\n</ul>\n<p>缓存的一般用法</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled77.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled78.png\"></p>\n<p>加入 NSPurgeable 的缓存用法</p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled79.png\"></p>\n<p>   <img src=\"http://image.stephenfang.me/mweb/Untitled80.png\"></p>\n<ul>\n<li>重复计算会带来性能开销的数据值得被放入缓存，从而提高应用程序的响应速度</li>\n<li>NSPurgeableData 与 NSCache 一起使用能够实现自动清除数据的功能</li>\n</ul>\n<h2 id=\"第五十一条\"><a href=\"#第五十一条\" class=\"headerlink\" title=\"第五十一条\"></a>第五十一条</h2><ul>\n<li>load 方法并不像普通的方法那样，她不遵从继承规则，如果某个类本身不实现load方法那么无论其各级超类是否实现此方法系统都不会调用</li>\n<li>load 与 initialize 方法务必精简实现，因为会产生阻塞从而使得应用程序无响应</li>\n<li>initialize 方法在程序首次用该类前调用一次，并且使用runtime进行调用，只应该用来设置内部数据而不应该调用其他方法</li>\n<li>如果某个类本身不实现 initialize 方法然而超类完成了就会调用超类的实现方法，如下图中初始化子类后由于该类未覆写该方法于是需要执行父类的实现代码，于是得到了通常的子类实现方法</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled81.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled82.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled83.png\"></p>\n<h2 id=\"第五十二条\"><a href=\"#第五十二条\" class=\"headerlink\" title=\"第五十二条\"></a>第五十二条</h2><ul>\n<li><p>NSTimer 对象会保留目标直到计时器失效，需要调用invalidate方法令其失效</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled84.png\"></p>\n<p> <img src=\"http://image.stephenfang.me/mweb/Untitled85.png\"></p>\n</li>\n<li><p>反复执行的计时器容易引入retain cycle，可以使用 Block 的方式打破，需要注意的是必须创建分类来加入相关实现代码</p>\n</li>\n</ul>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/Untitled.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:19:23 GMT+0800 (中国标准时间)","title":"Effective Objective-C 总结","path":"2021/07/12/EffectiveObjcTips/","eyeCatchImage":"http://image.stephenfang.me/mweb/Untitled.png","excerpt":"<p>准备开始写 Objective-C 之前花了一些时间重新阅读这本经典的《Effective Objective-C》，在阅读的过程中对重点内容进行了一些摘录，在方便自己复习的同时将相关内容在博客分享出来供参考。</p>","date":{"_isAMomentObject":true,"_i":"2021-07-12T03:34:32.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2021-07-12T03:34:32.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":14626},{"title":"Hibernate 基础总结","date":"2020-02-25T05:11:20.000Z","_content":"\n包含 Hibernate 知识梳理、实验总结方面的总结。\n<!--more-->\n\n## 知识梳理\n\n1、Hibernate 是一个 ORM（Object-Relational Mapping）框架，用于把对象模型表示的对象映射到基于 SQL 的关系模型数据结构中去，采用完全面向对象的方式来操作数据库； \n\n2、Hibernate 的主要作用是简化应用的数据持久层编程，不仅能管理 Java 类到数据库表的映射，还提供数据查询和获取数据的方法，从而大幅减少了开发人员编写 SQL 和 JDBC 代码的时间； \n\n3、Hibernate 框架主要包括持久化对象（Persistent Objects）、Hibernate 配置文件 （一般被命名为*.cfg.xml）、Hibernate 映射文件（一般被命名为 *.hbm.xml ） 三部分； \n\n4、编译运行基于 Hibernate 框架的工程，需要导入相应的 Hibernate 类库； \n\n5、由于 Hibernate 底层是基于 JDBC 的，因此在应用程序中使用 Hibernate 执行持久化操作时也需要导入相关的 JDBC 驱动（例如 MySQL 数据库驱动）；\n\n6、在实际应用中，并不都是一张表与一个实体类映射，往往可能会有一张表跟多个实体类映射的情况，称为粒度设计； \n\n7、如果表中的某些字段联合起来能表示持久化类中的某一个属性，那么可以进行基于设计的粒度设计：将表跟多个类映射；类和类之间使用关联关系；只需要一个映射文件，其中使用 component 元素进行映射； \n\n8、如果表中的某些字段不经常使用，而且占有空间较大，则可以使用基于性能 的粒度设计：一个表可以映射为多个类；每个类对应一个 *.hbm.xml 文件；根据实际情况，使用不同的类。\n\n7、在应用程序中，用来实现业务实体的类被称为持久化类（Persistent Class）如客户信息管理系统中的 Customer 类； \n\n8、Hibernate 框架中的持久化类与数据库表对应，常用 POJO 编程模式实现，符合JavaBean 规范，提供 public 的无参构造方法，提供符合命名规范的 getters 和 setters 方法； \n\n9、持久化类与数据库表对应， 类的属性与表的字段对应；持久化类的对象被称为持久化对象 PO（Persistent Objects），PO 对应表中的一条记录； \n\n10、持久化对象映射数据库中的记录，其映射关系依赖 Hibernate 框架的映射文件配置，映射文件是 XML 文件，往往以*.hbm.xml 形式命名，其中*是持久化对象的类名； \n\n11、Hibernate 映射文件中，元素 `<id>` 表示持久化类中的主键， `<id>` 的子元素 `<generator>` 表示主键的生成策略，其取值可以是“assigned”（用户赋值）、“increment”（自动递增）等等； \n\n12、若数据库表中有多个列组成主键，则需要将其对应的持久化类中相应的多个属性封装成一个类，作为复合主键。\n\n\n## 实验总结\n**1、总结 Hibernate 配置文件`hibernate.cfg.xml`中各元素及其属性的作用；**\n\n- hibernate.connection.url:连接数据库url地址\n- hibernate.connection.username：连接数据库用户名\n- hibernate.connection.password：连接数据库密码\n- \thibernate.connection.driver_class：连接数据库JDBC驱动类\n- hibernate.dialect：连接数据库所使用的SQL语言\n- mapping resource：与当前配置文件相匹配的映射文件\n\n**2、总结持久化类与数据库表的映射关系，以及映射文件中主要元素及其属性的作用**\n\n- `<class  name=\"类名\"  table=\"表名\">`：类和表对应\n- `<id name=\"属性\" column=\"列名\">`：填写主键，即使表内没有主键，配置文件中也要配置一个唯一标识\n- `<generator class=\"assigned\"/>`：主键的生成策略，assigned 表示由用户赋值\n- `<property name=\"属性\" column=\"列名\"/>`：将属性和列对应起来\n\n**3、\t总结Action、Service 和 DAO 之间的调用关系，思考Java Web中的 DAO 类与当前 DAO 类的区别**\n\n**流程：**首先Action接受请求，调用生成的Service实例，Service经过业务逻辑处理之后调用DAO，DAO对数据库进行操作；\n\n**区别：**JavaWeb中DAO文件需要包含连接对象的定义，包含数据库连接和驱动的相关信息，而本实验中相关信息已经包含在配置文件中；JavaWeb中DAO文件需要定义结果集，而本实验中可以直接使用ArrayList存储结果；JavaWeb中DAO文件执行的sql语句为标准的sql语句而本实验中不是。\n\n**4、总结 POJO 模式下持久化类的规范**\n\n1. 提供无参的构造器\n2. 为每一个实体字段提供对应的getter/setter方法\n3. 每一个实体类都需要提供一个标识属性，与数据库中的主键对应。\n4. 实体类字段均使用包装类型\n5. 实体类不能使用final修饰\n\n**5、总结映射文件中主要元素（如class、id、generator、property）及其属性的含义与作用**\n\n•\t`<class>` ：持久化类名，类名class与表名table属性对应\n\n•\t`<id>` ：持久化类中的主键,主键属性与列名column属性对应\n\n•\t`<generator>` ：主键生成策略\n\n•\t`<property>` ：非主键属性property与column属性对应\n\n**6、总结设置复合主键的方法和步骤**\n\n首先将复合主键封装为一个类，修改PO类将复合主键作为其属性之一，修改Hibernate映射文件，将主键类中的每一个属性和表中的列对应，并指定复合主键的类型。\n\n**7、总结 Hibernate 映射文件中主键各种生成策略的作用**\n\n- assigned：用户赋值\n- increment 策略：自动递增;必须保证主键的列是\"long\"、\"integer\"或是\"short\"，必须是一个整数;系统会自动将主键列最大的值获得之后加 1，进行赋值\n- identity：由数据库根据 identity 生成主键，但是数据库必须支持 identity\n- sequence：由数据库根据序列生成主键，但是数据库必须支持 sequence\n- native：系统自动选择相应算法生成主键\n- uuid.hex ：利用 uuid 算法生成主键;必须保证该列是字符串类型;系统会自动给定一个随机、唯一的字符串\n- hilo：根据 Hibernate 的 hilo 生成主键\n\n**8、总结两种粒度设计的方法及特点**\n\n**基于设计的粒度设计：** 将表跟多个类映射；只需要一个映射文件，其中使用component元素进行映射\n\n**基于性能的粒度设计：** 一个表可以映射为多个类，每个类对应一个*.hbm.xml文件，根据实际情况，使用不同的类\n\n**9、总结 Hibernate 配置文件`hibernate.cfg.xml`中的`connection.autocommit`属性的作用**\n\n只有执行 commit 后 connection 的操作才会在数据库中真正执行。如果jdbc connection 的 autoCommit 属性是 false ，且 sql 语句中没有显示 commit，则 sql 语句即使被发送到数据库中也没有真正执行 sql；如果 connection 的 autoCommit 为true，每一条发送到数据库中的sql会自动commit。\n","source":"_posts/Hibernate_Basic.md","raw":"---\ntitle: Hibernate 基础总结\ndate: 2020-02-25 13:11:20\ncategories: \n- 技术\ntags: \n- Hibernate\n- JavaEE\n- 总结\n---\n\n包含 Hibernate 知识梳理、实验总结方面的总结。\n<!--more-->\n\n## 知识梳理\n\n1、Hibernate 是一个 ORM（Object-Relational Mapping）框架，用于把对象模型表示的对象映射到基于 SQL 的关系模型数据结构中去，采用完全面向对象的方式来操作数据库； \n\n2、Hibernate 的主要作用是简化应用的数据持久层编程，不仅能管理 Java 类到数据库表的映射，还提供数据查询和获取数据的方法，从而大幅减少了开发人员编写 SQL 和 JDBC 代码的时间； \n\n3、Hibernate 框架主要包括持久化对象（Persistent Objects）、Hibernate 配置文件 （一般被命名为*.cfg.xml）、Hibernate 映射文件（一般被命名为 *.hbm.xml ） 三部分； \n\n4、编译运行基于 Hibernate 框架的工程，需要导入相应的 Hibernate 类库； \n\n5、由于 Hibernate 底层是基于 JDBC 的，因此在应用程序中使用 Hibernate 执行持久化操作时也需要导入相关的 JDBC 驱动（例如 MySQL 数据库驱动）；\n\n6、在实际应用中，并不都是一张表与一个实体类映射，往往可能会有一张表跟多个实体类映射的情况，称为粒度设计； \n\n7、如果表中的某些字段联合起来能表示持久化类中的某一个属性，那么可以进行基于设计的粒度设计：将表跟多个类映射；类和类之间使用关联关系；只需要一个映射文件，其中使用 component 元素进行映射； \n\n8、如果表中的某些字段不经常使用，而且占有空间较大，则可以使用基于性能 的粒度设计：一个表可以映射为多个类；每个类对应一个 *.hbm.xml 文件；根据实际情况，使用不同的类。\n\n7、在应用程序中，用来实现业务实体的类被称为持久化类（Persistent Class）如客户信息管理系统中的 Customer 类； \n\n8、Hibernate 框架中的持久化类与数据库表对应，常用 POJO 编程模式实现，符合JavaBean 规范，提供 public 的无参构造方法，提供符合命名规范的 getters 和 setters 方法； \n\n9、持久化类与数据库表对应， 类的属性与表的字段对应；持久化类的对象被称为持久化对象 PO（Persistent Objects），PO 对应表中的一条记录； \n\n10、持久化对象映射数据库中的记录，其映射关系依赖 Hibernate 框架的映射文件配置，映射文件是 XML 文件，往往以*.hbm.xml 形式命名，其中*是持久化对象的类名； \n\n11、Hibernate 映射文件中，元素 `<id>` 表示持久化类中的主键， `<id>` 的子元素 `<generator>` 表示主键的生成策略，其取值可以是“assigned”（用户赋值）、“increment”（自动递增）等等； \n\n12、若数据库表中有多个列组成主键，则需要将其对应的持久化类中相应的多个属性封装成一个类，作为复合主键。\n\n\n## 实验总结\n**1、总结 Hibernate 配置文件`hibernate.cfg.xml`中各元素及其属性的作用；**\n\n- hibernate.connection.url:连接数据库url地址\n- hibernate.connection.username：连接数据库用户名\n- hibernate.connection.password：连接数据库密码\n- \thibernate.connection.driver_class：连接数据库JDBC驱动类\n- hibernate.dialect：连接数据库所使用的SQL语言\n- mapping resource：与当前配置文件相匹配的映射文件\n\n**2、总结持久化类与数据库表的映射关系，以及映射文件中主要元素及其属性的作用**\n\n- `<class  name=\"类名\"  table=\"表名\">`：类和表对应\n- `<id name=\"属性\" column=\"列名\">`：填写主键，即使表内没有主键，配置文件中也要配置一个唯一标识\n- `<generator class=\"assigned\"/>`：主键的生成策略，assigned 表示由用户赋值\n- `<property name=\"属性\" column=\"列名\"/>`：将属性和列对应起来\n\n**3、\t总结Action、Service 和 DAO 之间的调用关系，思考Java Web中的 DAO 类与当前 DAO 类的区别**\n\n**流程：**首先Action接受请求，调用生成的Service实例，Service经过业务逻辑处理之后调用DAO，DAO对数据库进行操作；\n\n**区别：**JavaWeb中DAO文件需要包含连接对象的定义，包含数据库连接和驱动的相关信息，而本实验中相关信息已经包含在配置文件中；JavaWeb中DAO文件需要定义结果集，而本实验中可以直接使用ArrayList存储结果；JavaWeb中DAO文件执行的sql语句为标准的sql语句而本实验中不是。\n\n**4、总结 POJO 模式下持久化类的规范**\n\n1. 提供无参的构造器\n2. 为每一个实体字段提供对应的getter/setter方法\n3. 每一个实体类都需要提供一个标识属性，与数据库中的主键对应。\n4. 实体类字段均使用包装类型\n5. 实体类不能使用final修饰\n\n**5、总结映射文件中主要元素（如class、id、generator、property）及其属性的含义与作用**\n\n•\t`<class>` ：持久化类名，类名class与表名table属性对应\n\n•\t`<id>` ：持久化类中的主键,主键属性与列名column属性对应\n\n•\t`<generator>` ：主键生成策略\n\n•\t`<property>` ：非主键属性property与column属性对应\n\n**6、总结设置复合主键的方法和步骤**\n\n首先将复合主键封装为一个类，修改PO类将复合主键作为其属性之一，修改Hibernate映射文件，将主键类中的每一个属性和表中的列对应，并指定复合主键的类型。\n\n**7、总结 Hibernate 映射文件中主键各种生成策略的作用**\n\n- assigned：用户赋值\n- increment 策略：自动递增;必须保证主键的列是\"long\"、\"integer\"或是\"short\"，必须是一个整数;系统会自动将主键列最大的值获得之后加 1，进行赋值\n- identity：由数据库根据 identity 生成主键，但是数据库必须支持 identity\n- sequence：由数据库根据序列生成主键，但是数据库必须支持 sequence\n- native：系统自动选择相应算法生成主键\n- uuid.hex ：利用 uuid 算法生成主键;必须保证该列是字符串类型;系统会自动给定一个随机、唯一的字符串\n- hilo：根据 Hibernate 的 hilo 生成主键\n\n**8、总结两种粒度设计的方法及特点**\n\n**基于设计的粒度设计：** 将表跟多个类映射；只需要一个映射文件，其中使用component元素进行映射\n\n**基于性能的粒度设计：** 一个表可以映射为多个类，每个类对应一个*.hbm.xml文件，根据实际情况，使用不同的类\n\n**9、总结 Hibernate 配置文件`hibernate.cfg.xml`中的`connection.autocommit`属性的作用**\n\n只有执行 commit 后 connection 的操作才会在数据库中真正执行。如果jdbc connection 的 autoCommit 属性是 false ，且 sql 语句中没有显示 commit，则 sql 语句即使被发送到数据库中也没有真正执行 sql；如果 connection 的 autoCommit 为true，每一条发送到数据库中的sql会自动commit。\n","slug":"Hibernate_Basic","published":1,"updated":"2022-07-24T15:19:59.306Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1s000po76f51yp3zpd","content":"<p>包含 Hibernate 知识梳理、实验总结方面的总结。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Hibernate 是一个 ORM（Object-Relational Mapping）框架，用于把对象模型表示的对象映射到基于 SQL 的关系模型数据结构中去，采用完全面向对象的方式来操作数据库； </p>\n<p>2、Hibernate 的主要作用是简化应用的数据持久层编程，不仅能管理 Java 类到数据库表的映射，还提供数据查询和获取数据的方法，从而大幅减少了开发人员编写 SQL 和 JDBC 代码的时间； </p>\n<p>3、Hibernate 框架主要包括持久化对象（Persistent Objects）、Hibernate 配置文件 （一般被命名为*.cfg.xml）、Hibernate 映射文件（一般被命名为 *.hbm.xml ） 三部分； </p>\n<p>4、编译运行基于 Hibernate 框架的工程，需要导入相应的 Hibernate 类库； </p>\n<p>5、由于 Hibernate 底层是基于 JDBC 的，因此在应用程序中使用 Hibernate 执行持久化操作时也需要导入相关的 JDBC 驱动（例如 MySQL 数据库驱动）；</p>\n<p>6、在实际应用中，并不都是一张表与一个实体类映射，往往可能会有一张表跟多个实体类映射的情况，称为粒度设计； </p>\n<p>7、如果表中的某些字段联合起来能表示持久化类中的某一个属性，那么可以进行基于设计的粒度设计：将表跟多个类映射；类和类之间使用关联关系；只需要一个映射文件，其中使用 component 元素进行映射； </p>\n<p>8、如果表中的某些字段不经常使用，而且占有空间较大，则可以使用基于性能 的粒度设计：一个表可以映射为多个类；每个类对应一个 *.hbm.xml 文件；根据实际情况，使用不同的类。</p>\n<p>7、在应用程序中，用来实现业务实体的类被称为持久化类（Persistent Class）如客户信息管理系统中的 Customer 类； </p>\n<p>8、Hibernate 框架中的持久化类与数据库表对应，常用 POJO 编程模式实现，符合JavaBean 规范，提供 public 的无参构造方法，提供符合命名规范的 getters 和 setters 方法； </p>\n<p>9、持久化类与数据库表对应， 类的属性与表的字段对应；持久化类的对象被称为持久化对象 PO（Persistent Objects），PO 对应表中的一条记录； </p>\n<p>10、持久化对象映射数据库中的记录，其映射关系依赖 Hibernate 框架的映射文件配置，映射文件是 XML 文件，往往以*.hbm.xml 形式命名，其中*是持久化对象的类名； </p>\n<p>11、Hibernate 映射文件中，元素 <code>&lt;id&gt;</code> 表示持久化类中的主键， <code>&lt;id&gt;</code> 的子元素 <code>&lt;generator&gt;</code> 表示主键的生成策略，其取值可以是“assigned”（用户赋值）、“increment”（自动递增）等等； </p>\n<p>12、若数据库表中有多个列组成主键，则需要将其对应的持久化类中相应的多个属性封装成一个类，作为复合主键。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p><strong>1、总结 Hibernate 配置文件<code>hibernate.cfg.xml</code>中各元素及其属性的作用；</strong></p>\n<ul>\n<li>hibernate.connection.url:连接数据库url地址</li>\n<li>hibernate.connection.username：连接数据库用户名</li>\n<li>hibernate.connection.password：连接数据库密码</li>\n<li><pre><code>hibernate.connection.driver_class：连接数据库JDBC驱动类\n</code></pre>\n</li>\n<li>hibernate.dialect：连接数据库所使用的SQL语言</li>\n<li>mapping resource：与当前配置文件相匹配的映射文件</li>\n</ul>\n<p><strong>2、总结持久化类与数据库表的映射关系，以及映射文件中主要元素及其属性的作用</strong></p>\n<ul>\n<li><code>&lt;class  name=&quot;类名&quot;  table=&quot;表名&quot;&gt;</code>：类和表对应</li>\n<li><code>&lt;id name=&quot;属性&quot; column=&quot;列名&quot;&gt;</code>：填写主键，即使表内没有主键，配置文件中也要配置一个唯一标识</li>\n<li><code>&lt;generator class=&quot;assigned&quot;/&gt;</code>：主键的生成策略，assigned 表示由用户赋值</li>\n<li><code>&lt;property name=&quot;属性&quot; column=&quot;列名&quot;/&gt;</code>：将属性和列对应起来</li>\n</ul>\n<p><strong>3、    总结Action、Service 和 DAO 之间的调用关系，思考Java Web中的 DAO 类与当前 DAO 类的区别</strong></p>\n<p><strong>流程：</strong>首先Action接受请求，调用生成的Service实例，Service经过业务逻辑处理之后调用DAO，DAO对数据库进行操作；</p>\n<p><strong>区别：</strong>JavaWeb中DAO文件需要包含连接对象的定义，包含数据库连接和驱动的相关信息，而本实验中相关信息已经包含在配置文件中；JavaWeb中DAO文件需要定义结果集，而本实验中可以直接使用ArrayList存储结果；JavaWeb中DAO文件执行的sql语句为标准的sql语句而本实验中不是。</p>\n<p><strong>4、总结 POJO 模式下持久化类的规范</strong></p>\n<ol>\n<li>提供无参的构造器</li>\n<li>为每一个实体字段提供对应的getter/setter方法</li>\n<li>每一个实体类都需要提供一个标识属性，与数据库中的主键对应。</li>\n<li>实体类字段均使用包装类型</li>\n<li>实体类不能使用final修饰</li>\n</ol>\n<p><strong>5、总结映射文件中主要元素（如class、id、generator、property）及其属性的含义与作用</strong></p>\n<p>•    <code>&lt;class&gt;</code> ：持久化类名，类名class与表名table属性对应</p>\n<p>•    <code>&lt;id&gt;</code> ：持久化类中的主键,主键属性与列名column属性对应</p>\n<p>•    <code>&lt;generator&gt;</code> ：主键生成策略</p>\n<p>•    <code>&lt;property&gt;</code> ：非主键属性property与column属性对应</p>\n<p><strong>6、总结设置复合主键的方法和步骤</strong></p>\n<p>首先将复合主键封装为一个类，修改PO类将复合主键作为其属性之一，修改Hibernate映射文件，将主键类中的每一个属性和表中的列对应，并指定复合主键的类型。</p>\n<p><strong>7、总结 Hibernate 映射文件中主键各种生成策略的作用</strong></p>\n<ul>\n<li>assigned：用户赋值</li>\n<li>increment 策略：自动递增;必须保证主键的列是”long”、”integer”或是”short”，必须是一个整数;系统会自动将主键列最大的值获得之后加 1，进行赋值</li>\n<li>identity：由数据库根据 identity 生成主键，但是数据库必须支持 identity</li>\n<li>sequence：由数据库根据序列生成主键，但是数据库必须支持 sequence</li>\n<li>native：系统自动选择相应算法生成主键</li>\n<li>uuid.hex ：利用 uuid 算法生成主键;必须保证该列是字符串类型;系统会自动给定一个随机、唯一的字符串</li>\n<li>hilo：根据 Hibernate 的 hilo 生成主键</li>\n</ul>\n<p><strong>8、总结两种粒度设计的方法及特点</strong></p>\n<p><strong>基于设计的粒度设计：</strong> 将表跟多个类映射；只需要一个映射文件，其中使用component元素进行映射</p>\n<p><strong>基于性能的粒度设计：</strong> 一个表可以映射为多个类，每个类对应一个*.hbm.xml文件，根据实际情况，使用不同的类</p>\n<p><strong>9、总结 Hibernate 配置文件<code>hibernate.cfg.xml</code>中的<code>connection.autocommit</code>属性的作用</strong></p>\n<p>只有执行 commit 后 connection 的操作才会在数据库中真正执行。如果jdbc connection 的 autoCommit 属性是 false ，且 sql 语句中没有显示 commit，则 sql 语句即使被发送到数据库中也没有真正执行 sql；如果 connection 的 autoCommit 为true，每一条发送到数据库中的sql会自动commit。</p>\n","site":{"data":{}},"excerpt":"<p>包含 Hibernate 知识梳理、实验总结方面的总结。</p>","more":"<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Hibernate 是一个 ORM（Object-Relational Mapping）框架，用于把对象模型表示的对象映射到基于 SQL 的关系模型数据结构中去，采用完全面向对象的方式来操作数据库； </p>\n<p>2、Hibernate 的主要作用是简化应用的数据持久层编程，不仅能管理 Java 类到数据库表的映射，还提供数据查询和获取数据的方法，从而大幅减少了开发人员编写 SQL 和 JDBC 代码的时间； </p>\n<p>3、Hibernate 框架主要包括持久化对象（Persistent Objects）、Hibernate 配置文件 （一般被命名为*.cfg.xml）、Hibernate 映射文件（一般被命名为 *.hbm.xml ） 三部分； </p>\n<p>4、编译运行基于 Hibernate 框架的工程，需要导入相应的 Hibernate 类库； </p>\n<p>5、由于 Hibernate 底层是基于 JDBC 的，因此在应用程序中使用 Hibernate 执行持久化操作时也需要导入相关的 JDBC 驱动（例如 MySQL 数据库驱动）；</p>\n<p>6、在实际应用中，并不都是一张表与一个实体类映射，往往可能会有一张表跟多个实体类映射的情况，称为粒度设计； </p>\n<p>7、如果表中的某些字段联合起来能表示持久化类中的某一个属性，那么可以进行基于设计的粒度设计：将表跟多个类映射；类和类之间使用关联关系；只需要一个映射文件，其中使用 component 元素进行映射； </p>\n<p>8、如果表中的某些字段不经常使用，而且占有空间较大，则可以使用基于性能 的粒度设计：一个表可以映射为多个类；每个类对应一个 *.hbm.xml 文件；根据实际情况，使用不同的类。</p>\n<p>7、在应用程序中，用来实现业务实体的类被称为持久化类（Persistent Class）如客户信息管理系统中的 Customer 类； </p>\n<p>8、Hibernate 框架中的持久化类与数据库表对应，常用 POJO 编程模式实现，符合JavaBean 规范，提供 public 的无参构造方法，提供符合命名规范的 getters 和 setters 方法； </p>\n<p>9、持久化类与数据库表对应， 类的属性与表的字段对应；持久化类的对象被称为持久化对象 PO（Persistent Objects），PO 对应表中的一条记录； </p>\n<p>10、持久化对象映射数据库中的记录，其映射关系依赖 Hibernate 框架的映射文件配置，映射文件是 XML 文件，往往以*.hbm.xml 形式命名，其中*是持久化对象的类名； </p>\n<p>11、Hibernate 映射文件中，元素 <code>&lt;id&gt;</code> 表示持久化类中的主键， <code>&lt;id&gt;</code> 的子元素 <code>&lt;generator&gt;</code> 表示主键的生成策略，其取值可以是“assigned”（用户赋值）、“increment”（自动递增）等等； </p>\n<p>12、若数据库表中有多个列组成主键，则需要将其对应的持久化类中相应的多个属性封装成一个类，作为复合主键。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p><strong>1、总结 Hibernate 配置文件<code>hibernate.cfg.xml</code>中各元素及其属性的作用；</strong></p>\n<ul>\n<li>hibernate.connection.url:连接数据库url地址</li>\n<li>hibernate.connection.username：连接数据库用户名</li>\n<li>hibernate.connection.password：连接数据库密码</li>\n<li><pre><code>hibernate.connection.driver_class：连接数据库JDBC驱动类\n</code></pre>\n</li>\n<li>hibernate.dialect：连接数据库所使用的SQL语言</li>\n<li>mapping resource：与当前配置文件相匹配的映射文件</li>\n</ul>\n<p><strong>2、总结持久化类与数据库表的映射关系，以及映射文件中主要元素及其属性的作用</strong></p>\n<ul>\n<li><code>&lt;class  name=&quot;类名&quot;  table=&quot;表名&quot;&gt;</code>：类和表对应</li>\n<li><code>&lt;id name=&quot;属性&quot; column=&quot;列名&quot;&gt;</code>：填写主键，即使表内没有主键，配置文件中也要配置一个唯一标识</li>\n<li><code>&lt;generator class=&quot;assigned&quot;/&gt;</code>：主键的生成策略，assigned 表示由用户赋值</li>\n<li><code>&lt;property name=&quot;属性&quot; column=&quot;列名&quot;/&gt;</code>：将属性和列对应起来</li>\n</ul>\n<p><strong>3、    总结Action、Service 和 DAO 之间的调用关系，思考Java Web中的 DAO 类与当前 DAO 类的区别</strong></p>\n<p><strong>流程：</strong>首先Action接受请求，调用生成的Service实例，Service经过业务逻辑处理之后调用DAO，DAO对数据库进行操作；</p>\n<p><strong>区别：</strong>JavaWeb中DAO文件需要包含连接对象的定义，包含数据库连接和驱动的相关信息，而本实验中相关信息已经包含在配置文件中；JavaWeb中DAO文件需要定义结果集，而本实验中可以直接使用ArrayList存储结果；JavaWeb中DAO文件执行的sql语句为标准的sql语句而本实验中不是。</p>\n<p><strong>4、总结 POJO 模式下持久化类的规范</strong></p>\n<ol>\n<li>提供无参的构造器</li>\n<li>为每一个实体字段提供对应的getter/setter方法</li>\n<li>每一个实体类都需要提供一个标识属性，与数据库中的主键对应。</li>\n<li>实体类字段均使用包装类型</li>\n<li>实体类不能使用final修饰</li>\n</ol>\n<p><strong>5、总结映射文件中主要元素（如class、id、generator、property）及其属性的含义与作用</strong></p>\n<p>•    <code>&lt;class&gt;</code> ：持久化类名，类名class与表名table属性对应</p>\n<p>•    <code>&lt;id&gt;</code> ：持久化类中的主键,主键属性与列名column属性对应</p>\n<p>•    <code>&lt;generator&gt;</code> ：主键生成策略</p>\n<p>•    <code>&lt;property&gt;</code> ：非主键属性property与column属性对应</p>\n<p><strong>6、总结设置复合主键的方法和步骤</strong></p>\n<p>首先将复合主键封装为一个类，修改PO类将复合主键作为其属性之一，修改Hibernate映射文件，将主键类中的每一个属性和表中的列对应，并指定复合主键的类型。</p>\n<p><strong>7、总结 Hibernate 映射文件中主键各种生成策略的作用</strong></p>\n<ul>\n<li>assigned：用户赋值</li>\n<li>increment 策略：自动递增;必须保证主键的列是”long”、”integer”或是”short”，必须是一个整数;系统会自动将主键列最大的值获得之后加 1，进行赋值</li>\n<li>identity：由数据库根据 identity 生成主键，但是数据库必须支持 identity</li>\n<li>sequence：由数据库根据序列生成主键，但是数据库必须支持 sequence</li>\n<li>native：系统自动选择相应算法生成主键</li>\n<li>uuid.hex ：利用 uuid 算法生成主键;必须保证该列是字符串类型;系统会自动给定一个随机、唯一的字符串</li>\n<li>hilo：根据 Hibernate 的 hilo 生成主键</li>\n</ul>\n<p><strong>8、总结两种粒度设计的方法及特点</strong></p>\n<p><strong>基于设计的粒度设计：</strong> 将表跟多个类映射；只需要一个映射文件，其中使用component元素进行映射</p>\n<p><strong>基于性能的粒度设计：</strong> 一个表可以映射为多个类，每个类对应一个*.hbm.xml文件，根据实际情况，使用不同的类</p>\n<p><strong>9、总结 Hibernate 配置文件<code>hibernate.cfg.xml</code>中的<code>connection.autocommit</code>属性的作用</strong></p>\n<p>只有执行 commit 后 connection 的操作才会在数据库中真正执行。如果jdbc connection 的 autoCommit 属性是 false ，且 sql 语句中没有显示 commit，则 sql 语句即使被发送到数据库中也没有真正执行 sql；如果 connection 的 autoCommit 为true，每一条发送到数据库中的sql会自动commit。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:19:59 GMT+0800 (中国标准时间)","title":"Hibernate 基础总结","path":"2020/02/25/Hibernate_Basic/","eyeCatchImage":null,"excerpt":"<p>包含 Hibernate 知识梳理、实验总结方面的总结。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-25T05:11:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-25T05:11:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["JavaEE","总结","Hibernate"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":3088},{"title":"软件设计模式 - 中介者模式","date":"2020-06-03T09:23:20.000Z","copyright":true,"_content":"\n中介者模式(Mediator Pattern)，又称为调停者模式，是一种对象行为型模式。该设计模式使用一个中介对象（中介者）来封装一系列的对象交互，使得各对象不需要显式地相互引用，从而使其耦合松散、独立地改变它们之间的交互。本文以设计模式的四个要素出发系统性地研究中介者模式。\n\n<!--more-->\n\n## 模式目的\n中介的含义不难理解，以具体的生活场景为例，在租房、留学、找工作等时期或多或少都需要中介的帮助。互联网上实时更新的海量信息与错综复杂的关系让你无法分辨真实性与参考性，所以你无法躲避这些中介关系，只能够通过其获取你所需要的信息。\n在软件世界也同样如此，当有多个对象彼此间相互交互的时候，自然就会想到对象间的耦合度过高，而中介者模式就是用来解决这一问题的，通过封装对象间的交互行为，来降低对象之间的耦合性，防止出现系统或模块内部过度耦合。以下的图片展现了具备复杂关联关系的对象模拟图。\n![](http://image.stephenfang.me/mweb/15917479538199.jpg)\n图2.1 复杂关联关系模拟图\n根据上图以及以往程序设计中的经验，我们可以推断出程序设计中存在过多复杂关联关系带来的问题：\n1.\t系统结构复杂：对象之间存在大量的相互关联和调用，若其中一个对象发生变化，则需要跟踪和该对象关联的其他所有对象并进行相应处理。\n2.\t对象可重用性差：由于一个对象和其他对象具有很强的关联，若不存在其他对象的支持，一个对象很难被另一个系统或模块重用，这些对象表现像一个不可分割的整体，职责较为混乱。\n3.\t系统扩展性低：增加一个新对象需要在原有相关对象上增加引用，同时调整原有对象，系统耦合度高，对象操作很不灵活，扩展性差。\n\n在面向对象的软件设计与开发过程中，根据“单一职责原则”，我们应该尽量将对象细化，使其只负责或呈现单一的职责。对于一个可能由很多对象构成的模块，这些对象之间可能存在相互的引用，为了减少对象两两之间复杂的引用关系，使之成为一个松耦合的系统，我们需要使用中介者模式，下图十分生动地展现了中介者模式的意义。\n\n![](http://image.stephenfang.me/mweb/15917479852765.jpg)\n图2.2 中介者模式应用模拟图\n由上述的描述可知，中介者模式的目的主要是为了降低模块内部之间类的相互引用，防止出现系统或模块内部过度耦合。\n\n## 实现方法\n从问题出发，我们总结出中介者需要承担两方面的职责：\n- 中转作用（结构性）：\n通过中介者提供的中转作用，各个同事对象就不再需要显式引用其他同事，当需要和其他同事进行通信时，通过中介者即可。\n- 协调作用（行为性）：\n中介者可以更进一步的对同事之间的关系进行封装，同事可以一致地和中介者进行交互，而不需要指明中介者需要具体怎么做，中介者根据封装在自身内部的协调逻辑，对同事的请求进行进一步处理，将同事成员之间的关系行为进行分离和封装。\n\n从中介者模式的组成而言，其主要包含四个角色：\n- Mediator（抽象中介者）：定义一个接口用于与各同事对象之间的通信\n-\tConcreteMediator（具体中介者）：抽象中介者的子类，通过协调各个同事对象来实现协作行为，了解并维护它的各个同事对象的引用；\n-\tColleague（抽象同事类）：定义各同事的公有方法；\n-\tConcreteColleague（具体同事类）：抽象同事类的子类，每一个同事对象都引用一个中介者对象；每一个同事对象在需要和其他同事对象通信时，先与中介者通信，通过中介者来间接完成与其他同事类的通信；在具体同事类中实现了在抽象同事类中定义的方法。\n\n下图展示了中介者模式中的类结构，可以清楚地看到四种角色之间的关系。\n![](http://image.stephenfang.me/mweb/15917481238616.jpg)\n图3.1 中介者模式类图\n\n中介者模式可以方便地应用于图形界面(GUI)开发中，在比较复杂的界面中可能存在多个界面组件之间的交互关系。对于这些复杂的交互关系，我们可以引入一个中介者类，将这些交互的组件作为具体的同事类，将它们之间的引用和控制关系交由中介者负责，在一定程度上简化系统的交互，\nMVC架构中控制器（Controller）作为一种中介者，是数据模型对象与视图之间的桥梁，它监听视图上的交互动作并且对视图的状态作出反应，同时在Model通知数据发生改变的时候更新Model的状态。以移动应用开发为例，当用户点击按钮或在View中输入信息后视图会通知控制器，控制器解释用户交互逻辑，然后联系模型获取完成请求所需的信息。模型将信息提供给控制器，控制器将其中继到视图，视图将其显示给用户。\n \n![](http://image.stephenfang.me/mweb/15917481870001.jpg)\n\n图3.2 MVC模式\n\n## 模式简例\n科技发达之后家里所有设备都是智能化的，而小明在家洗澡的时候有个习惯就是喜欢听歌，而且洗澡时候还要把窗帘拉上。因此就有这种情形，小明拉上窗帘说明洗浴设备需要工作，并且音乐设备也将唤醒。因此我们希望小明家的洗浴设备、音响设备和窗帘设备能协同合作，不管操作哪种设备，其他两种设备都有响应。\n现在很明显我们可以看出来，我们有三个对象，也就是三种设备，程序看起来也很简单，只要在启动一个设备时，能同时启动另外两个设备。那么我们只需在一个设备的类里放两个其他设备的引用，很容易就能解决这个问题，这样写出来的程序对象关系如下图。\n![](http://image.stephenfang.me/mweb/15917485113553.jpg) \n图4.1 修改前模式\n该程序最主要的功能就是在一个类里完成了对另外两个类的方法作用。但是这样设计，由耦合度过高的问题带来两个主要缺陷\n- 一旦窗帘设备损坏需要更换，那么就要让新的窗帘设备建立所有其他设备的连接\n- 若产生新的的需求，如洗澡的时候要把门锁住，那门锁的智能设备又要关联所有设备，这样的程序设计使得在扩展程序功能时更加麻烦。\n\n中介者模式的引入则极大的弥补了上述程序的两个缺陷，对象交互如下图：\n![](http://image.stephenfang.me/mweb/15917485380247.jpg)\n图4.2 修改后模式\n \n中介者就好比智能家居的管家，所有对象的交互指令都通过它来传达。中介者负责与对象联系，对象与对象之间不再进行直接的交互，也就是对对象关系进行解耦。\n\n ![](http://image.stephenfang.me/mweb/15917485453277.jpg)\n图4.2 程序类图\n\n```java\npublic class MusicDevice extends Device{\n    public void operateDevice(String str) {\n        if(str != \"MusicDevice\"){\n            System.out.println(\"音乐设备已启动\");\n        }\n        if(str == \"true\"){\n            Mediator();\n        }\n    }\n    public void Mediator(){\n        ConcreteMediator mediator = new ConcreteMediator();\n        mediator.startUp(\"MusicDevice\");\n    }\n}\t\n```\n音乐设备部分的代码如上，其他设备代码可以参照此例。设备类都继承自Device类，其中主要由两个方法组成，一个是operateDevice函数，用来启动设备，另一个是Mediator函数，用来调用中介者，并以中介者为媒介启动其他设备。Mediator由operateDevice函数进行调用，并设置了判断条件，防止反复调用中介者类。\n\n```java\npublic class ConcreteMediator extends SmartMediator{\n    public void startUp(String item){\n        MusicDevice musicDevice = new MusicDevice();\n        CurtainDevice curtainDevice = new CurtainDevice();\n        BathDevice bathDevice = new BathDevice();\n\n        musicDevice.operateDevice(item);\n        curtainDevice.operateDevice(item);\n        bathDevice.operateDevice(item);\n    }\n}\n```\n\n中介者类如上，即程序最为重要的部分。当它的startUp方法被某一设备调用之后，它会新建所有设备的类，并且调用除了已启动的设备之外，所有其他设备的启动方法。在启动方法中设置了参数，以防止循环调用。当我们想要添加新的设备的时候，只需要编写新设备类，并且在中介者类中添加该类的启动方法，就能完成修改。从而降低代码之间的耦合性，提高了程序的可维护性。\n\n程序分析：\n1. 该程序解决了上述两个缺陷，现在所有设备都只与中介者相关联，不管是新增设备还是替换设备，只需要改变设备与中介者之间的关系，降低了代码之间的耦合性。\n2. 改变设计之后所有设备的启动项都由中介者管理，用户可以通过中介者方便地启动所有设备，而不需要将所有设备之间连接起来。避免了随着设备的增多，设备之间的联系变得无比复杂的情况。\n\n## 模式总结\n1.\t中介者模式优点：\n    - 简化了对象之间的交互。\n    - 将各同事解耦，减少子类生成，增加对象的复用性。\n    - 简化各同事类的设计和实现，便于系统维护。\n\n2.\t中介者模式缺点：\n    - 在具体中介者类中包含了同事之间的交互细节，如果中介者类设计的不好，可能会导致具体中介者类非常复杂，使得系统难以维护。\n    - 中介者对象本身需要整理系统内部的对象之间的交互，可能会导致其本身会变得臃肿和复杂，进而变得难以维护\n\n3. 中介者模式的适用环境：\n    - 系统中对象之间存在复杂的引用关系，产生的相互依赖关系结构混乱且难以理解。\n    - 一个对象引用了很多对象并且直接和这些对象通信，导致难以复用该对象。\n    - 希望通过一个中间类来封装多个类中的行为，而又不想生成太多的子类。可以通过引入中介者类来实现，在中介者中定义对象。\n    - 交互的公共行为，如果需要改变行为则可以增加新的中介者类。\n\n### 参考资料\n[中介者模式-维基百科](https://zh.wikipedia.org/wiki/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F)\n[中介者模式— Graphic Design Patterns - 图说设计模式](https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/mediator.html)\n[设计模式 | 中介者模式及典型应用](https://juejin.im/post/5bd275dc51882529290fe2c5)\n[中介者模式 - jyqdaisy - 博客园](https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html)\n","source":"_posts/Mediator_Pattern.md","raw":"---\ntitle: 软件设计模式 - 中介者模式\ndate: 2020-06-03 17:23:20\ncategories: \n- 技术\ntags: \n- 设计模式\n- Java\ncopyright: true\n---\n\n中介者模式(Mediator Pattern)，又称为调停者模式，是一种对象行为型模式。该设计模式使用一个中介对象（中介者）来封装一系列的对象交互，使得各对象不需要显式地相互引用，从而使其耦合松散、独立地改变它们之间的交互。本文以设计模式的四个要素出发系统性地研究中介者模式。\n\n<!--more-->\n\n## 模式目的\n中介的含义不难理解，以具体的生活场景为例，在租房、留学、找工作等时期或多或少都需要中介的帮助。互联网上实时更新的海量信息与错综复杂的关系让你无法分辨真实性与参考性，所以你无法躲避这些中介关系，只能够通过其获取你所需要的信息。\n在软件世界也同样如此，当有多个对象彼此间相互交互的时候，自然就会想到对象间的耦合度过高，而中介者模式就是用来解决这一问题的，通过封装对象间的交互行为，来降低对象之间的耦合性，防止出现系统或模块内部过度耦合。以下的图片展现了具备复杂关联关系的对象模拟图。\n![](http://image.stephenfang.me/mweb/15917479538199.jpg)\n图2.1 复杂关联关系模拟图\n根据上图以及以往程序设计中的经验，我们可以推断出程序设计中存在过多复杂关联关系带来的问题：\n1.\t系统结构复杂：对象之间存在大量的相互关联和调用，若其中一个对象发生变化，则需要跟踪和该对象关联的其他所有对象并进行相应处理。\n2.\t对象可重用性差：由于一个对象和其他对象具有很强的关联，若不存在其他对象的支持，一个对象很难被另一个系统或模块重用，这些对象表现像一个不可分割的整体，职责较为混乱。\n3.\t系统扩展性低：增加一个新对象需要在原有相关对象上增加引用，同时调整原有对象，系统耦合度高，对象操作很不灵活，扩展性差。\n\n在面向对象的软件设计与开发过程中，根据“单一职责原则”，我们应该尽量将对象细化，使其只负责或呈现单一的职责。对于一个可能由很多对象构成的模块，这些对象之间可能存在相互的引用，为了减少对象两两之间复杂的引用关系，使之成为一个松耦合的系统，我们需要使用中介者模式，下图十分生动地展现了中介者模式的意义。\n\n![](http://image.stephenfang.me/mweb/15917479852765.jpg)\n图2.2 中介者模式应用模拟图\n由上述的描述可知，中介者模式的目的主要是为了降低模块内部之间类的相互引用，防止出现系统或模块内部过度耦合。\n\n## 实现方法\n从问题出发，我们总结出中介者需要承担两方面的职责：\n- 中转作用（结构性）：\n通过中介者提供的中转作用，各个同事对象就不再需要显式引用其他同事，当需要和其他同事进行通信时，通过中介者即可。\n- 协调作用（行为性）：\n中介者可以更进一步的对同事之间的关系进行封装，同事可以一致地和中介者进行交互，而不需要指明中介者需要具体怎么做，中介者根据封装在自身内部的协调逻辑，对同事的请求进行进一步处理，将同事成员之间的关系行为进行分离和封装。\n\n从中介者模式的组成而言，其主要包含四个角色：\n- Mediator（抽象中介者）：定义一个接口用于与各同事对象之间的通信\n-\tConcreteMediator（具体中介者）：抽象中介者的子类，通过协调各个同事对象来实现协作行为，了解并维护它的各个同事对象的引用；\n-\tColleague（抽象同事类）：定义各同事的公有方法；\n-\tConcreteColleague（具体同事类）：抽象同事类的子类，每一个同事对象都引用一个中介者对象；每一个同事对象在需要和其他同事对象通信时，先与中介者通信，通过中介者来间接完成与其他同事类的通信；在具体同事类中实现了在抽象同事类中定义的方法。\n\n下图展示了中介者模式中的类结构，可以清楚地看到四种角色之间的关系。\n![](http://image.stephenfang.me/mweb/15917481238616.jpg)\n图3.1 中介者模式类图\n\n中介者模式可以方便地应用于图形界面(GUI)开发中，在比较复杂的界面中可能存在多个界面组件之间的交互关系。对于这些复杂的交互关系，我们可以引入一个中介者类，将这些交互的组件作为具体的同事类，将它们之间的引用和控制关系交由中介者负责，在一定程度上简化系统的交互，\nMVC架构中控制器（Controller）作为一种中介者，是数据模型对象与视图之间的桥梁，它监听视图上的交互动作并且对视图的状态作出反应，同时在Model通知数据发生改变的时候更新Model的状态。以移动应用开发为例，当用户点击按钮或在View中输入信息后视图会通知控制器，控制器解释用户交互逻辑，然后联系模型获取完成请求所需的信息。模型将信息提供给控制器，控制器将其中继到视图，视图将其显示给用户。\n \n![](http://image.stephenfang.me/mweb/15917481870001.jpg)\n\n图3.2 MVC模式\n\n## 模式简例\n科技发达之后家里所有设备都是智能化的，而小明在家洗澡的时候有个习惯就是喜欢听歌，而且洗澡时候还要把窗帘拉上。因此就有这种情形，小明拉上窗帘说明洗浴设备需要工作，并且音乐设备也将唤醒。因此我们希望小明家的洗浴设备、音响设备和窗帘设备能协同合作，不管操作哪种设备，其他两种设备都有响应。\n现在很明显我们可以看出来，我们有三个对象，也就是三种设备，程序看起来也很简单，只要在启动一个设备时，能同时启动另外两个设备。那么我们只需在一个设备的类里放两个其他设备的引用，很容易就能解决这个问题，这样写出来的程序对象关系如下图。\n![](http://image.stephenfang.me/mweb/15917485113553.jpg) \n图4.1 修改前模式\n该程序最主要的功能就是在一个类里完成了对另外两个类的方法作用。但是这样设计，由耦合度过高的问题带来两个主要缺陷\n- 一旦窗帘设备损坏需要更换，那么就要让新的窗帘设备建立所有其他设备的连接\n- 若产生新的的需求，如洗澡的时候要把门锁住，那门锁的智能设备又要关联所有设备，这样的程序设计使得在扩展程序功能时更加麻烦。\n\n中介者模式的引入则极大的弥补了上述程序的两个缺陷，对象交互如下图：\n![](http://image.stephenfang.me/mweb/15917485380247.jpg)\n图4.2 修改后模式\n \n中介者就好比智能家居的管家，所有对象的交互指令都通过它来传达。中介者负责与对象联系，对象与对象之间不再进行直接的交互，也就是对对象关系进行解耦。\n\n ![](http://image.stephenfang.me/mweb/15917485453277.jpg)\n图4.2 程序类图\n\n```java\npublic class MusicDevice extends Device{\n    public void operateDevice(String str) {\n        if(str != \"MusicDevice\"){\n            System.out.println(\"音乐设备已启动\");\n        }\n        if(str == \"true\"){\n            Mediator();\n        }\n    }\n    public void Mediator(){\n        ConcreteMediator mediator = new ConcreteMediator();\n        mediator.startUp(\"MusicDevice\");\n    }\n}\t\n```\n音乐设备部分的代码如上，其他设备代码可以参照此例。设备类都继承自Device类，其中主要由两个方法组成，一个是operateDevice函数，用来启动设备，另一个是Mediator函数，用来调用中介者，并以中介者为媒介启动其他设备。Mediator由operateDevice函数进行调用，并设置了判断条件，防止反复调用中介者类。\n\n```java\npublic class ConcreteMediator extends SmartMediator{\n    public void startUp(String item){\n        MusicDevice musicDevice = new MusicDevice();\n        CurtainDevice curtainDevice = new CurtainDevice();\n        BathDevice bathDevice = new BathDevice();\n\n        musicDevice.operateDevice(item);\n        curtainDevice.operateDevice(item);\n        bathDevice.operateDevice(item);\n    }\n}\n```\n\n中介者类如上，即程序最为重要的部分。当它的startUp方法被某一设备调用之后，它会新建所有设备的类，并且调用除了已启动的设备之外，所有其他设备的启动方法。在启动方法中设置了参数，以防止循环调用。当我们想要添加新的设备的时候，只需要编写新设备类，并且在中介者类中添加该类的启动方法，就能完成修改。从而降低代码之间的耦合性，提高了程序的可维护性。\n\n程序分析：\n1. 该程序解决了上述两个缺陷，现在所有设备都只与中介者相关联，不管是新增设备还是替换设备，只需要改变设备与中介者之间的关系，降低了代码之间的耦合性。\n2. 改变设计之后所有设备的启动项都由中介者管理，用户可以通过中介者方便地启动所有设备，而不需要将所有设备之间连接起来。避免了随着设备的增多，设备之间的联系变得无比复杂的情况。\n\n## 模式总结\n1.\t中介者模式优点：\n    - 简化了对象之间的交互。\n    - 将各同事解耦，减少子类生成，增加对象的复用性。\n    - 简化各同事类的设计和实现，便于系统维护。\n\n2.\t中介者模式缺点：\n    - 在具体中介者类中包含了同事之间的交互细节，如果中介者类设计的不好，可能会导致具体中介者类非常复杂，使得系统难以维护。\n    - 中介者对象本身需要整理系统内部的对象之间的交互，可能会导致其本身会变得臃肿和复杂，进而变得难以维护\n\n3. 中介者模式的适用环境：\n    - 系统中对象之间存在复杂的引用关系，产生的相互依赖关系结构混乱且难以理解。\n    - 一个对象引用了很多对象并且直接和这些对象通信，导致难以复用该对象。\n    - 希望通过一个中间类来封装多个类中的行为，而又不想生成太多的子类。可以通过引入中介者类来实现，在中介者中定义对象。\n    - 交互的公共行为，如果需要改变行为则可以增加新的中介者类。\n\n### 参考资料\n[中介者模式-维基百科](https://zh.wikipedia.org/wiki/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F)\n[中介者模式— Graphic Design Patterns - 图说设计模式](https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/mediator.html)\n[设计模式 | 中介者模式及典型应用](https://juejin.im/post/5bd275dc51882529290fe2c5)\n[中介者模式 - jyqdaisy - 博客园](https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html)\n","slug":"Mediator_Pattern","published":1,"updated":"2022-07-24T15:20:03.844Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1u000to76fh1854xd1","content":"<p>中介者模式(Mediator Pattern)，又称为调停者模式，是一种对象行为型模式。该设计模式使用一个中介对象（中介者）来封装一系列的对象交互，使得各对象不需要显式地相互引用，从而使其耦合松散、独立地改变它们之间的交互。本文以设计模式的四个要素出发系统性地研究中介者模式。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"模式目的\"><a href=\"#模式目的\" class=\"headerlink\" title=\"模式目的\"></a>模式目的</h2><p>中介的含义不难理解，以具体的生活场景为例，在租房、留学、找工作等时期或多或少都需要中介的帮助。互联网上实时更新的海量信息与错综复杂的关系让你无法分辨真实性与参考性，所以你无法躲避这些中介关系，只能够通过其获取你所需要的信息。<br>在软件世界也同样如此，当有多个对象彼此间相互交互的时候，自然就会想到对象间的耦合度过高，而中介者模式就是用来解决这一问题的，通过封装对象间的交互行为，来降低对象之间的耦合性，防止出现系统或模块内部过度耦合。以下的图片展现了具备复杂关联关系的对象模拟图。<br><img src=\"http://image.stephenfang.me/mweb/15917479538199.jpg\"><br>图2.1 复杂关联关系模拟图<br>根据上图以及以往程序设计中的经验，我们可以推断出程序设计中存在过多复杂关联关系带来的问题：</p>\n<ol>\n<li>   系统结构复杂：对象之间存在大量的相互关联和调用，若其中一个对象发生变化，则需要跟踪和该对象关联的其他所有对象并进行相应处理。</li>\n<li>   对象可重用性差：由于一个对象和其他对象具有很强的关联，若不存在其他对象的支持，一个对象很难被另一个系统或模块重用，这些对象表现像一个不可分割的整体，职责较为混乱。</li>\n<li>   系统扩展性低：增加一个新对象需要在原有相关对象上增加引用，同时调整原有对象，系统耦合度高，对象操作很不灵活，扩展性差。</li>\n</ol>\n<p>在面向对象的软件设计与开发过程中，根据“单一职责原则”，我们应该尽量将对象细化，使其只负责或呈现单一的职责。对于一个可能由很多对象构成的模块，这些对象之间可能存在相互的引用，为了减少对象两两之间复杂的引用关系，使之成为一个松耦合的系统，我们需要使用中介者模式，下图十分生动地展现了中介者模式的意义。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15917479852765.jpg\"><br>图2.2 中介者模式应用模拟图<br>由上述的描述可知，中介者模式的目的主要是为了降低模块内部之间类的相互引用，防止出现系统或模块内部过度耦合。</p>\n<h2 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h2><p>从问题出发，我们总结出中介者需要承担两方面的职责：</p>\n<ul>\n<li>中转作用（结构性）：<br>通过中介者提供的中转作用，各个同事对象就不再需要显式引用其他同事，当需要和其他同事进行通信时，通过中介者即可。</li>\n<li>协调作用（行为性）：<br>中介者可以更进一步的对同事之间的关系进行封装，同事可以一致地和中介者进行交互，而不需要指明中介者需要具体怎么做，中介者根据封装在自身内部的协调逻辑，对同事的请求进行进一步处理，将同事成员之间的关系行为进行分离和封装。</li>\n</ul>\n<p>从中介者模式的组成而言，其主要包含四个角色：</p>\n<ul>\n<li>Mediator（抽象中介者）：定义一个接口用于与各同事对象之间的通信</li>\n<li>   ConcreteMediator（具体中介者）：抽象中介者的子类，通过协调各个同事对象来实现协作行为，了解并维护它的各个同事对象的引用；</li>\n<li>   Colleague（抽象同事类）：定义各同事的公有方法；</li>\n<li>   ConcreteColleague（具体同事类）：抽象同事类的子类，每一个同事对象都引用一个中介者对象；每一个同事对象在需要和其他同事对象通信时，先与中介者通信，通过中介者来间接完成与其他同事类的通信；在具体同事类中实现了在抽象同事类中定义的方法。</li>\n</ul>\n<p>下图展示了中介者模式中的类结构，可以清楚地看到四种角色之间的关系。<br><img src=\"http://image.stephenfang.me/mweb/15917481238616.jpg\"><br>图3.1 中介者模式类图</p>\n<p>中介者模式可以方便地应用于图形界面(GUI)开发中，在比较复杂的界面中可能存在多个界面组件之间的交互关系。对于这些复杂的交互关系，我们可以引入一个中介者类，将这些交互的组件作为具体的同事类，将它们之间的引用和控制关系交由中介者负责，在一定程度上简化系统的交互，<br>MVC架构中控制器（Controller）作为一种中介者，是数据模型对象与视图之间的桥梁，它监听视图上的交互动作并且对视图的状态作出反应，同时在Model通知数据发生改变的时候更新Model的状态。以移动应用开发为例，当用户点击按钮或在View中输入信息后视图会通知控制器，控制器解释用户交互逻辑，然后联系模型获取完成请求所需的信息。模型将信息提供给控制器，控制器将其中继到视图，视图将其显示给用户。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15917481870001.jpg\"></p>\n<p>图3.2 MVC模式</p>\n<h2 id=\"模式简例\"><a href=\"#模式简例\" class=\"headerlink\" title=\"模式简例\"></a>模式简例</h2><p>科技发达之后家里所有设备都是智能化的，而小明在家洗澡的时候有个习惯就是喜欢听歌，而且洗澡时候还要把窗帘拉上。因此就有这种情形，小明拉上窗帘说明洗浴设备需要工作，并且音乐设备也将唤醒。因此我们希望小明家的洗浴设备、音响设备和窗帘设备能协同合作，不管操作哪种设备，其他两种设备都有响应。<br>现在很明显我们可以看出来，我们有三个对象，也就是三种设备，程序看起来也很简单，只要在启动一个设备时，能同时启动另外两个设备。那么我们只需在一个设备的类里放两个其他设备的引用，很容易就能解决这个问题，这样写出来的程序对象关系如下图。<br><img src=\"http://image.stephenfang.me/mweb/15917485113553.jpg\"><br>图4.1 修改前模式<br>该程序最主要的功能就是在一个类里完成了对另外两个类的方法作用。但是这样设计，由耦合度过高的问题带来两个主要缺陷</p>\n<ul>\n<li>一旦窗帘设备损坏需要更换，那么就要让新的窗帘设备建立所有其他设备的连接</li>\n<li>若产生新的的需求，如洗澡的时候要把门锁住，那门锁的智能设备又要关联所有设备，这样的程序设计使得在扩展程序功能时更加麻烦。</li>\n</ul>\n<p>中介者模式的引入则极大的弥补了上述程序的两个缺陷，对象交互如下图：<br><img src=\"http://image.stephenfang.me/mweb/15917485380247.jpg\"><br>图4.2 修改后模式</p>\n<p>中介者就好比智能家居的管家，所有对象的交互指令都通过它来传达。中介者负责与对象联系，对象与对象之间不再进行直接的交互，也就是对对象关系进行解耦。</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/15917485453277.jpg\"><br>图4.2 程序类图</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MusicDevice</span> <span class=\"keyword\">extends</span> <span class=\"title\">Device</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operateDevice</span><span class=\"params\">(String str)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(str != <span class=\"string\">&quot;MusicDevice&quot;</span>)&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;音乐设备已启动&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(str == <span class=\"string\">&quot;true&quot;</span>)&#123;</span><br><span class=\"line\">            Mediator();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Mediator</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        ConcreteMediator mediator = <span class=\"keyword\">new</span> ConcreteMediator();</span><br><span class=\"line\">        mediator.startUp(<span class=\"string\">&quot;MusicDevice&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;\t</span><br></pre></td></tr></table></figure>\n<p>音乐设备部分的代码如上，其他设备代码可以参照此例。设备类都继承自Device类，其中主要由两个方法组成，一个是operateDevice函数，用来启动设备，另一个是Mediator函数，用来调用中介者，并以中介者为媒介启动其他设备。Mediator由operateDevice函数进行调用，并设置了判断条件，防止反复调用中介者类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConcreteMediator</span> <span class=\"keyword\">extends</span> <span class=\"title\">SmartMediator</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startUp</span><span class=\"params\">(String item)</span></span>&#123;</span><br><span class=\"line\">        MusicDevice musicDevice = <span class=\"keyword\">new</span> MusicDevice();</span><br><span class=\"line\">        CurtainDevice curtainDevice = <span class=\"keyword\">new</span> CurtainDevice();</span><br><span class=\"line\">        BathDevice bathDevice = <span class=\"keyword\">new</span> BathDevice();</span><br><span class=\"line\"></span><br><span class=\"line\">        musicDevice.operateDevice(item);</span><br><span class=\"line\">        curtainDevice.operateDevice(item);</span><br><span class=\"line\">        bathDevice.operateDevice(item);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>中介者类如上，即程序最为重要的部分。当它的startUp方法被某一设备调用之后，它会新建所有设备的类，并且调用除了已启动的设备之外，所有其他设备的启动方法。在启动方法中设置了参数，以防止循环调用。当我们想要添加新的设备的时候，只需要编写新设备类，并且在中介者类中添加该类的启动方法，就能完成修改。从而降低代码之间的耦合性，提高了程序的可维护性。</p>\n<p>程序分析：</p>\n<ol>\n<li>该程序解决了上述两个缺陷，现在所有设备都只与中介者相关联，不管是新增设备还是替换设备，只需要改变设备与中介者之间的关系，降低了代码之间的耦合性。</li>\n<li>改变设计之后所有设备的启动项都由中介者管理，用户可以通过中介者方便地启动所有设备，而不需要将所有设备之间连接起来。避免了随着设备的增多，设备之间的联系变得无比复杂的情况。</li>\n</ol>\n<h2 id=\"模式总结\"><a href=\"#模式总结\" class=\"headerlink\" title=\"模式总结\"></a>模式总结</h2><ol>\n<li><p>   中介者模式优点：    - 简化了对象之间的交互。    - 将各同事解耦，减少子类生成，增加对象的复用性。    - 简化各同事类的设计和实现，便于系统维护。</p>\n</li>\n<li><p>   中介者模式缺点：    - 在具体中介者类中包含了同事之间的交互细节，如果中介者类设计的不好，可能会导致具体中介者类非常复杂，使得系统难以维护。    - 中介者对象本身需要整理系统内部的对象之间的交互，可能会导致其本身会变得臃肿和复杂，进而变得难以维护</p>\n</li>\n<li><p>中介者模式的适用环境：</p>\n<ul>\n<li>系统中对象之间存在复杂的引用关系，产生的相互依赖关系结构混乱且难以理解。</li>\n<li>一个对象引用了很多对象并且直接和这些对象通信，导致难以复用该对象。</li>\n<li>希望通过一个中间类来封装多个类中的行为，而又不想生成太多的子类。可以通过引入中介者类来实现，在中介者中定义对象。</li>\n<li>交互的公共行为，如果需要改变行为则可以增加新的中介者类。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p><a href=\"https://zh.wikipedia.org/wiki/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F\">中介者模式-维基百科</a><br><a href=\"https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/mediator.html\">中介者模式— Graphic Design Patterns - 图说设计模式</a><br><a href=\"https://juejin.im/post/5bd275dc51882529290fe2c5\">设计模式 | 中介者模式及典型应用</a><br><a href=\"https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html\">中介者模式 - jyqdaisy - 博客园</a></p>\n","site":{"data":{}},"excerpt":"<p>中介者模式(Mediator Pattern)，又称为调停者模式，是一种对象行为型模式。该设计模式使用一个中介对象（中介者）来封装一系列的对象交互，使得各对象不需要显式地相互引用，从而使其耦合松散、独立地改变它们之间的交互。本文以设计模式的四个要素出发系统性地研究中介者模式。</p>","more":"<h2 id=\"模式目的\"><a href=\"#模式目的\" class=\"headerlink\" title=\"模式目的\"></a>模式目的</h2><p>中介的含义不难理解，以具体的生活场景为例，在租房、留学、找工作等时期或多或少都需要中介的帮助。互联网上实时更新的海量信息与错综复杂的关系让你无法分辨真实性与参考性，所以你无法躲避这些中介关系，只能够通过其获取你所需要的信息。<br>在软件世界也同样如此，当有多个对象彼此间相互交互的时候，自然就会想到对象间的耦合度过高，而中介者模式就是用来解决这一问题的，通过封装对象间的交互行为，来降低对象之间的耦合性，防止出现系统或模块内部过度耦合。以下的图片展现了具备复杂关联关系的对象模拟图。<br><img src=\"http://image.stephenfang.me/mweb/15917479538199.jpg\"><br>图2.1 复杂关联关系模拟图<br>根据上图以及以往程序设计中的经验，我们可以推断出程序设计中存在过多复杂关联关系带来的问题：</p>\n<ol>\n<li>   系统结构复杂：对象之间存在大量的相互关联和调用，若其中一个对象发生变化，则需要跟踪和该对象关联的其他所有对象并进行相应处理。</li>\n<li>   对象可重用性差：由于一个对象和其他对象具有很强的关联，若不存在其他对象的支持，一个对象很难被另一个系统或模块重用，这些对象表现像一个不可分割的整体，职责较为混乱。</li>\n<li>   系统扩展性低：增加一个新对象需要在原有相关对象上增加引用，同时调整原有对象，系统耦合度高，对象操作很不灵活，扩展性差。</li>\n</ol>\n<p>在面向对象的软件设计与开发过程中，根据“单一职责原则”，我们应该尽量将对象细化，使其只负责或呈现单一的职责。对于一个可能由很多对象构成的模块，这些对象之间可能存在相互的引用，为了减少对象两两之间复杂的引用关系，使之成为一个松耦合的系统，我们需要使用中介者模式，下图十分生动地展现了中介者模式的意义。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15917479852765.jpg\"><br>图2.2 中介者模式应用模拟图<br>由上述的描述可知，中介者模式的目的主要是为了降低模块内部之间类的相互引用，防止出现系统或模块内部过度耦合。</p>\n<h2 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h2><p>从问题出发，我们总结出中介者需要承担两方面的职责：</p>\n<ul>\n<li>中转作用（结构性）：<br>通过中介者提供的中转作用，各个同事对象就不再需要显式引用其他同事，当需要和其他同事进行通信时，通过中介者即可。</li>\n<li>协调作用（行为性）：<br>中介者可以更进一步的对同事之间的关系进行封装，同事可以一致地和中介者进行交互，而不需要指明中介者需要具体怎么做，中介者根据封装在自身内部的协调逻辑，对同事的请求进行进一步处理，将同事成员之间的关系行为进行分离和封装。</li>\n</ul>\n<p>从中介者模式的组成而言，其主要包含四个角色：</p>\n<ul>\n<li>Mediator（抽象中介者）：定义一个接口用于与各同事对象之间的通信</li>\n<li>   ConcreteMediator（具体中介者）：抽象中介者的子类，通过协调各个同事对象来实现协作行为，了解并维护它的各个同事对象的引用；</li>\n<li>   Colleague（抽象同事类）：定义各同事的公有方法；</li>\n<li>   ConcreteColleague（具体同事类）：抽象同事类的子类，每一个同事对象都引用一个中介者对象；每一个同事对象在需要和其他同事对象通信时，先与中介者通信，通过中介者来间接完成与其他同事类的通信；在具体同事类中实现了在抽象同事类中定义的方法。</li>\n</ul>\n<p>下图展示了中介者模式中的类结构，可以清楚地看到四种角色之间的关系。<br><img src=\"http://image.stephenfang.me/mweb/15917481238616.jpg\"><br>图3.1 中介者模式类图</p>\n<p>中介者模式可以方便地应用于图形界面(GUI)开发中，在比较复杂的界面中可能存在多个界面组件之间的交互关系。对于这些复杂的交互关系，我们可以引入一个中介者类，将这些交互的组件作为具体的同事类，将它们之间的引用和控制关系交由中介者负责，在一定程度上简化系统的交互，<br>MVC架构中控制器（Controller）作为一种中介者，是数据模型对象与视图之间的桥梁，它监听视图上的交互动作并且对视图的状态作出反应，同时在Model通知数据发生改变的时候更新Model的状态。以移动应用开发为例，当用户点击按钮或在View中输入信息后视图会通知控制器，控制器解释用户交互逻辑，然后联系模型获取完成请求所需的信息。模型将信息提供给控制器，控制器将其中继到视图，视图将其显示给用户。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15917481870001.jpg\"></p>\n<p>图3.2 MVC模式</p>\n<h2 id=\"模式简例\"><a href=\"#模式简例\" class=\"headerlink\" title=\"模式简例\"></a>模式简例</h2><p>科技发达之后家里所有设备都是智能化的，而小明在家洗澡的时候有个习惯就是喜欢听歌，而且洗澡时候还要把窗帘拉上。因此就有这种情形，小明拉上窗帘说明洗浴设备需要工作，并且音乐设备也将唤醒。因此我们希望小明家的洗浴设备、音响设备和窗帘设备能协同合作，不管操作哪种设备，其他两种设备都有响应。<br>现在很明显我们可以看出来，我们有三个对象，也就是三种设备，程序看起来也很简单，只要在启动一个设备时，能同时启动另外两个设备。那么我们只需在一个设备的类里放两个其他设备的引用，很容易就能解决这个问题，这样写出来的程序对象关系如下图。<br><img src=\"http://image.stephenfang.me/mweb/15917485113553.jpg\"><br>图4.1 修改前模式<br>该程序最主要的功能就是在一个类里完成了对另外两个类的方法作用。但是这样设计，由耦合度过高的问题带来两个主要缺陷</p>\n<ul>\n<li>一旦窗帘设备损坏需要更换，那么就要让新的窗帘设备建立所有其他设备的连接</li>\n<li>若产生新的的需求，如洗澡的时候要把门锁住，那门锁的智能设备又要关联所有设备，这样的程序设计使得在扩展程序功能时更加麻烦。</li>\n</ul>\n<p>中介者模式的引入则极大的弥补了上述程序的两个缺陷，对象交互如下图：<br><img src=\"http://image.stephenfang.me/mweb/15917485380247.jpg\"><br>图4.2 修改后模式</p>\n<p>中介者就好比智能家居的管家，所有对象的交互指令都通过它来传达。中介者负责与对象联系，对象与对象之间不再进行直接的交互，也就是对对象关系进行解耦。</p>\n<p> <img src=\"http://image.stephenfang.me/mweb/15917485453277.jpg\"><br>图4.2 程序类图</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MusicDevice</span> <span class=\"keyword\">extends</span> <span class=\"title\">Device</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">operateDevice</span><span class=\"params\">(String str)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(str != <span class=\"string\">&quot;MusicDevice&quot;</span>)&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;音乐设备已启动&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(str == <span class=\"string\">&quot;true&quot;</span>)&#123;</span><br><span class=\"line\">            Mediator();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">Mediator</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        ConcreteMediator mediator = <span class=\"keyword\">new</span> ConcreteMediator();</span><br><span class=\"line\">        mediator.startUp(<span class=\"string\">&quot;MusicDevice&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;\t</span><br></pre></td></tr></table></figure>\n<p>音乐设备部分的代码如上，其他设备代码可以参照此例。设备类都继承自Device类，其中主要由两个方法组成，一个是operateDevice函数，用来启动设备，另一个是Mediator函数，用来调用中介者，并以中介者为媒介启动其他设备。Mediator由operateDevice函数进行调用，并设置了判断条件，防止反复调用中介者类。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ConcreteMediator</span> <span class=\"keyword\">extends</span> <span class=\"title\">SmartMediator</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">startUp</span><span class=\"params\">(String item)</span></span>&#123;</span><br><span class=\"line\">        MusicDevice musicDevice = <span class=\"keyword\">new</span> MusicDevice();</span><br><span class=\"line\">        CurtainDevice curtainDevice = <span class=\"keyword\">new</span> CurtainDevice();</span><br><span class=\"line\">        BathDevice bathDevice = <span class=\"keyword\">new</span> BathDevice();</span><br><span class=\"line\"></span><br><span class=\"line\">        musicDevice.operateDevice(item);</span><br><span class=\"line\">        curtainDevice.operateDevice(item);</span><br><span class=\"line\">        bathDevice.operateDevice(item);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>中介者类如上，即程序最为重要的部分。当它的startUp方法被某一设备调用之后，它会新建所有设备的类，并且调用除了已启动的设备之外，所有其他设备的启动方法。在启动方法中设置了参数，以防止循环调用。当我们想要添加新的设备的时候，只需要编写新设备类，并且在中介者类中添加该类的启动方法，就能完成修改。从而降低代码之间的耦合性，提高了程序的可维护性。</p>\n<p>程序分析：</p>\n<ol>\n<li>该程序解决了上述两个缺陷，现在所有设备都只与中介者相关联，不管是新增设备还是替换设备，只需要改变设备与中介者之间的关系，降低了代码之间的耦合性。</li>\n<li>改变设计之后所有设备的启动项都由中介者管理，用户可以通过中介者方便地启动所有设备，而不需要将所有设备之间连接起来。避免了随着设备的增多，设备之间的联系变得无比复杂的情况。</li>\n</ol>\n<h2 id=\"模式总结\"><a href=\"#模式总结\" class=\"headerlink\" title=\"模式总结\"></a>模式总结</h2><ol>\n<li><p>   中介者模式优点：    - 简化了对象之间的交互。    - 将各同事解耦，减少子类生成，增加对象的复用性。    - 简化各同事类的设计和实现，便于系统维护。</p>\n</li>\n<li><p>   中介者模式缺点：    - 在具体中介者类中包含了同事之间的交互细节，如果中介者类设计的不好，可能会导致具体中介者类非常复杂，使得系统难以维护。    - 中介者对象本身需要整理系统内部的对象之间的交互，可能会导致其本身会变得臃肿和复杂，进而变得难以维护</p>\n</li>\n<li><p>中介者模式的适用环境：</p>\n<ul>\n<li>系统中对象之间存在复杂的引用关系，产生的相互依赖关系结构混乱且难以理解。</li>\n<li>一个对象引用了很多对象并且直接和这些对象通信，导致难以复用该对象。</li>\n<li>希望通过一个中间类来封装多个类中的行为，而又不想生成太多的子类。可以通过引入中介者类来实现，在中介者中定义对象。</li>\n<li>交互的公共行为，如果需要改变行为则可以增加新的中介者类。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p><a href=\"https://zh.wikipedia.org/wiki/%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F\">中介者模式-维基百科</a><br><a href=\"https://design-patterns.readthedocs.io/zh_CN/latest/behavioral_patterns/mediator.html\">中介者模式— Graphic Design Patterns - 图说设计模式</a><br><a href=\"https://juejin.im/post/5bd275dc51882529290fe2c5\">设计模式 | 中介者模式及典型应用</a><br><a href=\"https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html\">中介者模式 - jyqdaisy - 博客园</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/15917479538199.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:03 GMT+0800 (中国标准时间)","title":"软件设计模式 - 中介者模式","path":"2020/06/03/Mediator_Pattern/","eyeCatchImage":"http://image.stephenfang.me/mweb/15917479538199.jpg","excerpt":"<p>中介者模式(Mediator Pattern)，又称为调停者模式，是一种对象行为型模式。该设计模式使用一个中介对象（中介者）来封装一系列的对象交互，使得各对象不需要显式地相互引用，从而使其耦合松散、独立地改变它们之间的交互。本文以设计模式的四个要素出发系统性地研究中介者模式。</p>","date":{"_isAMomentObject":true,"_i":"2020-06-03T09:23:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-03T09:23:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["设计模式","Java"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":3896},{"title":"Muzik开发总结 — AVAudioPlayer 实践","date":"2020-07-08T11:20:20.000Z","copyright":true,"_content":"\n最近又放弃了使用 Apple Music，作为一个从音乐下载时代过来的人，我仍然保持着将歌曲同步至 iPhone 再聆听的习惯，即使我仍然无法摆脱流媒体的束缚。话说回来，Apple 原生的 Music.app 的体验除了交互，于我而言是糟糕的，我更希望有一款 Tab Based 的 iOS App 支撑这种体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好学习一些 UIKit 控件。\n\n<!--more-->\n\n## 目的\n本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于实践一个简单的 AVAudioPlayer Demo 模拟 Music.app 的播放功能，内容十分基础。\n需要注意的是，此 Demo 并没有采用读取系统音乐资料库需要的 MPMediaPlayer。\n\n## 环境\n- Swift 5\n- iOS 13.5\n- Xcode 11.5\n\n在 Xcode 项目属性的 General 选项卡中点击底部的 Frameworks and Libraries，搜索AVFoundation Framework 将其添加至项目中。\n\n## 歌曲列表界面\n为了进行简单的 Demo，我将两首下载好歌曲添加到 Xcode 项目文件夹下，分别为```Song1.mp3```与```Song2.mp3```，并创建简单的结构体命名为 Song：\n```swift\nstruct Song {\n    let songName: String\n    let albumName: String\n    let artistName: String\n    let imageName: String\n    let trackName: String\n}\n```\n为了在播放时展示专辑封面，我将两首 .mp3 文件的专辑封面添加至 Assets，参照 Song 命名为 Cover1 与 Cover 2。我比较习惯于 AutoLayout 与代码布局共同使用，使用 StoryBoard 进行小项目的简单布局十分方便。\n首先，创建一个```ViewController```展示歌曲页面，添加```UITableView```并调整约束，需要将 TableView 对象的 ```Content``` 属性改为 ```Dynamic Prototypes```，将 对象的Cell的 ```Style```属性更改为```Subtitle```，至此 StoryBoard 部分已经完成。\n来到与该```ViewController```相对应的```ViewController.swift```文件，由于是在Storyboard中创建```UITableView```，所以需要通过```@IBOutlet```连接之前创建的```UITableView```，方法如Ctrl+拖拽，同时需要在```viewDidLoad()```中设置```UITableView```对象的```delegate```与```dataSource```。需要注意的是使用```UITableView```的方法需要 conforms to 相关的 protocols, 以上均为基本操作。\n我需要在```viewDidLoad()```阶段加载歌曲的相关信息，于是创建```configureSongs()```方法为```songs```数组添加相关数据（需要在之前创建）。\n尝试完成页面功能布局，作为Demo该 TableView 对象只包含一个 Section 的内容，如果需要调用系统音乐资料库的 ```MPMediaItem```，需要使用 NSRange 对不同 Section 的内容进行排序（A-Z）。为了避免列表中图片大小显示不一致问题，我将 Row 的高度更改为60。在```cellForRowAt```方法中定制 cell，在```didSelectRowAt```方法中令其 present 播放器页面，相关内容在后文中讨论，目前这个页面看起来是这样的(先忽略 Tab 的效果)。\n![](http://image.stephenfang.me/screen1.png)\n懒人代码如下：\n```swift\nimport UIKit\n\nclass ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource{\n    \n    @IBOutlet var songTable: UITableView!\n    \n    var songs = [Song]()\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n        configureSongs()\n        songTable.delegate = self\n        songTable.dataSource = self\n    }\n    \n    func configureSongs() {\n        songs.append(Song(songName: \"Pretender\", albumName: \"Pretender\", artistName: \"Official鬍子男dism\", imageName: \"Cover1\", trackName: \"Song1\"))\n        songs.append(Song(songName: \"Imagine\", albumName: \"The Mango Tree\", artistName: \"Jack Johnson\", imageName: \"Cover2\", trackName: \"Song2\"))\n    }\n    \n    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {\n        return songs.count\n    }\n    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {\n        return 60\n    }\n    \n    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {\n        let songCell = tableView.dequeueReusableCell(withIdentifier: \"songCell\", for: indexPath)\n        let song = songs[indexPath.row]\n        \n        songCell.textLabel?.text = song.songName\n        songCell.detailTextLabel?.text = song.albumName + \"  \" + song.artistName\n        songCell.imageView?.image = UIImage(named: song.imageName)\n        \n        return songCell\n    }\n    \n    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {\n        tableView.deselectRow(at: indexPath, animated: true)\n        \n        let position = indexPath.row\n        \n        guard let songView = storyboard?.instantiateViewController(identifier: \"player\") as? PlayerViewController else {\n            return\n        }\n        songView.position = position\n        songView.songs = songs\n        \n        present(songView,animated: true)\n    }\n    \n}\n```\n    \n## 正在播放界面\n创建```PlayerViewController```展示正在播放的页面，不需要与任何View进行连接，之后创建一个 UIView 令其紧贴 Safe Area 将其命名为 holder。这次我采用代码进行布局，最终看起来应该是这样的，虽然很不美观但是 it just works。\n![](http://image.stephenfang.me/screen2.png)。\n在开始代码注解前了解一下我的思路。其中```viewDidLayoutSubviews```方法在controller 的子视图的 position 和 size 被改变的时候被调用。在 view 已经被设计 subviews 并且还没有被展示在屏幕上时候，可以调用此方法改变这个view。任何依赖于 bounds 并且需要完成的操作都应该放在```viewDidLayoutSubviews```中而不是```viewDidLoad```或```viewWillAppear```中，因为 view 的 frame 和 bounds 直到 AutoLayout 完成工作的时候才会被确定，所以在执行完Auto Layout之后会调用此方法。\n当用户点击上一首歌曲或下一首歌曲按钮后，需要改变控件内容的显示，我的想法是通过调用```removeFromSuperview()```方法，该方法即进行视图节点删除的操作，执行这个方法等于在 View 的树形结构中找到该节点并删除该节点及其子节点，而并非只是删除该节点自己，同时把该对象从响应者链中移除。在ARC的情况下执行```removeFromSuperview```方法多次也没有问题因为由系统自动管理。\n那么在调用```removeFromSuperview```后势必需要重新载入页面元素，并且控制播放的过程，这个时候可以采用一个统一的方法在页面载入、切换的时候进行操作。对于 ```AVAudioPlayer```的调用方面，需要导入```AVFoundation```框架并初始化```AVAudioPlayer```对象。由于之前导入了 .mp3 文件，需要做的是让```AVAudioPlayer```获取待播放的歌曲 url，之前的 ViewController 对 Song 的具体内容有定义，而```Bundle.main.path```代表获取工程目录下的文件。系统启动时会激活 ```AVAudioSession```，通过设置```active```为\"true\"激活 Session，设置为“false”解除 Session 的激活状态，```options```使用 “.notifyOthersOnDeactivation” 使音频会话停用时其它音频会话可以返回到其它活动状态。对于```sharedInstance```包含五种设置方法，希望深入了解的参见这篇文章 [AVAudioSession - Category、Model、Options、Error参数详解](https://www.jianshu.com/p/ae843162ace1)\nInt 类型的变量```position```代表当前用户点按的歌曲在 songs 中所处下标，相关的 UIElement 配置都很容易理解不在此赘述，为了模拟 Music.app 的效果，我尝试使用\n```swift\n UIView.animate(withDuration: 0.2, animations: {\n                self.albumImageView.frame = CGRect(x: 30, y: 30, width: self.holder.frame.size.width - 60, height: self.holder.frame.size.width - 60)\n            })\n```\n实现类似的点击暂停或播放按钮后专辑封面大小变化的的效果，如果页面上已经对元素进行了大小限制使用```CGAffineTransform(scaleX: <CGFloat>, y: <CGFloat>)```也能够达到类似的效果。最后给出此次 Demo 所有的代码，对于播放器的开发进展我会持续更新，🦔本系列的第一篇文章。\n```swift\nimport UIKit\nimport AVFoundation\n\nclass PlayerViewController: UIViewController {\n    \n    public var position: Int = 0\n    public var songs: [Song] = []\n    \n    @IBOutlet weak var holder: UIView!\n    \n    var player: AVAudioPlayer?\n    let playPauseButton = UIButton()\n    \n    private let albumImageView: UIImageView = {\n        let imageView = UIImageView()\n        imageView.contentMode = .scaleAspectFill\n        return imageView\n    } ()\n    \n    private let nameLabel: UILabel = {\n        let label = UILabel()\n        label.textAlignment = .center\n        label.numberOfLines = 0\n        return label\n    } ()\n    \n    private let albumLabel: UILabel = {\n        let label = UILabel()\n        label.textAlignment = .center\n        label.numberOfLines = 0\n        return label\n    } ()\n    \n    private let artistLabel: UILabel = {\n        let label = UILabel()\n        label.textAlignment = .center\n        label.numberOfLines = 0\n        return label\n    } ()\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n    \n    override func viewDidLayoutSubviews() {\n        super.viewDidLayoutSubviews()\n        if holder.subviews.count == 0 {\n            configurePlayer()\n        }\n    }\n    \n    override func viewWillDisappear(_ animated: Bool) {\n        super.viewWillDisappear(animated)\n        if let player = player {\n            player.stop()\n        }\n    }\n    \n    func configurePlayer() {\n        let song = songs[position]\n        let urlString = Bundle.main.path(forResource: song.trackName, ofType: \".mp3\")\n        do {\n            try AVAudioSession.sharedInstance().setMode(.default)\n            try AVAudioSession.sharedInstance().setActive(true, options: .notifyOthersOnDeactivation)\n            \n            guard let urlString = urlString else {\n                return\n            }\n            \n            player = try AVAudioPlayer(contentsOf: URL(string: urlString)!)\n            guard let player = player else {\n                return\n            }\n            player.volume = 0.5\n            \n            player.play()\n        } catch  {\n            print(\"Error occurred\")\n        }\n        \n        // UI\n        // Album\n        albumImageView.frame = CGRect(x: 10,\n                                      y: 10,\n                                      width: holder.frame.size.width - 20,\n                                      height: holder.frame.size.width - 20)\n        albumImageView.image = UIImage(named: song.imageName)\n        holder.addSubview(albumImageView)\n        \n        // Label\n        nameLabel.frame = CGRect(x: 10, y: albumImageView.frame.size.height + 10, width: holder.frame.size.width - 20 , height: 70)\n        albumLabel.frame = CGRect(x: 10, y: albumImageView.frame.size.height + 80, width: holder.frame.size.width - 20 , height: 70)\n        artistLabel.frame = CGRect(x: 10, y: albumImageView.frame.size.height + 140, width: holder.frame.size.width - 20 , height: 70)\n        \n        nameLabel.text = song.songName\n        albumLabel.text = song.albumName\n        artistLabel.text = song.artistName\n        \n        holder.addSubview(nameLabel)\n        holder.addSubview(albumLabel)\n        holder.addSubview(artistLabel)\n        \n        // Button\n        let nextButton = UIButton()\n        let backButton = UIButton()\n        \n        let buttonSize: CGFloat = 50\n        \n        playPauseButton.frame = CGRect(x: (holder.frame.size.width - buttonSize)/2.0, y: artistLabel.frame.origin.y + 90, width: buttonSize, height: buttonSize)\n        nextButton.frame = CGRect(x: holder.frame.size.width - 20 - buttonSize, y: artistLabel.frame.origin.y + 90, width: buttonSize, height: buttonSize)\n        backButton.frame = CGRect(x: 20, y: artistLabel.frame.origin.y + 90, width: buttonSize, height: buttonSize)\n        \n        playPauseButton.addTarget(self, action: #selector(didTapPauseButton), for: .touchUpInside)\n        nextButton.addTarget(self, action: #selector(didTapNextButton), for: .touchUpInside)\n        backButton.addTarget(self, action: #selector(didTapBackButton), for: .touchUpInside)\n        \n        playPauseButton.setBackgroundImage(UIImage(systemName: \"pause.fill\"), for: .normal)\n        nextButton.setBackgroundImage(UIImage(systemName: \"forward.fill\"), for: .normal)\n        backButton.setBackgroundImage(UIImage(systemName: \"backward.fill\"), for: .normal)\n        \n        playPauseButton.tintColor = .black\n        nextButton.tintColor = .black\n        backButton.tintColor = .black\n        \n        holder.addSubview(playPauseButton)\n        holder.addSubview(nextButton)\n        holder.addSubview(backButton)\n        \n        // Element\n        let slider = UISlider(frame: CGRect(x: 20, y: holder.frame.size.height - 60, width: holder.frame.size.width - 40, height: 50))\n        \n        slider.value = 50\n        slider.addTarget(self, action: #selector(didSlideSlider(_:)), for: .valueChanged)\n        holder.addSubview(slider)\n        \n    }\n    \n    @objc func didSlideSlider (_ slider: UISlider){\n        let value = slider.value\n        player?.volume = value\n    }\n    \n    @objc func didTapPauseButton (){\n        if player?.isPlaying == true {\n            player?.pause()\n            playPauseButton.setBackgroundImage(UIImage(systemName: \"play.fill\"), for: .normal)\n            UIView.animate(withDuration: 0.2, animations: {\n                self.albumImageView.frame = CGRect(x: 30, y: 30, width: self.holder.frame.size.width - 60, height: self.holder.frame.size.width - 60)\n            })\n        } else {\n            player?.play()\n            playPauseButton.setBackgroundImage(UIImage(systemName: \"pause.fill\"), for: .normal)\n            UIView.animate(withDuration: 0.2, animations: {\n                self.albumImageView.frame = CGRect(x: 10, y: 10, width: self.holder.frame.size.width - 20, height: self.holder.frame.size.width - 20)\n            })\n        }\n    }\n    \n    @objc func didTapNextButton (){\n        if position < (songs.count - 1 ){\n            position = position + 1\n            player?.stop()\n            for subview in holder.subviews {\n                subview.removeFromSuperview()\n            }\n            configurePlayer()\n        }\n    }\n    \n    @objc func didTapBackButton (){\n        if position > 0 {\n            position = position - 1\n            player?.stop()\n            for subview in holder.subviews {\n                subview.removeFromSuperview()\n            }\n            configurePlayer()\n        }\n    }\n    \n}\n```","source":"_posts/Muzik_GettingStarted.md","raw":"---\ntitle: Muzik开发总结 — AVAudioPlayer 实践\ndate: 2020-07-08 19:20:20\ncategories: \n- 技术\ntags: \n- iOS\n- AudioPlayer\n- Swift\ncopyright: true\n---\n\n最近又放弃了使用 Apple Music，作为一个从音乐下载时代过来的人，我仍然保持着将歌曲同步至 iPhone 再聆听的习惯，即使我仍然无法摆脱流媒体的束缚。话说回来，Apple 原生的 Music.app 的体验除了交互，于我而言是糟糕的，我更希望有一款 Tab Based 的 iOS App 支撑这种体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好学习一些 UIKit 控件。\n\n<!--more-->\n\n## 目的\n本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于实践一个简单的 AVAudioPlayer Demo 模拟 Music.app 的播放功能，内容十分基础。\n需要注意的是，此 Demo 并没有采用读取系统音乐资料库需要的 MPMediaPlayer。\n\n## 环境\n- Swift 5\n- iOS 13.5\n- Xcode 11.5\n\n在 Xcode 项目属性的 General 选项卡中点击底部的 Frameworks and Libraries，搜索AVFoundation Framework 将其添加至项目中。\n\n## 歌曲列表界面\n为了进行简单的 Demo，我将两首下载好歌曲添加到 Xcode 项目文件夹下，分别为```Song1.mp3```与```Song2.mp3```，并创建简单的结构体命名为 Song：\n```swift\nstruct Song {\n    let songName: String\n    let albumName: String\n    let artistName: String\n    let imageName: String\n    let trackName: String\n}\n```\n为了在播放时展示专辑封面，我将两首 .mp3 文件的专辑封面添加至 Assets，参照 Song 命名为 Cover1 与 Cover 2。我比较习惯于 AutoLayout 与代码布局共同使用，使用 StoryBoard 进行小项目的简单布局十分方便。\n首先，创建一个```ViewController```展示歌曲页面，添加```UITableView```并调整约束，需要将 TableView 对象的 ```Content``` 属性改为 ```Dynamic Prototypes```，将 对象的Cell的 ```Style```属性更改为```Subtitle```，至此 StoryBoard 部分已经完成。\n来到与该```ViewController```相对应的```ViewController.swift```文件，由于是在Storyboard中创建```UITableView```，所以需要通过```@IBOutlet```连接之前创建的```UITableView```，方法如Ctrl+拖拽，同时需要在```viewDidLoad()```中设置```UITableView```对象的```delegate```与```dataSource```。需要注意的是使用```UITableView```的方法需要 conforms to 相关的 protocols, 以上均为基本操作。\n我需要在```viewDidLoad()```阶段加载歌曲的相关信息，于是创建```configureSongs()```方法为```songs```数组添加相关数据（需要在之前创建）。\n尝试完成页面功能布局，作为Demo该 TableView 对象只包含一个 Section 的内容，如果需要调用系统音乐资料库的 ```MPMediaItem```，需要使用 NSRange 对不同 Section 的内容进行排序（A-Z）。为了避免列表中图片大小显示不一致问题，我将 Row 的高度更改为60。在```cellForRowAt```方法中定制 cell，在```didSelectRowAt```方法中令其 present 播放器页面，相关内容在后文中讨论，目前这个页面看起来是这样的(先忽略 Tab 的效果)。\n![](http://image.stephenfang.me/screen1.png)\n懒人代码如下：\n```swift\nimport UIKit\n\nclass ViewController: UIViewController, UITableViewDelegate, UITableViewDataSource{\n    \n    @IBOutlet var songTable: UITableView!\n    \n    var songs = [Song]()\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n        configureSongs()\n        songTable.delegate = self\n        songTable.dataSource = self\n    }\n    \n    func configureSongs() {\n        songs.append(Song(songName: \"Pretender\", albumName: \"Pretender\", artistName: \"Official鬍子男dism\", imageName: \"Cover1\", trackName: \"Song1\"))\n        songs.append(Song(songName: \"Imagine\", albumName: \"The Mango Tree\", artistName: \"Jack Johnson\", imageName: \"Cover2\", trackName: \"Song2\"))\n    }\n    \n    func tableView(_ tableView: UITableView, numberOfRowsInSection section: Int) -> Int {\n        return songs.count\n    }\n    func tableView(_ tableView: UITableView, heightForRowAt indexPath: IndexPath) -> CGFloat {\n        return 60\n    }\n    \n    func tableView(_ tableView: UITableView, cellForRowAt indexPath: IndexPath) -> UITableViewCell {\n        let songCell = tableView.dequeueReusableCell(withIdentifier: \"songCell\", for: indexPath)\n        let song = songs[indexPath.row]\n        \n        songCell.textLabel?.text = song.songName\n        songCell.detailTextLabel?.text = song.albumName + \"  \" + song.artistName\n        songCell.imageView?.image = UIImage(named: song.imageName)\n        \n        return songCell\n    }\n    \n    func tableView(_ tableView: UITableView, didSelectRowAt indexPath: IndexPath) {\n        tableView.deselectRow(at: indexPath, animated: true)\n        \n        let position = indexPath.row\n        \n        guard let songView = storyboard?.instantiateViewController(identifier: \"player\") as? PlayerViewController else {\n            return\n        }\n        songView.position = position\n        songView.songs = songs\n        \n        present(songView,animated: true)\n    }\n    \n}\n```\n    \n## 正在播放界面\n创建```PlayerViewController```展示正在播放的页面，不需要与任何View进行连接，之后创建一个 UIView 令其紧贴 Safe Area 将其命名为 holder。这次我采用代码进行布局，最终看起来应该是这样的，虽然很不美观但是 it just works。\n![](http://image.stephenfang.me/screen2.png)。\n在开始代码注解前了解一下我的思路。其中```viewDidLayoutSubviews```方法在controller 的子视图的 position 和 size 被改变的时候被调用。在 view 已经被设计 subviews 并且还没有被展示在屏幕上时候，可以调用此方法改变这个view。任何依赖于 bounds 并且需要完成的操作都应该放在```viewDidLayoutSubviews```中而不是```viewDidLoad```或```viewWillAppear```中，因为 view 的 frame 和 bounds 直到 AutoLayout 完成工作的时候才会被确定，所以在执行完Auto Layout之后会调用此方法。\n当用户点击上一首歌曲或下一首歌曲按钮后，需要改变控件内容的显示，我的想法是通过调用```removeFromSuperview()```方法，该方法即进行视图节点删除的操作，执行这个方法等于在 View 的树形结构中找到该节点并删除该节点及其子节点，而并非只是删除该节点自己，同时把该对象从响应者链中移除。在ARC的情况下执行```removeFromSuperview```方法多次也没有问题因为由系统自动管理。\n那么在调用```removeFromSuperview```后势必需要重新载入页面元素，并且控制播放的过程，这个时候可以采用一个统一的方法在页面载入、切换的时候进行操作。对于 ```AVAudioPlayer```的调用方面，需要导入```AVFoundation```框架并初始化```AVAudioPlayer```对象。由于之前导入了 .mp3 文件，需要做的是让```AVAudioPlayer```获取待播放的歌曲 url，之前的 ViewController 对 Song 的具体内容有定义，而```Bundle.main.path```代表获取工程目录下的文件。系统启动时会激活 ```AVAudioSession```，通过设置```active```为\"true\"激活 Session，设置为“false”解除 Session 的激活状态，```options```使用 “.notifyOthersOnDeactivation” 使音频会话停用时其它音频会话可以返回到其它活动状态。对于```sharedInstance```包含五种设置方法，希望深入了解的参见这篇文章 [AVAudioSession - Category、Model、Options、Error参数详解](https://www.jianshu.com/p/ae843162ace1)\nInt 类型的变量```position```代表当前用户点按的歌曲在 songs 中所处下标，相关的 UIElement 配置都很容易理解不在此赘述，为了模拟 Music.app 的效果，我尝试使用\n```swift\n UIView.animate(withDuration: 0.2, animations: {\n                self.albumImageView.frame = CGRect(x: 30, y: 30, width: self.holder.frame.size.width - 60, height: self.holder.frame.size.width - 60)\n            })\n```\n实现类似的点击暂停或播放按钮后专辑封面大小变化的的效果，如果页面上已经对元素进行了大小限制使用```CGAffineTransform(scaleX: <CGFloat>, y: <CGFloat>)```也能够达到类似的效果。最后给出此次 Demo 所有的代码，对于播放器的开发进展我会持续更新，🦔本系列的第一篇文章。\n```swift\nimport UIKit\nimport AVFoundation\n\nclass PlayerViewController: UIViewController {\n    \n    public var position: Int = 0\n    public var songs: [Song] = []\n    \n    @IBOutlet weak var holder: UIView!\n    \n    var player: AVAudioPlayer?\n    let playPauseButton = UIButton()\n    \n    private let albumImageView: UIImageView = {\n        let imageView = UIImageView()\n        imageView.contentMode = .scaleAspectFill\n        return imageView\n    } ()\n    \n    private let nameLabel: UILabel = {\n        let label = UILabel()\n        label.textAlignment = .center\n        label.numberOfLines = 0\n        return label\n    } ()\n    \n    private let albumLabel: UILabel = {\n        let label = UILabel()\n        label.textAlignment = .center\n        label.numberOfLines = 0\n        return label\n    } ()\n    \n    private let artistLabel: UILabel = {\n        let label = UILabel()\n        label.textAlignment = .center\n        label.numberOfLines = 0\n        return label\n    } ()\n    \n    override func viewDidLoad() {\n        super.viewDidLoad()\n    }\n    \n    override func viewDidLayoutSubviews() {\n        super.viewDidLayoutSubviews()\n        if holder.subviews.count == 0 {\n            configurePlayer()\n        }\n    }\n    \n    override func viewWillDisappear(_ animated: Bool) {\n        super.viewWillDisappear(animated)\n        if let player = player {\n            player.stop()\n        }\n    }\n    \n    func configurePlayer() {\n        let song = songs[position]\n        let urlString = Bundle.main.path(forResource: song.trackName, ofType: \".mp3\")\n        do {\n            try AVAudioSession.sharedInstance().setMode(.default)\n            try AVAudioSession.sharedInstance().setActive(true, options: .notifyOthersOnDeactivation)\n            \n            guard let urlString = urlString else {\n                return\n            }\n            \n            player = try AVAudioPlayer(contentsOf: URL(string: urlString)!)\n            guard let player = player else {\n                return\n            }\n            player.volume = 0.5\n            \n            player.play()\n        } catch  {\n            print(\"Error occurred\")\n        }\n        \n        // UI\n        // Album\n        albumImageView.frame = CGRect(x: 10,\n                                      y: 10,\n                                      width: holder.frame.size.width - 20,\n                                      height: holder.frame.size.width - 20)\n        albumImageView.image = UIImage(named: song.imageName)\n        holder.addSubview(albumImageView)\n        \n        // Label\n        nameLabel.frame = CGRect(x: 10, y: albumImageView.frame.size.height + 10, width: holder.frame.size.width - 20 , height: 70)\n        albumLabel.frame = CGRect(x: 10, y: albumImageView.frame.size.height + 80, width: holder.frame.size.width - 20 , height: 70)\n        artistLabel.frame = CGRect(x: 10, y: albumImageView.frame.size.height + 140, width: holder.frame.size.width - 20 , height: 70)\n        \n        nameLabel.text = song.songName\n        albumLabel.text = song.albumName\n        artistLabel.text = song.artistName\n        \n        holder.addSubview(nameLabel)\n        holder.addSubview(albumLabel)\n        holder.addSubview(artistLabel)\n        \n        // Button\n        let nextButton = UIButton()\n        let backButton = UIButton()\n        \n        let buttonSize: CGFloat = 50\n        \n        playPauseButton.frame = CGRect(x: (holder.frame.size.width - buttonSize)/2.0, y: artistLabel.frame.origin.y + 90, width: buttonSize, height: buttonSize)\n        nextButton.frame = CGRect(x: holder.frame.size.width - 20 - buttonSize, y: artistLabel.frame.origin.y + 90, width: buttonSize, height: buttonSize)\n        backButton.frame = CGRect(x: 20, y: artistLabel.frame.origin.y + 90, width: buttonSize, height: buttonSize)\n        \n        playPauseButton.addTarget(self, action: #selector(didTapPauseButton), for: .touchUpInside)\n        nextButton.addTarget(self, action: #selector(didTapNextButton), for: .touchUpInside)\n        backButton.addTarget(self, action: #selector(didTapBackButton), for: .touchUpInside)\n        \n        playPauseButton.setBackgroundImage(UIImage(systemName: \"pause.fill\"), for: .normal)\n        nextButton.setBackgroundImage(UIImage(systemName: \"forward.fill\"), for: .normal)\n        backButton.setBackgroundImage(UIImage(systemName: \"backward.fill\"), for: .normal)\n        \n        playPauseButton.tintColor = .black\n        nextButton.tintColor = .black\n        backButton.tintColor = .black\n        \n        holder.addSubview(playPauseButton)\n        holder.addSubview(nextButton)\n        holder.addSubview(backButton)\n        \n        // Element\n        let slider = UISlider(frame: CGRect(x: 20, y: holder.frame.size.height - 60, width: holder.frame.size.width - 40, height: 50))\n        \n        slider.value = 50\n        slider.addTarget(self, action: #selector(didSlideSlider(_:)), for: .valueChanged)\n        holder.addSubview(slider)\n        \n    }\n    \n    @objc func didSlideSlider (_ slider: UISlider){\n        let value = slider.value\n        player?.volume = value\n    }\n    \n    @objc func didTapPauseButton (){\n        if player?.isPlaying == true {\n            player?.pause()\n            playPauseButton.setBackgroundImage(UIImage(systemName: \"play.fill\"), for: .normal)\n            UIView.animate(withDuration: 0.2, animations: {\n                self.albumImageView.frame = CGRect(x: 30, y: 30, width: self.holder.frame.size.width - 60, height: self.holder.frame.size.width - 60)\n            })\n        } else {\n            player?.play()\n            playPauseButton.setBackgroundImage(UIImage(systemName: \"pause.fill\"), for: .normal)\n            UIView.animate(withDuration: 0.2, animations: {\n                self.albumImageView.frame = CGRect(x: 10, y: 10, width: self.holder.frame.size.width - 20, height: self.holder.frame.size.width - 20)\n            })\n        }\n    }\n    \n    @objc func didTapNextButton (){\n        if position < (songs.count - 1 ){\n            position = position + 1\n            player?.stop()\n            for subview in holder.subviews {\n                subview.removeFromSuperview()\n            }\n            configurePlayer()\n        }\n    }\n    \n    @objc func didTapBackButton (){\n        if position > 0 {\n            position = position - 1\n            player?.stop()\n            for subview in holder.subviews {\n                subview.removeFromSuperview()\n            }\n            configurePlayer()\n        }\n    }\n    \n}\n```","slug":"Muzik_GettingStarted","published":1,"updated":"2022-07-24T15:20:12.059Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1u000vo76fe6k72xdb","content":"<p>最近又放弃了使用 Apple Music，作为一个从音乐下载时代过来的人，我仍然保持着将歌曲同步至 iPhone 再聆听的习惯，即使我仍然无法摆脱流媒体的束缚。话说回来，Apple 原生的 Music.app 的体验除了交互，于我而言是糟糕的，我更希望有一款 Tab Based 的 iOS App 支撑这种体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好学习一些 UIKit 控件。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"目的\"><a href=\"#目的\" class=\"headerlink\" title=\"目的\"></a>目的</h2><p>本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于实践一个简单的 AVAudioPlayer Demo 模拟 Music.app 的播放功能，内容十分基础。<br>需要注意的是，此 Demo 并没有采用读取系统音乐资料库需要的 MPMediaPlayer。</p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li>Swift 5</li>\n<li>iOS 13.5</li>\n<li>Xcode 11.5</li>\n</ul>\n<p>在 Xcode 项目属性的 General 选项卡中点击底部的 Frameworks and Libraries，搜索AVFoundation Framework 将其添加至项目中。</p>\n<h2 id=\"歌曲列表界面\"><a href=\"#歌曲列表界面\" class=\"headerlink\" title=\"歌曲列表界面\"></a>歌曲列表界面</h2><p>为了进行简单的 Demo，我将两首下载好歌曲添加到 Xcode 项目文件夹下，分别为<code>Song1.mp3</code>与<code>Song2.mp3</code>，并创建简单的结构体命名为 Song：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Song</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> songName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> albumName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> artistName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> imageName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> trackName: <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>为了在播放时展示专辑封面，我将两首 .mp3 文件的专辑封面添加至 Assets，参照 Song 命名为 Cover1 与 Cover 2。我比较习惯于 AutoLayout 与代码布局共同使用，使用 StoryBoard 进行小项目的简单布局十分方便。<br>首先，创建一个<code>ViewController</code>展示歌曲页面，添加<code>UITableView</code>并调整约束，需要将 TableView 对象的 <code>Content</code> 属性改为 <code>Dynamic Prototypes</code>，将 对象的Cell的 <code>Style</code>属性更改为<code>Subtitle</code>，至此 StoryBoard 部分已经完成。<br>来到与该<code>ViewController</code>相对应的<code>ViewController.swift</code>文件，由于是在Storyboard中创建<code>UITableView</code>，所以需要通过<code>@IBOutlet</code>连接之前创建的<code>UITableView</code>，方法如Ctrl+拖拽，同时需要在<code>viewDidLoad()</code>中设置<code>UITableView</code>对象的<code>delegate</code>与<code>dataSource</code>。需要注意的是使用<code>UITableView</code>的方法需要 conforms to 相关的 protocols, 以上均为基本操作。<br>我需要在<code>viewDidLoad()</code>阶段加载歌曲的相关信息，于是创建<code>configureSongs()</code>方法为<code>songs</code>数组添加相关数据（需要在之前创建）。<br>尝试完成页面功能布局，作为Demo该 TableView 对象只包含一个 Section 的内容，如果需要调用系统音乐资料库的 <code>MPMediaItem</code>，需要使用 NSRange 对不同 Section 的内容进行排序（A-Z）。为了避免列表中图片大小显示不一致问题，我将 Row 的高度更改为60。在<code>cellForRowAt</code>方法中定制 cell，在<code>didSelectRowAt</code>方法中令其 present 播放器页面，相关内容在后文中讨论，目前这个页面看起来是这样的(先忽略 Tab 的效果)。<br><img src=\"http://image.stephenfang.me/screen1.png\"><br>懒人代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewController</span>: <span class=\"title\">UIViewController</span>, <span class=\"title\">UITableViewDelegate</span>, <span class=\"title\">UITableViewDataSource</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@IBOutlet</span> <span class=\"keyword\">var</span> songTable: <span class=\"type\">UITableView</span>!</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> songs <span class=\"operator\">=</span> [<span class=\"type\">Song</span>]()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">        configureSongs()</span><br><span class=\"line\">        songTable.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">        songTable.dataSource <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureSongs</span>()</span> &#123;</span><br><span class=\"line\">        songs.append(<span class=\"type\">Song</span>(songName: <span class=\"string\">&quot;Pretender&quot;</span>, albumName: <span class=\"string\">&quot;Pretender&quot;</span>, artistName: <span class=\"string\">&quot;Official鬍子男dism&quot;</span>, imageName: <span class=\"string\">&quot;Cover1&quot;</span>, trackName: <span class=\"string\">&quot;Song1&quot;</span>))</span><br><span class=\"line\">        songs.append(<span class=\"type\">Song</span>(songName: <span class=\"string\">&quot;Imagine&quot;</span>, albumName: <span class=\"string\">&quot;The Mango Tree&quot;</span>, artistName: <span class=\"string\">&quot;Jack Johnson&quot;</span>, imageName: <span class=\"string\">&quot;Cover2&quot;</span>, trackName: <span class=\"string\">&quot;Song2&quot;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">numberOfRowsInSection</span> <span class=\"params\">section</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> songs.count</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">heightForRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> -&gt; <span class=\"type\">CGFloat</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">60</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">cellForRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> -&gt; <span class=\"type\">UITableViewCell</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> songCell <span class=\"operator\">=</span> tableView.dequeueReusableCell(withIdentifier: <span class=\"string\">&quot;songCell&quot;</span>, for: indexPath)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> song <span class=\"operator\">=</span> songs[indexPath.row]</span><br><span class=\"line\">        </span><br><span class=\"line\">        songCell.textLabel<span class=\"operator\">?</span>.text <span class=\"operator\">=</span> song.songName</span><br><span class=\"line\">        songCell.detailTextLabel<span class=\"operator\">?</span>.text <span class=\"operator\">=</span> song.albumName <span class=\"operator\">+</span> <span class=\"string\">&quot;  &quot;</span> <span class=\"operator\">+</span> song.artistName</span><br><span class=\"line\">        songCell.imageView<span class=\"operator\">?</span>.image <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(named: song.imageName)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> songCell</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">didSelectRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> &#123;</span><br><span class=\"line\">        tableView.deselectRow(at: indexPath, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> position <span class=\"operator\">=</span> indexPath.row</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> songView <span class=\"operator\">=</span> storyboard<span class=\"operator\">?</span>.instantiateViewController(identifier: <span class=\"string\">&quot;player&quot;</span>) <span class=\"keyword\">as?</span> <span class=\"type\">PlayerViewController</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        songView.position <span class=\"operator\">=</span> position</span><br><span class=\"line\">        songView.songs <span class=\"operator\">=</span> songs</span><br><span class=\"line\">        </span><br><span class=\"line\">        present(songView,animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"正在播放界面\"><a href=\"#正在播放界面\" class=\"headerlink\" title=\"正在播放界面\"></a>正在播放界面</h2><p>创建<code>PlayerViewController</code>展示正在播放的页面，不需要与任何View进行连接，之后创建一个 UIView 令其紧贴 Safe Area 将其命名为 holder。这次我采用代码进行布局，最终看起来应该是这样的，虽然很不美观但是 it just works。<br><img src=\"http://image.stephenfang.me/screen2.png\">。<br>在开始代码注解前了解一下我的思路。其中<code>viewDidLayoutSubviews</code>方法在controller 的子视图的 position 和 size 被改变的时候被调用。在 view 已经被设计 subviews 并且还没有被展示在屏幕上时候，可以调用此方法改变这个view。任何依赖于 bounds 并且需要完成的操作都应该放在<code>viewDidLayoutSubviews</code>中而不是<code>viewDidLoad</code>或<code>viewWillAppear</code>中，因为 view 的 frame 和 bounds 直到 AutoLayout 完成工作的时候才会被确定，所以在执行完Auto Layout之后会调用此方法。<br>当用户点击上一首歌曲或下一首歌曲按钮后，需要改变控件内容的显示，我的想法是通过调用<code>removeFromSuperview()</code>方法，该方法即进行视图节点删除的操作，执行这个方法等于在 View 的树形结构中找到该节点并删除该节点及其子节点，而并非只是删除该节点自己，同时把该对象从响应者链中移除。在ARC的情况下执行<code>removeFromSuperview</code>方法多次也没有问题因为由系统自动管理。<br>那么在调用<code>removeFromSuperview</code>后势必需要重新载入页面元素，并且控制播放的过程，这个时候可以采用一个统一的方法在页面载入、切换的时候进行操作。对于 <code>AVAudioPlayer</code>的调用方面，需要导入<code>AVFoundation</code>框架并初始化<code>AVAudioPlayer</code>对象。由于之前导入了 .mp3 文件，需要做的是让<code>AVAudioPlayer</code>获取待播放的歌曲 url，之前的 ViewController 对 Song 的具体内容有定义，而<code>Bundle.main.path</code>代表获取工程目录下的文件。系统启动时会激活 <code>AVAudioSession</code>，通过设置<code>active</code>为”true”激活 Session，设置为“false”解除 Session 的激活状态，<code>options</code>使用 “.notifyOthersOnDeactivation” 使音频会话停用时其它音频会话可以返回到其它活动状态。对于<code>sharedInstance</code>包含五种设置方法，希望深入了解的参见这篇文章 <a href=\"https://www.jianshu.com/p/ae843162ace1\">AVAudioSession - Category、Model、Options、Error参数详解</a><br>Int 类型的变量<code>position</code>代表当前用户点按的歌曲在 songs 中所处下标，相关的 UIElement 配置都很容易理解不在此赘述，为了模拟 Music.app 的效果，我尝试使用</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0.2</span>, animations: &#123;</span><br><span class=\"line\">               <span class=\"keyword\">self</span>.albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">30</span>, y: <span class=\"number\">30</span>, width: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>, height: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>)</span><br><span class=\"line\">           &#125;)</span><br></pre></td></tr></table></figure>\n<p>实现类似的点击暂停或播放按钮后专辑封面大小变化的的效果，如果页面上已经对元素进行了大小限制使用<code>CGAffineTransform(scaleX: &lt;CGFloat&gt;, y: &lt;CGFloat&gt;)</code>也能够达到类似的效果。最后给出此次 Demo 所有的代码，对于播放器的开发进展我会持续更新，🦔本系列的第一篇文章。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"><span class=\"keyword\">import</span> AVFoundation</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PlayerViewController</span>: <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> position: <span class=\"type\">Int</span> <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> songs: [<span class=\"type\">Song</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@IBOutlet</span> <span class=\"keyword\">weak</span> <span class=\"keyword\">var</span> holder: <span class=\"type\">UIView</span>!</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> player: <span class=\"type\">AVAudioPlayer</span>?</span><br><span class=\"line\">    <span class=\"keyword\">let</span> playPauseButton <span class=\"operator\">=</span> <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> albumImageView: <span class=\"type\">UIImageView</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> imageView <span class=\"operator\">=</span> <span class=\"type\">UIImageView</span>()</span><br><span class=\"line\">        imageView.contentMode <span class=\"operator\">=</span> .scaleAspectFill</span><br><span class=\"line\">        <span class=\"keyword\">return</span> imageView</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> nameLabel: <span class=\"type\">UILabel</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> label <span class=\"operator\">=</span> <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">        label.textAlignment <span class=\"operator\">=</span> .center</span><br><span class=\"line\">        label.numberOfLines <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> label</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> albumLabel: <span class=\"type\">UILabel</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> label <span class=\"operator\">=</span> <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">        label.textAlignment <span class=\"operator\">=</span> .center</span><br><span class=\"line\">        label.numberOfLines <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> label</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> artistLabel: <span class=\"type\">UILabel</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> label <span class=\"operator\">=</span> <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">        label.textAlignment <span class=\"operator\">=</span> .center</span><br><span class=\"line\">        label.numberOfLines <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> label</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLayoutSubviews</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLayoutSubviews()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> holder.subviews.count <span class=\"operator\">==</span> <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            configurePlayer()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewWillDisappear</span>(<span class=\"keyword\">_</span> <span class=\"params\">animated</span>: <span class=\"type\">Bool</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewWillDisappear(animated)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> player <span class=\"operator\">=</span> player &#123;</span><br><span class=\"line\">            player.stop()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configurePlayer</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> song <span class=\"operator\">=</span> songs[position]</span><br><span class=\"line\">        <span class=\"keyword\">let</span> urlString <span class=\"operator\">=</span> <span class=\"type\">Bundle</span>.main.path(forResource: song.trackName, ofType: <span class=\"string\">&quot;.mp3&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> <span class=\"type\">AVAudioSession</span>.sharedInstance().setMode(.default)</span><br><span class=\"line\">            <span class=\"keyword\">try</span> <span class=\"type\">AVAudioSession</span>.sharedInstance().setActive(<span class=\"literal\">true</span>, options: .notifyOthersOnDeactivation)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> urlString <span class=\"operator\">=</span> urlString <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            player <span class=\"operator\">=</span> <span class=\"keyword\">try</span> <span class=\"type\">AVAudioPlayer</span>(contentsOf: <span class=\"type\">URL</span>(string: urlString)<span class=\"operator\">!</span>)</span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> player <span class=\"operator\">=</span> player <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            player.volume <span class=\"operator\">=</span> <span class=\"number\">0.5</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            player.play()</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>  &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Error occurred&quot;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// UI</span></span><br><span class=\"line\">        <span class=\"comment\">// Album</span></span><br><span class=\"line\">        albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>,</span><br><span class=\"line\">                                      y: <span class=\"number\">10</span>,</span><br><span class=\"line\">                                      width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>,</span><br><span class=\"line\">                                      height: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>)</span><br><span class=\"line\">        albumImageView.image <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(named: song.imageName)</span><br><span class=\"line\">        holder.addSubview(albumImageView)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Label</span></span><br><span class=\"line\">        nameLabel.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: albumImageView.frame.size.height <span class=\"operator\">+</span> <span class=\"number\">10</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> , height: <span class=\"number\">70</span>)</span><br><span class=\"line\">        albumLabel.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: albumImageView.frame.size.height <span class=\"operator\">+</span> <span class=\"number\">80</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> , height: <span class=\"number\">70</span>)</span><br><span class=\"line\">        artistLabel.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: albumImageView.frame.size.height <span class=\"operator\">+</span> <span class=\"number\">140</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> , height: <span class=\"number\">70</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        nameLabel.text <span class=\"operator\">=</span> song.songName</span><br><span class=\"line\">        albumLabel.text <span class=\"operator\">=</span> song.albumName</span><br><span class=\"line\">        artistLabel.text <span class=\"operator\">=</span> song.artistName</span><br><span class=\"line\">        </span><br><span class=\"line\">        holder.addSubview(nameLabel)</span><br><span class=\"line\">        holder.addSubview(albumLabel)</span><br><span class=\"line\">        holder.addSubview(artistLabel)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Button</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> nextButton <span class=\"operator\">=</span> <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">        <span class=\"keyword\">let</span> backButton <span class=\"operator\">=</span> <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> buttonSize: <span class=\"type\">CGFloat</span> <span class=\"operator\">=</span> <span class=\"number\">50</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: (holder.frame.size.width <span class=\"operator\">-</span> buttonSize)<span class=\"operator\">/</span><span class=\"number\">2.0</span>, y: artistLabel.frame.origin.y <span class=\"operator\">+</span> <span class=\"number\">90</span>, width: buttonSize, height: buttonSize)</span><br><span class=\"line\">        nextButton.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> <span class=\"operator\">-</span> buttonSize, y: artistLabel.frame.origin.y <span class=\"operator\">+</span> <span class=\"number\">90</span>, width: buttonSize, height: buttonSize)</span><br><span class=\"line\">        backButton.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">20</span>, y: artistLabel.frame.origin.y <span class=\"operator\">+</span> <span class=\"number\">90</span>, width: buttonSize, height: buttonSize)</span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.addTarget(<span class=\"keyword\">self</span>, action: #selector(didTapPauseButton), for: .touchUpInside)</span><br><span class=\"line\">        nextButton.addTarget(<span class=\"keyword\">self</span>, action: #selector(didTapNextButton), for: .touchUpInside)</span><br><span class=\"line\">        backButton.addTarget(<span class=\"keyword\">self</span>, action: #selector(didTapBackButton), for: .touchUpInside)</span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;pause.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">        nextButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;forward.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">        backButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;backward.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.tintColor <span class=\"operator\">=</span> .black</span><br><span class=\"line\">        nextButton.tintColor <span class=\"operator\">=</span> .black</span><br><span class=\"line\">        backButton.tintColor <span class=\"operator\">=</span> .black</span><br><span class=\"line\">        </span><br><span class=\"line\">        holder.addSubview(playPauseButton)</span><br><span class=\"line\">        holder.addSubview(nextButton)</span><br><span class=\"line\">        holder.addSubview(backButton)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Element</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> slider <span class=\"operator\">=</span> <span class=\"type\">UISlider</span>(frame: <span class=\"type\">CGRect</span>(x: <span class=\"number\">20</span>, y: holder.frame.size.height <span class=\"operator\">-</span> <span class=\"number\">60</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">40</span>, height: <span class=\"number\">50</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">        slider.value <span class=\"operator\">=</span> <span class=\"number\">50</span></span><br><span class=\"line\">        slider.addTarget(<span class=\"keyword\">self</span>, action: #selector(didSlideSlider(<span class=\"keyword\">_</span>:)), for: .valueChanged)</span><br><span class=\"line\">        holder.addSubview(slider)</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didSlideSlider</span> (<span class=\"keyword\">_</span> <span class=\"params\">slider</span>: <span class=\"type\">UISlider</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> value <span class=\"operator\">=</span> slider.value</span><br><span class=\"line\">        player<span class=\"operator\">?</span>.volume <span class=\"operator\">=</span> value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapPauseButton</span> ()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> player<span class=\"operator\">?</span>.isPlaying <span class=\"operator\">==</span> <span class=\"literal\">true</span> &#123;</span><br><span class=\"line\">            player<span class=\"operator\">?</span>.pause()</span><br><span class=\"line\">            playPauseButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;play.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">            <span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0.2</span>, animations: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">30</span>, y: <span class=\"number\">30</span>, width: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>, height: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            player<span class=\"operator\">?</span>.play()</span><br><span class=\"line\">            playPauseButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;pause.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">            <span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0.2</span>, animations: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: <span class=\"number\">10</span>, width: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>, height: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapNextButton</span> ()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> position <span class=\"operator\">&lt;</span> (songs.count <span class=\"operator\">-</span> <span class=\"number\">1</span> )&#123;</span><br><span class=\"line\">            position <span class=\"operator\">=</span> position <span class=\"operator\">+</span> <span class=\"number\">1</span></span><br><span class=\"line\">            player<span class=\"operator\">?</span>.stop()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> subview <span class=\"keyword\">in</span> holder.subviews &#123;</span><br><span class=\"line\">                subview.removeFromSuperview()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            configurePlayer()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapBackButton</span> ()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> position <span class=\"operator\">&gt;</span> <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            position <span class=\"operator\">=</span> position <span class=\"operator\">-</span> <span class=\"number\">1</span></span><br><span class=\"line\">            player<span class=\"operator\">?</span>.stop()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> subview <span class=\"keyword\">in</span> holder.subviews &#123;</span><br><span class=\"line\">                subview.removeFromSuperview()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            configurePlayer()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"<p>最近又放弃了使用 Apple Music，作为一个从音乐下载时代过来的人，我仍然保持着将歌曲同步至 iPhone 再聆听的习惯，即使我仍然无法摆脱流媒体的束缚。话说回来，Apple 原生的 Music.app 的体验除了交互，于我而言是糟糕的，我更希望有一款 Tab Based 的 iOS App 支撑这种体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好学习一些 UIKit 控件。</p>","more":"<h2 id=\"目的\"><a href=\"#目的\" class=\"headerlink\" title=\"目的\"></a>目的</h2><p>本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于实践一个简单的 AVAudioPlayer Demo 模拟 Music.app 的播放功能，内容十分基础。<br>需要注意的是，此 Demo 并没有采用读取系统音乐资料库需要的 MPMediaPlayer。</p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li>Swift 5</li>\n<li>iOS 13.5</li>\n<li>Xcode 11.5</li>\n</ul>\n<p>在 Xcode 项目属性的 General 选项卡中点击底部的 Frameworks and Libraries，搜索AVFoundation Framework 将其添加至项目中。</p>\n<h2 id=\"歌曲列表界面\"><a href=\"#歌曲列表界面\" class=\"headerlink\" title=\"歌曲列表界面\"></a>歌曲列表界面</h2><p>为了进行简单的 Demo，我将两首下载好歌曲添加到 Xcode 项目文件夹下，分别为<code>Song1.mp3</code>与<code>Song2.mp3</code>，并创建简单的结构体命名为 Song：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Song</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> songName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> albumName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> artistName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> imageName: <span class=\"type\">String</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> trackName: <span class=\"type\">String</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>为了在播放时展示专辑封面，我将两首 .mp3 文件的专辑封面添加至 Assets，参照 Song 命名为 Cover1 与 Cover 2。我比较习惯于 AutoLayout 与代码布局共同使用，使用 StoryBoard 进行小项目的简单布局十分方便。<br>首先，创建一个<code>ViewController</code>展示歌曲页面，添加<code>UITableView</code>并调整约束，需要将 TableView 对象的 <code>Content</code> 属性改为 <code>Dynamic Prototypes</code>，将 对象的Cell的 <code>Style</code>属性更改为<code>Subtitle</code>，至此 StoryBoard 部分已经完成。<br>来到与该<code>ViewController</code>相对应的<code>ViewController.swift</code>文件，由于是在Storyboard中创建<code>UITableView</code>，所以需要通过<code>@IBOutlet</code>连接之前创建的<code>UITableView</code>，方法如Ctrl+拖拽，同时需要在<code>viewDidLoad()</code>中设置<code>UITableView</code>对象的<code>delegate</code>与<code>dataSource</code>。需要注意的是使用<code>UITableView</code>的方法需要 conforms to 相关的 protocols, 以上均为基本操作。<br>我需要在<code>viewDidLoad()</code>阶段加载歌曲的相关信息，于是创建<code>configureSongs()</code>方法为<code>songs</code>数组添加相关数据（需要在之前创建）。<br>尝试完成页面功能布局，作为Demo该 TableView 对象只包含一个 Section 的内容，如果需要调用系统音乐资料库的 <code>MPMediaItem</code>，需要使用 NSRange 对不同 Section 的内容进行排序（A-Z）。为了避免列表中图片大小显示不一致问题，我将 Row 的高度更改为60。在<code>cellForRowAt</code>方法中定制 cell，在<code>didSelectRowAt</code>方法中令其 present 播放器页面，相关内容在后文中讨论，目前这个页面看起来是这样的(先忽略 Tab 的效果)。<br><img src=\"http://image.stephenfang.me/screen1.png\"><br>懒人代码如下：</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ViewController</span>: <span class=\"title\">UIViewController</span>, <span class=\"title\">UITableViewDelegate</span>, <span class=\"title\">UITableViewDataSource</span></span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@IBOutlet</span> <span class=\"keyword\">var</span> songTable: <span class=\"type\">UITableView</span>!</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> songs <span class=\"operator\">=</span> [<span class=\"type\">Song</span>]()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">        configureSongs()</span><br><span class=\"line\">        songTable.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">        songTable.dataSource <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureSongs</span>()</span> &#123;</span><br><span class=\"line\">        songs.append(<span class=\"type\">Song</span>(songName: <span class=\"string\">&quot;Pretender&quot;</span>, albumName: <span class=\"string\">&quot;Pretender&quot;</span>, artistName: <span class=\"string\">&quot;Official鬍子男dism&quot;</span>, imageName: <span class=\"string\">&quot;Cover1&quot;</span>, trackName: <span class=\"string\">&quot;Song1&quot;</span>))</span><br><span class=\"line\">        songs.append(<span class=\"type\">Song</span>(songName: <span class=\"string\">&quot;Imagine&quot;</span>, albumName: <span class=\"string\">&quot;The Mango Tree&quot;</span>, artistName: <span class=\"string\">&quot;Jack Johnson&quot;</span>, imageName: <span class=\"string\">&quot;Cover2&quot;</span>, trackName: <span class=\"string\">&quot;Song2&quot;</span>))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">numberOfRowsInSection</span> <span class=\"params\">section</span>: <span class=\"type\">Int</span>)</span> -&gt; <span class=\"type\">Int</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> songs.count</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">heightForRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> -&gt; <span class=\"type\">CGFloat</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">60</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">cellForRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> -&gt; <span class=\"type\">UITableViewCell</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> songCell <span class=\"operator\">=</span> tableView.dequeueReusableCell(withIdentifier: <span class=\"string\">&quot;songCell&quot;</span>, for: indexPath)</span><br><span class=\"line\">        <span class=\"keyword\">let</span> song <span class=\"operator\">=</span> songs[indexPath.row]</span><br><span class=\"line\">        </span><br><span class=\"line\">        songCell.textLabel<span class=\"operator\">?</span>.text <span class=\"operator\">=</span> song.songName</span><br><span class=\"line\">        songCell.detailTextLabel<span class=\"operator\">?</span>.text <span class=\"operator\">=</span> song.albumName <span class=\"operator\">+</span> <span class=\"string\">&quot;  &quot;</span> <span class=\"operator\">+</span> song.artistName</span><br><span class=\"line\">        songCell.imageView<span class=\"operator\">?</span>.image <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(named: song.imageName)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">return</span> songCell</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">tableView</span>(<span class=\"keyword\">_</span> <span class=\"params\">tableView</span>: <span class=\"type\">UITableView</span>, <span class=\"params\">didSelectRowAt</span> <span class=\"params\">indexPath</span>: <span class=\"type\">IndexPath</span>)</span> &#123;</span><br><span class=\"line\">        tableView.deselectRow(at: indexPath, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> position <span class=\"operator\">=</span> indexPath.row</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> songView <span class=\"operator\">=</span> storyboard<span class=\"operator\">?</span>.instantiateViewController(identifier: <span class=\"string\">&quot;player&quot;</span>) <span class=\"keyword\">as?</span> <span class=\"type\">PlayerViewController</span> <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        songView.position <span class=\"operator\">=</span> position</span><br><span class=\"line\">        songView.songs <span class=\"operator\">=</span> songs</span><br><span class=\"line\">        </span><br><span class=\"line\">        present(songView,animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"正在播放界面\"><a href=\"#正在播放界面\" class=\"headerlink\" title=\"正在播放界面\"></a>正在播放界面</h2><p>创建<code>PlayerViewController</code>展示正在播放的页面，不需要与任何View进行连接，之后创建一个 UIView 令其紧贴 Safe Area 将其命名为 holder。这次我采用代码进行布局，最终看起来应该是这样的，虽然很不美观但是 it just works。<br><img src=\"http://image.stephenfang.me/screen2.png\">。<br>在开始代码注解前了解一下我的思路。其中<code>viewDidLayoutSubviews</code>方法在controller 的子视图的 position 和 size 被改变的时候被调用。在 view 已经被设计 subviews 并且还没有被展示在屏幕上时候，可以调用此方法改变这个view。任何依赖于 bounds 并且需要完成的操作都应该放在<code>viewDidLayoutSubviews</code>中而不是<code>viewDidLoad</code>或<code>viewWillAppear</code>中，因为 view 的 frame 和 bounds 直到 AutoLayout 完成工作的时候才会被确定，所以在执行完Auto Layout之后会调用此方法。<br>当用户点击上一首歌曲或下一首歌曲按钮后，需要改变控件内容的显示，我的想法是通过调用<code>removeFromSuperview()</code>方法，该方法即进行视图节点删除的操作，执行这个方法等于在 View 的树形结构中找到该节点并删除该节点及其子节点，而并非只是删除该节点自己，同时把该对象从响应者链中移除。在ARC的情况下执行<code>removeFromSuperview</code>方法多次也没有问题因为由系统自动管理。<br>那么在调用<code>removeFromSuperview</code>后势必需要重新载入页面元素，并且控制播放的过程，这个时候可以采用一个统一的方法在页面载入、切换的时候进行操作。对于 <code>AVAudioPlayer</code>的调用方面，需要导入<code>AVFoundation</code>框架并初始化<code>AVAudioPlayer</code>对象。由于之前导入了 .mp3 文件，需要做的是让<code>AVAudioPlayer</code>获取待播放的歌曲 url，之前的 ViewController 对 Song 的具体内容有定义，而<code>Bundle.main.path</code>代表获取工程目录下的文件。系统启动时会激活 <code>AVAudioSession</code>，通过设置<code>active</code>为”true”激活 Session，设置为“false”解除 Session 的激活状态，<code>options</code>使用 “.notifyOthersOnDeactivation” 使音频会话停用时其它音频会话可以返回到其它活动状态。对于<code>sharedInstance</code>包含五种设置方法，希望深入了解的参见这篇文章 <a href=\"https://www.jianshu.com/p/ae843162ace1\">AVAudioSession - Category、Model、Options、Error参数详解</a><br>Int 类型的变量<code>position</code>代表当前用户点按的歌曲在 songs 中所处下标，相关的 UIElement 配置都很容易理解不在此赘述，为了模拟 Music.app 的效果，我尝试使用</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0.2</span>, animations: &#123;</span><br><span class=\"line\">               <span class=\"keyword\">self</span>.albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">30</span>, y: <span class=\"number\">30</span>, width: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>, height: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>)</span><br><span class=\"line\">           &#125;)</span><br></pre></td></tr></table></figure>\n<p>实现类似的点击暂停或播放按钮后专辑封面大小变化的的效果，如果页面上已经对元素进行了大小限制使用<code>CGAffineTransform(scaleX: &lt;CGFloat&gt;, y: &lt;CGFloat&gt;)</code>也能够达到类似的效果。最后给出此次 Demo 所有的代码，对于播放器的开发进展我会持续更新，🦔本系列的第一篇文章。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> UIKit</span><br><span class=\"line\"><span class=\"keyword\">import</span> AVFoundation</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">PlayerViewController</span>: <span class=\"title\">UIViewController</span> </span>&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> position: <span class=\"type\">Int</span> <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">var</span> songs: [<span class=\"type\">Song</span>] <span class=\"operator\">=</span> []</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@IBOutlet</span> <span class=\"keyword\">weak</span> <span class=\"keyword\">var</span> holder: <span class=\"type\">UIView</span>!</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">var</span> player: <span class=\"type\">AVAudioPlayer</span>?</span><br><span class=\"line\">    <span class=\"keyword\">let</span> playPauseButton <span class=\"operator\">=</span> <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> albumImageView: <span class=\"type\">UIImageView</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> imageView <span class=\"operator\">=</span> <span class=\"type\">UIImageView</span>()</span><br><span class=\"line\">        imageView.contentMode <span class=\"operator\">=</span> .scaleAspectFill</span><br><span class=\"line\">        <span class=\"keyword\">return</span> imageView</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> nameLabel: <span class=\"type\">UILabel</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> label <span class=\"operator\">=</span> <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">        label.textAlignment <span class=\"operator\">=</span> .center</span><br><span class=\"line\">        label.numberOfLines <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> label</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> albumLabel: <span class=\"type\">UILabel</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> label <span class=\"operator\">=</span> <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">        label.textAlignment <span class=\"operator\">=</span> .center</span><br><span class=\"line\">        label.numberOfLines <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> label</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">let</span> artistLabel: <span class=\"type\">UILabel</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> label <span class=\"operator\">=</span> <span class=\"type\">UILabel</span>()</span><br><span class=\"line\">        label.textAlignment <span class=\"operator\">=</span> .center</span><br><span class=\"line\">        label.numberOfLines <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> label</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLayoutSubviews</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewDidLayoutSubviews()</span><br><span class=\"line\">        <span class=\"keyword\">if</span> holder.subviews.count <span class=\"operator\">==</span> <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            configurePlayer()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewWillDisappear</span>(<span class=\"keyword\">_</span> <span class=\"params\">animated</span>: <span class=\"type\">Bool</span>)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">super</span>.viewWillDisappear(animated)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> player <span class=\"operator\">=</span> player &#123;</span><br><span class=\"line\">            player.stop()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configurePlayer</span>()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> song <span class=\"operator\">=</span> songs[position]</span><br><span class=\"line\">        <span class=\"keyword\">let</span> urlString <span class=\"operator\">=</span> <span class=\"type\">Bundle</span>.main.path(forResource: song.trackName, ofType: <span class=\"string\">&quot;.mp3&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> <span class=\"type\">AVAudioSession</span>.sharedInstance().setMode(.default)</span><br><span class=\"line\">            <span class=\"keyword\">try</span> <span class=\"type\">AVAudioSession</span>.sharedInstance().setActive(<span class=\"literal\">true</span>, options: .notifyOthersOnDeactivation)</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> urlString <span class=\"operator\">=</span> urlString <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            </span><br><span class=\"line\">            player <span class=\"operator\">=</span> <span class=\"keyword\">try</span> <span class=\"type\">AVAudioPlayer</span>(contentsOf: <span class=\"type\">URL</span>(string: urlString)<span class=\"operator\">!</span>)</span><br><span class=\"line\">            <span class=\"keyword\">guard</span> <span class=\"keyword\">let</span> player <span class=\"operator\">=</span> player <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            player.volume <span class=\"operator\">=</span> <span class=\"number\">0.5</span></span><br><span class=\"line\">            </span><br><span class=\"line\">            player.play()</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span>  &#123;</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">&quot;Error occurred&quot;</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// UI</span></span><br><span class=\"line\">        <span class=\"comment\">// Album</span></span><br><span class=\"line\">        albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>,</span><br><span class=\"line\">                                      y: <span class=\"number\">10</span>,</span><br><span class=\"line\">                                      width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>,</span><br><span class=\"line\">                                      height: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>)</span><br><span class=\"line\">        albumImageView.image <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(named: song.imageName)</span><br><span class=\"line\">        holder.addSubview(albumImageView)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Label</span></span><br><span class=\"line\">        nameLabel.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: albumImageView.frame.size.height <span class=\"operator\">+</span> <span class=\"number\">10</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> , height: <span class=\"number\">70</span>)</span><br><span class=\"line\">        albumLabel.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: albumImageView.frame.size.height <span class=\"operator\">+</span> <span class=\"number\">80</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> , height: <span class=\"number\">70</span>)</span><br><span class=\"line\">        artistLabel.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: albumImageView.frame.size.height <span class=\"operator\">+</span> <span class=\"number\">140</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> , height: <span class=\"number\">70</span>)</span><br><span class=\"line\">        </span><br><span class=\"line\">        nameLabel.text <span class=\"operator\">=</span> song.songName</span><br><span class=\"line\">        albumLabel.text <span class=\"operator\">=</span> song.albumName</span><br><span class=\"line\">        artistLabel.text <span class=\"operator\">=</span> song.artistName</span><br><span class=\"line\">        </span><br><span class=\"line\">        holder.addSubview(nameLabel)</span><br><span class=\"line\">        holder.addSubview(albumLabel)</span><br><span class=\"line\">        holder.addSubview(artistLabel)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Button</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> nextButton <span class=\"operator\">=</span> <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">        <span class=\"keyword\">let</span> backButton <span class=\"operator\">=</span> <span class=\"type\">UIButton</span>()</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> buttonSize: <span class=\"type\">CGFloat</span> <span class=\"operator\">=</span> <span class=\"number\">50</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: (holder.frame.size.width <span class=\"operator\">-</span> buttonSize)<span class=\"operator\">/</span><span class=\"number\">2.0</span>, y: artistLabel.frame.origin.y <span class=\"operator\">+</span> <span class=\"number\">90</span>, width: buttonSize, height: buttonSize)</span><br><span class=\"line\">        nextButton.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span> <span class=\"operator\">-</span> buttonSize, y: artistLabel.frame.origin.y <span class=\"operator\">+</span> <span class=\"number\">90</span>, width: buttonSize, height: buttonSize)</span><br><span class=\"line\">        backButton.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">20</span>, y: artistLabel.frame.origin.y <span class=\"operator\">+</span> <span class=\"number\">90</span>, width: buttonSize, height: buttonSize)</span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.addTarget(<span class=\"keyword\">self</span>, action: #selector(didTapPauseButton), for: .touchUpInside)</span><br><span class=\"line\">        nextButton.addTarget(<span class=\"keyword\">self</span>, action: #selector(didTapNextButton), for: .touchUpInside)</span><br><span class=\"line\">        backButton.addTarget(<span class=\"keyword\">self</span>, action: #selector(didTapBackButton), for: .touchUpInside)</span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;pause.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">        nextButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;forward.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">        backButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;backward.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">        </span><br><span class=\"line\">        playPauseButton.tintColor <span class=\"operator\">=</span> .black</span><br><span class=\"line\">        nextButton.tintColor <span class=\"operator\">=</span> .black</span><br><span class=\"line\">        backButton.tintColor <span class=\"operator\">=</span> .black</span><br><span class=\"line\">        </span><br><span class=\"line\">        holder.addSubview(playPauseButton)</span><br><span class=\"line\">        holder.addSubview(nextButton)</span><br><span class=\"line\">        holder.addSubview(backButton)</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">// Element</span></span><br><span class=\"line\">        <span class=\"keyword\">let</span> slider <span class=\"operator\">=</span> <span class=\"type\">UISlider</span>(frame: <span class=\"type\">CGRect</span>(x: <span class=\"number\">20</span>, y: holder.frame.size.height <span class=\"operator\">-</span> <span class=\"number\">60</span>, width: holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">40</span>, height: <span class=\"number\">50</span>))</span><br><span class=\"line\">        </span><br><span class=\"line\">        slider.value <span class=\"operator\">=</span> <span class=\"number\">50</span></span><br><span class=\"line\">        slider.addTarget(<span class=\"keyword\">self</span>, action: #selector(didSlideSlider(<span class=\"keyword\">_</span>:)), for: .valueChanged)</span><br><span class=\"line\">        holder.addSubview(slider)</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didSlideSlider</span> (<span class=\"keyword\">_</span> <span class=\"params\">slider</span>: <span class=\"type\">UISlider</span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> value <span class=\"operator\">=</span> slider.value</span><br><span class=\"line\">        player<span class=\"operator\">?</span>.volume <span class=\"operator\">=</span> value</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapPauseButton</span> ()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> player<span class=\"operator\">?</span>.isPlaying <span class=\"operator\">==</span> <span class=\"literal\">true</span> &#123;</span><br><span class=\"line\">            player<span class=\"operator\">?</span>.pause()</span><br><span class=\"line\">            playPauseButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;play.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">            <span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0.2</span>, animations: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">30</span>, y: <span class=\"number\">30</span>, width: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>, height: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">60</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            player<span class=\"operator\">?</span>.play()</span><br><span class=\"line\">            playPauseButton.setBackgroundImage(<span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;pause.fill&quot;</span>), for: .normal)</span><br><span class=\"line\">            <span class=\"type\">UIView</span>.animate(withDuration: <span class=\"number\">0.2</span>, animations: &#123;</span><br><span class=\"line\">                <span class=\"keyword\">self</span>.albumImageView.frame <span class=\"operator\">=</span> <span class=\"type\">CGRect</span>(x: <span class=\"number\">10</span>, y: <span class=\"number\">10</span>, width: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>, height: <span class=\"keyword\">self</span>.holder.frame.size.width <span class=\"operator\">-</span> <span class=\"number\">20</span>)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapNextButton</span> ()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> position <span class=\"operator\">&lt;</span> (songs.count <span class=\"operator\">-</span> <span class=\"number\">1</span> )&#123;</span><br><span class=\"line\">            position <span class=\"operator\">=</span> position <span class=\"operator\">+</span> <span class=\"number\">1</span></span><br><span class=\"line\">            player<span class=\"operator\">?</span>.stop()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> subview <span class=\"keyword\">in</span> holder.subviews &#123;</span><br><span class=\"line\">                subview.removeFromSuperview()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            configurePlayer()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapBackButton</span> ()</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> position <span class=\"operator\">&gt;</span> <span class=\"number\">0</span> &#123;</span><br><span class=\"line\">            position <span class=\"operator\">=</span> position <span class=\"operator\">-</span> <span class=\"number\">1</span></span><br><span class=\"line\">            player<span class=\"operator\">?</span>.stop()</span><br><span class=\"line\">            <span class=\"keyword\">for</span> subview <span class=\"keyword\">in</span> holder.subviews &#123;</span><br><span class=\"line\">                subview.removeFromSuperview()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            configurePlayer()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/screen1.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:12 GMT+0800 (中国标准时间)","title":"Muzik开发总结 — AVAudioPlayer 实践","path":"2020/07/08/Muzik_GettingStarted/","eyeCatchImage":"http://image.stephenfang.me/screen1.png","excerpt":"<p>最近又放弃了使用 Apple Music，作为一个从音乐下载时代过来的人，我仍然保持着将歌曲同步至 iPhone 再聆听的习惯，即使我仍然无法摆脱流媒体的束缚。话说回来，Apple 原生的 Music.app 的体验除了交互，于我而言是糟糕的，我更希望有一款 Tab Based 的 iOS App 支撑这种体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好学习一些 UIKit 控件。</p>","date":{"_isAMomentObject":true,"_i":"2020-07-08T11:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-08T11:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","Swift","AudioPlayer"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":9857},{"title":"Muzik开发总结 — 设计与实现","date":"2020-07-15T11:15:20.000Z","copyright":true,"_content":"\n我希望有一款 Tab Based 的 iOS App 带来简约轻量的音乐播放体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好实践一些 UIKit 控件的使用。\n\n<!--more-->\n\n## 目的\n本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于展示设计与实现方面的进度。\n\n## 环境\n- iOS 13.6\n- Xcode 11.6\n\n## 设计\n![截图2020-07-27 at 22.58.20](http://image.stephenfang.me/sketch.png)\n在项目开始编写代码前，我使用 Sketch 对整个App 进行设计，确定了字体与元素的使用规范，方便之后针对我想要实现的设计进行微调。其实这一步也可以直接在 StoryBoard 中完成，然而添加阴影等操作在 Sketch 等原型创作工具中更为直观。\n在完成设计后我尝试使用 Sketch Mirror、MockUp工具对 App 上手的感受进行评估，并发送原型给朋友了解他们提出的一些建议。\n![](http://image.stephenfang.me/mweb/15958622925026.png)\n至少在 MockUp 效果下 App的整体观感还让我比较满意。我希望这种简单的风格贯穿整个 App，使得我能够用 UIKit 较为轻松地实现 App 的功能。\n ![](http://image.stephenfang.me/mweb/15958623328077.png)\n\n支持 Dark Mode 也是大势所趋，针对 iOS 13 之后的 App 都应该加入支持。为了给 iPhone X设备带来更好的视觉观感，我选择了纯黑作为 App 的底色。\n![](http://image.stephenfang.me/mweb/15958624669288.jpg)\n\n\n## 组织\n按照 Sketch 中的页面设计，我将整体 App 分为精选、专辑、歌曲、音乐人、播放列表、正在播放这几个部分，其中我希望有一个小组件能像原生音乐App一样能够看到当前播放进度以及进行快捷操作，于是我将包含显示当前播放内容的 UIView 置于App的顶层位置，其中UIView中包含 UIProgressView 等控件。这是我目前能够想到且实现的理想方法，缺点即需要为下层的所有视图添加 Offset。\nTab + Navigation 是 iOS 开发中一种非常常见的模式，每一个页面依次对应了精选、专辑、歌曲、音乐人、播放列表的功能。\n![](http://image.stephenfang.me/strc.png)\n\n## 页面实现\n### 精选页面\n页面包含最近添加的专辑、收听最多的歌曲、常听的播放列表等栏目组成，点击不同栏目的项目可以触发不同的二级功能。从此页面可以简述我的设计理念，即专辑使用卡片式的设计语言，更契合 iOS 13 的设计风格。\n![-w301](http://image.stephenfang.me/mweb/15958633632257.jpg)\n\n### 专辑页面\n卡片式的专辑页面，点击不同的专辑进入详情页面。需要注意的是我为该页面添加了可隐藏的索引栏，避免索引栏与专辑页面重合，显得过于拥挤，这一点在歌曲页面可以看到。\n![-w301](http://image.stephenfang.me/mweb/15958635741661.jpg)\n\n点击专辑卡片进入相应的详情页面，简单的 TableView 实现。\n![-w301](http://image.stephenfang.me/mweb/15958637814033.jpg)\n\n## 歌曲页面\n从歌曲页面可以看到右侧的可隐藏的索引栏，这里学习了 Ecoute 的设计。App 整体的设计风格十分统一，无论是字体还是网格。\n![-w301](http://image.stephenfang.me/mweb/15958640618143.jpg)\n\n## 音乐人页面\n这个页面是我目前不满意的一个页面，因为 iOS 的MediaLibrary 框架中并没有提供获取 ```albumArtist```的 ```artwork``` 的方法。目前有改进的方案，即通过请求 iTunes Store 数据库返回 JSON，获取其中的艺人封面 url 并缓存其中的艺人封面。思路有一些类似于 [SDWebImage](https://github.com/SDWebImage/SDWebImage)，然而希望以自己的方式进行简单实现。\n![-w301](http://image.stephenfang.me/mweb/15958641787194.jpg)\n\n同样，点击不同的 row 进入相应的音乐人详情页面，区别是这个采用 CollectionView 实现。\n![-w301](http://image.stephenfang.me/mweb/15958647723869.jpg)\n\n## 播放列表页面\n根据播放列表的实际需求实现了显示页面，由于时间过于仓促没有认真适配播放列表的缩略图。\n正打算自己花时间写一个类似于原声音乐播放器的播放列表的缩略图效果，我在 GitHub 上找到了一个类似的开源项目: [\nStitchingImage](https://github.com/zhengjinghua/StitchingImage)\n![-w301](http://image.stephenfang.me/mweb/15958648056682.jpg)\n\n然而实现语言为 Objective-C，我正在尝试用 Swift 将其进行重写，之后会开源到 GitHub 上。\n\n详情页还是同样的味道，目前做的仍然十分粗糙，我会尝试对 UI 进行持续改进。\n![-w301](http://image.stephenfang.me/mweb/15958650862897.jpg)\n\n\n## 搜索页面\n点击任意一级页面导航栏的搜索按钮会激活搜索页面，使用框架的方法调用实现了简单的检索。\n![-w301](http://image.stephenfang.me/mweb/15958640040336.jpg)\n\n## 正在播放页面\n类似于原生的播放页面，目前正在对整个页面进行重构，包括 UI 部分与代码部分。\n目前主要通过 Timer 与 Observer 实现了简单的功能实现，但是为了达到优雅听歌的目标功能远不于此，我正在尝试接入[LyricsKit](https://github.com/ddddxxx/LyricsKit) 使得页面具有显示歌词的功能，这里需要用到 ScrollView 与 PageControl的加持。\n![-w301](http://image.stephenfang.me/mweb/15958655245499.jpg)\n\n\n## 总结\n以上为目前的进度总结，我会持续更新 App 的开发过程，包括代码总结与功能实现。","source":"_posts/Muzik_Progress.md","raw":"---\ntitle: Muzik开发总结 — 设计与实现\ndate: 2020-07-15 19:15:20\ncategories: \n- 技术\ntags: \n- iOS\n- Swift\n- 音乐App\ncopyright: true\n---\n\n我希望有一款 Tab Based 的 iOS App 带来简约轻量的音乐播放体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好实践一些 UIKit 控件的使用。\n\n<!--more-->\n\n## 目的\n本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于展示设计与实现方面的进度。\n\n## 环境\n- iOS 13.6\n- Xcode 11.6\n\n## 设计\n![截图2020-07-27 at 22.58.20](http://image.stephenfang.me/sketch.png)\n在项目开始编写代码前，我使用 Sketch 对整个App 进行设计，确定了字体与元素的使用规范，方便之后针对我想要实现的设计进行微调。其实这一步也可以直接在 StoryBoard 中完成，然而添加阴影等操作在 Sketch 等原型创作工具中更为直观。\n在完成设计后我尝试使用 Sketch Mirror、MockUp工具对 App 上手的感受进行评估，并发送原型给朋友了解他们提出的一些建议。\n![](http://image.stephenfang.me/mweb/15958622925026.png)\n至少在 MockUp 效果下 App的整体观感还让我比较满意。我希望这种简单的风格贯穿整个 App，使得我能够用 UIKit 较为轻松地实现 App 的功能。\n ![](http://image.stephenfang.me/mweb/15958623328077.png)\n\n支持 Dark Mode 也是大势所趋，针对 iOS 13 之后的 App 都应该加入支持。为了给 iPhone X设备带来更好的视觉观感，我选择了纯黑作为 App 的底色。\n![](http://image.stephenfang.me/mweb/15958624669288.jpg)\n\n\n## 组织\n按照 Sketch 中的页面设计，我将整体 App 分为精选、专辑、歌曲、音乐人、播放列表、正在播放这几个部分，其中我希望有一个小组件能像原生音乐App一样能够看到当前播放进度以及进行快捷操作，于是我将包含显示当前播放内容的 UIView 置于App的顶层位置，其中UIView中包含 UIProgressView 等控件。这是我目前能够想到且实现的理想方法，缺点即需要为下层的所有视图添加 Offset。\nTab + Navigation 是 iOS 开发中一种非常常见的模式，每一个页面依次对应了精选、专辑、歌曲、音乐人、播放列表的功能。\n![](http://image.stephenfang.me/strc.png)\n\n## 页面实现\n### 精选页面\n页面包含最近添加的专辑、收听最多的歌曲、常听的播放列表等栏目组成，点击不同栏目的项目可以触发不同的二级功能。从此页面可以简述我的设计理念，即专辑使用卡片式的设计语言，更契合 iOS 13 的设计风格。\n![-w301](http://image.stephenfang.me/mweb/15958633632257.jpg)\n\n### 专辑页面\n卡片式的专辑页面，点击不同的专辑进入详情页面。需要注意的是我为该页面添加了可隐藏的索引栏，避免索引栏与专辑页面重合，显得过于拥挤，这一点在歌曲页面可以看到。\n![-w301](http://image.stephenfang.me/mweb/15958635741661.jpg)\n\n点击专辑卡片进入相应的详情页面，简单的 TableView 实现。\n![-w301](http://image.stephenfang.me/mweb/15958637814033.jpg)\n\n## 歌曲页面\n从歌曲页面可以看到右侧的可隐藏的索引栏，这里学习了 Ecoute 的设计。App 整体的设计风格十分统一，无论是字体还是网格。\n![-w301](http://image.stephenfang.me/mweb/15958640618143.jpg)\n\n## 音乐人页面\n这个页面是我目前不满意的一个页面，因为 iOS 的MediaLibrary 框架中并没有提供获取 ```albumArtist```的 ```artwork``` 的方法。目前有改进的方案，即通过请求 iTunes Store 数据库返回 JSON，获取其中的艺人封面 url 并缓存其中的艺人封面。思路有一些类似于 [SDWebImage](https://github.com/SDWebImage/SDWebImage)，然而希望以自己的方式进行简单实现。\n![-w301](http://image.stephenfang.me/mweb/15958641787194.jpg)\n\n同样，点击不同的 row 进入相应的音乐人详情页面，区别是这个采用 CollectionView 实现。\n![-w301](http://image.stephenfang.me/mweb/15958647723869.jpg)\n\n## 播放列表页面\n根据播放列表的实际需求实现了显示页面，由于时间过于仓促没有认真适配播放列表的缩略图。\n正打算自己花时间写一个类似于原声音乐播放器的播放列表的缩略图效果，我在 GitHub 上找到了一个类似的开源项目: [\nStitchingImage](https://github.com/zhengjinghua/StitchingImage)\n![-w301](http://image.stephenfang.me/mweb/15958648056682.jpg)\n\n然而实现语言为 Objective-C，我正在尝试用 Swift 将其进行重写，之后会开源到 GitHub 上。\n\n详情页还是同样的味道，目前做的仍然十分粗糙，我会尝试对 UI 进行持续改进。\n![-w301](http://image.stephenfang.me/mweb/15958650862897.jpg)\n\n\n## 搜索页面\n点击任意一级页面导航栏的搜索按钮会激活搜索页面，使用框架的方法调用实现了简单的检索。\n![-w301](http://image.stephenfang.me/mweb/15958640040336.jpg)\n\n## 正在播放页面\n类似于原生的播放页面，目前正在对整个页面进行重构，包括 UI 部分与代码部分。\n目前主要通过 Timer 与 Observer 实现了简单的功能实现，但是为了达到优雅听歌的目标功能远不于此，我正在尝试接入[LyricsKit](https://github.com/ddddxxx/LyricsKit) 使得页面具有显示歌词的功能，这里需要用到 ScrollView 与 PageControl的加持。\n![-w301](http://image.stephenfang.me/mweb/15958655245499.jpg)\n\n\n## 总结\n以上为目前的进度总结，我会持续更新 App 的开发过程，包括代码总结与功能实现。","slug":"Muzik_Progress","published":1,"updated":"2022-07-24T15:20:23.603Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1v000yo76fgunc37fo","content":"<p>我希望有一款 Tab Based 的 iOS App 带来简约轻量的音乐播放体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好实践一些 UIKit 控件的使用。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"目的\"><a href=\"#目的\" class=\"headerlink\" title=\"目的\"></a>目的</h2><p>本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于展示设计与实现方面的进度。</p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li>iOS 13.6</li>\n<li>Xcode 11.6</li>\n</ul>\n<h2 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h2><p><img src=\"http://image.stephenfang.me/sketch.png\" alt=\"截图2020-07-27 at 22.58.20\"><br>在项目开始编写代码前，我使用 Sketch 对整个App 进行设计，确定了字体与元素的使用规范，方便之后针对我想要实现的设计进行微调。其实这一步也可以直接在 StoryBoard 中完成，然而添加阴影等操作在 Sketch 等原型创作工具中更为直观。<br>在完成设计后我尝试使用 Sketch Mirror、MockUp工具对 App 上手的感受进行评估，并发送原型给朋友了解他们提出的一些建议。<br><img src=\"http://image.stephenfang.me/mweb/15958622925026.png\"><br>至少在 MockUp 效果下 App的整体观感还让我比较满意。我希望这种简单的风格贯穿整个 App，使得我能够用 UIKit 较为轻松地实现 App 的功能。<br> <img src=\"http://image.stephenfang.me/mweb/15958623328077.png\"></p>\n<p>支持 Dark Mode 也是大势所趋，针对 iOS 13 之后的 App 都应该加入支持。为了给 iPhone X设备带来更好的视觉观感，我选择了纯黑作为 App 的底色。<br><img src=\"http://image.stephenfang.me/mweb/15958624669288.jpg\"></p>\n<h2 id=\"组织\"><a href=\"#组织\" class=\"headerlink\" title=\"组织\"></a>组织</h2><p>按照 Sketch 中的页面设计，我将整体 App 分为精选、专辑、歌曲、音乐人、播放列表、正在播放这几个部分，其中我希望有一个小组件能像原生音乐App一样能够看到当前播放进度以及进行快捷操作，于是我将包含显示当前播放内容的 UIView 置于App的顶层位置，其中UIView中包含 UIProgressView 等控件。这是我目前能够想到且实现的理想方法，缺点即需要为下层的所有视图添加 Offset。<br>Tab + Navigation 是 iOS 开发中一种非常常见的模式，每一个页面依次对应了精选、专辑、歌曲、音乐人、播放列表的功能。<br><img src=\"http://image.stephenfang.me/strc.png\"></p>\n<h2 id=\"页面实现\"><a href=\"#页面实现\" class=\"headerlink\" title=\"页面实现\"></a>页面实现</h2><h3 id=\"精选页面\"><a href=\"#精选页面\" class=\"headerlink\" title=\"精选页面\"></a>精选页面</h3><p>页面包含最近添加的专辑、收听最多的歌曲、常听的播放列表等栏目组成，点击不同栏目的项目可以触发不同的二级功能。从此页面可以简述我的设计理念，即专辑使用卡片式的设计语言，更契合 iOS 13 的设计风格。<br><img src=\"http://image.stephenfang.me/mweb/15958633632257.jpg\" alt=\"-w301\"></p>\n<h3 id=\"专辑页面\"><a href=\"#专辑页面\" class=\"headerlink\" title=\"专辑页面\"></a>专辑页面</h3><p>卡片式的专辑页面，点击不同的专辑进入详情页面。需要注意的是我为该页面添加了可隐藏的索引栏，避免索引栏与专辑页面重合，显得过于拥挤，这一点在歌曲页面可以看到。<br><img src=\"http://image.stephenfang.me/mweb/15958635741661.jpg\" alt=\"-w301\"></p>\n<p>点击专辑卡片进入相应的详情页面，简单的 TableView 实现。<br><img src=\"http://image.stephenfang.me/mweb/15958637814033.jpg\" alt=\"-w301\"></p>\n<h2 id=\"歌曲页面\"><a href=\"#歌曲页面\" class=\"headerlink\" title=\"歌曲页面\"></a>歌曲页面</h2><p>从歌曲页面可以看到右侧的可隐藏的索引栏，这里学习了 Ecoute 的设计。App 整体的设计风格十分统一，无论是字体还是网格。<br><img src=\"http://image.stephenfang.me/mweb/15958640618143.jpg\" alt=\"-w301\"></p>\n<h2 id=\"音乐人页面\"><a href=\"#音乐人页面\" class=\"headerlink\" title=\"音乐人页面\"></a>音乐人页面</h2><p>这个页面是我目前不满意的一个页面，因为 iOS 的MediaLibrary 框架中并没有提供获取 <code>albumArtist</code>的 <code>artwork</code> 的方法。目前有改进的方案，即通过请求 iTunes Store 数据库返回 JSON，获取其中的艺人封面 url 并缓存其中的艺人封面。思路有一些类似于 <a href=\"https://github.com/SDWebImage/SDWebImage\">SDWebImage</a>，然而希望以自己的方式进行简单实现。<br><img src=\"http://image.stephenfang.me/mweb/15958641787194.jpg\" alt=\"-w301\"></p>\n<p>同样，点击不同的 row 进入相应的音乐人详情页面，区别是这个采用 CollectionView 实现。<br><img src=\"http://image.stephenfang.me/mweb/15958647723869.jpg\" alt=\"-w301\"></p>\n<h2 id=\"播放列表页面\"><a href=\"#播放列表页面\" class=\"headerlink\" title=\"播放列表页面\"></a>播放列表页面</h2><p>根据播放列表的实际需求实现了显示页面，由于时间过于仓促没有认真适配播放列表的缩略图。<br>正打算自己花时间写一个类似于原声音乐播放器的播放列表的缩略图效果，我在 GitHub 上找到了一个类似的开源项目: <a href=\"https://github.com/zhengjinghua/StitchingImage\"><br>StitchingImage</a><br><img src=\"http://image.stephenfang.me/mweb/15958648056682.jpg\" alt=\"-w301\"></p>\n<p>然而实现语言为 Objective-C，我正在尝试用 Swift 将其进行重写，之后会开源到 GitHub 上。</p>\n<p>详情页还是同样的味道，目前做的仍然十分粗糙，我会尝试对 UI 进行持续改进。<br><img src=\"http://image.stephenfang.me/mweb/15958650862897.jpg\" alt=\"-w301\"></p>\n<h2 id=\"搜索页面\"><a href=\"#搜索页面\" class=\"headerlink\" title=\"搜索页面\"></a>搜索页面</h2><p>点击任意一级页面导航栏的搜索按钮会激活搜索页面，使用框架的方法调用实现了简单的检索。<br><img src=\"http://image.stephenfang.me/mweb/15958640040336.jpg\" alt=\"-w301\"></p>\n<h2 id=\"正在播放页面\"><a href=\"#正在播放页面\" class=\"headerlink\" title=\"正在播放页面\"></a>正在播放页面</h2><p>类似于原生的播放页面，目前正在对整个页面进行重构，包括 UI 部分与代码部分。<br>目前主要通过 Timer 与 Observer 实现了简单的功能实现，但是为了达到优雅听歌的目标功能远不于此，我正在尝试接入<a href=\"https://github.com/ddddxxx/LyricsKit\">LyricsKit</a> 使得页面具有显示歌词的功能，这里需要用到 ScrollView 与 PageControl的加持。<br><img src=\"http://image.stephenfang.me/mweb/15958655245499.jpg\" alt=\"-w301\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>以上为目前的进度总结，我会持续更新 App 的开发过程，包括代码总结与功能实现。</p>\n","site":{"data":{}},"excerpt":"<p>我希望有一款 Tab Based 的 iOS App 带来简约轻量的音乐播放体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好实践一些 UIKit 控件的使用。</p>","more":"<h2 id=\"目的\"><a href=\"#目的\" class=\"headerlink\" title=\"目的\"></a>目的</h2><p>本系列文章是开发一个简易的音乐播放器（暂时命名为“Muzik”）的博客记录，本篇目的在于展示设计与实现方面的进度。</p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li>iOS 13.6</li>\n<li>Xcode 11.6</li>\n</ul>\n<h2 id=\"设计\"><a href=\"#设计\" class=\"headerlink\" title=\"设计\"></a>设计</h2><p><img src=\"http://image.stephenfang.me/sketch.png\" alt=\"截图2020-07-27 at 22.58.20\"><br>在项目开始编写代码前，我使用 Sketch 对整个App 进行设计，确定了字体与元素的使用规范，方便之后针对我想要实现的设计进行微调。其实这一步也可以直接在 StoryBoard 中完成，然而添加阴影等操作在 Sketch 等原型创作工具中更为直观。<br>在完成设计后我尝试使用 Sketch Mirror、MockUp工具对 App 上手的感受进行评估，并发送原型给朋友了解他们提出的一些建议。<br><img src=\"http://image.stephenfang.me/mweb/15958622925026.png\"><br>至少在 MockUp 效果下 App的整体观感还让我比较满意。我希望这种简单的风格贯穿整个 App，使得我能够用 UIKit 较为轻松地实现 App 的功能。<br> <img src=\"http://image.stephenfang.me/mweb/15958623328077.png\"></p>\n<p>支持 Dark Mode 也是大势所趋，针对 iOS 13 之后的 App 都应该加入支持。为了给 iPhone X设备带来更好的视觉观感，我选择了纯黑作为 App 的底色。<br><img src=\"http://image.stephenfang.me/mweb/15958624669288.jpg\"></p>\n<h2 id=\"组织\"><a href=\"#组织\" class=\"headerlink\" title=\"组织\"></a>组织</h2><p>按照 Sketch 中的页面设计，我将整体 App 分为精选、专辑、歌曲、音乐人、播放列表、正在播放这几个部分，其中我希望有一个小组件能像原生音乐App一样能够看到当前播放进度以及进行快捷操作，于是我将包含显示当前播放内容的 UIView 置于App的顶层位置，其中UIView中包含 UIProgressView 等控件。这是我目前能够想到且实现的理想方法，缺点即需要为下层的所有视图添加 Offset。<br>Tab + Navigation 是 iOS 开发中一种非常常见的模式，每一个页面依次对应了精选、专辑、歌曲、音乐人、播放列表的功能。<br><img src=\"http://image.stephenfang.me/strc.png\"></p>\n<h2 id=\"页面实现\"><a href=\"#页面实现\" class=\"headerlink\" title=\"页面实现\"></a>页面实现</h2><h3 id=\"精选页面\"><a href=\"#精选页面\" class=\"headerlink\" title=\"精选页面\"></a>精选页面</h3><p>页面包含最近添加的专辑、收听最多的歌曲、常听的播放列表等栏目组成，点击不同栏目的项目可以触发不同的二级功能。从此页面可以简述我的设计理念，即专辑使用卡片式的设计语言，更契合 iOS 13 的设计风格。<br><img src=\"http://image.stephenfang.me/mweb/15958633632257.jpg\" alt=\"-w301\"></p>\n<h3 id=\"专辑页面\"><a href=\"#专辑页面\" class=\"headerlink\" title=\"专辑页面\"></a>专辑页面</h3><p>卡片式的专辑页面，点击不同的专辑进入详情页面。需要注意的是我为该页面添加了可隐藏的索引栏，避免索引栏与专辑页面重合，显得过于拥挤，这一点在歌曲页面可以看到。<br><img src=\"http://image.stephenfang.me/mweb/15958635741661.jpg\" alt=\"-w301\"></p>\n<p>点击专辑卡片进入相应的详情页面，简单的 TableView 实现。<br><img src=\"http://image.stephenfang.me/mweb/15958637814033.jpg\" alt=\"-w301\"></p>\n<h2 id=\"歌曲页面\"><a href=\"#歌曲页面\" class=\"headerlink\" title=\"歌曲页面\"></a>歌曲页面</h2><p>从歌曲页面可以看到右侧的可隐藏的索引栏，这里学习了 Ecoute 的设计。App 整体的设计风格十分统一，无论是字体还是网格。<br><img src=\"http://image.stephenfang.me/mweb/15958640618143.jpg\" alt=\"-w301\"></p>\n<h2 id=\"音乐人页面\"><a href=\"#音乐人页面\" class=\"headerlink\" title=\"音乐人页面\"></a>音乐人页面</h2><p>这个页面是我目前不满意的一个页面，因为 iOS 的MediaLibrary 框架中并没有提供获取 <code>albumArtist</code>的 <code>artwork</code> 的方法。目前有改进的方案，即通过请求 iTunes Store 数据库返回 JSON，获取其中的艺人封面 url 并缓存其中的艺人封面。思路有一些类似于 <a href=\"https://github.com/SDWebImage/SDWebImage\">SDWebImage</a>，然而希望以自己的方式进行简单实现。<br><img src=\"http://image.stephenfang.me/mweb/15958641787194.jpg\" alt=\"-w301\"></p>\n<p>同样，点击不同的 row 进入相应的音乐人详情页面，区别是这个采用 CollectionView 实现。<br><img src=\"http://image.stephenfang.me/mweb/15958647723869.jpg\" alt=\"-w301\"></p>\n<h2 id=\"播放列表页面\"><a href=\"#播放列表页面\" class=\"headerlink\" title=\"播放列表页面\"></a>播放列表页面</h2><p>根据播放列表的实际需求实现了显示页面，由于时间过于仓促没有认真适配播放列表的缩略图。<br>正打算自己花时间写一个类似于原声音乐播放器的播放列表的缩略图效果，我在 GitHub 上找到了一个类似的开源项目: <a href=\"https://github.com/zhengjinghua/StitchingImage\"><br>StitchingImage</a><br><img src=\"http://image.stephenfang.me/mweb/15958648056682.jpg\" alt=\"-w301\"></p>\n<p>然而实现语言为 Objective-C，我正在尝试用 Swift 将其进行重写，之后会开源到 GitHub 上。</p>\n<p>详情页还是同样的味道，目前做的仍然十分粗糙，我会尝试对 UI 进行持续改进。<br><img src=\"http://image.stephenfang.me/mweb/15958650862897.jpg\" alt=\"-w301\"></p>\n<h2 id=\"搜索页面\"><a href=\"#搜索页面\" class=\"headerlink\" title=\"搜索页面\"></a>搜索页面</h2><p>点击任意一级页面导航栏的搜索按钮会激活搜索页面，使用框架的方法调用实现了简单的检索。<br><img src=\"http://image.stephenfang.me/mweb/15958640040336.jpg\" alt=\"-w301\"></p>\n<h2 id=\"正在播放页面\"><a href=\"#正在播放页面\" class=\"headerlink\" title=\"正在播放页面\"></a>正在播放页面</h2><p>类似于原生的播放页面，目前正在对整个页面进行重构，包括 UI 部分与代码部分。<br>目前主要通过 Timer 与 Observer 实现了简单的功能实现，但是为了达到优雅听歌的目标功能远不于此，我正在尝试接入<a href=\"https://github.com/ddddxxx/LyricsKit\">LyricsKit</a> 使得页面具有显示歌词的功能，这里需要用到 ScrollView 与 PageControl的加持。<br><img src=\"http://image.stephenfang.me/mweb/15958655245499.jpg\" alt=\"-w301\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>以上为目前的进度总结，我会持续更新 App 的开发过程，包括代码总结与功能实现。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/sketch.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:23 GMT+0800 (中国标准时间)","title":"Muzik开发总结 — 设计与实现","path":"2020/07/15/Muzik_Progress/","eyeCatchImage":"http://image.stephenfang.me/sketch.png","excerpt":"<p>我希望有一款 Tab Based 的 iOS App 带来简约轻量的音乐播放体验，作为一个有一些 iOS 基础的人，我决定自己开发一个简单的本地音乐播放器，正好实践一些 UIKit 控件的使用。</p>","date":{"_isAMomentObject":true,"_i":"2020-07-15T11:15:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-07-15T11:15:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","Swift","音乐App"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":1697},{"title":"Objective-C 学习笔记(一）","date":"2020-03-21T01:20:20.000Z","copyright":true,"_content":"\n# \n最近开始学习 Objective-C 夯实基础，并在学习基础上尝试开发出简单的 iOS 应用程序。有 C 语言基础的同学应该能够比较快上手。在此处总结可以方便本人更好地记忆。\n\n<!--more-->\n## 示例代码\n先给出第一课学习的代码。\n\n```objc\n#import <Foundation/Foundation.h>\n\n@interface Device : NSObject\n\n-(void) wakeUp;\n-(void) setPasswd: (int)input;\n-(void) verifyPasswd;\n-(int) getPasswd;\n\n@end\n\n@implementation Device {\n    int passwd;\n}\n\n- (void)wakeUp{\n    NSLog(@\"The device was woken up.\");\n}\n\n-(void)setPasswd:(int)input {\n    passwd = input;\n}\n\n-(void)verifyPasswd {\n    if( passwd == 1111 )\n        NSLog(@\"The password of this device is correct.\");\n    else\n        NSLog(@\"The password of this device is incorrect!\");\n\n}\n\n-(int) getPasswd {\n    return passwd;\n};\n\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        Device *iPhone = [[Device alloc] init];\n        Device *iPad = [[Device alloc] init];\n        \n        [iPhone wakeUp];\n        [iPhone setPasswd:1000];\n        [iPhone verifyPasswd];\n        NSLog(@\"The password of iPhone is %i.\",[iPhone getPasswd]);\n        \n        [iPad wakeUp];\n        [iPad setPasswd:1111];\n        [iPad verifyPasswd];\n        NSLog(@\"The password of iPad is %i.\",[iPad getPasswd]);\n    }\n    return 0;\n}\n```\n\n运行结果如下：\n```\n2020-03-21 12:20:14.658475+0800 DemoProgram[26195:134286] The device was woken up.\n2020-03-21 12:20:14.658766+0800 DemoProgram[26195:134286] The password of this device is incorrect!\n2020-03-21 12:20:14.658820+0800 DemoProgram[26195:134286] The password of iPhone is 1000.\n2020-03-21 12:20:14.658854+0800 DemoProgram[26195:134286] The device was woken up.\n2020-03-21 12:20:14.658875+0800 DemoProgram[26195:134286] The password of this device is correct.\n2020-03-21 12:20:14.658893+0800 DemoProgram[26195:134286] The password of iPad is 1111.\nProgram ended with exit code: 0\n```\n\n## 代码解释\n`@interface` 部分用于描述类和类的方法；`@implementation` 部分用于描述类对象的实例变量存储的数据，同时实现了接口中声明的方法；剩下代码实现了程序的功能。\n### alloc\n`alloc`即 allocate，目的是为新创建的对象分配内存存储空间。`alloc`保证对象的所有实例变量都变成初始状态，但不意味着对象完成了初始化工作，完成初始化工作需要使用`init`完成。\n`alloc` 直接调用了另一个私有方法 `id _objc_rootAlloc(Class cls)`。\n\n```objc\n+ (id)alloc {\n    return _objc_rootAlloc(self);\n}\n```\n\n `id _objc_rootAlloc(Class cls)`调用了`callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/)`,即 `NSObject` 对 `callAlloc` 的实现.\n \n```objc\nid _objc_rootAlloc(Class cls) {\n    return callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/);\n}\n```\n\n继续研究`callAlloc(Class cls, bool checkNil, bool allocWithZone=false)`\n\n```objc\nstatic id callAlloc(Class cls, bool checkNil, bool allocWithZone=false) {\n    id obj = class_createInstance(cls, 0);\n    return obj;\n}\n\nid class_createInstance(Class cls, size_t extraBytes) {\n    return _class_createInstanceFromZone(cls, extraBytes, nil);\n}\n```\n对象初始化中最重要的操作都在 `_class_createInstanceFromZone` 方法中执行：\n\n```objc\nstatic id _class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone, bool cxxConstruct = true, size_t *outAllocatedSize = nil) {\n    size_t size = cls->instanceSize(extraBytes);\n\n    id obj = (id)calloc(1, size);\n    if (!obj) return nil;\n    obj->initInstanceIsa(cls, hasCxxDtor);\n\n    return obj;\n}\n```\n### init \n`init`用于初始化类的实例变量，`iPhone = [iPhone init];` 初始化了一个特殊的 Device 对象，然而他没有发送给类，而是发送给了类的一个实例。`init`方法也可以返回被初始化的对象。\n`NSObject` 的 `- init` 方法调用了 `_objc_rootInit` 并返回了当前对象：\n\n```objc\n- (id)init {\n    return _objc_rootInit(self);\n}\n\nid _objc_rootInit(id obj) {\n    return obj;\n}\n```\n\n## 声明方法\nObjective-C 中声明的语法较为特别，方法名以冒号结束告诉编译器该方法有参数，在一对圆括号内指定参数的类型，与指定返回值的方法类似，和 C 类似整个声明以一个分号结束，给出一张图展示声明方法。\n\n![](http://image.stephenfang.me/obj1.jpg)\n\n\n## 规范注意\n\n流程为在`@interface`部分声明方法,并在`@implementation`部分定义它们,可使用冒号指明`ParentClassName`，与在@interface部分使用冒号一样:\n```objc\n@implementation Device: NSObject\n```\n但通常不这么做。\n\n`new`方法可以将`alloc`和`init`的操作结合起来,用两步来实现创建和初始化的方式可以在概念上理解正在发生两个不同的事件:首先创建对象，然后对它初始化。\n即以下三种方式意义相同。\n```objc\nDevice *iPhone = [[Device alloc] init];\n\nDevice *iPhone;\niPhone = [Device alloc];\niPhone = [iPhone init];\n\nDevice *iPhone = [ Device new]；\n```\n\n## 参考\n[对象是如何初始化的（iOS）](https://draveness.me/object-init)\n[Objective-C 程序设计 (第六版)]()\n","source":"_posts/Objc_Learning_1.md","raw":"---\ntitle: Objective-C 学习笔记(一）\ndate: 2020-03-21 09:20:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n# \n最近开始学习 Objective-C 夯实基础，并在学习基础上尝试开发出简单的 iOS 应用程序。有 C 语言基础的同学应该能够比较快上手。在此处总结可以方便本人更好地记忆。\n\n<!--more-->\n## 示例代码\n先给出第一课学习的代码。\n\n```objc\n#import <Foundation/Foundation.h>\n\n@interface Device : NSObject\n\n-(void) wakeUp;\n-(void) setPasswd: (int)input;\n-(void) verifyPasswd;\n-(int) getPasswd;\n\n@end\n\n@implementation Device {\n    int passwd;\n}\n\n- (void)wakeUp{\n    NSLog(@\"The device was woken up.\");\n}\n\n-(void)setPasswd:(int)input {\n    passwd = input;\n}\n\n-(void)verifyPasswd {\n    if( passwd == 1111 )\n        NSLog(@\"The password of this device is correct.\");\n    else\n        NSLog(@\"The password of this device is incorrect!\");\n\n}\n\n-(int) getPasswd {\n    return passwd;\n};\n\n@end\n\nint main(int argc, const char * argv[]) {\n    @autoreleasepool {\n        Device *iPhone = [[Device alloc] init];\n        Device *iPad = [[Device alloc] init];\n        \n        [iPhone wakeUp];\n        [iPhone setPasswd:1000];\n        [iPhone verifyPasswd];\n        NSLog(@\"The password of iPhone is %i.\",[iPhone getPasswd]);\n        \n        [iPad wakeUp];\n        [iPad setPasswd:1111];\n        [iPad verifyPasswd];\n        NSLog(@\"The password of iPad is %i.\",[iPad getPasswd]);\n    }\n    return 0;\n}\n```\n\n运行结果如下：\n```\n2020-03-21 12:20:14.658475+0800 DemoProgram[26195:134286] The device was woken up.\n2020-03-21 12:20:14.658766+0800 DemoProgram[26195:134286] The password of this device is incorrect!\n2020-03-21 12:20:14.658820+0800 DemoProgram[26195:134286] The password of iPhone is 1000.\n2020-03-21 12:20:14.658854+0800 DemoProgram[26195:134286] The device was woken up.\n2020-03-21 12:20:14.658875+0800 DemoProgram[26195:134286] The password of this device is correct.\n2020-03-21 12:20:14.658893+0800 DemoProgram[26195:134286] The password of iPad is 1111.\nProgram ended with exit code: 0\n```\n\n## 代码解释\n`@interface` 部分用于描述类和类的方法；`@implementation` 部分用于描述类对象的实例变量存储的数据，同时实现了接口中声明的方法；剩下代码实现了程序的功能。\n### alloc\n`alloc`即 allocate，目的是为新创建的对象分配内存存储空间。`alloc`保证对象的所有实例变量都变成初始状态，但不意味着对象完成了初始化工作，完成初始化工作需要使用`init`完成。\n`alloc` 直接调用了另一个私有方法 `id _objc_rootAlloc(Class cls)`。\n\n```objc\n+ (id)alloc {\n    return _objc_rootAlloc(self);\n}\n```\n\n `id _objc_rootAlloc(Class cls)`调用了`callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/)`,即 `NSObject` 对 `callAlloc` 的实现.\n \n```objc\nid _objc_rootAlloc(Class cls) {\n    return callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/);\n}\n```\n\n继续研究`callAlloc(Class cls, bool checkNil, bool allocWithZone=false)`\n\n```objc\nstatic id callAlloc(Class cls, bool checkNil, bool allocWithZone=false) {\n    id obj = class_createInstance(cls, 0);\n    return obj;\n}\n\nid class_createInstance(Class cls, size_t extraBytes) {\n    return _class_createInstanceFromZone(cls, extraBytes, nil);\n}\n```\n对象初始化中最重要的操作都在 `_class_createInstanceFromZone` 方法中执行：\n\n```objc\nstatic id _class_createInstanceFromZone(Class cls, size_t extraBytes, void *zone, bool cxxConstruct = true, size_t *outAllocatedSize = nil) {\n    size_t size = cls->instanceSize(extraBytes);\n\n    id obj = (id)calloc(1, size);\n    if (!obj) return nil;\n    obj->initInstanceIsa(cls, hasCxxDtor);\n\n    return obj;\n}\n```\n### init \n`init`用于初始化类的实例变量，`iPhone = [iPhone init];` 初始化了一个特殊的 Device 对象，然而他没有发送给类，而是发送给了类的一个实例。`init`方法也可以返回被初始化的对象。\n`NSObject` 的 `- init` 方法调用了 `_objc_rootInit` 并返回了当前对象：\n\n```objc\n- (id)init {\n    return _objc_rootInit(self);\n}\n\nid _objc_rootInit(id obj) {\n    return obj;\n}\n```\n\n## 声明方法\nObjective-C 中声明的语法较为特别，方法名以冒号结束告诉编译器该方法有参数，在一对圆括号内指定参数的类型，与指定返回值的方法类似，和 C 类似整个声明以一个分号结束，给出一张图展示声明方法。\n\n![](http://image.stephenfang.me/obj1.jpg)\n\n\n## 规范注意\n\n流程为在`@interface`部分声明方法,并在`@implementation`部分定义它们,可使用冒号指明`ParentClassName`，与在@interface部分使用冒号一样:\n```objc\n@implementation Device: NSObject\n```\n但通常不这么做。\n\n`new`方法可以将`alloc`和`init`的操作结合起来,用两步来实现创建和初始化的方式可以在概念上理解正在发生两个不同的事件:首先创建对象，然后对它初始化。\n即以下三种方式意义相同。\n```objc\nDevice *iPhone = [[Device alloc] init];\n\nDevice *iPhone;\niPhone = [Device alloc];\niPhone = [iPhone init];\n\nDevice *iPhone = [ Device new]；\n```\n\n## 参考\n[对象是如何初始化的（iOS）](https://draveness.me/object-init)\n[Objective-C 程序设计 (第六版)]()\n","slug":"Objc_Learning_1","published":1,"updated":"2022-07-24T15:20:27.677Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1w0011o76fguyu7bfw","content":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>最近开始学习 Objective-C 夯实基础，并在学习基础上尝试开发出简单的 iOS 应用程序。有 C 语言基础的同学应该能够比较快上手。在此处总结可以方便本人更好地记忆。</p>\n<span id=\"more\"></span>\n<h2 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h2><p>先给出第一课学习的代码。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Device</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) wakeUp;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) setPasswd: (<span class=\"keyword\">int</span>)input;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) verifyPasswd;</span><br><span class=\"line\">-(<span class=\"keyword\">int</span>) getPasswd;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Device</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> passwd;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)wakeUp&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The device was woken up.&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>)setPasswd:(<span class=\"keyword\">int</span>)input &#123;</span><br><span class=\"line\">    passwd = input;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>)verifyPasswd &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( passwd == <span class=\"number\">1111</span> )</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of this device is correct.&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of this device is incorrect!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">int</span>) getPasswd &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> passwd;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        Device *iPhone = [[Device alloc] init];</span><br><span class=\"line\">        Device *iPad = [[Device alloc] init];</span><br><span class=\"line\">        </span><br><span class=\"line\">        [iPhone wakeUp];</span><br><span class=\"line\">        [iPhone setPasswd:<span class=\"number\">1000</span>];</span><br><span class=\"line\">        [iPhone verifyPasswd];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of iPhone is %i.&quot;</span>,[iPhone getPasswd]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [iPad wakeUp];</span><br><span class=\"line\">        [iPad setPasswd:<span class=\"number\">1111</span>];</span><br><span class=\"line\">        [iPad verifyPasswd];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of iPad is %i.&quot;</span>,[iPad getPasswd]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-03-21 12:20:14.658475+0800 DemoProgram[26195:134286] The device was woken up.</span><br><span class=\"line\">2020-03-21 12:20:14.658766+0800 DemoProgram[26195:134286] The password of this device is incorrect!</span><br><span class=\"line\">2020-03-21 12:20:14.658820+0800 DemoProgram[26195:134286] The password of iPhone is 1000.</span><br><span class=\"line\">2020-03-21 12:20:14.658854+0800 DemoProgram[26195:134286] The device was woken up.</span><br><span class=\"line\">2020-03-21 12:20:14.658875+0800 DemoProgram[26195:134286] The password of this device is correct.</span><br><span class=\"line\">2020-03-21 12:20:14.658893+0800 DemoProgram[26195:134286] The password of iPad is 1111.</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码解释\"><a href=\"#代码解释\" class=\"headerlink\" title=\"代码解释\"></a>代码解释</h2><p><code>@interface</code> 部分用于描述类和类的方法；<code>@implementation</code> 部分用于描述类对象的实例变量存储的数据，同时实现了接口中声明的方法；剩下代码实现了程序的功能。</p>\n<h3 id=\"alloc\"><a href=\"#alloc\" class=\"headerlink\" title=\"alloc\"></a>alloc</h3><p><code>alloc</code>即 allocate，目的是为新创建的对象分配内存存储空间。<code>alloc</code>保证对象的所有实例变量都变成初始状态，但不意味着对象完成了初始化工作，完成初始化工作需要使用<code>init</code>完成。<br><code>alloc</code> 直接调用了另一个私有方法 <code>id _objc_rootAlloc(Class cls)</code>。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ (<span class=\"keyword\">id</span>)alloc &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _objc_rootAlloc(<span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>id _objc_rootAlloc(Class cls)</code>调用了<code>callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/)</code>,即 <code>NSObject</code> 对 <code>callAlloc</code> 的实现.</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">id</span> _objc_rootAlloc(Class cls) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> callAlloc(cls, <span class=\"literal\">false</span><span class=\"comment\">/*checkNil*/</span>, <span class=\"literal\">true</span><span class=\"comment\">/*allocWithZone*/</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>继续研究<code>callAlloc(Class cls, bool checkNil, bool allocWithZone=false)</code></p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">id</span> callAlloc(Class cls, <span class=\"keyword\">bool</span> checkNil, <span class=\"keyword\">bool</span> allocWithZone=<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">id</span> obj = class_createInstance(cls, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">id</span> class_createInstance(Class cls, size_t extraBytes) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _class_createInstanceFromZone(cls, extraBytes, <span class=\"literal\">nil</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对象初始化中最重要的操作都在 <code>_class_createInstanceFromZone</code> 方法中执行：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">id</span> _class_createInstanceFromZone(Class cls, size_t extraBytes, <span class=\"keyword\">void</span> *zone, <span class=\"keyword\">bool</span> cxxConstruct = <span class=\"literal\">true</span>, size_t *outAllocatedSize = <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">    size_t size = cls-&gt;instanceSize(extraBytes);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">id</span> obj = (<span class=\"keyword\">id</span>)calloc(<span class=\"number\">1</span>, size);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj) <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    obj-&gt;initInstanceIsa(cls, hasCxxDtor);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"init\"><a href=\"#init\" class=\"headerlink\" title=\"init\"></a>init</h3><p><code>init</code>用于初始化类的实例变量，<code>iPhone = [iPhone init];</code> 初始化了一个特殊的 Device 对象，然而他没有发送给类，而是发送给了类的一个实例。<code>init</code>方法也可以返回被初始化的对象。<br><code>NSObject</code> 的 <code>- init</code> 方法调用了 <code>_objc_rootInit</code> 并返回了当前对象：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">id</span>)init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _objc_rootInit(<span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">id</span> _objc_rootInit(<span class=\"keyword\">id</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"声明方法\"><a href=\"#声明方法\" class=\"headerlink\" title=\"声明方法\"></a>声明方法</h2><p>Objective-C 中声明的语法较为特别，方法名以冒号结束告诉编译器该方法有参数，在一对圆括号内指定参数的类型，与指定返回值的方法类似，和 C 类似整个声明以一个分号结束，给出一张图展示声明方法。</p>\n<p><img src=\"http://image.stephenfang.me/obj1.jpg\"></p>\n<h2 id=\"规范注意\"><a href=\"#规范注意\" class=\"headerlink\" title=\"规范注意\"></a>规范注意</h2><p>流程为在<code>@interface</code>部分声明方法,并在<code>@implementation</code>部分定义它们,可使用冒号指明<code>ParentClassName</code>，与在@interface部分使用冒号一样:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Device</span>: <span class=\"title\">NSObject</span></span></span><br></pre></td></tr></table></figure>\n<p>但通常不这么做。</p>\n<p><code>new</code>方法可以将<code>alloc</code>和<code>init</code>的操作结合起来,用两步来实现创建和初始化的方式可以在概念上理解正在发生两个不同的事件:首先创建对象，然后对它初始化。<br>即以下三种方式意义相同。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Device *iPhone = [[Device alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">Device *iPhone;</span><br><span class=\"line\">iPhone = [Device alloc];</span><br><span class=\"line\">iPhone = [iPhone init];</span><br><span class=\"line\"></span><br><span class=\"line\">Device *iPhone = [ Device new]；</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://draveness.me/object-init\">对象是如何初始化的（iOS）</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>最近开始学习 Objective-C 夯实基础，并在学习基础上尝试开发出简单的 iOS 应用程序。有 C 语言基础的同学应该能够比较快上手。在此处总结可以方便本人更好地记忆。</p>","more":"<h2 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h2><p>先给出第一课学习的代码。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Device</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) wakeUp;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) setPasswd: (<span class=\"keyword\">int</span>)input;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) verifyPasswd;</span><br><span class=\"line\">-(<span class=\"keyword\">int</span>) getPasswd;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Device</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> passwd;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)wakeUp&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The device was woken up.&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>)setPasswd:(<span class=\"keyword\">int</span>)input &#123;</span><br><span class=\"line\">    passwd = input;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>)verifyPasswd &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( passwd == <span class=\"number\">1111</span> )</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of this device is correct.&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of this device is incorrect!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">int</span>) getPasswd &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> passwd;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">const</span> <span class=\"keyword\">char</span> * argv[]) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        Device *iPhone = [[Device alloc] init];</span><br><span class=\"line\">        Device *iPad = [[Device alloc] init];</span><br><span class=\"line\">        </span><br><span class=\"line\">        [iPhone wakeUp];</span><br><span class=\"line\">        [iPhone setPasswd:<span class=\"number\">1000</span>];</span><br><span class=\"line\">        [iPhone verifyPasswd];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of iPhone is %i.&quot;</span>,[iPhone getPasswd]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [iPad wakeUp];</span><br><span class=\"line\">        [iPad setPasswd:<span class=\"number\">1111</span>];</span><br><span class=\"line\">        [iPad verifyPasswd];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The password of iPad is %i.&quot;</span>,[iPad getPasswd]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-03-21 12:20:14.658475+0800 DemoProgram[26195:134286] The device was woken up.</span><br><span class=\"line\">2020-03-21 12:20:14.658766+0800 DemoProgram[26195:134286] The password of this device is incorrect!</span><br><span class=\"line\">2020-03-21 12:20:14.658820+0800 DemoProgram[26195:134286] The password of iPhone is 1000.</span><br><span class=\"line\">2020-03-21 12:20:14.658854+0800 DemoProgram[26195:134286] The device was woken up.</span><br><span class=\"line\">2020-03-21 12:20:14.658875+0800 DemoProgram[26195:134286] The password of this device is correct.</span><br><span class=\"line\">2020-03-21 12:20:14.658893+0800 DemoProgram[26195:134286] The password of iPad is 1111.</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"代码解释\"><a href=\"#代码解释\" class=\"headerlink\" title=\"代码解释\"></a>代码解释</h2><p><code>@interface</code> 部分用于描述类和类的方法；<code>@implementation</code> 部分用于描述类对象的实例变量存储的数据，同时实现了接口中声明的方法；剩下代码实现了程序的功能。</p>\n<h3 id=\"alloc\"><a href=\"#alloc\" class=\"headerlink\" title=\"alloc\"></a>alloc</h3><p><code>alloc</code>即 allocate，目的是为新创建的对象分配内存存储空间。<code>alloc</code>保证对象的所有实例变量都变成初始状态，但不意味着对象完成了初始化工作，完成初始化工作需要使用<code>init</code>完成。<br><code>alloc</code> 直接调用了另一个私有方法 <code>id _objc_rootAlloc(Class cls)</code>。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">+ (<span class=\"keyword\">id</span>)alloc &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _objc_rootAlloc(<span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p> <code>id _objc_rootAlloc(Class cls)</code>调用了<code>callAlloc(cls, false/*checkNil*/, true/*allocWithZone*/)</code>,即 <code>NSObject</code> 对 <code>callAlloc</code> 的实现.</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">id</span> _objc_rootAlloc(Class cls) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> callAlloc(cls, <span class=\"literal\">false</span><span class=\"comment\">/*checkNil*/</span>, <span class=\"literal\">true</span><span class=\"comment\">/*allocWithZone*/</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>继续研究<code>callAlloc(Class cls, bool checkNil, bool allocWithZone=false)</code></p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">id</span> callAlloc(Class cls, <span class=\"keyword\">bool</span> checkNil, <span class=\"keyword\">bool</span> allocWithZone=<span class=\"literal\">false</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">id</span> obj = class_createInstance(cls, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">id</span> class_createInstance(Class cls, size_t extraBytes) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _class_createInstanceFromZone(cls, extraBytes, <span class=\"literal\">nil</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对象初始化中最重要的操作都在 <code>_class_createInstanceFromZone</code> 方法中执行：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"keyword\">id</span> _class_createInstanceFromZone(Class cls, size_t extraBytes, <span class=\"keyword\">void</span> *zone, <span class=\"keyword\">bool</span> cxxConstruct = <span class=\"literal\">true</span>, size_t *outAllocatedSize = <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">    size_t size = cls-&gt;instanceSize(extraBytes);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">id</span> obj = (<span class=\"keyword\">id</span>)calloc(<span class=\"number\">1</span>, size);</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!obj) <span class=\"keyword\">return</span> <span class=\"literal\">nil</span>;</span><br><span class=\"line\">    obj-&gt;initInstanceIsa(cls, hasCxxDtor);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"init\"><a href=\"#init\" class=\"headerlink\" title=\"init\"></a>init</h3><p><code>init</code>用于初始化类的实例变量，<code>iPhone = [iPhone init];</code> 初始化了一个特殊的 Device 对象，然而他没有发送给类，而是发送给了类的一个实例。<code>init</code>方法也可以返回被初始化的对象。<br><code>NSObject</code> 的 <code>- init</code> 方法调用了 <code>_objc_rootInit</code> 并返回了当前对象：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">id</span>)init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> _objc_rootInit(<span class=\"keyword\">self</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">id</span> _objc_rootInit(<span class=\"keyword\">id</span> obj) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> obj;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"声明方法\"><a href=\"#声明方法\" class=\"headerlink\" title=\"声明方法\"></a>声明方法</h2><p>Objective-C 中声明的语法较为特别，方法名以冒号结束告诉编译器该方法有参数，在一对圆括号内指定参数的类型，与指定返回值的方法类似，和 C 类似整个声明以一个分号结束，给出一张图展示声明方法。</p>\n<p><img src=\"http://image.stephenfang.me/obj1.jpg\"></p>\n<h2 id=\"规范注意\"><a href=\"#规范注意\" class=\"headerlink\" title=\"规范注意\"></a>规范注意</h2><p>流程为在<code>@interface</code>部分声明方法,并在<code>@implementation</code>部分定义它们,可使用冒号指明<code>ParentClassName</code>，与在@interface部分使用冒号一样:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Device</span>: <span class=\"title\">NSObject</span></span></span><br></pre></td></tr></table></figure>\n<p>但通常不这么做。</p>\n<p><code>new</code>方法可以将<code>alloc</code>和<code>init</code>的操作结合起来,用两步来实现创建和初始化的方式可以在概念上理解正在发生两个不同的事件:首先创建对象，然后对它初始化。<br>即以下三种方式意义相同。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Device *iPhone = [[Device alloc] init];</span><br><span class=\"line\"></span><br><span class=\"line\">Device *iPhone;</span><br><span class=\"line\">iPhone = [Device alloc];</span><br><span class=\"line\">iPhone = [iPhone init];</span><br><span class=\"line\"></span><br><span class=\"line\">Device *iPhone = [ Device new]；</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://draveness.me/object-init\">对象是如何初始化的（iOS）</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/obj1.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:27 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(一）","path":"2020/03/21/Objc_Learning_1/","eyeCatchImage":"http://image.stephenfang.me/obj1.jpg","excerpt":"<h1 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a></h1><p>最近开始学习 Objective-C 夯实基础，并在学习基础上尝试开发出简单的 iOS 应用程序。有 C 语言基础的同学应该能够比较快上手。在此处总结可以方便本人更好地记忆。</p>","date":{"_isAMomentObject":true,"_i":"2020-03-21T01:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-03-21T01:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":3469},{"title":"Objective-C 学习笔记(二）","date":"2020-03-26T13:43:20.000Z","copyright":true,"_content":"\n\n最近开始学习 Objective-C 夯实基础，并尝试在学习基础上开发出简单的 iOS 应用程序。在此处总结可以方便本人更好地整理学习内容，此文为本系列的第二篇文章。\n\n<!--more-->\n\n## 示例代码\n先给出第二课学习的代码。\n\n```objc\n//main.m\n#import <Foundation/Foundation.h>\n#import \"Calculator.h\"\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        double value1, value2;\n        char operator;\n        \n        SubCalculator *subCalculator = [[SubCalculator alloc]init];\n        [subCalculator print];\n        scanf(\"%lf %c %lf\",&value1,&operator,&value2);\n        \n        subCalculator.accumulator = value1;\n        switch (operator) {\n            case '+':\n                [subCalculator add: value2];\n                break;\n            case '-':\n                [subCalculator subtract: value2];\n                break;\n            case '*':\n                [subCalculator multiply: value2];\n                break;\n            case '/':\n                [subCalculator divide: value2];\n                break;\n            default:\n                NSLog(@\"The operator is unknown!\\n\");\n                break;\n        }\n        NSLog(@\"The result is %.2f\",subCalculator.accumulator); //点运算符\n        NSLog(@\"The result is %.2f\", [subCalculator accumulator]); //getter方法\n    }\n    return 0;\n}\n```\n\n```objc\n//Calculator.h\n#import <Foundation/Foundation.h>\n\n@interface Calculator : NSObject\n\n@property double accumulator;\n\n-(void) add: (double) value;\n-(void) subtract: (double) value;\n-(void) multiply: (double) value;\n-(void) divide: (double) value;\n-(void) print;\n\n@end\n\n@interface SubCalculator : Calculator\n\n-(void) print;\n\n@end\n```\n\n```objc\n//Calculator.m\n#import \"Calculator.h\"\n\n@implementation Calculator\n\n@synthesize accumulator;\n\n-(void) add: (double) value{\n    accumulator += value;\n}\n-(void) subtract: (double) value{\n    accumulator -= value;\n}\n-(void) multiply: (double) value{\n    accumulator *= value;\n}\n-(void) divide: (double) value{\n    accumulator /= value;\n}\n\n-(void) print{\n    NSLog(@\"Type in your expression.\\n\");\n    NSLog(@\"Method from Class Calculator.\\n\");\n}\n\n@end\n\n@implementation SubCalculator\n\n-(void) print{\n    NSLog(@\"Type in your expression.\\n\");\n    NSLog(@\"Method from Sub Class subCalculator.\\n\");\n}\n\n@end\n```\n\n运行结果如下：\n```log\n2020-03-26 18:21:58.865631+0800 DemoProgram[17447:519699] Type in your expression.\n2 * 5\n2020-03-26 18:22:23.471596+0800 DemoProgram[17447:519699] The result is 10.00\n2020-03-26 18:22:23.471696+0800 DemoProgram[17447:519699] The result is 10.00\nProgram ended with exit code: 0\n```\n\n### 代码解释\n相比上一次实验，接口与实现文件得到了分离，这一点与C++是类似的。\n类的声明，即`@interface` 部分，用于描述类和类的方法，放在自己的名字为`class.h`的文件中；类的实现，即`@implementation` 部分，用于描述类对象的实例变量存储的数据，实现了接口中声明的方法，放在同名的.m文件中；`main.m`实现了简易计算器的功能。\n该程序简单验证了继承、覆写的概念，可以在程序基础上做出更改验证\n\n### 点运算符\n```objc \n[calculator setAccumulator: value1]\n```\n与\n\n```objc \ncalculator.accumulator = value1;\n```\n都完成了赋值操作，需要注意的是编码风格，点运算符通常运用在属性上，用于设置或取得实例变量的值，其他的工作通常使用传统的方括号形式的消息表达式作为首选语法。\n### @property 与 @synthesize\n#### 合成存取\n使用`synthesize`的存取方法，属性前面不要用new、alloc、copy或者init等作为开头，编译器会合成相关方法。\n```objc \n@property double accumulator;\n```\n如果使用了`@property`指令，就不需要在实现部分声明相应的实例变量。\n```objc \n@synthesize accumulator;\n```\n这句话告诉Objective-C编译器，为accumulator属性生成一对设值方法和取值方法，即设值方法`accumulator`与取值方法`setAccumulator`。\n如果只使用`@property`且并未使用`@synthesize`，编译器也会生成相应的 setter 和 getter，但是生成的实例变量以下划线(_)作为其名称第一个字符，如此处会生成\"_accumulator\"。\n#### 继承中存在的问题\n在子类中使用实例变量，必须现在接口部分声明变量，而不是在实现部分声明变量。在实现部分声明和合成(`@synthesize`)的实例变量为私有，无法在子类中访问。\n\n![](http://image.stephenfang.me/test1.png)\n## 其他总结\n### 关于多态\n使不同的类共享相同方法名称的能力叫多态。\n> 多态让你可以开发一组类，这组类中的每一个类都能响应相同的方法名。每个类的定义都封装了响应特定方法所需的代码，这就使得它独立于其他的类定义。多态还允许你以后添加新的类，这些新类能够响应相同的方法名。\n\n### 关于动态类型\n- `id` 可以用来存储属于任何类的对象，且` id `对象类型的声明中无需使用星号(*)。\n- `Objective-C` 总是跟踪对象所属的类。系统先判定对象所属的类，然后在**运行**时确定需要动态调用的方法，而不是在**编译**的时候。\n- 静态类型能够在程序编译阶段而不是运行阶段标明错误\n- 静态类型相比动态类型能够提高程序可读性\n\n> 如果存在id变量`dataValue 1`和`dataValue2`，那么\n```objc\nresult = [dataValue1 add: dataValue2] ;\n```\n会导致编译器生成代码,将参数传递给add:方法,并通过假设来处理其返回值。\n在运行时，`Objective-C` 运行时系统仍然会检查存储在dataValue1中对象所属的类选择相应的方法来执行。然而，在大多数情况下，编译器可能生成不正确的代码来向方法传递参数或处理返回值。\n当一个方法选取对象作为它的参数，而另一个方法选取浮点数作为参数时，很有可能发生这种情况。如果这两个方法之间的不一致仅在于对象类型的不同,编译器仍然能够生成正确的代码,因为传递给对象的引用是内存地址(即指针)。\n\n### 关于类的问题\n![NSObject类支持的基本方法](http://image.stephenfang.me/Xnip2020-03-26_21-23-56.png)\n\n对`isMemberOfClass`、`isKindOfClass`、`isSubclassOfClass`、`respondsToSelector`、`instancesRespondToSelector`的用法与意义应熟稔于心。\n\n### 关于异常处理\n`Objective-C`中对于异常处理的机制与`C++`、`Java`等均为类似。格式如下：\n```objc\n@try {\nstatement\nstatement\n...\n}\n@catch (NSException *exception) {\nstatement\nstatement\n...\n}\n```\n> 一般来说，你并不希望程序在运行时发生异常。这就需要考虑更好的编程实践，在错误发生之前做测试，而不是错误发生后捕获它。测试方法的错误并返回一些值作为错误的标识，而不是抛出异常。抛出异常通常会使用大量的系统资源，Apple 反对非必要的使用异常(例如，你不希望因为一一个文件无法打开而抛出异常)。\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n","source":"_posts/Objc_Learning_2.md","raw":"---\ntitle: Objective-C 学习笔记(二）\ndate: 2020-03-26 21:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n\n最近开始学习 Objective-C 夯实基础，并尝试在学习基础上开发出简单的 iOS 应用程序。在此处总结可以方便本人更好地整理学习内容，此文为本系列的第二篇文章。\n\n<!--more-->\n\n## 示例代码\n先给出第二课学习的代码。\n\n```objc\n//main.m\n#import <Foundation/Foundation.h>\n#import \"Calculator.h\"\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        double value1, value2;\n        char operator;\n        \n        SubCalculator *subCalculator = [[SubCalculator alloc]init];\n        [subCalculator print];\n        scanf(\"%lf %c %lf\",&value1,&operator,&value2);\n        \n        subCalculator.accumulator = value1;\n        switch (operator) {\n            case '+':\n                [subCalculator add: value2];\n                break;\n            case '-':\n                [subCalculator subtract: value2];\n                break;\n            case '*':\n                [subCalculator multiply: value2];\n                break;\n            case '/':\n                [subCalculator divide: value2];\n                break;\n            default:\n                NSLog(@\"The operator is unknown!\\n\");\n                break;\n        }\n        NSLog(@\"The result is %.2f\",subCalculator.accumulator); //点运算符\n        NSLog(@\"The result is %.2f\", [subCalculator accumulator]); //getter方法\n    }\n    return 0;\n}\n```\n\n```objc\n//Calculator.h\n#import <Foundation/Foundation.h>\n\n@interface Calculator : NSObject\n\n@property double accumulator;\n\n-(void) add: (double) value;\n-(void) subtract: (double) value;\n-(void) multiply: (double) value;\n-(void) divide: (double) value;\n-(void) print;\n\n@end\n\n@interface SubCalculator : Calculator\n\n-(void) print;\n\n@end\n```\n\n```objc\n//Calculator.m\n#import \"Calculator.h\"\n\n@implementation Calculator\n\n@synthesize accumulator;\n\n-(void) add: (double) value{\n    accumulator += value;\n}\n-(void) subtract: (double) value{\n    accumulator -= value;\n}\n-(void) multiply: (double) value{\n    accumulator *= value;\n}\n-(void) divide: (double) value{\n    accumulator /= value;\n}\n\n-(void) print{\n    NSLog(@\"Type in your expression.\\n\");\n    NSLog(@\"Method from Class Calculator.\\n\");\n}\n\n@end\n\n@implementation SubCalculator\n\n-(void) print{\n    NSLog(@\"Type in your expression.\\n\");\n    NSLog(@\"Method from Sub Class subCalculator.\\n\");\n}\n\n@end\n```\n\n运行结果如下：\n```log\n2020-03-26 18:21:58.865631+0800 DemoProgram[17447:519699] Type in your expression.\n2 * 5\n2020-03-26 18:22:23.471596+0800 DemoProgram[17447:519699] The result is 10.00\n2020-03-26 18:22:23.471696+0800 DemoProgram[17447:519699] The result is 10.00\nProgram ended with exit code: 0\n```\n\n### 代码解释\n相比上一次实验，接口与实现文件得到了分离，这一点与C++是类似的。\n类的声明，即`@interface` 部分，用于描述类和类的方法，放在自己的名字为`class.h`的文件中；类的实现，即`@implementation` 部分，用于描述类对象的实例变量存储的数据，实现了接口中声明的方法，放在同名的.m文件中；`main.m`实现了简易计算器的功能。\n该程序简单验证了继承、覆写的概念，可以在程序基础上做出更改验证\n\n### 点运算符\n```objc \n[calculator setAccumulator: value1]\n```\n与\n\n```objc \ncalculator.accumulator = value1;\n```\n都完成了赋值操作，需要注意的是编码风格，点运算符通常运用在属性上，用于设置或取得实例变量的值，其他的工作通常使用传统的方括号形式的消息表达式作为首选语法。\n### @property 与 @synthesize\n#### 合成存取\n使用`synthesize`的存取方法，属性前面不要用new、alloc、copy或者init等作为开头，编译器会合成相关方法。\n```objc \n@property double accumulator;\n```\n如果使用了`@property`指令，就不需要在实现部分声明相应的实例变量。\n```objc \n@synthesize accumulator;\n```\n这句话告诉Objective-C编译器，为accumulator属性生成一对设值方法和取值方法，即设值方法`accumulator`与取值方法`setAccumulator`。\n如果只使用`@property`且并未使用`@synthesize`，编译器也会生成相应的 setter 和 getter，但是生成的实例变量以下划线(_)作为其名称第一个字符，如此处会生成\"_accumulator\"。\n#### 继承中存在的问题\n在子类中使用实例变量，必须现在接口部分声明变量，而不是在实现部分声明变量。在实现部分声明和合成(`@synthesize`)的实例变量为私有，无法在子类中访问。\n\n![](http://image.stephenfang.me/test1.png)\n## 其他总结\n### 关于多态\n使不同的类共享相同方法名称的能力叫多态。\n> 多态让你可以开发一组类，这组类中的每一个类都能响应相同的方法名。每个类的定义都封装了响应特定方法所需的代码，这就使得它独立于其他的类定义。多态还允许你以后添加新的类，这些新类能够响应相同的方法名。\n\n### 关于动态类型\n- `id` 可以用来存储属于任何类的对象，且` id `对象类型的声明中无需使用星号(*)。\n- `Objective-C` 总是跟踪对象所属的类。系统先判定对象所属的类，然后在**运行**时确定需要动态调用的方法，而不是在**编译**的时候。\n- 静态类型能够在程序编译阶段而不是运行阶段标明错误\n- 静态类型相比动态类型能够提高程序可读性\n\n> 如果存在id变量`dataValue 1`和`dataValue2`，那么\n```objc\nresult = [dataValue1 add: dataValue2] ;\n```\n会导致编译器生成代码,将参数传递给add:方法,并通过假设来处理其返回值。\n在运行时，`Objective-C` 运行时系统仍然会检查存储在dataValue1中对象所属的类选择相应的方法来执行。然而，在大多数情况下，编译器可能生成不正确的代码来向方法传递参数或处理返回值。\n当一个方法选取对象作为它的参数，而另一个方法选取浮点数作为参数时，很有可能发生这种情况。如果这两个方法之间的不一致仅在于对象类型的不同,编译器仍然能够生成正确的代码,因为传递给对象的引用是内存地址(即指针)。\n\n### 关于类的问题\n![NSObject类支持的基本方法](http://image.stephenfang.me/Xnip2020-03-26_21-23-56.png)\n\n对`isMemberOfClass`、`isKindOfClass`、`isSubclassOfClass`、`respondsToSelector`、`instancesRespondToSelector`的用法与意义应熟稔于心。\n\n### 关于异常处理\n`Objective-C`中对于异常处理的机制与`C++`、`Java`等均为类似。格式如下：\n```objc\n@try {\nstatement\nstatement\n...\n}\n@catch (NSException *exception) {\nstatement\nstatement\n...\n}\n```\n> 一般来说，你并不希望程序在运行时发生异常。这就需要考虑更好的编程实践，在错误发生之前做测试，而不是错误发生后捕获它。测试方法的错误并返回一些值作为错误的标识，而不是抛出异常。抛出异常通常会使用大量的系统资源，Apple 反对非必要的使用异常(例如，你不希望因为一一个文件无法打开而抛出异常)。\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n","slug":"Objc_Learning_2","published":1,"updated":"2022-07-24T15:20:31.331Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1x0013o76fh3sg2jlf","content":"<p>最近开始学习 Objective-C 夯实基础，并尝试在学习基础上开发出简单的 iOS 应用程序。在此处总结可以方便本人更好地整理学习内容，此文为本系列的第二篇文章。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h2><p>先给出第二课学习的代码。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Calculator.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">double</span> value1, value2;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> operator;</span><br><span class=\"line\">        </span><br><span class=\"line\">        SubCalculator *subCalculator = [[SubCalculator alloc]init];</span><br><span class=\"line\">        [subCalculator print];</span><br><span class=\"line\">        scanf(<span class=\"string\">&quot;%lf %c %lf&quot;</span>,&amp;value1,&amp;operator,&amp;value2);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subCalculator.accumulator = value1;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (operator) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span><br><span class=\"line\">                [subCalculator add: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span><br><span class=\"line\">                [subCalculator subtract: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">                [subCalculator multiply: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span><br><span class=\"line\">                [subCalculator divide: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The operator is unknown!\\n&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The result is %.2f&quot;</span>,subCalculator.accumulator); <span class=\"comment\">//点运算符</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The result is %.2f&quot;</span>, [subCalculator accumulator]); <span class=\"comment\">//getter方法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Calculator.h</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Calculator</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> <span class=\"keyword\">double</span> accumulator;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) add: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) subtract: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) multiply: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) divide: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">SubCalculator</span> : <span class=\"title\">Calculator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Calculator.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Calculator.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Calculator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@synthesize</span> accumulator;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) add: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator += value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) subtract: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator -= value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) multiply: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator *= value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) divide: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator /= value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Type in your expression.\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Method from Class Calculator.\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">SubCalculator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Type in your expression.\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Method from Sub Class subCalculator.\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-03-26 18:21:58.865631+0800 DemoProgram[17447:519699] Type in your expression.</span><br><span class=\"line\">2 * 5</span><br><span class=\"line\">2020-03-26 18:22:23.471596+0800 DemoProgram[17447:519699] The result is 10.00</span><br><span class=\"line\">2020-03-26 18:22:23.471696+0800 DemoProgram[17447:519699] The result is 10.00</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"代码解释\"><a href=\"#代码解释\" class=\"headerlink\" title=\"代码解释\"></a>代码解释</h3><p>相比上一次实验，接口与实现文件得到了分离，这一点与C++是类似的。<br>类的声明，即<code>@interface</code> 部分，用于描述类和类的方法，放在自己的名字为<code>class.h</code>的文件中；类的实现，即<code>@implementation</code> 部分，用于描述类对象的实例变量存储的数据，实现了接口中声明的方法，放在同名的.m文件中；<code>main.m</code>实现了简易计算器的功能。<br>该程序简单验证了继承、覆写的概念，可以在程序基础上做出更改验证</p>\n<h3 id=\"点运算符\"><a href=\"#点运算符\" class=\"headerlink\" title=\"点运算符\"></a>点运算符</h3><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[calculator setAccumulator: value1]</span><br></pre></td></tr></table></figure>\n<p>与</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">calculator.accumulator = value1;</span><br></pre></td></tr></table></figure>\n<p>都完成了赋值操作，需要注意的是编码风格，点运算符通常运用在属性上，用于设置或取得实例变量的值，其他的工作通常使用传统的方括号形式的消息表达式作为首选语法。</p>\n<h3 id=\"property-与-synthesize\"><a href=\"#property-与-synthesize\" class=\"headerlink\" title=\"@property 与 @synthesize\"></a>@property 与 @synthesize</h3><h4 id=\"合成存取\"><a href=\"#合成存取\" class=\"headerlink\" title=\"合成存取\"></a>合成存取</h4><p>使用<code>synthesize</code>的存取方法，属性前面不要用new、alloc、copy或者init等作为开头，编译器会合成相关方法。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> <span class=\"keyword\">double</span> accumulator;</span><br></pre></td></tr></table></figure>\n<p>如果使用了<code>@property</code>指令，就不需要在实现部分声明相应的实例变量。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synthesize</span> accumulator;</span><br></pre></td></tr></table></figure>\n<p>这句话告诉Objective-C编译器，为accumulator属性生成一对设值方法和取值方法，即设值方法<code>accumulator</code>与取值方法<code>setAccumulator</code>。<br>如果只使用<code>@property</code>且并未使用<code>@synthesize</code>，编译器也会生成相应的 setter 和 getter，但是生成的实例变量以下划线(_)作为其名称第一个字符，如此处会生成”_accumulator”。</p>\n<h4 id=\"继承中存在的问题\"><a href=\"#继承中存在的问题\" class=\"headerlink\" title=\"继承中存在的问题\"></a>继承中存在的问题</h4><p>在子类中使用实例变量，必须现在接口部分声明变量，而不是在实现部分声明变量。在实现部分声明和合成(<code>@synthesize</code>)的实例变量为私有，无法在子类中访问。</p>\n<p><img src=\"http://image.stephenfang.me/test1.png\"></p>\n<h2 id=\"其他总结\"><a href=\"#其他总结\" class=\"headerlink\" title=\"其他总结\"></a>其他总结</h2><h3 id=\"关于多态\"><a href=\"#关于多态\" class=\"headerlink\" title=\"关于多态\"></a>关于多态</h3><p>使不同的类共享相同方法名称的能力叫多态。</p>\n<blockquote>\n<p>多态让你可以开发一组类，这组类中的每一个类都能响应相同的方法名。每个类的定义都封装了响应特定方法所需的代码，这就使得它独立于其他的类定义。多态还允许你以后添加新的类，这些新类能够响应相同的方法名。</p>\n</blockquote>\n<h3 id=\"关于动态类型\"><a href=\"#关于动态类型\" class=\"headerlink\" title=\"关于动态类型\"></a>关于动态类型</h3><ul>\n<li><code>id</code> 可以用来存储属于任何类的对象，且<code>id</code>对象类型的声明中无需使用星号(*)。</li>\n<li><code>Objective-C</code> 总是跟踪对象所属的类。系统先判定对象所属的类，然后在<strong>运行</strong>时确定需要动态调用的方法，而不是在<strong>编译</strong>的时候。</li>\n<li>静态类型能够在程序编译阶段而不是运行阶段标明错误</li>\n<li>静态类型相比动态类型能够提高程序可读性</li>\n</ul>\n<blockquote>\n<p>如果存在id变量<code>dataValue 1</code>和<code>dataValue2</code>，那么</p>\n</blockquote>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = [dataValue1 add: dataValue2] ;</span><br></pre></td></tr></table></figure>\n<p>会导致编译器生成代码,将参数传递给add:方法,并通过假设来处理其返回值。<br>在运行时，<code>Objective-C</code> 运行时系统仍然会检查存储在dataValue1中对象所属的类选择相应的方法来执行。然而，在大多数情况下，编译器可能生成不正确的代码来向方法传递参数或处理返回值。<br>当一个方法选取对象作为它的参数，而另一个方法选取浮点数作为参数时，很有可能发生这种情况。如果这两个方法之间的不一致仅在于对象类型的不同,编译器仍然能够生成正确的代码,因为传递给对象的引用是内存地址(即指针)。</p>\n<h3 id=\"关于类的问题\"><a href=\"#关于类的问题\" class=\"headerlink\" title=\"关于类的问题\"></a>关于类的问题</h3><p><img src=\"http://image.stephenfang.me/Xnip2020-03-26_21-23-56.png\" alt=\"NSObject类支持的基本方法\"></p>\n<p>对<code>isMemberOfClass</code>、<code>isKindOfClass</code>、<code>isSubclassOfClass</code>、<code>respondsToSelector</code>、<code>instancesRespondToSelector</code>的用法与意义应熟稔于心。</p>\n<h3 id=\"关于异常处理\"><a href=\"#关于异常处理\" class=\"headerlink\" title=\"关于异常处理\"></a>关于异常处理</h3><p><code>Objective-C</code>中对于异常处理的机制与<code>C++</code>、<code>Java</code>等均为类似。格式如下：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@try</span> &#123;</span><br><span class=\"line\">statement</span><br><span class=\"line\">statement</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@catch</span> (<span class=\"built_in\">NSException</span> *exception) &#123;</span><br><span class=\"line\">statement</span><br><span class=\"line\">statement</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>一般来说，你并不希望程序在运行时发生异常。这就需要考虑更好的编程实践，在错误发生之前做测试，而不是错误发生后捕获它。测试方法的错误并返回一些值作为错误的标识，而不是抛出异常。抛出异常通常会使用大量的系统资源，Apple 反对非必要的使用异常(例如，你不希望因为一一个文件无法打开而抛出异常)。</p>\n</blockquote>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 Objective-C 夯实基础，并尝试在学习基础上开发出简单的 iOS 应用程序。在此处总结可以方便本人更好地整理学习内容，此文为本系列的第二篇文章。</p>","more":"<h2 id=\"示例代码\"><a href=\"#示例代码\" class=\"headerlink\" title=\"示例代码\"></a>示例代码</h2><p>先给出第二课学习的代码。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Calculator.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">double</span> value1, value2;</span><br><span class=\"line\">        <span class=\"keyword\">char</span> operator;</span><br><span class=\"line\">        </span><br><span class=\"line\">        SubCalculator *subCalculator = [[SubCalculator alloc]init];</span><br><span class=\"line\">        [subCalculator print];</span><br><span class=\"line\">        scanf(<span class=\"string\">&quot;%lf %c %lf&quot;</span>,&amp;value1,&amp;operator,&amp;value2);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subCalculator.accumulator = value1;</span><br><span class=\"line\">        <span class=\"keyword\">switch</span> (operator) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;+&#x27;</span>:</span><br><span class=\"line\">                [subCalculator add: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;-&#x27;</span>:</span><br><span class=\"line\">                [subCalculator subtract: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;*&#x27;</span>:</span><br><span class=\"line\">                [subCalculator multiply: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">case</span> <span class=\"string\">&#x27;/&#x27;</span>:</span><br><span class=\"line\">                [subCalculator divide: value2];</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            <span class=\"keyword\">default</span>:</span><br><span class=\"line\">                <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The operator is unknown!\\n&quot;</span>);</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The result is %.2f&quot;</span>,subCalculator.accumulator); <span class=\"comment\">//点运算符</span></span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The result is %.2f&quot;</span>, [subCalculator accumulator]); <span class=\"comment\">//getter方法</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Calculator.h</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Calculator</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@property</span> <span class=\"keyword\">double</span> accumulator;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) add: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) subtract: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) multiply: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) divide: (<span class=\"keyword\">double</span>) value;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">SubCalculator</span> : <span class=\"title\">Calculator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Calculator.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Calculator.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Calculator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@synthesize</span> accumulator;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) add: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator += value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) subtract: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator -= value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) multiply: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator *= value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) divide: (<span class=\"keyword\">double</span>) value&#123;</span><br><span class=\"line\">    accumulator /= value;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Type in your expression.\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Method from Class Calculator.\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">SubCalculator</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Type in your expression.\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Method from Sub Class subCalculator.\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<p>运行结果如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-03-26 18:21:58.865631+0800 DemoProgram[17447:519699] Type in your expression.</span><br><span class=\"line\">2 * 5</span><br><span class=\"line\">2020-03-26 18:22:23.471596+0800 DemoProgram[17447:519699] The result is 10.00</span><br><span class=\"line\">2020-03-26 18:22:23.471696+0800 DemoProgram[17447:519699] The result is 10.00</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"代码解释\"><a href=\"#代码解释\" class=\"headerlink\" title=\"代码解释\"></a>代码解释</h3><p>相比上一次实验，接口与实现文件得到了分离，这一点与C++是类似的。<br>类的声明，即<code>@interface</code> 部分，用于描述类和类的方法，放在自己的名字为<code>class.h</code>的文件中；类的实现，即<code>@implementation</code> 部分，用于描述类对象的实例变量存储的数据，实现了接口中声明的方法，放在同名的.m文件中；<code>main.m</code>实现了简易计算器的功能。<br>该程序简单验证了继承、覆写的概念，可以在程序基础上做出更改验证</p>\n<h3 id=\"点运算符\"><a href=\"#点运算符\" class=\"headerlink\" title=\"点运算符\"></a>点运算符</h3><figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[calculator setAccumulator: value1]</span><br></pre></td></tr></table></figure>\n<p>与</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">calculator.accumulator = value1;</span><br></pre></td></tr></table></figure>\n<p>都完成了赋值操作，需要注意的是编码风格，点运算符通常运用在属性上，用于设置或取得实例变量的值，其他的工作通常使用传统的方括号形式的消息表达式作为首选语法。</p>\n<h3 id=\"property-与-synthesize\"><a href=\"#property-与-synthesize\" class=\"headerlink\" title=\"@property 与 @synthesize\"></a>@property 与 @synthesize</h3><h4 id=\"合成存取\"><a href=\"#合成存取\" class=\"headerlink\" title=\"合成存取\"></a>合成存取</h4><p>使用<code>synthesize</code>的存取方法，属性前面不要用new、alloc、copy或者init等作为开头，编译器会合成相关方法。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@property</span> <span class=\"keyword\">double</span> accumulator;</span><br></pre></td></tr></table></figure>\n<p>如果使用了<code>@property</code>指令，就不需要在实现部分声明相应的实例变量。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synthesize</span> accumulator;</span><br></pre></td></tr></table></figure>\n<p>这句话告诉Objective-C编译器，为accumulator属性生成一对设值方法和取值方法，即设值方法<code>accumulator</code>与取值方法<code>setAccumulator</code>。<br>如果只使用<code>@property</code>且并未使用<code>@synthesize</code>，编译器也会生成相应的 setter 和 getter，但是生成的实例变量以下划线(_)作为其名称第一个字符，如此处会生成”_accumulator”。</p>\n<h4 id=\"继承中存在的问题\"><a href=\"#继承中存在的问题\" class=\"headerlink\" title=\"继承中存在的问题\"></a>继承中存在的问题</h4><p>在子类中使用实例变量，必须现在接口部分声明变量，而不是在实现部分声明变量。在实现部分声明和合成(<code>@synthesize</code>)的实例变量为私有，无法在子类中访问。</p>\n<p><img src=\"http://image.stephenfang.me/test1.png\"></p>\n<h2 id=\"其他总结\"><a href=\"#其他总结\" class=\"headerlink\" title=\"其他总结\"></a>其他总结</h2><h3 id=\"关于多态\"><a href=\"#关于多态\" class=\"headerlink\" title=\"关于多态\"></a>关于多态</h3><p>使不同的类共享相同方法名称的能力叫多态。</p>\n<blockquote>\n<p>多态让你可以开发一组类，这组类中的每一个类都能响应相同的方法名。每个类的定义都封装了响应特定方法所需的代码，这就使得它独立于其他的类定义。多态还允许你以后添加新的类，这些新类能够响应相同的方法名。</p>\n</blockquote>\n<h3 id=\"关于动态类型\"><a href=\"#关于动态类型\" class=\"headerlink\" title=\"关于动态类型\"></a>关于动态类型</h3><ul>\n<li><code>id</code> 可以用来存储属于任何类的对象，且<code>id</code>对象类型的声明中无需使用星号(*)。</li>\n<li><code>Objective-C</code> 总是跟踪对象所属的类。系统先判定对象所属的类，然后在<strong>运行</strong>时确定需要动态调用的方法，而不是在<strong>编译</strong>的时候。</li>\n<li>静态类型能够在程序编译阶段而不是运行阶段标明错误</li>\n<li>静态类型相比动态类型能够提高程序可读性</li>\n</ul>\n<blockquote>\n<p>如果存在id变量<code>dataValue 1</code>和<code>dataValue2</code>，那么</p>\n</blockquote>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">result = [dataValue1 add: dataValue2] ;</span><br></pre></td></tr></table></figure>\n<p>会导致编译器生成代码,将参数传递给add:方法,并通过假设来处理其返回值。<br>在运行时，<code>Objective-C</code> 运行时系统仍然会检查存储在dataValue1中对象所属的类选择相应的方法来执行。然而，在大多数情况下，编译器可能生成不正确的代码来向方法传递参数或处理返回值。<br>当一个方法选取对象作为它的参数，而另一个方法选取浮点数作为参数时，很有可能发生这种情况。如果这两个方法之间的不一致仅在于对象类型的不同,编译器仍然能够生成正确的代码,因为传递给对象的引用是内存地址(即指针)。</p>\n<h3 id=\"关于类的问题\"><a href=\"#关于类的问题\" class=\"headerlink\" title=\"关于类的问题\"></a>关于类的问题</h3><p><img src=\"http://image.stephenfang.me/Xnip2020-03-26_21-23-56.png\" alt=\"NSObject类支持的基本方法\"></p>\n<p>对<code>isMemberOfClass</code>、<code>isKindOfClass</code>、<code>isSubclassOfClass</code>、<code>respondsToSelector</code>、<code>instancesRespondToSelector</code>的用法与意义应熟稔于心。</p>\n<h3 id=\"关于异常处理\"><a href=\"#关于异常处理\" class=\"headerlink\" title=\"关于异常处理\"></a>关于异常处理</h3><p><code>Objective-C</code>中对于异常处理的机制与<code>C++</code>、<code>Java</code>等均为类似。格式如下：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@try</span> &#123;</span><br><span class=\"line\">statement</span><br><span class=\"line\">statement</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@catch</span> (<span class=\"built_in\">NSException</span> *exception) &#123;</span><br><span class=\"line\">statement</span><br><span class=\"line\">statement</span><br><span class=\"line\">...</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>一般来说，你并不希望程序在运行时发生异常。这就需要考虑更好的编程实践，在错误发生之前做测试，而不是错误发生后捕获它。测试方法的错误并返回一些值作为错误的标识，而不是抛出异常。抛出异常通常会使用大量的系统资源，Apple 反对非必要的使用异常(例如，你不希望因为一一个文件无法打开而抛出异常)。</p>\n</blockquote>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/test1.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:31 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(二）","path":"2020/03/26/Objc_Learning_2/","eyeCatchImage":"http://image.stephenfang.me/test1.png","excerpt":"<p>最近开始学习 Objective-C 夯实基础，并尝试在学习基础上开发出简单的 iOS 应用程序。在此处总结可以方便本人更好地整理学习内容，此文为本系列的第二篇文章。</p>","date":{"_isAMomentObject":true,"_i":"2020-03-26T13:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-03-26T13:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":4012},{"title":"Objective-C 学习笔记(三）","date":"2020-04-05T06:43:20.000Z","copyright":true,"_content":"\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第三篇文章，主要复习了数据类型、预处理、分类与协议等内容。\n\n<!--more-->\n\n### 关于初始化与变量\n#### 关于初始化\n若在创建类的对象时需要使用和引用一个或多个实例变量，可以通过重载init方法达到目的。该方法首先调用父类初始化方法，使得继承实例变量正常初始化，因为初始化过程改变了对象在内存中的位置所以需要将父类init方法执行结果赋值给self。特殊类型instancetype表明,从init方法返回的类型与它的初始化类相同。\n```objc \n(instantype) init {\n    self = [ super init ];\n    if ( self ) {\n    //do sth here\n    } \n    return self;\n}\n```\n#### 关于 extern 与 static\n- 声明不会引起变量存储空间分配，而定义会引起变量存储空间分配。\n- 如果有很多方法需要访问外部变量的值,应该只在文件的开始进行一次extern声明。\n- 如果只有一个或少数几个方法访问这个变量，应该在其中的每个方法中单独进行extern声明。\n- 如果变量定义在包含访问这个变量的文件中，不需要单独进行extern声明。\n- static 变量声明在文件中的任何方法(或函数)之外，所有位于这条语句之后的方法或函数都可以访问其值，而其他文件中的方法和函数则不行。\n- 静态局部变量用关键字static声明，其值在函数调用的过程中保留下来，并且初始值默认为0。\n\n### 关于预处理\n- 预定义名称非变量不能为其赋值，其右边所有字符被预处理程序自动替换到程序中，类似于文本处理中的搜索与替换。\n- \\#define 可以出现在程序程序任何地方，不必为开头；把定义放在头文件中可以方便在多个源文件中使用。\n- 从视觉上区分预定义的值和变量可以通过大写字母组合实现。\n- 预处理程序定义右边不必是合法`Objective-C`表达式。\n\n### 关于条件编译\n在调试程序时条件编译很有用。在程序中嵌入了NSLog调用可以用于显示中间结果并跟踪执行流程。程序中可能有很多这样的调试语句，且无论何时调试这个程序，都能够通过DEBUG使所有的调试语句都编译。\n\n```objc \n#ifdef DEBUG\n NSLog (@\"username = %@, password = %i\", username, password);\n #endif\n```\n\n### 关于分类\n#### 分类定义\n面对一个类定义时可能想要添加新的方法，如对于一个计算器类来说可能需要四则运算的方法，而该类当前只需要处理四则运算方面的功能，其他的创建和初始化交由其他方法来做，这个时候就可以用到分类的思想。\n分类提供简单的方式将类的定义模块划到相关方法的组或分类中，同时其提供了扩展现有类定义的简便方式，不必访问类的源代码，也不必创建子类。\n如对于一个假定的计算器的四则运算操作就可以创建如下分类。\n```objc \n@interface Calculator (MathOps)\n-(void) add: (double) value1 : (double) value2;\n-(void) subtract: (double) value1 : (double) value2;\n-(void) multiply: (double) value1 : (double) value2;\n-(void) divide: (double) value1 : (double) value2;\n@end\n```\n#### 分类注意\n分类可以覆写该类的另一个方法，但是覆写方法后无法访问原来的方法，所以正确的选择是创建子类。在子类中覆写方法可以通过super发送消息引用父类方法。\n通过使用分类添加新方法扩展类会影响当前类与其子类。\n### 关于协议与代理\n#### 协议要点\n协议是多个类共享的一个方法列表，协议中列出了一组方法，有些选择实现，有些必须实现。如`NSObject.h`中的部分协议定义。\n```objc \n@protocol NSCopying\n- (id)copyWithZone:(nullable NSZone *)zone;\n@end\n\n@protocol NSCoding\n- (void)encodeWithCoder:(NSCoder *)coder;\n- (nullable instancetype)initWithCoder:(NSCoder *)coder; // NS_DESIGNATED_INITIALIZER\n@end\n```\n如果类采用`NSCopying`和`NSCoding`协议，就必须实现`copyWithZone`等方法，使用方法如下。\n```objc \n@interface DemoPrototol: NSObject <NSCopying,NSCoding>\n```\n自定义协议时可以使用`@optional`指令表明列出的方法都是可选的，可以使用`required`指令标明必须实现的方法。\n#### 协议注意\n- 协议不引用任何类。\n- 可以使用conformsToProtocol:方法检查一个对象是否遵循某项协议。\n- 编译器只有在没有实现协议要求的方法时发出警告。\n- 与类名一样，协议名唯一。\n\n#### 代理要点\n\n定义了协议的类可以看作是将协议定义的方法代理给了实现它们的类。如iOS建立表格需使用UITableView类，需要代理定义UITableViewDataSource协议，如果协议需要信息就会调用类中实现协议的相关方法，开发者必须将其写入类中，与协议相匹配。协议中定义的其他方法是否实现决定权在开发者，即责任代理在开发者。\n- 如果一个对象采用正式协议，则它必须遵守协议中的所有信息。这可以在运行及编译时强制执行。\n- 如果一个对象采用非正式协议，则它可能不需要采用此协议的所有方法，具体取决于这项协议。\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n","source":"_posts/Objc_Learning_3.md","raw":"---\ntitle: Objective-C 学习笔记(三）\ndate: 2020-04-05 14:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第三篇文章，主要复习了数据类型、预处理、分类与协议等内容。\n\n<!--more-->\n\n### 关于初始化与变量\n#### 关于初始化\n若在创建类的对象时需要使用和引用一个或多个实例变量，可以通过重载init方法达到目的。该方法首先调用父类初始化方法，使得继承实例变量正常初始化，因为初始化过程改变了对象在内存中的位置所以需要将父类init方法执行结果赋值给self。特殊类型instancetype表明,从init方法返回的类型与它的初始化类相同。\n```objc \n(instantype) init {\n    self = [ super init ];\n    if ( self ) {\n    //do sth here\n    } \n    return self;\n}\n```\n#### 关于 extern 与 static\n- 声明不会引起变量存储空间分配，而定义会引起变量存储空间分配。\n- 如果有很多方法需要访问外部变量的值,应该只在文件的开始进行一次extern声明。\n- 如果只有一个或少数几个方法访问这个变量，应该在其中的每个方法中单独进行extern声明。\n- 如果变量定义在包含访问这个变量的文件中，不需要单独进行extern声明。\n- static 变量声明在文件中的任何方法(或函数)之外，所有位于这条语句之后的方法或函数都可以访问其值，而其他文件中的方法和函数则不行。\n- 静态局部变量用关键字static声明，其值在函数调用的过程中保留下来，并且初始值默认为0。\n\n### 关于预处理\n- 预定义名称非变量不能为其赋值，其右边所有字符被预处理程序自动替换到程序中，类似于文本处理中的搜索与替换。\n- \\#define 可以出现在程序程序任何地方，不必为开头；把定义放在头文件中可以方便在多个源文件中使用。\n- 从视觉上区分预定义的值和变量可以通过大写字母组合实现。\n- 预处理程序定义右边不必是合法`Objective-C`表达式。\n\n### 关于条件编译\n在调试程序时条件编译很有用。在程序中嵌入了NSLog调用可以用于显示中间结果并跟踪执行流程。程序中可能有很多这样的调试语句，且无论何时调试这个程序，都能够通过DEBUG使所有的调试语句都编译。\n\n```objc \n#ifdef DEBUG\n NSLog (@\"username = %@, password = %i\", username, password);\n #endif\n```\n\n### 关于分类\n#### 分类定义\n面对一个类定义时可能想要添加新的方法，如对于一个计算器类来说可能需要四则运算的方法，而该类当前只需要处理四则运算方面的功能，其他的创建和初始化交由其他方法来做，这个时候就可以用到分类的思想。\n分类提供简单的方式将类的定义模块划到相关方法的组或分类中，同时其提供了扩展现有类定义的简便方式，不必访问类的源代码，也不必创建子类。\n如对于一个假定的计算器的四则运算操作就可以创建如下分类。\n```objc \n@interface Calculator (MathOps)\n-(void) add: (double) value1 : (double) value2;\n-(void) subtract: (double) value1 : (double) value2;\n-(void) multiply: (double) value1 : (double) value2;\n-(void) divide: (double) value1 : (double) value2;\n@end\n```\n#### 分类注意\n分类可以覆写该类的另一个方法，但是覆写方法后无法访问原来的方法，所以正确的选择是创建子类。在子类中覆写方法可以通过super发送消息引用父类方法。\n通过使用分类添加新方法扩展类会影响当前类与其子类。\n### 关于协议与代理\n#### 协议要点\n协议是多个类共享的一个方法列表，协议中列出了一组方法，有些选择实现，有些必须实现。如`NSObject.h`中的部分协议定义。\n```objc \n@protocol NSCopying\n- (id)copyWithZone:(nullable NSZone *)zone;\n@end\n\n@protocol NSCoding\n- (void)encodeWithCoder:(NSCoder *)coder;\n- (nullable instancetype)initWithCoder:(NSCoder *)coder; // NS_DESIGNATED_INITIALIZER\n@end\n```\n如果类采用`NSCopying`和`NSCoding`协议，就必须实现`copyWithZone`等方法，使用方法如下。\n```objc \n@interface DemoPrototol: NSObject <NSCopying,NSCoding>\n```\n自定义协议时可以使用`@optional`指令表明列出的方法都是可选的，可以使用`required`指令标明必须实现的方法。\n#### 协议注意\n- 协议不引用任何类。\n- 可以使用conformsToProtocol:方法检查一个对象是否遵循某项协议。\n- 编译器只有在没有实现协议要求的方法时发出警告。\n- 与类名一样，协议名唯一。\n\n#### 代理要点\n\n定义了协议的类可以看作是将协议定义的方法代理给了实现它们的类。如iOS建立表格需使用UITableView类，需要代理定义UITableViewDataSource协议，如果协议需要信息就会调用类中实现协议的相关方法，开发者必须将其写入类中，与协议相匹配。协议中定义的其他方法是否实现决定权在开发者，即责任代理在开发者。\n- 如果一个对象采用正式协议，则它必须遵守协议中的所有信息。这可以在运行及编译时强制执行。\n- 如果一个对象采用非正式协议，则它可能不需要采用此协议的所有方法，具体取决于这项协议。\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n","slug":"Objc_Learning_3","published":1,"updated":"2022-07-24T15:20:38.050Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1x0016o76ffhdz8ik8","content":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第三篇文章，主要复习了数据类型、预处理、分类与协议等内容。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"关于初始化与变量\"><a href=\"#关于初始化与变量\" class=\"headerlink\" title=\"关于初始化与变量\"></a>关于初始化与变量</h3><h4 id=\"关于初始化\"><a href=\"#关于初始化\" class=\"headerlink\" title=\"关于初始化\"></a>关于初始化</h4><p>若在创建类的对象时需要使用和引用一个或多个实例变量，可以通过重载init方法达到目的。该方法首先调用父类初始化方法，使得继承实例变量正常初始化，因为初始化过程改变了对象在内存中的位置所以需要将父类init方法执行结果赋值给self。特殊类型instancetype表明,从init方法返回的类型与它的初始化类相同。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(instantype) init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span> = [ <span class=\"keyword\">super</span> init ];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"keyword\">self</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//do sth here</span></span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"关于-extern-与-static\"><a href=\"#关于-extern-与-static\" class=\"headerlink\" title=\"关于 extern 与 static\"></a>关于 extern 与 static</h4><ul>\n<li>声明不会引起变量存储空间分配，而定义会引起变量存储空间分配。</li>\n<li>如果有很多方法需要访问外部变量的值,应该只在文件的开始进行一次extern声明。</li>\n<li>如果只有一个或少数几个方法访问这个变量，应该在其中的每个方法中单独进行extern声明。</li>\n<li>如果变量定义在包含访问这个变量的文件中，不需要单独进行extern声明。</li>\n<li>static 变量声明在文件中的任何方法(或函数)之外，所有位于这条语句之后的方法或函数都可以访问其值，而其他文件中的方法和函数则不行。</li>\n<li>静态局部变量用关键字static声明，其值在函数调用的过程中保留下来，并且初始值默认为0。</li>\n</ul>\n<h3 id=\"关于预处理\"><a href=\"#关于预处理\" class=\"headerlink\" title=\"关于预处理\"></a>关于预处理</h3><ul>\n<li>预定义名称非变量不能为其赋值，其右边所有字符被预处理程序自动替换到程序中，类似于文本处理中的搜索与替换。</li>\n<li>#define 可以出现在程序程序任何地方，不必为开头；把定义放在头文件中可以方便在多个源文件中使用。</li>\n<li>从视觉上区分预定义的值和变量可以通过大写字母组合实现。</li>\n<li>预处理程序定义右边不必是合法<code>Objective-C</code>表达式。</li>\n</ul>\n<h3 id=\"关于条件编译\"><a href=\"#关于条件编译\" class=\"headerlink\" title=\"关于条件编译\"></a>关于条件编译</h3><p>在调试程序时条件编译很有用。在程序中嵌入了NSLog调用可以用于显示中间结果并跟踪执行流程。程序中可能有很多这样的调试语句，且无论何时调试这个程序，都能够通过DEBUG使所有的调试语句都编译。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> DEBUG</span></span><br><span class=\"line\"> <span class=\"built_in\">NSLog</span> (<span class=\"string\">@&quot;username = %@, password = %i&quot;</span>, username, password);</span><br><span class=\"line\"> <span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关于分类\"><a href=\"#关于分类\" class=\"headerlink\" title=\"关于分类\"></a>关于分类</h3><h4 id=\"分类定义\"><a href=\"#分类定义\" class=\"headerlink\" title=\"分类定义\"></a>分类定义</h4><p>面对一个类定义时可能想要添加新的方法，如对于一个计算器类来说可能需要四则运算的方法，而该类当前只需要处理四则运算方面的功能，其他的创建和初始化交由其他方法来做，这个时候就可以用到分类的思想。<br>分类提供简单的方式将类的定义模块划到相关方法的组或分类中，同时其提供了扩展现有类定义的简便方式，不必访问类的源代码，也不必创建子类。<br>如对于一个假定的计算器的四则运算操作就可以创建如下分类。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Calculator</span> (<span class=\"title\">MathOps</span>)</span></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) add: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) subtract: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) multiply: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) divide: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"分类注意\"><a href=\"#分类注意\" class=\"headerlink\" title=\"分类注意\"></a>分类注意</h4><p>分类可以覆写该类的另一个方法，但是覆写方法后无法访问原来的方法，所以正确的选择是创建子类。在子类中覆写方法可以通过super发送消息引用父类方法。<br>通过使用分类添加新方法扩展类会影响当前类与其子类。</p>\n<h3 id=\"关于协议与代理\"><a href=\"#关于协议与代理\" class=\"headerlink\" title=\"关于协议与代理\"></a>关于协议与代理</h3><h4 id=\"协议要点\"><a href=\"#协议要点\" class=\"headerlink\" title=\"协议要点\"></a>协议要点</h4><p>协议是多个类共享的一个方法列表，协议中列出了一组方法，有些选择实现，有些必须实现。如<code>NSObject.h</code>中的部分协议定义。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@protocol</span> <span class=\"title\">NSCopying</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">NSZone</span> *)zone;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@protocol</span> <span class=\"title\">NSCoding</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)encodeWithCoder:(<span class=\"built_in\">NSCoder</span> *)coder;</span><br><span class=\"line\">- (<span class=\"keyword\">nullable</span> <span class=\"keyword\">instancetype</span>)initWithCoder:(<span class=\"built_in\">NSCoder</span> *)coder; <span class=\"comment\">// NS_DESIGNATED_INITIALIZER</span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>如果类采用<code>NSCopying</code>和<code>NSCoding</code>协议，就必须实现<code>copyWithZone</code>等方法，使用方法如下。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">DemoPrototol</span>: <span class=\"title\">NSObject</span> &lt;<span class=\"title\">NSCopying</span>,<span class=\"title\">NSCoding</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>自定义协议时可以使用<code>@optional</code>指令表明列出的方法都是可选的，可以使用<code>required</code>指令标明必须实现的方法。</p>\n<h4 id=\"协议注意\"><a href=\"#协议注意\" class=\"headerlink\" title=\"协议注意\"></a>协议注意</h4><ul>\n<li>协议不引用任何类。</li>\n<li>可以使用conformsToProtocol:方法检查一个对象是否遵循某项协议。</li>\n<li>编译器只有在没有实现协议要求的方法时发出警告。</li>\n<li>与类名一样，协议名唯一。</li>\n</ul>\n<h4 id=\"代理要点\"><a href=\"#代理要点\" class=\"headerlink\" title=\"代理要点\"></a>代理要点</h4><p>定义了协议的类可以看作是将协议定义的方法代理给了实现它们的类。如iOS建立表格需使用UITableView类，需要代理定义UITableViewDataSource协议，如果协议需要信息就会调用类中实现协议的相关方法，开发者必须将其写入类中，与协议相匹配。协议中定义的其他方法是否实现决定权在开发者，即责任代理在开发者。</p>\n<ul>\n<li>如果一个对象采用正式协议，则它必须遵守协议中的所有信息。这可以在运行及编译时强制执行。</li>\n<li>如果一个对象采用非正式协议，则它可能不需要采用此协议的所有方法，具体取决于这项协议。</li>\n</ul>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第三篇文章，主要复习了数据类型、预处理、分类与协议等内容。</p>","more":"<h3 id=\"关于初始化与变量\"><a href=\"#关于初始化与变量\" class=\"headerlink\" title=\"关于初始化与变量\"></a>关于初始化与变量</h3><h4 id=\"关于初始化\"><a href=\"#关于初始化\" class=\"headerlink\" title=\"关于初始化\"></a>关于初始化</h4><p>若在创建类的对象时需要使用和引用一个或多个实例变量，可以通过重载init方法达到目的。该方法首先调用父类初始化方法，使得继承实例变量正常初始化，因为初始化过程改变了对象在内存中的位置所以需要将父类init方法执行结果赋值给self。特殊类型instancetype表明,从init方法返回的类型与它的初始化类相同。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(instantype) init &#123;</span><br><span class=\"line\">    <span class=\"keyword\">self</span> = [ <span class=\"keyword\">super</span> init ];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> ( <span class=\"keyword\">self</span> ) &#123;</span><br><span class=\"line\">    <span class=\"comment\">//do sth here</span></span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">self</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"关于-extern-与-static\"><a href=\"#关于-extern-与-static\" class=\"headerlink\" title=\"关于 extern 与 static\"></a>关于 extern 与 static</h4><ul>\n<li>声明不会引起变量存储空间分配，而定义会引起变量存储空间分配。</li>\n<li>如果有很多方法需要访问外部变量的值,应该只在文件的开始进行一次extern声明。</li>\n<li>如果只有一个或少数几个方法访问这个变量，应该在其中的每个方法中单独进行extern声明。</li>\n<li>如果变量定义在包含访问这个变量的文件中，不需要单独进行extern声明。</li>\n<li>static 变量声明在文件中的任何方法(或函数)之外，所有位于这条语句之后的方法或函数都可以访问其值，而其他文件中的方法和函数则不行。</li>\n<li>静态局部变量用关键字static声明，其值在函数调用的过程中保留下来，并且初始值默认为0。</li>\n</ul>\n<h3 id=\"关于预处理\"><a href=\"#关于预处理\" class=\"headerlink\" title=\"关于预处理\"></a>关于预处理</h3><ul>\n<li>预定义名称非变量不能为其赋值，其右边所有字符被预处理程序自动替换到程序中，类似于文本处理中的搜索与替换。</li>\n<li>#define 可以出现在程序程序任何地方，不必为开头；把定义放在头文件中可以方便在多个源文件中使用。</li>\n<li>从视觉上区分预定义的值和变量可以通过大写字母组合实现。</li>\n<li>预处理程序定义右边不必是合法<code>Objective-C</code>表达式。</li>\n</ul>\n<h3 id=\"关于条件编译\"><a href=\"#关于条件编译\" class=\"headerlink\" title=\"关于条件编译\"></a>关于条件编译</h3><p>在调试程序时条件编译很有用。在程序中嵌入了NSLog调用可以用于显示中间结果并跟踪执行流程。程序中可能有很多这样的调试语句，且无论何时调试这个程序，都能够通过DEBUG使所有的调试语句都编译。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">ifdef</span> DEBUG</span></span><br><span class=\"line\"> <span class=\"built_in\">NSLog</span> (<span class=\"string\">@&quot;username = %@, password = %i&quot;</span>, username, password);</span><br><span class=\"line\"> <span class=\"meta\">#<span class=\"meta-keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关于分类\"><a href=\"#关于分类\" class=\"headerlink\" title=\"关于分类\"></a>关于分类</h3><h4 id=\"分类定义\"><a href=\"#分类定义\" class=\"headerlink\" title=\"分类定义\"></a>分类定义</h4><p>面对一个类定义时可能想要添加新的方法，如对于一个计算器类来说可能需要四则运算的方法，而该类当前只需要处理四则运算方面的功能，其他的创建和初始化交由其他方法来做，这个时候就可以用到分类的思想。<br>分类提供简单的方式将类的定义模块划到相关方法的组或分类中，同时其提供了扩展现有类定义的简便方式，不必访问类的源代码，也不必创建子类。<br>如对于一个假定的计算器的四则运算操作就可以创建如下分类。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Calculator</span> (<span class=\"title\">MathOps</span>)</span></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) add: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) subtract: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) multiply: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) divide: (<span class=\"keyword\">double</span>) value1 : (<span class=\"keyword\">double</span>) value2;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<h4 id=\"分类注意\"><a href=\"#分类注意\" class=\"headerlink\" title=\"分类注意\"></a>分类注意</h4><p>分类可以覆写该类的另一个方法，但是覆写方法后无法访问原来的方法，所以正确的选择是创建子类。在子类中覆写方法可以通过super发送消息引用父类方法。<br>通过使用分类添加新方法扩展类会影响当前类与其子类。</p>\n<h3 id=\"关于协议与代理\"><a href=\"#关于协议与代理\" class=\"headerlink\" title=\"关于协议与代理\"></a>关于协议与代理</h3><h4 id=\"协议要点\"><a href=\"#协议要点\" class=\"headerlink\" title=\"协议要点\"></a>协议要点</h4><p>协议是多个类共享的一个方法列表，协议中列出了一组方法，有些选择实现，有些必须实现。如<code>NSObject.h</code>中的部分协议定义。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@protocol</span> <span class=\"title\">NSCopying</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">id</span>)copyWithZone:(<span class=\"keyword\">nullable</span> <span class=\"built_in\">NSZone</span> *)zone;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@protocol</span> <span class=\"title\">NSCoding</span></span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>)encodeWithCoder:(<span class=\"built_in\">NSCoder</span> *)coder;</span><br><span class=\"line\">- (<span class=\"keyword\">nullable</span> <span class=\"keyword\">instancetype</span>)initWithCoder:(<span class=\"built_in\">NSCoder</span> *)coder; <span class=\"comment\">// NS_DESIGNATED_INITIALIZER</span></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n<p>如果类采用<code>NSCopying</code>和<code>NSCoding</code>协议，就必须实现<code>copyWithZone</code>等方法，使用方法如下。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">DemoPrototol</span>: <span class=\"title\">NSObject</span> &lt;<span class=\"title\">NSCopying</span>,<span class=\"title\">NSCoding</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>自定义协议时可以使用<code>@optional</code>指令表明列出的方法都是可选的，可以使用<code>required</code>指令标明必须实现的方法。</p>\n<h4 id=\"协议注意\"><a href=\"#协议注意\" class=\"headerlink\" title=\"协议注意\"></a>协议注意</h4><ul>\n<li>协议不引用任何类。</li>\n<li>可以使用conformsToProtocol:方法检查一个对象是否遵循某项协议。</li>\n<li>编译器只有在没有实现协议要求的方法时发出警告。</li>\n<li>与类名一样，协议名唯一。</li>\n</ul>\n<h4 id=\"代理要点\"><a href=\"#代理要点\" class=\"headerlink\" title=\"代理要点\"></a>代理要点</h4><p>定义了协议的类可以看作是将协议定义的方法代理给了实现它们的类。如iOS建立表格需使用UITableView类，需要代理定义UITableViewDataSource协议，如果协议需要信息就会调用类中实现协议的相关方法，开发者必须将其写入类中，与协议相匹配。协议中定义的其他方法是否实现决定权在开发者，即责任代理在开发者。</p>\n<ul>\n<li>如果一个对象采用正式协议，则它必须遵守协议中的所有信息。这可以在运行及编译时强制执行。</li>\n<li>如果一个对象采用非正式协议，则它可能不需要采用此协议的所有方法，具体取决于这项协议。</li>\n</ul>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:38 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(三）","path":"2020/04/05/Objc_Learning_3/","eyeCatchImage":null,"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第三篇文章，主要复习了数据类型、预处理、分类与协议等内容。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-05T06:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-05T06:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":2293},{"title":"Objective-C 学习笔记(四）","date":"2020-04-11T07:43:20.000Z","copyright":true,"_content":"\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第四篇文章，主要复习了 `Objective-C`中C语言特性。\n\n<!--more-->\n\n### 关于C语言特性\n#### 关于数组\n`Objective-C`与C语言一样允许用户定义一组有序的数据项，即数组。其操作与C语言几乎完全一致，事实上无论是函数还是数组还是变量具备良好C基础的人都不会对此感到陌生。以下为最简单的使用数组的Fibonacci代码。\n```objc \n#import <Foundation/Foundation.h>\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        long Fibo [30];\n        Fibo [0] = 1;\n        Fibo [1] = 1;\n        \n        for (int i = 2; i < sizeof(Fibo)/sizeof(Fibo[0]); i++) {\n            Fibo [i] = Fibo [i-1] + Fibo [i-2];\n        }\n        \n        for (int i = 0; i < sizeof(Fibo)/sizeof(Fibo[0]); i++) {\n            NSLog(@\"The result of Fibonacci[%i] is %li\\n\",i,Fibo[i]);\n        }\n    }\n    return 0;\n}\n```\n\n#### 关于函数\n默认情况下，`Objective-C`语言编译器假设函数返回int,除非发生以下两种情况之一:\n- 在函数被调用之前，已经在程序中定义了该函数，\n- 在遇到函数调用之前，已经声明了该函数的返回值类型。\n调用函数或方法时，作为参数传递的值将被复制到相应的形参中。使用数组时，并非将整个数组的内容复制到形参数组中，而是传递一个指针，它表示数组所在的内存地址。所以对形参数组所做的所有更改实际上都是对原始数组而不是数组的副本执行的。因此，函数或方法返回时，这些变化仍然有效。\n\n#### 关于块\n- 块是对C语言的一种扩展。它并未作为标准ANSI C所定义的部分，而是由 Apple 添加。\n- 块看起来更像是函数，可以给块传递参数，块也具有返回值。\n- 块定义在函数或者方法内部，并能够访问在函数或者方法范围内、块之外的任何变量，这些变量能够访问但是并不能够改变这些变量。\n- 特殊的块修改器(由块前面含有两个下画线的字符组成)能够修改块内变量的值。\n- 块的其中一个优势在于能够让系统分配给其他处理器或应用的其他线程执行。\n以下为一个处理最小公倍数的简单块演示。\n\n```objc\nint (^gcd)(int,int)=\n^(int u,int v){\n    int temp;\n    while(v!= 0){\n        temp = u % v;\n        u = v;\n        v = temp;\n    }\n    return u;\n};\n```\n\n#### 关于数组指针\n要将valuesPtr设为指向数组values的第--个元素的指针，可以写成：\n\n```objc\nvaluesPtr = values;\n```\n因为Objective-C编译器将没有下标的数组名称看作是指向数组第一个元素的指针。所以，仅仅指明values而不带下标，其作用就是产生一个指向values第一个元素的指针。不需要用到地址运算符，要产生指向values首元素的指针，还有另一个等效方式，就是对数组第一个元素应用地址运算符，即\n\n```objc\nvaluesPtr = &values(0];\n```\n\n将数组values第一个元素的指针存放到指针变量valuesPtr中。此时通过\n\n```objc\nvaluesPtr += 1;\n```\n\n可以使其指向下一个元素，即values[1]。在`Objective-C`语言中，这是完全合法的表达式，并且可以用于指向任何数据类型的指针。同时比较两个指针变量的做法也是完全合法的。这在比较指向同一数组的两个指针时非常有用。比如测试指针valuesPtr的指向是否超出了包含有100个元素的数组的范围，方法是将它与指向数组最后一个元素的指针相比较。\n如果valuesPtr超出了数组values的最后元素，\n\n```objc\nvaluesPtr > &values [99]\n```\n\n的结果将为TRUE，反之，表达式的值为FALSE，也可将上面的表达式相应地改写为:\n\n```objc\nvaluesPtr > values + 99\n```\n\n在`Objective-C`语言中，两指针相减的结果是它们之间所包含的元素个数。这样，如果a是指向任意类型的元素数组，而b是指向同一数组中索引值更大的其他元素，那么表达式b-a \n代表的就是这两个指针之间的元素个数。\n\n#### 关于字符串指针\n在《Objective-C 程序设计 (第六版)》中给出了以下两段代码说明字符串指针的运用。\n\n```objc \n// 使用常规数组索引\nvoid copyString (char to[], char from[]){\n    int i;\n    \n    for( i = 0 ; from[i] != '\\0'; ++i)\n        to[i] = from [i];\n    \n    to[i] = '\\0';\n}\n```\n\n```objc \n// 使用指针数组\nvoid copystring (char *to， char *from){\n    for ( ; *from != '\\0'; ++from,++to ) \n        *to = *from;\n        \n    *to='0';\n}\n```\n\n很有意思的是，`Objective-C`语言中用到字符串就会产生指向该字符串的指针。学习过程中在程序中使用了字符串不是字符串对象，而是属于C风格的字符串，可以通过字符串的前面是否具有@字符进行区分。这两种类型不能互换。如果一个函数需要字符数组作为参数，可以将char类型的数组或c风格字符串传递给它，不能传递一个字符串对象。\n\n### 关于两种语言的联系\n1. 实例变量存储在结构中：对象实际上是结构\n2. 对象变量实际上是指针：将对象变量赋给另一个对象变量时，只是简单地复制了指针，最后都指向存储在内存中的同一结构\n3. 方法是函数，消息表达式是函数调用：调用方法是在调用与接收者类相关的函数。\n4. id类型是通用指针类型：通过指针来引用对象可以自由地将它们在id变量之间来回赋值。因此返回id类型值的方法只是返回指向内存中某对象的指针。\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n","source":"_posts/Objc_Learning_4.md","raw":"---\ntitle: Objective-C 学习笔记(四）\ndate: 2020-04-11 15:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第四篇文章，主要复习了 `Objective-C`中C语言特性。\n\n<!--more-->\n\n### 关于C语言特性\n#### 关于数组\n`Objective-C`与C语言一样允许用户定义一组有序的数据项，即数组。其操作与C语言几乎完全一致，事实上无论是函数还是数组还是变量具备良好C基础的人都不会对此感到陌生。以下为最简单的使用数组的Fibonacci代码。\n```objc \n#import <Foundation/Foundation.h>\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        long Fibo [30];\n        Fibo [0] = 1;\n        Fibo [1] = 1;\n        \n        for (int i = 2; i < sizeof(Fibo)/sizeof(Fibo[0]); i++) {\n            Fibo [i] = Fibo [i-1] + Fibo [i-2];\n        }\n        \n        for (int i = 0; i < sizeof(Fibo)/sizeof(Fibo[0]); i++) {\n            NSLog(@\"The result of Fibonacci[%i] is %li\\n\",i,Fibo[i]);\n        }\n    }\n    return 0;\n}\n```\n\n#### 关于函数\n默认情况下，`Objective-C`语言编译器假设函数返回int,除非发生以下两种情况之一:\n- 在函数被调用之前，已经在程序中定义了该函数，\n- 在遇到函数调用之前，已经声明了该函数的返回值类型。\n调用函数或方法时，作为参数传递的值将被复制到相应的形参中。使用数组时，并非将整个数组的内容复制到形参数组中，而是传递一个指针，它表示数组所在的内存地址。所以对形参数组所做的所有更改实际上都是对原始数组而不是数组的副本执行的。因此，函数或方法返回时，这些变化仍然有效。\n\n#### 关于块\n- 块是对C语言的一种扩展。它并未作为标准ANSI C所定义的部分，而是由 Apple 添加。\n- 块看起来更像是函数，可以给块传递参数，块也具有返回值。\n- 块定义在函数或者方法内部，并能够访问在函数或者方法范围内、块之外的任何变量，这些变量能够访问但是并不能够改变这些变量。\n- 特殊的块修改器(由块前面含有两个下画线的字符组成)能够修改块内变量的值。\n- 块的其中一个优势在于能够让系统分配给其他处理器或应用的其他线程执行。\n以下为一个处理最小公倍数的简单块演示。\n\n```objc\nint (^gcd)(int,int)=\n^(int u,int v){\n    int temp;\n    while(v!= 0){\n        temp = u % v;\n        u = v;\n        v = temp;\n    }\n    return u;\n};\n```\n\n#### 关于数组指针\n要将valuesPtr设为指向数组values的第--个元素的指针，可以写成：\n\n```objc\nvaluesPtr = values;\n```\n因为Objective-C编译器将没有下标的数组名称看作是指向数组第一个元素的指针。所以，仅仅指明values而不带下标，其作用就是产生一个指向values第一个元素的指针。不需要用到地址运算符，要产生指向values首元素的指针，还有另一个等效方式，就是对数组第一个元素应用地址运算符，即\n\n```objc\nvaluesPtr = &values(0];\n```\n\n将数组values第一个元素的指针存放到指针变量valuesPtr中。此时通过\n\n```objc\nvaluesPtr += 1;\n```\n\n可以使其指向下一个元素，即values[1]。在`Objective-C`语言中，这是完全合法的表达式，并且可以用于指向任何数据类型的指针。同时比较两个指针变量的做法也是完全合法的。这在比较指向同一数组的两个指针时非常有用。比如测试指针valuesPtr的指向是否超出了包含有100个元素的数组的范围，方法是将它与指向数组最后一个元素的指针相比较。\n如果valuesPtr超出了数组values的最后元素，\n\n```objc\nvaluesPtr > &values [99]\n```\n\n的结果将为TRUE，反之，表达式的值为FALSE，也可将上面的表达式相应地改写为:\n\n```objc\nvaluesPtr > values + 99\n```\n\n在`Objective-C`语言中，两指针相减的结果是它们之间所包含的元素个数。这样，如果a是指向任意类型的元素数组，而b是指向同一数组中索引值更大的其他元素，那么表达式b-a \n代表的就是这两个指针之间的元素个数。\n\n#### 关于字符串指针\n在《Objective-C 程序设计 (第六版)》中给出了以下两段代码说明字符串指针的运用。\n\n```objc \n// 使用常规数组索引\nvoid copyString (char to[], char from[]){\n    int i;\n    \n    for( i = 0 ; from[i] != '\\0'; ++i)\n        to[i] = from [i];\n    \n    to[i] = '\\0';\n}\n```\n\n```objc \n// 使用指针数组\nvoid copystring (char *to， char *from){\n    for ( ; *from != '\\0'; ++from,++to ) \n        *to = *from;\n        \n    *to='0';\n}\n```\n\n很有意思的是，`Objective-C`语言中用到字符串就会产生指向该字符串的指针。学习过程中在程序中使用了字符串不是字符串对象，而是属于C风格的字符串，可以通过字符串的前面是否具有@字符进行区分。这两种类型不能互换。如果一个函数需要字符数组作为参数，可以将char类型的数组或c风格字符串传递给它，不能传递一个字符串对象。\n\n### 关于两种语言的联系\n1. 实例变量存储在结构中：对象实际上是结构\n2. 对象变量实际上是指针：将对象变量赋给另一个对象变量时，只是简单地复制了指针，最后都指向存储在内存中的同一结构\n3. 方法是函数，消息表达式是函数调用：调用方法是在调用与接收者类相关的函数。\n4. id类型是通用指针类型：通过指针来引用对象可以自由地将它们在id变量之间来回赋值。因此返回id类型值的方法只是返回指向内存中某对象的指针。\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n","slug":"Objc_Learning_4","published":1,"updated":"2022-07-24T15:20:41.169Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1y0018o76fgj402cuc","content":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第四篇文章，主要复习了 <code>Objective-C</code>中C语言特性。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"关于C语言特性\"><a href=\"#关于C语言特性\" class=\"headerlink\" title=\"关于C语言特性\"></a>关于C语言特性</h3><h4 id=\"关于数组\"><a href=\"#关于数组\" class=\"headerlink\" title=\"关于数组\"></a>关于数组</h4><p><code>Objective-C</code>与C语言一样允许用户定义一组有序的数据项，即数组。其操作与C语言几乎完全一致，事实上无论是函数还是数组还是变量具备良好C基础的人都不会对此感到陌生。以下为最简单的使用数组的Fibonacci代码。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> Fibo [<span class=\"number\">30</span>];</span><br><span class=\"line\">        Fibo [<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        Fibo [<span class=\"number\">1</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &lt; <span class=\"keyword\">sizeof</span>(Fibo)/<span class=\"keyword\">sizeof</span>(Fibo[<span class=\"number\">0</span>]); i++) &#123;</span><br><span class=\"line\">            Fibo [i] = Fibo [i<span class=\"number\">-1</span>] + Fibo [i<span class=\"number\">-2</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">sizeof</span>(Fibo)/<span class=\"keyword\">sizeof</span>(Fibo[<span class=\"number\">0</span>]); i++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The result of Fibonacci[%i] is %li\\n&quot;</span>,i,Fibo[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"关于函数\"><a href=\"#关于函数\" class=\"headerlink\" title=\"关于函数\"></a>关于函数</h4><p>默认情况下，<code>Objective-C</code>语言编译器假设函数返回int,除非发生以下两种情况之一:</p>\n<ul>\n<li>在函数被调用之前，已经在程序中定义了该函数，</li>\n<li>在遇到函数调用之前，已经声明了该函数的返回值类型。<br>调用函数或方法时，作为参数传递的值将被复制到相应的形参中。使用数组时，并非将整个数组的内容复制到形参数组中，而是传递一个指针，它表示数组所在的内存地址。所以对形参数组所做的所有更改实际上都是对原始数组而不是数组的副本执行的。因此，函数或方法返回时，这些变化仍然有效。</li>\n</ul>\n<h4 id=\"关于块\"><a href=\"#关于块\" class=\"headerlink\" title=\"关于块\"></a>关于块</h4><ul>\n<li>块是对C语言的一种扩展。它并未作为标准ANSI C所定义的部分，而是由 Apple 添加。</li>\n<li>块看起来更像是函数，可以给块传递参数，块也具有返回值。</li>\n<li>块定义在函数或者方法内部，并能够访问在函数或者方法范围内、块之外的任何变量，这些变量能够访问但是并不能够改变这些变量。</li>\n<li>特殊的块修改器(由块前面含有两个下画线的字符组成)能够修改块内变量的值。</li>\n<li>块的其中一个优势在于能够让系统分配给其他处理器或应用的其他线程执行。<br>以下为一个处理最小公倍数的简单块演示。</li>\n</ul>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> (^gcd)(<span class=\"keyword\">int</span>,<span class=\"keyword\">int</span>)=</span><br><span class=\"line\">^(<span class=\"keyword\">int</span> u,<span class=\"keyword\">int</span> v)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(v!= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        temp = u % v;</span><br><span class=\"line\">        u = v;</span><br><span class=\"line\">        v = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> u;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"关于数组指针\"><a href=\"#关于数组指针\" class=\"headerlink\" title=\"关于数组指针\"></a>关于数组指针</h4><p>要将valuesPtr设为指向数组values的第–个元素的指针，可以写成：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr = values;</span><br></pre></td></tr></table></figure>\n<p>因为Objective-C编译器将没有下标的数组名称看作是指向数组第一个元素的指针。所以，仅仅指明values而不带下标，其作用就是产生一个指向values第一个元素的指针。不需要用到地址运算符，要产生指向values首元素的指针，还有另一个等效方式，就是对数组第一个元素应用地址运算符，即</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr = &amp;values(<span class=\"number\">0</span>];</span><br></pre></td></tr></table></figure>\n\n<p>将数组values第一个元素的指针存放到指针变量valuesPtr中。此时通过</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr += <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>可以使其指向下一个元素，即values[1]。在<code>Objective-C</code>语言中，这是完全合法的表达式，并且可以用于指向任何数据类型的指针。同时比较两个指针变量的做法也是完全合法的。这在比较指向同一数组的两个指针时非常有用。比如测试指针valuesPtr的指向是否超出了包含有100个元素的数组的范围，方法是将它与指向数组最后一个元素的指针相比较。<br>如果valuesPtr超出了数组values的最后元素，</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr &gt; &amp;values [<span class=\"number\">99</span>]</span><br></pre></td></tr></table></figure>\n\n<p>的结果将为TRUE，反之，表达式的值为FALSE，也可将上面的表达式相应地改写为:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr &gt; values + <span class=\"number\">99</span></span><br></pre></td></tr></table></figure>\n\n<p>在<code>Objective-C</code>语言中，两指针相减的结果是它们之间所包含的元素个数。这样，如果a是指向任意类型的元素数组，而b是指向同一数组中索引值更大的其他元素，那么表达式b-a<br>代表的就是这两个指针之间的元素个数。</p>\n<h4 id=\"关于字符串指针\"><a href=\"#关于字符串指针\" class=\"headerlink\" title=\"关于字符串指针\"></a>关于字符串指针</h4><p>在《Objective-C 程序设计 (第六版)》中给出了以下两段代码说明字符串指针的运用。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用常规数组索引</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> copyString (<span class=\"keyword\">char</span> to[], <span class=\"keyword\">char</span> from[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span>( i = <span class=\"number\">0</span> ; from[i] != <span class=\"string\">&#x27;\\0&#x27;</span>; ++i)</span><br><span class=\"line\">        to[i] = from [i];</span><br><span class=\"line\">    </span><br><span class=\"line\">    to[i] = <span class=\"string\">&#x27;\\0&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用指针数组</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> copystring (<span class=\"keyword\">char</span> *to， <span class=\"keyword\">char</span> *from)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( ; *from != <span class=\"string\">&#x27;\\0&#x27;</span>; ++from,++to ) </span><br><span class=\"line\">        *to = *from;</span><br><span class=\"line\">        </span><br><span class=\"line\">    *to=<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>很有意思的是，<code>Objective-C</code>语言中用到字符串就会产生指向该字符串的指针。学习过程中在程序中使用了字符串不是字符串对象，而是属于C风格的字符串，可以通过字符串的前面是否具有@字符进行区分。这两种类型不能互换。如果一个函数需要字符数组作为参数，可以将char类型的数组或c风格字符串传递给它，不能传递一个字符串对象。</p>\n<h3 id=\"关于两种语言的联系\"><a href=\"#关于两种语言的联系\" class=\"headerlink\" title=\"关于两种语言的联系\"></a>关于两种语言的联系</h3><ol>\n<li>实例变量存储在结构中：对象实际上是结构</li>\n<li>对象变量实际上是指针：将对象变量赋给另一个对象变量时，只是简单地复制了指针，最后都指向存储在内存中的同一结构</li>\n<li>方法是函数，消息表达式是函数调用：调用方法是在调用与接收者类相关的函数。</li>\n<li>id类型是通用指针类型：通过指针来引用对象可以自由地将它们在id变量之间来回赋值。因此返回id类型值的方法只是返回指向内存中某对象的指针。</li>\n</ol>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第四篇文章，主要复习了 <code>Objective-C</code>中C语言特性。</p>","more":"<h3 id=\"关于C语言特性\"><a href=\"#关于C语言特性\" class=\"headerlink\" title=\"关于C语言特性\"></a>关于C语言特性</h3><h4 id=\"关于数组\"><a href=\"#关于数组\" class=\"headerlink\" title=\"关于数组\"></a>关于数组</h4><p><code>Objective-C</code>与C语言一样允许用户定义一组有序的数据项，即数组。其操作与C语言几乎完全一致，事实上无论是函数还是数组还是变量具备良好C基础的人都不会对此感到陌生。以下为最简单的使用数组的Fibonacci代码。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">long</span> Fibo [<span class=\"number\">30</span>];</span><br><span class=\"line\">        Fibo [<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        Fibo [<span class=\"number\">1</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">2</span>; i &lt; <span class=\"keyword\">sizeof</span>(Fibo)/<span class=\"keyword\">sizeof</span>(Fibo[<span class=\"number\">0</span>]); i++) &#123;</span><br><span class=\"line\">            Fibo [i] = Fibo [i<span class=\"number\">-1</span>] + Fibo [i<span class=\"number\">-2</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"keyword\">int</span> i = <span class=\"number\">0</span>; i &lt; <span class=\"keyword\">sizeof</span>(Fibo)/<span class=\"keyword\">sizeof</span>(Fibo[<span class=\"number\">0</span>]); i++) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The result of Fibonacci[%i] is %li\\n&quot;</span>,i,Fibo[i]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"关于函数\"><a href=\"#关于函数\" class=\"headerlink\" title=\"关于函数\"></a>关于函数</h4><p>默认情况下，<code>Objective-C</code>语言编译器假设函数返回int,除非发生以下两种情况之一:</p>\n<ul>\n<li>在函数被调用之前，已经在程序中定义了该函数，</li>\n<li>在遇到函数调用之前，已经声明了该函数的返回值类型。<br>调用函数或方法时，作为参数传递的值将被复制到相应的形参中。使用数组时，并非将整个数组的内容复制到形参数组中，而是传递一个指针，它表示数组所在的内存地址。所以对形参数组所做的所有更改实际上都是对原始数组而不是数组的副本执行的。因此，函数或方法返回时，这些变化仍然有效。</li>\n</ul>\n<h4 id=\"关于块\"><a href=\"#关于块\" class=\"headerlink\" title=\"关于块\"></a>关于块</h4><ul>\n<li>块是对C语言的一种扩展。它并未作为标准ANSI C所定义的部分，而是由 Apple 添加。</li>\n<li>块看起来更像是函数，可以给块传递参数，块也具有返回值。</li>\n<li>块定义在函数或者方法内部，并能够访问在函数或者方法范围内、块之外的任何变量，这些变量能够访问但是并不能够改变这些变量。</li>\n<li>特殊的块修改器(由块前面含有两个下画线的字符组成)能够修改块内变量的值。</li>\n<li>块的其中一个优势在于能够让系统分配给其他处理器或应用的其他线程执行。<br>以下为一个处理最小公倍数的简单块演示。</li>\n</ul>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">int</span> (^gcd)(<span class=\"keyword\">int</span>,<span class=\"keyword\">int</span>)=</span><br><span class=\"line\">^(<span class=\"keyword\">int</span> u,<span class=\"keyword\">int</span> v)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> temp;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(v!= <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">        temp = u % v;</span><br><span class=\"line\">        u = v;</span><br><span class=\"line\">        v = temp;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> u;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"关于数组指针\"><a href=\"#关于数组指针\" class=\"headerlink\" title=\"关于数组指针\"></a>关于数组指针</h4><p>要将valuesPtr设为指向数组values的第–个元素的指针，可以写成：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr = values;</span><br></pre></td></tr></table></figure>\n<p>因为Objective-C编译器将没有下标的数组名称看作是指向数组第一个元素的指针。所以，仅仅指明values而不带下标，其作用就是产生一个指向values第一个元素的指针。不需要用到地址运算符，要产生指向values首元素的指针，还有另一个等效方式，就是对数组第一个元素应用地址运算符，即</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr = &amp;values(<span class=\"number\">0</span>];</span><br></pre></td></tr></table></figure>\n\n<p>将数组values第一个元素的指针存放到指针变量valuesPtr中。此时通过</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr += <span class=\"number\">1</span>;</span><br></pre></td></tr></table></figure>\n\n<p>可以使其指向下一个元素，即values[1]。在<code>Objective-C</code>语言中，这是完全合法的表达式，并且可以用于指向任何数据类型的指针。同时比较两个指针变量的做法也是完全合法的。这在比较指向同一数组的两个指针时非常有用。比如测试指针valuesPtr的指向是否超出了包含有100个元素的数组的范围，方法是将它与指向数组最后一个元素的指针相比较。<br>如果valuesPtr超出了数组values的最后元素，</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr &gt; &amp;values [<span class=\"number\">99</span>]</span><br></pre></td></tr></table></figure>\n\n<p>的结果将为TRUE，反之，表达式的值为FALSE，也可将上面的表达式相应地改写为:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">valuesPtr &gt; values + <span class=\"number\">99</span></span><br></pre></td></tr></table></figure>\n\n<p>在<code>Objective-C</code>语言中，两指针相减的结果是它们之间所包含的元素个数。这样，如果a是指向任意类型的元素数组，而b是指向同一数组中索引值更大的其他元素，那么表达式b-a<br>代表的就是这两个指针之间的元素个数。</p>\n<h4 id=\"关于字符串指针\"><a href=\"#关于字符串指针\" class=\"headerlink\" title=\"关于字符串指针\"></a>关于字符串指针</h4><p>在《Objective-C 程序设计 (第六版)》中给出了以下两段代码说明字符串指针的运用。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用常规数组索引</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> copyString (<span class=\"keyword\">char</span> to[], <span class=\"keyword\">char</span> from[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span>( i = <span class=\"number\">0</span> ; from[i] != <span class=\"string\">&#x27;\\0&#x27;</span>; ++i)</span><br><span class=\"line\">        to[i] = from [i];</span><br><span class=\"line\">    </span><br><span class=\"line\">    to[i] = <span class=\"string\">&#x27;\\0&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用指针数组</span></span><br><span class=\"line\"><span class=\"keyword\">void</span> copystring (<span class=\"keyword\">char</span> *to， <span class=\"keyword\">char</span> *from)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ( ; *from != <span class=\"string\">&#x27;\\0&#x27;</span>; ++from,++to ) </span><br><span class=\"line\">        *to = *from;</span><br><span class=\"line\">        </span><br><span class=\"line\">    *to=<span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>很有意思的是，<code>Objective-C</code>语言中用到字符串就会产生指向该字符串的指针。学习过程中在程序中使用了字符串不是字符串对象，而是属于C风格的字符串，可以通过字符串的前面是否具有@字符进行区分。这两种类型不能互换。如果一个函数需要字符数组作为参数，可以将char类型的数组或c风格字符串传递给它，不能传递一个字符串对象。</p>\n<h3 id=\"关于两种语言的联系\"><a href=\"#关于两种语言的联系\" class=\"headerlink\" title=\"关于两种语言的联系\"></a>关于两种语言的联系</h3><ol>\n<li>实例变量存储在结构中：对象实际上是结构</li>\n<li>对象变量实际上是指针：将对象变量赋给另一个对象变量时，只是简单地复制了指针，最后都指向存储在内存中的同一结构</li>\n<li>方法是函数，消息表达式是函数调用：调用方法是在调用与接收者类相关的函数。</li>\n<li>id类型是通用指针类型：通过指针来引用对象可以自由地将它们在id变量之间来回赋值。因此返回id类型值的方法只是返回指向内存中某对象的指针。</li>\n</ol>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:41 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(四）","path":"2020/04/11/Objc_Learning_4/","eyeCatchImage":null,"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第四篇文章，主要复习了 <code>Objective-C</code>中C语言特性。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-11T07:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-11T07:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":2520},{"title":"Objective-C 学习笔记(五）","date":"2020-04-13T14:43:20.000Z","copyright":true,"_content":"\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第五篇文章，主要复习了 `Objective-C` Foundation 框架中关于数字对象、字符串对象以及数组对象的内容。\n\n<!--more-->\n\n### 关于数字对象\n无论是int 型、float 型和long型都是`Objective-C`语言中的基本数据类型,它们都不是对象，不能够向它们发送消息，然而有时需要将这些值作为对象使用。如不能将任何基本数据类型直接存储到数组中，使用Foundation的NSArray对象创建一个数组时，它要求存储的值必须是对象。\n\n**NSInteger**\nNSInteger不是一个对象，是基本数据类型的typedef。\n\n Apple 官方 Foundation 文档解释的很清楚：\n\n> When building 32-bit applications, NSInteger is a 32-bit integer. A 64-bit application treats NSInteger as a 64-bit integer.\n\n> Apple use NSInteger (or NSUInteger) when passing a value as an argument to a function or returning a value from a function.\n\n鉴于目前 iOS 设备全部迈向64位架构，可以理解成 NSInteger 是64位的 long 类型。而 NSUInteger 也是类似于 NSInteger 的typedef。\n\n\n**int**\nint 类型的使用主要体现在循环的控制上，控制循环语句无需考虑平台依赖，在大部分情况下16-bit 大小的 int 即可胜任此项工作。 NSInteger 可以作为函数的返回值或者是函数参数，至于使用 NSInteger 还是 int 决定权仍然在你需要解决的问题上。\n\n**NSNumber**\nNSNumber 是`Objective-C`的类，具体来说是 NSValue 的子类。如果需要存储基本数据类型（包括 signed 或 unsigned char类型和BOOL类型），可以使用 NSNumber 对其进行包装来满足需求，NSNumber 会根据数据的类型创建对象。在集合中也会使用到 NSNumber，如NSSArray、NSSet，因为这些需要对象参与。\n下图摘录了为 NSNumber 对象设值的类和实例方法以及获取这些数值的实例方法。\n\n![](http://image.stephenfang.me/mweb/15867486542169.jpg)\n\n#### 简单示例\n给出一个简单的测试示例。\n```objc \n#import <Foundation/Foundation.h>\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        NSNumber *intNum, *floatNum, *charNum, *doubleNum;\n        NSInteger integerNum;\n        \n        intNum = [NSNumber numberWithInteger:20];\n        integerNum = [intNum integerValue];\n        NSLog(@\"%li\",(long)integerNum);\n        \n        floatNum = [NSNumber numberWithFloat:20.5];\n        NSLog(@\"%f\",[floatNum floatValue]);\n        \n        charNum = [NSNumber numberWithChar:'X'];\n        NSLog(@\"%c\",[charNum charValue]);\n        \n        doubleNum = @20.5;\n        NSLog(@\"%lf\",[doubleNum doubleValue]);\n        \n        if([doubleNum isEqualToNumber:floatNum] == YES){\n            NSLog(@\"doubleNum is equal to number floatNum\");\n        }else{\n             NSLog(@\"doubleNum is not equal to number floatNum\");\n        }\n        \n        if([floatNum compare:intNum] == NSOrderedDescending){\n            NSLog(@\"intNum is less than floatNum\");\n        }\n    }\n    return 0;\n}\n```\n\n#### 示例解释\n一般来说，需要确保使用正确的方式获取对象的值，如果在NSNumber对象中存储了一个值，那么也需要用一致的方式去获取。同时，`Objective-C`语言扩展允许通过@表达式创建数字对象.\n\n方法 numberWithInt: 和 numberWithInteger: 在使用存在差别\n1. 使用 numberWithInt: 方法创建一个整型数,需要使用intValue获取值，使用%i作为格式化字符串显示它的值。\n2. 使用 numberWithInteger: 方法创建一个整型数,需要使用integerValue获取值，也可以转换成 long 显示或者使用 stringWithFormat: 将其格式化成字符串。使用%li作为格式化字符串。\n\n#### 关于NSLog\n在NSLog中，格式字符`%@`不仅可以显示 NSString 对象，而且可以显示数组、字典和集合的全部内容。对于数组中的每一个元素,NSLog 将使用属于每个元素类的 description 方法。如果使用的是从 NSObject 对象继承的默认方法,获取到的是对象的类和地址。然而,通过覆盖继承的 description 方法可使用这些格式字符显示自定义类对象。\n\n### 关于字符串对象\nFoundation 框架支持 NSString类用于处理字符串对象。C 样式的字符串 char 字符组成，NSString 对象由 unichar 字符组成。unichar 字符是符合 Unicode 标准的多字节字符。NSString 类能够自动处理字符串的内部表示。使用 NSString 类的方法更容易开发出具有本地化的应用程序，并且能够在不同的语言环境下使用。\n\nNSMutableString 类是 NSString 类的子类，可以用来创建可以更改字符的字符串对象，它可以使用 NSString 类所有方法。摘录常见 NSMutableString 方法\n![](http://image.stephenfang.me/mweb/15867813113647.jpg)\n\n#### 简单示例\n给出一个简单的测试示例。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        NSString *str1 = @\"This is str1\";\n        NSString *str2 = @\"This is str2\";\n        NSString *subStr;\n        NSMutableString *mutStr;\n        NSRange subRange;\n        \n        subStr = [str1 substringToIndex:3];\n        NSLog(@\"%@\",subStr);\n        \n        subStr = [str1 substringFromIndex:3];\n        NSLog(@\"%@\",subStr);\n        \n        subStr = [[str1 substringFromIndex:3]substringToIndex:5];\n        NSLog(@\"%@\",subStr);\n        \n        subStr = [str1 substringWithRange:NSMakeRange(3, 5)];\n        NSLog(@\"%@\",subStr);\n        \n        subRange = [str2 rangeOfString:@\"str2\"];\n        NSLog(@\"index: %lu length: %lu\",(unsigned long)subRange.location,(unsigned long)subRange.length);\n        \n        subRange = [str1 rangeOfString:@\"str2\"];\n        if (subRange.location == NSNotFound){\n            NSLog(@\"String not found\");\n        }else{\n            NSLog(@\"index: %lu length: %lu\",(unsigned long)subRange.location,(unsigned long)subRange.length);\n        }\n        \n        mutStr = [NSMutableString stringWithString:str1];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr insertString:mutStr atIndex:[mutStr length]];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr deleteCharactersInRange:NSMakeRange([mutStr length]/2, [mutStr length]/2)];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr appendString:mutStr];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr replaceCharactersInRange:NSMakeRange([mutStr length]/2, [mutStr length]/2) withString:str2];\n        NSLog(@\"%@\",mutStr);\n        \n        subRange = [mutStr rangeOfString: @\"This is\"];\n        if (subRange.location != NSNotFound) {\n        [mutStr replaceCharactersInRange:subRange withString: @\"it is\"] ;\n        NSLog(@\"%@\",mutStr) ;\n        }\n    }\n    return 0;\n}\n```\n\n运行结果为\n```log\n2020-04-13 18:21:20.795845+0800 DemoProgram[49815:1823615] Thi\n2020-04-13 18:21:20.796235+0800 DemoProgram[49815:1823615] s is str1\n2020-04-13 18:21:20.796281+0800 DemoProgram[49815:1823615] s is\n2020-04-13 18:21:20.796305+0800 DemoProgram[49815:1823615] s is\n2020-04-13 18:21:20.796331+0800 DemoProgram[49815:1823615] index: 8 length: 4\n2020-04-13 18:21:20.796353+0800 DemoProgram[49815:1823615] String not found\n2020-04-13 18:21:20.796395+0800 DemoProgram[49815:1823615] This is str1\n2020-04-13 18:21:20.796432+0800 DemoProgram[49815:1823615] This is str1This is str1\n2020-04-13 18:21:20.796453+0800 DemoProgram[49815:1823615] This is str1\n2020-04-13 18:21:20.796472+0800 DemoProgram[49815:1823615] This is str1This is str1\n2020-04-13 18:21:20.796498+0800 DemoProgram[49815:1823615] This is str1This is str2\n2020-04-13 18:21:20.796520+0800 DemoProgram[49815:1823615] it is str1This is str2\nProgram ended with exit code: 0\n```\n\n### 关于数组对象\nFoundation数组是有序的对象集合。不可变数组由 NSArray 类处理的，而可变数组由NSMutableArray 处理的。后者是前者的子类，即后者继承了前者的方法。\n\n其中\n```objc\nNSArray *monthNames = [NSArray arrayWithObjects :@\"January\", @\"February\", @\"March\", @\"April\", @\"May\", \"June\", @\"July\", @\"August\", @\"September\", @\"October\", @\"November\", @\"December\", nil ];\n```\n与如下方式相同。\n```objc\nNSArray *monthNames = @[@\"January\", @\"February\", @\"March\", @\"April\", @\"May\",@\"June\", @\"July\", @\"August\", @\"September\", @\"October\", @\"November\" ,@\"December\"];\n```\n而\n```objc\narray[index]\n```\n相当于如下表达式\n```objc\n[array objectAtIndex: index]\n```\n同时\n```objc\narray[index] = object\n```\n相当于如下表达式\n```objc\n[array setObject: object forIndex: index]\n```\n下一节会参照书本给的样例进行编写。\n\n### 参考\n[int vs. NSInteger vs. NSNumber](http://monkey-oyster.blogspot.com/2014/10/int-vs-nsinteger-vs-nsnumber.html)\n[Why use int at all?-Stack overflow](https://stackoverflow.com/questions/4445173/when-to-use-nsinteger-vs-int/5320359#5320359)\n[Objective-C 程序设计 (第六版)]()","source":"_posts/Objc_Learning_5.md","raw":"---\ntitle: Objective-C 学习笔记(五）\ndate: 2020-04-13 22:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第五篇文章，主要复习了 `Objective-C` Foundation 框架中关于数字对象、字符串对象以及数组对象的内容。\n\n<!--more-->\n\n### 关于数字对象\n无论是int 型、float 型和long型都是`Objective-C`语言中的基本数据类型,它们都不是对象，不能够向它们发送消息，然而有时需要将这些值作为对象使用。如不能将任何基本数据类型直接存储到数组中，使用Foundation的NSArray对象创建一个数组时，它要求存储的值必须是对象。\n\n**NSInteger**\nNSInteger不是一个对象，是基本数据类型的typedef。\n\n Apple 官方 Foundation 文档解释的很清楚：\n\n> When building 32-bit applications, NSInteger is a 32-bit integer. A 64-bit application treats NSInteger as a 64-bit integer.\n\n> Apple use NSInteger (or NSUInteger) when passing a value as an argument to a function or returning a value from a function.\n\n鉴于目前 iOS 设备全部迈向64位架构，可以理解成 NSInteger 是64位的 long 类型。而 NSUInteger 也是类似于 NSInteger 的typedef。\n\n\n**int**\nint 类型的使用主要体现在循环的控制上，控制循环语句无需考虑平台依赖，在大部分情况下16-bit 大小的 int 即可胜任此项工作。 NSInteger 可以作为函数的返回值或者是函数参数，至于使用 NSInteger 还是 int 决定权仍然在你需要解决的问题上。\n\n**NSNumber**\nNSNumber 是`Objective-C`的类，具体来说是 NSValue 的子类。如果需要存储基本数据类型（包括 signed 或 unsigned char类型和BOOL类型），可以使用 NSNumber 对其进行包装来满足需求，NSNumber 会根据数据的类型创建对象。在集合中也会使用到 NSNumber，如NSSArray、NSSet，因为这些需要对象参与。\n下图摘录了为 NSNumber 对象设值的类和实例方法以及获取这些数值的实例方法。\n\n![](http://image.stephenfang.me/mweb/15867486542169.jpg)\n\n#### 简单示例\n给出一个简单的测试示例。\n```objc \n#import <Foundation/Foundation.h>\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        NSNumber *intNum, *floatNum, *charNum, *doubleNum;\n        NSInteger integerNum;\n        \n        intNum = [NSNumber numberWithInteger:20];\n        integerNum = [intNum integerValue];\n        NSLog(@\"%li\",(long)integerNum);\n        \n        floatNum = [NSNumber numberWithFloat:20.5];\n        NSLog(@\"%f\",[floatNum floatValue]);\n        \n        charNum = [NSNumber numberWithChar:'X'];\n        NSLog(@\"%c\",[charNum charValue]);\n        \n        doubleNum = @20.5;\n        NSLog(@\"%lf\",[doubleNum doubleValue]);\n        \n        if([doubleNum isEqualToNumber:floatNum] == YES){\n            NSLog(@\"doubleNum is equal to number floatNum\");\n        }else{\n             NSLog(@\"doubleNum is not equal to number floatNum\");\n        }\n        \n        if([floatNum compare:intNum] == NSOrderedDescending){\n            NSLog(@\"intNum is less than floatNum\");\n        }\n    }\n    return 0;\n}\n```\n\n#### 示例解释\n一般来说，需要确保使用正确的方式获取对象的值，如果在NSNumber对象中存储了一个值，那么也需要用一致的方式去获取。同时，`Objective-C`语言扩展允许通过@表达式创建数字对象.\n\n方法 numberWithInt: 和 numberWithInteger: 在使用存在差别\n1. 使用 numberWithInt: 方法创建一个整型数,需要使用intValue获取值，使用%i作为格式化字符串显示它的值。\n2. 使用 numberWithInteger: 方法创建一个整型数,需要使用integerValue获取值，也可以转换成 long 显示或者使用 stringWithFormat: 将其格式化成字符串。使用%li作为格式化字符串。\n\n#### 关于NSLog\n在NSLog中，格式字符`%@`不仅可以显示 NSString 对象，而且可以显示数组、字典和集合的全部内容。对于数组中的每一个元素,NSLog 将使用属于每个元素类的 description 方法。如果使用的是从 NSObject 对象继承的默认方法,获取到的是对象的类和地址。然而,通过覆盖继承的 description 方法可使用这些格式字符显示自定义类对象。\n\n### 关于字符串对象\nFoundation 框架支持 NSString类用于处理字符串对象。C 样式的字符串 char 字符组成，NSString 对象由 unichar 字符组成。unichar 字符是符合 Unicode 标准的多字节字符。NSString 类能够自动处理字符串的内部表示。使用 NSString 类的方法更容易开发出具有本地化的应用程序，并且能够在不同的语言环境下使用。\n\nNSMutableString 类是 NSString 类的子类，可以用来创建可以更改字符的字符串对象，它可以使用 NSString 类所有方法。摘录常见 NSMutableString 方法\n![](http://image.stephenfang.me/mweb/15867813113647.jpg)\n\n#### 简单示例\n给出一个简单的测试示例。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char* argv[]){\n    @autoreleasepool {\n        NSString *str1 = @\"This is str1\";\n        NSString *str2 = @\"This is str2\";\n        NSString *subStr;\n        NSMutableString *mutStr;\n        NSRange subRange;\n        \n        subStr = [str1 substringToIndex:3];\n        NSLog(@\"%@\",subStr);\n        \n        subStr = [str1 substringFromIndex:3];\n        NSLog(@\"%@\",subStr);\n        \n        subStr = [[str1 substringFromIndex:3]substringToIndex:5];\n        NSLog(@\"%@\",subStr);\n        \n        subStr = [str1 substringWithRange:NSMakeRange(3, 5)];\n        NSLog(@\"%@\",subStr);\n        \n        subRange = [str2 rangeOfString:@\"str2\"];\n        NSLog(@\"index: %lu length: %lu\",(unsigned long)subRange.location,(unsigned long)subRange.length);\n        \n        subRange = [str1 rangeOfString:@\"str2\"];\n        if (subRange.location == NSNotFound){\n            NSLog(@\"String not found\");\n        }else{\n            NSLog(@\"index: %lu length: %lu\",(unsigned long)subRange.location,(unsigned long)subRange.length);\n        }\n        \n        mutStr = [NSMutableString stringWithString:str1];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr insertString:mutStr atIndex:[mutStr length]];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr deleteCharactersInRange:NSMakeRange([mutStr length]/2, [mutStr length]/2)];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr appendString:mutStr];\n        NSLog(@\"%@\",mutStr);\n        \n        [mutStr replaceCharactersInRange:NSMakeRange([mutStr length]/2, [mutStr length]/2) withString:str2];\n        NSLog(@\"%@\",mutStr);\n        \n        subRange = [mutStr rangeOfString: @\"This is\"];\n        if (subRange.location != NSNotFound) {\n        [mutStr replaceCharactersInRange:subRange withString: @\"it is\"] ;\n        NSLog(@\"%@\",mutStr) ;\n        }\n    }\n    return 0;\n}\n```\n\n运行结果为\n```log\n2020-04-13 18:21:20.795845+0800 DemoProgram[49815:1823615] Thi\n2020-04-13 18:21:20.796235+0800 DemoProgram[49815:1823615] s is str1\n2020-04-13 18:21:20.796281+0800 DemoProgram[49815:1823615] s is\n2020-04-13 18:21:20.796305+0800 DemoProgram[49815:1823615] s is\n2020-04-13 18:21:20.796331+0800 DemoProgram[49815:1823615] index: 8 length: 4\n2020-04-13 18:21:20.796353+0800 DemoProgram[49815:1823615] String not found\n2020-04-13 18:21:20.796395+0800 DemoProgram[49815:1823615] This is str1\n2020-04-13 18:21:20.796432+0800 DemoProgram[49815:1823615] This is str1This is str1\n2020-04-13 18:21:20.796453+0800 DemoProgram[49815:1823615] This is str1\n2020-04-13 18:21:20.796472+0800 DemoProgram[49815:1823615] This is str1This is str1\n2020-04-13 18:21:20.796498+0800 DemoProgram[49815:1823615] This is str1This is str2\n2020-04-13 18:21:20.796520+0800 DemoProgram[49815:1823615] it is str1This is str2\nProgram ended with exit code: 0\n```\n\n### 关于数组对象\nFoundation数组是有序的对象集合。不可变数组由 NSArray 类处理的，而可变数组由NSMutableArray 处理的。后者是前者的子类，即后者继承了前者的方法。\n\n其中\n```objc\nNSArray *monthNames = [NSArray arrayWithObjects :@\"January\", @\"February\", @\"March\", @\"April\", @\"May\", \"June\", @\"July\", @\"August\", @\"September\", @\"October\", @\"November\", @\"December\", nil ];\n```\n与如下方式相同。\n```objc\nNSArray *monthNames = @[@\"January\", @\"February\", @\"March\", @\"April\", @\"May\",@\"June\", @\"July\", @\"August\", @\"September\", @\"October\", @\"November\" ,@\"December\"];\n```\n而\n```objc\narray[index]\n```\n相当于如下表达式\n```objc\n[array objectAtIndex: index]\n```\n同时\n```objc\narray[index] = object\n```\n相当于如下表达式\n```objc\n[array setObject: object forIndex: index]\n```\n下一节会参照书本给的样例进行编写。\n\n### 参考\n[int vs. NSInteger vs. NSNumber](http://monkey-oyster.blogspot.com/2014/10/int-vs-nsinteger-vs-nsnumber.html)\n[Why use int at all?-Stack overflow](https://stackoverflow.com/questions/4445173/when-to-use-nsinteger-vs-int/5320359#5320359)\n[Objective-C 程序设计 (第六版)]()","slug":"Objc_Learning_5","published":1,"updated":"2022-07-24T15:20:46.197Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1z001bo76f8cft4r7t","content":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第五篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中关于数字对象、字符串对象以及数组对象的内容。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"关于数字对象\"><a href=\"#关于数字对象\" class=\"headerlink\" title=\"关于数字对象\"></a>关于数字对象</h3><p>无论是int 型、float 型和long型都是<code>Objective-C</code>语言中的基本数据类型,它们都不是对象，不能够向它们发送消息，然而有时需要将这些值作为对象使用。如不能将任何基本数据类型直接存储到数组中，使用Foundation的NSArray对象创建一个数组时，它要求存储的值必须是对象。</p>\n<p><strong>NSInteger</strong><br>NSInteger不是一个对象，是基本数据类型的typedef。</p>\n<p> Apple 官方 Foundation 文档解释的很清楚：</p>\n<blockquote>\n<p>When building 32-bit applications, NSInteger is a 32-bit integer. A 64-bit application treats NSInteger as a 64-bit integer.</p>\n</blockquote>\n<blockquote>\n<p>Apple use NSInteger (or NSUInteger) when passing a value as an argument to a function or returning a value from a function.</p>\n</blockquote>\n<p>鉴于目前 iOS 设备全部迈向64位架构，可以理解成 NSInteger 是64位的 long 类型。而 NSUInteger 也是类似于 NSInteger 的typedef。</p>\n<p><strong>int</strong><br>int 类型的使用主要体现在循环的控制上，控制循环语句无需考虑平台依赖，在大部分情况下16-bit 大小的 int 即可胜任此项工作。 NSInteger 可以作为函数的返回值或者是函数参数，至于使用 NSInteger 还是 int 决定权仍然在你需要解决的问题上。</p>\n<p><strong>NSNumber</strong><br>NSNumber 是<code>Objective-C</code>的类，具体来说是 NSValue 的子类。如果需要存储基本数据类型（包括 signed 或 unsigned char类型和BOOL类型），可以使用 NSNumber 对其进行包装来满足需求，NSNumber 会根据数据的类型创建对象。在集合中也会使用到 NSNumber，如NSSArray、NSSet，因为这些需要对象参与。<br>下图摘录了为 NSNumber 对象设值的类和实例方法以及获取这些数值的实例方法。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15867486542169.jpg\"></p>\n<h4 id=\"简单示例\"><a href=\"#简单示例\" class=\"headerlink\" title=\"简单示例\"></a>简单示例</h4><p>给出一个简单的测试示例。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSNumber</span> *intNum, *floatNum, *charNum, *doubleNum;</span><br><span class=\"line\">        <span class=\"built_in\">NSInteger</span> integerNum;</span><br><span class=\"line\">        </span><br><span class=\"line\">        intNum = [<span class=\"built_in\">NSNumber</span> numberWithInteger:<span class=\"number\">20</span>];</span><br><span class=\"line\">        integerNum = [intNum integerValue];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%li&quot;</span>,(<span class=\"keyword\">long</span>)integerNum);</span><br><span class=\"line\">        </span><br><span class=\"line\">        floatNum = [<span class=\"built_in\">NSNumber</span> numberWithFloat:<span class=\"number\">20.5</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%f&quot;</span>,[floatNum floatValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        charNum = [<span class=\"built_in\">NSNumber</span> numberWithChar:<span class=\"string\">&#x27;X&#x27;</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%c&quot;</span>,[charNum charValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        doubleNum = @<span class=\"number\">20.5</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%lf&quot;</span>,[doubleNum doubleValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([doubleNum isEqualToNumber:floatNum] == <span class=\"literal\">YES</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;doubleNum is equal to number floatNum&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">             <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;doubleNum is not equal to number floatNum&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([floatNum compare:intNum] == <span class=\"built_in\">NSOrderedDescending</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;intNum is less than floatNum&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例解释\"><a href=\"#示例解释\" class=\"headerlink\" title=\"示例解释\"></a>示例解释</h4><p>一般来说，需要确保使用正确的方式获取对象的值，如果在NSNumber对象中存储了一个值，那么也需要用一致的方式去获取。同时，<code>Objective-C</code>语言扩展允许通过@表达式创建数字对象.</p>\n<p>方法 numberWithInt: 和 numberWithInteger: 在使用存在差别</p>\n<ol>\n<li>使用 numberWithInt: 方法创建一个整型数,需要使用intValue获取值，使用%i作为格式化字符串显示它的值。</li>\n<li>使用 numberWithInteger: 方法创建一个整型数,需要使用integerValue获取值，也可以转换成 long 显示或者使用 stringWithFormat: 将其格式化成字符串。使用%li作为格式化字符串。</li>\n</ol>\n<h4 id=\"关于NSLog\"><a href=\"#关于NSLog\" class=\"headerlink\" title=\"关于NSLog\"></a>关于NSLog</h4><p>在NSLog中，格式字符<code>%@</code>不仅可以显示 NSString 对象，而且可以显示数组、字典和集合的全部内容。对于数组中的每一个元素,NSLog 将使用属于每个元素类的 description 方法。如果使用的是从 NSObject 对象继承的默认方法,获取到的是对象的类和地址。然而,通过覆盖继承的 description 方法可使用这些格式字符显示自定义类对象。</p>\n<h3 id=\"关于字符串对象\"><a href=\"#关于字符串对象\" class=\"headerlink\" title=\"关于字符串对象\"></a>关于字符串对象</h3><p>Foundation 框架支持 NSString类用于处理字符串对象。C 样式的字符串 char 字符组成，NSString 对象由 unichar 字符组成。unichar 字符是符合 Unicode 标准的多字节字符。NSString 类能够自动处理字符串的内部表示。使用 NSString 类的方法更容易开发出具有本地化的应用程序，并且能够在不同的语言环境下使用。</p>\n<p>NSMutableString 类是 NSString 类的子类，可以用来创建可以更改字符的字符串对象，它可以使用 NSString 类所有方法。摘录常见 NSMutableString 方法<br><img src=\"http://image.stephenfang.me/mweb/15867813113647.jpg\"></p>\n<h4 id=\"简单示例-1\"><a href=\"#简单示例-1\" class=\"headerlink\" title=\"简单示例\"></a>简单示例</h4><p>给出一个简单的测试示例。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *str1 = <span class=\"string\">@&quot;This is str1&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *str2 = <span class=\"string\">@&quot;This is str2&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *subStr;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableString</span> *mutStr;</span><br><span class=\"line\">        <span class=\"built_in\">NSRange</span> subRange;</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [str1 substringToIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [str1 substringFromIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [[str1 substringFromIndex:<span class=\"number\">3</span>]substringToIndex:<span class=\"number\">5</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [str1 substringWithRange:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">3</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subRange = [str2 rangeOfString:<span class=\"string\">@&quot;str2&quot;</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;index: %lu length: %lu&quot;</span>,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.location,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.length);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subRange = [str1 rangeOfString:<span class=\"string\">@&quot;str2&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (subRange.location == <span class=\"built_in\">NSNotFound</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;String not found&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;index: %lu length: %lu&quot;</span>,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.location,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        mutStr = [<span class=\"built_in\">NSMutableString</span> stringWithString:str1];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr insertString:mutStr atIndex:[mutStr length]];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr deleteCharactersInRange:<span class=\"built_in\">NSMakeRange</span>([mutStr length]/<span class=\"number\">2</span>, [mutStr length]/<span class=\"number\">2</span>)];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr appendString:mutStr];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr replaceCharactersInRange:<span class=\"built_in\">NSMakeRange</span>([mutStr length]/<span class=\"number\">2</span>, [mutStr length]/<span class=\"number\">2</span>) withString:str2];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subRange = [mutStr rangeOfString: <span class=\"string\">@&quot;This is&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (subRange.location != <span class=\"built_in\">NSNotFound</span>) &#123;</span><br><span class=\"line\">        [mutStr replaceCharactersInRange:subRange withString: <span class=\"string\">@&quot;it is&quot;</span>] ;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr) ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>运行结果为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-04-13 18:21:20.795845+0800 DemoProgram[49815:1823615] Thi</span><br><span class=\"line\">2020-04-13 18:21:20.796235+0800 DemoProgram[49815:1823615] s is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796281+0800 DemoProgram[49815:1823615] s is</span><br><span class=\"line\">2020-04-13 18:21:20.796305+0800 DemoProgram[49815:1823615] s is</span><br><span class=\"line\">2020-04-13 18:21:20.796331+0800 DemoProgram[49815:1823615] index: 8 length: 4</span><br><span class=\"line\">2020-04-13 18:21:20.796353+0800 DemoProgram[49815:1823615] String not found</span><br><span class=\"line\">2020-04-13 18:21:20.796395+0800 DemoProgram[49815:1823615] This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796432+0800 DemoProgram[49815:1823615] This is str1This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796453+0800 DemoProgram[49815:1823615] This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796472+0800 DemoProgram[49815:1823615] This is str1This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796498+0800 DemoProgram[49815:1823615] This is str1This is str2</span><br><span class=\"line\">2020-04-13 18:21:20.796520+0800 DemoProgram[49815:1823615] it is str1This is str2</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关于数组对象\"><a href=\"#关于数组对象\" class=\"headerlink\" title=\"关于数组对象\"></a>关于数组对象</h3><p>Foundation数组是有序的对象集合。不可变数组由 NSArray 类处理的，而可变数组由NSMutableArray 处理的。后者是前者的子类，即后者继承了前者的方法。</p>\n<p>其中</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSArray</span> *monthNames = [<span class=\"built_in\">NSArray</span> arrayWithObjects :<span class=\"string\">@&quot;January&quot;</span>, <span class=\"string\">@&quot;February&quot;</span>, <span class=\"string\">@&quot;March&quot;</span>, <span class=\"string\">@&quot;April&quot;</span>, <span class=\"string\">@&quot;May&quot;</span>, <span class=\"string\">&quot;June&quot;</span>, <span class=\"string\">@&quot;July&quot;</span>, <span class=\"string\">@&quot;August&quot;</span>, <span class=\"string\">@&quot;September&quot;</span>, <span class=\"string\">@&quot;October&quot;</span>, <span class=\"string\">@&quot;November&quot;</span>, <span class=\"string\">@&quot;December&quot;</span>, <span class=\"literal\">nil</span> ];</span><br></pre></td></tr></table></figure>\n<p>与如下方式相同。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSArray</span> *monthNames = @[<span class=\"string\">@&quot;January&quot;</span>, <span class=\"string\">@&quot;February&quot;</span>, <span class=\"string\">@&quot;March&quot;</span>, <span class=\"string\">@&quot;April&quot;</span>, <span class=\"string\">@&quot;May&quot;</span>,<span class=\"string\">@&quot;June&quot;</span>, <span class=\"string\">@&quot;July&quot;</span>, <span class=\"string\">@&quot;August&quot;</span>, <span class=\"string\">@&quot;September&quot;</span>, <span class=\"string\">@&quot;October&quot;</span>, <span class=\"string\">@&quot;November&quot;</span> ,<span class=\"string\">@&quot;December&quot;</span>];</span><br></pre></td></tr></table></figure>\n<p>而</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array[index]</span><br></pre></td></tr></table></figure>\n<p>相当于如下表达式</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[array objectAtIndex: index]</span><br></pre></td></tr></table></figure>\n<p>同时</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array[index] = object</span><br></pre></td></tr></table></figure>\n<p>相当于如下表达式</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[array setObject: object forIndex: index]</span><br></pre></td></tr></table></figure>\n<p>下一节会参照书本给的样例进行编写。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"http://monkey-oyster.blogspot.com/2014/10/int-vs-nsinteger-vs-nsnumber.html\">int vs. NSInteger vs. NSNumber</a><br><a href=\"https://stackoverflow.com/questions/4445173/when-to-use-nsinteger-vs-int/5320359#5320359\">Why use int at all?-Stack overflow</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第五篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中关于数字对象、字符串对象以及数组对象的内容。</p>","more":"<h3 id=\"关于数字对象\"><a href=\"#关于数字对象\" class=\"headerlink\" title=\"关于数字对象\"></a>关于数字对象</h3><p>无论是int 型、float 型和long型都是<code>Objective-C</code>语言中的基本数据类型,它们都不是对象，不能够向它们发送消息，然而有时需要将这些值作为对象使用。如不能将任何基本数据类型直接存储到数组中，使用Foundation的NSArray对象创建一个数组时，它要求存储的值必须是对象。</p>\n<p><strong>NSInteger</strong><br>NSInteger不是一个对象，是基本数据类型的typedef。</p>\n<p> Apple 官方 Foundation 文档解释的很清楚：</p>\n<blockquote>\n<p>When building 32-bit applications, NSInteger is a 32-bit integer. A 64-bit application treats NSInteger as a 64-bit integer.</p>\n</blockquote>\n<blockquote>\n<p>Apple use NSInteger (or NSUInteger) when passing a value as an argument to a function or returning a value from a function.</p>\n</blockquote>\n<p>鉴于目前 iOS 设备全部迈向64位架构，可以理解成 NSInteger 是64位的 long 类型。而 NSUInteger 也是类似于 NSInteger 的typedef。</p>\n<p><strong>int</strong><br>int 类型的使用主要体现在循环的控制上，控制循环语句无需考虑平台依赖，在大部分情况下16-bit 大小的 int 即可胜任此项工作。 NSInteger 可以作为函数的返回值或者是函数参数，至于使用 NSInteger 还是 int 决定权仍然在你需要解决的问题上。</p>\n<p><strong>NSNumber</strong><br>NSNumber 是<code>Objective-C</code>的类，具体来说是 NSValue 的子类。如果需要存储基本数据类型（包括 signed 或 unsigned char类型和BOOL类型），可以使用 NSNumber 对其进行包装来满足需求，NSNumber 会根据数据的类型创建对象。在集合中也会使用到 NSNumber，如NSSArray、NSSet，因为这些需要对象参与。<br>下图摘录了为 NSNumber 对象设值的类和实例方法以及获取这些数值的实例方法。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15867486542169.jpg\"></p>\n<h4 id=\"简单示例\"><a href=\"#简单示例\" class=\"headerlink\" title=\"简单示例\"></a>简单示例</h4><p>给出一个简单的测试示例。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSNumber</span> *intNum, *floatNum, *charNum, *doubleNum;</span><br><span class=\"line\">        <span class=\"built_in\">NSInteger</span> integerNum;</span><br><span class=\"line\">        </span><br><span class=\"line\">        intNum = [<span class=\"built_in\">NSNumber</span> numberWithInteger:<span class=\"number\">20</span>];</span><br><span class=\"line\">        integerNum = [intNum integerValue];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%li&quot;</span>,(<span class=\"keyword\">long</span>)integerNum);</span><br><span class=\"line\">        </span><br><span class=\"line\">        floatNum = [<span class=\"built_in\">NSNumber</span> numberWithFloat:<span class=\"number\">20.5</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%f&quot;</span>,[floatNum floatValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        charNum = [<span class=\"built_in\">NSNumber</span> numberWithChar:<span class=\"string\">&#x27;X&#x27;</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%c&quot;</span>,[charNum charValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        doubleNum = @<span class=\"number\">20.5</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%lf&quot;</span>,[doubleNum doubleValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([doubleNum isEqualToNumber:floatNum] == <span class=\"literal\">YES</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;doubleNum is equal to number floatNum&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">             <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;doubleNum is not equal to number floatNum&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([floatNum compare:intNum] == <span class=\"built_in\">NSOrderedDescending</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;intNum is less than floatNum&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"示例解释\"><a href=\"#示例解释\" class=\"headerlink\" title=\"示例解释\"></a>示例解释</h4><p>一般来说，需要确保使用正确的方式获取对象的值，如果在NSNumber对象中存储了一个值，那么也需要用一致的方式去获取。同时，<code>Objective-C</code>语言扩展允许通过@表达式创建数字对象.</p>\n<p>方法 numberWithInt: 和 numberWithInteger: 在使用存在差别</p>\n<ol>\n<li>使用 numberWithInt: 方法创建一个整型数,需要使用intValue获取值，使用%i作为格式化字符串显示它的值。</li>\n<li>使用 numberWithInteger: 方法创建一个整型数,需要使用integerValue获取值，也可以转换成 long 显示或者使用 stringWithFormat: 将其格式化成字符串。使用%li作为格式化字符串。</li>\n</ol>\n<h4 id=\"关于NSLog\"><a href=\"#关于NSLog\" class=\"headerlink\" title=\"关于NSLog\"></a>关于NSLog</h4><p>在NSLog中，格式字符<code>%@</code>不仅可以显示 NSString 对象，而且可以显示数组、字典和集合的全部内容。对于数组中的每一个元素,NSLog 将使用属于每个元素类的 description 方法。如果使用的是从 NSObject 对象继承的默认方法,获取到的是对象的类和地址。然而,通过覆盖继承的 description 方法可使用这些格式字符显示自定义类对象。</p>\n<h3 id=\"关于字符串对象\"><a href=\"#关于字符串对象\" class=\"headerlink\" title=\"关于字符串对象\"></a>关于字符串对象</h3><p>Foundation 框架支持 NSString类用于处理字符串对象。C 样式的字符串 char 字符组成，NSString 对象由 unichar 字符组成。unichar 字符是符合 Unicode 标准的多字节字符。NSString 类能够自动处理字符串的内部表示。使用 NSString 类的方法更容易开发出具有本地化的应用程序，并且能够在不同的语言环境下使用。</p>\n<p>NSMutableString 类是 NSString 类的子类，可以用来创建可以更改字符的字符串对象，它可以使用 NSString 类所有方法。摘录常见 NSMutableString 方法<br><img src=\"http://image.stephenfang.me/mweb/15867813113647.jpg\"></p>\n<h4 id=\"简单示例-1\"><a href=\"#简单示例-1\" class=\"headerlink\" title=\"简单示例\"></a>简单示例</h4><p>给出一个简单的测试示例。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>* argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *str1 = <span class=\"string\">@&quot;This is str1&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *str2 = <span class=\"string\">@&quot;This is str2&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *subStr;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableString</span> *mutStr;</span><br><span class=\"line\">        <span class=\"built_in\">NSRange</span> subRange;</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [str1 substringToIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [str1 substringFromIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [[str1 substringFromIndex:<span class=\"number\">3</span>]substringToIndex:<span class=\"number\">5</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subStr = [str1 substringWithRange:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">3</span>, <span class=\"number\">5</span>)];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,subStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subRange = [str2 rangeOfString:<span class=\"string\">@&quot;str2&quot;</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;index: %lu length: %lu&quot;</span>,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.location,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.length);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subRange = [str1 rangeOfString:<span class=\"string\">@&quot;str2&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (subRange.location == <span class=\"built_in\">NSNotFound</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;String not found&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;index: %lu length: %lu&quot;</span>,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.location,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)subRange.length);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        mutStr = [<span class=\"built_in\">NSMutableString</span> stringWithString:str1];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr insertString:mutStr atIndex:[mutStr length]];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr deleteCharactersInRange:<span class=\"built_in\">NSMakeRange</span>([mutStr length]/<span class=\"number\">2</span>, [mutStr length]/<span class=\"number\">2</span>)];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr appendString:mutStr];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        [mutStr replaceCharactersInRange:<span class=\"built_in\">NSMakeRange</span>([mutStr length]/<span class=\"number\">2</span>, [mutStr length]/<span class=\"number\">2</span>) withString:str2];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr);</span><br><span class=\"line\">        </span><br><span class=\"line\">        subRange = [mutStr rangeOfString: <span class=\"string\">@&quot;This is&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (subRange.location != <span class=\"built_in\">NSNotFound</span>) &#123;</span><br><span class=\"line\">        [mutStr replaceCharactersInRange:subRange withString: <span class=\"string\">@&quot;it is&quot;</span>] ;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,mutStr) ;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>运行结果为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-04-13 18:21:20.795845+0800 DemoProgram[49815:1823615] Thi</span><br><span class=\"line\">2020-04-13 18:21:20.796235+0800 DemoProgram[49815:1823615] s is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796281+0800 DemoProgram[49815:1823615] s is</span><br><span class=\"line\">2020-04-13 18:21:20.796305+0800 DemoProgram[49815:1823615] s is</span><br><span class=\"line\">2020-04-13 18:21:20.796331+0800 DemoProgram[49815:1823615] index: 8 length: 4</span><br><span class=\"line\">2020-04-13 18:21:20.796353+0800 DemoProgram[49815:1823615] String not found</span><br><span class=\"line\">2020-04-13 18:21:20.796395+0800 DemoProgram[49815:1823615] This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796432+0800 DemoProgram[49815:1823615] This is str1This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796453+0800 DemoProgram[49815:1823615] This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796472+0800 DemoProgram[49815:1823615] This is str1This is str1</span><br><span class=\"line\">2020-04-13 18:21:20.796498+0800 DemoProgram[49815:1823615] This is str1This is str2</span><br><span class=\"line\">2020-04-13 18:21:20.796520+0800 DemoProgram[49815:1823615] it is str1This is str2</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关于数组对象\"><a href=\"#关于数组对象\" class=\"headerlink\" title=\"关于数组对象\"></a>关于数组对象</h3><p>Foundation数组是有序的对象集合。不可变数组由 NSArray 类处理的，而可变数组由NSMutableArray 处理的。后者是前者的子类，即后者继承了前者的方法。</p>\n<p>其中</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSArray</span> *monthNames = [<span class=\"built_in\">NSArray</span> arrayWithObjects :<span class=\"string\">@&quot;January&quot;</span>, <span class=\"string\">@&quot;February&quot;</span>, <span class=\"string\">@&quot;March&quot;</span>, <span class=\"string\">@&quot;April&quot;</span>, <span class=\"string\">@&quot;May&quot;</span>, <span class=\"string\">&quot;June&quot;</span>, <span class=\"string\">@&quot;July&quot;</span>, <span class=\"string\">@&quot;August&quot;</span>, <span class=\"string\">@&quot;September&quot;</span>, <span class=\"string\">@&quot;October&quot;</span>, <span class=\"string\">@&quot;November&quot;</span>, <span class=\"string\">@&quot;December&quot;</span>, <span class=\"literal\">nil</span> ];</span><br></pre></td></tr></table></figure>\n<p>与如下方式相同。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">NSArray</span> *monthNames = @[<span class=\"string\">@&quot;January&quot;</span>, <span class=\"string\">@&quot;February&quot;</span>, <span class=\"string\">@&quot;March&quot;</span>, <span class=\"string\">@&quot;April&quot;</span>, <span class=\"string\">@&quot;May&quot;</span>,<span class=\"string\">@&quot;June&quot;</span>, <span class=\"string\">@&quot;July&quot;</span>, <span class=\"string\">@&quot;August&quot;</span>, <span class=\"string\">@&quot;September&quot;</span>, <span class=\"string\">@&quot;October&quot;</span>, <span class=\"string\">@&quot;November&quot;</span> ,<span class=\"string\">@&quot;December&quot;</span>];</span><br></pre></td></tr></table></figure>\n<p>而</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array[index]</span><br></pre></td></tr></table></figure>\n<p>相当于如下表达式</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[array objectAtIndex: index]</span><br></pre></td></tr></table></figure>\n<p>同时</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array[index] = object</span><br></pre></td></tr></table></figure>\n<p>相当于如下表达式</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[array setObject: object forIndex: index]</span><br></pre></td></tr></table></figure>\n<p>下一节会参照书本给的样例进行编写。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"http://monkey-oyster.blogspot.com/2014/10/int-vs-nsinteger-vs-nsnumber.html\">int vs. NSInteger vs. NSNumber</a><br><a href=\"https://stackoverflow.com/questions/4445173/when-to-use-nsinteger-vs-int/5320359#5320359\">Why use int at all?-Stack overflow</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/15867486542169.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:46 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(五）","path":"2020/04/13/Objc_Learning_5/","eyeCatchImage":"http://image.stephenfang.me/mweb/15867486542169.jpg","excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第五篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中关于数字对象、字符串对象以及数组对象的内容。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-13T14:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-13T14:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":6015},{"title":"Objective-C 学习笔记(六）","date":"2020-04-17T09:43:20.000Z","copyright":true,"_content":"\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第六篇文章，主要复习了 `Objective-C` Foundation 框架中关于数组排序、字典对象以及集合对象的内容。\n\n<!--more-->\n\n### 关于数组排序\n#### 简单排序示例\n`Objective-C` 中对于 NSArray 排序方法主要有以下几种。\n```\nsortedArrayUsingSelector:\nsortedArrayUsingComparator:\nsortedArrayUsingDescriptors:\n```\n给出前两者排序的简单示例，如果只是对字符串简单做排序，sortedArrayUsingSelector:方法已足够，sortedArrayUsingComparator: 中用到了block内容。\n\n```objc\n#import <Foundation/Foundation.h>\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSArray *array = [NSArray arrayWithObjects:@\"abc\",@\"456\",@\"123\",@\"789\",@\"ef\", nil];\n        \n        //sortedArrayUsingSelector\n        NSArray *sortedArray1 = [array sortedArrayUsingSelector:@selector(compare:)];\n        NSLog(@\"SortedArray1:\");\n        NSLog(@\"%@\",sortedArray1);\n        \n        //sortedArrayUsingComparator:\n        NSArray *sortedArray2 = [array sortedArrayUsingComparator:^NSComparisonResult(id obj1, id obj2) {\n             NSComparisonResult result = [obj1 compare:obj2];\n             return result;\n         }];\n         NSLog(@\"SortedArray2:\");\n         NSLog(@\"%@\",sortedArray2);\n    }\n    return 0;\n}\n```\n\n#### 使用区块排序\nNSArray和NSMutableArray类中具有使用区块对数组中元素进行排序的方法。\nNSArray的排序方法一般格式为: \n```objc\n- (NSArray *) sortedArrayUsingComparator: (NSComparator) block\n```\nNSMutableArray的排序方法格式为: \n```objc\n- (void) sortUsingComparator: (NSComparator) block\n```\nNSComparator作为typedef定义在系统头文件中:\n```objc\ntypedef NSComparisonResult (^NSComparator) (id obj1, id obj2);\n```\n\nNSComparator是一个区块，使用两个待比较对象作为参数，并返回 NSComparisonResult 类型的值。预期会返回一个标识，说明第一个对象是否小于、等于或者大于第二个对象，这一点与不使用区块的数组排序方法是一致的。区块对于大数组排序能够提升一些速度，可以考虑在程序中使用。\n\n#### 关于描述器排序\n给出使用描述器排序的一个代码样例。\n代码中定义了三种车与五个人，并将车与人的信息载入数组，通过构建排序描述器，将排序描述器按照一定顺序放入数组，最后能够按照你所期望的顺序对信息进行输出，因为代码中重写了description，故能够按照格式进行输出。\n```objc\n//main.m\n#import <Foundation/Foundation.h>\n#import \"Car.h\"\n#import \"Person.h\"\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n            Car *car1 = [Car initWithName:@\"Audio\"];\n            Car *car2 = [Car initWithName:@\"Rolls-Royce\"];\n            Car *car3 = [Car initWithName:@\"BMW\"];\n            \n            Person *p1 = [Person personWithAge:23 withName:@\"zhangsan\" withCar:car2];\n            Person *p2 = [Person personWithAge:21 withName:@\"zhangsan\" withCar:car1];\n            Person *p3 = [Person personWithAge:24 withName:@\"lisi\" withCar:car1];\n            Person *p4 = [Person personWithAge:23 withName:@\"wangwu\" withCar:car3];\n            Person *p5 = [Person personWithAge:23 withName:@\"wangwu\" withCar:car2];\n\n            NSArray *array = [NSArray arrayWithObjects:p1,p2,p3,p4,p5, nil];\n            \n            NSSortDescriptor *carNameDesc = [NSSortDescriptor sortDescriptorWithKey:@\"car.name\" ascending:YES];\n            NSSortDescriptor *personNameDesc = [NSSortDescriptor sortDescriptorWithKey:@\"name\" ascending:YES];\n            NSSortDescriptor *personAgeDesc = [NSSortDescriptor sortDescriptorWithKey:@\"age\" ascending:YES];\n            \n            NSArray *descriptorArray = [NSArray arrayWithObjects:personAgeDesc,carNameDesc,personNameDesc, nil];\n            \n            NSArray *sortedArray = [array sortedArrayUsingDescriptors: descriptorArray];\n            NSLog(@\"%@\",sortedArray);\n    }\n    return 0;\n}\n\n```\n\n```objc\n//Car.h\n#import <Foundation/Foundation.h>\n\n@interface Car : NSObject\n@property(nonatomic, strong) NSString *name;\n+(Car *)initWithName:(NSString *)name;\n@end\n```\n\n```objc\n//Person.h\n#import <Foundation/Foundation.h>\n#import \"Car.h\"\n\n@interface Person : NSObject\n{\n    int age;\n    NSString *name;\n    Car *car;\n}\n+(Person *)personWithAge:(int)age withName:(NSString *)name withCar:(Car *)car;\n-(NSString *)description;\n@end\n\n```\n\n```objc\n//Car.m\n#import \"Car.h\"\n@implementation Car\n\n@synthesize name = _name;\n\n+(Car *)initWithName:(NSString *)name{\n    Car *car = [[Car alloc] init];\n    car.name = name;\n    return car;\n}\n\n@end\n```\n\n```objc\n//Person.m\n#import \"Person.h\"\n#import \"Car.h\"\n@implementation Person\n\n+(Person *)personWithAge:(int)age withName:(NSString *)name withCar:(Car *)car{\n    Person *person = [[Person alloc] init];\n    person->age = age;\n    person->name = name;\n    person->car = car;\n    return person;\n}\n\n-(NSString *)description{\n    return [NSString stringWithFormat:@\"age is %i , name is %@, car is %@\",age,name,car.name];\n}\n@end\n```\n\n```log\n2020-04-17 17:04:05.775056+0800 DemoProgram[55124:1325210] (\n    \"age is 21 , name is zhangsan, car is Audio\",\n    \"age is 23 , name is wangwu, car is BMW\",\n    \"age is 23 , name is wangwu, car is Rolls-Royce\",\n    \"age is 23 , name is zhangsan, car is Rolls-Royce\",\n    \"age is 24 , name is lisi, car is Audio\"\n)\nProgram ended with exit code: 0\n```\n\n### 关于字典对象 \n词典 (dictionary) 是由键——对象对组成的数据集合。通过对象的键可以从`Objective-C`词典中获取需要的对象。词典中的键必须是单值的，通常它们是字符串，但也可以是其他对象类型。和键关联的值可以是任何对象类型，但不能是nil。词典可以是固定的，也可以是可变的。可变词典中的记录可以动态添加和删除。可以使用键检索词典，也可以枚举它们的内容。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSMutableDictionary *dict = [NSMutableDictionary dictionary];\n        dict[@\"key1\"] = @\"This is key 1\";\n        dict[@\"key2\"] = @\"This is key 2\";\n        dict[@\"key3\"] = @\"This is key 3\";\n        \n        NSLog(@\"Key note for Key 1: %@\",dict[@\"key1\"]);\n        NSLog(@\"Key note for Key 2: %@\",dict[@\"key2\"]);\n        NSLog(@\"Key note for Key 3: %@\",dict[@\"key3\"]);\n    }\n    return 0;\n}\n```\n\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSMutableDictionary *dict = [NSMutableDictionary dictionary];\n        [dict setObject:@\"This is key 1\" forKey:@\"key1\"];\n        [dict setObject:@\"This is key 1\" forKey:@\"key2\"];\n        [dict setObject:@\"This is key 3\" forKey:@\"key3\"];\n        \n        NSLog(@\"Key note for Key 1: %@\",[dict objectForKey:@\"key1\"]);\n        NSLog(@\"Key note for Key 2: %@\",[dict objectForKey:@\"key2\"]);\n        NSLog(@\"Key note for Key 3: %@\",[dict objectForKey:@\"key3\"]);\n    }\n    return 0;\n}\n```\n需要注意的是若Key存在重复则会出现无法显示某一重复Key问题.\n创建词典后可以利用循环语句枚举词典的内容。\n键从词典中依次检索,没有特定顺序。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSDictionary *dict = [NSDictionary dictionaryWithObjectsAndKeys:\n                                     @\"This is key 1\",@\"key1\",\n                                     @\"This is key 2\",@\"key2\",\n                                     @\"This is key 3\",@\"key3\",\n                              nil];\n        for (NSDictionary *dictItem in dict ) {\n            NSLog(@\"%@:%@\",dictItem,[dict objectForKey:dictItem]);\n        }\n    }\n    return 0;\n}\n```\n### 关于集合对象\nSet是一组单值对象集合，可以是可变的，也可以是不变的。Set的操作包括搜索、添加、删除集合中的成员(仅用于可变集合)，比较两个集合，计算两个集合的交集和并集等，这些操作在示例程序中得以体现。\n\n需要注意的是 NSCountedSet，该Set中同一对象可以出现多次，然而在 NSCountedSet 中并非存放了多个对象，而是维护一个次数计数。第一次将对象添加到集合中时，对象的 count 值被置为1,然后每次将该对象添加到集合中 count 值就会增1, 相应地，每次从集合删除对象，count 值就会减1。当对象的 count 值为零时，实际上对象本身就被删除了。\n\n示例程序对 NSSet、 NSMutableSet、NSCountedSet 和 NSIndexSet进行了演示。\n```objc\n#import <Foundation/Foundation.h>\n\n@interface NSSet (Printing)\n-(void) print;\n@end\n\n@implementation NSSet (Printing)\n- (void) print {\n    printf(\"{\");\n    for (NSNumber *element in self)\n        printf(\"%li\",(long)[element integerValue]);\n    printf(\"}\\n\");\n}\n@end\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSMutableSet *set1 = [NSMutableSet setWithObjects:@1, @3, @5,  @7, nil];\n        NSSet *set2 = [NSSet setWithObjects:@2, @4, @6, @8, nil];\n        NSCountedSet *set3 = [NSCountedSet setWithObjects:@1, @1, @3, @5, nil];\n \n        NSIndexSet * indexSet1 = [[NSIndexSet alloc] initWithIndexesInRange:NSMakeRange(1,3)];\n        NSMutableIndexSet *indexSet2 =[[NSMutableIndexSet alloc] init];\n        [indexSet2 addIndex:0];\n        [indexSet2 addIndex:3];\n        [indexSet2 addIndex:5];\n        \n        unsigned long index;\n        NSLog(@\"IndexSet1:\");\n        for (index = [indexSet1 firstIndex];\n             index != NSNotFound;\n             index = [indexSet1 indexGreaterThanIndex: index])  {\n            NSLog(@\"%lu\",index);\n        }\n        \n        NSLog(@\"IndexSet2:\");\n        for (index = [indexSet2 firstIndex];\n             index != NSNotFound;\n             index = [indexSet2 indexGreaterThanIndex: index])  {\n            NSLog(@\"%lu\",index);\n        }\n        \n        NSLog(@\"Set1:\");\n        [set1 print];\n        NSLog(@\"Set2:\");\n        [set2 print];\n        NSLog(@\"Set3:\");\n        [set3 print];\n        \n        if([set1 isEqualToSet: set2] == YES)\n            NSLog(@\"Set 1 equals set2\");\n        else\n            NSLog(@\"Set 1 is not equal to Set2\");\n        \n        if([set1 containsObject: @1]){\n            NSLog(@\"Set1 contains element 1\");\n        }else{\n            NSLog(@\"Set1 does not contains element 1\");\n        }\n        \n        NSLog(@\"The count of 1 in Set3: %lu\",(unsigned long)[set3 countForObject:@1]);\n        [set1 addObject:@2];\n        [set1 removeObject:@1];\n        [set1 print];\n        [set1 intersectSet:set2];\n        [set1 print];\n        [set1 unionSet:set2];\n        [set1 print];\n        \n    }\n    return 0;\n}\n\n```\n相应的运行结果为：\n```log\n2020-04-17 11:40:23.646162+0800 DemoProgram[51926:1202542] IndexSet1:\n2020-04-17 11:40:23.646584+0800 DemoProgram[51926:1202542] 1\n2020-04-17 11:40:23.646627+0800 DemoProgram[51926:1202542] 2\n2020-04-17 11:40:23.646679+0800 DemoProgram[51926:1202542] 3\n2020-04-17 11:40:23.646733+0800 DemoProgram[51926:1202542] IndexSet2:\n2020-04-17 11:40:23.646762+0800 DemoProgram[51926:1202542] 0\n2020-04-17 11:40:23.646786+0800 DemoProgram[51926:1202542] 3\n2020-04-17 11:40:23.646808+0800 DemoProgram[51926:1202542] 5\n2020-04-17 11:40:23.646825+0800 DemoProgram[51926:1202542] Set1:\n{7351}\n2020-04-17 11:40:23.646871+0800 DemoProgram[51926:1202542] Set2:\n{6284}\n2020-04-17 11:40:23.646898+0800 DemoProgram[51926:1202542] Set3:\n{315}\n2020-04-17 11:40:23.646934+0800 DemoProgram[51926:1202542] Set 1 is not equal to Set2\n2020-04-17 11:40:23.646957+0800 DemoProgram[51926:1202542] Set1 contains element 1\n2020-04-17 11:40:23.646979+0800 DemoProgram[51926:1202542] The count of 1 in Set3: 2\n{7325}\n{2}\n{6284}\nProgram ended with exit code: 0\n```\n\n### 其他总结\n根据写代码过程中遇到的一些问题查找的答案做一些阶段性总结。\n#### 实例变量的范围类型\n**@private**\n该类型的实例变量只有声明它的类能够访问它。\n**@protected**\n该类型的实例变量能被声明它的类和子类访问。\n所有没有显式标识范围的实例变量默认为 @protected。\n**@public**\n该类型实例变量可以在任何地方被访问。\n**@package**\n在modern runtime下，@package 实例变量的范围在实现这个类的可执行文件镜像中是@public，但是在实现这个类的可执行文件镜像外部是 @private。\nObjective-C 中的 @package 与 C 语言中变量和函数的 private_extern 类似，任何在实现类的镜像外的代码想使用这个实例变量都会引发link error错误。\n@package 对于框架类的实例变量十分受用，在这种环境下使用 @private 可能太受限制，使用@protected 或者 @public 又过于开放。@package 类型的变量在 Framework 内部相当于 @protected，在 Framework 外部，相当于@private。\n\n#### 类方法与实例方法\n- 实例方法在类的具体实例的范围内执行，在调用一个实例方法前必须首先创建类的实例。需要在方法声明前加上“-”，表示实例（对象）方法 (动态方法)。\n- 类方法不需要创建实例，不依赖于对象，直接用类名调用，执行效率较高；当方法内部不需要使用成员变量时，就可以使用类方法。需要在方法生命前加上“-”，表示类方法 (静态方法)。\n\n#### 声明方式\n在网上查找资料时发现属性声明存在三种方式，通过查资料对三种方式进行总结\n1. 直接在 @interface 中声明。该方法声明的成员变量只能在类内部使用，即不能通过类名. 点的方式访问变量，需要使用 -> 的方式。\n\n```objc \n@interface Test : NSObject{\n    NSString *test;\n}\n``` \n\n1. 在@interface中声明，然后再在@property中声明。该方法为过时的声明变量方式，Xcode 在早期 @systhesize 没有自动合成属性器之前，需要手写 getter 与 setter 方法。在Xcode有自动合成属性器后，编译器会自动生成一个以下划线开头的的实例变量，所以不必同时声明属性与变量。即可以直接用 @property 声明一个成员属性，在 .m 文件中无需使用 @systhesize，Xcode 会自动生成 getter 与 setter.\n\n```objc \n@interface Test : NSObject{\n    NSString *_test;\n}\n@property (strong, nonatomic) NSString *mystr; \n```\n同时在.m文件中插入\n```objc \n@synthesize mystr = _myStr;\n```\n\n3. 直接用@property声明。该方法声明的成员变量能够在类内部和外部使用，在类的内部可以通过下划线+变量名 或 self.变量名 的方式来访问变量。\n\n```objc \n@interface Test : NSObject{\n}\n@property (strong, nonatomic) NSString *test;\n```\n同时在.m文件中插入\n```objc \n@synthesize test = _test;\n```\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n[Objective C中数组排序几种情况的总结](https://my.oschina.net/pengloo53/blog/173810)\n[Objective-C入门教程14：集合对象(NSSet,NSMutableSet,NSIndexSet)](https://liuzhichao.com/p/1256.html)\n[iOS中四种实例变量的范围类型](https://www.cnblogs.com/stevenwuzheng/p/4605232.html)\n[OC声明变量在@interface括号中与使用@property的区别](https://blog.csdn.net/shenjie12345678/article/details/39052659)\n","source":"_posts/Objc_Learning_6.md","raw":"---\ntitle: Objective-C 学习笔记(六）\ndate: 2020-04-17 17:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第六篇文章，主要复习了 `Objective-C` Foundation 框架中关于数组排序、字典对象以及集合对象的内容。\n\n<!--more-->\n\n### 关于数组排序\n#### 简单排序示例\n`Objective-C` 中对于 NSArray 排序方法主要有以下几种。\n```\nsortedArrayUsingSelector:\nsortedArrayUsingComparator:\nsortedArrayUsingDescriptors:\n```\n给出前两者排序的简单示例，如果只是对字符串简单做排序，sortedArrayUsingSelector:方法已足够，sortedArrayUsingComparator: 中用到了block内容。\n\n```objc\n#import <Foundation/Foundation.h>\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSArray *array = [NSArray arrayWithObjects:@\"abc\",@\"456\",@\"123\",@\"789\",@\"ef\", nil];\n        \n        //sortedArrayUsingSelector\n        NSArray *sortedArray1 = [array sortedArrayUsingSelector:@selector(compare:)];\n        NSLog(@\"SortedArray1:\");\n        NSLog(@\"%@\",sortedArray1);\n        \n        //sortedArrayUsingComparator:\n        NSArray *sortedArray2 = [array sortedArrayUsingComparator:^NSComparisonResult(id obj1, id obj2) {\n             NSComparisonResult result = [obj1 compare:obj2];\n             return result;\n         }];\n         NSLog(@\"SortedArray2:\");\n         NSLog(@\"%@\",sortedArray2);\n    }\n    return 0;\n}\n```\n\n#### 使用区块排序\nNSArray和NSMutableArray类中具有使用区块对数组中元素进行排序的方法。\nNSArray的排序方法一般格式为: \n```objc\n- (NSArray *) sortedArrayUsingComparator: (NSComparator) block\n```\nNSMutableArray的排序方法格式为: \n```objc\n- (void) sortUsingComparator: (NSComparator) block\n```\nNSComparator作为typedef定义在系统头文件中:\n```objc\ntypedef NSComparisonResult (^NSComparator) (id obj1, id obj2);\n```\n\nNSComparator是一个区块，使用两个待比较对象作为参数，并返回 NSComparisonResult 类型的值。预期会返回一个标识，说明第一个对象是否小于、等于或者大于第二个对象，这一点与不使用区块的数组排序方法是一致的。区块对于大数组排序能够提升一些速度，可以考虑在程序中使用。\n\n#### 关于描述器排序\n给出使用描述器排序的一个代码样例。\n代码中定义了三种车与五个人，并将车与人的信息载入数组，通过构建排序描述器，将排序描述器按照一定顺序放入数组，最后能够按照你所期望的顺序对信息进行输出，因为代码中重写了description，故能够按照格式进行输出。\n```objc\n//main.m\n#import <Foundation/Foundation.h>\n#import \"Car.h\"\n#import \"Person.h\"\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n            Car *car1 = [Car initWithName:@\"Audio\"];\n            Car *car2 = [Car initWithName:@\"Rolls-Royce\"];\n            Car *car3 = [Car initWithName:@\"BMW\"];\n            \n            Person *p1 = [Person personWithAge:23 withName:@\"zhangsan\" withCar:car2];\n            Person *p2 = [Person personWithAge:21 withName:@\"zhangsan\" withCar:car1];\n            Person *p3 = [Person personWithAge:24 withName:@\"lisi\" withCar:car1];\n            Person *p4 = [Person personWithAge:23 withName:@\"wangwu\" withCar:car3];\n            Person *p5 = [Person personWithAge:23 withName:@\"wangwu\" withCar:car2];\n\n            NSArray *array = [NSArray arrayWithObjects:p1,p2,p3,p4,p5, nil];\n            \n            NSSortDescriptor *carNameDesc = [NSSortDescriptor sortDescriptorWithKey:@\"car.name\" ascending:YES];\n            NSSortDescriptor *personNameDesc = [NSSortDescriptor sortDescriptorWithKey:@\"name\" ascending:YES];\n            NSSortDescriptor *personAgeDesc = [NSSortDescriptor sortDescriptorWithKey:@\"age\" ascending:YES];\n            \n            NSArray *descriptorArray = [NSArray arrayWithObjects:personAgeDesc,carNameDesc,personNameDesc, nil];\n            \n            NSArray *sortedArray = [array sortedArrayUsingDescriptors: descriptorArray];\n            NSLog(@\"%@\",sortedArray);\n    }\n    return 0;\n}\n\n```\n\n```objc\n//Car.h\n#import <Foundation/Foundation.h>\n\n@interface Car : NSObject\n@property(nonatomic, strong) NSString *name;\n+(Car *)initWithName:(NSString *)name;\n@end\n```\n\n```objc\n//Person.h\n#import <Foundation/Foundation.h>\n#import \"Car.h\"\n\n@interface Person : NSObject\n{\n    int age;\n    NSString *name;\n    Car *car;\n}\n+(Person *)personWithAge:(int)age withName:(NSString *)name withCar:(Car *)car;\n-(NSString *)description;\n@end\n\n```\n\n```objc\n//Car.m\n#import \"Car.h\"\n@implementation Car\n\n@synthesize name = _name;\n\n+(Car *)initWithName:(NSString *)name{\n    Car *car = [[Car alloc] init];\n    car.name = name;\n    return car;\n}\n\n@end\n```\n\n```objc\n//Person.m\n#import \"Person.h\"\n#import \"Car.h\"\n@implementation Person\n\n+(Person *)personWithAge:(int)age withName:(NSString *)name withCar:(Car *)car{\n    Person *person = [[Person alloc] init];\n    person->age = age;\n    person->name = name;\n    person->car = car;\n    return person;\n}\n\n-(NSString *)description{\n    return [NSString stringWithFormat:@\"age is %i , name is %@, car is %@\",age,name,car.name];\n}\n@end\n```\n\n```log\n2020-04-17 17:04:05.775056+0800 DemoProgram[55124:1325210] (\n    \"age is 21 , name is zhangsan, car is Audio\",\n    \"age is 23 , name is wangwu, car is BMW\",\n    \"age is 23 , name is wangwu, car is Rolls-Royce\",\n    \"age is 23 , name is zhangsan, car is Rolls-Royce\",\n    \"age is 24 , name is lisi, car is Audio\"\n)\nProgram ended with exit code: 0\n```\n\n### 关于字典对象 \n词典 (dictionary) 是由键——对象对组成的数据集合。通过对象的键可以从`Objective-C`词典中获取需要的对象。词典中的键必须是单值的，通常它们是字符串，但也可以是其他对象类型。和键关联的值可以是任何对象类型，但不能是nil。词典可以是固定的，也可以是可变的。可变词典中的记录可以动态添加和删除。可以使用键检索词典，也可以枚举它们的内容。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSMutableDictionary *dict = [NSMutableDictionary dictionary];\n        dict[@\"key1\"] = @\"This is key 1\";\n        dict[@\"key2\"] = @\"This is key 2\";\n        dict[@\"key3\"] = @\"This is key 3\";\n        \n        NSLog(@\"Key note for Key 1: %@\",dict[@\"key1\"]);\n        NSLog(@\"Key note for Key 2: %@\",dict[@\"key2\"]);\n        NSLog(@\"Key note for Key 3: %@\",dict[@\"key3\"]);\n    }\n    return 0;\n}\n```\n\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSMutableDictionary *dict = [NSMutableDictionary dictionary];\n        [dict setObject:@\"This is key 1\" forKey:@\"key1\"];\n        [dict setObject:@\"This is key 1\" forKey:@\"key2\"];\n        [dict setObject:@\"This is key 3\" forKey:@\"key3\"];\n        \n        NSLog(@\"Key note for Key 1: %@\",[dict objectForKey:@\"key1\"]);\n        NSLog(@\"Key note for Key 2: %@\",[dict objectForKey:@\"key2\"]);\n        NSLog(@\"Key note for Key 3: %@\",[dict objectForKey:@\"key3\"]);\n    }\n    return 0;\n}\n```\n需要注意的是若Key存在重复则会出现无法显示某一重复Key问题.\n创建词典后可以利用循环语句枚举词典的内容。\n键从词典中依次检索,没有特定顺序。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSDictionary *dict = [NSDictionary dictionaryWithObjectsAndKeys:\n                                     @\"This is key 1\",@\"key1\",\n                                     @\"This is key 2\",@\"key2\",\n                                     @\"This is key 3\",@\"key3\",\n                              nil];\n        for (NSDictionary *dictItem in dict ) {\n            NSLog(@\"%@:%@\",dictItem,[dict objectForKey:dictItem]);\n        }\n    }\n    return 0;\n}\n```\n### 关于集合对象\nSet是一组单值对象集合，可以是可变的，也可以是不变的。Set的操作包括搜索、添加、删除集合中的成员(仅用于可变集合)，比较两个集合，计算两个集合的交集和并集等，这些操作在示例程序中得以体现。\n\n需要注意的是 NSCountedSet，该Set中同一对象可以出现多次，然而在 NSCountedSet 中并非存放了多个对象，而是维护一个次数计数。第一次将对象添加到集合中时，对象的 count 值被置为1,然后每次将该对象添加到集合中 count 值就会增1, 相应地，每次从集合删除对象，count 值就会减1。当对象的 count 值为零时，实际上对象本身就被删除了。\n\n示例程序对 NSSet、 NSMutableSet、NSCountedSet 和 NSIndexSet进行了演示。\n```objc\n#import <Foundation/Foundation.h>\n\n@interface NSSet (Printing)\n-(void) print;\n@end\n\n@implementation NSSet (Printing)\n- (void) print {\n    printf(\"{\");\n    for (NSNumber *element in self)\n        printf(\"%li\",(long)[element integerValue]);\n    printf(\"}\\n\");\n}\n@end\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSMutableSet *set1 = [NSMutableSet setWithObjects:@1, @3, @5,  @7, nil];\n        NSSet *set2 = [NSSet setWithObjects:@2, @4, @6, @8, nil];\n        NSCountedSet *set3 = [NSCountedSet setWithObjects:@1, @1, @3, @5, nil];\n \n        NSIndexSet * indexSet1 = [[NSIndexSet alloc] initWithIndexesInRange:NSMakeRange(1,3)];\n        NSMutableIndexSet *indexSet2 =[[NSMutableIndexSet alloc] init];\n        [indexSet2 addIndex:0];\n        [indexSet2 addIndex:3];\n        [indexSet2 addIndex:5];\n        \n        unsigned long index;\n        NSLog(@\"IndexSet1:\");\n        for (index = [indexSet1 firstIndex];\n             index != NSNotFound;\n             index = [indexSet1 indexGreaterThanIndex: index])  {\n            NSLog(@\"%lu\",index);\n        }\n        \n        NSLog(@\"IndexSet2:\");\n        for (index = [indexSet2 firstIndex];\n             index != NSNotFound;\n             index = [indexSet2 indexGreaterThanIndex: index])  {\n            NSLog(@\"%lu\",index);\n        }\n        \n        NSLog(@\"Set1:\");\n        [set1 print];\n        NSLog(@\"Set2:\");\n        [set2 print];\n        NSLog(@\"Set3:\");\n        [set3 print];\n        \n        if([set1 isEqualToSet: set2] == YES)\n            NSLog(@\"Set 1 equals set2\");\n        else\n            NSLog(@\"Set 1 is not equal to Set2\");\n        \n        if([set1 containsObject: @1]){\n            NSLog(@\"Set1 contains element 1\");\n        }else{\n            NSLog(@\"Set1 does not contains element 1\");\n        }\n        \n        NSLog(@\"The count of 1 in Set3: %lu\",(unsigned long)[set3 countForObject:@1]);\n        [set1 addObject:@2];\n        [set1 removeObject:@1];\n        [set1 print];\n        [set1 intersectSet:set2];\n        [set1 print];\n        [set1 unionSet:set2];\n        [set1 print];\n        \n    }\n    return 0;\n}\n\n```\n相应的运行结果为：\n```log\n2020-04-17 11:40:23.646162+0800 DemoProgram[51926:1202542] IndexSet1:\n2020-04-17 11:40:23.646584+0800 DemoProgram[51926:1202542] 1\n2020-04-17 11:40:23.646627+0800 DemoProgram[51926:1202542] 2\n2020-04-17 11:40:23.646679+0800 DemoProgram[51926:1202542] 3\n2020-04-17 11:40:23.646733+0800 DemoProgram[51926:1202542] IndexSet2:\n2020-04-17 11:40:23.646762+0800 DemoProgram[51926:1202542] 0\n2020-04-17 11:40:23.646786+0800 DemoProgram[51926:1202542] 3\n2020-04-17 11:40:23.646808+0800 DemoProgram[51926:1202542] 5\n2020-04-17 11:40:23.646825+0800 DemoProgram[51926:1202542] Set1:\n{7351}\n2020-04-17 11:40:23.646871+0800 DemoProgram[51926:1202542] Set2:\n{6284}\n2020-04-17 11:40:23.646898+0800 DemoProgram[51926:1202542] Set3:\n{315}\n2020-04-17 11:40:23.646934+0800 DemoProgram[51926:1202542] Set 1 is not equal to Set2\n2020-04-17 11:40:23.646957+0800 DemoProgram[51926:1202542] Set1 contains element 1\n2020-04-17 11:40:23.646979+0800 DemoProgram[51926:1202542] The count of 1 in Set3: 2\n{7325}\n{2}\n{6284}\nProgram ended with exit code: 0\n```\n\n### 其他总结\n根据写代码过程中遇到的一些问题查找的答案做一些阶段性总结。\n#### 实例变量的范围类型\n**@private**\n该类型的实例变量只有声明它的类能够访问它。\n**@protected**\n该类型的实例变量能被声明它的类和子类访问。\n所有没有显式标识范围的实例变量默认为 @protected。\n**@public**\n该类型实例变量可以在任何地方被访问。\n**@package**\n在modern runtime下，@package 实例变量的范围在实现这个类的可执行文件镜像中是@public，但是在实现这个类的可执行文件镜像外部是 @private。\nObjective-C 中的 @package 与 C 语言中变量和函数的 private_extern 类似，任何在实现类的镜像外的代码想使用这个实例变量都会引发link error错误。\n@package 对于框架类的实例变量十分受用，在这种环境下使用 @private 可能太受限制，使用@protected 或者 @public 又过于开放。@package 类型的变量在 Framework 内部相当于 @protected，在 Framework 外部，相当于@private。\n\n#### 类方法与实例方法\n- 实例方法在类的具体实例的范围内执行，在调用一个实例方法前必须首先创建类的实例。需要在方法声明前加上“-”，表示实例（对象）方法 (动态方法)。\n- 类方法不需要创建实例，不依赖于对象，直接用类名调用，执行效率较高；当方法内部不需要使用成员变量时，就可以使用类方法。需要在方法生命前加上“-”，表示类方法 (静态方法)。\n\n#### 声明方式\n在网上查找资料时发现属性声明存在三种方式，通过查资料对三种方式进行总结\n1. 直接在 @interface 中声明。该方法声明的成员变量只能在类内部使用，即不能通过类名. 点的方式访问变量，需要使用 -> 的方式。\n\n```objc \n@interface Test : NSObject{\n    NSString *test;\n}\n``` \n\n1. 在@interface中声明，然后再在@property中声明。该方法为过时的声明变量方式，Xcode 在早期 @systhesize 没有自动合成属性器之前，需要手写 getter 与 setter 方法。在Xcode有自动合成属性器后，编译器会自动生成一个以下划线开头的的实例变量，所以不必同时声明属性与变量。即可以直接用 @property 声明一个成员属性，在 .m 文件中无需使用 @systhesize，Xcode 会自动生成 getter 与 setter.\n\n```objc \n@interface Test : NSObject{\n    NSString *_test;\n}\n@property (strong, nonatomic) NSString *mystr; \n```\n同时在.m文件中插入\n```objc \n@synthesize mystr = _myStr;\n```\n\n3. 直接用@property声明。该方法声明的成员变量能够在类内部和外部使用，在类的内部可以通过下划线+变量名 或 self.变量名 的方式来访问变量。\n\n```objc \n@interface Test : NSObject{\n}\n@property (strong, nonatomic) NSString *test;\n```\n同时在.m文件中插入\n```objc \n@synthesize test = _test;\n```\n\n### 参考\n[Objective-C 程序设计 (第六版)]()\n[Objective C中数组排序几种情况的总结](https://my.oschina.net/pengloo53/blog/173810)\n[Objective-C入门教程14：集合对象(NSSet,NSMutableSet,NSIndexSet)](https://liuzhichao.com/p/1256.html)\n[iOS中四种实例变量的范围类型](https://www.cnblogs.com/stevenwuzheng/p/4605232.html)\n[OC声明变量在@interface括号中与使用@property的区别](https://blog.csdn.net/shenjie12345678/article/details/39052659)\n","slug":"Objc_Learning_6","published":1,"updated":"2022-07-24T15:20:53.942Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp1z001do76fgv9d1818","content":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第六篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中关于数组排序、字典对象以及集合对象的内容。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"关于数组排序\"><a href=\"#关于数组排序\" class=\"headerlink\" title=\"关于数组排序\"></a>关于数组排序</h3><h4 id=\"简单排序示例\"><a href=\"#简单排序示例\" class=\"headerlink\" title=\"简单排序示例\"></a>简单排序示例</h4><p><code>Objective-C</code> 中对于 NSArray 排序方法主要有以下几种。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sortedArrayUsingSelector:</span><br><span class=\"line\">sortedArrayUsingComparator:</span><br><span class=\"line\">sortedArrayUsingDescriptors:</span><br></pre></td></tr></table></figure>\n<p>给出前两者排序的简单示例，如果只是对字符串简单做排序，sortedArrayUsingSelector:方法已足够，sortedArrayUsingComparator: 中用到了block内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *array = [<span class=\"built_in\">NSArray</span> arrayWithObjects:<span class=\"string\">@&quot;abc&quot;</span>,<span class=\"string\">@&quot;456&quot;</span>,<span class=\"string\">@&quot;123&quot;</span>,<span class=\"string\">@&quot;789&quot;</span>,<span class=\"string\">@&quot;ef&quot;</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//sortedArrayUsingSelector</span></span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *sortedArray1 = [array sortedArrayUsingSelector:<span class=\"keyword\">@selector</span>(compare:)];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;SortedArray1:&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,sortedArray1);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//sortedArrayUsingComparator:</span></span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *sortedArray2 = [array sortedArrayUsingComparator:^<span class=\"built_in\">NSComparisonResult</span>(<span class=\"keyword\">id</span> obj1, <span class=\"keyword\">id</span> obj2) &#123;</span><br><span class=\"line\">             <span class=\"built_in\">NSComparisonResult</span> result = [obj1 compare:obj2];</span><br><span class=\"line\">             <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">         &#125;];</span><br><span class=\"line\">         <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;SortedArray2:&quot;</span>);</span><br><span class=\"line\">         <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,sortedArray2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用区块排序\"><a href=\"#使用区块排序\" class=\"headerlink\" title=\"使用区块排序\"></a>使用区块排序</h4><p>NSArray和NSMutableArray类中具有使用区块对数组中元素进行排序的方法。<br>NSArray的排序方法一般格式为: </p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSArray</span> *) sortedArrayUsingComparator: (<span class=\"built_in\">NSComparator</span>) block</span><br></pre></td></tr></table></figure>\n<p>NSMutableArray的排序方法格式为: </p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>) sortUsingComparator: (<span class=\"built_in\">NSComparator</span>) block</span><br></pre></td></tr></table></figure>\n<p>NSComparator作为typedef定义在系统头文件中:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NSComparisonResult</span> (^<span class=\"built_in\">NSComparator</span>) (<span class=\"keyword\">id</span> obj1, <span class=\"keyword\">id</span> obj2);</span><br></pre></td></tr></table></figure>\n\n<p>NSComparator是一个区块，使用两个待比较对象作为参数，并返回 NSComparisonResult 类型的值。预期会返回一个标识，说明第一个对象是否小于、等于或者大于第二个对象，这一点与不使用区块的数组排序方法是一致的。区块对于大数组排序能够提升一些速度，可以考虑在程序中使用。</p>\n<h4 id=\"关于描述器排序\"><a href=\"#关于描述器排序\" class=\"headerlink\" title=\"关于描述器排序\"></a>关于描述器排序</h4><p>给出使用描述器排序的一个代码样例。<br>代码中定义了三种车与五个人，并将车与人的信息载入数组，通过构建排序描述器，将排序描述器按照一定顺序放入数组，最后能够按照你所期望的顺序对信息进行输出，因为代码中重写了description，故能够按照格式进行输出。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Person.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">            Car *car1 = [Car initWithName:<span class=\"string\">@&quot;Audio&quot;</span>];</span><br><span class=\"line\">            Car *car2 = [Car initWithName:<span class=\"string\">@&quot;Rolls-Royce&quot;</span>];</span><br><span class=\"line\">            Car *car3 = [Car initWithName:<span class=\"string\">@&quot;BMW&quot;</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            Person *p1 = [Person personWithAge:<span class=\"number\">23</span> withName:<span class=\"string\">@&quot;zhangsan&quot;</span> withCar:car2];</span><br><span class=\"line\">            Person *p2 = [Person personWithAge:<span class=\"number\">21</span> withName:<span class=\"string\">@&quot;zhangsan&quot;</span> withCar:car1];</span><br><span class=\"line\">            Person *p3 = [Person personWithAge:<span class=\"number\">24</span> withName:<span class=\"string\">@&quot;lisi&quot;</span> withCar:car1];</span><br><span class=\"line\">            Person *p4 = [Person personWithAge:<span class=\"number\">23</span> withName:<span class=\"string\">@&quot;wangwu&quot;</span> withCar:car3];</span><br><span class=\"line\">            Person *p5 = [Person personWithAge:<span class=\"number\">23</span> withName:<span class=\"string\">@&quot;wangwu&quot;</span> withCar:car2];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">NSArray</span> *array = [<span class=\"built_in\">NSArray</span> arrayWithObjects:p1,p2,p3,p4,p5, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">NSSortDescriptor</span> *carNameDesc = [<span class=\"built_in\">NSSortDescriptor</span> sortDescriptorWithKey:<span class=\"string\">@&quot;car.name&quot;</span> ascending:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">            <span class=\"built_in\">NSSortDescriptor</span> *personNameDesc = [<span class=\"built_in\">NSSortDescriptor</span> sortDescriptorWithKey:<span class=\"string\">@&quot;name&quot;</span> ascending:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">            <span class=\"built_in\">NSSortDescriptor</span> *personAgeDesc = [<span class=\"built_in\">NSSortDescriptor</span> sortDescriptorWithKey:<span class=\"string\">@&quot;age&quot;</span> ascending:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">NSArray</span> *descriptorArray = [<span class=\"built_in\">NSArray</span> arrayWithObjects:personAgeDesc,carNameDesc,personNameDesc, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">NSArray</span> *sortedArray = [array sortedArrayUsingDescriptors: descriptorArray];</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,sortedArray);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Car.h</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Car</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"><span class=\"keyword\">@property</span>(<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSString</span> *name;</span><br><span class=\"line\">+(Car *)initWithName:(<span class=\"built_in\">NSString</span> *)name;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Person.h</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Person</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> age;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *name;</span><br><span class=\"line\">    Car *car;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">+(Person *)personWithAge:(<span class=\"keyword\">int</span>)age withName:(<span class=\"built_in\">NSString</span> *)name withCar:(Car *)car;</span><br><span class=\"line\">-(<span class=\"built_in\">NSString</span> *)description;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Car.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Car</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@synthesize</span> name = _name;</span><br><span class=\"line\"></span><br><span class=\"line\">+(Car *)initWithName:(<span class=\"built_in\">NSString</span> *)name&#123;</span><br><span class=\"line\">    Car *car = [[Car alloc] init];</span><br><span class=\"line\">    car.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> car;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Person.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Person.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">+(Person *)personWithAge:(<span class=\"keyword\">int</span>)age withName:(<span class=\"built_in\">NSString</span> *)name withCar:(Car *)car&#123;</span><br><span class=\"line\">    Person *person = [[Person alloc] init];</span><br><span class=\"line\">    person-&gt;age = age;</span><br><span class=\"line\">    person-&gt;name = name;</span><br><span class=\"line\">    person-&gt;car = car;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> person;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"built_in\">NSString</span> *)description&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@&quot;age is %i , name is %@, car is %@&quot;</span>,age,name,car.name];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-04-17 17:04:05.775056+0800 DemoProgram[55124:1325210] (</span><br><span class=\"line\">    &quot;age is 21 , name is zhangsan, car is Audio&quot;,</span><br><span class=\"line\">    &quot;age is 23 , name is wangwu, car is BMW&quot;,</span><br><span class=\"line\">    &quot;age is 23 , name is wangwu, car is Rolls-Royce&quot;,</span><br><span class=\"line\">    &quot;age is 23 , name is zhangsan, car is Rolls-Royce&quot;,</span><br><span class=\"line\">    &quot;age is 24 , name is lisi, car is Audio&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关于字典对象\"><a href=\"#关于字典对象\" class=\"headerlink\" title=\"关于字典对象\"></a>关于字典对象</h3><p>词典 (dictionary) 是由键——对象对组成的数据集合。通过对象的键可以从<code>Objective-C</code>词典中获取需要的对象。词典中的键必须是单值的，通常它们是字符串，但也可以是其他对象类型。和键关联的值可以是任何对象类型，但不能是nil。词典可以是固定的，也可以是可变的。可变词典中的记录可以动态添加和删除。可以使用键检索词典，也可以枚举它们的内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableDictionary</span> *dict = [<span class=\"built_in\">NSMutableDictionary</span> dictionary];</span><br><span class=\"line\">        dict[<span class=\"string\">@&quot;key1&quot;</span>] = <span class=\"string\">@&quot;This is key 1&quot;</span>;</span><br><span class=\"line\">        dict[<span class=\"string\">@&quot;key2&quot;</span>] = <span class=\"string\">@&quot;This is key 2&quot;</span>;</span><br><span class=\"line\">        dict[<span class=\"string\">@&quot;key3&quot;</span>] = <span class=\"string\">@&quot;This is key 3&quot;</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 1: %@&quot;</span>,dict[<span class=\"string\">@&quot;key1&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 2: %@&quot;</span>,dict[<span class=\"string\">@&quot;key2&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 3: %@&quot;</span>,dict[<span class=\"string\">@&quot;key3&quot;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableDictionary</span> *dict = [<span class=\"built_in\">NSMutableDictionary</span> dictionary];</span><br><span class=\"line\">        [dict setObject:<span class=\"string\">@&quot;This is key 1&quot;</span> forKey:<span class=\"string\">@&quot;key1&quot;</span>];</span><br><span class=\"line\">        [dict setObject:<span class=\"string\">@&quot;This is key 1&quot;</span> forKey:<span class=\"string\">@&quot;key2&quot;</span>];</span><br><span class=\"line\">        [dict setObject:<span class=\"string\">@&quot;This is key 3&quot;</span> forKey:<span class=\"string\">@&quot;key3&quot;</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 1: %@&quot;</span>,[dict objectForKey:<span class=\"string\">@&quot;key1&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 2: %@&quot;</span>,[dict objectForKey:<span class=\"string\">@&quot;key2&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 3: %@&quot;</span>,[dict objectForKey:<span class=\"string\">@&quot;key3&quot;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>需要注意的是若Key存在重复则会出现无法显示某一重复Key问题.<br>创建词典后可以利用循环语句枚举词典的内容。<br>键从词典中依次检索,没有特定顺序。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSDictionary</span> *dict = [<span class=\"built_in\">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class=\"line\">                                     <span class=\"string\">@&quot;This is key 1&quot;</span>,<span class=\"string\">@&quot;key1&quot;</span>,</span><br><span class=\"line\">                                     <span class=\"string\">@&quot;This is key 2&quot;</span>,<span class=\"string\">@&quot;key2&quot;</span>,</span><br><span class=\"line\">                                     <span class=\"string\">@&quot;This is key 3&quot;</span>,<span class=\"string\">@&quot;key3&quot;</span>,</span><br><span class=\"line\">                              <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">NSDictionary</span> *dictItem <span class=\"keyword\">in</span> dict ) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@:%@&quot;</span>,dictItem,[dict objectForKey:dictItem]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"关于集合对象\"><a href=\"#关于集合对象\" class=\"headerlink\" title=\"关于集合对象\"></a>关于集合对象</h3><p>Set是一组单值对象集合，可以是可变的，也可以是不变的。Set的操作包括搜索、添加、删除集合中的成员(仅用于可变集合)，比较两个集合，计算两个集合的交集和并集等，这些操作在示例程序中得以体现。</p>\n<p>需要注意的是 NSCountedSet，该Set中同一对象可以出现多次，然而在 NSCountedSet 中并非存放了多个对象，而是维护一个次数计数。第一次将对象添加到集合中时，对象的 count 值被置为1,然后每次将该对象添加到集合中 count 值就会增1, 相应地，每次从集合删除对象，count 值就会减1。当对象的 count 值为零时，实际上对象本身就被删除了。</p>\n<p>示例程序对 NSSet、 NSMutableSet、NSCountedSet 和 NSIndexSet进行了演示。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">NSSet</span> (<span class=\"title\">Printing</span>)</span></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSSet</span> (<span class=\"title\">Printing</span>)</span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>) print &#123;</span><br><span class=\"line\">    printf(<span class=\"string\">&quot;&#123;&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">NSNumber</span> *element <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>)</span><br><span class=\"line\">        printf(<span class=\"string\">&quot;%li&quot;</span>,(<span class=\"keyword\">long</span>)[element integerValue]);</span><br><span class=\"line\">    printf(<span class=\"string\">&quot;&#125;\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableSet</span> *set1 = [<span class=\"built_in\">NSMutableSet</span> setWithObjects:@<span class=\"number\">1</span>, @<span class=\"number\">3</span>, @<span class=\"number\">5</span>,  @<span class=\"number\">7</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSSet</span> *set2 = [<span class=\"built_in\">NSSet</span> setWithObjects:@<span class=\"number\">2</span>, @<span class=\"number\">4</span>, @<span class=\"number\">6</span>, @<span class=\"number\">8</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSCountedSet</span> *set3 = [<span class=\"built_in\">NSCountedSet</span> setWithObjects:@<span class=\"number\">1</span>, @<span class=\"number\">1</span>, @<span class=\"number\">3</span>, @<span class=\"number\">5</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"built_in\">NSIndexSet</span> * indexSet1 = [[<span class=\"built_in\">NSIndexSet</span> alloc] initWithIndexesInRange:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">1</span>,<span class=\"number\">3</span>)];</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableIndexSet</span> *indexSet2 =[[<span class=\"built_in\">NSMutableIndexSet</span> alloc] init];</span><br><span class=\"line\">        [indexSet2 addIndex:<span class=\"number\">0</span>];</span><br><span class=\"line\">        [indexSet2 addIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">        [indexSet2 addIndex:<span class=\"number\">5</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> index;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;IndexSet1:&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (index = [indexSet1 firstIndex];</span><br><span class=\"line\">             index != <span class=\"built_in\">NSNotFound</span>;</span><br><span class=\"line\">             index = [indexSet1 indexGreaterThanIndex: index])  &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%lu&quot;</span>,index);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;IndexSet2:&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (index = [indexSet2 firstIndex];</span><br><span class=\"line\">             index != <span class=\"built_in\">NSNotFound</span>;</span><br><span class=\"line\">             index = [indexSet2 indexGreaterThanIndex: index])  &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%lu&quot;</span>,index);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set1:&quot;</span>);</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set2:&quot;</span>);</span><br><span class=\"line\">        [set2 print];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set3:&quot;</span>);</span><br><span class=\"line\">        [set3 print];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([set1 isEqualToSet: set2] == <span class=\"literal\">YES</span>)</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set 1 equals set2&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set 1 is not equal to Set2&quot;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([set1 containsObject: @<span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set1 contains element 1&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set1 does not contains element 1&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The count of 1 in Set3: %lu&quot;</span>,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)[set3 countForObject:@<span class=\"number\">1</span>]);</span><br><span class=\"line\">        [set1 addObject:@<span class=\"number\">2</span>];</span><br><span class=\"line\">        [set1 removeObject:@<span class=\"number\">1</span>];</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        [set1 intersectSet:set2];</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        [set1 unionSet:set2];</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>相应的运行结果为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-04-17 11:40:23.646162+0800 DemoProgram[51926:1202542] IndexSet1:</span><br><span class=\"line\">2020-04-17 11:40:23.646584+0800 DemoProgram[51926:1202542] 1</span><br><span class=\"line\">2020-04-17 11:40:23.646627+0800 DemoProgram[51926:1202542] 2</span><br><span class=\"line\">2020-04-17 11:40:23.646679+0800 DemoProgram[51926:1202542] 3</span><br><span class=\"line\">2020-04-17 11:40:23.646733+0800 DemoProgram[51926:1202542] IndexSet2:</span><br><span class=\"line\">2020-04-17 11:40:23.646762+0800 DemoProgram[51926:1202542] 0</span><br><span class=\"line\">2020-04-17 11:40:23.646786+0800 DemoProgram[51926:1202542] 3</span><br><span class=\"line\">2020-04-17 11:40:23.646808+0800 DemoProgram[51926:1202542] 5</span><br><span class=\"line\">2020-04-17 11:40:23.646825+0800 DemoProgram[51926:1202542] Set1:</span><br><span class=\"line\">&#123;7351&#125;</span><br><span class=\"line\">2020-04-17 11:40:23.646871+0800 DemoProgram[51926:1202542] Set2:</span><br><span class=\"line\">&#123;6284&#125;</span><br><span class=\"line\">2020-04-17 11:40:23.646898+0800 DemoProgram[51926:1202542] Set3:</span><br><span class=\"line\">&#123;315&#125;</span><br><span class=\"line\">2020-04-17 11:40:23.646934+0800 DemoProgram[51926:1202542] Set 1 is not equal to Set2</span><br><span class=\"line\">2020-04-17 11:40:23.646957+0800 DemoProgram[51926:1202542] Set1 contains element 1</span><br><span class=\"line\">2020-04-17 11:40:23.646979+0800 DemoProgram[51926:1202542] The count of 1 in Set3: 2</span><br><span class=\"line\">&#123;7325&#125;</span><br><span class=\"line\">&#123;2&#125;</span><br><span class=\"line\">&#123;6284&#125;</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他总结\"><a href=\"#其他总结\" class=\"headerlink\" title=\"其他总结\"></a>其他总结</h3><p>根据写代码过程中遇到的一些问题查找的答案做一些阶段性总结。</p>\n<h4 id=\"实例变量的范围类型\"><a href=\"#实例变量的范围类型\" class=\"headerlink\" title=\"实例变量的范围类型\"></a>实例变量的范围类型</h4><p><strong>@private</strong><br>该类型的实例变量只有声明它的类能够访问它。<br><strong>@protected</strong><br>该类型的实例变量能被声明它的类和子类访问。<br>所有没有显式标识范围的实例变量默认为 @protected。<br><strong>@public</strong><br>该类型实例变量可以在任何地方被访问。<br><strong>@package</strong><br>在modern runtime下，@package 实例变量的范围在实现这个类的可执行文件镜像中是@public，但是在实现这个类的可执行文件镜像外部是 @private。<br>Objective-C 中的 @package 与 C 语言中变量和函数的 private_extern 类似，任何在实现类的镜像外的代码想使用这个实例变量都会引发link error错误。<br>@package 对于框架类的实例变量十分受用，在这种环境下使用 @private 可能太受限制，使用@protected 或者 @public 又过于开放。@package 类型的变量在 Framework 内部相当于 @protected，在 Framework 外部，相当于@private。</p>\n<h4 id=\"类方法与实例方法\"><a href=\"#类方法与实例方法\" class=\"headerlink\" title=\"类方法与实例方法\"></a>类方法与实例方法</h4><ul>\n<li>实例方法在类的具体实例的范围内执行，在调用一个实例方法前必须首先创建类的实例。需要在方法声明前加上“-”，表示实例（对象）方法 (动态方法)。</li>\n<li>类方法不需要创建实例，不依赖于对象，直接用类名调用，执行效率较高；当方法内部不需要使用成员变量时，就可以使用类方法。需要在方法生命前加上“-”，表示类方法 (静态方法)。</li>\n</ul>\n<h4 id=\"声明方式\"><a href=\"#声明方式\" class=\"headerlink\" title=\"声明方式\"></a>声明方式</h4><p>在网上查找资料时发现属性声明存在三种方式，通过查资料对三种方式进行总结</p>\n<ol>\n<li>直接在 @interface 中声明。该方法声明的成员变量只能在类内部使用，即不能通过类名. 点的方式访问变量，需要使用 -&gt; 的方式。</li>\n</ol>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Test</span> : <span class=\"title\">NSObject</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *test;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>在@interface中声明，然后再在@property中声明。该方法为过时的声明变量方式，Xcode 在早期 @systhesize 没有自动合成属性器之前，需要手写 getter 与 setter 方法。在Xcode有自动合成属性器后，编译器会自动生成一个以下划线开头的的实例变量，所以不必同时声明属性与变量。即可以直接用 @property 声明一个成员属性，在 .m 文件中无需使用 @systhesize，Xcode 会自动生成 getter 与 setter.</li>\n</ol>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Test</span> : <span class=\"title\">NSObject</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *_test;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *mystr; </span><br></pre></td></tr></table></figure>\n<p>同时在.m文件中插入</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synthesize</span> mystr = _myStr;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>直接用@property声明。该方法声明的成员变量能够在类内部和外部使用，在类的内部可以通过下划线+变量名 或 self.变量名 的方式来访问变量。</li>\n</ol>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Test</span> : <span class=\"title\">NSObject</span></span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *test;</span><br></pre></td></tr></table></figure>\n<p>同时在.m文件中插入</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synthesize</span> test = _test;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a><br><a href=\"https://my.oschina.net/pengloo53/blog/173810\">Objective C中数组排序几种情况的总结</a><br><a href=\"https://liuzhichao.com/p/1256.html\">Objective-C入门教程14：集合对象(NSSet,NSMutableSet,NSIndexSet)</a><br><a href=\"https://www.cnblogs.com/stevenwuzheng/p/4605232.html\">iOS中四种实例变量的范围类型</a><br><a href=\"https://blog.csdn.net/shenjie12345678/article/details/39052659\">OC声明变量在@interface括号中与使用@property的区别</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第六篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中关于数组排序、字典对象以及集合对象的内容。</p>","more":"<h3 id=\"关于数组排序\"><a href=\"#关于数组排序\" class=\"headerlink\" title=\"关于数组排序\"></a>关于数组排序</h3><h4 id=\"简单排序示例\"><a href=\"#简单排序示例\" class=\"headerlink\" title=\"简单排序示例\"></a>简单排序示例</h4><p><code>Objective-C</code> 中对于 NSArray 排序方法主要有以下几种。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sortedArrayUsingSelector:</span><br><span class=\"line\">sortedArrayUsingComparator:</span><br><span class=\"line\">sortedArrayUsingDescriptors:</span><br></pre></td></tr></table></figure>\n<p>给出前两者排序的简单示例，如果只是对字符串简单做排序，sortedArrayUsingSelector:方法已足够，sortedArrayUsingComparator: 中用到了block内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *array = [<span class=\"built_in\">NSArray</span> arrayWithObjects:<span class=\"string\">@&quot;abc&quot;</span>,<span class=\"string\">@&quot;456&quot;</span>,<span class=\"string\">@&quot;123&quot;</span>,<span class=\"string\">@&quot;789&quot;</span>,<span class=\"string\">@&quot;ef&quot;</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//sortedArrayUsingSelector</span></span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *sortedArray1 = [array sortedArrayUsingSelector:<span class=\"keyword\">@selector</span>(compare:)];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;SortedArray1:&quot;</span>);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,sortedArray1);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//sortedArrayUsingComparator:</span></span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *sortedArray2 = [array sortedArrayUsingComparator:^<span class=\"built_in\">NSComparisonResult</span>(<span class=\"keyword\">id</span> obj1, <span class=\"keyword\">id</span> obj2) &#123;</span><br><span class=\"line\">             <span class=\"built_in\">NSComparisonResult</span> result = [obj1 compare:obj2];</span><br><span class=\"line\">             <span class=\"keyword\">return</span> result;</span><br><span class=\"line\">         &#125;];</span><br><span class=\"line\">         <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;SortedArray2:&quot;</span>);</span><br><span class=\"line\">         <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,sortedArray2);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h4 id=\"使用区块排序\"><a href=\"#使用区块排序\" class=\"headerlink\" title=\"使用区块排序\"></a>使用区块排序</h4><p>NSArray和NSMutableArray类中具有使用区块对数组中元素进行排序的方法。<br>NSArray的排序方法一般格式为: </p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"built_in\">NSArray</span> *) sortedArrayUsingComparator: (<span class=\"built_in\">NSComparator</span>) block</span><br></pre></td></tr></table></figure>\n<p>NSMutableArray的排序方法格式为: </p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>) sortUsingComparator: (<span class=\"built_in\">NSComparator</span>) block</span><br></pre></td></tr></table></figure>\n<p>NSComparator作为typedef定义在系统头文件中:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NSComparisonResult</span> (^<span class=\"built_in\">NSComparator</span>) (<span class=\"keyword\">id</span> obj1, <span class=\"keyword\">id</span> obj2);</span><br></pre></td></tr></table></figure>\n\n<p>NSComparator是一个区块，使用两个待比较对象作为参数，并返回 NSComparisonResult 类型的值。预期会返回一个标识，说明第一个对象是否小于、等于或者大于第二个对象，这一点与不使用区块的数组排序方法是一致的。区块对于大数组排序能够提升一些速度，可以考虑在程序中使用。</p>\n<h4 id=\"关于描述器排序\"><a href=\"#关于描述器排序\" class=\"headerlink\" title=\"关于描述器排序\"></a>关于描述器排序</h4><p>给出使用描述器排序的一个代码样例。<br>代码中定义了三种车与五个人，并将车与人的信息载入数组，通过构建排序描述器，将排序描述器按照一定顺序放入数组，最后能够按照你所期望的顺序对信息进行输出，因为代码中重写了description，故能够按照格式进行输出。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//main.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Person.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">            Car *car1 = [Car initWithName:<span class=\"string\">@&quot;Audio&quot;</span>];</span><br><span class=\"line\">            Car *car2 = [Car initWithName:<span class=\"string\">@&quot;Rolls-Royce&quot;</span>];</span><br><span class=\"line\">            Car *car3 = [Car initWithName:<span class=\"string\">@&quot;BMW&quot;</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            Person *p1 = [Person personWithAge:<span class=\"number\">23</span> withName:<span class=\"string\">@&quot;zhangsan&quot;</span> withCar:car2];</span><br><span class=\"line\">            Person *p2 = [Person personWithAge:<span class=\"number\">21</span> withName:<span class=\"string\">@&quot;zhangsan&quot;</span> withCar:car1];</span><br><span class=\"line\">            Person *p3 = [Person personWithAge:<span class=\"number\">24</span> withName:<span class=\"string\">@&quot;lisi&quot;</span> withCar:car1];</span><br><span class=\"line\">            Person *p4 = [Person personWithAge:<span class=\"number\">23</span> withName:<span class=\"string\">@&quot;wangwu&quot;</span> withCar:car3];</span><br><span class=\"line\">            Person *p5 = [Person personWithAge:<span class=\"number\">23</span> withName:<span class=\"string\">@&quot;wangwu&quot;</span> withCar:car2];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"built_in\">NSArray</span> *array = [<span class=\"built_in\">NSArray</span> arrayWithObjects:p1,p2,p3,p4,p5, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">NSSortDescriptor</span> *carNameDesc = [<span class=\"built_in\">NSSortDescriptor</span> sortDescriptorWithKey:<span class=\"string\">@&quot;car.name&quot;</span> ascending:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">            <span class=\"built_in\">NSSortDescriptor</span> *personNameDesc = [<span class=\"built_in\">NSSortDescriptor</span> sortDescriptorWithKey:<span class=\"string\">@&quot;name&quot;</span> ascending:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">            <span class=\"built_in\">NSSortDescriptor</span> *personAgeDesc = [<span class=\"built_in\">NSSortDescriptor</span> sortDescriptorWithKey:<span class=\"string\">@&quot;age&quot;</span> ascending:<span class=\"literal\">YES</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">NSArray</span> *descriptorArray = [<span class=\"built_in\">NSArray</span> arrayWithObjects:personAgeDesc,carNameDesc,personNameDesc, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">            </span><br><span class=\"line\">            <span class=\"built_in\">NSArray</span> *sortedArray = [array sortedArrayUsingDescriptors: descriptorArray];</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,sortedArray);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Car.h</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Car</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\"><span class=\"keyword\">@property</span>(<span class=\"keyword\">nonatomic</span>, <span class=\"keyword\">strong</span>) <span class=\"built_in\">NSString</span> *name;</span><br><span class=\"line\">+(Car *)initWithName:(<span class=\"built_in\">NSString</span> *)name;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Person.h</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Person</span> : <span class=\"title\">NSObject</span></span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> age;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *name;</span><br><span class=\"line\">    Car *car;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">+(Person *)personWithAge:(<span class=\"keyword\">int</span>)age withName:(<span class=\"built_in\">NSString</span> *)name withCar:(Car *)car;</span><br><span class=\"line\">-(<span class=\"built_in\">NSString</span> *)description;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Car.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Car</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@synthesize</span> name = _name;</span><br><span class=\"line\"></span><br><span class=\"line\">+(Car *)initWithName:(<span class=\"built_in\">NSString</span> *)name&#123;</span><br><span class=\"line\">    Car *car = [[Car alloc] init];</span><br><span class=\"line\">    car.name = name;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> car;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//Person.m</span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Person.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&quot;Car.h&quot;</span></span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">Person</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">+(Person *)personWithAge:(<span class=\"keyword\">int</span>)age withName:(<span class=\"built_in\">NSString</span> *)name withCar:(Car *)car&#123;</span><br><span class=\"line\">    Person *person = [[Person alloc] init];</span><br><span class=\"line\">    person-&gt;age = age;</span><br><span class=\"line\">    person-&gt;name = name;</span><br><span class=\"line\">    person-&gt;car = car;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> person;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">-(<span class=\"built_in\">NSString</span> *)description&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> [<span class=\"built_in\">NSString</span> stringWithFormat:<span class=\"string\">@&quot;age is %i , name is %@, car is %@&quot;</span>,age,name,car.name];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-04-17 17:04:05.775056+0800 DemoProgram[55124:1325210] (</span><br><span class=\"line\">    &quot;age is 21 , name is zhangsan, car is Audio&quot;,</span><br><span class=\"line\">    &quot;age is 23 , name is wangwu, car is BMW&quot;,</span><br><span class=\"line\">    &quot;age is 23 , name is wangwu, car is Rolls-Royce&quot;,</span><br><span class=\"line\">    &quot;age is 23 , name is zhangsan, car is Rolls-Royce&quot;,</span><br><span class=\"line\">    &quot;age is 24 , name is lisi, car is Audio&quot;</span><br><span class=\"line\">)</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"关于字典对象\"><a href=\"#关于字典对象\" class=\"headerlink\" title=\"关于字典对象\"></a>关于字典对象</h3><p>词典 (dictionary) 是由键——对象对组成的数据集合。通过对象的键可以从<code>Objective-C</code>词典中获取需要的对象。词典中的键必须是单值的，通常它们是字符串，但也可以是其他对象类型。和键关联的值可以是任何对象类型，但不能是nil。词典可以是固定的，也可以是可变的。可变词典中的记录可以动态添加和删除。可以使用键检索词典，也可以枚举它们的内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableDictionary</span> *dict = [<span class=\"built_in\">NSMutableDictionary</span> dictionary];</span><br><span class=\"line\">        dict[<span class=\"string\">@&quot;key1&quot;</span>] = <span class=\"string\">@&quot;This is key 1&quot;</span>;</span><br><span class=\"line\">        dict[<span class=\"string\">@&quot;key2&quot;</span>] = <span class=\"string\">@&quot;This is key 2&quot;</span>;</span><br><span class=\"line\">        dict[<span class=\"string\">@&quot;key3&quot;</span>] = <span class=\"string\">@&quot;This is key 3&quot;</span>;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 1: %@&quot;</span>,dict[<span class=\"string\">@&quot;key1&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 2: %@&quot;</span>,dict[<span class=\"string\">@&quot;key2&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 3: %@&quot;</span>,dict[<span class=\"string\">@&quot;key3&quot;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableDictionary</span> *dict = [<span class=\"built_in\">NSMutableDictionary</span> dictionary];</span><br><span class=\"line\">        [dict setObject:<span class=\"string\">@&quot;This is key 1&quot;</span> forKey:<span class=\"string\">@&quot;key1&quot;</span>];</span><br><span class=\"line\">        [dict setObject:<span class=\"string\">@&quot;This is key 1&quot;</span> forKey:<span class=\"string\">@&quot;key2&quot;</span>];</span><br><span class=\"line\">        [dict setObject:<span class=\"string\">@&quot;This is key 3&quot;</span> forKey:<span class=\"string\">@&quot;key3&quot;</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 1: %@&quot;</span>,[dict objectForKey:<span class=\"string\">@&quot;key1&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 2: %@&quot;</span>,[dict objectForKey:<span class=\"string\">@&quot;key2&quot;</span>]);</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Key note for Key 3: %@&quot;</span>,[dict objectForKey:<span class=\"string\">@&quot;key3&quot;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>需要注意的是若Key存在重复则会出现无法显示某一重复Key问题.<br>创建词典后可以利用循环语句枚举词典的内容。<br>键从词典中依次检索,没有特定顺序。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSDictionary</span> *dict = [<span class=\"built_in\">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class=\"line\">                                     <span class=\"string\">@&quot;This is key 1&quot;</span>,<span class=\"string\">@&quot;key1&quot;</span>,</span><br><span class=\"line\">                                     <span class=\"string\">@&quot;This is key 2&quot;</span>,<span class=\"string\">@&quot;key2&quot;</span>,</span><br><span class=\"line\">                                     <span class=\"string\">@&quot;This is key 3&quot;</span>,<span class=\"string\">@&quot;key3&quot;</span>,</span><br><span class=\"line\">                              <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"built_in\">NSDictionary</span> *dictItem <span class=\"keyword\">in</span> dict ) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@:%@&quot;</span>,dictItem,[dict objectForKey:dictItem]);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"关于集合对象\"><a href=\"#关于集合对象\" class=\"headerlink\" title=\"关于集合对象\"></a>关于集合对象</h3><p>Set是一组单值对象集合，可以是可变的，也可以是不变的。Set的操作包括搜索、添加、删除集合中的成员(仅用于可变集合)，比较两个集合，计算两个集合的交集和并集等，这些操作在示例程序中得以体现。</p>\n<p>需要注意的是 NSCountedSet，该Set中同一对象可以出现多次，然而在 NSCountedSet 中并非存放了多个对象，而是维护一个次数计数。第一次将对象添加到集合中时，对象的 count 值被置为1,然后每次将该对象添加到集合中 count 值就会增1, 相应地，每次从集合删除对象，count 值就会减1。当对象的 count 值为零时，实际上对象本身就被删除了。</p>\n<p>示例程序对 NSSet、 NSMutableSet、NSCountedSet 和 NSIndexSet进行了演示。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">NSSet</span> (<span class=\"title\">Printing</span>)</span></span><br><span class=\"line\">-(<span class=\"keyword\">void</span>) print;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@implementation</span> <span class=\"title\">NSSet</span> (<span class=\"title\">Printing</span>)</span></span><br><span class=\"line\">- (<span class=\"keyword\">void</span>) print &#123;</span><br><span class=\"line\">    printf(<span class=\"string\">&quot;&#123;&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"built_in\">NSNumber</span> *element <span class=\"keyword\">in</span> <span class=\"keyword\">self</span>)</span><br><span class=\"line\">        printf(<span class=\"string\">&quot;%li&quot;</span>,(<span class=\"keyword\">long</span>)[element integerValue]);</span><br><span class=\"line\">    printf(<span class=\"string\">&quot;&#125;\\n&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@end</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableSet</span> *set1 = [<span class=\"built_in\">NSMutableSet</span> setWithObjects:@<span class=\"number\">1</span>, @<span class=\"number\">3</span>, @<span class=\"number\">5</span>,  @<span class=\"number\">7</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSSet</span> *set2 = [<span class=\"built_in\">NSSet</span> setWithObjects:@<span class=\"number\">2</span>, @<span class=\"number\">4</span>, @<span class=\"number\">6</span>, @<span class=\"number\">8</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSCountedSet</span> *set3 = [<span class=\"built_in\">NSCountedSet</span> setWithObjects:@<span class=\"number\">1</span>, @<span class=\"number\">1</span>, @<span class=\"number\">3</span>, @<span class=\"number\">5</span>, <span class=\"literal\">nil</span>];</span><br><span class=\"line\"> </span><br><span class=\"line\">        <span class=\"built_in\">NSIndexSet</span> * indexSet1 = [[<span class=\"built_in\">NSIndexSet</span> alloc] initWithIndexesInRange:<span class=\"built_in\">NSMakeRange</span>(<span class=\"number\">1</span>,<span class=\"number\">3</span>)];</span><br><span class=\"line\">        <span class=\"built_in\">NSMutableIndexSet</span> *indexSet2 =[[<span class=\"built_in\">NSMutableIndexSet</span> alloc] init];</span><br><span class=\"line\">        [indexSet2 addIndex:<span class=\"number\">0</span>];</span><br><span class=\"line\">        [indexSet2 addIndex:<span class=\"number\">3</span>];</span><br><span class=\"line\">        [indexSet2 addIndex:<span class=\"number\">5</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span> index;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;IndexSet1:&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (index = [indexSet1 firstIndex];</span><br><span class=\"line\">             index != <span class=\"built_in\">NSNotFound</span>;</span><br><span class=\"line\">             index = [indexSet1 indexGreaterThanIndex: index])  &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%lu&quot;</span>,index);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;IndexSet2:&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (index = [indexSet2 firstIndex];</span><br><span class=\"line\">             index != <span class=\"built_in\">NSNotFound</span>;</span><br><span class=\"line\">             index = [indexSet2 indexGreaterThanIndex: index])  &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%lu&quot;</span>,index);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set1:&quot;</span>);</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set2:&quot;</span>);</span><br><span class=\"line\">        [set2 print];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set3:&quot;</span>);</span><br><span class=\"line\">        [set3 print];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([set1 isEqualToSet: set2] == <span class=\"literal\">YES</span>)</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set 1 equals set2&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">else</span></span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set 1 is not equal to Set2&quot;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([set1 containsObject: @<span class=\"number\">1</span>])&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set1 contains element 1&quot;</span>);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Set1 does not contains element 1&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;The count of 1 in Set3: %lu&quot;</span>,(<span class=\"keyword\">unsigned</span> <span class=\"keyword\">long</span>)[set3 countForObject:@<span class=\"number\">1</span>]);</span><br><span class=\"line\">        [set1 addObject:@<span class=\"number\">2</span>];</span><br><span class=\"line\">        [set1 removeObject:@<span class=\"number\">1</span>];</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        [set1 intersectSet:set2];</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        [set1 unionSet:set2];</span><br><span class=\"line\">        [set1 print];</span><br><span class=\"line\">        </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>相应的运行结果为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2020-04-17 11:40:23.646162+0800 DemoProgram[51926:1202542] IndexSet1:</span><br><span class=\"line\">2020-04-17 11:40:23.646584+0800 DemoProgram[51926:1202542] 1</span><br><span class=\"line\">2020-04-17 11:40:23.646627+0800 DemoProgram[51926:1202542] 2</span><br><span class=\"line\">2020-04-17 11:40:23.646679+0800 DemoProgram[51926:1202542] 3</span><br><span class=\"line\">2020-04-17 11:40:23.646733+0800 DemoProgram[51926:1202542] IndexSet2:</span><br><span class=\"line\">2020-04-17 11:40:23.646762+0800 DemoProgram[51926:1202542] 0</span><br><span class=\"line\">2020-04-17 11:40:23.646786+0800 DemoProgram[51926:1202542] 3</span><br><span class=\"line\">2020-04-17 11:40:23.646808+0800 DemoProgram[51926:1202542] 5</span><br><span class=\"line\">2020-04-17 11:40:23.646825+0800 DemoProgram[51926:1202542] Set1:</span><br><span class=\"line\">&#123;7351&#125;</span><br><span class=\"line\">2020-04-17 11:40:23.646871+0800 DemoProgram[51926:1202542] Set2:</span><br><span class=\"line\">&#123;6284&#125;</span><br><span class=\"line\">2020-04-17 11:40:23.646898+0800 DemoProgram[51926:1202542] Set3:</span><br><span class=\"line\">&#123;315&#125;</span><br><span class=\"line\">2020-04-17 11:40:23.646934+0800 DemoProgram[51926:1202542] Set 1 is not equal to Set2</span><br><span class=\"line\">2020-04-17 11:40:23.646957+0800 DemoProgram[51926:1202542] Set1 contains element 1</span><br><span class=\"line\">2020-04-17 11:40:23.646979+0800 DemoProgram[51926:1202542] The count of 1 in Set3: 2</span><br><span class=\"line\">&#123;7325&#125;</span><br><span class=\"line\">&#123;2&#125;</span><br><span class=\"line\">&#123;6284&#125;</span><br><span class=\"line\">Program ended with exit code: 0</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"其他总结\"><a href=\"#其他总结\" class=\"headerlink\" title=\"其他总结\"></a>其他总结</h3><p>根据写代码过程中遇到的一些问题查找的答案做一些阶段性总结。</p>\n<h4 id=\"实例变量的范围类型\"><a href=\"#实例变量的范围类型\" class=\"headerlink\" title=\"实例变量的范围类型\"></a>实例变量的范围类型</h4><p><strong>@private</strong><br>该类型的实例变量只有声明它的类能够访问它。<br><strong>@protected</strong><br>该类型的实例变量能被声明它的类和子类访问。<br>所有没有显式标识范围的实例变量默认为 @protected。<br><strong>@public</strong><br>该类型实例变量可以在任何地方被访问。<br><strong>@package</strong><br>在modern runtime下，@package 实例变量的范围在实现这个类的可执行文件镜像中是@public，但是在实现这个类的可执行文件镜像外部是 @private。<br>Objective-C 中的 @package 与 C 语言中变量和函数的 private_extern 类似，任何在实现类的镜像外的代码想使用这个实例变量都会引发link error错误。<br>@package 对于框架类的实例变量十分受用，在这种环境下使用 @private 可能太受限制，使用@protected 或者 @public 又过于开放。@package 类型的变量在 Framework 内部相当于 @protected，在 Framework 外部，相当于@private。</p>\n<h4 id=\"类方法与实例方法\"><a href=\"#类方法与实例方法\" class=\"headerlink\" title=\"类方法与实例方法\"></a>类方法与实例方法</h4><ul>\n<li>实例方法在类的具体实例的范围内执行，在调用一个实例方法前必须首先创建类的实例。需要在方法声明前加上“-”，表示实例（对象）方法 (动态方法)。</li>\n<li>类方法不需要创建实例，不依赖于对象，直接用类名调用，执行效率较高；当方法内部不需要使用成员变量时，就可以使用类方法。需要在方法生命前加上“-”，表示类方法 (静态方法)。</li>\n</ul>\n<h4 id=\"声明方式\"><a href=\"#声明方式\" class=\"headerlink\" title=\"声明方式\"></a>声明方式</h4><p>在网上查找资料时发现属性声明存在三种方式，通过查资料对三种方式进行总结</p>\n<ol>\n<li>直接在 @interface 中声明。该方法声明的成员变量只能在类内部使用，即不能通过类名. 点的方式访问变量，需要使用 -&gt; 的方式。</li>\n</ol>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Test</span> : <span class=\"title\">NSObject</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *test;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ol>\n<li>在@interface中声明，然后再在@property中声明。该方法为过时的声明变量方式，Xcode 在早期 @systhesize 没有自动合成属性器之前，需要手写 getter 与 setter 方法。在Xcode有自动合成属性器后，编译器会自动生成一个以下划线开头的的实例变量，所以不必同时声明属性与变量。即可以直接用 @property 声明一个成员属性，在 .m 文件中无需使用 @systhesize，Xcode 会自动生成 getter 与 setter.</li>\n</ol>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Test</span> : <span class=\"title\">NSObject</span></span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">NSString</span> *_test;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *mystr; </span><br></pre></td></tr></table></figure>\n<p>同时在.m文件中插入</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synthesize</span> mystr = _myStr;</span><br></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li>直接用@property声明。该方法声明的成员变量能够在类内部和外部使用，在类的内部可以通过下划线+变量名 或 self.变量名 的方式来访问变量。</li>\n</ol>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">@interface</span> <span class=\"title\">Test</span> : <span class=\"title\">NSObject</span></span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">@property</span> (<span class=\"keyword\">strong</span>, <span class=\"keyword\">nonatomic</span>) <span class=\"built_in\">NSString</span> *test;</span><br></pre></td></tr></table></figure>\n<p>同时在.m文件中插入</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@synthesize</span> test = _test;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"\">Objective-C 程序设计 (第六版)</a><br><a href=\"https://my.oschina.net/pengloo53/blog/173810\">Objective C中数组排序几种情况的总结</a><br><a href=\"https://liuzhichao.com/p/1256.html\">Objective-C入门教程14：集合对象(NSSet,NSMutableSet,NSIndexSet)</a><br><a href=\"https://www.cnblogs.com/stevenwuzheng/p/4605232.html\">iOS中四种实例变量的范围类型</a><br><a href=\"https://blog.csdn.net/shenjie12345678/article/details/39052659\">OC声明变量在@interface括号中与使用@property的区别</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:53 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(六）","path":"2020/04/17/Objc_Learning_6/","eyeCatchImage":null,"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第六篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中关于数组排序、字典对象以及集合对象的内容。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-17T09:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-17T09:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":10704},{"title":"Objective-C 学习笔记(七）","date":"2020-04-19T15:43:20.000Z","copyright":true,"_content":"\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第七篇文章，主要复习了 `Objective-C` Foundation 框架中文件操作内容。\n\n<!--more-->\n\n### NSFileManager\nNSFileManager 类能够完成以下对于文件的操作\n- 创建一个新文件\n- 从现有文件中读取数据\n- 将数据写入文件\n- 重命名文件\n- 删除文件\n- 测试文件是否存在\n- 确定文件的大小和其他属性\n- 复制文件\n- 测试两个文件的内容是否相同\n其中大部分操作对于目录同样适用同样，然而调用的方法不同。\n\n首先给出常见的 NSFileManager文件方法\n![](http://image.stephenfang.me/mweb/15872236886233.jpg)\n\nattributesOfItemAtPath:path 方法返回一个包含指定文件属性的字典,属性字典包括各种信息，如文件的所有者、文件大小、文件的创建日期等。字典的每个属性可以通过键值提取，而所有的键都定义在头文件<Foundation/NSFileManager.h>中,如表示文件大小的键值为NSFileSize，以下列举了一部分常见属性。\n```\n   NSFileAttributeKey const NSFileType; ：\n   NSFileAttributeType const NSFileTypeDirectory;\n   NSFileAttributeType const NSFileTypeRegular;\n   NSFileAttributeKey const NSFileSize;\n   NSFileAttributeKey const NSFileModificationDate;  //修改时间\n   NSFileAttributeKey const NSFileCreationDate; //创建时间\n```\n使用以上方法在示例代码中实现了一些当前目录下的简单文件功能，须确保当前目录下 test.txt 已创建。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *fName = @\"test.txt\";\n        NSString *nName = @\"copy.txt\";\n        NSFileManager *fm;\n        NSDictionary *attr;\n        \n        fm = [NSFileManager defaultManager];\n        \n        if([fm fileExistsAtPath:fName] == NO){\n            NSLog(@\"File does not exist!\");\n            return 1;\n        }\n        \n        if([fm copyItemAtPath:fName toPath:nName error:NULL] == NO){\n            NSLog(@\"File copy failed!\");\n            return 2;\n        }\n        \n        if ([fm contentsEqualAtPath:fName andPath:nName] == NO){\n            NSLog(@\"Files are not equal\");\n            return 3;\n        }\n        if([fm moveItemAtPath:nName toPath:@\"new.txt\" error:NULL] == NO){\n            NSLog(@\"File renamed failed\");\n            return 4;\n        }\n        \n        if((attr = [fm attributesOfItemAtPath:fName error:NULL]) == nil){\n            NSLog(@\"Couldn't get file attributes!\");\n            return 5;\n        }\n        \n        NSLog(@\"File size is %llu bytes\",[[attr objectForKey:NSFileSize] unsignedLongLongValue]);\n        \n        if([fm removeItemAtPath:fName error:NULL] == NO){\n            NSLog(@\"File removal failed\");\n            return 6;\n        }\n        \n        NSLog(@\"All operations success!\");\n    }\n    return 0;\n}\n\n```\n书中给出了常见的 NSFileManager 目录方法\n![](http://image.stephenfang.me/mweb/15872698118240.jpg)\n\nmoveItemAtPath:toPath:方法可以将文件从一个目录移到另一个目录中，如果两个路径引用同一目录中的文件，其结果为重命名这个文件。使用示例代码实现了部分目录操作如下所示：\n\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *dname = @\"testdir\";\n        NSString *path;\n        NSFileManager *fm;\n        \n        fm = [NSFileManager defaultManager];\n        \n        path = [fm currentDirectoryPath];\n        NSLog(@\"Current Directory is: %@\",path);\n        \n        if([fm createDirectoryAtPath:dname withIntermediateDirectories:YES attributes:nil error:NULL] == NO){\n            NSLog(@\"Couldn't create directory!\");\n            return 1;\n        }\n        \n        if([fm moveItemAtPath:dname toPath:@\"newdir\" error:NULL] == NO){\n            NSLog(@\"Directory rename failed!\");\n            return 2;\n        }\n        \n        if([fm changeCurrentDirectoryPath:@\"newdir\"] == NO){\n            NSLog(@\"Change directory failed!\");\n            return 3;\n        }\n        \n        path = [fm currentDirectoryPath];;\n        NSLog(@\"Current Directory is: %@\",path);\n        \n        NSLog(@\"All operation completed.\");\n    }\n    return 0;\n}\n```\n\n### NSData\n在Foundation框架的 NSData 中提供了缓冲区的使用方式，包括设置缓冲区、数据读入缓冲区、将缓冲区数据写入文件等。\n使用 NSFileManager 对象的 contentsAtPath: 方法能够接收一个路径名,并将指定文件内容读入该方法创建的存储区，若读取成功则返回存储区对象，否则返回nil。方法 createFileAtPath: contents: attributes: 创建特定属性的文件并将指定的 NSData 对象内容写入该文件中。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSFileManager *fm;\n        NSData *data;\n        \n        data = [fm contentsAtPath:@\"new.txt\"];\n        \n        if(data == nil){\n            NSLog(@\"File read failed!\");\n            return 1;\n        }\n        \n        if([fm createFileAtPath:@\"another.txt\" contents:data attributes:nil] == NO){\n            NSLog(@\"Couldn't create the copy!\");\n            return 2;\n        }\n        \n        NSLog(@\"File successfully copied.\");\n    }\n    return 0;\n}\n```\n使用enumeratorAtPath: 方法或者 contentsOfDirectoryAtPath:error: 方法都可以完成枚举过程。如果使用前者，一次可以枚举指定目录中的每个文件，默认情况下，如果其中一个文件为目录，那么也会递归枚举它的内容。\n```objc\nwhile ((path = [dirEnum nextObject]) != nil) (\nNSLog (@\"%@\"，path);\n[fm fileExistsAtPath: path isDirectory: &flag];\nif (flag == YES)\n[dirEnum skipDescendents] ;\n}\n```\n使用 isDirectory 方法检验文件是否为目录，通过发送 skipDescendents 消息可以动态组织递归过程，不再枚举目录中的内容。\n下面的代码使用两种方式枚举指定目录中的内容。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *path;\n        NSFileManager *fm;\n        NSDirectoryEnumerator *dm;\n        NSArray *array;\n        \n        fm = [NSFileManager defaultManager];\n        \n        path = [fm currentDirectoryPath];\n        dm = [fm enumeratorAtPath:path];\n        NSLog(@\"Contents in current path.\");\n        \n        //method 1\n        while ((path = [dm nextObject]) != nil) {\n            NSLog(@\"%@\",path);\n        }\n        \n        //method 2\n        array = [fm contentsOfDirectoryAtPath:[fm currentDirectoryPath] error:NULL];\n        NSLog(@\"Contents in current path.\\n\");\n        for (path in array) {\n            NSLog(@\"%@\",path);\n        }\n    }\n    return 0;\n}\n```\n\n###NSPathUtilities\n书中给出了常见的 NSPathUtilities 路径方法表。其中 components 是一个 NSArray 对象，包含路径每一部分的字符串对象；path是一个字符串对象，指定文件的路径; ext 是路径扩展名的字符串对象。\n![](http://image.stephenfang.me/mweb/15872706497596.jpg)\n![](http://image.stephenfang.me/mweb/15872707108256.jpg)\n以下为一段简单的 NSPathUtilities Demo代码：\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *path,*temp,*home;\n        NSFileManager *fm;\n        NSArray *components;\n \n        fm = [NSFileManager defaultManager];\n        \n        path = [fm currentDirectoryPath];\n        NSLog(@\"Current directory:%@\",path);\n        \n        temp = NSTemporaryDirectory();\n        NSLog(@\"Temporary directory: %@\",temp);\n        \n        home = NSHomeDirectory();\n        NSLog(@\"Home directory: %@\",home);\n        components = [home pathComponents];\n        \n        for (path in components) {\n            NSLog(@\"%@\",path);\n        }\n    }\n    return 0;\n}\n```\n### NSFileHandle\n使用 NSFileHandle 方法可以实现如下操作\n- 打开一个文件，执行读、写、更新操作\n- 在文件中查找指定位置\n- 从文件中读取特定数目的字节\n- 将指定数目的字节写入文件中\n\n处理文件的一般步骤为\n1. 打开文件，并获取一个NSFileHandle对象\n2. 对打开的文件执行I/O操作\n3. 关闭文件\n\n下图中给出了部分常用的NSFileHandle方法\n![](http://image.stephenfang.me/mweb/15872843161853.jpg)\n以下为一段简单的 NSFileHandle Demo代码：\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSFileHandle *inFile,*outFile;\n        NSData *data;\n        \n        inFile = [NSFileHandle fileHandleForReadingAtPath:@\"test.txt\"];\n        if(inFile == nil){\n            NSLog(@\"Open input file failed.\");\n            return 1;\n        }\n        \n        outFile = [NSFileHandle fileHandleForWritingAtPath:@\"out.txt\"];\n        if(outFile == nil){\n            NSLog(@\"Open output file failed\");\n            return 2;\n        }\n        \n        [outFile seekToEndOfFile];\n        \n        data = [inFile readDataToEndOfFile];\n        [outFile writeData: data];\n        \n        [inFile closeFile];\n        [outFile closeFile];\n        \n        NSLog(@\"%@\",[NSString stringWithContentsOfFile:@\"out.txt\" encoding:NSUTF8StringEncoding error:NULL]);\n    }\n    return 0;\n}\n\n```\n从输出可知，第一个文件的内容成功地附加到第二个文件的末尾。\n若 seekToEndOfFile 方法到达文件的末尾并且没有读到任何数据，那么将返回一个空的 NSData 对象，通过对该 NSData 对象应用 length 方法，测试其长度是否等于零判断文件是否为空，或者查看该文件中是否还有数据可以读取。\n打开一个需要更新的文件，文件的偏移量应设为文件的开始。通过在文件中定位(seeking)可以更改偏移量，然后执行该文件的读写操作。因此，要定位到文件的第10字节，可以编写如下消息表达式，此时文件的句柄为 databaseHandle。\n```objc\n[databaseHandle seekToFileOffset: 10];\n```\n通过获得当前文件的偏移量，然后加上或者减去这个值，就得到相应文件的位置。\n跳过文件中当前位置之后的128字节需要使用如下代码:\n```objc\n[databaseHandle seekToFileOffset:[databaseHandle offsetInFile] + 128];\n```\n### 其他\n书本中列出了部分 iOS 常用目录，内容略微过时但仍有参考意义。\n![](http://image.stephenfang.me/mweb/15872707572198.jpg)\n\n### 参考\n[iOS中的文件管理（一）—— NSFileManager基础](https://www.jianshu.com/p/be80c46ab731)\n[Objective-C 程序设计 (第六版)]()","source":"_posts/Objc_Learning_7.md","raw":"---\ntitle: Objective-C 学习笔记(七）\ndate: 2020-04-19 23:43:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\ncopyright: true\n---\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第七篇文章，主要复习了 `Objective-C` Foundation 框架中文件操作内容。\n\n<!--more-->\n\n### NSFileManager\nNSFileManager 类能够完成以下对于文件的操作\n- 创建一个新文件\n- 从现有文件中读取数据\n- 将数据写入文件\n- 重命名文件\n- 删除文件\n- 测试文件是否存在\n- 确定文件的大小和其他属性\n- 复制文件\n- 测试两个文件的内容是否相同\n其中大部分操作对于目录同样适用同样，然而调用的方法不同。\n\n首先给出常见的 NSFileManager文件方法\n![](http://image.stephenfang.me/mweb/15872236886233.jpg)\n\nattributesOfItemAtPath:path 方法返回一个包含指定文件属性的字典,属性字典包括各种信息，如文件的所有者、文件大小、文件的创建日期等。字典的每个属性可以通过键值提取，而所有的键都定义在头文件<Foundation/NSFileManager.h>中,如表示文件大小的键值为NSFileSize，以下列举了一部分常见属性。\n```\n   NSFileAttributeKey const NSFileType; ：\n   NSFileAttributeType const NSFileTypeDirectory;\n   NSFileAttributeType const NSFileTypeRegular;\n   NSFileAttributeKey const NSFileSize;\n   NSFileAttributeKey const NSFileModificationDate;  //修改时间\n   NSFileAttributeKey const NSFileCreationDate; //创建时间\n```\n使用以上方法在示例代码中实现了一些当前目录下的简单文件功能，须确保当前目录下 test.txt 已创建。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *fName = @\"test.txt\";\n        NSString *nName = @\"copy.txt\";\n        NSFileManager *fm;\n        NSDictionary *attr;\n        \n        fm = [NSFileManager defaultManager];\n        \n        if([fm fileExistsAtPath:fName] == NO){\n            NSLog(@\"File does not exist!\");\n            return 1;\n        }\n        \n        if([fm copyItemAtPath:fName toPath:nName error:NULL] == NO){\n            NSLog(@\"File copy failed!\");\n            return 2;\n        }\n        \n        if ([fm contentsEqualAtPath:fName andPath:nName] == NO){\n            NSLog(@\"Files are not equal\");\n            return 3;\n        }\n        if([fm moveItemAtPath:nName toPath:@\"new.txt\" error:NULL] == NO){\n            NSLog(@\"File renamed failed\");\n            return 4;\n        }\n        \n        if((attr = [fm attributesOfItemAtPath:fName error:NULL]) == nil){\n            NSLog(@\"Couldn't get file attributes!\");\n            return 5;\n        }\n        \n        NSLog(@\"File size is %llu bytes\",[[attr objectForKey:NSFileSize] unsignedLongLongValue]);\n        \n        if([fm removeItemAtPath:fName error:NULL] == NO){\n            NSLog(@\"File removal failed\");\n            return 6;\n        }\n        \n        NSLog(@\"All operations success!\");\n    }\n    return 0;\n}\n\n```\n书中给出了常见的 NSFileManager 目录方法\n![](http://image.stephenfang.me/mweb/15872698118240.jpg)\n\nmoveItemAtPath:toPath:方法可以将文件从一个目录移到另一个目录中，如果两个路径引用同一目录中的文件，其结果为重命名这个文件。使用示例代码实现了部分目录操作如下所示：\n\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *dname = @\"testdir\";\n        NSString *path;\n        NSFileManager *fm;\n        \n        fm = [NSFileManager defaultManager];\n        \n        path = [fm currentDirectoryPath];\n        NSLog(@\"Current Directory is: %@\",path);\n        \n        if([fm createDirectoryAtPath:dname withIntermediateDirectories:YES attributes:nil error:NULL] == NO){\n            NSLog(@\"Couldn't create directory!\");\n            return 1;\n        }\n        \n        if([fm moveItemAtPath:dname toPath:@\"newdir\" error:NULL] == NO){\n            NSLog(@\"Directory rename failed!\");\n            return 2;\n        }\n        \n        if([fm changeCurrentDirectoryPath:@\"newdir\"] == NO){\n            NSLog(@\"Change directory failed!\");\n            return 3;\n        }\n        \n        path = [fm currentDirectoryPath];;\n        NSLog(@\"Current Directory is: %@\",path);\n        \n        NSLog(@\"All operation completed.\");\n    }\n    return 0;\n}\n```\n\n### NSData\n在Foundation框架的 NSData 中提供了缓冲区的使用方式，包括设置缓冲区、数据读入缓冲区、将缓冲区数据写入文件等。\n使用 NSFileManager 对象的 contentsAtPath: 方法能够接收一个路径名,并将指定文件内容读入该方法创建的存储区，若读取成功则返回存储区对象，否则返回nil。方法 createFileAtPath: contents: attributes: 创建特定属性的文件并将指定的 NSData 对象内容写入该文件中。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSFileManager *fm;\n        NSData *data;\n        \n        data = [fm contentsAtPath:@\"new.txt\"];\n        \n        if(data == nil){\n            NSLog(@\"File read failed!\");\n            return 1;\n        }\n        \n        if([fm createFileAtPath:@\"another.txt\" contents:data attributes:nil] == NO){\n            NSLog(@\"Couldn't create the copy!\");\n            return 2;\n        }\n        \n        NSLog(@\"File successfully copied.\");\n    }\n    return 0;\n}\n```\n使用enumeratorAtPath: 方法或者 contentsOfDirectoryAtPath:error: 方法都可以完成枚举过程。如果使用前者，一次可以枚举指定目录中的每个文件，默认情况下，如果其中一个文件为目录，那么也会递归枚举它的内容。\n```objc\nwhile ((path = [dirEnum nextObject]) != nil) (\nNSLog (@\"%@\"，path);\n[fm fileExistsAtPath: path isDirectory: &flag];\nif (flag == YES)\n[dirEnum skipDescendents] ;\n}\n```\n使用 isDirectory 方法检验文件是否为目录，通过发送 skipDescendents 消息可以动态组织递归过程，不再枚举目录中的内容。\n下面的代码使用两种方式枚举指定目录中的内容。\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *path;\n        NSFileManager *fm;\n        NSDirectoryEnumerator *dm;\n        NSArray *array;\n        \n        fm = [NSFileManager defaultManager];\n        \n        path = [fm currentDirectoryPath];\n        dm = [fm enumeratorAtPath:path];\n        NSLog(@\"Contents in current path.\");\n        \n        //method 1\n        while ((path = [dm nextObject]) != nil) {\n            NSLog(@\"%@\",path);\n        }\n        \n        //method 2\n        array = [fm contentsOfDirectoryAtPath:[fm currentDirectoryPath] error:NULL];\n        NSLog(@\"Contents in current path.\\n\");\n        for (path in array) {\n            NSLog(@\"%@\",path);\n        }\n    }\n    return 0;\n}\n```\n\n###NSPathUtilities\n书中给出了常见的 NSPathUtilities 路径方法表。其中 components 是一个 NSArray 对象，包含路径每一部分的字符串对象；path是一个字符串对象，指定文件的路径; ext 是路径扩展名的字符串对象。\n![](http://image.stephenfang.me/mweb/15872706497596.jpg)\n![](http://image.stephenfang.me/mweb/15872707108256.jpg)\n以下为一段简单的 NSPathUtilities Demo代码：\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSString *path,*temp,*home;\n        NSFileManager *fm;\n        NSArray *components;\n \n        fm = [NSFileManager defaultManager];\n        \n        path = [fm currentDirectoryPath];\n        NSLog(@\"Current directory:%@\",path);\n        \n        temp = NSTemporaryDirectory();\n        NSLog(@\"Temporary directory: %@\",temp);\n        \n        home = NSHomeDirectory();\n        NSLog(@\"Home directory: %@\",home);\n        components = [home pathComponents];\n        \n        for (path in components) {\n            NSLog(@\"%@\",path);\n        }\n    }\n    return 0;\n}\n```\n### NSFileHandle\n使用 NSFileHandle 方法可以实现如下操作\n- 打开一个文件，执行读、写、更新操作\n- 在文件中查找指定位置\n- 从文件中读取特定数目的字节\n- 将指定数目的字节写入文件中\n\n处理文件的一般步骤为\n1. 打开文件，并获取一个NSFileHandle对象\n2. 对打开的文件执行I/O操作\n3. 关闭文件\n\n下图中给出了部分常用的NSFileHandle方法\n![](http://image.stephenfang.me/mweb/15872843161853.jpg)\n以下为一段简单的 NSFileHandle Demo代码：\n```objc\n#import <Foundation/Foundation.h>\n\nint main(int argc, char *argv[]){\n    @autoreleasepool {\n        NSFileHandle *inFile,*outFile;\n        NSData *data;\n        \n        inFile = [NSFileHandle fileHandleForReadingAtPath:@\"test.txt\"];\n        if(inFile == nil){\n            NSLog(@\"Open input file failed.\");\n            return 1;\n        }\n        \n        outFile = [NSFileHandle fileHandleForWritingAtPath:@\"out.txt\"];\n        if(outFile == nil){\n            NSLog(@\"Open output file failed\");\n            return 2;\n        }\n        \n        [outFile seekToEndOfFile];\n        \n        data = [inFile readDataToEndOfFile];\n        [outFile writeData: data];\n        \n        [inFile closeFile];\n        [outFile closeFile];\n        \n        NSLog(@\"%@\",[NSString stringWithContentsOfFile:@\"out.txt\" encoding:NSUTF8StringEncoding error:NULL]);\n    }\n    return 0;\n}\n\n```\n从输出可知，第一个文件的内容成功地附加到第二个文件的末尾。\n若 seekToEndOfFile 方法到达文件的末尾并且没有读到任何数据，那么将返回一个空的 NSData 对象，通过对该 NSData 对象应用 length 方法，测试其长度是否等于零判断文件是否为空，或者查看该文件中是否还有数据可以读取。\n打开一个需要更新的文件，文件的偏移量应设为文件的开始。通过在文件中定位(seeking)可以更改偏移量，然后执行该文件的读写操作。因此，要定位到文件的第10字节，可以编写如下消息表达式，此时文件的句柄为 databaseHandle。\n```objc\n[databaseHandle seekToFileOffset: 10];\n```\n通过获得当前文件的偏移量，然后加上或者减去这个值，就得到相应文件的位置。\n跳过文件中当前位置之后的128字节需要使用如下代码:\n```objc\n[databaseHandle seekToFileOffset:[databaseHandle offsetInFile] + 128];\n```\n### 其他\n书本中列出了部分 iOS 常用目录，内容略微过时但仍有参考意义。\n![](http://image.stephenfang.me/mweb/15872707572198.jpg)\n\n### 参考\n[iOS中的文件管理（一）—— NSFileManager基础](https://www.jianshu.com/p/be80c46ab731)\n[Objective-C 程序设计 (第六版)]()","slug":"Objc_Learning_7","published":1,"updated":"2022-07-24T15:20:56.341Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp21001go76fblrh339o","content":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第七篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中文件操作内容。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"NSFileManager\"><a href=\"#NSFileManager\" class=\"headerlink\" title=\"NSFileManager\"></a>NSFileManager</h3><p>NSFileManager 类能够完成以下对于文件的操作</p>\n<ul>\n<li>创建一个新文件</li>\n<li>从现有文件中读取数据</li>\n<li>将数据写入文件</li>\n<li>重命名文件</li>\n<li>删除文件</li>\n<li>测试文件是否存在</li>\n<li>确定文件的大小和其他属性</li>\n<li>复制文件</li>\n<li>测试两个文件的内容是否相同<br>其中大部分操作对于目录同样适用同样，然而调用的方法不同。</li>\n</ul>\n<p>首先给出常见的 NSFileManager文件方法<br><img src=\"http://image.stephenfang.me/mweb/15872236886233.jpg\"></p>\n<p>attributesOfItemAtPath:path 方法返回一个包含指定文件属性的字典,属性字典包括各种信息，如文件的所有者、文件大小、文件的创建日期等。字典的每个属性可以通过键值提取，而所有的键都定义在头文件&lt;Foundation/NSFileManager.h&gt;中,如表示文件大小的键值为NSFileSize，以下列举了一部分常见属性。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NSFileAttributeKey const NSFileType; ：</span><br><span class=\"line\">NSFileAttributeType const NSFileTypeDirectory;</span><br><span class=\"line\">NSFileAttributeType const NSFileTypeRegular;</span><br><span class=\"line\">NSFileAttributeKey const NSFileSize;</span><br><span class=\"line\">NSFileAttributeKey const NSFileModificationDate;  //修改时间</span><br><span class=\"line\">NSFileAttributeKey const NSFileCreationDate; //创建时间</span><br></pre></td></tr></table></figure>\n<p>使用以上方法在示例代码中实现了一些当前目录下的简单文件功能，须确保当前目录下 test.txt 已创建。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *fName = <span class=\"string\">@&quot;test.txt&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *nName = <span class=\"string\">@&quot;copy.txt&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSDictionary</span> *attr;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm fileExistsAtPath:fName] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File does not exist!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm copyItemAtPath:fName toPath:nName error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File copy failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> ([fm contentsEqualAtPath:fName andPath:nName] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Files are not equal&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm moveItemAtPath:nName toPath:<span class=\"string\">@&quot;new.txt&quot;</span> error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File renamed failed&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>((attr = [fm attributesOfItemAtPath:fName error:<span class=\"literal\">NULL</span>]) == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Couldn&#x27;t get file attributes!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File size is %llu bytes&quot;</span>,[[attr objectForKey:<span class=\"built_in\">NSFileSize</span>] unsignedLongLongValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm removeItemAtPath:fName error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File removal failed&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">6</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;All operations success!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>书中给出了常见的 NSFileManager 目录方法<br><img src=\"http://image.stephenfang.me/mweb/15872698118240.jpg\"></p>\n<p>moveItemAtPath:toPath:方法可以将文件从一个目录移到另一个目录中，如果两个路径引用同一目录中的文件，其结果为重命名这个文件。使用示例代码实现了部分目录操作如下所示：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *dname = <span class=\"string\">@&quot;testdir&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *path;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Current Directory is: %@&quot;</span>,path);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm createDirectoryAtPath:dname withIntermediateDirectories:<span class=\"literal\">YES</span> attributes:<span class=\"literal\">nil</span> error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Couldn&#x27;t create directory!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm moveItemAtPath:dname toPath:<span class=\"string\">@&quot;newdir&quot;</span> error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Directory rename failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm changeCurrentDirectoryPath:<span class=\"string\">@&quot;newdir&quot;</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Change directory failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Current Directory is: %@&quot;</span>,path);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;All operation completed.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"NSData\"><a href=\"#NSData\" class=\"headerlink\" title=\"NSData\"></a>NSData</h3><p>在Foundation框架的 NSData 中提供了缓冲区的使用方式，包括设置缓冲区、数据读入缓冲区、将缓冲区数据写入文件等。<br>使用 NSFileManager 对象的 contentsAtPath: 方法能够接收一个路径名,并将指定文件内容读入该方法创建的存储区，若读取成功则返回存储区对象，否则返回nil。方法 createFileAtPath: contents: attributes: 创建特定属性的文件并将指定的 NSData 对象内容写入该文件中。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSData</span> *data;</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = [fm contentsAtPath:<span class=\"string\">@&quot;new.txt&quot;</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(data == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File read failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm createFileAtPath:<span class=\"string\">@&quot;another.txt&quot;</span> contents:data attributes:<span class=\"literal\">nil</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Couldn&#x27;t create the copy!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File successfully copied.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用enumeratorAtPath: 方法或者 contentsOfDirectoryAtPath:error: 方法都可以完成枚举过程。如果使用前者，一次可以枚举指定目录中的每个文件，默认情况下，如果其中一个文件为目录，那么也会递归枚举它的内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> ((path = [dirEnum nextObject]) != <span class=\"literal\">nil</span>) (</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span> (<span class=\"string\">@&quot;%@&quot;</span>，path);</span><br><span class=\"line\">[fm fileExistsAtPath: path isDirectory: &amp;flag];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (flag == <span class=\"literal\">YES</span>)</span><br><span class=\"line\">[dirEnum skipDescendents] ;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 isDirectory 方法检验文件是否为目录，通过发送 skipDescendents 消息可以动态组织递归过程，不再枚举目录中的内容。<br>下面的代码使用两种方式枚举指定目录中的内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *path;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSDirectoryEnumerator</span> *dm;</span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *array;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];</span><br><span class=\"line\">        dm = [fm enumeratorAtPath:path];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Contents in current path.&quot;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//method 1</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((path = [dm nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//method 2</span></span><br><span class=\"line\">        array = [fm contentsOfDirectoryAtPath:[fm currentDirectoryPath] error:<span class=\"literal\">NULL</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Contents in current path.\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (path <span class=\"keyword\">in</span> array) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>###NSPathUtilities<br>书中给出了常见的 NSPathUtilities 路径方法表。其中 components 是一个 NSArray 对象，包含路径每一部分的字符串对象；path是一个字符串对象，指定文件的路径; ext 是路径扩展名的字符串对象。<br><img src=\"http://image.stephenfang.me/mweb/15872706497596.jpg\"><br><img src=\"http://image.stephenfang.me/mweb/15872707108256.jpg\"><br>以下为一段简单的 NSPathUtilities Demo代码：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *path,*temp,*home;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *components;</span><br><span class=\"line\"> </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Current directory:%@&quot;</span>,path);</span><br><span class=\"line\">        </span><br><span class=\"line\">        temp = <span class=\"built_in\">NSTemporaryDirectory</span>();</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Temporary directory: %@&quot;</span>,temp);</span><br><span class=\"line\">        </span><br><span class=\"line\">        home = <span class=\"built_in\">NSHomeDirectory</span>();</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Home directory: %@&quot;</span>,home);</span><br><span class=\"line\">        components = [home pathComponents];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (path <span class=\"keyword\">in</span> components) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"NSFileHandle\"><a href=\"#NSFileHandle\" class=\"headerlink\" title=\"NSFileHandle\"></a>NSFileHandle</h3><p>使用 NSFileHandle 方法可以实现如下操作</p>\n<ul>\n<li>打开一个文件，执行读、写、更新操作</li>\n<li>在文件中查找指定位置</li>\n<li>从文件中读取特定数目的字节</li>\n<li>将指定数目的字节写入文件中</li>\n</ul>\n<p>处理文件的一般步骤为</p>\n<ol>\n<li>打开文件，并获取一个NSFileHandle对象</li>\n<li>对打开的文件执行I/O操作</li>\n<li>关闭文件</li>\n</ol>\n<p>下图中给出了部分常用的NSFileHandle方法<br><img src=\"http://image.stephenfang.me/mweb/15872843161853.jpg\"><br>以下为一段简单的 NSFileHandle Demo代码：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileHandle</span> *inFile,*outFile;</span><br><span class=\"line\">        <span class=\"built_in\">NSData</span> *data;</span><br><span class=\"line\">        </span><br><span class=\"line\">        inFile = [<span class=\"built_in\">NSFileHandle</span> fileHandleForReadingAtPath:<span class=\"string\">@&quot;test.txt&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(inFile == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Open input file failed.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        outFile = [<span class=\"built_in\">NSFileHandle</span> fileHandleForWritingAtPath:<span class=\"string\">@&quot;out.txt&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(outFile == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Open output file failed&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        [outFile seekToEndOfFile];</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = [inFile readDataToEndOfFile];</span><br><span class=\"line\">        [outFile writeData: data];</span><br><span class=\"line\">        </span><br><span class=\"line\">        [inFile closeFile];</span><br><span class=\"line\">        [outFile closeFile];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,[<span class=\"built_in\">NSString</span> stringWithContentsOfFile:<span class=\"string\">@&quot;out.txt&quot;</span> encoding:<span class=\"built_in\">NSUTF8StringEncoding</span> error:<span class=\"literal\">NULL</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>从输出可知，第一个文件的内容成功地附加到第二个文件的末尾。<br>若 seekToEndOfFile 方法到达文件的末尾并且没有读到任何数据，那么将返回一个空的 NSData 对象，通过对该 NSData 对象应用 length 方法，测试其长度是否等于零判断文件是否为空，或者查看该文件中是否还有数据可以读取。<br>打开一个需要更新的文件，文件的偏移量应设为文件的开始。通过在文件中定位(seeking)可以更改偏移量，然后执行该文件的读写操作。因此，要定位到文件的第10字节，可以编写如下消息表达式，此时文件的句柄为 databaseHandle。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[databaseHandle seekToFileOffset: <span class=\"number\">10</span>];</span><br></pre></td></tr></table></figure>\n<p>通过获得当前文件的偏移量，然后加上或者减去这个值，就得到相应文件的位置。<br>跳过文件中当前位置之后的128字节需要使用如下代码:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[databaseHandle seekToFileOffset:[databaseHandle offsetInFile] + <span class=\"number\">128</span>];</span><br></pre></td></tr></table></figure>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><p>书本中列出了部分 iOS 常用目录，内容略微过时但仍有参考意义。<br><img src=\"http://image.stephenfang.me/mweb/15872707572198.jpg\"></p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"https://www.jianshu.com/p/be80c46ab731\">iOS中的文件管理（一）—— NSFileManager基础</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第七篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中文件操作内容。</p>","more":"<h3 id=\"NSFileManager\"><a href=\"#NSFileManager\" class=\"headerlink\" title=\"NSFileManager\"></a>NSFileManager</h3><p>NSFileManager 类能够完成以下对于文件的操作</p>\n<ul>\n<li>创建一个新文件</li>\n<li>从现有文件中读取数据</li>\n<li>将数据写入文件</li>\n<li>重命名文件</li>\n<li>删除文件</li>\n<li>测试文件是否存在</li>\n<li>确定文件的大小和其他属性</li>\n<li>复制文件</li>\n<li>测试两个文件的内容是否相同<br>其中大部分操作对于目录同样适用同样，然而调用的方法不同。</li>\n</ul>\n<p>首先给出常见的 NSFileManager文件方法<br><img src=\"http://image.stephenfang.me/mweb/15872236886233.jpg\"></p>\n<p>attributesOfItemAtPath:path 方法返回一个包含指定文件属性的字典,属性字典包括各种信息，如文件的所有者、文件大小、文件的创建日期等。字典的每个属性可以通过键值提取，而所有的键都定义在头文件&lt;Foundation/NSFileManager.h&gt;中,如表示文件大小的键值为NSFileSize，以下列举了一部分常见属性。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">NSFileAttributeKey const NSFileType; ：</span><br><span class=\"line\">NSFileAttributeType const NSFileTypeDirectory;</span><br><span class=\"line\">NSFileAttributeType const NSFileTypeRegular;</span><br><span class=\"line\">NSFileAttributeKey const NSFileSize;</span><br><span class=\"line\">NSFileAttributeKey const NSFileModificationDate;  //修改时间</span><br><span class=\"line\">NSFileAttributeKey const NSFileCreationDate; //创建时间</span><br></pre></td></tr></table></figure>\n<p>使用以上方法在示例代码中实现了一些当前目录下的简单文件功能，须确保当前目录下 test.txt 已创建。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *fName = <span class=\"string\">@&quot;test.txt&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *nName = <span class=\"string\">@&quot;copy.txt&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSDictionary</span> *attr;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm fileExistsAtPath:fName] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File does not exist!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm copyItemAtPath:fName toPath:nName error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File copy failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> ([fm contentsEqualAtPath:fName andPath:nName] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Files are not equal&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm moveItemAtPath:nName toPath:<span class=\"string\">@&quot;new.txt&quot;</span> error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File renamed failed&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>((attr = [fm attributesOfItemAtPath:fName error:<span class=\"literal\">NULL</span>]) == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Couldn&#x27;t get file attributes!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">5</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File size is %llu bytes&quot;</span>,[[attr objectForKey:<span class=\"built_in\">NSFileSize</span>] unsignedLongLongValue]);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm removeItemAtPath:fName error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File removal failed&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">6</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;All operations success!&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>书中给出了常见的 NSFileManager 目录方法<br><img src=\"http://image.stephenfang.me/mweb/15872698118240.jpg\"></p>\n<p>moveItemAtPath:toPath:方法可以将文件从一个目录移到另一个目录中，如果两个路径引用同一目录中的文件，其结果为重命名这个文件。使用示例代码实现了部分目录操作如下所示：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *dname = <span class=\"string\">@&quot;testdir&quot;</span>;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *path;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Current Directory is: %@&quot;</span>,path);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm createDirectoryAtPath:dname withIntermediateDirectories:<span class=\"literal\">YES</span> attributes:<span class=\"literal\">nil</span> error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Couldn&#x27;t create directory!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm moveItemAtPath:dname toPath:<span class=\"string\">@&quot;newdir&quot;</span> error:<span class=\"literal\">NULL</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Directory rename failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm changeCurrentDirectoryPath:<span class=\"string\">@&quot;newdir&quot;</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Change directory failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];;</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Current Directory is: %@&quot;</span>,path);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;All operation completed.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"NSData\"><a href=\"#NSData\" class=\"headerlink\" title=\"NSData\"></a>NSData</h3><p>在Foundation框架的 NSData 中提供了缓冲区的使用方式，包括设置缓冲区、数据读入缓冲区、将缓冲区数据写入文件等。<br>使用 NSFileManager 对象的 contentsAtPath: 方法能够接收一个路径名,并将指定文件内容读入该方法创建的存储区，若读取成功则返回存储区对象，否则返回nil。方法 createFileAtPath: contents: attributes: 创建特定属性的文件并将指定的 NSData 对象内容写入该文件中。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSData</span> *data;</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = [fm contentsAtPath:<span class=\"string\">@&quot;new.txt&quot;</span>];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>(data == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File read failed!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span>([fm createFileAtPath:<span class=\"string\">@&quot;another.txt&quot;</span> contents:data attributes:<span class=\"literal\">nil</span>] == <span class=\"literal\">NO</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Couldn&#x27;t create the copy!&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;File successfully copied.&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用enumeratorAtPath: 方法或者 contentsOfDirectoryAtPath:error: 方法都可以完成枚举过程。如果使用前者，一次可以枚举指定目录中的每个文件，默认情况下，如果其中一个文件为目录，那么也会递归枚举它的内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span> ((path = [dirEnum nextObject]) != <span class=\"literal\">nil</span>) (</span><br><span class=\"line\"><span class=\"built_in\">NSLog</span> (<span class=\"string\">@&quot;%@&quot;</span>，path);</span><br><span class=\"line\">[fm fileExistsAtPath: path isDirectory: &amp;flag];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (flag == <span class=\"literal\">YES</span>)</span><br><span class=\"line\">[dirEnum skipDescendents] ;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 isDirectory 方法检验文件是否为目录，通过发送 skipDescendents 消息可以动态组织递归过程，不再枚举目录中的内容。<br>下面的代码使用两种方式枚举指定目录中的内容。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *path;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSDirectoryEnumerator</span> *dm;</span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *array;</span><br><span class=\"line\">        </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];</span><br><span class=\"line\">        dm = [fm enumeratorAtPath:path];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Contents in current path.&quot;</span>);</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//method 1</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> ((path = [dm nextObject]) != <span class=\"literal\">nil</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">//method 2</span></span><br><span class=\"line\">        array = [fm contentsOfDirectoryAtPath:[fm currentDirectoryPath] error:<span class=\"literal\">NULL</span>];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Contents in current path.\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (path <span class=\"keyword\">in</span> array) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>###NSPathUtilities<br>书中给出了常见的 NSPathUtilities 路径方法表。其中 components 是一个 NSArray 对象，包含路径每一部分的字符串对象；path是一个字符串对象，指定文件的路径; ext 是路径扩展名的字符串对象。<br><img src=\"http://image.stephenfang.me/mweb/15872706497596.jpg\"><br><img src=\"http://image.stephenfang.me/mweb/15872707108256.jpg\"><br>以下为一段简单的 NSPathUtilities Demo代码：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSString</span> *path,*temp,*home;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileManager</span> *fm;</span><br><span class=\"line\">        <span class=\"built_in\">NSArray</span> *components;</span><br><span class=\"line\"> </span><br><span class=\"line\">        fm = [<span class=\"built_in\">NSFileManager</span> defaultManager];</span><br><span class=\"line\">        </span><br><span class=\"line\">        path = [fm currentDirectoryPath];</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Current directory:%@&quot;</span>,path);</span><br><span class=\"line\">        </span><br><span class=\"line\">        temp = <span class=\"built_in\">NSTemporaryDirectory</span>();</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Temporary directory: %@&quot;</span>,temp);</span><br><span class=\"line\">        </span><br><span class=\"line\">        home = <span class=\"built_in\">NSHomeDirectory</span>();</span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Home directory: %@&quot;</span>,home);</span><br><span class=\"line\">        components = [home pathComponents];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">for</span> (path <span class=\"keyword\">in</span> components) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,path);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"NSFileHandle\"><a href=\"#NSFileHandle\" class=\"headerlink\" title=\"NSFileHandle\"></a>NSFileHandle</h3><p>使用 NSFileHandle 方法可以实现如下操作</p>\n<ul>\n<li>打开一个文件，执行读、写、更新操作</li>\n<li>在文件中查找指定位置</li>\n<li>从文件中读取特定数目的字节</li>\n<li>将指定数目的字节写入文件中</li>\n</ul>\n<p>处理文件的一般步骤为</p>\n<ol>\n<li>打开文件，并获取一个NSFileHandle对象</li>\n<li>对打开的文件执行I/O操作</li>\n<li>关闭文件</li>\n</ol>\n<p>下图中给出了部分常用的NSFileHandle方法<br><img src=\"http://image.stephenfang.me/mweb/15872843161853.jpg\"><br>以下为一段简单的 NSFileHandle Demo代码：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#import <span class=\"meta-string\">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">int</span> main(<span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span> *argv[])&#123;</span><br><span class=\"line\">    <span class=\"keyword\">@autoreleasepool</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">NSFileHandle</span> *inFile,*outFile;</span><br><span class=\"line\">        <span class=\"built_in\">NSData</span> *data;</span><br><span class=\"line\">        </span><br><span class=\"line\">        inFile = [<span class=\"built_in\">NSFileHandle</span> fileHandleForReadingAtPath:<span class=\"string\">@&quot;test.txt&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(inFile == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Open input file failed.&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        outFile = [<span class=\"built_in\">NSFileHandle</span> fileHandleForWritingAtPath:<span class=\"string\">@&quot;out.txt&quot;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(outFile == <span class=\"literal\">nil</span>)&#123;</span><br><span class=\"line\">            <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Open output file failed&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        [outFile seekToEndOfFile];</span><br><span class=\"line\">        </span><br><span class=\"line\">        data = [inFile readDataToEndOfFile];</span><br><span class=\"line\">        [outFile writeData: data];</span><br><span class=\"line\">        </span><br><span class=\"line\">        [inFile closeFile];</span><br><span class=\"line\">        [outFile closeFile];</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;%@&quot;</span>,[<span class=\"built_in\">NSString</span> stringWithContentsOfFile:<span class=\"string\">@&quot;out.txt&quot;</span> encoding:<span class=\"built_in\">NSUTF8StringEncoding</span> error:<span class=\"literal\">NULL</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>从输出可知，第一个文件的内容成功地附加到第二个文件的末尾。<br>若 seekToEndOfFile 方法到达文件的末尾并且没有读到任何数据，那么将返回一个空的 NSData 对象，通过对该 NSData 对象应用 length 方法，测试其长度是否等于零判断文件是否为空，或者查看该文件中是否还有数据可以读取。<br>打开一个需要更新的文件，文件的偏移量应设为文件的开始。通过在文件中定位(seeking)可以更改偏移量，然后执行该文件的读写操作。因此，要定位到文件的第10字节，可以编写如下消息表达式，此时文件的句柄为 databaseHandle。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[databaseHandle seekToFileOffset: <span class=\"number\">10</span>];</span><br></pre></td></tr></table></figure>\n<p>通过获得当前文件的偏移量，然后加上或者减去这个值，就得到相应文件的位置。<br>跳过文件中当前位置之后的128字节需要使用如下代码:</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[databaseHandle seekToFileOffset:[databaseHandle offsetInFile] + <span class=\"number\">128</span>];</span><br></pre></td></tr></table></figure>\n<h3 id=\"其他\"><a href=\"#其他\" class=\"headerlink\" title=\"其他\"></a>其他</h3><p>书本中列出了部分 iOS 常用目录，内容略微过时但仍有参考意义。<br><img src=\"http://image.stephenfang.me/mweb/15872707572198.jpg\"></p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"https://www.jianshu.com/p/be80c46ab731\">iOS中的文件管理（一）—— NSFileManager基础</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/15872236886233.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:20:56 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(七）","path":"2020/04/19/Objc_Learning_7/","eyeCatchImage":"http://image.stephenfang.me/mweb/15872236886233.jpg","excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第七篇文章，主要复习了 <code>Objective-C</code> Foundation 框架中文件操作内容。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-19T15:43:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-19T15:43:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":6764},{"title":"Objective-C 学习笔记(八）","date":"2020-04-24T14:23:20.000Z","copyright":true,"_content":"\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第八篇文章，主要复习了自动引用计数与深浅拷贝。\n\n<!--more-->\n\n### 手动引用计数总结\n- 若需保持对象不被销毁可以使用 retain，使用完对象后需使用 release 进行释放。\n- 给对象发送 release 消息不会必然销毁对象，只有当该对象的引用计数减至0时对象才会被销毁，接着系统会发送 dealloc 消息给这个对象用于释放内存。\n- 对使用了 retain 或者 copy、 mutableCopy、alloc 或 new 方法的任何对象，以及具有 retain 和 copy 特性的属性进行释放，需要覆盖 dealloc 方法，使得在对象被释放的时候能够释放这些实例变量。\n- 如果在方法中不再需要用到这个对象但需要将其返回，可以给这个对象发送 autorelease 消息以标记这个对象延迟释放。autorelease 消息并不会影响到对象的引用计数。\n- 当应用终止时内存中的所有对象都会被释放，不论它们是否在自动释放池中。\n\n### 自动引用计数总结\n- 只要某个对象被任一 strong 指针指向，那么它将不会被销毁。如果对象没有被任何 strong 指针指向，那么就将被销毁。\n- 通常所有对象的指针变量都是强变量，将对象的引用赋给变量使对象自动保持，旧对象的引用会在赋值前被释放。\n- 当两个对象都持有彼此的强引用时，将会产生循环保持。如果对象仍然有引用，系统将不能销毁这个对象。如果两个对象都强引用彼此就不可以被销毁。\n- 解决强引用问题可以创建其他类型的对象变量，并允许使用弱引用。通过父视图持有子视图的强引用，子视图持有父视图的弱引用，这样就没有循环保持。弱变量也不能阻止引用的对象被销毁。\n- 以 `Objective-C`中的 delegate 设计模式为例，viewController 中有一个 strong 指针指向它所负责管理的 UITableView，而 UITableView 中的 dataSource 和 delegate 指针都指向 viewController 的 weak 指针。\n- 当声明一个弱变量，系统会追踪赋值给这个变量的引用。当引用的对象释放时，弱变量会被自动设置为nil。变量被设置为nil,给nil对象发送任何消息不会有反应，避免了无意间给这个变量发送消息引起的崩溃。\n- 如果需要持有一个对象，那么对其发送 retain。如果之后不再使用该对象，那么需要对其发送 release（或者autorelease） 每一次对 retain、alloc 或 new 的调用，需要对应一次 release 或 autorelease 调用。\n\n### 深浅拷贝\n#### 深拷贝\n - 将原数据拷贝后存入一块新的内存中，并以新的指针指向新的内存。\n - 拷贝过程结束后，两个对象存储数据相同，内存地址不同。\n - 两个对象互不影响，互不干涉。\n - 源对象和副本的计数器相同。\n - 非容器类的浅拷贝只拷贝对象的地址，没有新的内存被分配。\n - 容器类的浅拷贝不拷贝容器的内容，两个容器的地址不同，在一个容器中修改值，另一个浅拷贝的容器中的值也会变化。\n \n#### 浅拷贝 \n - 拷贝数据所在内存的地址，目标对象指针和源对象指向同一片内存空间。\n - 新对象计数器为1，源对象计数器不变。\n - 在`Objective-C`中使用 retain 关键字进行引用计数，使几个指针共用同一片内存空间，不会轻易的销毁内存。\n - 非容器类的深拷贝就是重写分配一块内存，然后把另一个对象的内容原封不动搬过来。对容器类的深拷贝是对容器中的每个元素都进行拷贝。\n \n#### 拷贝方式\n1. **retain**：始终是浅拷贝。引用计数每次加1。返回对象是否可变与被复制的对象保持一致。\n2. **copy**：对于可变对象为深拷贝，引用计数不改变；对于不可变对象是浅拷贝，引用计数每次加1。始终返回一个不可变对象。  \n3. **mutableCopy**：始终是深拷贝，引用计数不改变。始终返回一个可变对象。\n\n并非所有的类都支持拷贝。只有遵循 NSCopying 协议的类，才支持 copy 拷贝，只有遵循 NSMutableCopying 协议的类，才支持 mutableCopy 拷贝。如果没有遵循拷贝协议拷贝时会出错。\n\n### 参考\n[手把手教你ARC——iOS/Mac开发ARC入门和使用](https://onevcat.com/2012/06/arc-hand-by-hand/)\n[Objective-C中的深拷贝和浅拷贝](https://www.cnblogs.com/ludashi/p/3894151.html)\n[Objective-C 程序设计 (第六版)]()","source":"_posts/Objc_Learning_8.md","raw":"---\ntitle: Objective-C 学习笔记(八）\ndate: 2020-04-24 22:23:20\ncategories: \n- 技术\ntags: \n- iOS\n- Xcode\n- Objective-C\n- ARC\ncopyright: true\n---\n\n最近开始学习 `Objective-C` 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第八篇文章，主要复习了自动引用计数与深浅拷贝。\n\n<!--more-->\n\n### 手动引用计数总结\n- 若需保持对象不被销毁可以使用 retain，使用完对象后需使用 release 进行释放。\n- 给对象发送 release 消息不会必然销毁对象，只有当该对象的引用计数减至0时对象才会被销毁，接着系统会发送 dealloc 消息给这个对象用于释放内存。\n- 对使用了 retain 或者 copy、 mutableCopy、alloc 或 new 方法的任何对象，以及具有 retain 和 copy 特性的属性进行释放，需要覆盖 dealloc 方法，使得在对象被释放的时候能够释放这些实例变量。\n- 如果在方法中不再需要用到这个对象但需要将其返回，可以给这个对象发送 autorelease 消息以标记这个对象延迟释放。autorelease 消息并不会影响到对象的引用计数。\n- 当应用终止时内存中的所有对象都会被释放，不论它们是否在自动释放池中。\n\n### 自动引用计数总结\n- 只要某个对象被任一 strong 指针指向，那么它将不会被销毁。如果对象没有被任何 strong 指针指向，那么就将被销毁。\n- 通常所有对象的指针变量都是强变量，将对象的引用赋给变量使对象自动保持，旧对象的引用会在赋值前被释放。\n- 当两个对象都持有彼此的强引用时，将会产生循环保持。如果对象仍然有引用，系统将不能销毁这个对象。如果两个对象都强引用彼此就不可以被销毁。\n- 解决强引用问题可以创建其他类型的对象变量，并允许使用弱引用。通过父视图持有子视图的强引用，子视图持有父视图的弱引用，这样就没有循环保持。弱变量也不能阻止引用的对象被销毁。\n- 以 `Objective-C`中的 delegate 设计模式为例，viewController 中有一个 strong 指针指向它所负责管理的 UITableView，而 UITableView 中的 dataSource 和 delegate 指针都指向 viewController 的 weak 指针。\n- 当声明一个弱变量，系统会追踪赋值给这个变量的引用。当引用的对象释放时，弱变量会被自动设置为nil。变量被设置为nil,给nil对象发送任何消息不会有反应，避免了无意间给这个变量发送消息引起的崩溃。\n- 如果需要持有一个对象，那么对其发送 retain。如果之后不再使用该对象，那么需要对其发送 release（或者autorelease） 每一次对 retain、alloc 或 new 的调用，需要对应一次 release 或 autorelease 调用。\n\n### 深浅拷贝\n#### 深拷贝\n - 将原数据拷贝后存入一块新的内存中，并以新的指针指向新的内存。\n - 拷贝过程结束后，两个对象存储数据相同，内存地址不同。\n - 两个对象互不影响，互不干涉。\n - 源对象和副本的计数器相同。\n - 非容器类的浅拷贝只拷贝对象的地址，没有新的内存被分配。\n - 容器类的浅拷贝不拷贝容器的内容，两个容器的地址不同，在一个容器中修改值，另一个浅拷贝的容器中的值也会变化。\n \n#### 浅拷贝 \n - 拷贝数据所在内存的地址，目标对象指针和源对象指向同一片内存空间。\n - 新对象计数器为1，源对象计数器不变。\n - 在`Objective-C`中使用 retain 关键字进行引用计数，使几个指针共用同一片内存空间，不会轻易的销毁内存。\n - 非容器类的深拷贝就是重写分配一块内存，然后把另一个对象的内容原封不动搬过来。对容器类的深拷贝是对容器中的每个元素都进行拷贝。\n \n#### 拷贝方式\n1. **retain**：始终是浅拷贝。引用计数每次加1。返回对象是否可变与被复制的对象保持一致。\n2. **copy**：对于可变对象为深拷贝，引用计数不改变；对于不可变对象是浅拷贝，引用计数每次加1。始终返回一个不可变对象。  \n3. **mutableCopy**：始终是深拷贝，引用计数不改变。始终返回一个可变对象。\n\n并非所有的类都支持拷贝。只有遵循 NSCopying 协议的类，才支持 copy 拷贝，只有遵循 NSMutableCopying 协议的类，才支持 mutableCopy 拷贝。如果没有遵循拷贝协议拷贝时会出错。\n\n### 参考\n[手把手教你ARC——iOS/Mac开发ARC入门和使用](https://onevcat.com/2012/06/arc-hand-by-hand/)\n[Objective-C中的深拷贝和浅拷贝](https://www.cnblogs.com/ludashi/p/3894151.html)\n[Objective-C 程序设计 (第六版)]()","slug":"Objc_Learning_8","published":1,"updated":"2022-07-24T15:21:01.572Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp22001jo76f4sjdhidf","content":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第八篇文章，主要复习了自动引用计数与深浅拷贝。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"手动引用计数总结\"><a href=\"#手动引用计数总结\" class=\"headerlink\" title=\"手动引用计数总结\"></a>手动引用计数总结</h3><ul>\n<li>若需保持对象不被销毁可以使用 retain，使用完对象后需使用 release 进行释放。</li>\n<li>给对象发送 release 消息不会必然销毁对象，只有当该对象的引用计数减至0时对象才会被销毁，接着系统会发送 dealloc 消息给这个对象用于释放内存。</li>\n<li>对使用了 retain 或者 copy、 mutableCopy、alloc 或 new 方法的任何对象，以及具有 retain 和 copy 特性的属性进行释放，需要覆盖 dealloc 方法，使得在对象被释放的时候能够释放这些实例变量。</li>\n<li>如果在方法中不再需要用到这个对象但需要将其返回，可以给这个对象发送 autorelease 消息以标记这个对象延迟释放。autorelease 消息并不会影响到对象的引用计数。</li>\n<li>当应用终止时内存中的所有对象都会被释放，不论它们是否在自动释放池中。</li>\n</ul>\n<h3 id=\"自动引用计数总结\"><a href=\"#自动引用计数总结\" class=\"headerlink\" title=\"自动引用计数总结\"></a>自动引用计数总结</h3><ul>\n<li>只要某个对象被任一 strong 指针指向，那么它将不会被销毁。如果对象没有被任何 strong 指针指向，那么就将被销毁。</li>\n<li>通常所有对象的指针变量都是强变量，将对象的引用赋给变量使对象自动保持，旧对象的引用会在赋值前被释放。</li>\n<li>当两个对象都持有彼此的强引用时，将会产生循环保持。如果对象仍然有引用，系统将不能销毁这个对象。如果两个对象都强引用彼此就不可以被销毁。</li>\n<li>解决强引用问题可以创建其他类型的对象变量，并允许使用弱引用。通过父视图持有子视图的强引用，子视图持有父视图的弱引用，这样就没有循环保持。弱变量也不能阻止引用的对象被销毁。</li>\n<li>以 <code>Objective-C</code>中的 delegate 设计模式为例，viewController 中有一个 strong 指针指向它所负责管理的 UITableView，而 UITableView 中的 dataSource 和 delegate 指针都指向 viewController 的 weak 指针。</li>\n<li>当声明一个弱变量，系统会追踪赋值给这个变量的引用。当引用的对象释放时，弱变量会被自动设置为nil。变量被设置为nil,给nil对象发送任何消息不会有反应，避免了无意间给这个变量发送消息引起的崩溃。</li>\n<li>如果需要持有一个对象，那么对其发送 retain。如果之后不再使用该对象，那么需要对其发送 release（或者autorelease） 每一次对 retain、alloc 或 new 的调用，需要对应一次 release 或 autorelease 调用。</li>\n</ul>\n<h3 id=\"深浅拷贝\"><a href=\"#深浅拷贝\" class=\"headerlink\" title=\"深浅拷贝\"></a>深浅拷贝</h3><h4 id=\"深拷贝\"><a href=\"#深拷贝\" class=\"headerlink\" title=\"深拷贝\"></a>深拷贝</h4><ul>\n<li>将原数据拷贝后存入一块新的内存中，并以新的指针指向新的内存。</li>\n<li>拷贝过程结束后，两个对象存储数据相同，内存地址不同。</li>\n<li>两个对象互不影响，互不干涉。</li>\n<li>源对象和副本的计数器相同。</li>\n<li>非容器类的浅拷贝只拷贝对象的地址，没有新的内存被分配。</li>\n<li>容器类的浅拷贝不拷贝容器的内容，两个容器的地址不同，在一个容器中修改值，另一个浅拷贝的容器中的值也会变化。</li>\n</ul>\n<h4 id=\"浅拷贝\"><a href=\"#浅拷贝\" class=\"headerlink\" title=\"浅拷贝\"></a>浅拷贝</h4><ul>\n<li>拷贝数据所在内存的地址，目标对象指针和源对象指向同一片内存空间。</li>\n<li>新对象计数器为1，源对象计数器不变。</li>\n<li>在<code>Objective-C</code>中使用 retain 关键字进行引用计数，使几个指针共用同一片内存空间，不会轻易的销毁内存。</li>\n<li>非容器类的深拷贝就是重写分配一块内存，然后把另一个对象的内容原封不动搬过来。对容器类的深拷贝是对容器中的每个元素都进行拷贝。</li>\n</ul>\n<h4 id=\"拷贝方式\"><a href=\"#拷贝方式\" class=\"headerlink\" title=\"拷贝方式\"></a>拷贝方式</h4><ol>\n<li><strong>retain</strong>：始终是浅拷贝。引用计数每次加1。返回对象是否可变与被复制的对象保持一致。</li>\n<li><strong>copy</strong>：对于可变对象为深拷贝，引用计数不改变；对于不可变对象是浅拷贝，引用计数每次加1。始终返回一个不可变对象。  </li>\n<li><strong>mutableCopy</strong>：始终是深拷贝，引用计数不改变。始终返回一个可变对象。</li>\n</ol>\n<p>并非所有的类都支持拷贝。只有遵循 NSCopying 协议的类，才支持 copy 拷贝，只有遵循 NSMutableCopying 协议的类，才支持 mutableCopy 拷贝。如果没有遵循拷贝协议拷贝时会出错。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"https://onevcat.com/2012/06/arc-hand-by-hand/\">手把手教你ARC——iOS/Mac开发ARC入门和使用</a><br><a href=\"https://www.cnblogs.com/ludashi/p/3894151.html\">Objective-C中的深拷贝和浅拷贝</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>\n","site":{"data":{}},"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第八篇文章，主要复习了自动引用计数与深浅拷贝。</p>","more":"<h3 id=\"手动引用计数总结\"><a href=\"#手动引用计数总结\" class=\"headerlink\" title=\"手动引用计数总结\"></a>手动引用计数总结</h3><ul>\n<li>若需保持对象不被销毁可以使用 retain，使用完对象后需使用 release 进行释放。</li>\n<li>给对象发送 release 消息不会必然销毁对象，只有当该对象的引用计数减至0时对象才会被销毁，接着系统会发送 dealloc 消息给这个对象用于释放内存。</li>\n<li>对使用了 retain 或者 copy、 mutableCopy、alloc 或 new 方法的任何对象，以及具有 retain 和 copy 特性的属性进行释放，需要覆盖 dealloc 方法，使得在对象被释放的时候能够释放这些实例变量。</li>\n<li>如果在方法中不再需要用到这个对象但需要将其返回，可以给这个对象发送 autorelease 消息以标记这个对象延迟释放。autorelease 消息并不会影响到对象的引用计数。</li>\n<li>当应用终止时内存中的所有对象都会被释放，不论它们是否在自动释放池中。</li>\n</ul>\n<h3 id=\"自动引用计数总结\"><a href=\"#自动引用计数总结\" class=\"headerlink\" title=\"自动引用计数总结\"></a>自动引用计数总结</h3><ul>\n<li>只要某个对象被任一 strong 指针指向，那么它将不会被销毁。如果对象没有被任何 strong 指针指向，那么就将被销毁。</li>\n<li>通常所有对象的指针变量都是强变量，将对象的引用赋给变量使对象自动保持，旧对象的引用会在赋值前被释放。</li>\n<li>当两个对象都持有彼此的强引用时，将会产生循环保持。如果对象仍然有引用，系统将不能销毁这个对象。如果两个对象都强引用彼此就不可以被销毁。</li>\n<li>解决强引用问题可以创建其他类型的对象变量，并允许使用弱引用。通过父视图持有子视图的强引用，子视图持有父视图的弱引用，这样就没有循环保持。弱变量也不能阻止引用的对象被销毁。</li>\n<li>以 <code>Objective-C</code>中的 delegate 设计模式为例，viewController 中有一个 strong 指针指向它所负责管理的 UITableView，而 UITableView 中的 dataSource 和 delegate 指针都指向 viewController 的 weak 指针。</li>\n<li>当声明一个弱变量，系统会追踪赋值给这个变量的引用。当引用的对象释放时，弱变量会被自动设置为nil。变量被设置为nil,给nil对象发送任何消息不会有反应，避免了无意间给这个变量发送消息引起的崩溃。</li>\n<li>如果需要持有一个对象，那么对其发送 retain。如果之后不再使用该对象，那么需要对其发送 release（或者autorelease） 每一次对 retain、alloc 或 new 的调用，需要对应一次 release 或 autorelease 调用。</li>\n</ul>\n<h3 id=\"深浅拷贝\"><a href=\"#深浅拷贝\" class=\"headerlink\" title=\"深浅拷贝\"></a>深浅拷贝</h3><h4 id=\"深拷贝\"><a href=\"#深拷贝\" class=\"headerlink\" title=\"深拷贝\"></a>深拷贝</h4><ul>\n<li>将原数据拷贝后存入一块新的内存中，并以新的指针指向新的内存。</li>\n<li>拷贝过程结束后，两个对象存储数据相同，内存地址不同。</li>\n<li>两个对象互不影响，互不干涉。</li>\n<li>源对象和副本的计数器相同。</li>\n<li>非容器类的浅拷贝只拷贝对象的地址，没有新的内存被分配。</li>\n<li>容器类的浅拷贝不拷贝容器的内容，两个容器的地址不同，在一个容器中修改值，另一个浅拷贝的容器中的值也会变化。</li>\n</ul>\n<h4 id=\"浅拷贝\"><a href=\"#浅拷贝\" class=\"headerlink\" title=\"浅拷贝\"></a>浅拷贝</h4><ul>\n<li>拷贝数据所在内存的地址，目标对象指针和源对象指向同一片内存空间。</li>\n<li>新对象计数器为1，源对象计数器不变。</li>\n<li>在<code>Objective-C</code>中使用 retain 关键字进行引用计数，使几个指针共用同一片内存空间，不会轻易的销毁内存。</li>\n<li>非容器类的深拷贝就是重写分配一块内存，然后把另一个对象的内容原封不动搬过来。对容器类的深拷贝是对容器中的每个元素都进行拷贝。</li>\n</ul>\n<h4 id=\"拷贝方式\"><a href=\"#拷贝方式\" class=\"headerlink\" title=\"拷贝方式\"></a>拷贝方式</h4><ol>\n<li><strong>retain</strong>：始终是浅拷贝。引用计数每次加1。返回对象是否可变与被复制的对象保持一致。</li>\n<li><strong>copy</strong>：对于可变对象为深拷贝，引用计数不改变；对于不可变对象是浅拷贝，引用计数每次加1。始终返回一个不可变对象。  </li>\n<li><strong>mutableCopy</strong>：始终是深拷贝，引用计数不改变。始终返回一个可变对象。</li>\n</ol>\n<p>并非所有的类都支持拷贝。只有遵循 NSCopying 协议的类，才支持 copy 拷贝，只有遵循 NSMutableCopying 协议的类，才支持 mutableCopy 拷贝。如果没有遵循拷贝协议拷贝时会出错。</p>\n<h3 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h3><p><a href=\"https://onevcat.com/2012/06/arc-hand-by-hand/\">手把手教你ARC——iOS/Mac开发ARC入门和使用</a><br><a href=\"https://www.cnblogs.com/ludashi/p/3894151.html\">Objective-C中的深拷贝和浅拷贝</a><br><a href=\"\">Objective-C 程序设计 (第六版)</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:01 GMT+0800 (中国标准时间)","title":"Objective-C 学习笔记(八）","path":"2020/04/24/Objc_Learning_8/","eyeCatchImage":null,"excerpt":"<p>最近开始学习 <code>Objective-C</code> 夯实基础，在此处总结可以方便本人更好地整理学习内容，此文为本系列的第八篇文章，主要复习了自动引用计数与深浅拷贝。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-24T14:23:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-24T14:23:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","iOS","Objective-C","ARC"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":1694},{"title":"OpenCV 图像滤波","date":"2020-04-01T10:40:20.000Z","copyright":true,"_content":"> 如果您不知道如何在 Mac 上使用 Xcode 配置 `OpenCV`，可以参考我之前的博文。\n\n利用像素本身以及其邻域象素的灰度关系进行增强的方法常称为滤波，而滤波器通过邻域运算实现。\n\n开始之前先给出滤波相关知识结构图。\n\n<!--more-->\n\n![滤波](http://image.stephenfang.me/mweb/滤波.png)\n\n## 理解滤波\n\n\n\n先给出邻域操作的过程；\n1. 将模板在输入图象中漫游，并将模板中心与图象中某个像素位置重合\n2. 将模板上的各个系数与模板下各对应像素的灰度值相乘\n3. 将所有乘积相加( 为保持灰度范围，常将结果再除以模板系数之和)\n4. 将上述结果(模板的输出响应)赋给输出图象中对应模板中心位置的象素\n\n> 均值滤波其实就是对目标像素及周边像素取平均值后再填会目标像素来实现滤波目的的方法。\n\n接下来给出均值滤波具体的操作方法：\n存在如下图片底板，可见图像中用蓝色标记的“99”为显著的噪声。\n![](http://image.stephenfang.me/mweb/15857298630296.jpg)\n尝试建立如下 3*3 邻域模版，模版可以暂且被理解为叠在图像上的内容，实为平滑卷积模版\n![](http://image.stephenfang.me/mweb/15857297422480.jpg)\n尝试对最左上角的重叠部分进行计算，计算方法为系数逐乘以邻域节点的数值：\n```\n 1/9 * (10x1 + 11x1 + 10x1 + 9x1 + 10x1 + 11x1 + 10x1 + 9x1 + 10x1) \n= 1/9 * (90) \n= 10\n```\n将运算结果“10”填充至中间位置，与原有结果相同。\n![](http://image.stephenfang.me/mweb/15857302402257.jpg)\n至此完成了卷积模版最基本操作，接下来尝试遍历扫描整个图像，即通过对模板的平移完成对整个图像的运算，如下图所示：\n![-w229](http://image.stephenfang.me/mweb/15857305800473.jpg)![-w229](http://image.stephenfang.me/mweb/15857305984728.jpg)\n此时运算过程为：\n```\n  1/9 *(10x1 + 0x1 + 0x1 + 11x1 + 1x1 + 0x1 + 10x1 + 0x1 + 2x1) \n= 1/9 *( 34) \n= 3.7778\n```\n将小数量化后填充至中心位置，并重复操作，原则为逐行扫描，逐列增长。\n![-w229](http://image.stephenfang.me/mweb/15857308419472.jpg)![-w229](http://image.stephenfang.me/mweb/15857308571783.jpg)\n可以观察到运算进行到最下角的区域时，原来的“99”数值被填充为“20”，噪声被有效抑制。\n你可能会发现，当然边缘处的图像无法通过该算法进行处理，然而存在以下方法：\n1. **拓宽原图** :人为将边缘像素往外复制，图像外的第零列就被复制为与第一列相同，图像外的第零行被复制为与第一行相同，最后补全四个对角。如 6*6 的原图就被拓宽为 7*7 的图像，再对拓宽后的图像进行卷积处理。\n2. **像素复制** :将已经处理完成的内部像素往外复制，如上图中 4*4 的内部像素已经完成卷积运算，尝试将其往外复制像素，如(2,2)位置的 10 覆盖(1，2)位置的 11 和(2,1)位置的9。\n3. **保持原样** :这也是一种方法，毕竟三种方法都存在误差。\n\n其他还存在很多模版，简要理解中值滤波法：\n![-w229](http://image.stephenfang.me/mweb/15857320034469.jpg)![-w229](http://image.stephenfang.me/mweb/15857320145830.jpg)\n正如其名，其计算方法为：\n1. 对邻域 10,9,11,9,99,11,11,10,10 进行排序\n2. 在排序后的数字 9,9,10,10,10,11,11,11,99 中寻找中间像素\n3. 查找到中位数“10”对”99“进行替换\n\n卷积也被称为算子，以下为著名的Prewitt算子（垂直方向与水平方向）\n![-w229](http://image.stephenfang.me/mweb/15857327960667.jpg)![-w235](http://image.stephenfang.me/mweb/15857328571767.jpg)\n它可以显著降低边缘精度，对噪声具有平滑作用。下图为原图\n![](http://image.stephenfang.me/mweb/15857329308611.jpg)\n以下左图为处理后的x方向图片，右图为处理后的y方向图片。\n![-w229](http://image.stephenfang.me/mweb/15857329552320.jpg)![-w238](http://image.stephenfang.me/mweb/15857329695411.jpg)\n最后给出简单的Sobel边缘检测算子。\n> 索贝尔算子是计算机视觉领域的一种重要处理方法。主要用于获得数字图像的一阶梯度，常见的应用和物理意义是边缘检测。索贝尔算子是把图像中每个像素的上下左右四领域的灰度值加权差，在边缘处达到极值从而检测边缘。\n\n左图为垂直方向的Sobel边缘检测算子，右图为水平方向的Sobel边缘检测算子。\n![-w229](http://image.stephenfang.me/mweb/15857325986198.jpg)![-w229](http://image.stephenfang.me/mweb/15857327147059.jpg)\n\n对于邻域操作的概念这里不复再议，接下来尝试通过`OpenCV`的 filter2D() 函数实践 3*3 卷积模板。\n\n## 代码解释\n尝试自己编写了一段代码后，在`OpenCV`官方文档中查找到了线性滤波器的内容，通过循环的方式体现均值滤波器在不同的卷积核大小对图像的影响，现将其做解释。\n\n该程序通过循环生成 sizes 为3、5、7、9、11 时的*normalized box filter*，即均值滤波器（上文中已提及）。\n对于`size = 3` 的卷积核，应进行如下操作，其中 1/9 为系数。\n![](http://image.stephenfang.me/mweb/15857352054151.jpg)\n给出`OpenCV`中 filter2D() 的定义：\n```objc\n\nvoid cv::filter2D\t(\t\nInputArray src, \nOutputArray dst,\nint \tddepth,\nInputArray \tkernel,\nPoint \tanchor = Point(-1,-1),\ndouble \tdelta = 0,\nint \tborderType = BORDER_DEFAULT \n)\t\n```\n对参数进行解释\n* src: 原图像\n* dst: 目标图像\n* ddepth: 图像深度.负数代表与原始图像相同，如 -1\n* kernel: 卷积核\n* anchor: 内核的基准点，默认(-1, -1) 代表处于中心位置\n* delta: 可选的添加到像素的值，默认为 0\n* BORDER_DEFAULT: 像素向外逼近的方法，默认值 BORDER_DEFAULT 表示对全部边界进行计算\n\n相比你已经能够了解如何处理这个程序了，接下来给出修改后的整个程序。\n\n```objc\n#include \"opencv2/imgproc.hpp\"\n#include \"opencv2/imgcodecs.hpp\"\n#include \"opencv2/highgui.hpp\"\nusing namespace cv;\nint main ( int argc, char** argv )\n{\n    Mat src, dst;\n    Mat kernel;\n    //初始化\n    double delta = 0;\n    int ddepth = -1;\n    int kernel_size;\n    Point anchor = Point( -1, -1 );\n    \n    // 加载图片\n  src = imread(\"original.jpeg\");\n    if( src.empty() )\n    {\n        printf(\"无法加载图片\\n\");\n        return EXIT_FAILURE;\n    }\n\n    // 执行循环：每隔0.5秒对图像执行不同卷积核下的滤波操作\n    int ind = 0;\n    for(;;)\n    {\n        // 为归一化滤波循环更新卷积核的大小，kernel_size在3-11间循环\n        kernel_size = 3 + 2*( ind%5 );\n        kernel = Mat::ones( kernel_size, kernel_size, CV_32F )/ (float)(kernel_size*kernel_size);\n        // 执行滤波器\n        filter2D(src, dst, ddepth , kernel, anchor, delta, BORDER_DEFAULT );\n        imshow( \"FilterTest\", dst );\n        char c = (char)waitKey(500);\n        // 按下Esc退出程序\n        if( c == 27 )\n        { break; }\n        ind++;\n    }\n    return EXIT_SUCCESS;\n}\n```\n## 结果\n给出以下测试图片效果，可以看出效果已经相当明显。\n![-w599](http://image.stephenfang.me/mweb/15857364490707.jpg)\n![-w599](http://image.stephenfang.me/mweb/15857363805369.jpg)\n![-w599](http://image.stephenfang.me/mweb/15857364391479.jpg)\n\n\n\n## 参考\n[Making your own linear filters - OpenCV Docs](https://docs.opencv.org/master/d4/dbd/tutorial_filter_2d.html)\n[空域增强与模板操作-浙江工业大学刘盛](https://mooc1-1.chaoxing.com/coursedata/toPreview?courseId=207584971&dataId=132888374&objectId=491305c721a2802f01b830bba5507385)\n[初识滤波之均值滤波](https://zhuanlan.zhihu.com/p/76188487)","source":"_posts/OpenCV_Filter.md","raw":"---\ntitle: OpenCV 图像滤波\ndate: 2020-04-01 18:40:20\ncategories: \n- 技术\ntags: \n- OpenCV\n- Xcode\ncopyright: true\n---\n> 如果您不知道如何在 Mac 上使用 Xcode 配置 `OpenCV`，可以参考我之前的博文。\n\n利用像素本身以及其邻域象素的灰度关系进行增强的方法常称为滤波，而滤波器通过邻域运算实现。\n\n开始之前先给出滤波相关知识结构图。\n\n<!--more-->\n\n![滤波](http://image.stephenfang.me/mweb/滤波.png)\n\n## 理解滤波\n\n\n\n先给出邻域操作的过程；\n1. 将模板在输入图象中漫游，并将模板中心与图象中某个像素位置重合\n2. 将模板上的各个系数与模板下各对应像素的灰度值相乘\n3. 将所有乘积相加( 为保持灰度范围，常将结果再除以模板系数之和)\n4. 将上述结果(模板的输出响应)赋给输出图象中对应模板中心位置的象素\n\n> 均值滤波其实就是对目标像素及周边像素取平均值后再填会目标像素来实现滤波目的的方法。\n\n接下来给出均值滤波具体的操作方法：\n存在如下图片底板，可见图像中用蓝色标记的“99”为显著的噪声。\n![](http://image.stephenfang.me/mweb/15857298630296.jpg)\n尝试建立如下 3*3 邻域模版，模版可以暂且被理解为叠在图像上的内容，实为平滑卷积模版\n![](http://image.stephenfang.me/mweb/15857297422480.jpg)\n尝试对最左上角的重叠部分进行计算，计算方法为系数逐乘以邻域节点的数值：\n```\n 1/9 * (10x1 + 11x1 + 10x1 + 9x1 + 10x1 + 11x1 + 10x1 + 9x1 + 10x1) \n= 1/9 * (90) \n= 10\n```\n将运算结果“10”填充至中间位置，与原有结果相同。\n![](http://image.stephenfang.me/mweb/15857302402257.jpg)\n至此完成了卷积模版最基本操作，接下来尝试遍历扫描整个图像，即通过对模板的平移完成对整个图像的运算，如下图所示：\n![-w229](http://image.stephenfang.me/mweb/15857305800473.jpg)![-w229](http://image.stephenfang.me/mweb/15857305984728.jpg)\n此时运算过程为：\n```\n  1/9 *(10x1 + 0x1 + 0x1 + 11x1 + 1x1 + 0x1 + 10x1 + 0x1 + 2x1) \n= 1/9 *( 34) \n= 3.7778\n```\n将小数量化后填充至中心位置，并重复操作，原则为逐行扫描，逐列增长。\n![-w229](http://image.stephenfang.me/mweb/15857308419472.jpg)![-w229](http://image.stephenfang.me/mweb/15857308571783.jpg)\n可以观察到运算进行到最下角的区域时，原来的“99”数值被填充为“20”，噪声被有效抑制。\n你可能会发现，当然边缘处的图像无法通过该算法进行处理，然而存在以下方法：\n1. **拓宽原图** :人为将边缘像素往外复制，图像外的第零列就被复制为与第一列相同，图像外的第零行被复制为与第一行相同，最后补全四个对角。如 6*6 的原图就被拓宽为 7*7 的图像，再对拓宽后的图像进行卷积处理。\n2. **像素复制** :将已经处理完成的内部像素往外复制，如上图中 4*4 的内部像素已经完成卷积运算，尝试将其往外复制像素，如(2,2)位置的 10 覆盖(1，2)位置的 11 和(2,1)位置的9。\n3. **保持原样** :这也是一种方法，毕竟三种方法都存在误差。\n\n其他还存在很多模版，简要理解中值滤波法：\n![-w229](http://image.stephenfang.me/mweb/15857320034469.jpg)![-w229](http://image.stephenfang.me/mweb/15857320145830.jpg)\n正如其名，其计算方法为：\n1. 对邻域 10,9,11,9,99,11,11,10,10 进行排序\n2. 在排序后的数字 9,9,10,10,10,11,11,11,99 中寻找中间像素\n3. 查找到中位数“10”对”99“进行替换\n\n卷积也被称为算子，以下为著名的Prewitt算子（垂直方向与水平方向）\n![-w229](http://image.stephenfang.me/mweb/15857327960667.jpg)![-w235](http://image.stephenfang.me/mweb/15857328571767.jpg)\n它可以显著降低边缘精度，对噪声具有平滑作用。下图为原图\n![](http://image.stephenfang.me/mweb/15857329308611.jpg)\n以下左图为处理后的x方向图片，右图为处理后的y方向图片。\n![-w229](http://image.stephenfang.me/mweb/15857329552320.jpg)![-w238](http://image.stephenfang.me/mweb/15857329695411.jpg)\n最后给出简单的Sobel边缘检测算子。\n> 索贝尔算子是计算机视觉领域的一种重要处理方法。主要用于获得数字图像的一阶梯度，常见的应用和物理意义是边缘检测。索贝尔算子是把图像中每个像素的上下左右四领域的灰度值加权差，在边缘处达到极值从而检测边缘。\n\n左图为垂直方向的Sobel边缘检测算子，右图为水平方向的Sobel边缘检测算子。\n![-w229](http://image.stephenfang.me/mweb/15857325986198.jpg)![-w229](http://image.stephenfang.me/mweb/15857327147059.jpg)\n\n对于邻域操作的概念这里不复再议，接下来尝试通过`OpenCV`的 filter2D() 函数实践 3*3 卷积模板。\n\n## 代码解释\n尝试自己编写了一段代码后，在`OpenCV`官方文档中查找到了线性滤波器的内容，通过循环的方式体现均值滤波器在不同的卷积核大小对图像的影响，现将其做解释。\n\n该程序通过循环生成 sizes 为3、5、7、9、11 时的*normalized box filter*，即均值滤波器（上文中已提及）。\n对于`size = 3` 的卷积核，应进行如下操作，其中 1/9 为系数。\n![](http://image.stephenfang.me/mweb/15857352054151.jpg)\n给出`OpenCV`中 filter2D() 的定义：\n```objc\n\nvoid cv::filter2D\t(\t\nInputArray src, \nOutputArray dst,\nint \tddepth,\nInputArray \tkernel,\nPoint \tanchor = Point(-1,-1),\ndouble \tdelta = 0,\nint \tborderType = BORDER_DEFAULT \n)\t\n```\n对参数进行解释\n* src: 原图像\n* dst: 目标图像\n* ddepth: 图像深度.负数代表与原始图像相同，如 -1\n* kernel: 卷积核\n* anchor: 内核的基准点，默认(-1, -1) 代表处于中心位置\n* delta: 可选的添加到像素的值，默认为 0\n* BORDER_DEFAULT: 像素向外逼近的方法，默认值 BORDER_DEFAULT 表示对全部边界进行计算\n\n相比你已经能够了解如何处理这个程序了，接下来给出修改后的整个程序。\n\n```objc\n#include \"opencv2/imgproc.hpp\"\n#include \"opencv2/imgcodecs.hpp\"\n#include \"opencv2/highgui.hpp\"\nusing namespace cv;\nint main ( int argc, char** argv )\n{\n    Mat src, dst;\n    Mat kernel;\n    //初始化\n    double delta = 0;\n    int ddepth = -1;\n    int kernel_size;\n    Point anchor = Point( -1, -1 );\n    \n    // 加载图片\n  src = imread(\"original.jpeg\");\n    if( src.empty() )\n    {\n        printf(\"无法加载图片\\n\");\n        return EXIT_FAILURE;\n    }\n\n    // 执行循环：每隔0.5秒对图像执行不同卷积核下的滤波操作\n    int ind = 0;\n    for(;;)\n    {\n        // 为归一化滤波循环更新卷积核的大小，kernel_size在3-11间循环\n        kernel_size = 3 + 2*( ind%5 );\n        kernel = Mat::ones( kernel_size, kernel_size, CV_32F )/ (float)(kernel_size*kernel_size);\n        // 执行滤波器\n        filter2D(src, dst, ddepth , kernel, anchor, delta, BORDER_DEFAULT );\n        imshow( \"FilterTest\", dst );\n        char c = (char)waitKey(500);\n        // 按下Esc退出程序\n        if( c == 27 )\n        { break; }\n        ind++;\n    }\n    return EXIT_SUCCESS;\n}\n```\n## 结果\n给出以下测试图片效果，可以看出效果已经相当明显。\n![-w599](http://image.stephenfang.me/mweb/15857364490707.jpg)\n![-w599](http://image.stephenfang.me/mweb/15857363805369.jpg)\n![-w599](http://image.stephenfang.me/mweb/15857364391479.jpg)\n\n\n\n## 参考\n[Making your own linear filters - OpenCV Docs](https://docs.opencv.org/master/d4/dbd/tutorial_filter_2d.html)\n[空域增强与模板操作-浙江工业大学刘盛](https://mooc1-1.chaoxing.com/coursedata/toPreview?courseId=207584971&dataId=132888374&objectId=491305c721a2802f01b830bba5507385)\n[初识滤波之均值滤波](https://zhuanlan.zhihu.com/p/76188487)","slug":"OpenCV_Filter","published":1,"updated":"2022-07-24T15:21:07.478Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp23001no76fha5zdwqo","content":"<blockquote>\n<p>如果您不知道如何在 Mac 上使用 Xcode 配置 <code>OpenCV</code>，可以参考我之前的博文。</p>\n</blockquote>\n<p>利用像素本身以及其邻域象素的灰度关系进行增强的方法常称为滤波，而滤波器通过邻域运算实现。</p>\n<p>开始之前先给出滤波相关知识结构图。</p>\n<span id=\"more\"></span>\n\n<p><img src=\"http://image.stephenfang.me/mweb/%E6%BB%A4%E6%B3%A2.png\" alt=\"滤波\"></p>\n<h2 id=\"理解滤波\"><a href=\"#理解滤波\" class=\"headerlink\" title=\"理解滤波\"></a>理解滤波</h2><p>先给出邻域操作的过程；</p>\n<ol>\n<li>将模板在输入图象中漫游，并将模板中心与图象中某个像素位置重合</li>\n<li>将模板上的各个系数与模板下各对应像素的灰度值相乘</li>\n<li>将所有乘积相加( 为保持灰度范围，常将结果再除以模板系数之和)</li>\n<li>将上述结果(模板的输出响应)赋给输出图象中对应模板中心位置的象素</li>\n</ol>\n<blockquote>\n<p>均值滤波其实就是对目标像素及周边像素取平均值后再填会目标像素来实现滤波目的的方法。</p>\n</blockquote>\n<p>接下来给出均值滤波具体的操作方法：<br>存在如下图片底板，可见图像中用蓝色标记的“99”为显著的噪声。<br><img src=\"http://image.stephenfang.me/mweb/15857298630296.jpg\"><br>尝试建立如下 3*3 邻域模版，模版可以暂且被理解为叠在图像上的内容，实为平滑卷积模版<br><img src=\"http://image.stephenfang.me/mweb/15857297422480.jpg\"><br>尝试对最左上角的重叠部分进行计算，计算方法为系数逐乘以邻域节点的数值：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> 1/9 * (10x1 + 11x1 + 10x1 + 9x1 + 10x1 + 11x1 + 10x1 + 9x1 + 10x1) </span><br><span class=\"line\">= 1/9 * (90) </span><br><span class=\"line\">= 10</span><br></pre></td></tr></table></figure>\n<p>将运算结果“10”填充至中间位置，与原有结果相同。<br><img src=\"http://image.stephenfang.me/mweb/15857302402257.jpg\"><br>至此完成了卷积模版最基本操作，接下来尝试遍历扫描整个图像，即通过对模板的平移完成对整个图像的运算，如下图所示：<br><img src=\"http://image.stephenfang.me/mweb/15857305800473.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857305984728.jpg\" alt=\"-w229\"><br>此时运算过程为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  1/9 *(10x1 + 0x1 + 0x1 + 11x1 + 1x1 + 0x1 + 10x1 + 0x1 + 2x1) </span><br><span class=\"line\">= 1/9 *( 34) </span><br><span class=\"line\">= 3.7778</span><br></pre></td></tr></table></figure>\n<p>将小数量化后填充至中心位置，并重复操作，原则为逐行扫描，逐列增长。<br><img src=\"http://image.stephenfang.me/mweb/15857308419472.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857308571783.jpg\" alt=\"-w229\"><br>可以观察到运算进行到最下角的区域时，原来的“99”数值被填充为“20”，噪声被有效抑制。<br>你可能会发现，当然边缘处的图像无法通过该算法进行处理，然而存在以下方法：</p>\n<ol>\n<li><strong>拓宽原图</strong> :人为将边缘像素往外复制，图像外的第零列就被复制为与第一列相同，图像外的第零行被复制为与第一行相同，最后补全四个对角。如 6<em>6 的原图就被拓宽为 7</em>7 的图像，再对拓宽后的图像进行卷积处理。</li>\n<li><strong>像素复制</strong> :将已经处理完成的内部像素往外复制，如上图中 4*4 的内部像素已经完成卷积运算，尝试将其往外复制像素，如(2,2)位置的 10 覆盖(1，2)位置的 11 和(2,1)位置的9。</li>\n<li><strong>保持原样</strong> :这也是一种方法，毕竟三种方法都存在误差。</li>\n</ol>\n<p>其他还存在很多模版，简要理解中值滤波法：<br><img src=\"http://image.stephenfang.me/mweb/15857320034469.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857320145830.jpg\" alt=\"-w229\"><br>正如其名，其计算方法为：</p>\n<ol>\n<li>对邻域 10,9,11,9,99,11,11,10,10 进行排序</li>\n<li>在排序后的数字 9,9,10,10,10,11,11,11,99 中寻找中间像素</li>\n<li>查找到中位数“10”对”99“进行替换</li>\n</ol>\n<p>卷积也被称为算子，以下为著名的Prewitt算子（垂直方向与水平方向）<br><img src=\"http://image.stephenfang.me/mweb/15857327960667.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857328571767.jpg\" alt=\"-w235\"><br>它可以显著降低边缘精度，对噪声具有平滑作用。下图为原图<br><img src=\"http://image.stephenfang.me/mweb/15857329308611.jpg\"><br>以下左图为处理后的x方向图片，右图为处理后的y方向图片。<br><img src=\"http://image.stephenfang.me/mweb/15857329552320.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857329695411.jpg\" alt=\"-w238\"><br>最后给出简单的Sobel边缘检测算子。</p>\n<blockquote>\n<p>索贝尔算子是计算机视觉领域的一种重要处理方法。主要用于获得数字图像的一阶梯度，常见的应用和物理意义是边缘检测。索贝尔算子是把图像中每个像素的上下左右四领域的灰度值加权差，在边缘处达到极值从而检测边缘。</p>\n</blockquote>\n<p>左图为垂直方向的Sobel边缘检测算子，右图为水平方向的Sobel边缘检测算子。<br><img src=\"http://image.stephenfang.me/mweb/15857325986198.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857327147059.jpg\" alt=\"-w229\"></p>\n<p>对于邻域操作的概念这里不复再议，接下来尝试通过<code>OpenCV</code>的 filter2D() 函数实践 3*3 卷积模板。</p>\n<h2 id=\"代码解释\"><a href=\"#代码解释\" class=\"headerlink\" title=\"代码解释\"></a>代码解释</h2><p>尝试自己编写了一段代码后，在<code>OpenCV</code>官方文档中查找到了线性滤波器的内容，通过循环的方式体现均值滤波器在不同的卷积核大小对图像的影响，现将其做解释。</p>\n<p>该程序通过循环生成 sizes 为3、5、7、9、11 时的<em>normalized box filter</em>，即均值滤波器（上文中已提及）。<br>对于<code>size = 3</code> 的卷积核，应进行如下操作，其中 1/9 为系数。<br><img src=\"http://image.stephenfang.me/mweb/15857352054151.jpg\"><br>给出<code>OpenCV</code>中 filter2D() 的定义：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> cv::filter2D\t(\t</span><br><span class=\"line\">InputArray src, </span><br><span class=\"line\">OutputArray dst,</span><br><span class=\"line\"><span class=\"keyword\">int</span> \tddepth,</span><br><span class=\"line\">InputArray \tkernel,</span><br><span class=\"line\">Point \tanchor = Point(<span class=\"number\">-1</span>,<span class=\"number\">-1</span>),</span><br><span class=\"line\"><span class=\"keyword\">double</span> \tdelta = <span class=\"number\">0</span>,</span><br><span class=\"line\"><span class=\"keyword\">int</span> \tborderType = BORDER_DEFAULT </span><br><span class=\"line\">)\t</span><br></pre></td></tr></table></figure>\n<p>对参数进行解释</p>\n<ul>\n<li>src: 原图像</li>\n<li>dst: 目标图像</li>\n<li>ddepth: 图像深度.负数代表与原始图像相同，如 -1</li>\n<li>kernel: 卷积核</li>\n<li>anchor: 内核的基准点，默认(-1, -1) 代表处于中心位置</li>\n<li>delta: 可选的添加到像素的值，默认为 0</li>\n<li>BORDER_DEFAULT: 像素向外逼近的方法，默认值 BORDER_DEFAULT 表示对全部边界进行计算</li>\n</ul>\n<p>相比你已经能够了解如何处理这个程序了，接下来给出修改后的整个程序。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;opencv2/imgcodecs.hpp&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class=\"line\">using namespace cv;</span><br><span class=\"line\"><span class=\"keyword\">int</span> main ( <span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Mat src, dst;</span><br><span class=\"line\">    Mat kernel;</span><br><span class=\"line\">    <span class=\"comment\">//初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">double</span> delta = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ddepth = <span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> kernel_size;</span><br><span class=\"line\">    Point anchor = Point( <span class=\"number\">-1</span>, <span class=\"number\">-1</span> );</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 加载图片</span></span><br><span class=\"line\">  src = imread(<span class=\"string\">&quot;original.jpeg&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( src.empty() )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        printf(<span class=\"string\">&quot;无法加载图片\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 执行循环：每隔0.5秒对图像执行不同卷积核下的滤波操作</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> ind = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(;;)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 为归一化滤波循环更新卷积核的大小，kernel_size在3-11间循环</span></span><br><span class=\"line\">        kernel_size = <span class=\"number\">3</span> + <span class=\"number\">2</span>*( ind%<span class=\"number\">5</span> );</span><br><span class=\"line\">        kernel = Mat::ones( kernel_size, kernel_size, CV_32F )/ (<span class=\"keyword\">float</span>)(kernel_size*kernel_size);</span><br><span class=\"line\">        <span class=\"comment\">// 执行滤波器</span></span><br><span class=\"line\">        filter2D(src, dst, ddepth , kernel, anchor, delta, BORDER_DEFAULT );</span><br><span class=\"line\">        imshow( <span class=\"string\">&quot;FilterTest&quot;</span>, dst );</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = (<span class=\"keyword\">char</span>)waitKey(<span class=\"number\">500</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 按下Esc退出程序</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( c == <span class=\"number\">27</span> )</span><br><span class=\"line\">        &#123; <span class=\"keyword\">break</span>; &#125;</span><br><span class=\"line\">        ind++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> EXIT_SUCCESS;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h2><p>给出以下测试图片效果，可以看出效果已经相当明显。<br><img src=\"http://image.stephenfang.me/mweb/15857364490707.jpg\" alt=\"-w599\"><br><img src=\"http://image.stephenfang.me/mweb/15857363805369.jpg\" alt=\"-w599\"><br><img src=\"http://image.stephenfang.me/mweb/15857364391479.jpg\" alt=\"-w599\"></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://docs.opencv.org/master/d4/dbd/tutorial_filter_2d.html\">Making your own linear filters - OpenCV Docs</a><br><a href=\"https://mooc1-1.chaoxing.com/coursedata/toPreview?courseId=207584971&dataId=132888374&objectId=491305c721a2802f01b830bba5507385\">空域增强与模板操作-浙江工业大学刘盛</a><br><a href=\"https://zhuanlan.zhihu.com/p/76188487\">初识滤波之均值滤波</a></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>如果您不知道如何在 Mac 上使用 Xcode 配置 <code>OpenCV</code>，可以参考我之前的博文。</p>\n</blockquote>\n<p>利用像素本身以及其邻域象素的灰度关系进行增强的方法常称为滤波，而滤波器通过邻域运算实现。</p>\n<p>开始之前先给出滤波相关知识结构图。</p>","more":"<p><img src=\"http://image.stephenfang.me/mweb/%E6%BB%A4%E6%B3%A2.png\" alt=\"滤波\"></p>\n<h2 id=\"理解滤波\"><a href=\"#理解滤波\" class=\"headerlink\" title=\"理解滤波\"></a>理解滤波</h2><p>先给出邻域操作的过程；</p>\n<ol>\n<li>将模板在输入图象中漫游，并将模板中心与图象中某个像素位置重合</li>\n<li>将模板上的各个系数与模板下各对应像素的灰度值相乘</li>\n<li>将所有乘积相加( 为保持灰度范围，常将结果再除以模板系数之和)</li>\n<li>将上述结果(模板的输出响应)赋给输出图象中对应模板中心位置的象素</li>\n</ol>\n<blockquote>\n<p>均值滤波其实就是对目标像素及周边像素取平均值后再填会目标像素来实现滤波目的的方法。</p>\n</blockquote>\n<p>接下来给出均值滤波具体的操作方法：<br>存在如下图片底板，可见图像中用蓝色标记的“99”为显著的噪声。<br><img src=\"http://image.stephenfang.me/mweb/15857298630296.jpg\"><br>尝试建立如下 3*3 邻域模版，模版可以暂且被理解为叠在图像上的内容，实为平滑卷积模版<br><img src=\"http://image.stephenfang.me/mweb/15857297422480.jpg\"><br>尝试对最左上角的重叠部分进行计算，计算方法为系数逐乘以邻域节点的数值：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"> 1/9 * (10x1 + 11x1 + 10x1 + 9x1 + 10x1 + 11x1 + 10x1 + 9x1 + 10x1) </span><br><span class=\"line\">= 1/9 * (90) </span><br><span class=\"line\">= 10</span><br></pre></td></tr></table></figure>\n<p>将运算结果“10”填充至中间位置，与原有结果相同。<br><img src=\"http://image.stephenfang.me/mweb/15857302402257.jpg\"><br>至此完成了卷积模版最基本操作，接下来尝试遍历扫描整个图像，即通过对模板的平移完成对整个图像的运算，如下图所示：<br><img src=\"http://image.stephenfang.me/mweb/15857305800473.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857305984728.jpg\" alt=\"-w229\"><br>此时运算过程为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">  1/9 *(10x1 + 0x1 + 0x1 + 11x1 + 1x1 + 0x1 + 10x1 + 0x1 + 2x1) </span><br><span class=\"line\">= 1/9 *( 34) </span><br><span class=\"line\">= 3.7778</span><br></pre></td></tr></table></figure>\n<p>将小数量化后填充至中心位置，并重复操作，原则为逐行扫描，逐列增长。<br><img src=\"http://image.stephenfang.me/mweb/15857308419472.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857308571783.jpg\" alt=\"-w229\"><br>可以观察到运算进行到最下角的区域时，原来的“99”数值被填充为“20”，噪声被有效抑制。<br>你可能会发现，当然边缘处的图像无法通过该算法进行处理，然而存在以下方法：</p>\n<ol>\n<li><strong>拓宽原图</strong> :人为将边缘像素往外复制，图像外的第零列就被复制为与第一列相同，图像外的第零行被复制为与第一行相同，最后补全四个对角。如 6<em>6 的原图就被拓宽为 7</em>7 的图像，再对拓宽后的图像进行卷积处理。</li>\n<li><strong>像素复制</strong> :将已经处理完成的内部像素往外复制，如上图中 4*4 的内部像素已经完成卷积运算，尝试将其往外复制像素，如(2,2)位置的 10 覆盖(1，2)位置的 11 和(2,1)位置的9。</li>\n<li><strong>保持原样</strong> :这也是一种方法，毕竟三种方法都存在误差。</li>\n</ol>\n<p>其他还存在很多模版，简要理解中值滤波法：<br><img src=\"http://image.stephenfang.me/mweb/15857320034469.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857320145830.jpg\" alt=\"-w229\"><br>正如其名，其计算方法为：</p>\n<ol>\n<li>对邻域 10,9,11,9,99,11,11,10,10 进行排序</li>\n<li>在排序后的数字 9,9,10,10,10,11,11,11,99 中寻找中间像素</li>\n<li>查找到中位数“10”对”99“进行替换</li>\n</ol>\n<p>卷积也被称为算子，以下为著名的Prewitt算子（垂直方向与水平方向）<br><img src=\"http://image.stephenfang.me/mweb/15857327960667.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857328571767.jpg\" alt=\"-w235\"><br>它可以显著降低边缘精度，对噪声具有平滑作用。下图为原图<br><img src=\"http://image.stephenfang.me/mweb/15857329308611.jpg\"><br>以下左图为处理后的x方向图片，右图为处理后的y方向图片。<br><img src=\"http://image.stephenfang.me/mweb/15857329552320.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857329695411.jpg\" alt=\"-w238\"><br>最后给出简单的Sobel边缘检测算子。</p>\n<blockquote>\n<p>索贝尔算子是计算机视觉领域的一种重要处理方法。主要用于获得数字图像的一阶梯度，常见的应用和物理意义是边缘检测。索贝尔算子是把图像中每个像素的上下左右四领域的灰度值加权差，在边缘处达到极值从而检测边缘。</p>\n</blockquote>\n<p>左图为垂直方向的Sobel边缘检测算子，右图为水平方向的Sobel边缘检测算子。<br><img src=\"http://image.stephenfang.me/mweb/15857325986198.jpg\" alt=\"-w229\"><img src=\"http://image.stephenfang.me/mweb/15857327147059.jpg\" alt=\"-w229\"></p>\n<p>对于邻域操作的概念这里不复再议，接下来尝试通过<code>OpenCV</code>的 filter2D() 函数实践 3*3 卷积模板。</p>\n<h2 id=\"代码解释\"><a href=\"#代码解释\" class=\"headerlink\" title=\"代码解释\"></a>代码解释</h2><p>尝试自己编写了一段代码后，在<code>OpenCV</code>官方文档中查找到了线性滤波器的内容，通过循环的方式体现均值滤波器在不同的卷积核大小对图像的影响，现将其做解释。</p>\n<p>该程序通过循环生成 sizes 为3、5、7、9、11 时的<em>normalized box filter</em>，即均值滤波器（上文中已提及）。<br>对于<code>size = 3</code> 的卷积核，应进行如下操作，其中 1/9 为系数。<br><img src=\"http://image.stephenfang.me/mweb/15857352054151.jpg\"><br>给出<code>OpenCV</code>中 filter2D() 的定义：</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">void</span> cv::filter2D\t(\t</span><br><span class=\"line\">InputArray src, </span><br><span class=\"line\">OutputArray dst,</span><br><span class=\"line\"><span class=\"keyword\">int</span> \tddepth,</span><br><span class=\"line\">InputArray \tkernel,</span><br><span class=\"line\">Point \tanchor = Point(<span class=\"number\">-1</span>,<span class=\"number\">-1</span>),</span><br><span class=\"line\"><span class=\"keyword\">double</span> \tdelta = <span class=\"number\">0</span>,</span><br><span class=\"line\"><span class=\"keyword\">int</span> \tborderType = BORDER_DEFAULT </span><br><span class=\"line\">)\t</span><br></pre></td></tr></table></figure>\n<p>对参数进行解释</p>\n<ul>\n<li>src: 原图像</li>\n<li>dst: 目标图像</li>\n<li>ddepth: 图像深度.负数代表与原始图像相同，如 -1</li>\n<li>kernel: 卷积核</li>\n<li>anchor: 内核的基准点，默认(-1, -1) 代表处于中心位置</li>\n<li>delta: 可选的添加到像素的值，默认为 0</li>\n<li>BORDER_DEFAULT: 像素向外逼近的方法，默认值 BORDER_DEFAULT 表示对全部边界进行计算</li>\n</ul>\n<p>相比你已经能够了解如何处理这个程序了，接下来给出修改后的整个程序。</p>\n<figure class=\"highlight objc\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;opencv2/imgproc.hpp&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;opencv2/imgcodecs.hpp&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&quot;opencv2/highgui.hpp&quot;</span></span></span><br><span class=\"line\">using namespace cv;</span><br><span class=\"line\"><span class=\"keyword\">int</span> main ( <span class=\"keyword\">int</span> argc, <span class=\"keyword\">char</span>** argv )</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    Mat src, dst;</span><br><span class=\"line\">    Mat kernel;</span><br><span class=\"line\">    <span class=\"comment\">//初始化</span></span><br><span class=\"line\">    <span class=\"keyword\">double</span> delta = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> ddepth = <span class=\"number\">-1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> kernel_size;</span><br><span class=\"line\">    Point anchor = Point( <span class=\"number\">-1</span>, <span class=\"number\">-1</span> );</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 加载图片</span></span><br><span class=\"line\">  src = imread(<span class=\"string\">&quot;original.jpeg&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">if</span>( src.empty() )</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        printf(<span class=\"string\">&quot;无法加载图片\\n&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> EXIT_FAILURE;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 执行循环：每隔0.5秒对图像执行不同卷积核下的滤波操作</span></span><br><span class=\"line\">    <span class=\"keyword\">int</span> ind = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(;;)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 为归一化滤波循环更新卷积核的大小，kernel_size在3-11间循环</span></span><br><span class=\"line\">        kernel_size = <span class=\"number\">3</span> + <span class=\"number\">2</span>*( ind%<span class=\"number\">5</span> );</span><br><span class=\"line\">        kernel = Mat::ones( kernel_size, kernel_size, CV_32F )/ (<span class=\"keyword\">float</span>)(kernel_size*kernel_size);</span><br><span class=\"line\">        <span class=\"comment\">// 执行滤波器</span></span><br><span class=\"line\">        filter2D(src, dst, ddepth , kernel, anchor, delta, BORDER_DEFAULT );</span><br><span class=\"line\">        imshow( <span class=\"string\">&quot;FilterTest&quot;</span>, dst );</span><br><span class=\"line\">        <span class=\"keyword\">char</span> c = (<span class=\"keyword\">char</span>)waitKey(<span class=\"number\">500</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 按下Esc退出程序</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>( c == <span class=\"number\">27</span> )</span><br><span class=\"line\">        &#123; <span class=\"keyword\">break</span>; &#125;</span><br><span class=\"line\">        ind++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> EXIT_SUCCESS;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"结果\"><a href=\"#结果\" class=\"headerlink\" title=\"结果\"></a>结果</h2><p>给出以下测试图片效果，可以看出效果已经相当明显。<br><img src=\"http://image.stephenfang.me/mweb/15857364490707.jpg\" alt=\"-w599\"><br><img src=\"http://image.stephenfang.me/mweb/15857363805369.jpg\" alt=\"-w599\"><br><img src=\"http://image.stephenfang.me/mweb/15857364391479.jpg\" alt=\"-w599\"></p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://docs.opencv.org/master/d4/dbd/tutorial_filter_2d.html\">Making your own linear filters - OpenCV Docs</a><br><a href=\"https://mooc1-1.chaoxing.com/coursedata/toPreview?courseId=207584971&dataId=132888374&objectId=491305c721a2802f01b830bba5507385\">空域增强与模板操作-浙江工业大学刘盛</a><br><a href=\"https://zhuanlan.zhihu.com/p/76188487\">初识滤波之均值滤波</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/%E6%BB%A4%E6%B3%A2.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:07 GMT+0800 (中国标准时间)","title":"OpenCV 图像滤波","path":"2020/04/01/OpenCV_Filter/","eyeCatchImage":"http://image.stephenfang.me/mweb/%E6%BB%A4%E6%B3%A2.png","excerpt":"<blockquote>\n<p>如果您不知道如何在 Mac 上使用 Xcode 配置 <code>OpenCV</code>，可以参考我之前的博文。</p>\n</blockquote>\n<p>利用像素本身以及其邻域象素的灰度关系进行增强的方法常称为滤波，而滤波器通过邻域运算实现。</p>\n<p>开始之前先给出滤波相关知识结构图。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-01T10:40:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-01T10:40:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","OpenCV"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":2837},{"title":"OpenCV 图像直方图与均衡化","date":"2020-03-16T08:20:20.000Z","copyright":true,"_content":"\n> 如果您不知道如何在 Mac 上使用 Xcode 配置 `OpenCV`，可以参考我写的上一篇博文。\n\n直方图是图像的一种统计表达，反映了图像中灰度的分布情况。以概率论为基础的，通过改变图像的直方图来改变图象中像素的灰度，以达到图像增强的目标，常称直方图修正。\n\n<!--more-->\n![](http://image.stephenfang.me/mweb/Histogram.png)\n\n直方图均衡化原理即借助直方图变换实现（归一的）灰度映射，实现思想为对在图像中像素个数多的灰度级进行展宽，而对像素个数少的灰度级进行缩减。从而达到清晰图像的目的。\n\n回到 `OpenCV`，`OpenCV`中提供了`equalizeHist`函数实现灰度图像直方图均衡化，给出如下函数原型及相关文档。\n\n```cpp\nvoid cv::equalizeHist\t(\tInputArray src,\nOutputArray \tdst \n)\t\n```\n\n![](http://image.stephenfang.me/mweb/equa.jpg)\n\n实现的图像直方图均衡化算法就是把直方图的每个灰度级进行归一化处理，求各个灰度的累积分布并得到一个映射的灰度映射表，最后根据相应的灰度值来修正原图中的每个像素的像素值。\n\n`OpenCV`中提供了`cvtColor`函数实现彩色图像转为灰度图像，给出如下函数原型及相关文档。\n![](http://image.stephenfang.me/mweb/cvcolor.png)\n\n至于直方图的绘制方法，`OpenCV`中提供了`calcList`函数计算图像直方图，尝试使用函数来实现会更符合操作流程。\n![](http://image.stephenfang.me/mweb/calcHist.jpg)\n\n## 说明\n本次实验需要完成以下任务：\n1. 完成直方图的绘制\n2. 使 RGB 图像变为灰度图像\n3. 完成图像直方图均衡化\n给出如下代码：\n\n```cpp\n#include <opencv2/opencv.hpp>\n#include <iostream>\n\nusing namespace cv;\nusing namespace std;\n\n MatND getHistogram(Mat &image)\n{\n    MatND hist;\n    int channels[] = {0};\n    int dims = 1;\n    int histSize[] = {256};\n    float granges[] = {0, 255};\n    const float *ranges[] = {granges};\n    calcHist(&image, 1, channels, Mat(), hist, dims, histSize, ranges);\n    return hist;\n}\n //  将图像直方图展示出来\n Mat getHistogramImage(Mat &image)\n{\n    MatND hist = getHistogram(image);\n    Mat showImage(256,256, CV_8U,Scalar(0));\n    int i;\n    double maxValue = 0;\n    minMaxLoc(hist, 0, &maxValue, 0, 0);\n    for(i = 0; i < 256; i++)\n    {\n        float value = hist.at<float>(i);\n        int intensity = saturate_cast<int>(256 - 256* (value/maxValue));\n        rectangle(showImage, Point(i,256 - 1), Point((i+1)-1, intensity), Scalar(255));\n    }\n    return showImage;\n}\n\nint main()\n{\n    Mat src= imread(\"original.jpeg\");// 读取图片\n    Mat gray,equa;\n    Mat grayHistogram,equaHistogram;\n\n    if(!src.data)             // 检查非法输入\n      {\n          cout <<  \"无法读取照片\" << endl ;\n          return -1;\n      }\n\n    namedWindow(\"RGB\",WINDOW_AUTOSIZE);   // 创建图片显示自动调整大小的窗口\n    imshow(\"RGB\",src);    // 在窗口显示原始图片\n    \n    cvtColor(src, gray, COLOR_BGR2GRAY);\n    namedWindow(\"GRAY\",WINDOW_AUTOSIZE);\n    imshow(\"GRAY\",gray);    // 在窗口显示灰度图片\n    \n    grayHistogram = getHistogramImage(gray);\n    //获得灰度图直方图\n    namedWindow(\"FirstHistogram\",WINDOW_AUTOSIZE);\n    imshow(\"FirstHistogram\",grayHistogram); // 在窗口显示灰度图直方图\n    \n    equalizeHist(gray, equa);\n    namedWindow(\"EQUA\",WINDOW_AUTOSIZE); \n    imshow(\"EQUA\",equa);    // 在窗口显示均衡化处理后图片\n    \n    imwrite(\"result.jpg\", equa); // 存储实验结果\n    \n    equaHistogram = getHistogramImage(equa);  //获得均衡化处理后直方图\n    namedWindow(\"SecondHistogram\",WINDOW_AUTOSIZE; \n imshow(\"SecondHistogram\",equaHistogram);    // 在窗口显示均衡化处理后\n    \n    waitKey(0); // 按键等待，需要在窗口任意输入字符退出，0代表永久等待\n    \n    src.release();\n    gray.release();\n    equa.release();\n    grayHistogram.release();\n    equaHistogram.release();\n    destroyWindow(\"RGB\");\n    destroyWindow(\"GRAY\");\n    destroyWindow(\"EQUA\");\n    destroyWindow(\"FirstHistogram\");\n    destroyWindow(\"SecondHistogram\");\n    return 0;\n}\n```\n\n## 实验结果\n\n![](http://image.stephenfang.me/mweb/result.png)\n第一张图片为未处理过的原图，第二张图片为灰度处理后的图片。第三张图片为均衡化处理后的灰度图，从直方图很能看出区别。\n\n## 参考\n[OpenCV官方文档](https://docs.opencv.org/master/)\n[Dongcheng Lai的知乎专栏](https://zhuanlan.zhihu.com/p/73201428)\n[opencv图像直方图的计算及绘制-Naruto_Q的博客](https://blog.csdn.net/piaoxuezhong/article/details/54588270)","source":"_posts/OpenCV_Grayscale.md","raw":"---\ntitle: OpenCV 图像直方图与均衡化\ndate: 2020-03-16 16:20:20\ncategories: \n- 技术\ntags: \n- OpenCV\n- Xcode\n- Grayscale\ncopyright: true\n---\n\n> 如果您不知道如何在 Mac 上使用 Xcode 配置 `OpenCV`，可以参考我写的上一篇博文。\n\n直方图是图像的一种统计表达，反映了图像中灰度的分布情况。以概率论为基础的，通过改变图像的直方图来改变图象中像素的灰度，以达到图像增强的目标，常称直方图修正。\n\n<!--more-->\n![](http://image.stephenfang.me/mweb/Histogram.png)\n\n直方图均衡化原理即借助直方图变换实现（归一的）灰度映射，实现思想为对在图像中像素个数多的灰度级进行展宽，而对像素个数少的灰度级进行缩减。从而达到清晰图像的目的。\n\n回到 `OpenCV`，`OpenCV`中提供了`equalizeHist`函数实现灰度图像直方图均衡化，给出如下函数原型及相关文档。\n\n```cpp\nvoid cv::equalizeHist\t(\tInputArray src,\nOutputArray \tdst \n)\t\n```\n\n![](http://image.stephenfang.me/mweb/equa.jpg)\n\n实现的图像直方图均衡化算法就是把直方图的每个灰度级进行归一化处理，求各个灰度的累积分布并得到一个映射的灰度映射表，最后根据相应的灰度值来修正原图中的每个像素的像素值。\n\n`OpenCV`中提供了`cvtColor`函数实现彩色图像转为灰度图像，给出如下函数原型及相关文档。\n![](http://image.stephenfang.me/mweb/cvcolor.png)\n\n至于直方图的绘制方法，`OpenCV`中提供了`calcList`函数计算图像直方图，尝试使用函数来实现会更符合操作流程。\n![](http://image.stephenfang.me/mweb/calcHist.jpg)\n\n## 说明\n本次实验需要完成以下任务：\n1. 完成直方图的绘制\n2. 使 RGB 图像变为灰度图像\n3. 完成图像直方图均衡化\n给出如下代码：\n\n```cpp\n#include <opencv2/opencv.hpp>\n#include <iostream>\n\nusing namespace cv;\nusing namespace std;\n\n MatND getHistogram(Mat &image)\n{\n    MatND hist;\n    int channels[] = {0};\n    int dims = 1;\n    int histSize[] = {256};\n    float granges[] = {0, 255};\n    const float *ranges[] = {granges};\n    calcHist(&image, 1, channels, Mat(), hist, dims, histSize, ranges);\n    return hist;\n}\n //  将图像直方图展示出来\n Mat getHistogramImage(Mat &image)\n{\n    MatND hist = getHistogram(image);\n    Mat showImage(256,256, CV_8U,Scalar(0));\n    int i;\n    double maxValue = 0;\n    minMaxLoc(hist, 0, &maxValue, 0, 0);\n    for(i = 0; i < 256; i++)\n    {\n        float value = hist.at<float>(i);\n        int intensity = saturate_cast<int>(256 - 256* (value/maxValue));\n        rectangle(showImage, Point(i,256 - 1), Point((i+1)-1, intensity), Scalar(255));\n    }\n    return showImage;\n}\n\nint main()\n{\n    Mat src= imread(\"original.jpeg\");// 读取图片\n    Mat gray,equa;\n    Mat grayHistogram,equaHistogram;\n\n    if(!src.data)             // 检查非法输入\n      {\n          cout <<  \"无法读取照片\" << endl ;\n          return -1;\n      }\n\n    namedWindow(\"RGB\",WINDOW_AUTOSIZE);   // 创建图片显示自动调整大小的窗口\n    imshow(\"RGB\",src);    // 在窗口显示原始图片\n    \n    cvtColor(src, gray, COLOR_BGR2GRAY);\n    namedWindow(\"GRAY\",WINDOW_AUTOSIZE);\n    imshow(\"GRAY\",gray);    // 在窗口显示灰度图片\n    \n    grayHistogram = getHistogramImage(gray);\n    //获得灰度图直方图\n    namedWindow(\"FirstHistogram\",WINDOW_AUTOSIZE);\n    imshow(\"FirstHistogram\",grayHistogram); // 在窗口显示灰度图直方图\n    \n    equalizeHist(gray, equa);\n    namedWindow(\"EQUA\",WINDOW_AUTOSIZE); \n    imshow(\"EQUA\",equa);    // 在窗口显示均衡化处理后图片\n    \n    imwrite(\"result.jpg\", equa); // 存储实验结果\n    \n    equaHistogram = getHistogramImage(equa);  //获得均衡化处理后直方图\n    namedWindow(\"SecondHistogram\",WINDOW_AUTOSIZE; \n imshow(\"SecondHistogram\",equaHistogram);    // 在窗口显示均衡化处理后\n    \n    waitKey(0); // 按键等待，需要在窗口任意输入字符退出，0代表永久等待\n    \n    src.release();\n    gray.release();\n    equa.release();\n    grayHistogram.release();\n    equaHistogram.release();\n    destroyWindow(\"RGB\");\n    destroyWindow(\"GRAY\");\n    destroyWindow(\"EQUA\");\n    destroyWindow(\"FirstHistogram\");\n    destroyWindow(\"SecondHistogram\");\n    return 0;\n}\n```\n\n## 实验结果\n\n![](http://image.stephenfang.me/mweb/result.png)\n第一张图片为未处理过的原图，第二张图片为灰度处理后的图片。第三张图片为均衡化处理后的灰度图，从直方图很能看出区别。\n\n## 参考\n[OpenCV官方文档](https://docs.opencv.org/master/)\n[Dongcheng Lai的知乎专栏](https://zhuanlan.zhihu.com/p/73201428)\n[opencv图像直方图的计算及绘制-Naruto_Q的博客](https://blog.csdn.net/piaoxuezhong/article/details/54588270)","slug":"OpenCV_Grayscale","published":1,"updated":"2022-07-24T15:21:31.003Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp24001qo76f3zu4h4hh","content":"<blockquote>\n<p>如果您不知道如何在 Mac 上使用 Xcode 配置 <code>OpenCV</code>，可以参考我写的上一篇博文。</p>\n</blockquote>\n<p>直方图是图像的一种统计表达，反映了图像中灰度的分布情况。以概率论为基础的，通过改变图像的直方图来改变图象中像素的灰度，以达到图像增强的目标，常称直方图修正。</p>\n<span id=\"more\"></span>\n<p><img src=\"http://image.stephenfang.me/mweb/Histogram.png\"></p>\n<p>直方图均衡化原理即借助直方图变换实现（归一的）灰度映射，实现思想为对在图像中像素个数多的灰度级进行展宽，而对像素个数少的灰度级进行缩减。从而达到清晰图像的目的。</p>\n<p>回到 <code>OpenCV</code>，<code>OpenCV</code>中提供了<code>equalizeHist</code>函数实现灰度图像直方图均衡化，给出如下函数原型及相关文档。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">cv::equalizeHist</span>\t<span class=\"params\">(\tInputArray src,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">OutputArray \tdst </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">)</span>\t</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/equa.jpg\"></p>\n<p>实现的图像直方图均衡化算法就是把直方图的每个灰度级进行归一化处理，求各个灰度的累积分布并得到一个映射的灰度映射表，最后根据相应的灰度值来修正原图中的每个像素的像素值。</p>\n<p><code>OpenCV</code>中提供了<code>cvtColor</code>函数实现彩色图像转为灰度图像，给出如下函数原型及相关文档。<br><img src=\"http://image.stephenfang.me/mweb/cvcolor.png\"></p>\n<p>至于直方图的绘制方法，<code>OpenCV</code>中提供了<code>calcList</code>函数计算图像直方图，尝试使用函数来实现会更符合操作流程。<br><img src=\"http://image.stephenfang.me/mweb/calcHist.jpg\"></p>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>本次实验需要完成以下任务：</p>\n<ol>\n<li>完成直方图的绘制</li>\n<li>使 RGB 图像变为灰度图像</li>\n<li>完成图像直方图均衡化<br>给出如下代码：</li>\n</ol>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> cv;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\">MatND <span class=\"title\">getHistogram</span><span class=\"params\">(Mat &amp;image)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    MatND hist;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> channels[] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> dims = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> histSize[] = &#123;<span class=\"number\">256</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">float</span> granges[] = &#123;<span class=\"number\">0</span>, <span class=\"number\">255</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">float</span> *ranges[] = &#123;granges&#125;;</span><br><span class=\"line\">    <span class=\"built_in\">calcHist</span>(&amp;image, <span class=\"number\">1</span>, channels, <span class=\"built_in\">Mat</span>(), hist, dims, histSize, ranges);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hist;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> <span class=\"comment\">//  将图像直方图展示出来</span></span><br><span class=\"line\"> <span class=\"function\">Mat <span class=\"title\">getHistogramImage</span><span class=\"params\">(Mat &amp;image)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    MatND hist = <span class=\"built_in\">getHistogram</span>(image);</span><br><span class=\"line\">    <span class=\"function\">Mat <span class=\"title\">showImage</span><span class=\"params\">(<span class=\"number\">256</span>,<span class=\"number\">256</span>, CV_8U,Scalar(<span class=\"number\">0</span>))</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> maxValue = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">minMaxLoc</span>(hist, <span class=\"number\">0</span>, &amp;maxValue, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">256</span>; i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">float</span> value = hist.at&lt;<span class=\"keyword\">float</span>&gt;(i);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> intensity = saturate_cast&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">256</span> - <span class=\"number\">256</span>* (value/maxValue));</span><br><span class=\"line\">        <span class=\"built_in\">rectangle</span>(showImage, <span class=\"built_in\">Point</span>(i,<span class=\"number\">256</span> - <span class=\"number\">1</span>), <span class=\"built_in\">Point</span>((i+<span class=\"number\">1</span>)<span class=\"number\">-1</span>, intensity), <span class=\"built_in\">Scalar</span>(<span class=\"number\">255</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> showImage;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Mat src= <span class=\"built_in\">imread</span>(<span class=\"string\">&quot;original.jpeg&quot;</span>);<span class=\"comment\">// 读取图片</span></span><br><span class=\"line\">    Mat gray,equa;</span><br><span class=\"line\">    Mat grayHistogram,equaHistogram;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!src.data)             <span class=\"comment\">// 检查非法输入</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          cout &lt;&lt;  <span class=\"string\">&quot;无法读取照片&quot;</span> &lt;&lt; endl ;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;RGB&quot;</span>,WINDOW_AUTOSIZE);   <span class=\"comment\">// 创建图片显示自动调整大小的窗口</span></span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;RGB&quot;</span>,src);    <span class=\"comment\">// 在窗口显示原始图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">cvtColor</span>(src, gray, COLOR_BGR2GRAY);</span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;GRAY&quot;</span>,WINDOW_AUTOSIZE);</span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;GRAY&quot;</span>,gray);    <span class=\"comment\">// 在窗口显示灰度图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    grayHistogram = <span class=\"built_in\">getHistogramImage</span>(gray);</span><br><span class=\"line\">    <span class=\"comment\">//获得灰度图直方图</span></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;FirstHistogram&quot;</span>,WINDOW_AUTOSIZE);</span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;FirstHistogram&quot;</span>,grayHistogram); <span class=\"comment\">// 在窗口显示灰度图直方图</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">equalizeHist</span>(gray, equa);</span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;EQUA&quot;</span>,WINDOW_AUTOSIZE); </span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;EQUA&quot;</span>,equa);    <span class=\"comment\">// 在窗口显示均衡化处理后图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">imwrite</span>(<span class=\"string\">&quot;result.jpg&quot;</span>, equa); <span class=\"comment\">// 存储实验结果</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    equaHistogram = <span class=\"built_in\">getHistogramImage</span>(equa);  <span class=\"comment\">//获得均衡化处理后直方图</span></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;SecondHistogram&quot;</span>,WINDOW_AUTOSIZE; </span><br><span class=\"line\"> <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;SecondHistogram&quot;</span>,equaHistogram);    <span class=\"comment\">// 在窗口显示均衡化处理后</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">waitKey</span>(<span class=\"number\">0</span>); <span class=\"comment\">// 按键等待，需要在窗口任意输入字符退出，0代表永久等待</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    src.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    gray.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    equa.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    grayHistogram.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    equaHistogram.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;RGB&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;GRAY&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;EQUA&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;FirstHistogram&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;SecondHistogram&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实验结果\"><a href=\"#实验结果\" class=\"headerlink\" title=\"实验结果\"></a>实验结果</h2><p><img src=\"http://image.stephenfang.me/mweb/result.png\"><br>第一张图片为未处理过的原图，第二张图片为灰度处理后的图片。第三张图片为均衡化处理后的灰度图，从直方图很能看出区别。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://docs.opencv.org/master/\">OpenCV官方文档</a><br><a href=\"https://zhuanlan.zhihu.com/p/73201428\">Dongcheng Lai的知乎专栏</a><br><a href=\"https://blog.csdn.net/piaoxuezhong/article/details/54588270\">opencv图像直方图的计算及绘制-Naruto_Q的博客</a></p>\n","site":{"data":{}},"excerpt":"<blockquote>\n<p>如果您不知道如何在 Mac 上使用 Xcode 配置 <code>OpenCV</code>，可以参考我写的上一篇博文。</p>\n</blockquote>\n<p>直方图是图像的一种统计表达，反映了图像中灰度的分布情况。以概率论为基础的，通过改变图像的直方图来改变图象中像素的灰度，以达到图像增强的目标，常称直方图修正。</p>","more":"<p><img src=\"http://image.stephenfang.me/mweb/Histogram.png\"></p>\n<p>直方图均衡化原理即借助直方图变换实现（归一的）灰度映射，实现思想为对在图像中像素个数多的灰度级进行展宽，而对像素个数少的灰度级进行缩减。从而达到清晰图像的目的。</p>\n<p>回到 <code>OpenCV</code>，<code>OpenCV</code>中提供了<code>equalizeHist</code>函数实现灰度图像直方图均衡化，给出如下函数原型及相关文档。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">cv::equalizeHist</span>\t<span class=\"params\">(\tInputArray src,</span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">OutputArray \tdst </span></span></span><br><span class=\"line\"><span class=\"params\"><span class=\"function\">)</span>\t</span></span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/equa.jpg\"></p>\n<p>实现的图像直方图均衡化算法就是把直方图的每个灰度级进行归一化处理，求各个灰度的累积分布并得到一个映射的灰度映射表，最后根据相应的灰度值来修正原图中的每个像素的像素值。</p>\n<p><code>OpenCV</code>中提供了<code>cvtColor</code>函数实现彩色图像转为灰度图像，给出如下函数原型及相关文档。<br><img src=\"http://image.stephenfang.me/mweb/cvcolor.png\"></p>\n<p>至于直方图的绘制方法，<code>OpenCV</code>中提供了<code>calcList</code>函数计算图像直方图，尝试使用函数来实现会更符合操作流程。<br><img src=\"http://image.stephenfang.me/mweb/calcHist.jpg\"></p>\n<h2 id=\"说明\"><a href=\"#说明\" class=\"headerlink\" title=\"说明\"></a>说明</h2><p>本次实验需要完成以下任务：</p>\n<ol>\n<li>完成直方图的绘制</li>\n<li>使 RGB 图像变为灰度图像</li>\n<li>完成图像直方图均衡化<br>给出如下代码：</li>\n</ol>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> cv;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"> <span class=\"function\">MatND <span class=\"title\">getHistogram</span><span class=\"params\">(Mat &amp;image)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    MatND hist;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> channels[] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> dims = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> histSize[] = &#123;<span class=\"number\">256</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">float</span> granges[] = &#123;<span class=\"number\">0</span>, <span class=\"number\">255</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> <span class=\"keyword\">float</span> *ranges[] = &#123;granges&#125;;</span><br><span class=\"line\">    <span class=\"built_in\">calcHist</span>(&amp;image, <span class=\"number\">1</span>, channels, <span class=\"built_in\">Mat</span>(), hist, dims, histSize, ranges);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> hist;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> <span class=\"comment\">//  将图像直方图展示出来</span></span><br><span class=\"line\"> <span class=\"function\">Mat <span class=\"title\">getHistogramImage</span><span class=\"params\">(Mat &amp;image)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    MatND hist = <span class=\"built_in\">getHistogram</span>(image);</span><br><span class=\"line\">    <span class=\"function\">Mat <span class=\"title\">showImage</span><span class=\"params\">(<span class=\"number\">256</span>,<span class=\"number\">256</span>, CV_8U,Scalar(<span class=\"number\">0</span>))</span></span>;</span><br><span class=\"line\">    <span class=\"keyword\">int</span> i;</span><br><span class=\"line\">    <span class=\"keyword\">double</span> maxValue = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"built_in\">minMaxLoc</span>(hist, <span class=\"number\">0</span>, &amp;maxValue, <span class=\"number\">0</span>, <span class=\"number\">0</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(i = <span class=\"number\">0</span>; i &lt; <span class=\"number\">256</span>; i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">float</span> value = hist.at&lt;<span class=\"keyword\">float</span>&gt;(i);</span><br><span class=\"line\">        <span class=\"keyword\">int</span> intensity = saturate_cast&lt;<span class=\"keyword\">int</span>&gt;(<span class=\"number\">256</span> - <span class=\"number\">256</span>* (value/maxValue));</span><br><span class=\"line\">        <span class=\"built_in\">rectangle</span>(showImage, <span class=\"built_in\">Point</span>(i,<span class=\"number\">256</span> - <span class=\"number\">1</span>), <span class=\"built_in\">Point</span>((i+<span class=\"number\">1</span>)<span class=\"number\">-1</span>, intensity), <span class=\"built_in\">Scalar</span>(<span class=\"number\">255</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> showImage;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Mat src= <span class=\"built_in\">imread</span>(<span class=\"string\">&quot;original.jpeg&quot;</span>);<span class=\"comment\">// 读取图片</span></span><br><span class=\"line\">    Mat gray,equa;</span><br><span class=\"line\">    Mat grayHistogram,equaHistogram;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!src.data)             <span class=\"comment\">// 检查非法输入</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          cout &lt;&lt;  <span class=\"string\">&quot;无法读取照片&quot;</span> &lt;&lt; endl ;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;RGB&quot;</span>,WINDOW_AUTOSIZE);   <span class=\"comment\">// 创建图片显示自动调整大小的窗口</span></span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;RGB&quot;</span>,src);    <span class=\"comment\">// 在窗口显示原始图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">cvtColor</span>(src, gray, COLOR_BGR2GRAY);</span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;GRAY&quot;</span>,WINDOW_AUTOSIZE);</span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;GRAY&quot;</span>,gray);    <span class=\"comment\">// 在窗口显示灰度图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    grayHistogram = <span class=\"built_in\">getHistogramImage</span>(gray);</span><br><span class=\"line\">    <span class=\"comment\">//获得灰度图直方图</span></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;FirstHistogram&quot;</span>,WINDOW_AUTOSIZE);</span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;FirstHistogram&quot;</span>,grayHistogram); <span class=\"comment\">// 在窗口显示灰度图直方图</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">equalizeHist</span>(gray, equa);</span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;EQUA&quot;</span>,WINDOW_AUTOSIZE); </span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;EQUA&quot;</span>,equa);    <span class=\"comment\">// 在窗口显示均衡化处理后图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">imwrite</span>(<span class=\"string\">&quot;result.jpg&quot;</span>, equa); <span class=\"comment\">// 存储实验结果</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    equaHistogram = <span class=\"built_in\">getHistogramImage</span>(equa);  <span class=\"comment\">//获得均衡化处理后直方图</span></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;SecondHistogram&quot;</span>,WINDOW_AUTOSIZE; </span><br><span class=\"line\"> <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;SecondHistogram&quot;</span>,equaHistogram);    <span class=\"comment\">// 在窗口显示均衡化处理后</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">waitKey</span>(<span class=\"number\">0</span>); <span class=\"comment\">// 按键等待，需要在窗口任意输入字符退出，0代表永久等待</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    src.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    gray.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    equa.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    grayHistogram.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    equaHistogram.<span class=\"built_in\">release</span>();</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;RGB&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;GRAY&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;EQUA&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;FirstHistogram&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">destroyWindow</span>(<span class=\"string\">&quot;SecondHistogram&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"实验结果\"><a href=\"#实验结果\" class=\"headerlink\" title=\"实验结果\"></a>实验结果</h2><p><img src=\"http://image.stephenfang.me/mweb/result.png\"><br>第一张图片为未处理过的原图，第二张图片为灰度处理后的图片。第三张图片为均衡化处理后的灰度图，从直方图很能看出区别。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://docs.opencv.org/master/\">OpenCV官方文档</a><br><a href=\"https://zhuanlan.zhihu.com/p/73201428\">Dongcheng Lai的知乎专栏</a><br><a href=\"https://blog.csdn.net/piaoxuezhong/article/details/54588270\">opencv图像直方图的计算及绘制-Naruto_Q的博客</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/Histogram.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:31 GMT+0800 (中国标准时间)","title":"OpenCV 图像直方图与均衡化","path":"2020/03/16/OpenCV_Grayscale/","eyeCatchImage":"http://image.stephenfang.me/mweb/Histogram.png","excerpt":"<blockquote>\n<p>如果您不知道如何在 Mac 上使用 Xcode 配置 <code>OpenCV</code>，可以参考我写的上一篇博文。</p>\n</blockquote>\n<p>直方图是图像的一种统计表达，反映了图像中灰度的分布情况。以概率论为基础的，通过改变图像的直方图来改变图象中像素的灰度，以达到图像增强的目标，常称直方图修正。</p>","date":{"_isAMomentObject":true,"_i":"2020-03-16T08:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-03-16T08:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Xcode","OpenCV","Grayscale"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":2829},{"title":"在Mac上配置OpenCV与Xcode开发环境","date":"2020-02-26T08:20:20.000Z","copyright":true,"_content":"\n下学期选了数字图像处理课程，接下来的`OpenCV`学习过程我会从零开始记录，第零课是开发环境的配置。\n\n由于笔者使用的是Mac，相较于`C++`，笔者的`Python`功底不是很扎实，所以使用Xcode与`C++`实践`OpenCV`项目。在网络上搜寻了许多关于`OpenCV`与 Xcode 开发环境的配置资料均不是很完善,于是决定自己写一篇，希望对 Mac 用户有所帮助。\n\n<!--more-->\n\n## 准备工作\n\n### 1.安装 Xcode\n\n![](http://image.stephenfang.me/mweb/Xcode.png)\n\n从 App Store 安装 Xcode。目前 Xcode（11.3）的安装后大小约为19 GB，因此可能需要近半小时的下载与安装时间，具体取决于互联网速度与设备运行速度。\n\n### 2.安装 Homebrew\n\n[Homebrew](https://brew.sh/) 是 Mac 上必备的包管理工具，诸多优点不复赘述。\n如果你还没有安装过 [Homebrew](https://brew.sh/) ，只需打开任意终端并粘贴以下代码并回车即可完成安装。\n\n```\n/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n```\n\n### 3.安装 OpenCV\n完成 Homebrew 的安装后， 即可使用`brew`命令完成`OpenCV`的安装部署。\n\n```\nbrew install opencv\n```\n\n### 4.安装 pkg-config\n\n`pkg-config`是在编译应用程序和库时使用的辅助工具，可以帮助我们找到找到正确的OpenCV 链接器符号 (Linker Flags) ，在后续的步骤中会用到。\n你需要使用如下命令完成对`pkg-config`的安装。\n\n```\nbrew install pkg-config\n```\n\n### 5.使用 pkg-config\n\n查看您的`opencv.pc`文件所在位置，一般`opencv.pc`文件所在位置为\n\n```\n/usr/local/Cellar/opencv/<版本号>/lib/pkgconfig/opencv.pc\n```\n\n如我安装的最新版本`OpenCV`的相关`opencv.pc`文件在\n```\n/usr/local/Cellar/opencv/4.2.0_1/lib/pkgconfig/opencv.pc\n```\n\n使用下面的命令查看`OpenCV`的链接器符号 (Linker Flags) ，请务必修改其中的版本信息。\n```\npkg-config --cflags --libs /usr/local/Cellar/opencv/<版本号>/lib/pkgconfig/opencv.pc\n```\n\n你会得到类似于如下的输出结果，我们需要参照输出结果在 Xcode 中进行配置。\n\n```\n-I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv -I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4 -L/usr/local/Cellar/opencv/4.2.0_1/lib -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core\n```\n\n## 配置 Xcode\n\n### 6.创建 Xcode 项目\n\n在正式运行 OpenCV C++代码之前，首先需要在 Xcode 中创建一个空的`C++`项目。具体创建过程不在这里叙述。\n\n![]( http://image.stephenfang.me/mweb/Project.png )\n\n需要注意的是项目的 *Language* 应选择为 C++。\n\n### 7.设置 Header Search Paths\n\n![]( http://image.stephenfang.me/mweb/Headers.png )\n\n在 Xcode 中设置 *Header Search Paths*，先单击 Xco​​de 项目，然后点击 *Build Settings*，然后搜索“Header Search Paths”。将 *Header Search Paths* 路径设置为刚才得到的输出结果“-I”之后的路径，如我需要对如下路径进行添加。\n\n```\n/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv \n/usr/local/Cellar/opencv/4.2.0_1/include/opencv4\n```\n\n### 8.设置 Library Search Paths\n\n![]( http://image.stephenfang.me/mweb/Library.png )\n\n类似地，在 *Build Settings* 中搜索“Library Search Paths”，将 *Library Search Paths* 路径设置为刚才得到的输出结果“-L”之后的路径，如我需要对如下路径进行添加。\n\n```\n/usr/local/Cellar/opencv/4.2.0_1/lib \n```\n\n### 9.设置 Other Linker Flags\n\n![]( http://image.stephenfang.me/mweb/linker.png )\n\n同样，在 *Build Settings* 中搜索“Other Linker Flags”，将 *Other Linker Flags* 路径设置为刚才得到的输出结果中的其他内容，即 Linker Flags，我需要对如下 Linker Flags 进行添加。（无需手动输入，只需单击输入框粘贴相关内容）\n\n```\n -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core\n```\n\n### 9.测试运行\n配置到这一步 Xcode 相关内容已经结束。可以尝试运行简单的`OpenCV`程序判断是否能够正常运行，以下给出简单的示例程序，功能仅为打开图片与退出。\n\n你需要按照后文中“使用相对路径”方法配置相对路径并添加图片`test.jpeg`到项目文件夹。\n\n```cpp\n#include<opencv2/opencv.hpp>\n#include <iostream>\n\nusing namespace cv;\nusing namespace std;\n\nint main()\n{\n    Mat image= imread(\"test.jpeg\");// 读取图片\n    if(!image.data)             // 检查非法输入\n      {\n          cout <<  \"无法读取照片\" << endl ;\n          return -1;\n      }\n\n    namedWindow(\"Display window\",WINDOW_AUTOSIZE);   // 创建图片显示自动调整大小的窗口\n    imshow(\"img\",image);    // 在窗口显示图片\n    \n    waitKey(0); // 按键等待，需要在窗口任意输入字符退出，0代表永久等待\n    return 0;\n}\n```\n\n若运行过程出现问题请检查上述步骤是否正确，后文中给出了部分问题的解决方案，可能对您有帮助。\n\n## 其他设置\n\n### 使用相对路径\n\n![]( http://image.stephenfang.me/mweb/dir.png )\n\nXcode使用图像或资源的绝对路径。为了设置相对路径需要设置*Working Directory*。依次点击 `菜单栏Product > Scheme > Edit Scheme ` 中转到*Run*中的*check Use Custom Working Directory*选项，然后自定义项目目录。\n\n## 可能出现的错误\n\n### 出现 “Not a Doxygen trailing comment” 错误\n\n![](http://image.stephenfang.me/mweb/documention.png)\n\n在 *Build Settings* 中搜索 \"Documentation Comments\"，将 *Documentation Comments* 设置为\"No\"即可解决该问题。`Doxygen` 只是一种格式可以选择跳过检查。\n\n### 出现 \"dyld: Library not loaded...\" 错误\n\n![](http://image.stephenfang.me/mweb/signature.png )\n\n在 *Signing & Capabilities* 中打开*Disable Library Validation*，即可解决该问题。问题的原因是`brew`安装的`OpenCV`存在签名问题，暂且可以先认可没有被签名的 Library。\n\n## 参考\n[Setting up OpenCV and C++ development environment in Xcode for Computer Vision projects](https://medium.com/@jaskaranvirdi/setting-up-opencv-and-c-development-environment-in-xcode-b6027728003)\n\n[Xcode in macox 10.15 beta library code signature problem](https://github.com/opencv/opencv/issues/15645#issuecomment-554495051)\n\n[Not a Doxygen trailing comment](https://stackoverflow.com/questions/39929199/not-a-doxygen-trailing-comment)\n\n[Load and Display an Image](https://docs.opencv.org/2.4/doc/tutorials/introduction/display_image/display_image.html)\ne.html)\n","source":"_posts/OpenCV_Xcode.md","raw":"---\ntitle: 在Mac上配置OpenCV与Xcode开发环境\ndate: 2020-02-26 16:20:20\ncategories: \n- 技术\ntags: \n- OpenCV\n- Xcode\n- Apple\ncopyright: true\n---\n\n下学期选了数字图像处理课程，接下来的`OpenCV`学习过程我会从零开始记录，第零课是开发环境的配置。\n\n由于笔者使用的是Mac，相较于`C++`，笔者的`Python`功底不是很扎实，所以使用Xcode与`C++`实践`OpenCV`项目。在网络上搜寻了许多关于`OpenCV`与 Xcode 开发环境的配置资料均不是很完善,于是决定自己写一篇，希望对 Mac 用户有所帮助。\n\n<!--more-->\n\n## 准备工作\n\n### 1.安装 Xcode\n\n![](http://image.stephenfang.me/mweb/Xcode.png)\n\n从 App Store 安装 Xcode。目前 Xcode（11.3）的安装后大小约为19 GB，因此可能需要近半小时的下载与安装时间，具体取决于互联网速度与设备运行速度。\n\n### 2.安装 Homebrew\n\n[Homebrew](https://brew.sh/) 是 Mac 上必备的包管理工具，诸多优点不复赘述。\n如果你还没有安装过 [Homebrew](https://brew.sh/) ，只需打开任意终端并粘贴以下代码并回车即可完成安装。\n\n```\n/usr/bin/ruby -e \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)\"\n```\n\n### 3.安装 OpenCV\n完成 Homebrew 的安装后， 即可使用`brew`命令完成`OpenCV`的安装部署。\n\n```\nbrew install opencv\n```\n\n### 4.安装 pkg-config\n\n`pkg-config`是在编译应用程序和库时使用的辅助工具，可以帮助我们找到找到正确的OpenCV 链接器符号 (Linker Flags) ，在后续的步骤中会用到。\n你需要使用如下命令完成对`pkg-config`的安装。\n\n```\nbrew install pkg-config\n```\n\n### 5.使用 pkg-config\n\n查看您的`opencv.pc`文件所在位置，一般`opencv.pc`文件所在位置为\n\n```\n/usr/local/Cellar/opencv/<版本号>/lib/pkgconfig/opencv.pc\n```\n\n如我安装的最新版本`OpenCV`的相关`opencv.pc`文件在\n```\n/usr/local/Cellar/opencv/4.2.0_1/lib/pkgconfig/opencv.pc\n```\n\n使用下面的命令查看`OpenCV`的链接器符号 (Linker Flags) ，请务必修改其中的版本信息。\n```\npkg-config --cflags --libs /usr/local/Cellar/opencv/<版本号>/lib/pkgconfig/opencv.pc\n```\n\n你会得到类似于如下的输出结果，我们需要参照输出结果在 Xcode 中进行配置。\n\n```\n-I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv -I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4 -L/usr/local/Cellar/opencv/4.2.0_1/lib -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core\n```\n\n## 配置 Xcode\n\n### 6.创建 Xcode 项目\n\n在正式运行 OpenCV C++代码之前，首先需要在 Xcode 中创建一个空的`C++`项目。具体创建过程不在这里叙述。\n\n![]( http://image.stephenfang.me/mweb/Project.png )\n\n需要注意的是项目的 *Language* 应选择为 C++。\n\n### 7.设置 Header Search Paths\n\n![]( http://image.stephenfang.me/mweb/Headers.png )\n\n在 Xcode 中设置 *Header Search Paths*，先单击 Xco​​de 项目，然后点击 *Build Settings*，然后搜索“Header Search Paths”。将 *Header Search Paths* 路径设置为刚才得到的输出结果“-I”之后的路径，如我需要对如下路径进行添加。\n\n```\n/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv \n/usr/local/Cellar/opencv/4.2.0_1/include/opencv4\n```\n\n### 8.设置 Library Search Paths\n\n![]( http://image.stephenfang.me/mweb/Library.png )\n\n类似地，在 *Build Settings* 中搜索“Library Search Paths”，将 *Library Search Paths* 路径设置为刚才得到的输出结果“-L”之后的路径，如我需要对如下路径进行添加。\n\n```\n/usr/local/Cellar/opencv/4.2.0_1/lib \n```\n\n### 9.设置 Other Linker Flags\n\n![]( http://image.stephenfang.me/mweb/linker.png )\n\n同样，在 *Build Settings* 中搜索“Other Linker Flags”，将 *Other Linker Flags* 路径设置为刚才得到的输出结果中的其他内容，即 Linker Flags，我需要对如下 Linker Flags 进行添加。（无需手动输入，只需单击输入框粘贴相关内容）\n\n```\n -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core\n```\n\n### 9.测试运行\n配置到这一步 Xcode 相关内容已经结束。可以尝试运行简单的`OpenCV`程序判断是否能够正常运行，以下给出简单的示例程序，功能仅为打开图片与退出。\n\n你需要按照后文中“使用相对路径”方法配置相对路径并添加图片`test.jpeg`到项目文件夹。\n\n```cpp\n#include<opencv2/opencv.hpp>\n#include <iostream>\n\nusing namespace cv;\nusing namespace std;\n\nint main()\n{\n    Mat image= imread(\"test.jpeg\");// 读取图片\n    if(!image.data)             // 检查非法输入\n      {\n          cout <<  \"无法读取照片\" << endl ;\n          return -1;\n      }\n\n    namedWindow(\"Display window\",WINDOW_AUTOSIZE);   // 创建图片显示自动调整大小的窗口\n    imshow(\"img\",image);    // 在窗口显示图片\n    \n    waitKey(0); // 按键等待，需要在窗口任意输入字符退出，0代表永久等待\n    return 0;\n}\n```\n\n若运行过程出现问题请检查上述步骤是否正确，后文中给出了部分问题的解决方案，可能对您有帮助。\n\n## 其他设置\n\n### 使用相对路径\n\n![]( http://image.stephenfang.me/mweb/dir.png )\n\nXcode使用图像或资源的绝对路径。为了设置相对路径需要设置*Working Directory*。依次点击 `菜单栏Product > Scheme > Edit Scheme ` 中转到*Run*中的*check Use Custom Working Directory*选项，然后自定义项目目录。\n\n## 可能出现的错误\n\n### 出现 “Not a Doxygen trailing comment” 错误\n\n![](http://image.stephenfang.me/mweb/documention.png)\n\n在 *Build Settings* 中搜索 \"Documentation Comments\"，将 *Documentation Comments* 设置为\"No\"即可解决该问题。`Doxygen` 只是一种格式可以选择跳过检查。\n\n### 出现 \"dyld: Library not loaded...\" 错误\n\n![](http://image.stephenfang.me/mweb/signature.png )\n\n在 *Signing & Capabilities* 中打开*Disable Library Validation*，即可解决该问题。问题的原因是`brew`安装的`OpenCV`存在签名问题，暂且可以先认可没有被签名的 Library。\n\n## 参考\n[Setting up OpenCV and C++ development environment in Xcode for Computer Vision projects](https://medium.com/@jaskaranvirdi/setting-up-opencv-and-c-development-environment-in-xcode-b6027728003)\n\n[Xcode in macox 10.15 beta library code signature problem](https://github.com/opencv/opencv/issues/15645#issuecomment-554495051)\n\n[Not a Doxygen trailing comment](https://stackoverflow.com/questions/39929199/not-a-doxygen-trailing-comment)\n\n[Load and Display an Image](https://docs.opencv.org/2.4/doc/tutorials/introduction/display_image/display_image.html)\ne.html)\n","slug":"OpenCV_Xcode","published":1,"updated":"2022-07-24T15:21:36.534Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp26001to76f73g9ey2m","content":"<p>下学期选了数字图像处理课程，接下来的<code>OpenCV</code>学习过程我会从零开始记录，第零课是开发环境的配置。</p>\n<p>由于笔者使用的是Mac，相较于<code>C++</code>，笔者的<code>Python</code>功底不是很扎实，所以使用Xcode与<code>C++</code>实践<code>OpenCV</code>项目。在网络上搜寻了许多关于<code>OpenCV</code>与 Xcode 开发环境的配置资料均不是很完善,于是决定自己写一篇，希望对 Mac 用户有所帮助。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><h3 id=\"1-安装-Xcode\"><a href=\"#1-安装-Xcode\" class=\"headerlink\" title=\"1.安装 Xcode\"></a>1.安装 Xcode</h3><p><img src=\"http://image.stephenfang.me/mweb/Xcode.png\"></p>\n<p>从 App Store 安装 Xcode。目前 Xcode（11.3）的安装后大小约为19 GB，因此可能需要近半小时的下载与安装时间，具体取决于互联网速度与设备运行速度。</p>\n<h3 id=\"2-安装-Homebrew\"><a href=\"#2-安装-Homebrew\" class=\"headerlink\" title=\"2.安装 Homebrew\"></a>2.安装 Homebrew</h3><p><a href=\"https://brew.sh/\">Homebrew</a> 是 Mac 上必备的包管理工具，诸多优点不复赘述。<br>如果你还没有安装过 <a href=\"https://brew.sh/\">Homebrew</a> ，只需打开任意终端并粘贴以下代码并回车即可完成安装。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-安装-OpenCV\"><a href=\"#3-安装-OpenCV\" class=\"headerlink\" title=\"3.安装 OpenCV\"></a>3.安装 OpenCV</h3><p>完成 Homebrew 的安装后， 即可使用<code>brew</code>命令完成<code>OpenCV</code>的安装部署。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install opencv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-安装-pkg-config\"><a href=\"#4-安装-pkg-config\" class=\"headerlink\" title=\"4.安装 pkg-config\"></a>4.安装 pkg-config</h3><p><code>pkg-config</code>是在编译应用程序和库时使用的辅助工具，可以帮助我们找到找到正确的OpenCV 链接器符号 (Linker Flags) ，在后续的步骤中会用到。<br>你需要使用如下命令完成对<code>pkg-config</code>的安装。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install pkg-config</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-使用-pkg-config\"><a href=\"#5-使用-pkg-config\" class=\"headerlink\" title=\"5.使用 pkg-config\"></a>5.使用 pkg-config</h3><p>查看您的<code>opencv.pc</code>文件所在位置，一般<code>opencv.pc</code>文件所在位置为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/&lt;版本号&gt;/lib/pkgconfig/opencv.pc</span><br></pre></td></tr></table></figure>\n\n<p>如我安装的最新版本<code>OpenCV</code>的相关<code>opencv.pc</code>文件在</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/lib/pkgconfig/opencv.pc</span><br></pre></td></tr></table></figure>\n\n<p>使用下面的命令查看<code>OpenCV</code>的链接器符号 (Linker Flags) ，请务必修改其中的版本信息。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pkg-config --cflags --libs /usr/local/Cellar/opencv/&lt;版本号&gt;/lib/pkgconfig/opencv.pc</span><br></pre></td></tr></table></figure>\n\n<p>你会得到类似于如下的输出结果，我们需要参照输出结果在 Xcode 中进行配置。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv -I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4 -L/usr/local/Cellar/opencv/4.2.0_1/lib -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置-Xcode\"><a href=\"#配置-Xcode\" class=\"headerlink\" title=\"配置 Xcode\"></a>配置 Xcode</h2><h3 id=\"6-创建-Xcode-项目\"><a href=\"#6-创建-Xcode-项目\" class=\"headerlink\" title=\"6.创建 Xcode 项目\"></a>6.创建 Xcode 项目</h3><p>在正式运行 OpenCV C++代码之前，首先需要在 Xcode 中创建一个空的<code>C++</code>项目。具体创建过程不在这里叙述。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Project.png\"></p>\n<p>需要注意的是项目的 <em>Language</em> 应选择为 C++。</p>\n<h3 id=\"7-设置-Header-Search-Paths\"><a href=\"#7-设置-Header-Search-Paths\" class=\"headerlink\" title=\"7.设置 Header Search Paths\"></a>7.设置 Header Search Paths</h3><p><img src=\"http://image.stephenfang.me/mweb/Headers.png\"></p>\n<p>在 Xcode 中设置 <em>Header Search Paths</em>，先单击 Xco​​de 项目，然后点击 <em>Build Settings</em>，然后搜索“Header Search Paths”。将 <em>Header Search Paths</em> 路径设置为刚才得到的输出结果“-I”之后的路径，如我需要对如下路径进行添加。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv </span><br><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/include/opencv4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-设置-Library-Search-Paths\"><a href=\"#8-设置-Library-Search-Paths\" class=\"headerlink\" title=\"8.设置 Library Search Paths\"></a>8.设置 Library Search Paths</h3><p><img src=\"http://image.stephenfang.me/mweb/Library.png\"></p>\n<p>类似地，在 <em>Build Settings</em> 中搜索“Library Search Paths”，将 <em>Library Search Paths</em> 路径设置为刚才得到的输出结果“-L”之后的路径，如我需要对如下路径进行添加。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/lib </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-设置-Other-Linker-Flags\"><a href=\"#9-设置-Other-Linker-Flags\" class=\"headerlink\" title=\"9.设置 Other Linker Flags\"></a>9.设置 Other Linker Flags</h3><p><img src=\"http://image.stephenfang.me/mweb/linker.png\"></p>\n<p>同样，在 <em>Build Settings</em> 中搜索“Other Linker Flags”，将 <em>Other Linker Flags</em> 路径设置为刚才得到的输出结果中的其他内容，即 Linker Flags，我需要对如下 Linker Flags 进行添加。（无需手动输入，只需单击输入框粘贴相关内容）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-测试运行\"><a href=\"#9-测试运行\" class=\"headerlink\" title=\"9.测试运行\"></a>9.测试运行</h3><p>配置到这一步 Xcode 相关内容已经结束。可以尝试运行简单的<code>OpenCV</code>程序判断是否能够正常运行，以下给出简单的示例程序，功能仅为打开图片与退出。</p>\n<p>你需要按照后文中“使用相对路径”方法配置相对路径并添加图片<code>test.jpeg</code>到项目文件夹。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> cv;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Mat image= <span class=\"built_in\">imread</span>(<span class=\"string\">&quot;test.jpeg&quot;</span>);<span class=\"comment\">// 读取图片</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!image.data)             <span class=\"comment\">// 检查非法输入</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          cout &lt;&lt;  <span class=\"string\">&quot;无法读取照片&quot;</span> &lt;&lt; endl ;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;Display window&quot;</span>,WINDOW_AUTOSIZE);   <span class=\"comment\">// 创建图片显示自动调整大小的窗口</span></span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;img&quot;</span>,image);    <span class=\"comment\">// 在窗口显示图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">waitKey</span>(<span class=\"number\">0</span>); <span class=\"comment\">// 按键等待，需要在窗口任意输入字符退出，0代表永久等待</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>若运行过程出现问题请检查上述步骤是否正确，后文中给出了部分问题的解决方案，可能对您有帮助。</p>\n<h2 id=\"其他设置\"><a href=\"#其他设置\" class=\"headerlink\" title=\"其他设置\"></a>其他设置</h2><h3 id=\"使用相对路径\"><a href=\"#使用相对路径\" class=\"headerlink\" title=\"使用相对路径\"></a>使用相对路径</h3><p><img src=\"http://image.stephenfang.me/mweb/dir.png\"></p>\n<p>Xcode使用图像或资源的绝对路径。为了设置相对路径需要设置<em>Working Directory</em>。依次点击 <code>菜单栏Product &gt; Scheme &gt; Edit Scheme </code> 中转到<em>Run</em>中的<em>check Use Custom Working Directory</em>选项，然后自定义项目目录。</p>\n<h2 id=\"可能出现的错误\"><a href=\"#可能出现的错误\" class=\"headerlink\" title=\"可能出现的错误\"></a>可能出现的错误</h2><h3 id=\"出现-“Not-a-Doxygen-trailing-comment”-错误\"><a href=\"#出现-“Not-a-Doxygen-trailing-comment”-错误\" class=\"headerlink\" title=\"出现 “Not a Doxygen trailing comment” 错误\"></a>出现 “Not a Doxygen trailing comment” 错误</h3><p><img src=\"http://image.stephenfang.me/mweb/documention.png\"></p>\n<p>在 <em>Build Settings</em> 中搜索 “Documentation Comments”，将 <em>Documentation Comments</em> 设置为”No”即可解决该问题。<code>Doxygen</code> 只是一种格式可以选择跳过检查。</p>\n<h3 id=\"出现-“dyld-Library-not-loaded…”-错误\"><a href=\"#出现-“dyld-Library-not-loaded…”-错误\" class=\"headerlink\" title=\"出现 “dyld: Library not loaded…” 错误\"></a>出现 “dyld: Library not loaded…” 错误</h3><p><img src=\"http://image.stephenfang.me/mweb/signature.png\"></p>\n<p>在 <em>Signing &amp; Capabilities</em> 中打开<em>Disable Library Validation</em>，即可解决该问题。问题的原因是<code>brew</code>安装的<code>OpenCV</code>存在签名问题，暂且可以先认可没有被签名的 Library。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://medium.com/@jaskaranvirdi/setting-up-opencv-and-c-development-environment-in-xcode-b6027728003\">Setting up OpenCV and C++ development environment in Xcode for Computer Vision projects</a></p>\n<p><a href=\"https://github.com/opencv/opencv/issues/15645#issuecomment-554495051\">Xcode in macox 10.15 beta library code signature problem</a></p>\n<p><a href=\"https://stackoverflow.com/questions/39929199/not-a-doxygen-trailing-comment\">Not a Doxygen trailing comment</a></p>\n<p><a href=\"https://docs.opencv.org/2.4/doc/tutorials/introduction/display_image/display_image.html\">Load and Display an Image</a><br>e.html)</p>\n","site":{"data":{}},"excerpt":"<p>下学期选了数字图像处理课程，接下来的<code>OpenCV</code>学习过程我会从零开始记录，第零课是开发环境的配置。</p>\n<p>由于笔者使用的是Mac，相较于<code>C++</code>，笔者的<code>Python</code>功底不是很扎实，所以使用Xcode与<code>C++</code>实践<code>OpenCV</code>项目。在网络上搜寻了许多关于<code>OpenCV</code>与 Xcode 开发环境的配置资料均不是很完善,于是决定自己写一篇，希望对 Mac 用户有所帮助。</p>","more":"<h2 id=\"准备工作\"><a href=\"#准备工作\" class=\"headerlink\" title=\"准备工作\"></a>准备工作</h2><h3 id=\"1-安装-Xcode\"><a href=\"#1-安装-Xcode\" class=\"headerlink\" title=\"1.安装 Xcode\"></a>1.安装 Xcode</h3><p><img src=\"http://image.stephenfang.me/mweb/Xcode.png\"></p>\n<p>从 App Store 安装 Xcode。目前 Xcode（11.3）的安装后大小约为19 GB，因此可能需要近半小时的下载与安装时间，具体取决于互联网速度与设备运行速度。</p>\n<h3 id=\"2-安装-Homebrew\"><a href=\"#2-安装-Homebrew\" class=\"headerlink\" title=\"2.安装 Homebrew\"></a>2.安装 Homebrew</h3><p><a href=\"https://brew.sh/\">Homebrew</a> 是 Mac 上必备的包管理工具，诸多优点不复赘述。<br>如果你还没有安装过 <a href=\"https://brew.sh/\">Homebrew</a> ，只需打开任意终端并粘贴以下代码并回车即可完成安装。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"3-安装-OpenCV\"><a href=\"#3-安装-OpenCV\" class=\"headerlink\" title=\"3.安装 OpenCV\"></a>3.安装 OpenCV</h3><p>完成 Homebrew 的安装后， 即可使用<code>brew</code>命令完成<code>OpenCV</code>的安装部署。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install opencv</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"4-安装-pkg-config\"><a href=\"#4-安装-pkg-config\" class=\"headerlink\" title=\"4.安装 pkg-config\"></a>4.安装 pkg-config</h3><p><code>pkg-config</code>是在编译应用程序和库时使用的辅助工具，可以帮助我们找到找到正确的OpenCV 链接器符号 (Linker Flags) ，在后续的步骤中会用到。<br>你需要使用如下命令完成对<code>pkg-config</code>的安装。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">brew install pkg-config</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"5-使用-pkg-config\"><a href=\"#5-使用-pkg-config\" class=\"headerlink\" title=\"5.使用 pkg-config\"></a>5.使用 pkg-config</h3><p>查看您的<code>opencv.pc</code>文件所在位置，一般<code>opencv.pc</code>文件所在位置为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/&lt;版本号&gt;/lib/pkgconfig/opencv.pc</span><br></pre></td></tr></table></figure>\n\n<p>如我安装的最新版本<code>OpenCV</code>的相关<code>opencv.pc</code>文件在</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/lib/pkgconfig/opencv.pc</span><br></pre></td></tr></table></figure>\n\n<p>使用下面的命令查看<code>OpenCV</code>的链接器符号 (Linker Flags) ，请务必修改其中的版本信息。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pkg-config --cflags --libs /usr/local/Cellar/opencv/&lt;版本号&gt;/lib/pkgconfig/opencv.pc</span><br></pre></td></tr></table></figure>\n\n<p>你会得到类似于如下的输出结果，我们需要参照输出结果在 Xcode 中进行配置。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv -I/usr/local/Cellar/opencv/4.2.0_1/include/opencv4 -L/usr/local/Cellar/opencv/4.2.0_1/lib -lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"配置-Xcode\"><a href=\"#配置-Xcode\" class=\"headerlink\" title=\"配置 Xcode\"></a>配置 Xcode</h2><h3 id=\"6-创建-Xcode-项目\"><a href=\"#6-创建-Xcode-项目\" class=\"headerlink\" title=\"6.创建 Xcode 项目\"></a>6.创建 Xcode 项目</h3><p>在正式运行 OpenCV C++代码之前，首先需要在 Xcode 中创建一个空的<code>C++</code>项目。具体创建过程不在这里叙述。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Project.png\"></p>\n<p>需要注意的是项目的 <em>Language</em> 应选择为 C++。</p>\n<h3 id=\"7-设置-Header-Search-Paths\"><a href=\"#7-设置-Header-Search-Paths\" class=\"headerlink\" title=\"7.设置 Header Search Paths\"></a>7.设置 Header Search Paths</h3><p><img src=\"http://image.stephenfang.me/mweb/Headers.png\"></p>\n<p>在 Xcode 中设置 <em>Header Search Paths</em>，先单击 Xco​​de 项目，然后点击 <em>Build Settings</em>，然后搜索“Header Search Paths”。将 <em>Header Search Paths</em> 路径设置为刚才得到的输出结果“-I”之后的路径，如我需要对如下路径进行添加。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/include/opencv4/opencv </span><br><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/include/opencv4</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"8-设置-Library-Search-Paths\"><a href=\"#8-设置-Library-Search-Paths\" class=\"headerlink\" title=\"8.设置 Library Search Paths\"></a>8.设置 Library Search Paths</h3><p><img src=\"http://image.stephenfang.me/mweb/Library.png\"></p>\n<p>类似地，在 <em>Build Settings</em> 中搜索“Library Search Paths”，将 <em>Library Search Paths</em> 路径设置为刚才得到的输出结果“-L”之后的路径，如我需要对如下路径进行添加。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/usr/local/Cellar/opencv/4.2.0_1/lib </span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-设置-Other-Linker-Flags\"><a href=\"#9-设置-Other-Linker-Flags\" class=\"headerlink\" title=\"9.设置 Other Linker Flags\"></a>9.设置 Other Linker Flags</h3><p><img src=\"http://image.stephenfang.me/mweb/linker.png\"></p>\n<p>同样，在 <em>Build Settings</em> 中搜索“Other Linker Flags”，将 <em>Other Linker Flags</em> 路径设置为刚才得到的输出结果中的其他内容，即 Linker Flags，我需要对如下 Linker Flags 进行添加。（无需手动输入，只需单击输入框粘贴相关内容）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-lopencv_gapi -lopencv_stitching -lopencv_aruco -lopencv_bgsegm -lopencv_bioinspired -lopencv_ccalib -lopencv_dnn_objdetect -lopencv_dnn_superres -lopencv_dpm -lopencv_highgui -lopencv_face -lopencv_freetype -lopencv_fuzzy -lopencv_hfs -lopencv_img_hash -lopencv_line_descriptor -lopencv_quality -lopencv_reg -lopencv_rgbd -lopencv_saliency -lopencv_sfm -lopencv_stereo -lopencv_structured_light -lopencv_phase_unwrapping -lopencv_superres -lopencv_optflow -lopencv_surface_matching -lopencv_tracking -lopencv_datasets -lopencv_text -lopencv_dnn -lopencv_plot -lopencv_videostab -lopencv_videoio -lopencv_xfeatures2d -lopencv_shape -lopencv_ml -lopencv_ximgproc -lopencv_video -lopencv_xobjdetect -lopencv_objdetect -lopencv_calib3d -lopencv_imgcodecs -lopencv_features2d -lopencv_flann -lopencv_xphoto -lopencv_photo -lopencv_imgproc -lopencv_core</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"9-测试运行\"><a href=\"#9-测试运行\" class=\"headerlink\" title=\"9.测试运行\"></a>9.测试运行</h3><p>配置到这一步 Xcode 相关内容已经结束。可以尝试运行简单的<code>OpenCV</code>程序判断是否能够正常运行，以下给出简单的示例程序，功能仅为打开图片与退出。</p>\n<p>你需要按照后文中“使用相对路径”方法配置相对路径并添加图片<code>test.jpeg</code>到项目文件夹。</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span><span class=\"meta-string\">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">include</span> <span class=\"meta-string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> cv;</span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    Mat image= <span class=\"built_in\">imread</span>(<span class=\"string\">&quot;test.jpeg&quot;</span>);<span class=\"comment\">// 读取图片</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!image.data)             <span class=\"comment\">// 检查非法输入</span></span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">          cout &lt;&lt;  <span class=\"string\">&quot;无法读取照片&quot;</span> &lt;&lt; endl ;</span><br><span class=\"line\">          <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">namedWindow</span>(<span class=\"string\">&quot;Display window&quot;</span>,WINDOW_AUTOSIZE);   <span class=\"comment\">// 创建图片显示自动调整大小的窗口</span></span><br><span class=\"line\">    <span class=\"built_in\">imshow</span>(<span class=\"string\">&quot;img&quot;</span>,image);    <span class=\"comment\">// 在窗口显示图片</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"built_in\">waitKey</span>(<span class=\"number\">0</span>); <span class=\"comment\">// 按键等待，需要在窗口任意输入字符退出，0代表永久等待</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>若运行过程出现问题请检查上述步骤是否正确，后文中给出了部分问题的解决方案，可能对您有帮助。</p>\n<h2 id=\"其他设置\"><a href=\"#其他设置\" class=\"headerlink\" title=\"其他设置\"></a>其他设置</h2><h3 id=\"使用相对路径\"><a href=\"#使用相对路径\" class=\"headerlink\" title=\"使用相对路径\"></a>使用相对路径</h3><p><img src=\"http://image.stephenfang.me/mweb/dir.png\"></p>\n<p>Xcode使用图像或资源的绝对路径。为了设置相对路径需要设置<em>Working Directory</em>。依次点击 <code>菜单栏Product &gt; Scheme &gt; Edit Scheme </code> 中转到<em>Run</em>中的<em>check Use Custom Working Directory</em>选项，然后自定义项目目录。</p>\n<h2 id=\"可能出现的错误\"><a href=\"#可能出现的错误\" class=\"headerlink\" title=\"可能出现的错误\"></a>可能出现的错误</h2><h3 id=\"出现-“Not-a-Doxygen-trailing-comment”-错误\"><a href=\"#出现-“Not-a-Doxygen-trailing-comment”-错误\" class=\"headerlink\" title=\"出现 “Not a Doxygen trailing comment” 错误\"></a>出现 “Not a Doxygen trailing comment” 错误</h3><p><img src=\"http://image.stephenfang.me/mweb/documention.png\"></p>\n<p>在 <em>Build Settings</em> 中搜索 “Documentation Comments”，将 <em>Documentation Comments</em> 设置为”No”即可解决该问题。<code>Doxygen</code> 只是一种格式可以选择跳过检查。</p>\n<h3 id=\"出现-“dyld-Library-not-loaded…”-错误\"><a href=\"#出现-“dyld-Library-not-loaded…”-错误\" class=\"headerlink\" title=\"出现 “dyld: Library not loaded…” 错误\"></a>出现 “dyld: Library not loaded…” 错误</h3><p><img src=\"http://image.stephenfang.me/mweb/signature.png\"></p>\n<p>在 <em>Signing &amp; Capabilities</em> 中打开<em>Disable Library Validation</em>，即可解决该问题。问题的原因是<code>brew</code>安装的<code>OpenCV</code>存在签名问题，暂且可以先认可没有被签名的 Library。</p>\n<h2 id=\"参考\"><a href=\"#参考\" class=\"headerlink\" title=\"参考\"></a>参考</h2><p><a href=\"https://medium.com/@jaskaranvirdi/setting-up-opencv-and-c-development-environment-in-xcode-b6027728003\">Setting up OpenCV and C++ development environment in Xcode for Computer Vision projects</a></p>\n<p><a href=\"https://github.com/opencv/opencv/issues/15645#issuecomment-554495051\">Xcode in macox 10.15 beta library code signature problem</a></p>\n<p><a href=\"https://stackoverflow.com/questions/39929199/not-a-doxygen-trailing-comment\">Not a Doxygen trailing comment</a></p>\n<p><a href=\"https://docs.opencv.org/2.4/doc/tutorials/introduction/display_image/display_image.html\">Load and Display an Image</a><br>e.html)</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/Xcode.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:36 GMT+0800 (中国标准时间)","title":"在Mac上配置OpenCV与Xcode开发环境","path":"2020/02/26/OpenCV_Xcode/","eyeCatchImage":"http://image.stephenfang.me/mweb/Xcode.png","excerpt":"<p>下学期选了数字图像处理课程，接下来的<code>OpenCV</code>学习过程我会从零开始记录，第零课是开发环境的配置。</p>\n<p>由于笔者使用的是Mac，相较于<code>C++</code>，笔者的<code>Python</code>功底不是很扎实，所以使用Xcode与<code>C++</code>实践<code>OpenCV</code>项目。在网络上搜寻了许多关于<code>OpenCV</code>与 Xcode 开发环境的配置资料均不是很完善,于是决定自己写一篇，希望对 Mac 用户有所帮助。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-26T08:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-26T08:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["Apple","Xcode","OpenCV"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":4658},{"title":"软件设计模式 - 单例模式","date":"2020-06-07T05:23:20.000Z","copyright":true,"_content":"\n单例模式(Singleton Pattern)，也叫单子模式，属于创建型模式的一种。单例模式重点解决几个不同的客户对象需要引用同个对象，且这种类型的对象数目不止一个的问题。通过确保一个类只能有一个实例，提供对该实例的全局访问，使得客户对象无需操心是否存在单例类的实例，实例化由单例类自己控制。\n\n<!--more-->\n\n## 模式简介\n某些时候整个系统只需要拥有一个全局对象，却有利于协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息，这种方式简化了在复杂环境下的配置管理。 \n单例类存在多种实现方式，较为普遍的实现方式为饿汉式单例类与懒汉式单例类。其中饿汉式单例类在被加载时就将自己实例化。单从资源利用效率角度来讲，饿汉式单例类比懒汉式单例类稍差些。从速度和反应时间角度来讲，饿汉式单例类则比懒汉式单例类稍好些。懒汉式单例类在实例化时，必须处理好在多个线程同时首次引用此类时的访问限制问题，特别是当单例类作为资源控制器，在实例化时必然涉及资源初始化，而资源初始化很有可能耗费大量时间，这意味着出现多线程同时首次引用此类的机率变得较大，需要通过同步化机制进行控制。具体的单例模式实现方式会在后文重点讨论。\n单例模式的优点在于可以严格控制客户怎样以及何时访问它，为设计及开发团队提供了共享的概念。同时由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象，单例模式无疑可以提高系统的性能。然而，由于单例模式中没有抽象层，因此单例类的扩展有很大的困难。单例类的职责过重，在一定程度上违背了“单一职责原则”。至于单例模式相关的设计原则会在后文中逐一列举。\n单例模式应用十分广泛，如需创建一个对象需要耗费大量时间与空间资源时，如IO，数据库连接等，再如需要生成唯一id、静态类型的的工具类等情形也需要使用单例模式。\n\n## 设计原则\n与单例设计模式相关的有以下OOP设计原则。\n- 迪米特原则\n迪米特法则（Law of Demeter），一个类对于其他类知道的越少越好，就是说一个对象应当对其他对象有尽可能少的了解,只和朋友通信，不和陌生人说话。\n在单例模式中表现为其他类对该单例类了解的尽量少。其他类获取该单例类的对象只需要通过其暴露的方法即可，而不需要了解单例具体是怎么创建的。假如该单例类创建的过程变得更加复杂，其他类的调用还是通过这个简单的方法获得对象，不用关心单例类增加了哪些代码。\n- 单一职责原则\n单一职责模式的定义为，就一个类而言，应该仅有一个引起它变化的原因。单例类的职责过重，既充当了工厂角色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的本身的功能融合到一起，在一定程度上违背了单一职责原则。违背单一职责原则带来的弊端不限于复用能力越弱、多个职责，一个职责的变化可能会影响到其他的职责等。\n在使用具体的设计模式前应该思考与之相关的设计原则，进而确定该设计模式是否符合需要，以单例模式为例，单例类没有接口，不能继承，与单一职责原则冲突，仅适用于只关心内部逻辑而不关心外面如何实例化的情形。\n\n## 实现方法\n单例模式的实现需以下三个部分：\n- 一个引用单例对象的静态私有成员变量\n- 一个公共静态方法，负责实现一次性的实例化并返回对单例对象的引用\n- 设置为保护型或私有型的构造方法\n根据单例模式的成员可以画出相应的类图，其中包含引用单例对象的静态私有成员变量instance；公共静态方法getInstance()负责实现一次性的实例化并返回对单例对象的引用；设置私有型的构造方法Singleton()。\n\n![](http://image.stephenfang.me/mweb/15917501563785.jpg)\n图3.1 单例模式的类图\n\n在所有常见的设计模式中，singleton模式是唯一一个能够用短短几十行代码完成实现的模式，接下来以不同的例子探讨单例模式的解法。\n\n1. 只适用于单线程模式的解法（懒汉式）\n由于单例模式要求只能生成一个实例，因此我们必须把构造函数设为私有函数以禁止他人创建实例。可以通过定义一个静态的实例，在需要的时候创建该实例。下面定义类型Singleton1就是基于这个思路的实现：\n\n```java\npackage com.singleton;\n\npublic class Singleton1 {\n    private Singleton1() {\n    }\n\n    private static Singleton1 instance = null;\n\n    public static Singleton1 getInstance() {\n        if (instance == null) {\n            instance = new Singleton1();\n        }\n        return instance;\n    }\n}\n```\n\n代码3.1 只适用于单线程模式的解法\n\t上述代码只有在instance为null时才创建一个实例从而避免重复创建，同时我们把构造函数定义为私有函数从而确保只创建一个实例。该代码仔单线程的时候工作正常，但是在多线程的情况下就会出现问题。设想如果两个线程同时运行到判断instance是否为null的if语句，并且instance的确没有创建时，那么两个线程都会创建一个实例，此时类型Singleton1就不再满足单例模式的要求，可以通过以下解法改变该局面。\n\n2. 适用于多线程的解法（效率欠佳的懒汉式）\n为了保证在多线程环境下还是只能得到类型的一个实例，需要加上一个同步锁。假设有两个线程同时想创建一个实例。由于在一个时刻只有一个线程能得到同步锁，当第一个线程加上锁时，第二个线程只能等待。当第一个线程发现实例还没有创建时，它创建出一个实例。接着第一个线程释放同步锁，此时第二个线程可以加上同步锁，并运行接下来的代码。这个时候由于实例已经被第一个线程创建出来了，第二个线程就不会重复创建实例了，这样就保证了在多线程环境中也只能得到一个实例。把Singleton1稍做修改得到了如下代码：\n\n```java\npackage com.singleton;\n\npublic class Singleton2 {\n    private Singleton2() {\n    }\n\n    private static Singleton2 instance = null;\n\n    public static synchronized Singleton2 getInstance() {\n        if (instance == null) {\n            instance = new Singleton2();\n        }\n        return instance;\n    }\n}\n```\n\n代码3.2 适用于多线程的低效率解法\n\t但是 Singleton2 还不是很完美。我们每次通过 getInstance 方法得到Singleton2的实例，都会试图加上一个同步锁，而加锁是一个非常耗时的操作，在没有必要的时候应该尽量避免。\n\t\n\t\n3.\t加同步锁前后两次判断实例是否已存在的解法（DCL）\n在实例还没有创建之前需要加锁操作，以保证只有一个线程创建出实例。然而当实例已经完成创建之后，已经不需要再做加锁操作了。Singleton3中只有当instance为null即没有创建时，需要加锁操作。当instance 已经创建出来之后，则无须加锁。参考以下改进后的Singleton2代码，其时间效率能够比Singleton2提升很多。其中instance被volatile 修饰，增加线程之间的可见性，并且任何线程对它的写操作都会立即刷新到主内存中，并且会强制让缓存了instance变量的线程中的数据清空，必须从主内存重新读取最新数据。\n\n```java \npackage com.singleton;\n\npublic class Singleton3 {\n    private volatile static Singleton3 instance;\n\n    private Singleton3() {\n    }\n\n    public static Singleton3 getInstance() {\n        if (instance == null) {\n            synchronized (Singleton3.class) {\n                if (instance == null) {\n                    instance = new Singleton3();\n                }\n            }\n        }\n        return instance;\n    }\n}\n\n```\n\n代码3.3 加同步锁前后两次判断实例是否已存在的解法\nSingleton3用加锁机制来确保在多线程环境下只创建一个实例，并且用两个 if 判断来提高效率。这样的代码实现起来比较复杂，容易出错，然而还有其他解法。\n\n4.\t利用静态构造函数的解法（饿汉式）\n静态构造函数的实现代码非常简洁。因为单例对象只创建一次，所以考虑使用 static 修饰，这样在 JVM 加载该类的时候就会自动创建对象，又因为不希望其他类执行该单例类的构造方法再去创建单例对象，所以把构造函数的属性设置为 private。效果为在调用静态构造函数时初始化静态变量，确保只调用一次静态构造函数，从而保证只初始化一次instance。\n\n```java\npackage com.singleton;\n\npublic class Singleton4 {\n    private Singleton4() {\n    }\n\n    private static final Singleton4 instance = new Singleton4();\n\n    public static Singleton4 getInstance() {\n        return instance;\n    }\n}\n```\n\n代码3.4 利用静态构造函数的解法\n假设我们在Singleton4 中添加一个静态方法，调用该静态函数是不需要创建一个实例的，但如果按照Singleton4的方式实现单例模式，则仍然会过早地创建实例，从而降低内存的使用效率。\n\n5.\t利用静态内部类的解法\n静态内部类的优点为，外部类加载时不需要立即加载内部类，内部类不被加载则不去初始化instance，即不会在内存中占据位置。如下巧妙运用了这种方法，即第一次调用getInstance() 方法使得JVM加载SingletonStatic类，从某种程度上而言实现了按需创建实例。\n\n```java\npackage com.singleton;\n\npublic class Singleton5 {\n    private Singleton5() {\n    }\n\n    private static class SingletonStatic {\n        private static Singleton5 instance = new Singleton5();\n    }\n\n    public static Singleton5 getInstance() {\n        return SingletonStatic.instance;\n    }\n}\n```\n\n代码3.5 利用静态内部类的解法\n当Singleton5类第一次被加载时，并不需要立即加载SingletonStatic内部类，只有当 getInstance() 方法第一次被调用时，才会初始化instance对象。这种方法不仅能确保线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。\n\n6.\t利用枚举的解法\n引用 《Effective Java》书中的一句话，“单元素的枚举类型已经成为实现Singleton的最佳方法。”这种解法利用枚举的特性保证了按需加载、线程同步。\n\n```java\npackage com.singleton;\n\npublic enum Singleton6 {\n    instance;\n\n    public void testMethod() {\n    }\n}\n```\n\n代码3.6 利用枚举类型的解法\n目前该实现方式还没有被广泛采用，但它更简洁，自动支持序列化机制，绝对防止多次实例化。它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。不过，由于 JDK1.5 之后才加入 enum 特性，用这种方式写不免让人感觉生疏。\n\n\n7.\t解法总结\n以简洁明了的表格总结前文中实现的六种单例模式的解法，对于不同解法的参考指标为是否懒加载、是否容易实现、是否线程安全以及是否高效率。\n\n| 实现方法 | 解法一 | 解法二 | 解法三 | 解法四 | 解法五 | 解法六 |\n| -------- | ------ | ------ | ------ | ------ | ------ | ------ |\n| 懒加载   | 是     | 是     | 是     | 否     | 是     | 是     |\n| 易实现   | 是     | 是     | 否     | 是     | 是     | 是     |\n| 线程安全 | 否     | 是     | 是     | 是     | 是     | 是     |\n| 高效率   | 否     | 否     | 是     | 是     | 是     | 是     |\n\n表格3.1 解法总结表\n\n一般情况下不建议使用第一种和第二种懒汉解法，第三种解法补足了前两者的短板然而编写逻辑较为复杂，第四种解法虽然没有实现懒加载的效果但仍为比较通用的解法，静态内部类的解法能够实现按需加载不失为一种优秀的算法，而如果涉及到反序列化创建对象时，可以尝试使用最后一种枚举类型的算法。\n\n## 模式简例\n在JDK内部也存在对单例模式的运用。Runtime类就是十分典型的例子。\n![](http://image.stephenfang.me/mweb/15917515167469.jpg)\n\n\n图4.2  Runtime类图\n\t在每一个Java应用程序中，都有唯一的一个Runtime对象，通过这个对象应用程序可以与其运行环境发生相互作用。Runtime类提供私有的静态的Runtime对象 currentRuntime、私有的空Runtime构造方法以及一个静态工厂方法getRuntime（），通过调用getRuntime（）方法，可以获得Runtime类唯一的一个实例，并且从源代码代码中可以看出，Runtime使用了饿汉式单例模式。\n\t\n```java\npackage java.lang;\npublic class Runtime {\n    private static final Runtime currentRuntime = new Runtime();\npublic static Runtime getRuntime() {\n    return currentRuntime;\n    }\n    private Runtime() {}\n…\n}\n```\n\n代码4.3  Runtime源代码\n前文中有提及，单例模式还可以用于生成唯一id 的情形，这里以前文中的Singleton4 实现方式为例。通过创建Main主类，并且在该类的main()方法中，创建2个Singleton4对象，获取对象的hashCode。\n```java\npackage com.singleton;\n\npublic class Main {\n    public static void main(String[] args) {\n        System.out.println(\"创建单例对象1：\");\n        Singleton4 singleton1 = Singleton4.getInstance();\n        System.out.println(singleton1.hashCode());\n        System.out.println(\"创建单例对象2\");\n        Singleton4 singleton2 = Singleton4.getInstance();\n        System.out.println(singleton2.hashCode());\n    }\n}\n```\n\n代码4.5  测试类\n运行结果符合预期，测试类通过getInstance()方法获得的是同一对象，因而哈希值是一致的。此特点适用于生产唯一序列号的场景。\n![](http://image.stephenfang.me/mweb/15917516893500.jpg)\n\n图4.3  测试结果\n\t对于单例模式的应用与验证至此告一段落，显然单例模式的运用远不止于此，相关的还有Web计数器、数据库配置文件等等。\n\t\n## 问题与缺陷\n滥用单例可能带来一些负面问题，如为了节省资源将数据库连接池对象设计为单例类，可能会导致共享连接池对象的程序过多而出现连接池溢出。在Java语言中，连接池采用持久化服务的方式，滥用单例将导致连接得不到释放，内存不断上升从而溢出。\nJVM提供了自动垃圾回收的机制，并且采用根搜索算法，其基本思路为：任何“活”的对象一定能最终追溯到其存储在堆栈或静态存储区中的引用。通过一系列根（GC Roots）的引用作为起点开始搜索，经过一系列的路径，如果可以到达java堆中的对象，那么这个对象就是不可回收的。可以作为根的对象有：\n\n- 虚拟机栈（栈桢中的本地变量表）中的引用的对象。\n- 方法区中的类静态属性引用的对象。\n- 方法区中的常量引用的对象。\n- 本地方法栈中JNI的引用的对象。\n\n方法区是JVM的一块内存区域，用来存放类相关的信息。java中单例模式创建的对象被自己类中的静态属性所引用，符合第二条，因此，单例对象不会被JVM垃圾收集。虽然JVM堆中的单例对象不会被垃圾收集，但是单例类本身如果长时间不用会不会被收集呢？因为JVM对方法区也是有垃圾收集机制的。如果单例类被收集，那么堆中的对象就会失去到根的路径，必然会被垃圾收集掉。\n通过以下代码测试单例对象是否会被回收。\n\n```java\npackage com.singleton;\n\nclass Singleton {\n    private byte[] test = new byte[6*1024*1024];\n    private static Singleton singleton = new Singleton();\n    private Singleton(){}\n\n    public static Singleton getInstance(){\n        return singleton;\n    }\n}\nclass Obj {\n    private byte[] test = new byte[3*1024*1024];\n}\n\npublic class Client{\n    public static void main(String[] args) throws Exception{\n        Singleton.getInstance();\n        while(true){\n            new Obj();\n        }\n    }\n}\n```\n\n代码5.1  测试代码\n运行时JVM 的参数被设定为：\n```-verbose:gc -Xms20M -Xmx20M```\n即每次JVM进行垃圾回收时显示内存信息，JVM的内存设为固定20M。\n通过模拟J2EE容器，实例化大小为6M的单例类，然后不断的创建对象，迫使JVM进行垃圾回收，观察垃圾收集信息，如果进行垃圾收集后，内存仍然大于6M，则说明垃圾回收不会回收单例对象。\n\n![](http://image.stephenfang.me/java.png)\n\n图5.1  测试结果\n从运行结果中可以看到有6M空间没有被收集。达到GC的条件其一为该类所有的实例都已经被回收，即java堆中不存在该类的任何实例。单例的类不满足该条件，因此单例类也不会被回收。也就是说，只要单例类中的静态引用指向JVM堆中的单例对象，那么单例类和单例对象都不会被垃圾收集。所以“如果实例化的对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次利用时又将重新实例化，这将导致对象状态丢失。”这一点目前无法在实验中验证。\n至于违背了单一职责原则这一点前文已有讨论，不复引述。\n\n### 参考资料\n- 洁城浩，《设计模式-JAVA语言中的应用》，中国铁道出版社2005.1\n- （美） GoF, 《设计模式-可复用的面向对象软件的基础》，机械工业出版社，2005 \n- 何海涛，《剑指Offer》，电子工业出版社2012.1\n- （美）Alan Holub，《设计模式初学者指南》，机械工业出版社，2006\n\n","source":"_posts/Singleton_Pattern.md","raw":"---\ntitle: 软件设计模式 - 单例模式\ndate: 2020-06-07 13:23:20\ncategories: \n- 技术\ntags: \n- 设计模式\n- Java\ncopyright: true\n---\n\n单例模式(Singleton Pattern)，也叫单子模式，属于创建型模式的一种。单例模式重点解决几个不同的客户对象需要引用同个对象，且这种类型的对象数目不止一个的问题。通过确保一个类只能有一个实例，提供对该实例的全局访问，使得客户对象无需操心是否存在单例类的实例，实例化由单例类自己控制。\n\n<!--more-->\n\n## 模式简介\n某些时候整个系统只需要拥有一个全局对象，却有利于协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息，这种方式简化了在复杂环境下的配置管理。 \n单例类存在多种实现方式，较为普遍的实现方式为饿汉式单例类与懒汉式单例类。其中饿汉式单例类在被加载时就将自己实例化。单从资源利用效率角度来讲，饿汉式单例类比懒汉式单例类稍差些。从速度和反应时间角度来讲，饿汉式单例类则比懒汉式单例类稍好些。懒汉式单例类在实例化时，必须处理好在多个线程同时首次引用此类时的访问限制问题，特别是当单例类作为资源控制器，在实例化时必然涉及资源初始化，而资源初始化很有可能耗费大量时间，这意味着出现多线程同时首次引用此类的机率变得较大，需要通过同步化机制进行控制。具体的单例模式实现方式会在后文重点讨论。\n单例模式的优点在于可以严格控制客户怎样以及何时访问它，为设计及开发团队提供了共享的概念。同时由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象，单例模式无疑可以提高系统的性能。然而，由于单例模式中没有抽象层，因此单例类的扩展有很大的困难。单例类的职责过重，在一定程度上违背了“单一职责原则”。至于单例模式相关的设计原则会在后文中逐一列举。\n单例模式应用十分广泛，如需创建一个对象需要耗费大量时间与空间资源时，如IO，数据库连接等，再如需要生成唯一id、静态类型的的工具类等情形也需要使用单例模式。\n\n## 设计原则\n与单例设计模式相关的有以下OOP设计原则。\n- 迪米特原则\n迪米特法则（Law of Demeter），一个类对于其他类知道的越少越好，就是说一个对象应当对其他对象有尽可能少的了解,只和朋友通信，不和陌生人说话。\n在单例模式中表现为其他类对该单例类了解的尽量少。其他类获取该单例类的对象只需要通过其暴露的方法即可，而不需要了解单例具体是怎么创建的。假如该单例类创建的过程变得更加复杂，其他类的调用还是通过这个简单的方法获得对象，不用关心单例类增加了哪些代码。\n- 单一职责原则\n单一职责模式的定义为，就一个类而言，应该仅有一个引起它变化的原因。单例类的职责过重，既充当了工厂角色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的本身的功能融合到一起，在一定程度上违背了单一职责原则。违背单一职责原则带来的弊端不限于复用能力越弱、多个职责，一个职责的变化可能会影响到其他的职责等。\n在使用具体的设计模式前应该思考与之相关的设计原则，进而确定该设计模式是否符合需要，以单例模式为例，单例类没有接口，不能继承，与单一职责原则冲突，仅适用于只关心内部逻辑而不关心外面如何实例化的情形。\n\n## 实现方法\n单例模式的实现需以下三个部分：\n- 一个引用单例对象的静态私有成员变量\n- 一个公共静态方法，负责实现一次性的实例化并返回对单例对象的引用\n- 设置为保护型或私有型的构造方法\n根据单例模式的成员可以画出相应的类图，其中包含引用单例对象的静态私有成员变量instance；公共静态方法getInstance()负责实现一次性的实例化并返回对单例对象的引用；设置私有型的构造方法Singleton()。\n\n![](http://image.stephenfang.me/mweb/15917501563785.jpg)\n图3.1 单例模式的类图\n\n在所有常见的设计模式中，singleton模式是唯一一个能够用短短几十行代码完成实现的模式，接下来以不同的例子探讨单例模式的解法。\n\n1. 只适用于单线程模式的解法（懒汉式）\n由于单例模式要求只能生成一个实例，因此我们必须把构造函数设为私有函数以禁止他人创建实例。可以通过定义一个静态的实例，在需要的时候创建该实例。下面定义类型Singleton1就是基于这个思路的实现：\n\n```java\npackage com.singleton;\n\npublic class Singleton1 {\n    private Singleton1() {\n    }\n\n    private static Singleton1 instance = null;\n\n    public static Singleton1 getInstance() {\n        if (instance == null) {\n            instance = new Singleton1();\n        }\n        return instance;\n    }\n}\n```\n\n代码3.1 只适用于单线程模式的解法\n\t上述代码只有在instance为null时才创建一个实例从而避免重复创建，同时我们把构造函数定义为私有函数从而确保只创建一个实例。该代码仔单线程的时候工作正常，但是在多线程的情况下就会出现问题。设想如果两个线程同时运行到判断instance是否为null的if语句，并且instance的确没有创建时，那么两个线程都会创建一个实例，此时类型Singleton1就不再满足单例模式的要求，可以通过以下解法改变该局面。\n\n2. 适用于多线程的解法（效率欠佳的懒汉式）\n为了保证在多线程环境下还是只能得到类型的一个实例，需要加上一个同步锁。假设有两个线程同时想创建一个实例。由于在一个时刻只有一个线程能得到同步锁，当第一个线程加上锁时，第二个线程只能等待。当第一个线程发现实例还没有创建时，它创建出一个实例。接着第一个线程释放同步锁，此时第二个线程可以加上同步锁，并运行接下来的代码。这个时候由于实例已经被第一个线程创建出来了，第二个线程就不会重复创建实例了，这样就保证了在多线程环境中也只能得到一个实例。把Singleton1稍做修改得到了如下代码：\n\n```java\npackage com.singleton;\n\npublic class Singleton2 {\n    private Singleton2() {\n    }\n\n    private static Singleton2 instance = null;\n\n    public static synchronized Singleton2 getInstance() {\n        if (instance == null) {\n            instance = new Singleton2();\n        }\n        return instance;\n    }\n}\n```\n\n代码3.2 适用于多线程的低效率解法\n\t但是 Singleton2 还不是很完美。我们每次通过 getInstance 方法得到Singleton2的实例，都会试图加上一个同步锁，而加锁是一个非常耗时的操作，在没有必要的时候应该尽量避免。\n\t\n\t\n3.\t加同步锁前后两次判断实例是否已存在的解法（DCL）\n在实例还没有创建之前需要加锁操作，以保证只有一个线程创建出实例。然而当实例已经完成创建之后，已经不需要再做加锁操作了。Singleton3中只有当instance为null即没有创建时，需要加锁操作。当instance 已经创建出来之后，则无须加锁。参考以下改进后的Singleton2代码，其时间效率能够比Singleton2提升很多。其中instance被volatile 修饰，增加线程之间的可见性，并且任何线程对它的写操作都会立即刷新到主内存中，并且会强制让缓存了instance变量的线程中的数据清空，必须从主内存重新读取最新数据。\n\n```java \npackage com.singleton;\n\npublic class Singleton3 {\n    private volatile static Singleton3 instance;\n\n    private Singleton3() {\n    }\n\n    public static Singleton3 getInstance() {\n        if (instance == null) {\n            synchronized (Singleton3.class) {\n                if (instance == null) {\n                    instance = new Singleton3();\n                }\n            }\n        }\n        return instance;\n    }\n}\n\n```\n\n代码3.3 加同步锁前后两次判断实例是否已存在的解法\nSingleton3用加锁机制来确保在多线程环境下只创建一个实例，并且用两个 if 判断来提高效率。这样的代码实现起来比较复杂，容易出错，然而还有其他解法。\n\n4.\t利用静态构造函数的解法（饿汉式）\n静态构造函数的实现代码非常简洁。因为单例对象只创建一次，所以考虑使用 static 修饰，这样在 JVM 加载该类的时候就会自动创建对象，又因为不希望其他类执行该单例类的构造方法再去创建单例对象，所以把构造函数的属性设置为 private。效果为在调用静态构造函数时初始化静态变量，确保只调用一次静态构造函数，从而保证只初始化一次instance。\n\n```java\npackage com.singleton;\n\npublic class Singleton4 {\n    private Singleton4() {\n    }\n\n    private static final Singleton4 instance = new Singleton4();\n\n    public static Singleton4 getInstance() {\n        return instance;\n    }\n}\n```\n\n代码3.4 利用静态构造函数的解法\n假设我们在Singleton4 中添加一个静态方法，调用该静态函数是不需要创建一个实例的，但如果按照Singleton4的方式实现单例模式，则仍然会过早地创建实例，从而降低内存的使用效率。\n\n5.\t利用静态内部类的解法\n静态内部类的优点为，外部类加载时不需要立即加载内部类，内部类不被加载则不去初始化instance，即不会在内存中占据位置。如下巧妙运用了这种方法，即第一次调用getInstance() 方法使得JVM加载SingletonStatic类，从某种程度上而言实现了按需创建实例。\n\n```java\npackage com.singleton;\n\npublic class Singleton5 {\n    private Singleton5() {\n    }\n\n    private static class SingletonStatic {\n        private static Singleton5 instance = new Singleton5();\n    }\n\n    public static Singleton5 getInstance() {\n        return SingletonStatic.instance;\n    }\n}\n```\n\n代码3.5 利用静态内部类的解法\n当Singleton5类第一次被加载时，并不需要立即加载SingletonStatic内部类，只有当 getInstance() 方法第一次被调用时，才会初始化instance对象。这种方法不仅能确保线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。\n\n6.\t利用枚举的解法\n引用 《Effective Java》书中的一句话，“单元素的枚举类型已经成为实现Singleton的最佳方法。”这种解法利用枚举的特性保证了按需加载、线程同步。\n\n```java\npackage com.singleton;\n\npublic enum Singleton6 {\n    instance;\n\n    public void testMethod() {\n    }\n}\n```\n\n代码3.6 利用枚举类型的解法\n目前该实现方式还没有被广泛采用，但它更简洁，自动支持序列化机制，绝对防止多次实例化。它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。不过，由于 JDK1.5 之后才加入 enum 特性，用这种方式写不免让人感觉生疏。\n\n\n7.\t解法总结\n以简洁明了的表格总结前文中实现的六种单例模式的解法，对于不同解法的参考指标为是否懒加载、是否容易实现、是否线程安全以及是否高效率。\n\n| 实现方法 | 解法一 | 解法二 | 解法三 | 解法四 | 解法五 | 解法六 |\n| -------- | ------ | ------ | ------ | ------ | ------ | ------ |\n| 懒加载   | 是     | 是     | 是     | 否     | 是     | 是     |\n| 易实现   | 是     | 是     | 否     | 是     | 是     | 是     |\n| 线程安全 | 否     | 是     | 是     | 是     | 是     | 是     |\n| 高效率   | 否     | 否     | 是     | 是     | 是     | 是     |\n\n表格3.1 解法总结表\n\n一般情况下不建议使用第一种和第二种懒汉解法，第三种解法补足了前两者的短板然而编写逻辑较为复杂，第四种解法虽然没有实现懒加载的效果但仍为比较通用的解法，静态内部类的解法能够实现按需加载不失为一种优秀的算法，而如果涉及到反序列化创建对象时，可以尝试使用最后一种枚举类型的算法。\n\n## 模式简例\n在JDK内部也存在对单例模式的运用。Runtime类就是十分典型的例子。\n![](http://image.stephenfang.me/mweb/15917515167469.jpg)\n\n\n图4.2  Runtime类图\n\t在每一个Java应用程序中，都有唯一的一个Runtime对象，通过这个对象应用程序可以与其运行环境发生相互作用。Runtime类提供私有的静态的Runtime对象 currentRuntime、私有的空Runtime构造方法以及一个静态工厂方法getRuntime（），通过调用getRuntime（）方法，可以获得Runtime类唯一的一个实例，并且从源代码代码中可以看出，Runtime使用了饿汉式单例模式。\n\t\n```java\npackage java.lang;\npublic class Runtime {\n    private static final Runtime currentRuntime = new Runtime();\npublic static Runtime getRuntime() {\n    return currentRuntime;\n    }\n    private Runtime() {}\n…\n}\n```\n\n代码4.3  Runtime源代码\n前文中有提及，单例模式还可以用于生成唯一id 的情形，这里以前文中的Singleton4 实现方式为例。通过创建Main主类，并且在该类的main()方法中，创建2个Singleton4对象，获取对象的hashCode。\n```java\npackage com.singleton;\n\npublic class Main {\n    public static void main(String[] args) {\n        System.out.println(\"创建单例对象1：\");\n        Singleton4 singleton1 = Singleton4.getInstance();\n        System.out.println(singleton1.hashCode());\n        System.out.println(\"创建单例对象2\");\n        Singleton4 singleton2 = Singleton4.getInstance();\n        System.out.println(singleton2.hashCode());\n    }\n}\n```\n\n代码4.5  测试类\n运行结果符合预期，测试类通过getInstance()方法获得的是同一对象，因而哈希值是一致的。此特点适用于生产唯一序列号的场景。\n![](http://image.stephenfang.me/mweb/15917516893500.jpg)\n\n图4.3  测试结果\n\t对于单例模式的应用与验证至此告一段落，显然单例模式的运用远不止于此，相关的还有Web计数器、数据库配置文件等等。\n\t\n## 问题与缺陷\n滥用单例可能带来一些负面问题，如为了节省资源将数据库连接池对象设计为单例类，可能会导致共享连接池对象的程序过多而出现连接池溢出。在Java语言中，连接池采用持久化服务的方式，滥用单例将导致连接得不到释放，内存不断上升从而溢出。\nJVM提供了自动垃圾回收的机制，并且采用根搜索算法，其基本思路为：任何“活”的对象一定能最终追溯到其存储在堆栈或静态存储区中的引用。通过一系列根（GC Roots）的引用作为起点开始搜索，经过一系列的路径，如果可以到达java堆中的对象，那么这个对象就是不可回收的。可以作为根的对象有：\n\n- 虚拟机栈（栈桢中的本地变量表）中的引用的对象。\n- 方法区中的类静态属性引用的对象。\n- 方法区中的常量引用的对象。\n- 本地方法栈中JNI的引用的对象。\n\n方法区是JVM的一块内存区域，用来存放类相关的信息。java中单例模式创建的对象被自己类中的静态属性所引用，符合第二条，因此，单例对象不会被JVM垃圾收集。虽然JVM堆中的单例对象不会被垃圾收集，但是单例类本身如果长时间不用会不会被收集呢？因为JVM对方法区也是有垃圾收集机制的。如果单例类被收集，那么堆中的对象就会失去到根的路径，必然会被垃圾收集掉。\n通过以下代码测试单例对象是否会被回收。\n\n```java\npackage com.singleton;\n\nclass Singleton {\n    private byte[] test = new byte[6*1024*1024];\n    private static Singleton singleton = new Singleton();\n    private Singleton(){}\n\n    public static Singleton getInstance(){\n        return singleton;\n    }\n}\nclass Obj {\n    private byte[] test = new byte[3*1024*1024];\n}\n\npublic class Client{\n    public static void main(String[] args) throws Exception{\n        Singleton.getInstance();\n        while(true){\n            new Obj();\n        }\n    }\n}\n```\n\n代码5.1  测试代码\n运行时JVM 的参数被设定为：\n```-verbose:gc -Xms20M -Xmx20M```\n即每次JVM进行垃圾回收时显示内存信息，JVM的内存设为固定20M。\n通过模拟J2EE容器，实例化大小为6M的单例类，然后不断的创建对象，迫使JVM进行垃圾回收，观察垃圾收集信息，如果进行垃圾收集后，内存仍然大于6M，则说明垃圾回收不会回收单例对象。\n\n![](http://image.stephenfang.me/java.png)\n\n图5.1  测试结果\n从运行结果中可以看到有6M空间没有被收集。达到GC的条件其一为该类所有的实例都已经被回收，即java堆中不存在该类的任何实例。单例的类不满足该条件，因此单例类也不会被回收。也就是说，只要单例类中的静态引用指向JVM堆中的单例对象，那么单例类和单例对象都不会被垃圾收集。所以“如果实例化的对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次利用时又将重新实例化，这将导致对象状态丢失。”这一点目前无法在实验中验证。\n至于违背了单一职责原则这一点前文已有讨论，不复引述。\n\n### 参考资料\n- 洁城浩，《设计模式-JAVA语言中的应用》，中国铁道出版社2005.1\n- （美） GoF, 《设计模式-可复用的面向对象软件的基础》，机械工业出版社，2005 \n- 何海涛，《剑指Offer》，电子工业出版社2012.1\n- （美）Alan Holub，《设计模式初学者指南》，机械工业出版社，2006\n\n","slug":"Singleton_Pattern","published":1,"updated":"2022-07-24T15:21:42.188Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp28001xo76fhk85gbau","content":"<p>单例模式(Singleton Pattern)，也叫单子模式，属于创建型模式的一种。单例模式重点解决几个不同的客户对象需要引用同个对象，且这种类型的对象数目不止一个的问题。通过确保一个类只能有一个实例，提供对该实例的全局访问，使得客户对象无需操心是否存在单例类的实例，实例化由单例类自己控制。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"模式简介\"><a href=\"#模式简介\" class=\"headerlink\" title=\"模式简介\"></a>模式简介</h2><p>某些时候整个系统只需要拥有一个全局对象，却有利于协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息，这种方式简化了在复杂环境下的配置管理。<br>单例类存在多种实现方式，较为普遍的实现方式为饿汉式单例类与懒汉式单例类。其中饿汉式单例类在被加载时就将自己实例化。单从资源利用效率角度来讲，饿汉式单例类比懒汉式单例类稍差些。从速度和反应时间角度来讲，饿汉式单例类则比懒汉式单例类稍好些。懒汉式单例类在实例化时，必须处理好在多个线程同时首次引用此类时的访问限制问题，特别是当单例类作为资源控制器，在实例化时必然涉及资源初始化，而资源初始化很有可能耗费大量时间，这意味着出现多线程同时首次引用此类的机率变得较大，需要通过同步化机制进行控制。具体的单例模式实现方式会在后文重点讨论。<br>单例模式的优点在于可以严格控制客户怎样以及何时访问它，为设计及开发团队提供了共享的概念。同时由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象，单例模式无疑可以提高系统的性能。然而，由于单例模式中没有抽象层，因此单例类的扩展有很大的困难。单例类的职责过重，在一定程度上违背了“单一职责原则”。至于单例模式相关的设计原则会在后文中逐一列举。<br>单例模式应用十分广泛，如需创建一个对象需要耗费大量时间与空间资源时，如IO，数据库连接等，再如需要生成唯一id、静态类型的的工具类等情形也需要使用单例模式。</p>\n<h2 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h2><p>与单例设计模式相关的有以下OOP设计原则。</p>\n<ul>\n<li>迪米特原则<br>迪米特法则（Law of Demeter），一个类对于其他类知道的越少越好，就是说一个对象应当对其他对象有尽可能少的了解,只和朋友通信，不和陌生人说话。<br>在单例模式中表现为其他类对该单例类了解的尽量少。其他类获取该单例类的对象只需要通过其暴露的方法即可，而不需要了解单例具体是怎么创建的。假如该单例类创建的过程变得更加复杂，其他类的调用还是通过这个简单的方法获得对象，不用关心单例类增加了哪些代码。</li>\n<li>单一职责原则<br>单一职责模式的定义为，就一个类而言，应该仅有一个引起它变化的原因。单例类的职责过重，既充当了工厂角色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的本身的功能融合到一起，在一定程度上违背了单一职责原则。违背单一职责原则带来的弊端不限于复用能力越弱、多个职责，一个职责的变化可能会影响到其他的职责等。<br>在使用具体的设计模式前应该思考与之相关的设计原则，进而确定该设计模式是否符合需要，以单例模式为例，单例类没有接口，不能继承，与单一职责原则冲突，仅适用于只关心内部逻辑而不关心外面如何实例化的情形。</li>\n</ul>\n<h2 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h2><p>单例模式的实现需以下三个部分：</p>\n<ul>\n<li>一个引用单例对象的静态私有成员变量</li>\n<li>一个公共静态方法，负责实现一次性的实例化并返回对单例对象的引用</li>\n<li>设置为保护型或私有型的构造方法<br>根据单例模式的成员可以画出相应的类图，其中包含引用单例对象的静态私有成员变量instance；公共静态方法getInstance()负责实现一次性的实例化并返回对单例对象的引用；设置私有型的构造方法Singleton()。</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/15917501563785.jpg\"><br>图3.1 单例模式的类图</p>\n<p>在所有常见的设计模式中，singleton模式是唯一一个能够用短短几十行代码完成实现的模式，接下来以不同的例子探讨单例模式的解法。</p>\n<ol>\n<li>只适用于单线程模式的解法（懒汉式）<br>由于单例模式要求只能生成一个实例，因此我们必须把构造函数设为私有函数以禁止他人创建实例。可以通过定义一个静态的实例，在需要的时候创建该实例。下面定义类型Singleton1就是基于这个思路的实现：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton1</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton1 instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton1 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            instance = <span class=\"keyword\">new</span> Singleton1();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.1 只适用于单线程模式的解法<br>    上述代码只有在instance为null时才创建一个实例从而避免重复创建，同时我们把构造函数定义为私有函数从而确保只创建一个实例。该代码仔单线程的时候工作正常，但是在多线程的情况下就会出现问题。设想如果两个线程同时运行到判断instance是否为null的if语句，并且instance的确没有创建时，那么两个线程都会创建一个实例，此时类型Singleton1就不再满足单例模式的要求，可以通过以下解法改变该局面。</p>\n<ol start=\"2\">\n<li>适用于多线程的解法（效率欠佳的懒汉式）<br>为了保证在多线程环境下还是只能得到类型的一个实例，需要加上一个同步锁。假设有两个线程同时想创建一个实例。由于在一个时刻只有一个线程能得到同步锁，当第一个线程加上锁时，第二个线程只能等待。当第一个线程发现实例还没有创建时，它创建出一个实例。接着第一个线程释放同步锁，此时第二个线程可以加上同步锁，并运行接下来的代码。这个时候由于实例已经被第一个线程创建出来了，第二个线程就不会重复创建实例了，这样就保证了在多线程环境中也只能得到一个实例。把Singleton1稍做修改得到了如下代码：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton2</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton2 instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> Singleton2 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            instance = <span class=\"keyword\">new</span> Singleton2();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.2 适用于多线程的低效率解法<br>    但是 Singleton2 还不是很完美。我们每次通过 getInstance 方法得到Singleton2的实例，都会试图加上一个同步锁，而加锁是一个非常耗时的操作，在没有必要的时候应该尽量避免。</p>\n<ol start=\"3\">\n<li>   加同步锁前后两次判断实例是否已存在的解法（DCL）<br>在实例还没有创建之前需要加锁操作，以保证只有一个线程创建出实例。然而当实例已经完成创建之后，已经不需要再做加锁操作了。Singleton3中只有当instance为null即没有创建时，需要加锁操作。当instance 已经创建出来之后，则无须加锁。参考以下改进后的Singleton2代码，其时间效率能够比Singleton2提升很多。其中instance被volatile 修饰，增加线程之间的可见性，并且任何线程对它的写操作都会立即刷新到主内存中，并且会强制让缓存了instance变量的线程中的数据清空，必须从主内存重新读取最新数据。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton3</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> Singleton3 instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton3 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton3.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    instance = <span class=\"keyword\">new</span> Singleton3();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>代码3.3 加同步锁前后两次判断实例是否已存在的解法<br>Singleton3用加锁机制来确保在多线程环境下只创建一个实例，并且用两个 if 判断来提高效率。这样的代码实现起来比较复杂，容易出错，然而还有其他解法。</p>\n<ol start=\"4\">\n<li>   利用静态构造函数的解法（饿汉式）<br>静态构造函数的实现代码非常简洁。因为单例对象只创建一次，所以考虑使用 static 修饰，这样在 JVM 加载该类的时候就会自动创建对象，又因为不希望其他类执行该单例类的构造方法再去创建单例对象，所以把构造函数的属性设置为 private。效果为在调用静态构造函数时初始化静态变量，确保只调用一次静态构造函数，从而保证只初始化一次instance。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton4</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton4</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Singleton4 instance = <span class=\"keyword\">new</span> Singleton4();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton4 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.4 利用静态构造函数的解法<br>假设我们在Singleton4 中添加一个静态方法，调用该静态函数是不需要创建一个实例的，但如果按照Singleton4的方式实现单例模式，则仍然会过早地创建实例，从而降低内存的使用效率。</p>\n<ol start=\"5\">\n<li>   利用静态内部类的解法<br>静态内部类的优点为，外部类加载时不需要立即加载内部类，内部类不被加载则不去初始化instance，即不会在内存中占据位置。如下巧妙运用了这种方法，即第一次调用getInstance() 方法使得JVM加载SingletonStatic类，从某种程度上而言实现了按需创建实例。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton5</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton5</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SingletonStatic</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton5 instance = <span class=\"keyword\">new</span> Singleton5();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton5 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SingletonStatic.instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.5 利用静态内部类的解法<br>当Singleton5类第一次被加载时，并不需要立即加载SingletonStatic内部类，只有当 getInstance() 方法第一次被调用时，才会初始化instance对象。这种方法不仅能确保线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。</p>\n<ol start=\"6\">\n<li>   利用枚举的解法<br>引用 《Effective Java》书中的一句话，“单元素的枚举类型已经成为实现Singleton的最佳方法。”这种解法利用枚举的特性保证了按需加载、线程同步。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Singleton6</span> </span>&#123;</span><br><span class=\"line\">    instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.6 利用枚举类型的解法<br>目前该实现方式还没有被广泛采用，但它更简洁，自动支持序列化机制，绝对防止多次实例化。它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。不过，由于 JDK1.5 之后才加入 enum 特性，用这种方式写不免让人感觉生疏。</p>\n<ol start=\"7\">\n<li>   解法总结<br>以简洁明了的表格总结前文中实现的六种单例模式的解法，对于不同解法的参考指标为是否懒加载、是否容易实现、是否线程安全以及是否高效率。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>实现方法</th>\n<th>解法一</th>\n<th>解法二</th>\n<th>解法三</th>\n<th>解法四</th>\n<th>解法五</th>\n<th>解法六</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>懒加载</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>易实现</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>线程安全</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>高效率</td>\n<td>否</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n</tbody></table>\n<p>表格3.1 解法总结表</p>\n<p>一般情况下不建议使用第一种和第二种懒汉解法，第三种解法补足了前两者的短板然而编写逻辑较为复杂，第四种解法虽然没有实现懒加载的效果但仍为比较通用的解法，静态内部类的解法能够实现按需加载不失为一种优秀的算法，而如果涉及到反序列化创建对象时，可以尝试使用最后一种枚举类型的算法。</p>\n<h2 id=\"模式简例\"><a href=\"#模式简例\" class=\"headerlink\" title=\"模式简例\"></a>模式简例</h2><p>在JDK内部也存在对单例模式的运用。Runtime类就是十分典型的例子。<br><img src=\"http://image.stephenfang.me/mweb/15917515167469.jpg\"></p>\n<p>图4.2  Runtime类图<br>    在每一个Java应用程序中，都有唯一的一个Runtime对象，通过这个对象应用程序可以与其运行环境发生相互作用。Runtime类提供私有的静态的Runtime对象 currentRuntime、私有的空Runtime构造方法以及一个静态工厂方法getRuntime（），通过调用getRuntime（）方法，可以获得Runtime类唯一的一个实例，并且从源代码代码中可以看出，Runtime使用了饿汉式单例模式。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> java.lang;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Runtime</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Runtime currentRuntime = <span class=\"keyword\">new</span> Runtime();</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Runtime <span class=\"title\">getRuntime</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentRuntime;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Runtime</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\">…</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码4.3  Runtime源代码<br>前文中有提及，单例模式还可以用于生成唯一id 的情形，这里以前文中的Singleton4 实现方式为例。通过创建Main主类，并且在该类的main()方法中，创建2个Singleton4对象，获取对象的hashCode。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;创建单例对象1：&quot;</span>);</span><br><span class=\"line\">        Singleton4 singleton1 = Singleton4.getInstance();</span><br><span class=\"line\">        System.out.println(singleton1.hashCode());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;创建单例对象2&quot;</span>);</span><br><span class=\"line\">        Singleton4 singleton2 = Singleton4.getInstance();</span><br><span class=\"line\">        System.out.println(singleton2.hashCode());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码4.5  测试类<br>运行结果符合预期，测试类通过getInstance()方法获得的是同一对象，因而哈希值是一致的。此特点适用于生产唯一序列号的场景。<br><img src=\"http://image.stephenfang.me/mweb/15917516893500.jpg\"></p>\n<p>图4.3  测试结果<br>    对于单例模式的应用与验证至此告一段落，显然单例模式的运用远不止于此，相关的还有Web计数器、数据库配置文件等等。</p>\n<h2 id=\"问题与缺陷\"><a href=\"#问题与缺陷\" class=\"headerlink\" title=\"问题与缺陷\"></a>问题与缺陷</h2><p>滥用单例可能带来一些负面问题，如为了节省资源将数据库连接池对象设计为单例类，可能会导致共享连接池对象的程序过多而出现连接池溢出。在Java语言中，连接池采用持久化服务的方式，滥用单例将导致连接得不到释放，内存不断上升从而溢出。<br>JVM提供了自动垃圾回收的机制，并且采用根搜索算法，其基本思路为：任何“活”的对象一定能最终追溯到其存储在堆栈或静态存储区中的引用。通过一系列根（GC Roots）的引用作为起点开始搜索，经过一系列的路径，如果可以到达java堆中的对象，那么这个对象就是不可回收的。可以作为根的对象有：</p>\n<ul>\n<li>虚拟机栈（栈桢中的本地变量表）中的引用的对象。</li>\n<li>方法区中的类静态属性引用的对象。</li>\n<li>方法区中的常量引用的对象。</li>\n<li>本地方法栈中JNI的引用的对象。</li>\n</ul>\n<p>方法区是JVM的一块内存区域，用来存放类相关的信息。java中单例模式创建的对象被自己类中的静态属性所引用，符合第二条，因此，单例对象不会被JVM垃圾收集。虽然JVM堆中的单例对象不会被垃圾收集，但是单例类本身如果长时间不用会不会被收集呢？因为JVM对方法区也是有垃圾收集机制的。如果单例类被收集，那么堆中的对象就会失去到根的路径，必然会被垃圾收集掉。<br>通过以下代码测试单例对象是否会被回收。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">byte</span>[] test = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">6</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>];</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton singleton = <span class=\"keyword\">new</span> Singleton();</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton</span><span class=\"params\">()</span></span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title\">getInstance</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> singleton;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Obj</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">byte</span>[] test = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">3</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">        Singleton.getInstance();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"keyword\">true</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Obj();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码5.1  测试代码<br>运行时JVM 的参数被设定为：<br><code>-verbose:gc -Xms20M -Xmx20M</code><br>即每次JVM进行垃圾回收时显示内存信息，JVM的内存设为固定20M。<br>通过模拟J2EE容器，实例化大小为6M的单例类，然后不断的创建对象，迫使JVM进行垃圾回收，观察垃圾收集信息，如果进行垃圾收集后，内存仍然大于6M，则说明垃圾回收不会回收单例对象。</p>\n<p><img src=\"http://image.stephenfang.me/java.png\"></p>\n<p>图5.1  测试结果<br>从运行结果中可以看到有6M空间没有被收集。达到GC的条件其一为该类所有的实例都已经被回收，即java堆中不存在该类的任何实例。单例的类不满足该条件，因此单例类也不会被回收。也就是说，只要单例类中的静态引用指向JVM堆中的单例对象，那么单例类和单例对象都不会被垃圾收集。所以“如果实例化的对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次利用时又将重新实例化，这将导致对象状态丢失。”这一点目前无法在实验中验证。<br>至于违背了单一职责原则这一点前文已有讨论，不复引述。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><ul>\n<li>洁城浩，《设计模式-JAVA语言中的应用》，中国铁道出版社2005.1</li>\n<li>（美） GoF, 《设计模式-可复用的面向对象软件的基础》，机械工业出版社，2005 </li>\n<li>何海涛，《剑指Offer》，电子工业出版社2012.1</li>\n<li>（美）Alan Holub，《设计模式初学者指南》，机械工业出版社，2006</li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>单例模式(Singleton Pattern)，也叫单子模式，属于创建型模式的一种。单例模式重点解决几个不同的客户对象需要引用同个对象，且这种类型的对象数目不止一个的问题。通过确保一个类只能有一个实例，提供对该实例的全局访问，使得客户对象无需操心是否存在单例类的实例，实例化由单例类自己控制。</p>","more":"<h2 id=\"模式简介\"><a href=\"#模式简介\" class=\"headerlink\" title=\"模式简介\"></a>模式简介</h2><p>某些时候整个系统只需要拥有一个全局对象，却有利于协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务进程中的其他对象再通过这个单例对象获取这些配置信息，这种方式简化了在复杂环境下的配置管理。<br>单例类存在多种实现方式，较为普遍的实现方式为饿汉式单例类与懒汉式单例类。其中饿汉式单例类在被加载时就将自己实例化。单从资源利用效率角度来讲，饿汉式单例类比懒汉式单例类稍差些。从速度和反应时间角度来讲，饿汉式单例类则比懒汉式单例类稍好些。懒汉式单例类在实例化时，必须处理好在多个线程同时首次引用此类时的访问限制问题，特别是当单例类作为资源控制器，在实例化时必然涉及资源初始化，而资源初始化很有可能耗费大量时间，这意味着出现多线程同时首次引用此类的机率变得较大，需要通过同步化机制进行控制。具体的单例模式实现方式会在后文重点讨论。<br>单例模式的优点在于可以严格控制客户怎样以及何时访问它，为设计及开发团队提供了共享的概念。同时由于在系统内存中只存在一个对象，因此可以节约系统资源，对于一些需要频繁创建和销毁的对象，单例模式无疑可以提高系统的性能。然而，由于单例模式中没有抽象层，因此单例类的扩展有很大的困难。单例类的职责过重，在一定程度上违背了“单一职责原则”。至于单例模式相关的设计原则会在后文中逐一列举。<br>单例模式应用十分广泛，如需创建一个对象需要耗费大量时间与空间资源时，如IO，数据库连接等，再如需要生成唯一id、静态类型的的工具类等情形也需要使用单例模式。</p>\n<h2 id=\"设计原则\"><a href=\"#设计原则\" class=\"headerlink\" title=\"设计原则\"></a>设计原则</h2><p>与单例设计模式相关的有以下OOP设计原则。</p>\n<ul>\n<li>迪米特原则<br>迪米特法则（Law of Demeter），一个类对于其他类知道的越少越好，就是说一个对象应当对其他对象有尽可能少的了解,只和朋友通信，不和陌生人说话。<br>在单例模式中表现为其他类对该单例类了解的尽量少。其他类获取该单例类的对象只需要通过其暴露的方法即可，而不需要了解单例具体是怎么创建的。假如该单例类创建的过程变得更加复杂，其他类的调用还是通过这个简单的方法获得对象，不用关心单例类增加了哪些代码。</li>\n<li>单一职责原则<br>单一职责模式的定义为，就一个类而言，应该仅有一个引起它变化的原因。单例类的职责过重，既充当了工厂角色，提供了工厂方法，同时又充当了产品角色，包含一些业务方法，将产品的创建和产品的本身的功能融合到一起，在一定程度上违背了单一职责原则。违背单一职责原则带来的弊端不限于复用能力越弱、多个职责，一个职责的变化可能会影响到其他的职责等。<br>在使用具体的设计模式前应该思考与之相关的设计原则，进而确定该设计模式是否符合需要，以单例模式为例，单例类没有接口，不能继承，与单一职责原则冲突，仅适用于只关心内部逻辑而不关心外面如何实例化的情形。</li>\n</ul>\n<h2 id=\"实现方法\"><a href=\"#实现方法\" class=\"headerlink\" title=\"实现方法\"></a>实现方法</h2><p>单例模式的实现需以下三个部分：</p>\n<ul>\n<li>一个引用单例对象的静态私有成员变量</li>\n<li>一个公共静态方法，负责实现一次性的实例化并返回对单例对象的引用</li>\n<li>设置为保护型或私有型的构造方法<br>根据单例模式的成员可以画出相应的类图，其中包含引用单例对象的静态私有成员变量instance；公共静态方法getInstance()负责实现一次性的实例化并返回对单例对象的引用；设置私有型的构造方法Singleton()。</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/15917501563785.jpg\"><br>图3.1 单例模式的类图</p>\n<p>在所有常见的设计模式中，singleton模式是唯一一个能够用短短几十行代码完成实现的模式，接下来以不同的例子探讨单例模式的解法。</p>\n<ol>\n<li>只适用于单线程模式的解法（懒汉式）<br>由于单例模式要求只能生成一个实例，因此我们必须把构造函数设为私有函数以禁止他人创建实例。可以通过定义一个静态的实例，在需要的时候创建该实例。下面定义类型Singleton1就是基于这个思路的实现：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton1</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton1</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton1 instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton1 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            instance = <span class=\"keyword\">new</span> Singleton1();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.1 只适用于单线程模式的解法<br>    上述代码只有在instance为null时才创建一个实例从而避免重复创建，同时我们把构造函数定义为私有函数从而确保只创建一个实例。该代码仔单线程的时候工作正常，但是在多线程的情况下就会出现问题。设想如果两个线程同时运行到判断instance是否为null的if语句，并且instance的确没有创建时，那么两个线程都会创建一个实例，此时类型Singleton1就不再满足单例模式的要求，可以通过以下解法改变该局面。</p>\n<ol start=\"2\">\n<li>适用于多线程的解法（效率欠佳的懒汉式）<br>为了保证在多线程环境下还是只能得到类型的一个实例，需要加上一个同步锁。假设有两个线程同时想创建一个实例。由于在一个时刻只有一个线程能得到同步锁，当第一个线程加上锁时，第二个线程只能等待。当第一个线程发现实例还没有创建时，它创建出一个实例。接着第一个线程释放同步锁，此时第二个线程可以加上同步锁，并运行接下来的代码。这个时候由于实例已经被第一个线程创建出来了，第二个线程就不会重复创建实例了，这样就保证了在多线程环境中也只能得到一个实例。把Singleton1稍做修改得到了如下代码：</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton2</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton2</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton2 instance = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">synchronized</span> Singleton2 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            instance = <span class=\"keyword\">new</span> Singleton2();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.2 适用于多线程的低效率解法<br>    但是 Singleton2 还不是很完美。我们每次通过 getInstance 方法得到Singleton2的实例，都会试图加上一个同步锁，而加锁是一个非常耗时的操作，在没有必要的时候应该尽量避免。</p>\n<ol start=\"3\">\n<li>   加同步锁前后两次判断实例是否已存在的解法（DCL）<br>在实例还没有创建之前需要加锁操作，以保证只有一个线程创建出实例。然而当实例已经完成创建之后，已经不需要再做加锁操作了。Singleton3中只有当instance为null即没有创建时，需要加锁操作。当instance 已经创建出来之后，则无须加锁。参考以下改进后的Singleton2代码，其时间效率能够比Singleton2提升很多。其中instance被volatile 修饰，增加线程之间的可见性，并且任何线程对它的写操作都会立即刷新到主内存中，并且会强制让缓存了instance变量的线程中的数据清空，必须从主内存重新读取最新数据。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton3</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">volatile</span> <span class=\"keyword\">static</span> Singleton3 instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton3</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton3 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (Singleton3.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (instance == <span class=\"keyword\">null</span>) &#123;</span><br><span class=\"line\">                    instance = <span class=\"keyword\">new</span> Singleton3();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n\n<p>代码3.3 加同步锁前后两次判断实例是否已存在的解法<br>Singleton3用加锁机制来确保在多线程环境下只创建一个实例，并且用两个 if 判断来提高效率。这样的代码实现起来比较复杂，容易出错，然而还有其他解法。</p>\n<ol start=\"4\">\n<li>   利用静态构造函数的解法（饿汉式）<br>静态构造函数的实现代码非常简洁。因为单例对象只创建一次，所以考虑使用 static 修饰，这样在 JVM 加载该类的时候就会自动创建对象，又因为不希望其他类执行该单例类的构造方法再去创建单例对象，所以把构造函数的属性设置为 private。效果为在调用静态构造函数时初始化静态变量，确保只调用一次静态构造函数，从而保证只初始化一次instance。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton4</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton4</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Singleton4 instance = <span class=\"keyword\">new</span> Singleton4();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton4 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.4 利用静态构造函数的解法<br>假设我们在Singleton4 中添加一个静态方法，调用该静态函数是不需要创建一个实例的，但如果按照Singleton4的方式实现单例模式，则仍然会过早地创建实例，从而降低内存的使用效率。</p>\n<ol start=\"5\">\n<li>   利用静态内部类的解法<br>静态内部类的优点为，外部类加载时不需要立即加载内部类，内部类不被加载则不去初始化instance，即不会在内存中占据位置。如下巧妙运用了这种方法，即第一次调用getInstance() 方法使得JVM加载SingletonStatic类，从某种程度上而言实现了按需创建实例。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton5</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton5</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">SingletonStatic</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton5 instance = <span class=\"keyword\">new</span> Singleton5();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton5 <span class=\"title\">getInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> SingletonStatic.instance;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.5 利用静态内部类的解法<br>当Singleton5类第一次被加载时，并不需要立即加载SingletonStatic内部类，只有当 getInstance() 方法第一次被调用时，才会初始化instance对象。这种方法不仅能确保线程安全，也能保证单例的唯一性，同时也延迟了单例的实例化。</p>\n<ol start=\"6\">\n<li>   利用枚举的解法<br>引用 《Effective Java》书中的一句话，“单元素的枚举类型已经成为实现Singleton的最佳方法。”这种解法利用枚举的特性保证了按需加载、线程同步。</li>\n</ol>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Singleton6</span> </span>&#123;</span><br><span class=\"line\">    instance;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">testMethod</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码3.6 利用枚举类型的解法<br>目前该实现方式还没有被广泛采用，但它更简洁，自动支持序列化机制，绝对防止多次实例化。它不仅能避免多线程同步问题，而且还自动支持序列化机制，防止反序列化重新创建新的对象，绝对防止多次实例化。不过，由于 JDK1.5 之后才加入 enum 特性，用这种方式写不免让人感觉生疏。</p>\n<ol start=\"7\">\n<li>   解法总结<br>以简洁明了的表格总结前文中实现的六种单例模式的解法，对于不同解法的参考指标为是否懒加载、是否容易实现、是否线程安全以及是否高效率。</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th>实现方法</th>\n<th>解法一</th>\n<th>解法二</th>\n<th>解法三</th>\n<th>解法四</th>\n<th>解法五</th>\n<th>解法六</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>懒加载</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>易实现</td>\n<td>是</td>\n<td>是</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>线程安全</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n<tr>\n<td>高效率</td>\n<td>否</td>\n<td>否</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n<td>是</td>\n</tr>\n</tbody></table>\n<p>表格3.1 解法总结表</p>\n<p>一般情况下不建议使用第一种和第二种懒汉解法，第三种解法补足了前两者的短板然而编写逻辑较为复杂，第四种解法虽然没有实现懒加载的效果但仍为比较通用的解法，静态内部类的解法能够实现按需加载不失为一种优秀的算法，而如果涉及到反序列化创建对象时，可以尝试使用最后一种枚举类型的算法。</p>\n<h2 id=\"模式简例\"><a href=\"#模式简例\" class=\"headerlink\" title=\"模式简例\"></a>模式简例</h2><p>在JDK内部也存在对单例模式的运用。Runtime类就是十分典型的例子。<br><img src=\"http://image.stephenfang.me/mweb/15917515167469.jpg\"></p>\n<p>图4.2  Runtime类图<br>    在每一个Java应用程序中，都有唯一的一个Runtime对象，通过这个对象应用程序可以与其运行环境发生相互作用。Runtime类提供私有的静态的Runtime对象 currentRuntime、私有的空Runtime构造方法以及一个静态工厂方法getRuntime（），通过调用getRuntime（）方法，可以获得Runtime类唯一的一个实例，并且从源代码代码中可以看出，Runtime使用了饿汉式单例模式。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> java.lang;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Runtime</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> Runtime currentRuntime = <span class=\"keyword\">new</span> Runtime();</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Runtime <span class=\"title\">getRuntime</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> currentRuntime;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Runtime</span><span class=\"params\">()</span> </span>&#123;&#125;</span><br><span class=\"line\">…</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码4.3  Runtime源代码<br>前文中有提及，单例模式还可以用于生成唯一id 的情形，这里以前文中的Singleton4 实现方式为例。通过创建Main主类，并且在该类的main()方法中，创建2个Singleton4对象，获取对象的hashCode。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Main</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;创建单例对象1：&quot;</span>);</span><br><span class=\"line\">        Singleton4 singleton1 = Singleton4.getInstance();</span><br><span class=\"line\">        System.out.println(singleton1.hashCode());</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;创建单例对象2&quot;</span>);</span><br><span class=\"line\">        Singleton4 singleton2 = Singleton4.getInstance();</span><br><span class=\"line\">        System.out.println(singleton2.hashCode());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码4.5  测试类<br>运行结果符合预期，测试类通过getInstance()方法获得的是同一对象，因而哈希值是一致的。此特点适用于生产唯一序列号的场景。<br><img src=\"http://image.stephenfang.me/mweb/15917516893500.jpg\"></p>\n<p>图4.3  测试结果<br>    对于单例模式的应用与验证至此告一段落，显然单例模式的运用远不止于此，相关的还有Web计数器、数据库配置文件等等。</p>\n<h2 id=\"问题与缺陷\"><a href=\"#问题与缺陷\" class=\"headerlink\" title=\"问题与缺陷\"></a>问题与缺陷</h2><p>滥用单例可能带来一些负面问题，如为了节省资源将数据库连接池对象设计为单例类，可能会导致共享连接池对象的程序过多而出现连接池溢出。在Java语言中，连接池采用持久化服务的方式，滥用单例将导致连接得不到释放，内存不断上升从而溢出。<br>JVM提供了自动垃圾回收的机制，并且采用根搜索算法，其基本思路为：任何“活”的对象一定能最终追溯到其存储在堆栈或静态存储区中的引用。通过一系列根（GC Roots）的引用作为起点开始搜索，经过一系列的路径，如果可以到达java堆中的对象，那么这个对象就是不可回收的。可以作为根的对象有：</p>\n<ul>\n<li>虚拟机栈（栈桢中的本地变量表）中的引用的对象。</li>\n<li>方法区中的类静态属性引用的对象。</li>\n<li>方法区中的常量引用的对象。</li>\n<li>本地方法栈中JNI的引用的对象。</li>\n</ul>\n<p>方法区是JVM的一块内存区域，用来存放类相关的信息。java中单例模式创建的对象被自己类中的静态属性所引用，符合第二条，因此，单例对象不会被JVM垃圾收集。虽然JVM堆中的单例对象不会被垃圾收集，但是单例类本身如果长时间不用会不会被收集呢？因为JVM对方法区也是有垃圾收集机制的。如果单例类被收集，那么堆中的对象就会失去到根的路径，必然会被垃圾收集掉。<br>通过以下代码测试单例对象是否会被回收。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.singleton;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Singleton</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">byte</span>[] test = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">6</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>];</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> Singleton singleton = <span class=\"keyword\">new</span> Singleton();</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">private</span> <span class=\"title\">Singleton</span><span class=\"params\">()</span></span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Singleton <span class=\"title\">getInstance</span><span class=\"params\">()</span></span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> singleton;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Obj</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">byte</span>[] test = <span class=\"keyword\">new</span> <span class=\"keyword\">byte</span>[<span class=\"number\">3</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>];</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Client</span></span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception</span>&#123;</span><br><span class=\"line\">        Singleton.getInstance();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(<span class=\"keyword\">true</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">new</span> Obj();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>代码5.1  测试代码<br>运行时JVM 的参数被设定为：<br><code>-verbose:gc -Xms20M -Xmx20M</code><br>即每次JVM进行垃圾回收时显示内存信息，JVM的内存设为固定20M。<br>通过模拟J2EE容器，实例化大小为6M的单例类，然后不断的创建对象，迫使JVM进行垃圾回收，观察垃圾收集信息，如果进行垃圾收集后，内存仍然大于6M，则说明垃圾回收不会回收单例对象。</p>\n<p><img src=\"http://image.stephenfang.me/java.png\"></p>\n<p>图5.1  测试结果<br>从运行结果中可以看到有6M空间没有被收集。达到GC的条件其一为该类所有的实例都已经被回收，即java堆中不存在该类的任何实例。单例的类不满足该条件，因此单例类也不会被回收。也就是说，只要单例类中的静态引用指向JVM堆中的单例对象，那么单例类和单例对象都不会被垃圾收集。所以“如果实例化的对象长时间不被利用，系统会认为它是垃圾，会自动销毁并回收资源，下次利用时又将重新实例化，这将导致对象状态丢失。”这一点目前无法在实验中验证。<br>至于违背了单一职责原则这一点前文已有讨论，不复引述。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><ul>\n<li>洁城浩，《设计模式-JAVA语言中的应用》，中国铁道出版社2005.1</li>\n<li>（美） GoF, 《设计模式-可复用的面向对象软件的基础》，机械工业出版社，2005 </li>\n<li>何海涛，《剑指Offer》，电子工业出版社2012.1</li>\n<li>（美）Alan Holub，《设计模式初学者指南》，机械工业出版社，2006</li>\n</ul>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/15917501563785.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:42 GMT+0800 (中国标准时间)","title":"软件设计模式 - 单例模式","path":"2020/06/07/Singleton_Pattern/","eyeCatchImage":"http://image.stephenfang.me/mweb/15917501563785.jpg","excerpt":"<p>单例模式(Singleton Pattern)，也叫单子模式，属于创建型模式的一种。单例模式重点解决几个不同的客户对象需要引用同个对象，且这种类型的对象数目不止一个的问题。通过确保一个类只能有一个实例，提供对该实例的全局访问，使得客户对象无需操心是否存在单例类的实例，实例化由单例类自己控制。</p>","date":{"_isAMomentObject":true,"_i":"2020-06-07T05:23:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-06-07T05:23:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["设计模式","Java"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":7874},{"title":"iOS14 & iOS 15 相册适配","date":"2022-01-20T09:10:20.000Z","_content":"\n开发迭代为了解决测试提出的「选中的照片」权限适配问题，花时间研究了[Handle the Limited Photos Library in your app](https://developer.apple.com/videos/play/wwdc2020/10641) 和 [Meet the new Photos picker](https://developer.apple.com/videos/play/wwdc2020/10652/?time=841) session，整理[需求内容](http://music-overmind.hz.netease.com/18/requirement/issues/OMMUSIC-77674)汇总并实现，同时还解决了一处 iOS 15.2 下可能导致崩溃的相册权限问题。\n\n<!--more-->\n\n# 崩溃问题\n\n> 15.2 系统版本下在使用调用本地相册相关的功能后（上传作品、更换头像、歌房玩法公屏...） app 就会卡死。\n> \n\n---\n\n**思路**：按照给出的路径进行复现，发现在给予相册访问权限以后无法复现该问题，但是在相册权限为**`PHAuthorizationStatusNotDetermined`**（第一次选择本地相册弹框选择「选中的照片」）以及**`PHAuthorizationStatusDenied`** （不给予相册权限）会出现长达数十秒的卡顿和崩溃，点击暂停执行可以看到主线程被blocked了正在等待。\n\n![POPO20220118-144240.jpg](http://image.stephenfang.me/mweb/POPO20220118-144240.jpg)\n\n回到图片框架上，MZAssetsLibrary在init后执行了`[PHPPhotoLibrary registerChangeObserver:]`，于是有理由怀疑是不是这一行代码相关的API执行了变动。\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled.png)\n\n在苹果开发者论坛找到了答案：\n\n[ios 15.2 beta app stuck](https://developer.apple.com/forums/thread/696131)\n\n在 iOS 15.2 之前使用`[PHPPhotoLibrary registerChangeObserver:]`通知不需要相册权限，然而在 iOS 15.2 之后 Apple 新增了应用隐私报告，添加了该方法的相册权限前提。\n\n---\n\n**解决方案**：先注册相册请求，在获取到权限之后针对可访问的相册权限注册该通知，如`PHAuthorizationStatusAuthorized`、`PHAuthorizationStatusLimited`，但是需要涉及到旧版本的权限兼容，于是引出了权限适配方案。\n\n# 相册权限适配\n\n## 简述\n\n在 iOS 13 及以前，当用户首次访问应用程序时，会被要求开放大量权限，比如相册、定位、联系人，实际上该应用可能仅仅需要一个选择图片功能，却被要求开放整个照片库的权限，这确实是不合理的。\n\n在 iOS 14 中引入了 “LimitedPhotos Library” 的概念，用户可以授予应用访问其一部分的照片，对于应用来说，仅能读取到用户选择让应用来读取的照片。\n\n![Xnip2022-01-06_21-34-51.jpg](http://image.stephenfang.me/mweb/Xnip2022-01-06_21-34-51.jpg)\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 1.png)\n\n具体体现在\n\n1. 授权弹窗中增加了 Select Photo 选项。用户可以在 App 请求调用相册时选择部分照片让 App 读取。从 App 的视⻆来看，你的相册里就只有这几张照片，App 无法得知其它照片的存在。\n2. 当用户选择权限为`PHAuthorizationStatusLimited`如果未适配，可能会在每次触发相册功能时都弹窗询问用户是否需要修改照片权限。可通过在 Info.plist 设置`PHPhotoLibraryPreventAutomaticLimitedAccessAlert`为 `YES` 来阻止该弹窗反复弹出\n\n## API 改变\n\n从开发适配的角度，需要关注新的请求权限和请求权限的方法。\n\n列举出的请求权限共以下几种，其中`PHAuthorizationStatusLimited`的注释中给出了适配方法。\n\n```objectivec\ntypedef NS_ENUM(NSInteger, PHAuthorizationStatus) {\n    PHAuthorizationStatusNotDetermined = 0, // User has not yet made a choice with regards to this application\n    PHAuthorizationStatusRestricted,        // This application is not authorized to access photo data.\n                                            // The user cannot change this application’s status, possibly due to active restrictions\n                                            //   such as parental controls being in place.\n    PHAuthorizationStatusDenied,            // User has explicitly denied this application access to photos data.\n    PHAuthorizationStatusAuthorized,        // User has authorized this application to access photos data.\n    PHAuthorizationStatusLimited API_AVAILABLE(ios(14)), // User has authorized this application for limited photo library access. Add PHPhotoLibraryPreventAutomaticLimitedAccessAlert = YES to the application's Info.plist to prevent the automatic alert to update the users limited library selection. Use -[PHPhotoLibrary(PhotosUISupport) presentLimitedLibraryPickerFromViewController:] from PhotosUI/PHPhotoLibrary+PhotosUISupport.h to manually present the limited library picker.\n};\n```\n\n请求权限的方法也得到了更新，需要注意的是\n\n- 只有使用新的`requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel` 方法才能正确获取到  `PHAuthorizationStatusLimited` 权限\n- 如果使用以前的API来获取权限状态，`PHAuthorizationStatusLimited` 状态下返回`PHAuthorizationStatusAuthorized`\n- 在请求权限的时候需要给予读写权限参数`PHAccessLevel`，可选值为`PHAccessLevelAddOnly` 与 `PHAccessLevelReadWrite`，仅在`PHAccessLevelReadWrite` 下才能够获取到`PHAuthorizationStatusLimited` 权限\n\n```objectivec\n#pragma mark - Library access authorization status\n\n/// Replaces \\c +authorizationStatus to support add-only/read-write access level status\n+ (PHAuthorizationStatus)authorizationStatusForAccessLevel:(PHAccessLevel)accessLevel API_AVAILABLE(macosx(11.0), ios(14), tvos(14));\n+ (void)requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel handler:(void(^)(PHAuthorizationStatus status))handler API_AVAILABLE(macosx(11.0), ios(14), tvos(14)) NS_SWIFT_ASYNC(2);\n\n/// Deprecated and replaced by authorizationStatusForAccessLevel:, will return \\c PHAuthorizationStatusAuthorized if the user has chosen limited photo library access\n+ (PHAuthorizationStatus)authorizationStatus API_DEPRECATED_WITH_REPLACEMENT(\"+authorizationStatusForAccessLevel:\", ios(8, API_TO_BE_DEPRECATED), macos(10.13, API_TO_BE_DEPRECATED), tvos(10, API_TO_BE_DEPRECATED));\n+ (void)requestAuthorization:(void(^)(PHAuthorizationStatus status))handler API_DEPRECATED_WITH_REPLACEMENT(\"+requestAuthorizationForAccessLevel:handler:\", ios(8, API_TO_BE_DEPRECATED), macos(10.13, API_TO_BE_DEPRECATED), tvos(10, API_TO_BE_DEPRECATED));\n\ntypedef NS_ENUM(NSInteger, PHAccessLevel) {\n    PHAccessLevelAddOnly = 1,\n    PHAccessLevelReadWrite = 2,\n} API_AVAILABLE(macos(11.0), ios(14), tvos(14));\n```\n\n针对业务需求对代码进行了部分重构，原代码采用if-else结构进行控制，还需要判断iOS版本结构会过于混乱。\n\n```objectivec\nvoid (^setUpUI)(PHAuthorizationStatus status) = ^(PHAuthorizationStatus status){\n            switch (status) {\n                case PHAuthorizationStatusNotDetermined: {\n                    break;\n                }\n                case PHAuthorizationStatusAuthorized:\n                case PHAuthorizationStatusLimited: {\n                    [self.library registerChangeObserver:self];\n                    loadCollections();\n                    break;\n                }\n                case PHAuthorizationStatusDenied:\n                case PHAuthorizationStatusRestricted: {\n                    notAllowed();\n                    break;\n                }\n                default: {\n                    notAllowed();\n                    break;\n                }\n            }\n        };\n        \n        if (status == PHAuthorizationStatusNotDetermined) {\n            if (@available(iOS 14, *)) {\n                [PHPhotoLibrary requestAuthorizationForAccessLevel:PHAccessLevelReadWrite handler:^(PHAuthorizationStatus status) {\n                    dispatch_async(dispatch_get_main_queue(), ^{\n                        setUpUI(status);\n                    });\n                }];\n            } else {\n                [PHPhotoLibrary requestAuthorization:^(PHAuthorizationStatus status) {\n                    dispatch_async(dispatch_get_main_queue(), ^{\n                        setUpUI(status);\n                    });\n                }];\n            }\n        } else {\n            setUpUI(status);\n        }\n```\n\n---\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 2.png)\n\n若要在应用内唤起访问系统受限相册的选择面板需要调用以下API，并且监听图片变化做相应处理。\n\n```objectivec\n- (void)presentLimitedLibraryPickerFromViewController:(UIViewController *)controller;\n```\n\n在 iOS 15 中还针对以上API提供了回调。\n\n```objectivec\n- (void)presentLimitedLibraryPickerFromViewController:(UIViewController *)controller \n                                    completionHandler:(void (^)(NSArray<NSString *> *))completionHandler;\n```\n\n## 视觉适配\n\n找视觉沟通前研究了微信和微博如何做适配，可以说微博的适配方案加上了引导体验更加完整。\n\n![6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg](http://image.stephenfang.me/mweb/6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg)\n\n![e9aab135-4eb6-489b-af70-3d1664354d2f.jpg](http://image.stephenfang.me/mweb/e9aab135-4eb6-489b-af70-3d1664354d2f.jpg)\n\n目前音街相册实现效果如下图所示。\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 3.png)\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 4.png)\n\n# 照片选择器\n\n在 iOS 14 中官方推荐使用 `PhotosUI` 框架下的 `PHPicker` 来替代 `UIImagePickerController` 进行图片选择。\n\n`PHPicker` 为独立进程，会在视图最顶层进行展示，应用内无法对其进行截图也无法直接访问到其内的数据，同时在功能上支持多选，支持搜索，支持按图片、视频、LivePhotos进行筛选\n\n`UIImagePickerViewController` 功能受限，每次只能选择一张图片，将逐渐被废弃，同时`UIImagePickerController` 中三个 `sourceType`两个被废弃，只留下 `camera`。\n\n## 功能一览\n\n- 支持缩放\n    \n    ![IMG_9246.PNG](http://image.stephenfang.me/mweb/IMG_9246.png)\n    \n- 支持搜索\n    \n    ![IMG_9248.PNG](http://image.stephenfang.me/mweb/IMG_9248.png)\n    \n- 支持分类\n    \n    ![IMG_9247.PNG](http://image.stephenfang.me/mweb/IMG_9247.png)\n    \n\n## 调用方法\n\n在调用方法上，需要首先声明 `PHPickerConfiguration` 并进行配置，再将其传递给`PHPickerViewController` 完成调用。\n\n```objectivec\nPHPickerConfiguration *config = [[PHPickerConfiguration alloc] init];\nconfig.selectionLimit = 3;  // 可选择的资源数量，0表示不设限制，默认为1\nconfig.filter = [PHPickerFilter imagesFilter]; // 只显示图片，默认全选，可选择imagesFilter、livePhotosFilter、videosFilter\nconfig.preferredAssetRepresentationMode = PHPickerConfigurationAssetRepresentationModeCurrent; // 如果要获取视频最好设置该属性，避免系统对视频进行转码\n\nPHPickerViewController *pickerViewController = [[PHPickerViewController alloc] initWithConfiguration:config];\npickerViewController.delegate = self;\n[self presentViewController:pickerViewController animated:YES completion:nil];\n```\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 5.png)\n\n---\n\n`PHPickerConfiguration`、`PHPickerFilter` 和 `PHPickerResult` 都是作为结构体而不是作为类桥接到 Swift 中，从`PHPickerViewController` 返回使用`NSItemProvider`,与 `UIImagePickerController` 不同\n\n```objectivec\n-(void)picker:(PHPickerViewController *)picker didFinishPicking:(NSArray<PHPickerResult *> *)results{\n   [picker dismissViewControllerAnimated:YES completion:nil];\n    \n   for (PHPickerResult *result in results) {\n      // Get UIImage\n      [result.itemProvider loadObjectOfClass:[UIImage class] completionHandler:^(__kindof id<NSItemProviderReading>  _Nullable object, NSError * _Nullable error) {\n         if ([object isKindOfClass:[UIImage class]]) {\n            dispatch_async(dispatch_get_main_queue(), ^{\n               NSLog(@\"Selected image: %@\", (UIImage*)object);\n            });\n         }\n      }];\n   }\n}\n```\n\n## 存在问题\n\n- 加载 iCloud 资源时没有进度回调\n- 不支持图片编辑（比如选择头像要将图片裁剪成圆形）\n\n# 引用\n\n[Handle the Limited Photos Library in your app](https://developer.apple.com/videos/play/wwdc2020/10641) \n\n[Meet the new Photos picker](https://developer.apple.com/videos/play/wwdc2020/10652/?time=841)\n\n[Delivering an Enhanced Privacy Experience in Your Photos App](https://developer.apple.com/documentation/photokit/delivering_an_enhanced_privacy_experience_in_your_photos_app?language=objc)\n\n[The Complete Guide to PHPicker API in iOS 14](https://www.appcoda.com/phpicker/)\n\n[新零售淘系技术 - iOS14 隐私适配及部分解决方案](https://developer.aliyun.com/article/768114)\n\n[RayJiang97-为什么不推荐使用 PHPicker](https://juejin.cn/post/6881513652176814093)","source":"_posts/Photo_Library.md","raw":"---\ntitle: iOS14 & iOS 15 相册适配\ndate: 2022-01-20 17:10:20\ncategories: \n- 技术\ntags: \n- iOS\n- Photo\n- Objective-C\n- Swift\n- iOS 15\n- iOS 14\n---\n\n开发迭代为了解决测试提出的「选中的照片」权限适配问题，花时间研究了[Handle the Limited Photos Library in your app](https://developer.apple.com/videos/play/wwdc2020/10641) 和 [Meet the new Photos picker](https://developer.apple.com/videos/play/wwdc2020/10652/?time=841) session，整理[需求内容](http://music-overmind.hz.netease.com/18/requirement/issues/OMMUSIC-77674)汇总并实现，同时还解决了一处 iOS 15.2 下可能导致崩溃的相册权限问题。\n\n<!--more-->\n\n# 崩溃问题\n\n> 15.2 系统版本下在使用调用本地相册相关的功能后（上传作品、更换头像、歌房玩法公屏...） app 就会卡死。\n> \n\n---\n\n**思路**：按照给出的路径进行复现，发现在给予相册访问权限以后无法复现该问题，但是在相册权限为**`PHAuthorizationStatusNotDetermined`**（第一次选择本地相册弹框选择「选中的照片」）以及**`PHAuthorizationStatusDenied`** （不给予相册权限）会出现长达数十秒的卡顿和崩溃，点击暂停执行可以看到主线程被blocked了正在等待。\n\n![POPO20220118-144240.jpg](http://image.stephenfang.me/mweb/POPO20220118-144240.jpg)\n\n回到图片框架上，MZAssetsLibrary在init后执行了`[PHPPhotoLibrary registerChangeObserver:]`，于是有理由怀疑是不是这一行代码相关的API执行了变动。\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled.png)\n\n在苹果开发者论坛找到了答案：\n\n[ios 15.2 beta app stuck](https://developer.apple.com/forums/thread/696131)\n\n在 iOS 15.2 之前使用`[PHPPhotoLibrary registerChangeObserver:]`通知不需要相册权限，然而在 iOS 15.2 之后 Apple 新增了应用隐私报告，添加了该方法的相册权限前提。\n\n---\n\n**解决方案**：先注册相册请求，在获取到权限之后针对可访问的相册权限注册该通知，如`PHAuthorizationStatusAuthorized`、`PHAuthorizationStatusLimited`，但是需要涉及到旧版本的权限兼容，于是引出了权限适配方案。\n\n# 相册权限适配\n\n## 简述\n\n在 iOS 13 及以前，当用户首次访问应用程序时，会被要求开放大量权限，比如相册、定位、联系人，实际上该应用可能仅仅需要一个选择图片功能，却被要求开放整个照片库的权限，这确实是不合理的。\n\n在 iOS 14 中引入了 “LimitedPhotos Library” 的概念，用户可以授予应用访问其一部分的照片，对于应用来说，仅能读取到用户选择让应用来读取的照片。\n\n![Xnip2022-01-06_21-34-51.jpg](http://image.stephenfang.me/mweb/Xnip2022-01-06_21-34-51.jpg)\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 1.png)\n\n具体体现在\n\n1. 授权弹窗中增加了 Select Photo 选项。用户可以在 App 请求调用相册时选择部分照片让 App 读取。从 App 的视⻆来看，你的相册里就只有这几张照片，App 无法得知其它照片的存在。\n2. 当用户选择权限为`PHAuthorizationStatusLimited`如果未适配，可能会在每次触发相册功能时都弹窗询问用户是否需要修改照片权限。可通过在 Info.plist 设置`PHPhotoLibraryPreventAutomaticLimitedAccessAlert`为 `YES` 来阻止该弹窗反复弹出\n\n## API 改变\n\n从开发适配的角度，需要关注新的请求权限和请求权限的方法。\n\n列举出的请求权限共以下几种，其中`PHAuthorizationStatusLimited`的注释中给出了适配方法。\n\n```objectivec\ntypedef NS_ENUM(NSInteger, PHAuthorizationStatus) {\n    PHAuthorizationStatusNotDetermined = 0, // User has not yet made a choice with regards to this application\n    PHAuthorizationStatusRestricted,        // This application is not authorized to access photo data.\n                                            // The user cannot change this application’s status, possibly due to active restrictions\n                                            //   such as parental controls being in place.\n    PHAuthorizationStatusDenied,            // User has explicitly denied this application access to photos data.\n    PHAuthorizationStatusAuthorized,        // User has authorized this application to access photos data.\n    PHAuthorizationStatusLimited API_AVAILABLE(ios(14)), // User has authorized this application for limited photo library access. Add PHPhotoLibraryPreventAutomaticLimitedAccessAlert = YES to the application's Info.plist to prevent the automatic alert to update the users limited library selection. Use -[PHPhotoLibrary(PhotosUISupport) presentLimitedLibraryPickerFromViewController:] from PhotosUI/PHPhotoLibrary+PhotosUISupport.h to manually present the limited library picker.\n};\n```\n\n请求权限的方法也得到了更新，需要注意的是\n\n- 只有使用新的`requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel` 方法才能正确获取到  `PHAuthorizationStatusLimited` 权限\n- 如果使用以前的API来获取权限状态，`PHAuthorizationStatusLimited` 状态下返回`PHAuthorizationStatusAuthorized`\n- 在请求权限的时候需要给予读写权限参数`PHAccessLevel`，可选值为`PHAccessLevelAddOnly` 与 `PHAccessLevelReadWrite`，仅在`PHAccessLevelReadWrite` 下才能够获取到`PHAuthorizationStatusLimited` 权限\n\n```objectivec\n#pragma mark - Library access authorization status\n\n/// Replaces \\c +authorizationStatus to support add-only/read-write access level status\n+ (PHAuthorizationStatus)authorizationStatusForAccessLevel:(PHAccessLevel)accessLevel API_AVAILABLE(macosx(11.0), ios(14), tvos(14));\n+ (void)requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel handler:(void(^)(PHAuthorizationStatus status))handler API_AVAILABLE(macosx(11.0), ios(14), tvos(14)) NS_SWIFT_ASYNC(2);\n\n/// Deprecated and replaced by authorizationStatusForAccessLevel:, will return \\c PHAuthorizationStatusAuthorized if the user has chosen limited photo library access\n+ (PHAuthorizationStatus)authorizationStatus API_DEPRECATED_WITH_REPLACEMENT(\"+authorizationStatusForAccessLevel:\", ios(8, API_TO_BE_DEPRECATED), macos(10.13, API_TO_BE_DEPRECATED), tvos(10, API_TO_BE_DEPRECATED));\n+ (void)requestAuthorization:(void(^)(PHAuthorizationStatus status))handler API_DEPRECATED_WITH_REPLACEMENT(\"+requestAuthorizationForAccessLevel:handler:\", ios(8, API_TO_BE_DEPRECATED), macos(10.13, API_TO_BE_DEPRECATED), tvos(10, API_TO_BE_DEPRECATED));\n\ntypedef NS_ENUM(NSInteger, PHAccessLevel) {\n    PHAccessLevelAddOnly = 1,\n    PHAccessLevelReadWrite = 2,\n} API_AVAILABLE(macos(11.0), ios(14), tvos(14));\n```\n\n针对业务需求对代码进行了部分重构，原代码采用if-else结构进行控制，还需要判断iOS版本结构会过于混乱。\n\n```objectivec\nvoid (^setUpUI)(PHAuthorizationStatus status) = ^(PHAuthorizationStatus status){\n            switch (status) {\n                case PHAuthorizationStatusNotDetermined: {\n                    break;\n                }\n                case PHAuthorizationStatusAuthorized:\n                case PHAuthorizationStatusLimited: {\n                    [self.library registerChangeObserver:self];\n                    loadCollections();\n                    break;\n                }\n                case PHAuthorizationStatusDenied:\n                case PHAuthorizationStatusRestricted: {\n                    notAllowed();\n                    break;\n                }\n                default: {\n                    notAllowed();\n                    break;\n                }\n            }\n        };\n        \n        if (status == PHAuthorizationStatusNotDetermined) {\n            if (@available(iOS 14, *)) {\n                [PHPhotoLibrary requestAuthorizationForAccessLevel:PHAccessLevelReadWrite handler:^(PHAuthorizationStatus status) {\n                    dispatch_async(dispatch_get_main_queue(), ^{\n                        setUpUI(status);\n                    });\n                }];\n            } else {\n                [PHPhotoLibrary requestAuthorization:^(PHAuthorizationStatus status) {\n                    dispatch_async(dispatch_get_main_queue(), ^{\n                        setUpUI(status);\n                    });\n                }];\n            }\n        } else {\n            setUpUI(status);\n        }\n```\n\n---\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 2.png)\n\n若要在应用内唤起访问系统受限相册的选择面板需要调用以下API，并且监听图片变化做相应处理。\n\n```objectivec\n- (void)presentLimitedLibraryPickerFromViewController:(UIViewController *)controller;\n```\n\n在 iOS 15 中还针对以上API提供了回调。\n\n```objectivec\n- (void)presentLimitedLibraryPickerFromViewController:(UIViewController *)controller \n                                    completionHandler:(void (^)(NSArray<NSString *> *))completionHandler;\n```\n\n## 视觉适配\n\n找视觉沟通前研究了微信和微博如何做适配，可以说微博的适配方案加上了引导体验更加完整。\n\n![6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg](http://image.stephenfang.me/mweb/6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg)\n\n![e9aab135-4eb6-489b-af70-3d1664354d2f.jpg](http://image.stephenfang.me/mweb/e9aab135-4eb6-489b-af70-3d1664354d2f.jpg)\n\n目前音街相册实现效果如下图所示。\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 3.png)\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 4.png)\n\n# 照片选择器\n\n在 iOS 14 中官方推荐使用 `PhotosUI` 框架下的 `PHPicker` 来替代 `UIImagePickerController` 进行图片选择。\n\n`PHPicker` 为独立进程，会在视图最顶层进行展示，应用内无法对其进行截图也无法直接访问到其内的数据，同时在功能上支持多选，支持搜索，支持按图片、视频、LivePhotos进行筛选\n\n`UIImagePickerViewController` 功能受限，每次只能选择一张图片，将逐渐被废弃，同时`UIImagePickerController` 中三个 `sourceType`两个被废弃，只留下 `camera`。\n\n## 功能一览\n\n- 支持缩放\n    \n    ![IMG_9246.PNG](http://image.stephenfang.me/mweb/IMG_9246.png)\n    \n- 支持搜索\n    \n    ![IMG_9248.PNG](http://image.stephenfang.me/mweb/IMG_9248.png)\n    \n- 支持分类\n    \n    ![IMG_9247.PNG](http://image.stephenfang.me/mweb/IMG_9247.png)\n    \n\n## 调用方法\n\n在调用方法上，需要首先声明 `PHPickerConfiguration` 并进行配置，再将其传递给`PHPickerViewController` 完成调用。\n\n```objectivec\nPHPickerConfiguration *config = [[PHPickerConfiguration alloc] init];\nconfig.selectionLimit = 3;  // 可选择的资源数量，0表示不设限制，默认为1\nconfig.filter = [PHPickerFilter imagesFilter]; // 只显示图片，默认全选，可选择imagesFilter、livePhotosFilter、videosFilter\nconfig.preferredAssetRepresentationMode = PHPickerConfigurationAssetRepresentationModeCurrent; // 如果要获取视频最好设置该属性，避免系统对视频进行转码\n\nPHPickerViewController *pickerViewController = [[PHPickerViewController alloc] initWithConfiguration:config];\npickerViewController.delegate = self;\n[self presentViewController:pickerViewController animated:YES completion:nil];\n```\n\n![Untitled](http://image.stephenfang.me/mweb/Untitled 5.png)\n\n---\n\n`PHPickerConfiguration`、`PHPickerFilter` 和 `PHPickerResult` 都是作为结构体而不是作为类桥接到 Swift 中，从`PHPickerViewController` 返回使用`NSItemProvider`,与 `UIImagePickerController` 不同\n\n```objectivec\n-(void)picker:(PHPickerViewController *)picker didFinishPicking:(NSArray<PHPickerResult *> *)results{\n   [picker dismissViewControllerAnimated:YES completion:nil];\n    \n   for (PHPickerResult *result in results) {\n      // Get UIImage\n      [result.itemProvider loadObjectOfClass:[UIImage class] completionHandler:^(__kindof id<NSItemProviderReading>  _Nullable object, NSError * _Nullable error) {\n         if ([object isKindOfClass:[UIImage class]]) {\n            dispatch_async(dispatch_get_main_queue(), ^{\n               NSLog(@\"Selected image: %@\", (UIImage*)object);\n            });\n         }\n      }];\n   }\n}\n```\n\n## 存在问题\n\n- 加载 iCloud 资源时没有进度回调\n- 不支持图片编辑（比如选择头像要将图片裁剪成圆形）\n\n# 引用\n\n[Handle the Limited Photos Library in your app](https://developer.apple.com/videos/play/wwdc2020/10641) \n\n[Meet the new Photos picker](https://developer.apple.com/videos/play/wwdc2020/10652/?time=841)\n\n[Delivering an Enhanced Privacy Experience in Your Photos App](https://developer.apple.com/documentation/photokit/delivering_an_enhanced_privacy_experience_in_your_photos_app?language=objc)\n\n[The Complete Guide to PHPicker API in iOS 14](https://www.appcoda.com/phpicker/)\n\n[新零售淘系技术 - iOS14 隐私适配及部分解决方案](https://developer.aliyun.com/article/768114)\n\n[RayJiang97-为什么不推荐使用 PHPicker](https://juejin.cn/post/6881513652176814093)","slug":"Photo_Library","published":1,"updated":"2022-07-24T15:18:13.051Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp34006do76feopr9z3r","content":"<p>开发迭代为了解决测试提出的「选中的照片」权限适配问题，花时间研究了<a href=\"https://developer.apple.com/videos/play/wwdc2020/10641\">Handle the Limited Photos Library in your app</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2020/10652/?time=841\">Meet the new Photos picker</a> session，整理<a href=\"http://music-overmind.hz.netease.com/18/requirement/issues/OMMUSIC-77674\">需求内容</a>汇总并实现，同时还解决了一处 iOS 15.2 下可能导致崩溃的相册权限问题。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"崩溃问题\"><a href=\"#崩溃问题\" class=\"headerlink\" title=\"崩溃问题\"></a>崩溃问题</h1><blockquote>\n<p>15.2 系统版本下在使用调用本地相册相关的功能后（上传作品、更换头像、歌房玩法公屏…） app 就会卡死。</p>\n</blockquote>\n<hr>\n<p><strong>思路</strong>：按照给出的路径进行复现，发现在给予相册访问权限以后无法复现该问题，但是在相册权限为**<code>PHAuthorizationStatusNotDetermined</code><strong>（第一次选择本地相册弹框选择「选中的照片」）以及</strong><code>PHAuthorizationStatusDenied</code>** （不给予相册权限）会出现长达数十秒的卡顿和崩溃，点击暂停执行可以看到主线程被blocked了正在等待。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/POPO20220118-144240.jpg\" alt=\"POPO20220118-144240.jpg\"></p>\n<p>回到图片框架上，MZAssetsLibrary在init后执行了<code>[PHPPhotoLibrary registerChangeObserver:]</code>，于是有理由怀疑是不是这一行代码相关的API执行了变动。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled.png\" alt=\"Untitled\"></p>\n<p>在苹果开发者论坛找到了答案：</p>\n<p><a href=\"https://developer.apple.com/forums/thread/696131\">ios 15.2 beta app stuck</a></p>\n<p>在 iOS 15.2 之前使用<code>[PHPPhotoLibrary registerChangeObserver:]</code>通知不需要相册权限，然而在 iOS 15.2 之后 Apple 新增了应用隐私报告，添加了该方法的相册权限前提。</p>\n<hr>\n<p><strong>解决方案</strong>：先注册相册请求，在获取到权限之后针对可访问的相册权限注册该通知，如<code>PHAuthorizationStatusAuthorized</code>、<code>PHAuthorizationStatusLimited</code>，但是需要涉及到旧版本的权限兼容，于是引出了权限适配方案。</p>\n<h1 id=\"相册权限适配\"><a href=\"#相册权限适配\" class=\"headerlink\" title=\"相册权限适配\"></a>相册权限适配</h1><h2 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h2><p>在 iOS 13 及以前，当用户首次访问应用程序时，会被要求开放大量权限，比如相册、定位、联系人，实际上该应用可能仅仅需要一个选择图片功能，却被要求开放整个照片库的权限，这确实是不合理的。</p>\n<p>在 iOS 14 中引入了 “LimitedPhotos Library” 的概念，用户可以授予应用访问其一部分的照片，对于应用来说，仅能读取到用户选择让应用来读取的照片。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Xnip2022-01-06_21-34-51.jpg\" alt=\"Xnip2022-01-06_21-34-51.jpg\"></p>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 1.png)</p>\n<p>具体体现在</p>\n<ol>\n<li>授权弹窗中增加了 Select Photo 选项。用户可以在 App 请求调用相册时选择部分照片让 App 读取。从 App 的视⻆来看，你的相册里就只有这几张照片，App 无法得知其它照片的存在。</li>\n<li>当用户选择权限为<code>PHAuthorizationStatusLimited</code>如果未适配，可能会在每次触发相册功能时都弹窗询问用户是否需要修改照片权限。可通过在 Info.plist 设置<code>PHPhotoLibraryPreventAutomaticLimitedAccessAlert</code>为 <code>YES</code> 来阻止该弹窗反复弹出</li>\n</ol>\n<h2 id=\"API-改变\"><a href=\"#API-改变\" class=\"headerlink\" title=\"API 改变\"></a>API 改变</h2><p>从开发适配的角度，需要关注新的请求权限和请求权限的方法。</p>\n<p>列举出的请求权限共以下几种，其中<code>PHAuthorizationStatusLimited</code>的注释中给出了适配方法。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSInteger</span>, PHAuthorizationStatus) &#123;</span><br><span class=\"line\">    PHAuthorizationStatusNotDetermined = <span class=\"number\">0</span>, <span class=\"comment\">// User has not yet made a choice with regards to this application</span></span><br><span class=\"line\">    PHAuthorizationStatusRestricted,        <span class=\"comment\">// This application is not authorized to access photo data.</span></span><br><span class=\"line\">                                            <span class=\"comment\">// The user cannot change this application’s status, possibly due to active restrictions</span></span><br><span class=\"line\">                                            <span class=\"comment\">//   such as parental controls being in place.</span></span><br><span class=\"line\">    PHAuthorizationStatusDenied,            <span class=\"comment\">// User has explicitly denied this application access to photos data.</span></span><br><span class=\"line\">    PHAuthorizationStatusAuthorized,        <span class=\"comment\">// User has authorized this application to access photos data.</span></span><br><span class=\"line\">    PHAuthorizationStatusLimited API_AVAILABLE(ios(<span class=\"number\">14</span>)), <span class=\"comment\">// User has authorized this application for limited photo library access. Add PHPhotoLibraryPreventAutomaticLimitedAccessAlert = YES to the application&#x27;s Info.plist to prevent the automatic alert to update the users limited library selection. Use -[PHPhotoLibrary(PhotosUISupport) presentLimitedLibraryPickerFromViewController:] from PhotosUI/PHPhotoLibrary+PhotosUISupport.h to manually present the limited library picker.</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>请求权限的方法也得到了更新，需要注意的是</p>\n<ul>\n<li>只有使用新的<code>requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel</code> 方法才能正确获取到  <code>PHAuthorizationStatusLimited</code> 权限</li>\n<li>如果使用以前的API来获取权限状态，<code>PHAuthorizationStatusLimited</code> 状态下返回<code>PHAuthorizationStatusAuthorized</code></li>\n<li>在请求权限的时候需要给予读写权限参数<code>PHAccessLevel</code>，可选值为<code>PHAccessLevelAddOnly</code> 与 <code>PHAccessLevelReadWrite</code>，仅在<code>PHAccessLevelReadWrite</code> 下才能够获取到<code>PHAuthorizationStatusLimited</code> 权限</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> mark - Library access authorization status</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Replaces \\c +authorizationStatus to support add-only/read-write access level status</span></span><br><span class=\"line\">+ (PHAuthorizationStatus)authorizationStatusForAccessLevel:(PHAccessLevel)accessLevel API_AVAILABLE(macosx(<span class=\"number\">11.0</span>), ios(<span class=\"number\">14</span>), tvos(<span class=\"number\">14</span>));</span><br><span class=\"line\">+ (<span class=\"keyword\">void</span>)requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel handler:(<span class=\"keyword\">void</span>(^)(PHAuthorizationStatus status))handler API_AVAILABLE(macosx(<span class=\"number\">11.0</span>), ios(<span class=\"number\">14</span>), tvos(<span class=\"number\">14</span>)) <span class=\"built_in\">NS_SWIFT_ASYNC</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Deprecated and replaced by authorizationStatusForAccessLevel:, will return \\c PHAuthorizationStatusAuthorized if the user has chosen limited photo library access</span></span><br><span class=\"line\">+ (PHAuthorizationStatus)authorizationStatus API_DEPRECATED_WITH_REPLACEMENT(<span class=\"string\">&quot;+authorizationStatusForAccessLevel:&quot;</span>, ios(<span class=\"number\">8</span>, API_TO_BE_DEPRECATED), macos(<span class=\"number\">10.13</span>, API_TO_BE_DEPRECATED), tvos(<span class=\"number\">10</span>, API_TO_BE_DEPRECATED));</span><br><span class=\"line\">+ (<span class=\"keyword\">void</span>)requestAuthorization:(<span class=\"keyword\">void</span>(^)(PHAuthorizationStatus status))handler API_DEPRECATED_WITH_REPLACEMENT(<span class=\"string\">&quot;+requestAuthorizationForAccessLevel:handler:&quot;</span>, ios(<span class=\"number\">8</span>, API_TO_BE_DEPRECATED), macos(<span class=\"number\">10.13</span>, API_TO_BE_DEPRECATED), tvos(<span class=\"number\">10</span>, API_TO_BE_DEPRECATED));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSInteger</span>, PHAccessLevel) &#123;</span><br><span class=\"line\">    PHAccessLevelAddOnly = <span class=\"number\">1</span>,</span><br><span class=\"line\">    PHAccessLevelReadWrite = <span class=\"number\">2</span>,</span><br><span class=\"line\">&#125; API_AVAILABLE(macos(<span class=\"number\">11.0</span>), ios(<span class=\"number\">14</span>), tvos(<span class=\"number\">14</span>));</span><br></pre></td></tr></table></figure>\n\n<p>针对业务需求对代码进行了部分重构，原代码采用if-else结构进行控制，还需要判断iOS版本结构会过于混乱。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> (^setUpUI)(PHAuthorizationStatus status) = ^(PHAuthorizationStatus status)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (status) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusNotDetermined: &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusAuthorized:</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusLimited: &#123;</span><br><span class=\"line\">                    [<span class=\"keyword\">self</span>.library registerChangeObserver:<span class=\"keyword\">self</span>];</span><br><span class=\"line\">                    loadCollections();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusDenied:</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusRestricted: &#123;</span><br><span class=\"line\">                    notAllowed();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">default</span>: &#123;</span><br><span class=\"line\">                    notAllowed();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (status == PHAuthorizationStatusNotDetermined) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (@available(iOS <span class=\"number\">14</span>, *)) &#123;</span><br><span class=\"line\">                [PHPhotoLibrary requestAuthorizationForAccessLevel:PHAccessLevelReadWrite handler:^(PHAuthorizationStatus status) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">                        setUpUI(status);</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;];</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                [PHPhotoLibrary requestAuthorization:^(PHAuthorizationStatus status) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">                        setUpUI(status);</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            setUpUI(status);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 2.png)</p>\n<p>若要在应用内唤起访问系统受限相册的选择面板需要调用以下API，并且监听图片变化做相应处理。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)presentLimitedLibraryPickerFromViewController:(<span class=\"built_in\">UIViewController</span> *)controller;</span><br></pre></td></tr></table></figure>\n\n<p>在 iOS 15 中还针对以上API提供了回调。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)presentLimitedLibraryPickerFromViewController:(<span class=\"built_in\">UIViewController</span> *)controller </span><br><span class=\"line\">                                    completionHandler:(<span class=\"keyword\">void</span> (^)(<span class=\"built_in\">NSArray</span>&lt;<span class=\"built_in\">NSString</span> *&gt; *))completionHandler;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"视觉适配\"><a href=\"#视觉适配\" class=\"headerlink\" title=\"视觉适配\"></a>视觉适配</h2><p>找视觉沟通前研究了微信和微博如何做适配，可以说微博的适配方案加上了引导体验更加完整。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg\" alt=\"6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/e9aab135-4eb6-489b-af70-3d1664354d2f.jpg\" alt=\"e9aab135-4eb6-489b-af70-3d1664354d2f.jpg\"></p>\n<p>目前音街相册实现效果如下图所示。</p>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 3.png)</p>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 4.png)</p>\n<h1 id=\"照片选择器\"><a href=\"#照片选择器\" class=\"headerlink\" title=\"照片选择器\"></a>照片选择器</h1><p>在 iOS 14 中官方推荐使用 <code>PhotosUI</code> 框架下的 <code>PHPicker</code> 来替代 <code>UIImagePickerController</code> 进行图片选择。</p>\n<p><code>PHPicker</code> 为独立进程，会在视图最顶层进行展示，应用内无法对其进行截图也无法直接访问到其内的数据，同时在功能上支持多选，支持搜索，支持按图片、视频、LivePhotos进行筛选</p>\n<p><code>UIImagePickerViewController</code> 功能受限，每次只能选择一张图片，将逐渐被废弃，同时<code>UIImagePickerController</code> 中三个 <code>sourceType</code>两个被废弃，只留下 <code>camera</code>。</p>\n<h2 id=\"功能一览\"><a href=\"#功能一览\" class=\"headerlink\" title=\"功能一览\"></a>功能一览</h2><ul>\n<li>支持缩放  <img src=\"http://image.stephenfang.me/mweb/IMG_9246.png\" alt=\"IMG_9246.PNG\"></li>\n<li>支持搜索  <img src=\"http://image.stephenfang.me/mweb/IMG_9248.png\" alt=\"IMG_9248.PNG\"></li>\n<li>支持分类  <img src=\"http://image.stephenfang.me/mweb/IMG_9247.png\" alt=\"IMG_9247.PNG\"></li>\n</ul>\n<h2 id=\"调用方法\"><a href=\"#调用方法\" class=\"headerlink\" title=\"调用方法\"></a>调用方法</h2><p>在调用方法上，需要首先声明 <code>PHPickerConfiguration</code> 并进行配置，再将其传递给<code>PHPickerViewController</code> 完成调用。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PHPickerConfiguration *config = [[PHPickerConfiguration alloc] init];</span><br><span class=\"line\">config.selectionLimit = <span class=\"number\">3</span>;  <span class=\"comment\">// 可选择的资源数量，0表示不设限制，默认为1</span></span><br><span class=\"line\">config.filter = [PHPickerFilter imagesFilter]; <span class=\"comment\">// 只显示图片，默认全选，可选择imagesFilter、livePhotosFilter、videosFilter</span></span><br><span class=\"line\">config.preferredAssetRepresentationMode = PHPickerConfigurationAssetRepresentationModeCurrent; <span class=\"comment\">// 如果要获取视频最好设置该属性，避免系统对视频进行转码</span></span><br><span class=\"line\"></span><br><span class=\"line\">PHPickerViewController *pickerViewController = [[PHPickerViewController alloc] initWithConfiguration:config];</span><br><span class=\"line\">pickerViewController.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:pickerViewController animated:<span class=\"literal\">YES</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 5.png)</p>\n<hr>\n<p><code>PHPickerConfiguration</code>、<code>PHPickerFilter</code> 和 <code>PHPickerResult</code> 都是作为结构体而不是作为类桥接到 Swift 中，从<code>PHPickerViewController</code> 返回使用<code>NSItemProvider</code>,与 <code>UIImagePickerController</code> 不同</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-(<span class=\"keyword\">void</span>)picker:(PHPickerViewController *)picker didFinishPicking:(<span class=\"built_in\">NSArray</span>&lt;PHPickerResult *&gt; *)results&#123;</span><br><span class=\"line\">   [picker dismissViewControllerAnimated:<span class=\"literal\">YES</span> completion:<span class=\"literal\">nil</span>];</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"keyword\">for</span> (PHPickerResult *result <span class=\"keyword\">in</span> results) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Get UIImage</span></span><br><span class=\"line\">      [result.itemProvider loadObjectOfClass:[<span class=\"built_in\">UIImage</span> <span class=\"keyword\">class</span>] completionHandler:^(__kindof <span class=\"keyword\">id</span>&lt;<span class=\"built_in\">NSItemProviderReading</span>&gt;  _Nullable object, <span class=\"built_in\">NSError</span> * _Nullable error) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> ([object isKindOfClass:[<span class=\"built_in\">UIImage</span> <span class=\"keyword\">class</span>]]) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">               <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Selected image: %@&quot;</span>, (<span class=\"built_in\">UIImage</span>*)object);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;];</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"存在问题\"><a href=\"#存在问题\" class=\"headerlink\" title=\"存在问题\"></a>存在问题</h2><ul>\n<li>加载 iCloud 资源时没有进度回调</li>\n<li>不支持图片编辑（比如选择头像要将图片裁剪成圆形）</li>\n</ul>\n<h1 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h1><p><a href=\"https://developer.apple.com/videos/play/wwdc2020/10641\">Handle the Limited Photos Library in your app</a> </p>\n<p><a href=\"https://developer.apple.com/videos/play/wwdc2020/10652/?time=841\">Meet the new Photos picker</a></p>\n<p><a href=\"https://developer.apple.com/documentation/photokit/delivering_an_enhanced_privacy_experience_in_your_photos_app?language=objc\">Delivering an Enhanced Privacy Experience in Your Photos App</a></p>\n<p><a href=\"https://www.appcoda.com/phpicker/\">The Complete Guide to PHPicker API in iOS 14</a></p>\n<p><a href=\"https://developer.aliyun.com/article/768114\">新零售淘系技术 - iOS14 隐私适配及部分解决方案</a></p>\n<p><a href=\"https://juejin.cn/post/6881513652176814093\">RayJiang97-为什么不推荐使用 PHPicker</a></p>\n","site":{"data":{}},"excerpt":"<p>开发迭代为了解决测试提出的「选中的照片」权限适配问题，花时间研究了<a href=\"https://developer.apple.com/videos/play/wwdc2020/10641\">Handle the Limited Photos Library in your app</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2020/10652/?time=841\">Meet the new Photos picker</a> session，整理<a href=\"http://music-overmind.hz.netease.com/18/requirement/issues/OMMUSIC-77674\">需求内容</a>汇总并实现，同时还解决了一处 iOS 15.2 下可能导致崩溃的相册权限问题。</p>","more":"<h1 id=\"崩溃问题\"><a href=\"#崩溃问题\" class=\"headerlink\" title=\"崩溃问题\"></a>崩溃问题</h1><blockquote>\n<p>15.2 系统版本下在使用调用本地相册相关的功能后（上传作品、更换头像、歌房玩法公屏…） app 就会卡死。</p>\n</blockquote>\n<hr>\n<p><strong>思路</strong>：按照给出的路径进行复现，发现在给予相册访问权限以后无法复现该问题，但是在相册权限为**<code>PHAuthorizationStatusNotDetermined</code><strong>（第一次选择本地相册弹框选择「选中的照片」）以及</strong><code>PHAuthorizationStatusDenied</code>** （不给予相册权限）会出现长达数十秒的卡顿和崩溃，点击暂停执行可以看到主线程被blocked了正在等待。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/POPO20220118-144240.jpg\" alt=\"POPO20220118-144240.jpg\"></p>\n<p>回到图片框架上，MZAssetsLibrary在init后执行了<code>[PHPPhotoLibrary registerChangeObserver:]</code>，于是有理由怀疑是不是这一行代码相关的API执行了变动。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Untitled.png\" alt=\"Untitled\"></p>\n<p>在苹果开发者论坛找到了答案：</p>\n<p><a href=\"https://developer.apple.com/forums/thread/696131\">ios 15.2 beta app stuck</a></p>\n<p>在 iOS 15.2 之前使用<code>[PHPPhotoLibrary registerChangeObserver:]</code>通知不需要相册权限，然而在 iOS 15.2 之后 Apple 新增了应用隐私报告，添加了该方法的相册权限前提。</p>\n<hr>\n<p><strong>解决方案</strong>：先注册相册请求，在获取到权限之后针对可访问的相册权限注册该通知，如<code>PHAuthorizationStatusAuthorized</code>、<code>PHAuthorizationStatusLimited</code>，但是需要涉及到旧版本的权限兼容，于是引出了权限适配方案。</p>\n<h1 id=\"相册权限适配\"><a href=\"#相册权限适配\" class=\"headerlink\" title=\"相册权限适配\"></a>相册权限适配</h1><h2 id=\"简述\"><a href=\"#简述\" class=\"headerlink\" title=\"简述\"></a>简述</h2><p>在 iOS 13 及以前，当用户首次访问应用程序时，会被要求开放大量权限，比如相册、定位、联系人，实际上该应用可能仅仅需要一个选择图片功能，却被要求开放整个照片库的权限，这确实是不合理的。</p>\n<p>在 iOS 14 中引入了 “LimitedPhotos Library” 的概念，用户可以授予应用访问其一部分的照片，对于应用来说，仅能读取到用户选择让应用来读取的照片。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Xnip2022-01-06_21-34-51.jpg\" alt=\"Xnip2022-01-06_21-34-51.jpg\"></p>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 1.png)</p>\n<p>具体体现在</p>\n<ol>\n<li>授权弹窗中增加了 Select Photo 选项。用户可以在 App 请求调用相册时选择部分照片让 App 读取。从 App 的视⻆来看，你的相册里就只有这几张照片，App 无法得知其它照片的存在。</li>\n<li>当用户选择权限为<code>PHAuthorizationStatusLimited</code>如果未适配，可能会在每次触发相册功能时都弹窗询问用户是否需要修改照片权限。可通过在 Info.plist 设置<code>PHPhotoLibraryPreventAutomaticLimitedAccessAlert</code>为 <code>YES</code> 来阻止该弹窗反复弹出</li>\n</ol>\n<h2 id=\"API-改变\"><a href=\"#API-改变\" class=\"headerlink\" title=\"API 改变\"></a>API 改变</h2><p>从开发适配的角度，需要关注新的请求权限和请求权限的方法。</p>\n<p>列举出的请求权限共以下几种，其中<code>PHAuthorizationStatusLimited</code>的注释中给出了适配方法。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSInteger</span>, PHAuthorizationStatus) &#123;</span><br><span class=\"line\">    PHAuthorizationStatusNotDetermined = <span class=\"number\">0</span>, <span class=\"comment\">// User has not yet made a choice with regards to this application</span></span><br><span class=\"line\">    PHAuthorizationStatusRestricted,        <span class=\"comment\">// This application is not authorized to access photo data.</span></span><br><span class=\"line\">                                            <span class=\"comment\">// The user cannot change this application’s status, possibly due to active restrictions</span></span><br><span class=\"line\">                                            <span class=\"comment\">//   such as parental controls being in place.</span></span><br><span class=\"line\">    PHAuthorizationStatusDenied,            <span class=\"comment\">// User has explicitly denied this application access to photos data.</span></span><br><span class=\"line\">    PHAuthorizationStatusAuthorized,        <span class=\"comment\">// User has authorized this application to access photos data.</span></span><br><span class=\"line\">    PHAuthorizationStatusLimited API_AVAILABLE(ios(<span class=\"number\">14</span>)), <span class=\"comment\">// User has authorized this application for limited photo library access. Add PHPhotoLibraryPreventAutomaticLimitedAccessAlert = YES to the application&#x27;s Info.plist to prevent the automatic alert to update the users limited library selection. Use -[PHPhotoLibrary(PhotosUISupport) presentLimitedLibraryPickerFromViewController:] from PhotosUI/PHPhotoLibrary+PhotosUISupport.h to manually present the limited library picker.</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p>请求权限的方法也得到了更新，需要注意的是</p>\n<ul>\n<li>只有使用新的<code>requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel</code> 方法才能正确获取到  <code>PHAuthorizationStatusLimited</code> 权限</li>\n<li>如果使用以前的API来获取权限状态，<code>PHAuthorizationStatusLimited</code> 状态下返回<code>PHAuthorizationStatusAuthorized</code></li>\n<li>在请求权限的时候需要给予读写权限参数<code>PHAccessLevel</code>，可选值为<code>PHAccessLevelAddOnly</code> 与 <code>PHAccessLevelReadWrite</code>，仅在<code>PHAccessLevelReadWrite</code> 下才能够获取到<code>PHAuthorizationStatusLimited</code> 权限</li>\n</ul>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"meta-keyword\">pragma</span> mark - Library access authorization status</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Replaces \\c +authorizationStatus to support add-only/read-write access level status</span></span><br><span class=\"line\">+ (PHAuthorizationStatus)authorizationStatusForAccessLevel:(PHAccessLevel)accessLevel API_AVAILABLE(macosx(<span class=\"number\">11.0</span>), ios(<span class=\"number\">14</span>), tvos(<span class=\"number\">14</span>));</span><br><span class=\"line\">+ (<span class=\"keyword\">void</span>)requestAuthorizationForAccessLevel:(PHAccessLevel)accessLevel handler:(<span class=\"keyword\">void</span>(^)(PHAuthorizationStatus status))handler API_AVAILABLE(macosx(<span class=\"number\">11.0</span>), ios(<span class=\"number\">14</span>), tvos(<span class=\"number\">14</span>)) <span class=\"built_in\">NS_SWIFT_ASYNC</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Deprecated and replaced by authorizationStatusForAccessLevel:, will return \\c PHAuthorizationStatusAuthorized if the user has chosen limited photo library access</span></span><br><span class=\"line\">+ (PHAuthorizationStatus)authorizationStatus API_DEPRECATED_WITH_REPLACEMENT(<span class=\"string\">&quot;+authorizationStatusForAccessLevel:&quot;</span>, ios(<span class=\"number\">8</span>, API_TO_BE_DEPRECATED), macos(<span class=\"number\">10.13</span>, API_TO_BE_DEPRECATED), tvos(<span class=\"number\">10</span>, API_TO_BE_DEPRECATED));</span><br><span class=\"line\">+ (<span class=\"keyword\">void</span>)requestAuthorization:(<span class=\"keyword\">void</span>(^)(PHAuthorizationStatus status))handler API_DEPRECATED_WITH_REPLACEMENT(<span class=\"string\">&quot;+requestAuthorizationForAccessLevel:handler:&quot;</span>, ios(<span class=\"number\">8</span>, API_TO_BE_DEPRECATED), macos(<span class=\"number\">10.13</span>, API_TO_BE_DEPRECATED), tvos(<span class=\"number\">10</span>, API_TO_BE_DEPRECATED));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"built_in\">NS_ENUM</span>(<span class=\"built_in\">NSInteger</span>, PHAccessLevel) &#123;</span><br><span class=\"line\">    PHAccessLevelAddOnly = <span class=\"number\">1</span>,</span><br><span class=\"line\">    PHAccessLevelReadWrite = <span class=\"number\">2</span>,</span><br><span class=\"line\">&#125; API_AVAILABLE(macos(<span class=\"number\">11.0</span>), ios(<span class=\"number\">14</span>), tvos(<span class=\"number\">14</span>));</span><br></pre></td></tr></table></figure>\n\n<p>针对业务需求对代码进行了部分重构，原代码采用if-else结构进行控制，还需要判断iOS版本结构会过于混乱。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">void</span> (^setUpUI)(PHAuthorizationStatus status) = ^(PHAuthorizationStatus status)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">switch</span> (status) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusNotDetermined: &#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusAuthorized:</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusLimited: &#123;</span><br><span class=\"line\">                    [<span class=\"keyword\">self</span>.library registerChangeObserver:<span class=\"keyword\">self</span>];</span><br><span class=\"line\">                    loadCollections();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusDenied:</span><br><span class=\"line\">                <span class=\"keyword\">case</span> PHAuthorizationStatusRestricted: &#123;</span><br><span class=\"line\">                    notAllowed();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">default</span>: &#123;</span><br><span class=\"line\">                    notAllowed();</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">if</span> (status == PHAuthorizationStatusNotDetermined) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (@available(iOS <span class=\"number\">14</span>, *)) &#123;</span><br><span class=\"line\">                [PHPhotoLibrary requestAuthorizationForAccessLevel:PHAccessLevelReadWrite handler:^(PHAuthorizationStatus status) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">                        setUpUI(status);</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;];</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                [PHPhotoLibrary requestAuthorization:^(PHAuthorizationStatus status) &#123;</span><br><span class=\"line\">                    <span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">                        setUpUI(status);</span><br><span class=\"line\">                    &#125;);</span><br><span class=\"line\">                &#125;];</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            setUpUI(status);</span><br><span class=\"line\">        &#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 2.png)</p>\n<p>若要在应用内唤起访问系统受限相册的选择面板需要调用以下API，并且监听图片变化做相应处理。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)presentLimitedLibraryPickerFromViewController:(<span class=\"built_in\">UIViewController</span> *)controller;</span><br></pre></td></tr></table></figure>\n\n<p>在 iOS 15 中还针对以上API提供了回调。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- (<span class=\"keyword\">void</span>)presentLimitedLibraryPickerFromViewController:(<span class=\"built_in\">UIViewController</span> *)controller </span><br><span class=\"line\">                                    completionHandler:(<span class=\"keyword\">void</span> (^)(<span class=\"built_in\">NSArray</span>&lt;<span class=\"built_in\">NSString</span> *&gt; *))completionHandler;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"视觉适配\"><a href=\"#视觉适配\" class=\"headerlink\" title=\"视觉适配\"></a>视觉适配</h2><p>找视觉沟通前研究了微信和微博如何做适配，可以说微博的适配方案加上了引导体验更加完整。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg\" alt=\"6ce25100-2cea-41de-8867-04ff5aa4acf4.jpg\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/e9aab135-4eb6-489b-af70-3d1664354d2f.jpg\" alt=\"e9aab135-4eb6-489b-af70-3d1664354d2f.jpg\"></p>\n<p>目前音街相册实现效果如下图所示。</p>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 3.png)</p>\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 4.png)</p>\n<h1 id=\"照片选择器\"><a href=\"#照片选择器\" class=\"headerlink\" title=\"照片选择器\"></a>照片选择器</h1><p>在 iOS 14 中官方推荐使用 <code>PhotosUI</code> 框架下的 <code>PHPicker</code> 来替代 <code>UIImagePickerController</code> 进行图片选择。</p>\n<p><code>PHPicker</code> 为独立进程，会在视图最顶层进行展示，应用内无法对其进行截图也无法直接访问到其内的数据，同时在功能上支持多选，支持搜索，支持按图片、视频、LivePhotos进行筛选</p>\n<p><code>UIImagePickerViewController</code> 功能受限，每次只能选择一张图片，将逐渐被废弃，同时<code>UIImagePickerController</code> 中三个 <code>sourceType</code>两个被废弃，只留下 <code>camera</code>。</p>\n<h2 id=\"功能一览\"><a href=\"#功能一览\" class=\"headerlink\" title=\"功能一览\"></a>功能一览</h2><ul>\n<li>支持缩放  <img src=\"http://image.stephenfang.me/mweb/IMG_9246.png\" alt=\"IMG_9246.PNG\"></li>\n<li>支持搜索  <img src=\"http://image.stephenfang.me/mweb/IMG_9248.png\" alt=\"IMG_9248.PNG\"></li>\n<li>支持分类  <img src=\"http://image.stephenfang.me/mweb/IMG_9247.png\" alt=\"IMG_9247.PNG\"></li>\n</ul>\n<h2 id=\"调用方法\"><a href=\"#调用方法\" class=\"headerlink\" title=\"调用方法\"></a>调用方法</h2><p>在调用方法上，需要首先声明 <code>PHPickerConfiguration</code> 并进行配置，再将其传递给<code>PHPickerViewController</code> 完成调用。</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PHPickerConfiguration *config = [[PHPickerConfiguration alloc] init];</span><br><span class=\"line\">config.selectionLimit = <span class=\"number\">3</span>;  <span class=\"comment\">// 可选择的资源数量，0表示不设限制，默认为1</span></span><br><span class=\"line\">config.filter = [PHPickerFilter imagesFilter]; <span class=\"comment\">// 只显示图片，默认全选，可选择imagesFilter、livePhotosFilter、videosFilter</span></span><br><span class=\"line\">config.preferredAssetRepresentationMode = PHPickerConfigurationAssetRepresentationModeCurrent; <span class=\"comment\">// 如果要获取视频最好设置该属性，避免系统对视频进行转码</span></span><br><span class=\"line\"></span><br><span class=\"line\">PHPickerViewController *pickerViewController = [[PHPickerViewController alloc] initWithConfiguration:config];</span><br><span class=\"line\">pickerViewController.delegate = <span class=\"keyword\">self</span>;</span><br><span class=\"line\">[<span class=\"keyword\">self</span> presentViewController:pickerViewController animated:<span class=\"literal\">YES</span> completion:<span class=\"literal\">nil</span>];</span><br></pre></td></tr></table></figure>\n\n<p>![Untitled](<a href=\"http://image.stephenfang.me/mweb/Untitled\">http://image.stephenfang.me/mweb/Untitled</a> 5.png)</p>\n<hr>\n<p><code>PHPickerConfiguration</code>、<code>PHPickerFilter</code> 和 <code>PHPickerResult</code> 都是作为结构体而不是作为类桥接到 Swift 中，从<code>PHPickerViewController</code> 返回使用<code>NSItemProvider</code>,与 <code>UIImagePickerController</code> 不同</p>\n<figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">-(<span class=\"keyword\">void</span>)picker:(PHPickerViewController *)picker didFinishPicking:(<span class=\"built_in\">NSArray</span>&lt;PHPickerResult *&gt; *)results&#123;</span><br><span class=\"line\">   [picker dismissViewControllerAnimated:<span class=\"literal\">YES</span> completion:<span class=\"literal\">nil</span>];</span><br><span class=\"line\">    </span><br><span class=\"line\">   <span class=\"keyword\">for</span> (PHPickerResult *result <span class=\"keyword\">in</span> results) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// Get UIImage</span></span><br><span class=\"line\">      [result.itemProvider loadObjectOfClass:[<span class=\"built_in\">UIImage</span> <span class=\"keyword\">class</span>] completionHandler:^(__kindof <span class=\"keyword\">id</span>&lt;<span class=\"built_in\">NSItemProviderReading</span>&gt;  _Nullable object, <span class=\"built_in\">NSError</span> * _Nullable error) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> ([object isKindOfClass:[<span class=\"built_in\">UIImage</span> <span class=\"keyword\">class</span>]]) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class=\"line\">               <span class=\"built_in\">NSLog</span>(<span class=\"string\">@&quot;Selected image: %@&quot;</span>, (<span class=\"built_in\">UIImage</span>*)object);</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">      &#125;];</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"存在问题\"><a href=\"#存在问题\" class=\"headerlink\" title=\"存在问题\"></a>存在问题</h2><ul>\n<li>加载 iCloud 资源时没有进度回调</li>\n<li>不支持图片编辑（比如选择头像要将图片裁剪成圆形）</li>\n</ul>\n<h1 id=\"引用\"><a href=\"#引用\" class=\"headerlink\" title=\"引用\"></a>引用</h1><p><a href=\"https://developer.apple.com/videos/play/wwdc2020/10641\">Handle the Limited Photos Library in your app</a> </p>\n<p><a href=\"https://developer.apple.com/videos/play/wwdc2020/10652/?time=841\">Meet the new Photos picker</a></p>\n<p><a href=\"https://developer.apple.com/documentation/photokit/delivering_an_enhanced_privacy_experience_in_your_photos_app?language=objc\">Delivering an Enhanced Privacy Experience in Your Photos App</a></p>\n<p><a href=\"https://www.appcoda.com/phpicker/\">The Complete Guide to PHPicker API in iOS 14</a></p>\n<p><a href=\"https://developer.aliyun.com/article/768114\">新零售淘系技术 - iOS14 隐私适配及部分解决方案</a></p>\n<p><a href=\"https://juejin.cn/post/6881513652176814093\">RayJiang97-为什么不推荐使用 PHPicker</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/POPO20220118-144240.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:18:13 GMT+0800 (中国标准时间)","title":"iOS14 & iOS 15 相册适配","path":"2022/01/20/Photo_Library/","eyeCatchImage":"http://image.stephenfang.me/mweb/POPO20220118-144240.jpg","excerpt":"<p>开发迭代为了解决测试提出的「选中的照片」权限适配问题，花时间研究了<a href=\"https://developer.apple.com/videos/play/wwdc2020/10641\">Handle the Limited Photos Library in your app</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2020/10652/?time=841\">Meet the new Photos picker</a> session，整理<a href=\"http://music-overmind.hz.netease.com/18/requirement/issues/OMMUSIC-77674\">需求内容</a>汇总并实现，同时还解决了一处 iOS 15.2 下可能导致崩溃的相册权限问题。</p>","date":{"_isAMomentObject":true,"_i":"2022-01-20T09:10:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-01-20T09:10:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","Swift","Objective-C","Photo","iOS 15","iOS 14"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":7392},{"title":"Struts 2 基础应用实验","date":"2020-02-23T10:10:20.000Z","_content":"\n包含Struts 2知识梳理、实验总结、实验步骤三方面的总结。\n<!--more-->\n## 知识梳理\n\n1、Struts2 是从 WebWork 框架上发展起来的 MVC 框架； \n\n2、FilterDispatcher 是 Struts2 中的核心控制器，客户端对服务器端的请求将被 FilterDispatcher 过滤；若请求需要调用某个 Action，则框架将根据配置文件`struts.xml`，找到需要调用的 Action 类； \n\n3、Action 类是一个符合一定命名规范的 JavaSE 类，作为业务控制器使用； Action \n中的 execute()方法用于调用 Model 层的业务逻辑类，并根据返回结果决定页面导航； \n\n4、若 Action 类中需要使用表单提交的请求参数，那么必须在 Action 类中声明与 \n表单域的名字对应的变量，并为变量提供 getters/setters 方法； \n\n5、Action 类需要在 `struts.xml` 中进行配置才能使用； \n\n6、编译运行基于 Struts2 框架的 Web 工程，需要导入 struts2 的 8 个核心 jar 包： \n\n| 文件名                     | 说明                                 |\n| -------------------------- | ------------------------------------ |\n| struts2-core-2.3.15.1.jar  | Struts 2 框架的核心类库              |\n| xwork-core-2.3.15.1.jar    | XWork 类库，Struts 2 的构建基础      |\n| Ognl-3.0.6.jar             | Struts 2 使用的一种表达式语言类库    |\n| freemarker-2.3.19.jar      | Struts 2 的标签模板使用类库          |\n| javassist-3.11.0.GA.jar    | 代码生成工具包                       |\n| commons-lang3-3.1.jar      | Apache 语言包，是 java.lang 包的扩展 |\n| commons-io-2.0.1.jar       | Apache IO 包                         |\n| commons-fileupload-1.3.jar | Struts 2 文件上传依赖包              |\n\n7、使用 Struts2 标签的形式来表达页面逻辑，可以尽量避免在视图中使用 Java 代码，让逻辑与显示分离，提高视图的可维护性； \n\n8、Struts2 标签库的主要 tld 文件为 `struts-tags.tld`， 在 `struts2-core-2.3.15.1.jar` 包中， 另一个与 Ajax 相关的标签库 tld 文件为 `struts-dojo-tags.tld`，在 `struts2-dojo -plugin-2.3.15.1.jar` 包中； \n\n9、Struts2 标签的使用步骤和使用 JSTL 相同，只需在 JSP 页面中使用 taglib 指令 引入标签库中 tld 文件的 uri， 并指定前缀即可，例如： `<%@ taglib prefix=\"s\" uri=\"/struts-tags\"%>`； \n\n10、根据 Struts2 标签的主要作用，可以将其分为：用于生成页面元素的 UI 标签、 用于实现流程控制的控制类标签、用于控制数据的数据标签和用于支持Ajax的标签。\n\n11、通过将不同语言版本的字符保存在属性文件中，Struts2 的国际化机制能够在不需要修改程序主体的前提下，实现不同语言版本的应用； \n\n12、在 Web 应用中选择需要进行国际化的内容，不在页面中直接输出该信息，而是通过 Struts2 标签输出一个键值，该键值在不同语言环境下对应不同的字符串；如：`<s:textfield name=\"loginUser.account\" lable=\"请输入用户名\"/>`代码中的“请输入用户名”是需要国际化的内容,将其以键值代替为`<s:textfield name=\"loginUser.account\" key=\"login.account.lable\"/>` \n\n13、需要进行国际化的内容以键值对（key=value） 的形式写入 Struts2 的国际化资源文件中，如`login.account.lable=请输入用户名”；`该资源文件名可以自定义，但是后缀必须是 properties；资源文件应放在 Web 应用的类加载路径下； 每一个语言版本需要创建一个资源文件； \n\n14、通过 Struts2 的配置文件 `struts.properties` 来配置资源文件的基础名，若资源文 件的基础名为 message，则 `message_zh_CN.properties` 是对应的中文资源文件， `message_en_US.properties` 是对应的美国英语资源文件； \n\n15、浏览器将根据其默认的语言版本，自动调用相应语言的资源文件，从而在页面中展示不同的语言效果。\n\n## 实验总结\n1、实验中各个文件的作用：\n\n(1)jsp页面：负责展示视图\n\n(2)Action类：负责处理业务逻辑\n\n(3)Service类：用于实现登录逻辑\n\n(4)JavaBean：用于定义用户信息\n\n(5)Filter：起中央控制器作用的过滤器\n\n(6)struts.xml：核心配置文件\n\n2、Struts2 应用中从请求到响应的完整流程\n\n客户端首先向Action发送一个请求Request,Container通过`web.xml`映射请求，并获得Controller的名字；Container调用控制StrutsPrepareAndExecuteFilter；Controller通过ActionMapper获得Action的信息，调用ActionProxy；ActionProxy读取`struts.xml`文件获取action和interceptor stack的信息，把request请求传递给ActionInvocation；ActionInvocation依次调用action和interceptor；根据action的配置信息，产生result，Result信息返回给ActionInvocation，产生一个HttpServletResponse响应，产生的响应行为发送给客户端。\n\n3、MVC框架体现：\n\nModel：JavaBean、Action类\n\nView：JSP页面\n\nController：FilterDispatcher\n\n4、表单参数与 Action 属性的赋值关系\n\n表单元素的action属性值对应了action的name属性值，Action只是一个逻辑控制器，他不直接对请求者生成任何响应，而是通过result子元素将指定的返回值呈现给客户端，如返回字符串为success则跳转至loginSuccess.jsp页面.\n\n5、Action 的 execute() 方法的作用和特点\n\n作用：处理业务逻辑\n\n特点：无参数；不需要实现或者继承任何接口或者父类；execute方法一定要返回String类型的对象,每一个字符串都可以对应一个跳转的页面。\n\n6、struts.xml 里各元素及其属性的作用\n\n(1)package：管理Action、拦截器等核心组件。包含作为包名的name属性、用于继承的extends属性、用于设置命名空间的namespace属性、设置为抽象包的abstract属性。\n\n(2)action元素：定义与Action操作有关的一系列配置信息。包含作为Action名的name属性、具体处理请求类的class属性、指定调用Action中放发明的method属性、指定使用Action类型转换器converter属性。\n\n(3)result元素：将Action类返回的字符串转发给对应的是图，实现逻辑视图和物理视图资源的映射。包含制定配置逻辑视图名的name属性、指定结果类型的type属性。\n\n(4)constant元素：改变Struts2的一些默认行为。包含指定框架功能的name属性、与name配合使用的value属性。\n\n(5)interceptors元素：定义拦截器集合的元素\n\n(6)interceptor元素：用于配置拦截器。包含指定拦截器逻辑名称的name属性和指定具体处理拦截类的class属性。\n\n(7)interceptors-ref元素：在某个action中引用拦截器。\n\n(8)interceptors-stack元素：定义拦截器栈\n\n7、Struts2 中标签及其属性的作用和用法：\n\n(1)form标签：生成表单元素。包含提交Action名字的action属性、命名空间namespace属性、定义GET/POST的method属性等\n\n(2)textfield标签：用来输入一小段文字。包含定义可输入最大长度值的maxlength属性、定义字段尺寸size属性、用于标示元素的id属性等\n\n(3)password标签：默认不显示输入内容的textfield。包含确定是否显示内容的showPassword属性、字段最大长度maxlength属性、定义字段尺寸size属性等\n\n(4)if/elseif/else标签：通过逻辑值控制流程。包含决定标签内容是否显示的test属性、标示元素id的id属性。\n\n(5)iterator标签：用于遍历集合元素。包含产生IteratorStatus对象实例的status属性、标示元素id的id属性等\n\n8、配置文件 `struts.properties` 的作用\n\n定义了Struts 2框架的大量属性，开发者可以通过改变这些属性来满足应用的需求。其中`struts.configuration`属性指定加载Struts 2配置文件的配置文件管理器。struts.locale属性指定Web应用的默认`Locale。struts.i18n.encoding`指定Web应用的默认编码集。\n\n## 实验步骤\n### 基础实验\n\n1、登录 http://struts.apache.org/download.cgi 站点，下载 Struts2 的最新版（Full Distribution）； \n\n2、新建 Web 工程 struts-prj1； \n\n3、将 Struts2 中的 8 个核心包增加到 Web 应用中，即复制到“%workspace% \nstruts-prj1\\WebContent\\WEB-INF\\lib”路径下； \n\n4、在 struts-prj1 中新建 login.jsp 页面，作为用户登录的视图（代码片段如下）， 注意表单（form）中 action 属性的值，注意用户名与密码输入框中 name 属性的值； \n\n5、在 struts-prj1 中新建 loginSuccess.jsp 和 loginFail.jsp 页面，分别作为登录成功 或登录失败的视图，在页面中显示“登录成功”或“登录失败”；\n\n![](http://image.stephenfang.me/mweb/1.png)\n \n6、在 struts-prj1 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于记录登录用户信息，注意该 JavaBean 中属性名的写法； \n\n![](http://image.stephenfang.me/mweb/2.png)\n \n7、在 struts-prj1 中新建 cn.edu.zjut.service 包，并在其中创建 UserService.java， 用于实现登录逻辑，为简化登录逻辑，将登录成功的条件设置为：用户名和密码相同\n\n![](http://image.stephenfang.me/mweb/3.png)\n \n8、在 struts-prj1 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，调 用登录逻辑，并根据登录结果不同而返回不同的内容，注意该 Action 中的属性名及相应的 getters 和 setters 方法、execute()方法及返回值；  \n\n![](http://image.stephenfang.me/mweb/4.png)\n\n9、在工程 struts-prj1 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，注意 action 标签中 name 属性和 class 属性的值， 以及 result 子标签的属性； \n\n![](http://image.stephenfang.me/mweb/5.png)\n \n10、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； \n\n![](http://image.stephenfang.me/mweb/6.png)\n \n11、将 struts-prj1 部署在 Tomcat 服务器上； \n\n12、通过浏览器访问 login.jsp 页面，并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/7.png)\n\n### 提高实验\n\n1、为能使用与 Ajax 相关的标签，将 Struts2 中的 `struts2-dojo-plugin-2.3.15.1.jar` 包增加到工程 struts-prj1 中，即复制到`%workspace%struts-prj1\\WebContent\\ WEB-INF\\lib`路径下，刷新工程； \n\n![](http://image.stephenfang.me/mweb/8.png)\n\n2、在工程 struts-prj1 中增加用户注册功能，新建 register.jsp 页面作为用户注册的 视图，页面使用 Struts2 的 UI 标签来生成表单元素，包括用户名、密码、确认密码、真实姓名、性别、生日、联系地址、联系电话和电子邮箱 \n\n![](http://image.stephenfang.me/mweb/9.png)\n\n3、在 struts-prj1 中新建 `regFail.jsp` 页面，作为注册失败的视图，在页面中显示“注册失败”； \n\n4、在 struts-prj1 中新建 `regSuccess.jsp` 页面，作为注册成功的视图，使用 Struts2 的数据标签和控制标签来生成注册成功的信息，并将登录用户信息保存在会话范围内 \n\n5、修改 `UserBean.java`，增加属性用于记录注册用户信息 \n\n![](http://image.stephenfang.me/mweb/10.png)\n \n6、修改 `UserService.java`，增加用户注册逻辑，为简化注册逻辑，将注册成功的条件设置为：用户名、密码和确认密码相同，而且不为空字串； \n\n![](http://image.stephenfang.me/mweb/11.png)\n \n7、修改 `UserAction.java` 中的 execute()方法，参照基础实验部分写入代码，用于调用注册逻辑，并根据注册成功与否而返回不同的内容； \n\n![](http://image.stephenfang.me/mweb/12.png)\n \n8、修改 `struts.xml` 文件，对用户注册进行配置并设置页面导航； \n\n![](http://image.stephenfang.me/mweb/13.png)\n \n9、将 struts-prj1 重新布署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页面， 并记录运行结果； \n\n![](http://image.stephenfang.me/mweb/14.png)\n\n### 拓展实验\n\n1、在工程 struts-prj1 的 src 目录下新建一个 `cn.edu.zjut.local` 包，把所有的资源文件放置其中，如：`message_zh_CN.properties`、`message_en_US.properties` 等； \n\n![](http://image.stephenfang.me/mweb/15.png)\n  \n2、将工程 struts-prj1 中用户登录模块的三个 JSP 页面进行国际化处理，选择需要进行国际化的内容，以键值对的形式写入资源文件中 \n\n3、使用 JDK 中的 native2ASCII 工具，将 `message_zh_CN.properties` 重新编码，将中文字符都转化为 unicode 码，从而避免乱码问题； \n\n4、在工程 struts-prj1 的 src 目录中创建 `struts.properties` 文件，通过它加载资源文件,或者在JSP页面中临时加载资源文件  \n\n![](http://image.stephenfang.me/mweb/16.png)\n\n5、修改 `login.jsp`、`loginSuccess.jsp` 和 `loginFail.jsp` 页面，通过 Struts2 标签实现国际化； \n\n6、将 struts-prj1 重新布署在 Tomcat 服务器上； \n\n7、设置浏览器的首语言选项（如下图所示），通过浏览器访问 `login.jsp` 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/17.png)\n \n8、尝试修改用户注册模块，实现国际化，并记录运行结果。 \n\n![](http://image.stephenfang.me/mweb/18.png)\n\n![](http://image.stephenfang.me/mweb/19.png)\n\n> 注册中文页面\n\n![](http://image.stephenfang.me/mweb/20.png)\n\n> 注册英文页面","source":"_posts/Struts_Experiment.md","raw":"---\ntitle: Struts 2 基础应用实验\ndate: 2020-02-23 18:10:20\ncategories: \n- 技术\ntags: \n- struts\n- JavaEE\n- 总结\n- 实验\n---\n\n包含Struts 2知识梳理、实验总结、实验步骤三方面的总结。\n<!--more-->\n## 知识梳理\n\n1、Struts2 是从 WebWork 框架上发展起来的 MVC 框架； \n\n2、FilterDispatcher 是 Struts2 中的核心控制器，客户端对服务器端的请求将被 FilterDispatcher 过滤；若请求需要调用某个 Action，则框架将根据配置文件`struts.xml`，找到需要调用的 Action 类； \n\n3、Action 类是一个符合一定命名规范的 JavaSE 类，作为业务控制器使用； Action \n中的 execute()方法用于调用 Model 层的业务逻辑类，并根据返回结果决定页面导航； \n\n4、若 Action 类中需要使用表单提交的请求参数，那么必须在 Action 类中声明与 \n表单域的名字对应的变量，并为变量提供 getters/setters 方法； \n\n5、Action 类需要在 `struts.xml` 中进行配置才能使用； \n\n6、编译运行基于 Struts2 框架的 Web 工程，需要导入 struts2 的 8 个核心 jar 包： \n\n| 文件名                     | 说明                                 |\n| -------------------------- | ------------------------------------ |\n| struts2-core-2.3.15.1.jar  | Struts 2 框架的核心类库              |\n| xwork-core-2.3.15.1.jar    | XWork 类库，Struts 2 的构建基础      |\n| Ognl-3.0.6.jar             | Struts 2 使用的一种表达式语言类库    |\n| freemarker-2.3.19.jar      | Struts 2 的标签模板使用类库          |\n| javassist-3.11.0.GA.jar    | 代码生成工具包                       |\n| commons-lang3-3.1.jar      | Apache 语言包，是 java.lang 包的扩展 |\n| commons-io-2.0.1.jar       | Apache IO 包                         |\n| commons-fileupload-1.3.jar | Struts 2 文件上传依赖包              |\n\n7、使用 Struts2 标签的形式来表达页面逻辑，可以尽量避免在视图中使用 Java 代码，让逻辑与显示分离，提高视图的可维护性； \n\n8、Struts2 标签库的主要 tld 文件为 `struts-tags.tld`， 在 `struts2-core-2.3.15.1.jar` 包中， 另一个与 Ajax 相关的标签库 tld 文件为 `struts-dojo-tags.tld`，在 `struts2-dojo -plugin-2.3.15.1.jar` 包中； \n\n9、Struts2 标签的使用步骤和使用 JSTL 相同，只需在 JSP 页面中使用 taglib 指令 引入标签库中 tld 文件的 uri， 并指定前缀即可，例如： `<%@ taglib prefix=\"s\" uri=\"/struts-tags\"%>`； \n\n10、根据 Struts2 标签的主要作用，可以将其分为：用于生成页面元素的 UI 标签、 用于实现流程控制的控制类标签、用于控制数据的数据标签和用于支持Ajax的标签。\n\n11、通过将不同语言版本的字符保存在属性文件中，Struts2 的国际化机制能够在不需要修改程序主体的前提下，实现不同语言版本的应用； \n\n12、在 Web 应用中选择需要进行国际化的内容，不在页面中直接输出该信息，而是通过 Struts2 标签输出一个键值，该键值在不同语言环境下对应不同的字符串；如：`<s:textfield name=\"loginUser.account\" lable=\"请输入用户名\"/>`代码中的“请输入用户名”是需要国际化的内容,将其以键值代替为`<s:textfield name=\"loginUser.account\" key=\"login.account.lable\"/>` \n\n13、需要进行国际化的内容以键值对（key=value） 的形式写入 Struts2 的国际化资源文件中，如`login.account.lable=请输入用户名”；`该资源文件名可以自定义，但是后缀必须是 properties；资源文件应放在 Web 应用的类加载路径下； 每一个语言版本需要创建一个资源文件； \n\n14、通过 Struts2 的配置文件 `struts.properties` 来配置资源文件的基础名，若资源文 件的基础名为 message，则 `message_zh_CN.properties` 是对应的中文资源文件， `message_en_US.properties` 是对应的美国英语资源文件； \n\n15、浏览器将根据其默认的语言版本，自动调用相应语言的资源文件，从而在页面中展示不同的语言效果。\n\n## 实验总结\n1、实验中各个文件的作用：\n\n(1)jsp页面：负责展示视图\n\n(2)Action类：负责处理业务逻辑\n\n(3)Service类：用于实现登录逻辑\n\n(4)JavaBean：用于定义用户信息\n\n(5)Filter：起中央控制器作用的过滤器\n\n(6)struts.xml：核心配置文件\n\n2、Struts2 应用中从请求到响应的完整流程\n\n客户端首先向Action发送一个请求Request,Container通过`web.xml`映射请求，并获得Controller的名字；Container调用控制StrutsPrepareAndExecuteFilter；Controller通过ActionMapper获得Action的信息，调用ActionProxy；ActionProxy读取`struts.xml`文件获取action和interceptor stack的信息，把request请求传递给ActionInvocation；ActionInvocation依次调用action和interceptor；根据action的配置信息，产生result，Result信息返回给ActionInvocation，产生一个HttpServletResponse响应，产生的响应行为发送给客户端。\n\n3、MVC框架体现：\n\nModel：JavaBean、Action类\n\nView：JSP页面\n\nController：FilterDispatcher\n\n4、表单参数与 Action 属性的赋值关系\n\n表单元素的action属性值对应了action的name属性值，Action只是一个逻辑控制器，他不直接对请求者生成任何响应，而是通过result子元素将指定的返回值呈现给客户端，如返回字符串为success则跳转至loginSuccess.jsp页面.\n\n5、Action 的 execute() 方法的作用和特点\n\n作用：处理业务逻辑\n\n特点：无参数；不需要实现或者继承任何接口或者父类；execute方法一定要返回String类型的对象,每一个字符串都可以对应一个跳转的页面。\n\n6、struts.xml 里各元素及其属性的作用\n\n(1)package：管理Action、拦截器等核心组件。包含作为包名的name属性、用于继承的extends属性、用于设置命名空间的namespace属性、设置为抽象包的abstract属性。\n\n(2)action元素：定义与Action操作有关的一系列配置信息。包含作为Action名的name属性、具体处理请求类的class属性、指定调用Action中放发明的method属性、指定使用Action类型转换器converter属性。\n\n(3)result元素：将Action类返回的字符串转发给对应的是图，实现逻辑视图和物理视图资源的映射。包含制定配置逻辑视图名的name属性、指定结果类型的type属性。\n\n(4)constant元素：改变Struts2的一些默认行为。包含指定框架功能的name属性、与name配合使用的value属性。\n\n(5)interceptors元素：定义拦截器集合的元素\n\n(6)interceptor元素：用于配置拦截器。包含指定拦截器逻辑名称的name属性和指定具体处理拦截类的class属性。\n\n(7)interceptors-ref元素：在某个action中引用拦截器。\n\n(8)interceptors-stack元素：定义拦截器栈\n\n7、Struts2 中标签及其属性的作用和用法：\n\n(1)form标签：生成表单元素。包含提交Action名字的action属性、命名空间namespace属性、定义GET/POST的method属性等\n\n(2)textfield标签：用来输入一小段文字。包含定义可输入最大长度值的maxlength属性、定义字段尺寸size属性、用于标示元素的id属性等\n\n(3)password标签：默认不显示输入内容的textfield。包含确定是否显示内容的showPassword属性、字段最大长度maxlength属性、定义字段尺寸size属性等\n\n(4)if/elseif/else标签：通过逻辑值控制流程。包含决定标签内容是否显示的test属性、标示元素id的id属性。\n\n(5)iterator标签：用于遍历集合元素。包含产生IteratorStatus对象实例的status属性、标示元素id的id属性等\n\n8、配置文件 `struts.properties` 的作用\n\n定义了Struts 2框架的大量属性，开发者可以通过改变这些属性来满足应用的需求。其中`struts.configuration`属性指定加载Struts 2配置文件的配置文件管理器。struts.locale属性指定Web应用的默认`Locale。struts.i18n.encoding`指定Web应用的默认编码集。\n\n## 实验步骤\n### 基础实验\n\n1、登录 http://struts.apache.org/download.cgi 站点，下载 Struts2 的最新版（Full Distribution）； \n\n2、新建 Web 工程 struts-prj1； \n\n3、将 Struts2 中的 8 个核心包增加到 Web 应用中，即复制到“%workspace% \nstruts-prj1\\WebContent\\WEB-INF\\lib”路径下； \n\n4、在 struts-prj1 中新建 login.jsp 页面，作为用户登录的视图（代码片段如下）， 注意表单（form）中 action 属性的值，注意用户名与密码输入框中 name 属性的值； \n\n5、在 struts-prj1 中新建 loginSuccess.jsp 和 loginFail.jsp 页面，分别作为登录成功 或登录失败的视图，在页面中显示“登录成功”或“登录失败”；\n\n![](http://image.stephenfang.me/mweb/1.png)\n \n6、在 struts-prj1 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于记录登录用户信息，注意该 JavaBean 中属性名的写法； \n\n![](http://image.stephenfang.me/mweb/2.png)\n \n7、在 struts-prj1 中新建 cn.edu.zjut.service 包，并在其中创建 UserService.java， 用于实现登录逻辑，为简化登录逻辑，将登录成功的条件设置为：用户名和密码相同\n\n![](http://image.stephenfang.me/mweb/3.png)\n \n8、在 struts-prj1 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，调 用登录逻辑，并根据登录结果不同而返回不同的内容，注意该 Action 中的属性名及相应的 getters 和 setters 方法、execute()方法及返回值；  \n\n![](http://image.stephenfang.me/mweb/4.png)\n\n9、在工程 struts-prj1 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，注意 action 标签中 name 属性和 class 属性的值， 以及 result 子标签的属性； \n\n![](http://image.stephenfang.me/mweb/5.png)\n \n10、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； \n\n![](http://image.stephenfang.me/mweb/6.png)\n \n11、将 struts-prj1 部署在 Tomcat 服务器上； \n\n12、通过浏览器访问 login.jsp 页面，并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/7.png)\n\n### 提高实验\n\n1、为能使用与 Ajax 相关的标签，将 Struts2 中的 `struts2-dojo-plugin-2.3.15.1.jar` 包增加到工程 struts-prj1 中，即复制到`%workspace%struts-prj1\\WebContent\\ WEB-INF\\lib`路径下，刷新工程； \n\n![](http://image.stephenfang.me/mweb/8.png)\n\n2、在工程 struts-prj1 中增加用户注册功能，新建 register.jsp 页面作为用户注册的 视图，页面使用 Struts2 的 UI 标签来生成表单元素，包括用户名、密码、确认密码、真实姓名、性别、生日、联系地址、联系电话和电子邮箱 \n\n![](http://image.stephenfang.me/mweb/9.png)\n\n3、在 struts-prj1 中新建 `regFail.jsp` 页面，作为注册失败的视图，在页面中显示“注册失败”； \n\n4、在 struts-prj1 中新建 `regSuccess.jsp` 页面，作为注册成功的视图，使用 Struts2 的数据标签和控制标签来生成注册成功的信息，并将登录用户信息保存在会话范围内 \n\n5、修改 `UserBean.java`，增加属性用于记录注册用户信息 \n\n![](http://image.stephenfang.me/mweb/10.png)\n \n6、修改 `UserService.java`，增加用户注册逻辑，为简化注册逻辑，将注册成功的条件设置为：用户名、密码和确认密码相同，而且不为空字串； \n\n![](http://image.stephenfang.me/mweb/11.png)\n \n7、修改 `UserAction.java` 中的 execute()方法，参照基础实验部分写入代码，用于调用注册逻辑，并根据注册成功与否而返回不同的内容； \n\n![](http://image.stephenfang.me/mweb/12.png)\n \n8、修改 `struts.xml` 文件，对用户注册进行配置并设置页面导航； \n\n![](http://image.stephenfang.me/mweb/13.png)\n \n9、将 struts-prj1 重新布署在 Tomcat 服务器上，通过浏览器访问 `register.jsp` 页面， 并记录运行结果； \n\n![](http://image.stephenfang.me/mweb/14.png)\n\n### 拓展实验\n\n1、在工程 struts-prj1 的 src 目录下新建一个 `cn.edu.zjut.local` 包，把所有的资源文件放置其中，如：`message_zh_CN.properties`、`message_en_US.properties` 等； \n\n![](http://image.stephenfang.me/mweb/15.png)\n  \n2、将工程 struts-prj1 中用户登录模块的三个 JSP 页面进行国际化处理，选择需要进行国际化的内容，以键值对的形式写入资源文件中 \n\n3、使用 JDK 中的 native2ASCII 工具，将 `message_zh_CN.properties` 重新编码，将中文字符都转化为 unicode 码，从而避免乱码问题； \n\n4、在工程 struts-prj1 的 src 目录中创建 `struts.properties` 文件，通过它加载资源文件,或者在JSP页面中临时加载资源文件  \n\n![](http://image.stephenfang.me/mweb/16.png)\n\n5、修改 `login.jsp`、`loginSuccess.jsp` 和 `loginFail.jsp` 页面，通过 Struts2 标签实现国际化； \n\n6、将 struts-prj1 重新布署在 Tomcat 服务器上； \n\n7、设置浏览器的首语言选项（如下图所示），通过浏览器访问 `login.jsp` 页面， 观察并记录运行结果；\n\n![](http://image.stephenfang.me/mweb/17.png)\n \n8、尝试修改用户注册模块，实现国际化，并记录运行结果。 \n\n![](http://image.stephenfang.me/mweb/18.png)\n\n![](http://image.stephenfang.me/mweb/19.png)\n\n> 注册中文页面\n\n![](http://image.stephenfang.me/mweb/20.png)\n\n> 注册英文页面","slug":"Struts_Experiment","published":1,"updated":"2022-07-24T15:21:46.033Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp35006eo76fb8v60tn2","content":"<p>包含Struts 2知识梳理、实验总结、实验步骤三方面的总结。</p>\n<span id=\"more\"></span>\n<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Struts2 是从 WebWork 框架上发展起来的 MVC 框架； </p>\n<p>2、FilterDispatcher 是 Struts2 中的核心控制器，客户端对服务器端的请求将被 FilterDispatcher 过滤；若请求需要调用某个 Action，则框架将根据配置文件<code>struts.xml</code>，找到需要调用的 Action 类； </p>\n<p>3、Action 类是一个符合一定命名规范的 JavaSE 类，作为业务控制器使用； Action<br>中的 execute()方法用于调用 Model 层的业务逻辑类，并根据返回结果决定页面导航； </p>\n<p>4、若 Action 类中需要使用表单提交的请求参数，那么必须在 Action 类中声明与<br>表单域的名字对应的变量，并为变量提供 getters/setters 方法； </p>\n<p>5、Action 类需要在 <code>struts.xml</code> 中进行配置才能使用； </p>\n<p>6、编译运行基于 Struts2 框架的 Web 工程，需要导入 struts2 的 8 个核心 jar 包： </p>\n<table>\n<thead>\n<tr>\n<th>文件名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>struts2-core-2.3.15.1.jar</td>\n<td>Struts 2 框架的核心类库</td>\n</tr>\n<tr>\n<td>xwork-core-2.3.15.1.jar</td>\n<td>XWork 类库，Struts 2 的构建基础</td>\n</tr>\n<tr>\n<td>Ognl-3.0.6.jar</td>\n<td>Struts 2 使用的一种表达式语言类库</td>\n</tr>\n<tr>\n<td>freemarker-2.3.19.jar</td>\n<td>Struts 2 的标签模板使用类库</td>\n</tr>\n<tr>\n<td>javassist-3.11.0.GA.jar</td>\n<td>代码生成工具包</td>\n</tr>\n<tr>\n<td>commons-lang3-3.1.jar</td>\n<td>Apache 语言包，是 java.lang 包的扩展</td>\n</tr>\n<tr>\n<td>commons-io-2.0.1.jar</td>\n<td>Apache IO 包</td>\n</tr>\n<tr>\n<td>commons-fileupload-1.3.jar</td>\n<td>Struts 2 文件上传依赖包</td>\n</tr>\n</tbody></table>\n<p>7、使用 Struts2 标签的形式来表达页面逻辑，可以尽量避免在视图中使用 Java 代码，让逻辑与显示分离，提高视图的可维护性； </p>\n<p>8、Struts2 标签库的主要 tld 文件为 <code>struts-tags.tld</code>， 在 <code>struts2-core-2.3.15.1.jar</code> 包中， 另一个与 Ajax 相关的标签库 tld 文件为 <code>struts-dojo-tags.tld</code>，在 <code>struts2-dojo -plugin-2.3.15.1.jar</code> 包中； </p>\n<p>9、Struts2 标签的使用步骤和使用 JSTL 相同，只需在 JSP 页面中使用 taglib 指令 引入标签库中 tld 文件的 uri， 并指定前缀即可，例如： <code>&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;</code>； </p>\n<p>10、根据 Struts2 标签的主要作用，可以将其分为：用于生成页面元素的 UI 标签、 用于实现流程控制的控制类标签、用于控制数据的数据标签和用于支持Ajax的标签。</p>\n<p>11、通过将不同语言版本的字符保存在属性文件中，Struts2 的国际化机制能够在不需要修改程序主体的前提下，实现不同语言版本的应用； </p>\n<p>12、在 Web 应用中选择需要进行国际化的内容，不在页面中直接输出该信息，而是通过 Struts2 标签输出一个键值，该键值在不同语言环境下对应不同的字符串；如：<code>&lt;s:textfield name=&quot;loginUser.account&quot; lable=&quot;请输入用户名&quot;/&gt;</code>代码中的“请输入用户名”是需要国际化的内容,将其以键值代替为<code>&lt;s:textfield name=&quot;loginUser.account&quot; key=&quot;login.account.lable&quot;/&gt;</code> </p>\n<p>13、需要进行国际化的内容以键值对（key=value） 的形式写入 Struts2 的国际化资源文件中，如<code>login.account.lable=请输入用户名”；</code>该资源文件名可以自定义，但是后缀必须是 properties；资源文件应放在 Web 应用的类加载路径下； 每一个语言版本需要创建一个资源文件； </p>\n<p>14、通过 Struts2 的配置文件 <code>struts.properties</code> 来配置资源文件的基础名，若资源文 件的基础名为 message，则 <code>message_zh_CN.properties</code> 是对应的中文资源文件， <code>message_en_US.properties</code> 是对应的美国英语资源文件； </p>\n<p>15、浏览器将根据其默认的语言版本，自动调用相应语言的资源文件，从而在页面中展示不同的语言效果。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p>1、实验中各个文件的作用：</p>\n<p>(1)jsp页面：负责展示视图</p>\n<p>(2)Action类：负责处理业务逻辑</p>\n<p>(3)Service类：用于实现登录逻辑</p>\n<p>(4)JavaBean：用于定义用户信息</p>\n<p>(5)Filter：起中央控制器作用的过滤器</p>\n<p>(6)struts.xml：核心配置文件</p>\n<p>2、Struts2 应用中从请求到响应的完整流程</p>\n<p>客户端首先向Action发送一个请求Request,Container通过<code>web.xml</code>映射请求，并获得Controller的名字；Container调用控制StrutsPrepareAndExecuteFilter；Controller通过ActionMapper获得Action的信息，调用ActionProxy；ActionProxy读取<code>struts.xml</code>文件获取action和interceptor stack的信息，把request请求传递给ActionInvocation；ActionInvocation依次调用action和interceptor；根据action的配置信息，产生result，Result信息返回给ActionInvocation，产生一个HttpServletResponse响应，产生的响应行为发送给客户端。</p>\n<p>3、MVC框架体现：</p>\n<p>Model：JavaBean、Action类</p>\n<p>View：JSP页面</p>\n<p>Controller：FilterDispatcher</p>\n<p>4、表单参数与 Action 属性的赋值关系</p>\n<p>表单元素的action属性值对应了action的name属性值，Action只是一个逻辑控制器，他不直接对请求者生成任何响应，而是通过result子元素将指定的返回值呈现给客户端，如返回字符串为success则跳转至loginSuccess.jsp页面.</p>\n<p>5、Action 的 execute() 方法的作用和特点</p>\n<p>作用：处理业务逻辑</p>\n<p>特点：无参数；不需要实现或者继承任何接口或者父类；execute方法一定要返回String类型的对象,每一个字符串都可以对应一个跳转的页面。</p>\n<p>6、struts.xml 里各元素及其属性的作用</p>\n<p>(1)package：管理Action、拦截器等核心组件。包含作为包名的name属性、用于继承的extends属性、用于设置命名空间的namespace属性、设置为抽象包的abstract属性。</p>\n<p>(2)action元素：定义与Action操作有关的一系列配置信息。包含作为Action名的name属性、具体处理请求类的class属性、指定调用Action中放发明的method属性、指定使用Action类型转换器converter属性。</p>\n<p>(3)result元素：将Action类返回的字符串转发给对应的是图，实现逻辑视图和物理视图资源的映射。包含制定配置逻辑视图名的name属性、指定结果类型的type属性。</p>\n<p>(4)constant元素：改变Struts2的一些默认行为。包含指定框架功能的name属性、与name配合使用的value属性。</p>\n<p>(5)interceptors元素：定义拦截器集合的元素</p>\n<p>(6)interceptor元素：用于配置拦截器。包含指定拦截器逻辑名称的name属性和指定具体处理拦截类的class属性。</p>\n<p>(7)interceptors-ref元素：在某个action中引用拦截器。</p>\n<p>(8)interceptors-stack元素：定义拦截器栈</p>\n<p>7、Struts2 中标签及其属性的作用和用法：</p>\n<p>(1)form标签：生成表单元素。包含提交Action名字的action属性、命名空间namespace属性、定义GET/POST的method属性等</p>\n<p>(2)textfield标签：用来输入一小段文字。包含定义可输入最大长度值的maxlength属性、定义字段尺寸size属性、用于标示元素的id属性等</p>\n<p>(3)password标签：默认不显示输入内容的textfield。包含确定是否显示内容的showPassword属性、字段最大长度maxlength属性、定义字段尺寸size属性等</p>\n<p>(4)if/elseif/else标签：通过逻辑值控制流程。包含决定标签内容是否显示的test属性、标示元素id的id属性。</p>\n<p>(5)iterator标签：用于遍历集合元素。包含产生IteratorStatus对象实例的status属性、标示元素id的id属性等</p>\n<p>8、配置文件 <code>struts.properties</code> 的作用</p>\n<p>定义了Struts 2框架的大量属性，开发者可以通过改变这些属性来满足应用的需求。其中<code>struts.configuration</code>属性指定加载Struts 2配置文件的配置文件管理器。struts.locale属性指定Web应用的默认<code>Locale。struts.i18n.encoding</code>指定Web应用的默认编码集。</p>\n<h2 id=\"实验步骤\"><a href=\"#实验步骤\" class=\"headerlink\" title=\"实验步骤\"></a>实验步骤</h2><h3 id=\"基础实验\"><a href=\"#基础实验\" class=\"headerlink\" title=\"基础实验\"></a>基础实验</h3><p>1、登录 <a href=\"http://struts.apache.org/download.cgi\">http://struts.apache.org/download.cgi</a> 站点，下载 Struts2 的最新版（Full Distribution）； </p>\n<p>2、新建 Web 工程 struts-prj1； </p>\n<p>3、将 Struts2 中的 8 个核心包增加到 Web 应用中，即复制到“%workspace%<br>struts-prj1\\WebContent\\WEB-INF\\lib”路径下； </p>\n<p>4、在 struts-prj1 中新建 login.jsp 页面，作为用户登录的视图（代码片段如下）， 注意表单（form）中 action 属性的值，注意用户名与密码输入框中 name 属性的值； </p>\n<p>5、在 struts-prj1 中新建 loginSuccess.jsp 和 loginFail.jsp 页面，分别作为登录成功 或登录失败的视图，在页面中显示“登录成功”或“登录失败”；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/1.png\"></p>\n<p>6、在 struts-prj1 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于记录登录用户信息，注意该 JavaBean 中属性名的写法； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/2.png\"></p>\n<p>7、在 struts-prj1 中新建 cn.edu.zjut.service 包，并在其中创建 UserService.java， 用于实现登录逻辑，为简化登录逻辑，将登录成功的条件设置为：用户名和密码相同</p>\n<p><img src=\"http://image.stephenfang.me/mweb/3.png\"></p>\n<p>8、在 struts-prj1 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，调 用登录逻辑，并根据登录结果不同而返回不同的内容，注意该 Action 中的属性名及相应的 getters 和 setters 方法、execute()方法及返回值；  </p>\n<p><img src=\"http://image.stephenfang.me/mweb/4.png\"></p>\n<p>9、在工程 struts-prj1 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，注意 action 标签中 name 属性和 class 属性的值， 以及 result 子标签的属性； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/5.png\"></p>\n<p>10、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/6.png\"></p>\n<p>11、将 struts-prj1 部署在 Tomcat 服务器上； </p>\n<p>12、通过浏览器访问 login.jsp 页面，并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/7.png\"></p>\n<h3 id=\"提高实验\"><a href=\"#提高实验\" class=\"headerlink\" title=\"提高实验\"></a>提高实验</h3><p>1、为能使用与 Ajax 相关的标签，将 Struts2 中的 <code>struts2-dojo-plugin-2.3.15.1.jar</code> 包增加到工程 struts-prj1 中，即复制到<code>%workspace%struts-prj1\\WebContent\\ WEB-INF\\lib</code>路径下，刷新工程； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/8.png\"></p>\n<p>2、在工程 struts-prj1 中增加用户注册功能，新建 register.jsp 页面作为用户注册的 视图，页面使用 Struts2 的 UI 标签来生成表单元素，包括用户名、密码、确认密码、真实姓名、性别、生日、联系地址、联系电话和电子邮箱 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/9.png\"></p>\n<p>3、在 struts-prj1 中新建 <code>regFail.jsp</code> 页面，作为注册失败的视图，在页面中显示“注册失败”； </p>\n<p>4、在 struts-prj1 中新建 <code>regSuccess.jsp</code> 页面，作为注册成功的视图，使用 Struts2 的数据标签和控制标签来生成注册成功的信息，并将登录用户信息保存在会话范围内 </p>\n<p>5、修改 <code>UserBean.java</code>，增加属性用于记录注册用户信息 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/10.png\"></p>\n<p>6、修改 <code>UserService.java</code>，增加用户注册逻辑，为简化注册逻辑，将注册成功的条件设置为：用户名、密码和确认密码相同，而且不为空字串； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/11.png\"></p>\n<p>7、修改 <code>UserAction.java</code> 中的 execute()方法，参照基础实验部分写入代码，用于调用注册逻辑，并根据注册成功与否而返回不同的内容； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/12.png\"></p>\n<p>8、修改 <code>struts.xml</code> 文件，对用户注册进行配置并设置页面导航； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/13.png\"></p>\n<p>9、将 struts-prj1 重新布署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页面， 并记录运行结果； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/14.png\"></p>\n<h3 id=\"拓展实验\"><a href=\"#拓展实验\" class=\"headerlink\" title=\"拓展实验\"></a>拓展实验</h3><p>1、在工程 struts-prj1 的 src 目录下新建一个 <code>cn.edu.zjut.local</code> 包，把所有的资源文件放置其中，如：<code>message_zh_CN.properties</code>、<code>message_en_US.properties</code> 等； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/15.png\"></p>\n<p>2、将工程 struts-prj1 中用户登录模块的三个 JSP 页面进行国际化处理，选择需要进行国际化的内容，以键值对的形式写入资源文件中 </p>\n<p>3、使用 JDK 中的 native2ASCII 工具，将 <code>message_zh_CN.properties</code> 重新编码，将中文字符都转化为 unicode 码，从而避免乱码问题； </p>\n<p>4、在工程 struts-prj1 的 src 目录中创建 <code>struts.properties</code> 文件，通过它加载资源文件,或者在JSP页面中临时加载资源文件  </p>\n<p><img src=\"http://image.stephenfang.me/mweb/16.png\"></p>\n<p>5、修改 <code>login.jsp</code>、<code>loginSuccess.jsp</code> 和 <code>loginFail.jsp</code> 页面，通过 Struts2 标签实现国际化； </p>\n<p>6、将 struts-prj1 重新布署在 Tomcat 服务器上； </p>\n<p>7、设置浏览器的首语言选项（如下图所示），通过浏览器访问 <code>login.jsp</code> 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/17.png\"></p>\n<p>8、尝试修改用户注册模块，实现国际化，并记录运行结果。 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/18.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/19.png\"></p>\n<blockquote>\n<p>注册中文页面</p>\n</blockquote>\n<p><img src=\"http://image.stephenfang.me/mweb/20.png\"></p>\n<blockquote>\n<p>注册英文页面</p>\n</blockquote>\n","site":{"data":{}},"excerpt":"<p>包含Struts 2知识梳理、实验总结、实验步骤三方面的总结。</p>","more":"<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Struts2 是从 WebWork 框架上发展起来的 MVC 框架； </p>\n<p>2、FilterDispatcher 是 Struts2 中的核心控制器，客户端对服务器端的请求将被 FilterDispatcher 过滤；若请求需要调用某个 Action，则框架将根据配置文件<code>struts.xml</code>，找到需要调用的 Action 类； </p>\n<p>3、Action 类是一个符合一定命名规范的 JavaSE 类，作为业务控制器使用； Action<br>中的 execute()方法用于调用 Model 层的业务逻辑类，并根据返回结果决定页面导航； </p>\n<p>4、若 Action 类中需要使用表单提交的请求参数，那么必须在 Action 类中声明与<br>表单域的名字对应的变量，并为变量提供 getters/setters 方法； </p>\n<p>5、Action 类需要在 <code>struts.xml</code> 中进行配置才能使用； </p>\n<p>6、编译运行基于 Struts2 框架的 Web 工程，需要导入 struts2 的 8 个核心 jar 包： </p>\n<table>\n<thead>\n<tr>\n<th>文件名</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>struts2-core-2.3.15.1.jar</td>\n<td>Struts 2 框架的核心类库</td>\n</tr>\n<tr>\n<td>xwork-core-2.3.15.1.jar</td>\n<td>XWork 类库，Struts 2 的构建基础</td>\n</tr>\n<tr>\n<td>Ognl-3.0.6.jar</td>\n<td>Struts 2 使用的一种表达式语言类库</td>\n</tr>\n<tr>\n<td>freemarker-2.3.19.jar</td>\n<td>Struts 2 的标签模板使用类库</td>\n</tr>\n<tr>\n<td>javassist-3.11.0.GA.jar</td>\n<td>代码生成工具包</td>\n</tr>\n<tr>\n<td>commons-lang3-3.1.jar</td>\n<td>Apache 语言包，是 java.lang 包的扩展</td>\n</tr>\n<tr>\n<td>commons-io-2.0.1.jar</td>\n<td>Apache IO 包</td>\n</tr>\n<tr>\n<td>commons-fileupload-1.3.jar</td>\n<td>Struts 2 文件上传依赖包</td>\n</tr>\n</tbody></table>\n<p>7、使用 Struts2 标签的形式来表达页面逻辑，可以尽量避免在视图中使用 Java 代码，让逻辑与显示分离，提高视图的可维护性； </p>\n<p>8、Struts2 标签库的主要 tld 文件为 <code>struts-tags.tld</code>， 在 <code>struts2-core-2.3.15.1.jar</code> 包中， 另一个与 Ajax 相关的标签库 tld 文件为 <code>struts-dojo-tags.tld</code>，在 <code>struts2-dojo -plugin-2.3.15.1.jar</code> 包中； </p>\n<p>9、Struts2 标签的使用步骤和使用 JSTL 相同，只需在 JSP 页面中使用 taglib 指令 引入标签库中 tld 文件的 uri， 并指定前缀即可，例如： <code>&lt;%@ taglib prefix=&quot;s&quot; uri=&quot;/struts-tags&quot;%&gt;</code>； </p>\n<p>10、根据 Struts2 标签的主要作用，可以将其分为：用于生成页面元素的 UI 标签、 用于实现流程控制的控制类标签、用于控制数据的数据标签和用于支持Ajax的标签。</p>\n<p>11、通过将不同语言版本的字符保存在属性文件中，Struts2 的国际化机制能够在不需要修改程序主体的前提下，实现不同语言版本的应用； </p>\n<p>12、在 Web 应用中选择需要进行国际化的内容，不在页面中直接输出该信息，而是通过 Struts2 标签输出一个键值，该键值在不同语言环境下对应不同的字符串；如：<code>&lt;s:textfield name=&quot;loginUser.account&quot; lable=&quot;请输入用户名&quot;/&gt;</code>代码中的“请输入用户名”是需要国际化的内容,将其以键值代替为<code>&lt;s:textfield name=&quot;loginUser.account&quot; key=&quot;login.account.lable&quot;/&gt;</code> </p>\n<p>13、需要进行国际化的内容以键值对（key=value） 的形式写入 Struts2 的国际化资源文件中，如<code>login.account.lable=请输入用户名”；</code>该资源文件名可以自定义，但是后缀必须是 properties；资源文件应放在 Web 应用的类加载路径下； 每一个语言版本需要创建一个资源文件； </p>\n<p>14、通过 Struts2 的配置文件 <code>struts.properties</code> 来配置资源文件的基础名，若资源文 件的基础名为 message，则 <code>message_zh_CN.properties</code> 是对应的中文资源文件， <code>message_en_US.properties</code> 是对应的美国英语资源文件； </p>\n<p>15、浏览器将根据其默认的语言版本，自动调用相应语言的资源文件，从而在页面中展示不同的语言效果。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p>1、实验中各个文件的作用：</p>\n<p>(1)jsp页面：负责展示视图</p>\n<p>(2)Action类：负责处理业务逻辑</p>\n<p>(3)Service类：用于实现登录逻辑</p>\n<p>(4)JavaBean：用于定义用户信息</p>\n<p>(5)Filter：起中央控制器作用的过滤器</p>\n<p>(6)struts.xml：核心配置文件</p>\n<p>2、Struts2 应用中从请求到响应的完整流程</p>\n<p>客户端首先向Action发送一个请求Request,Container通过<code>web.xml</code>映射请求，并获得Controller的名字；Container调用控制StrutsPrepareAndExecuteFilter；Controller通过ActionMapper获得Action的信息，调用ActionProxy；ActionProxy读取<code>struts.xml</code>文件获取action和interceptor stack的信息，把request请求传递给ActionInvocation；ActionInvocation依次调用action和interceptor；根据action的配置信息，产生result，Result信息返回给ActionInvocation，产生一个HttpServletResponse响应，产生的响应行为发送给客户端。</p>\n<p>3、MVC框架体现：</p>\n<p>Model：JavaBean、Action类</p>\n<p>View：JSP页面</p>\n<p>Controller：FilterDispatcher</p>\n<p>4、表单参数与 Action 属性的赋值关系</p>\n<p>表单元素的action属性值对应了action的name属性值，Action只是一个逻辑控制器，他不直接对请求者生成任何响应，而是通过result子元素将指定的返回值呈现给客户端，如返回字符串为success则跳转至loginSuccess.jsp页面.</p>\n<p>5、Action 的 execute() 方法的作用和特点</p>\n<p>作用：处理业务逻辑</p>\n<p>特点：无参数；不需要实现或者继承任何接口或者父类；execute方法一定要返回String类型的对象,每一个字符串都可以对应一个跳转的页面。</p>\n<p>6、struts.xml 里各元素及其属性的作用</p>\n<p>(1)package：管理Action、拦截器等核心组件。包含作为包名的name属性、用于继承的extends属性、用于设置命名空间的namespace属性、设置为抽象包的abstract属性。</p>\n<p>(2)action元素：定义与Action操作有关的一系列配置信息。包含作为Action名的name属性、具体处理请求类的class属性、指定调用Action中放发明的method属性、指定使用Action类型转换器converter属性。</p>\n<p>(3)result元素：将Action类返回的字符串转发给对应的是图，实现逻辑视图和物理视图资源的映射。包含制定配置逻辑视图名的name属性、指定结果类型的type属性。</p>\n<p>(4)constant元素：改变Struts2的一些默认行为。包含指定框架功能的name属性、与name配合使用的value属性。</p>\n<p>(5)interceptors元素：定义拦截器集合的元素</p>\n<p>(6)interceptor元素：用于配置拦截器。包含指定拦截器逻辑名称的name属性和指定具体处理拦截类的class属性。</p>\n<p>(7)interceptors-ref元素：在某个action中引用拦截器。</p>\n<p>(8)interceptors-stack元素：定义拦截器栈</p>\n<p>7、Struts2 中标签及其属性的作用和用法：</p>\n<p>(1)form标签：生成表单元素。包含提交Action名字的action属性、命名空间namespace属性、定义GET/POST的method属性等</p>\n<p>(2)textfield标签：用来输入一小段文字。包含定义可输入最大长度值的maxlength属性、定义字段尺寸size属性、用于标示元素的id属性等</p>\n<p>(3)password标签：默认不显示输入内容的textfield。包含确定是否显示内容的showPassword属性、字段最大长度maxlength属性、定义字段尺寸size属性等</p>\n<p>(4)if/elseif/else标签：通过逻辑值控制流程。包含决定标签内容是否显示的test属性、标示元素id的id属性。</p>\n<p>(5)iterator标签：用于遍历集合元素。包含产生IteratorStatus对象实例的status属性、标示元素id的id属性等</p>\n<p>8、配置文件 <code>struts.properties</code> 的作用</p>\n<p>定义了Struts 2框架的大量属性，开发者可以通过改变这些属性来满足应用的需求。其中<code>struts.configuration</code>属性指定加载Struts 2配置文件的配置文件管理器。struts.locale属性指定Web应用的默认<code>Locale。struts.i18n.encoding</code>指定Web应用的默认编码集。</p>\n<h2 id=\"实验步骤\"><a href=\"#实验步骤\" class=\"headerlink\" title=\"实验步骤\"></a>实验步骤</h2><h3 id=\"基础实验\"><a href=\"#基础实验\" class=\"headerlink\" title=\"基础实验\"></a>基础实验</h3><p>1、登录 <a href=\"http://struts.apache.org/download.cgi\">http://struts.apache.org/download.cgi</a> 站点，下载 Struts2 的最新版（Full Distribution）； </p>\n<p>2、新建 Web 工程 struts-prj1； </p>\n<p>3、将 Struts2 中的 8 个核心包增加到 Web 应用中，即复制到“%workspace%<br>struts-prj1\\WebContent\\WEB-INF\\lib”路径下； </p>\n<p>4、在 struts-prj1 中新建 login.jsp 页面，作为用户登录的视图（代码片段如下）， 注意表单（form）中 action 属性的值，注意用户名与密码输入框中 name 属性的值； </p>\n<p>5、在 struts-prj1 中新建 loginSuccess.jsp 和 loginFail.jsp 页面，分别作为登录成功 或登录失败的视图，在页面中显示“登录成功”或“登录失败”；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/1.png\"></p>\n<p>6、在 struts-prj1 中新建 cn.edu.zjut.bean 包，并在其中创建 UserBean.java，用于记录登录用户信息，注意该 JavaBean 中属性名的写法； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/2.png\"></p>\n<p>7、在 struts-prj1 中新建 cn.edu.zjut.service 包，并在其中创建 UserService.java， 用于实现登录逻辑，为简化登录逻辑，将登录成功的条件设置为：用户名和密码相同</p>\n<p><img src=\"http://image.stephenfang.me/mweb/3.png\"></p>\n<p>8、在 struts-prj1 中新建 cn.edu.zjut.action 包，并在其中创建 UserAction.java，调 用登录逻辑，并根据登录结果不同而返回不同的内容，注意该 Action 中的属性名及相应的 getters 和 setters 方法、execute()方法及返回值；  </p>\n<p><img src=\"http://image.stephenfang.me/mweb/4.png\"></p>\n<p>9、在工程 struts-prj1 的 src 目录中创建 struts.xml 文件，用于配置 Action 并设置 页面导航，注意 action 标签中 name 属性和 class 属性的值， 以及 result 子标签的属性； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/5.png\"></p>\n<p>10、编辑 Web 应用的 web.xml 文件，增加 Struts2 核心 Filter 的配置； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/6.png\"></p>\n<p>11、将 struts-prj1 部署在 Tomcat 服务器上； </p>\n<p>12、通过浏览器访问 login.jsp 页面，并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/7.png\"></p>\n<h3 id=\"提高实验\"><a href=\"#提高实验\" class=\"headerlink\" title=\"提高实验\"></a>提高实验</h3><p>1、为能使用与 Ajax 相关的标签，将 Struts2 中的 <code>struts2-dojo-plugin-2.3.15.1.jar</code> 包增加到工程 struts-prj1 中，即复制到<code>%workspace%struts-prj1\\WebContent\\ WEB-INF\\lib</code>路径下，刷新工程； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/8.png\"></p>\n<p>2、在工程 struts-prj1 中增加用户注册功能，新建 register.jsp 页面作为用户注册的 视图，页面使用 Struts2 的 UI 标签来生成表单元素，包括用户名、密码、确认密码、真实姓名、性别、生日、联系地址、联系电话和电子邮箱 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/9.png\"></p>\n<p>3、在 struts-prj1 中新建 <code>regFail.jsp</code> 页面，作为注册失败的视图，在页面中显示“注册失败”； </p>\n<p>4、在 struts-prj1 中新建 <code>regSuccess.jsp</code> 页面，作为注册成功的视图，使用 Struts2 的数据标签和控制标签来生成注册成功的信息，并将登录用户信息保存在会话范围内 </p>\n<p>5、修改 <code>UserBean.java</code>，增加属性用于记录注册用户信息 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/10.png\"></p>\n<p>6、修改 <code>UserService.java</code>，增加用户注册逻辑，为简化注册逻辑，将注册成功的条件设置为：用户名、密码和确认密码相同，而且不为空字串； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/11.png\"></p>\n<p>7、修改 <code>UserAction.java</code> 中的 execute()方法，参照基础实验部分写入代码，用于调用注册逻辑，并根据注册成功与否而返回不同的内容； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/12.png\"></p>\n<p>8、修改 <code>struts.xml</code> 文件，对用户注册进行配置并设置页面导航； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/13.png\"></p>\n<p>9、将 struts-prj1 重新布署在 Tomcat 服务器上，通过浏览器访问 <code>register.jsp</code> 页面， 并记录运行结果； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/14.png\"></p>\n<h3 id=\"拓展实验\"><a href=\"#拓展实验\" class=\"headerlink\" title=\"拓展实验\"></a>拓展实验</h3><p>1、在工程 struts-prj1 的 src 目录下新建一个 <code>cn.edu.zjut.local</code> 包，把所有的资源文件放置其中，如：<code>message_zh_CN.properties</code>、<code>message_en_US.properties</code> 等； </p>\n<p><img src=\"http://image.stephenfang.me/mweb/15.png\"></p>\n<p>2、将工程 struts-prj1 中用户登录模块的三个 JSP 页面进行国际化处理，选择需要进行国际化的内容，以键值对的形式写入资源文件中 </p>\n<p>3、使用 JDK 中的 native2ASCII 工具，将 <code>message_zh_CN.properties</code> 重新编码，将中文字符都转化为 unicode 码，从而避免乱码问题； </p>\n<p>4、在工程 struts-prj1 的 src 目录中创建 <code>struts.properties</code> 文件，通过它加载资源文件,或者在JSP页面中临时加载资源文件  </p>\n<p><img src=\"http://image.stephenfang.me/mweb/16.png\"></p>\n<p>5、修改 <code>login.jsp</code>、<code>loginSuccess.jsp</code> 和 <code>loginFail.jsp</code> 页面，通过 Struts2 标签实现国际化； </p>\n<p>6、将 struts-prj1 重新布署在 Tomcat 服务器上； </p>\n<p>7、设置浏览器的首语言选项（如下图所示），通过浏览器访问 <code>login.jsp</code> 页面， 观察并记录运行结果；</p>\n<p><img src=\"http://image.stephenfang.me/mweb/17.png\"></p>\n<p>8、尝试修改用户注册模块，实现国际化，并记录运行结果。 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/18.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/19.png\"></p>\n<blockquote>\n<p>注册中文页面</p>\n</blockquote>\n<p><img src=\"http://image.stephenfang.me/mweb/20.png\"></p>\n<blockquote>\n<p>注册英文页面</p>\n</blockquote>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/1.png","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:46 GMT+0800 (中国标准时间)","title":"Struts 2 基础应用实验","path":"2020/02/23/Struts_Experiment/","eyeCatchImage":"http://image.stephenfang.me/mweb/1.png","excerpt":"<p>包含Struts 2知识梳理、实验总结、实验步骤三方面的总结。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-23T10:10:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-23T10:10:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["struts","JavaEE","总结","实验"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":5866},{"title":"Struts 工作流程总结","date":"2020-02-24T03:10:20.000Z","_content":"\n包含Struts 工作流程知识梳理、实验总结、实验步骤三方面的总结。\n<!--more-->\n\n## 知识梳理\n\n1、Struts2 的控制器主要由三个层次组成，分别是过滤器、拦截器和业务控制 Action； \n\n2、过滤器是 Struts2 控制器的最前端控制器，过滤器的使用需要在 `web.xml` 中进行配置；FilterDispatcher 是 Struts2 应用中必须配置使用的过滤器，该过滤器的主要功能 包括执行 Action、清空 ActionContext 对象等； \n\n3、拦截器是 Struts2 中第二个层次的控制器，能够在 Action 执行前后完成一些通用功能； \n\n\n4、Struts2 内建了大量拦截器， 这些拦截器以 name-class 对的形式配置在 `strutsdefault.xml` 文件中，如果 `struts.xml 中定义的 package 继承了 Struts2 默 认的 `struts-default` 包，便可以直接使用默认拦截器栈 defaultStack； \n\n5、Struts2 也允许自定义拦截器，自定义拦截器类须实现 Interceptor 接口，并覆盖接 口中的 intercept 方法用于实现拦截器的主要功能；自定义拦截器须在 `struts.xml` 中进 行配置才能使用； \n\n6、若在 `struts.xml` 中为 Action 指定了一个拦截器，则默认拦截器栈 defaultStack 将会失效，为了继续使用默认拦截器，必须将其进行显式地配置。\n\n7、Struts API 中的 `com.opensymphony.xwork2.util.ValueStack` 称为值栈，值栈是一 个数据区域，该区域中保存了应用范围内的所有数据和 Action 处理的用户请求数据； \n\n8、值栈被存储在 ActionContext 对象中，因此可以在任何节点访问其中的内容； \n\n9、ValueStack 接口中主要方法有：`Object findValue(String expr)`可以通过表达式查 找值栈中对应的值，`void setValue(String expr, Object value)`用于将对象及其表达式 存到值栈中； \n\n10、OGNL，即对象图导航语言，是 Struts 默认的表达式语言； \n\n11、OGNL 基础单位称为导航链，基本的链由属性名、方法调用、数组或集合元素组成；\n\n12、在 Struts2 中，值栈是 OGNL 上下文的根对象，可以直接访问，而 application、session 等其它对象不是根对象，需要使用#进行访问。\n\n13、Struts2 应用中使用 Action 调用 Model，因此 Struts2 应用中的异常在 Model 层抛 出后，通常在 Action 类中进行处理； \n\n14、Action 可以直接使用 try/catch 捕获异常，然后返回结果视图，跳转到相关页面处理 异常； \n\n15、抛出异常后，也可以不在 Action 类中捕获，而使用 throws 声明异常，交给 Struts2 框架处理； \n\n16、Struts2 允许通过 `struts.xml` 文件来配置异常的处理，使用 `<exception-mapping>` 标签声明异常映射，指定发生该类型异常时跳转的结果视图。\n\n## 实验总结\n**1、自定义拦截器类的作用和实现方法**\n\n**作用：** \nStruts2第二个层次的控制器，能够在Action执行前后完成一些通用功能，完成一些通用的控制逻辑：解析请求参数、类型转换、输入校验、防止表单多次提交。 \n\n**实现方法：**\n\n(1) 创建拦截器Interceptor \n\n(2) 继承 AbstractInterceptor 类，重写 intercept()方法（AbstractInterceptor 类实现了 Interceptor 接口） \n\n(3) Action 内使用拦截器 \n\n(4) 修改 `struts.xml` 文件，增加拦截器的配置 \n\n**2、Interceptor 接口中 intercept(ActionInvocation inv)、init()和 destroy()方法的作用**\n\n- **intercept(ActionInvocation inv)**： 允许 Interceptor 在 ActionInvocation 对请求的其余处理之前和/或之后对请求进行某些 处理，或者使处理短路，并仅返回 String 数值 \n\n- **init()**： 在 interceptor 生成后产生，但在 interceptor 接受任何请求之前调用，使得 interceptor 进行初始化 \n\n- **destroy()**： 让 interceptor 清理它产生的资源 \n\n**3、defaultStack 拦截器栈中包含的主要拦截功能** \n\n- **params**：解析 HTTP 请求参数，并设置成 Action 属性 \n\n- **validation**：执行 xxxAction-validate 中定义的校验器 \n\n- **workflow**：调用 Action 中的 validate 方法 \n\n- **i18n**：负责把用户所选的语言、区域放入用户 Session 中。 \n\n- **createSession**：创建 HttpSession 对象 \n\n- **timer**：负责输出 Action 执行时间，分析性能 \n\n- **autowiring**：自动装配，访问 Spring 中的 Bean \n\n**4、自定义过滤器的实现方法和配置步骤，将拦截器与过滤器进行比较，并将两者的特点及区别**\n\n**配置步骤：**\n\n(1) 创建拦截器类，继承Filter类，重写doFilter方法\n\n(2) `web.xml` 文件配置\n\n**拦截器与过滤器特点和区别：** \n\n- 拦截器：Struts2 中第二个层次的控制器；允许自定义；需要在 web.xml 文件中配置； \n- 过滤器：Struts2 控制器的最前端控制器；允许自定义；需要在 struts.xml 文件中配置。 \n\n**5、ValueStack 接口及其主要方法的作用和开发步骤**\nValueStack 接口中主要方法:findValue(), setValue() \n\n**findValue()**：通过以默认搜索顺序针对堆栈评估给定表达式来查找值。 \n\n**setValue()**：使用默认搜索顺序使用给定的表达式在堆栈中的 bean 上设置属性。 \n\n开发需要引入 `com.opensymphony.xwork2.util.ValueStack` 并实例化 ValueStack 对象，之后通过方法调用实现相关功能。 \n\n**6、OGNL 可访问的对象和基本语法**\n\n可以直接访问值栈 ValueStack（OGNL 上下文的根对象）；Action 实例被保存在值栈中，因此可以直接访问。 基本语法包含#、%、$三种符号，作用见下文 \n\n**7、OGNL 三种常用符号:#、%和$的作用和使用方法**\n\n **%符号**：计算 OGNL 表达式的值 \n \n **$符号**：在国际化资源文件中，引用 OGNL 表达式；在 Struts 2 框架配置文件中引用 OGNL 表达式 \n \n **#符号**：访问 OGNL 上下文和 Action 上下文；构造 Map；过滤和投影集合 \n \n **8、自定义异常类的方法和步骤** \n \n （1）创建自定义异常类并继承 Exception 类 \n \n （2）在 Model 中抛出自定义异常 \n \n （3）在 Action 中捕获异常 \n \n （4）在 `struts.xml` 中设置异常页面导航 \n \n （5）在 Action 中抛出异常，将其交给框架处理 \n \n （6）在 `struts.xml` 中使用标签<exception- mapping>进行异常配置 \n \n **9、整理 Struts2 框架处理异常的机制，整理 `struts.xml` 文件配置异常映射的方法以及相关标签的作用** \n \n Struts2 的异常处理机制是通过在 `struts.xml` 文件中配置<exception-mapping……/>元素完成，配置该元素时，需要指定两个属性： \n \n **exception**：指定该异常类型的完全限定名。\n  \n **result**：指定逻辑视图名。 \n \n 根据`<exception-mapping…../>`元素出现位置的不同，异常映射又可分为两种： \n \n **局部异常映射**：将`<exception-mapping… />`元素作为`<action…/>`元素的子元素配置； \n \n **全局异常映射**：将`<exception-mapping… />`元素作为`<global-exception-mappings… />` 元素的子元素配置； \n \n 全局异常映射对所有的 Action 都有效，但局部异常映射仅对该异常映射所在的 Action 有 效。如果局部异常映射和全局异常映射配置了同一个异常类型，在`<action…./>` 元素内的局部异常映射将覆盖全局异常映射。\n\n","source":"_posts/Struts_Workflow.md","raw":"---\ntitle: Struts 工作流程总结\ndate: 2020-02-24 11:10:20\ncategories: \n- 技术\ntags: \n- struts\n- workflow\n- JavaEE\n- 总结\n---\n\n包含Struts 工作流程知识梳理、实验总结、实验步骤三方面的总结。\n<!--more-->\n\n## 知识梳理\n\n1、Struts2 的控制器主要由三个层次组成，分别是过滤器、拦截器和业务控制 Action； \n\n2、过滤器是 Struts2 控制器的最前端控制器，过滤器的使用需要在 `web.xml` 中进行配置；FilterDispatcher 是 Struts2 应用中必须配置使用的过滤器，该过滤器的主要功能 包括执行 Action、清空 ActionContext 对象等； \n\n3、拦截器是 Struts2 中第二个层次的控制器，能够在 Action 执行前后完成一些通用功能； \n\n\n4、Struts2 内建了大量拦截器， 这些拦截器以 name-class 对的形式配置在 `strutsdefault.xml` 文件中，如果 `struts.xml 中定义的 package 继承了 Struts2 默 认的 `struts-default` 包，便可以直接使用默认拦截器栈 defaultStack； \n\n5、Struts2 也允许自定义拦截器，自定义拦截器类须实现 Interceptor 接口，并覆盖接 口中的 intercept 方法用于实现拦截器的主要功能；自定义拦截器须在 `struts.xml` 中进 行配置才能使用； \n\n6、若在 `struts.xml` 中为 Action 指定了一个拦截器，则默认拦截器栈 defaultStack 将会失效，为了继续使用默认拦截器，必须将其进行显式地配置。\n\n7、Struts API 中的 `com.opensymphony.xwork2.util.ValueStack` 称为值栈，值栈是一 个数据区域，该区域中保存了应用范围内的所有数据和 Action 处理的用户请求数据； \n\n8、值栈被存储在 ActionContext 对象中，因此可以在任何节点访问其中的内容； \n\n9、ValueStack 接口中主要方法有：`Object findValue(String expr)`可以通过表达式查 找值栈中对应的值，`void setValue(String expr, Object value)`用于将对象及其表达式 存到值栈中； \n\n10、OGNL，即对象图导航语言，是 Struts 默认的表达式语言； \n\n11、OGNL 基础单位称为导航链，基本的链由属性名、方法调用、数组或集合元素组成；\n\n12、在 Struts2 中，值栈是 OGNL 上下文的根对象，可以直接访问，而 application、session 等其它对象不是根对象，需要使用#进行访问。\n\n13、Struts2 应用中使用 Action 调用 Model，因此 Struts2 应用中的异常在 Model 层抛 出后，通常在 Action 类中进行处理； \n\n14、Action 可以直接使用 try/catch 捕获异常，然后返回结果视图，跳转到相关页面处理 异常； \n\n15、抛出异常后，也可以不在 Action 类中捕获，而使用 throws 声明异常，交给 Struts2 框架处理； \n\n16、Struts2 允许通过 `struts.xml` 文件来配置异常的处理，使用 `<exception-mapping>` 标签声明异常映射，指定发生该类型异常时跳转的结果视图。\n\n## 实验总结\n**1、自定义拦截器类的作用和实现方法**\n\n**作用：** \nStruts2第二个层次的控制器，能够在Action执行前后完成一些通用功能，完成一些通用的控制逻辑：解析请求参数、类型转换、输入校验、防止表单多次提交。 \n\n**实现方法：**\n\n(1) 创建拦截器Interceptor \n\n(2) 继承 AbstractInterceptor 类，重写 intercept()方法（AbstractInterceptor 类实现了 Interceptor 接口） \n\n(3) Action 内使用拦截器 \n\n(4) 修改 `struts.xml` 文件，增加拦截器的配置 \n\n**2、Interceptor 接口中 intercept(ActionInvocation inv)、init()和 destroy()方法的作用**\n\n- **intercept(ActionInvocation inv)**： 允许 Interceptor 在 ActionInvocation 对请求的其余处理之前和/或之后对请求进行某些 处理，或者使处理短路，并仅返回 String 数值 \n\n- **init()**： 在 interceptor 生成后产生，但在 interceptor 接受任何请求之前调用，使得 interceptor 进行初始化 \n\n- **destroy()**： 让 interceptor 清理它产生的资源 \n\n**3、defaultStack 拦截器栈中包含的主要拦截功能** \n\n- **params**：解析 HTTP 请求参数，并设置成 Action 属性 \n\n- **validation**：执行 xxxAction-validate 中定义的校验器 \n\n- **workflow**：调用 Action 中的 validate 方法 \n\n- **i18n**：负责把用户所选的语言、区域放入用户 Session 中。 \n\n- **createSession**：创建 HttpSession 对象 \n\n- **timer**：负责输出 Action 执行时间，分析性能 \n\n- **autowiring**：自动装配，访问 Spring 中的 Bean \n\n**4、自定义过滤器的实现方法和配置步骤，将拦截器与过滤器进行比较，并将两者的特点及区别**\n\n**配置步骤：**\n\n(1) 创建拦截器类，继承Filter类，重写doFilter方法\n\n(2) `web.xml` 文件配置\n\n**拦截器与过滤器特点和区别：** \n\n- 拦截器：Struts2 中第二个层次的控制器；允许自定义；需要在 web.xml 文件中配置； \n- 过滤器：Struts2 控制器的最前端控制器；允许自定义；需要在 struts.xml 文件中配置。 \n\n**5、ValueStack 接口及其主要方法的作用和开发步骤**\nValueStack 接口中主要方法:findValue(), setValue() \n\n**findValue()**：通过以默认搜索顺序针对堆栈评估给定表达式来查找值。 \n\n**setValue()**：使用默认搜索顺序使用给定的表达式在堆栈中的 bean 上设置属性。 \n\n开发需要引入 `com.opensymphony.xwork2.util.ValueStack` 并实例化 ValueStack 对象，之后通过方法调用实现相关功能。 \n\n**6、OGNL 可访问的对象和基本语法**\n\n可以直接访问值栈 ValueStack（OGNL 上下文的根对象）；Action 实例被保存在值栈中，因此可以直接访问。 基本语法包含#、%、$三种符号，作用见下文 \n\n**7、OGNL 三种常用符号:#、%和$的作用和使用方法**\n\n **%符号**：计算 OGNL 表达式的值 \n \n **$符号**：在国际化资源文件中，引用 OGNL 表达式；在 Struts 2 框架配置文件中引用 OGNL 表达式 \n \n **#符号**：访问 OGNL 上下文和 Action 上下文；构造 Map；过滤和投影集合 \n \n **8、自定义异常类的方法和步骤** \n \n （1）创建自定义异常类并继承 Exception 类 \n \n （2）在 Model 中抛出自定义异常 \n \n （3）在 Action 中捕获异常 \n \n （4）在 `struts.xml` 中设置异常页面导航 \n \n （5）在 Action 中抛出异常，将其交给框架处理 \n \n （6）在 `struts.xml` 中使用标签<exception- mapping>进行异常配置 \n \n **9、整理 Struts2 框架处理异常的机制，整理 `struts.xml` 文件配置异常映射的方法以及相关标签的作用** \n \n Struts2 的异常处理机制是通过在 `struts.xml` 文件中配置<exception-mapping……/>元素完成，配置该元素时，需要指定两个属性： \n \n **exception**：指定该异常类型的完全限定名。\n  \n **result**：指定逻辑视图名。 \n \n 根据`<exception-mapping…../>`元素出现位置的不同，异常映射又可分为两种： \n \n **局部异常映射**：将`<exception-mapping… />`元素作为`<action…/>`元素的子元素配置； \n \n **全局异常映射**：将`<exception-mapping… />`元素作为`<global-exception-mappings… />` 元素的子元素配置； \n \n 全局异常映射对所有的 Action 都有效，但局部异常映射仅对该异常映射所在的 Action 有 效。如果局部异常映射和全局异常映射配置了同一个异常类型，在`<action…./>` 元素内的局部异常映射将覆盖全局异常映射。\n\n","slug":"Struts_Workflow","published":1,"updated":"2022-07-24T15:21:50.743Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp36006go76fdh1rck2d","content":"<p>包含Struts 工作流程知识梳理、实验总结、实验步骤三方面的总结。</p>\n<span id=\"more\"></span>\n\n<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Struts2 的控制器主要由三个层次组成，分别是过滤器、拦截器和业务控制 Action； </p>\n<p>2、过滤器是 Struts2 控制器的最前端控制器，过滤器的使用需要在 <code>web.xml</code> 中进行配置；FilterDispatcher 是 Struts2 应用中必须配置使用的过滤器，该过滤器的主要功能 包括执行 Action、清空 ActionContext 对象等； </p>\n<p>3、拦截器是 Struts2 中第二个层次的控制器，能够在 Action 执行前后完成一些通用功能； </p>\n<p>4、Struts2 内建了大量拦截器， 这些拦截器以 name-class 对的形式配置在 <code>strutsdefault.xml</code> 文件中，如果 <code>struts.xml 中定义的 package 继承了 Struts2 默 认的 </code>struts-default` 包，便可以直接使用默认拦截器栈 defaultStack； </p>\n<p>5、Struts2 也允许自定义拦截器，自定义拦截器类须实现 Interceptor 接口，并覆盖接 口中的 intercept 方法用于实现拦截器的主要功能；自定义拦截器须在 <code>struts.xml</code> 中进 行配置才能使用； </p>\n<p>6、若在 <code>struts.xml</code> 中为 Action 指定了一个拦截器，则默认拦截器栈 defaultStack 将会失效，为了继续使用默认拦截器，必须将其进行显式地配置。</p>\n<p>7、Struts API 中的 <code>com.opensymphony.xwork2.util.ValueStack</code> 称为值栈，值栈是一 个数据区域，该区域中保存了应用范围内的所有数据和 Action 处理的用户请求数据； </p>\n<p>8、值栈被存储在 ActionContext 对象中，因此可以在任何节点访问其中的内容； </p>\n<p>9、ValueStack 接口中主要方法有：<code>Object findValue(String expr)</code>可以通过表达式查 找值栈中对应的值，<code>void setValue(String expr, Object value)</code>用于将对象及其表达式 存到值栈中； </p>\n<p>10、OGNL，即对象图导航语言，是 Struts 默认的表达式语言； </p>\n<p>11、OGNL 基础单位称为导航链，基本的链由属性名、方法调用、数组或集合元素组成；</p>\n<p>12、在 Struts2 中，值栈是 OGNL 上下文的根对象，可以直接访问，而 application、session 等其它对象不是根对象，需要使用#进行访问。</p>\n<p>13、Struts2 应用中使用 Action 调用 Model，因此 Struts2 应用中的异常在 Model 层抛 出后，通常在 Action 类中进行处理； </p>\n<p>14、Action 可以直接使用 try/catch 捕获异常，然后返回结果视图，跳转到相关页面处理 异常； </p>\n<p>15、抛出异常后，也可以不在 Action 类中捕获，而使用 throws 声明异常，交给 Struts2 框架处理； </p>\n<p>16、Struts2 允许通过 <code>struts.xml</code> 文件来配置异常的处理，使用 <code>&lt;exception-mapping&gt;</code> 标签声明异常映射，指定发生该类型异常时跳转的结果视图。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p><strong>1、自定义拦截器类的作用和实现方法</strong></p>\n<p><strong>作用：</strong><br>Struts2第二个层次的控制器，能够在Action执行前后完成一些通用功能，完成一些通用的控制逻辑：解析请求参数、类型转换、输入校验、防止表单多次提交。 </p>\n<p><strong>实现方法：</strong></p>\n<p>(1) 创建拦截器Interceptor </p>\n<p>(2) 继承 AbstractInterceptor 类，重写 intercept()方法（AbstractInterceptor 类实现了 Interceptor 接口） </p>\n<p>(3) Action 内使用拦截器 </p>\n<p>(4) 修改 <code>struts.xml</code> 文件，增加拦截器的配置 </p>\n<p><strong>2、Interceptor 接口中 intercept(ActionInvocation inv)、init()和 destroy()方法的作用</strong></p>\n<ul>\n<li><p>**intercept(ActionInvocation inv)**： 允许 Interceptor 在 ActionInvocation 对请求的其余处理之前和/或之后对请求进行某些 处理，或者使处理短路，并仅返回 String 数值 </p>\n</li>\n<li><p>**init()**： 在 interceptor 生成后产生，但在 interceptor 接受任何请求之前调用，使得 interceptor 进行初始化 </p>\n</li>\n<li><p>**destroy()**： 让 interceptor 清理它产生的资源 </p>\n</li>\n</ul>\n<p><strong>3、defaultStack 拦截器栈中包含的主要拦截功能</strong> </p>\n<ul>\n<li><p><strong>params</strong>：解析 HTTP 请求参数，并设置成 Action 属性 </p>\n</li>\n<li><p><strong>validation</strong>：执行 xxxAction-validate 中定义的校验器 </p>\n</li>\n<li><p><strong>workflow</strong>：调用 Action 中的 validate 方法 </p>\n</li>\n<li><p><strong>i18n</strong>：负责把用户所选的语言、区域放入用户 Session 中。 </p>\n</li>\n<li><p><strong>createSession</strong>：创建 HttpSession 对象 </p>\n</li>\n<li><p><strong>timer</strong>：负责输出 Action 执行时间，分析性能 </p>\n</li>\n<li><p><strong>autowiring</strong>：自动装配，访问 Spring 中的 Bean </p>\n</li>\n</ul>\n<p><strong>4、自定义过滤器的实现方法和配置步骤，将拦截器与过滤器进行比较，并将两者的特点及区别</strong></p>\n<p><strong>配置步骤：</strong></p>\n<p>(1) 创建拦截器类，继承Filter类，重写doFilter方法</p>\n<p>(2) <code>web.xml</code> 文件配置</p>\n<p><strong>拦截器与过滤器特点和区别：</strong> </p>\n<ul>\n<li>拦截器：Struts2 中第二个层次的控制器；允许自定义；需要在 web.xml 文件中配置； </li>\n<li>过滤器：Struts2 控制器的最前端控制器；允许自定义；需要在 struts.xml 文件中配置。 </li>\n</ul>\n<p><strong>5、ValueStack 接口及其主要方法的作用和开发步骤</strong><br>ValueStack 接口中主要方法:findValue(), setValue() </p>\n<p>**findValue()**：通过以默认搜索顺序针对堆栈评估给定表达式来查找值。 </p>\n<p>**setValue()**：使用默认搜索顺序使用给定的表达式在堆栈中的 bean 上设置属性。 </p>\n<p>开发需要引入 <code>com.opensymphony.xwork2.util.ValueStack</code> 并实例化 ValueStack 对象，之后通过方法调用实现相关功能。 </p>\n<p><strong>6、OGNL 可访问的对象和基本语法</strong></p>\n<p>可以直接访问值栈 ValueStack（OGNL 上下文的根对象）；Action 实例被保存在值栈中，因此可以直接访问。 基本语法包含#、%、$三种符号，作用见下文 </p>\n<p><strong>7、OGNL 三种常用符号:#、%和$的作用和使用方法</strong></p>\n<p> <strong>%符号</strong>：计算 OGNL 表达式的值 </p>\n<p> <strong>$符号</strong>：在国际化资源文件中，引用 OGNL 表达式；在 Struts 2 框架配置文件中引用 OGNL 表达式 </p>\n<p> <strong>#符号</strong>：访问 OGNL 上下文和 Action 上下文；构造 Map；过滤和投影集合 </p>\n<p> <strong>8、自定义异常类的方法和步骤</strong> </p>\n<p> （1）创建自定义异常类并继承 Exception 类 </p>\n<p> （2）在 Model 中抛出自定义异常 </p>\n<p> （3）在 Action 中捕获异常 </p>\n<p> （4）在 <code>struts.xml</code> 中设置异常页面导航 </p>\n<p> （5）在 Action 中抛出异常，将其交给框架处理 </p>\n<p> （6）在 <code>struts.xml</code> 中使用标签<exception- mapping>进行异常配置 </p>\n<p> <strong>9、整理 Struts2 框架处理异常的机制，整理 <code>struts.xml</code> 文件配置异常映射的方法以及相关标签的作用</strong> </p>\n<p> Struts2 的异常处理机制是通过在 <code>struts.xml</code> 文件中配置&lt;exception-mapping……/&gt;元素完成，配置该元素时，需要指定两个属性： </p>\n<p> <strong>exception</strong>：指定该异常类型的完全限定名。</p>\n<p> <strong>result</strong>：指定逻辑视图名。 </p>\n<p> 根据<code>&lt;exception-mapping…../&gt;</code>元素出现位置的不同，异常映射又可分为两种： </p>\n<p> <strong>局部异常映射</strong>：将<code>&lt;exception-mapping… /&gt;</code>元素作为<code>&lt;action…/&gt;</code>元素的子元素配置； </p>\n<p> <strong>全局异常映射</strong>：将<code>&lt;exception-mapping… /&gt;</code>元素作为<code>&lt;global-exception-mappings… /&gt;</code> 元素的子元素配置； </p>\n<p> 全局异常映射对所有的 Action 都有效，但局部异常映射仅对该异常映射所在的 Action 有 效。如果局部异常映射和全局异常映射配置了同一个异常类型，在<code>&lt;action…./&gt;</code> 元素内的局部异常映射将覆盖全局异常映射。</p>\n","site":{"data":{}},"excerpt":"<p>包含Struts 工作流程知识梳理、实验总结、实验步骤三方面的总结。</p>","more":"<h2 id=\"知识梳理\"><a href=\"#知识梳理\" class=\"headerlink\" title=\"知识梳理\"></a>知识梳理</h2><p>1、Struts2 的控制器主要由三个层次组成，分别是过滤器、拦截器和业务控制 Action； </p>\n<p>2、过滤器是 Struts2 控制器的最前端控制器，过滤器的使用需要在 <code>web.xml</code> 中进行配置；FilterDispatcher 是 Struts2 应用中必须配置使用的过滤器，该过滤器的主要功能 包括执行 Action、清空 ActionContext 对象等； </p>\n<p>3、拦截器是 Struts2 中第二个层次的控制器，能够在 Action 执行前后完成一些通用功能； </p>\n<p>4、Struts2 内建了大量拦截器， 这些拦截器以 name-class 对的形式配置在 <code>strutsdefault.xml</code> 文件中，如果 <code>struts.xml 中定义的 package 继承了 Struts2 默 认的 </code>struts-default` 包，便可以直接使用默认拦截器栈 defaultStack； </p>\n<p>5、Struts2 也允许自定义拦截器，自定义拦截器类须实现 Interceptor 接口，并覆盖接 口中的 intercept 方法用于实现拦截器的主要功能；自定义拦截器须在 <code>struts.xml</code> 中进 行配置才能使用； </p>\n<p>6、若在 <code>struts.xml</code> 中为 Action 指定了一个拦截器，则默认拦截器栈 defaultStack 将会失效，为了继续使用默认拦截器，必须将其进行显式地配置。</p>\n<p>7、Struts API 中的 <code>com.opensymphony.xwork2.util.ValueStack</code> 称为值栈，值栈是一 个数据区域，该区域中保存了应用范围内的所有数据和 Action 处理的用户请求数据； </p>\n<p>8、值栈被存储在 ActionContext 对象中，因此可以在任何节点访问其中的内容； </p>\n<p>9、ValueStack 接口中主要方法有：<code>Object findValue(String expr)</code>可以通过表达式查 找值栈中对应的值，<code>void setValue(String expr, Object value)</code>用于将对象及其表达式 存到值栈中； </p>\n<p>10、OGNL，即对象图导航语言，是 Struts 默认的表达式语言； </p>\n<p>11、OGNL 基础单位称为导航链，基本的链由属性名、方法调用、数组或集合元素组成；</p>\n<p>12、在 Struts2 中，值栈是 OGNL 上下文的根对象，可以直接访问，而 application、session 等其它对象不是根对象，需要使用#进行访问。</p>\n<p>13、Struts2 应用中使用 Action 调用 Model，因此 Struts2 应用中的异常在 Model 层抛 出后，通常在 Action 类中进行处理； </p>\n<p>14、Action 可以直接使用 try/catch 捕获异常，然后返回结果视图，跳转到相关页面处理 异常； </p>\n<p>15、抛出异常后，也可以不在 Action 类中捕获，而使用 throws 声明异常，交给 Struts2 框架处理； </p>\n<p>16、Struts2 允许通过 <code>struts.xml</code> 文件来配置异常的处理，使用 <code>&lt;exception-mapping&gt;</code> 标签声明异常映射，指定发生该类型异常时跳转的结果视图。</p>\n<h2 id=\"实验总结\"><a href=\"#实验总结\" class=\"headerlink\" title=\"实验总结\"></a>实验总结</h2><p><strong>1、自定义拦截器类的作用和实现方法</strong></p>\n<p><strong>作用：</strong><br>Struts2第二个层次的控制器，能够在Action执行前后完成一些通用功能，完成一些通用的控制逻辑：解析请求参数、类型转换、输入校验、防止表单多次提交。 </p>\n<p><strong>实现方法：</strong></p>\n<p>(1) 创建拦截器Interceptor </p>\n<p>(2) 继承 AbstractInterceptor 类，重写 intercept()方法（AbstractInterceptor 类实现了 Interceptor 接口） </p>\n<p>(3) Action 内使用拦截器 </p>\n<p>(4) 修改 <code>struts.xml</code> 文件，增加拦截器的配置 </p>\n<p><strong>2、Interceptor 接口中 intercept(ActionInvocation inv)、init()和 destroy()方法的作用</strong></p>\n<ul>\n<li><p>**intercept(ActionInvocation inv)**： 允许 Interceptor 在 ActionInvocation 对请求的其余处理之前和/或之后对请求进行某些 处理，或者使处理短路，并仅返回 String 数值 </p>\n</li>\n<li><p>**init()**： 在 interceptor 生成后产生，但在 interceptor 接受任何请求之前调用，使得 interceptor 进行初始化 </p>\n</li>\n<li><p>**destroy()**： 让 interceptor 清理它产生的资源 </p>\n</li>\n</ul>\n<p><strong>3、defaultStack 拦截器栈中包含的主要拦截功能</strong> </p>\n<ul>\n<li><p><strong>params</strong>：解析 HTTP 请求参数，并设置成 Action 属性 </p>\n</li>\n<li><p><strong>validation</strong>：执行 xxxAction-validate 中定义的校验器 </p>\n</li>\n<li><p><strong>workflow</strong>：调用 Action 中的 validate 方法 </p>\n</li>\n<li><p><strong>i18n</strong>：负责把用户所选的语言、区域放入用户 Session 中。 </p>\n</li>\n<li><p><strong>createSession</strong>：创建 HttpSession 对象 </p>\n</li>\n<li><p><strong>timer</strong>：负责输出 Action 执行时间，分析性能 </p>\n</li>\n<li><p><strong>autowiring</strong>：自动装配，访问 Spring 中的 Bean </p>\n</li>\n</ul>\n<p><strong>4、自定义过滤器的实现方法和配置步骤，将拦截器与过滤器进行比较，并将两者的特点及区别</strong></p>\n<p><strong>配置步骤：</strong></p>\n<p>(1) 创建拦截器类，继承Filter类，重写doFilter方法</p>\n<p>(2) <code>web.xml</code> 文件配置</p>\n<p><strong>拦截器与过滤器特点和区别：</strong> </p>\n<ul>\n<li>拦截器：Struts2 中第二个层次的控制器；允许自定义；需要在 web.xml 文件中配置； </li>\n<li>过滤器：Struts2 控制器的最前端控制器；允许自定义；需要在 struts.xml 文件中配置。 </li>\n</ul>\n<p><strong>5、ValueStack 接口及其主要方法的作用和开发步骤</strong><br>ValueStack 接口中主要方法:findValue(), setValue() </p>\n<p>**findValue()**：通过以默认搜索顺序针对堆栈评估给定表达式来查找值。 </p>\n<p>**setValue()**：使用默认搜索顺序使用给定的表达式在堆栈中的 bean 上设置属性。 </p>\n<p>开发需要引入 <code>com.opensymphony.xwork2.util.ValueStack</code> 并实例化 ValueStack 对象，之后通过方法调用实现相关功能。 </p>\n<p><strong>6、OGNL 可访问的对象和基本语法</strong></p>\n<p>可以直接访问值栈 ValueStack（OGNL 上下文的根对象）；Action 实例被保存在值栈中，因此可以直接访问。 基本语法包含#、%、$三种符号，作用见下文 </p>\n<p><strong>7、OGNL 三种常用符号:#、%和$的作用和使用方法</strong></p>\n<p> <strong>%符号</strong>：计算 OGNL 表达式的值 </p>\n<p> <strong>$符号</strong>：在国际化资源文件中，引用 OGNL 表达式；在 Struts 2 框架配置文件中引用 OGNL 表达式 </p>\n<p> <strong>#符号</strong>：访问 OGNL 上下文和 Action 上下文；构造 Map；过滤和投影集合 </p>\n<p> <strong>8、自定义异常类的方法和步骤</strong> </p>\n<p> （1）创建自定义异常类并继承 Exception 类 </p>\n<p> （2）在 Model 中抛出自定义异常 </p>\n<p> （3）在 Action 中捕获异常 </p>\n<p> （4）在 <code>struts.xml</code> 中设置异常页面导航 </p>\n<p> （5）在 Action 中抛出异常，将其交给框架处理 </p>\n<p> （6）在 <code>struts.xml</code> 中使用标签<exception- mapping>进行异常配置 </p>\n<p> <strong>9、整理 Struts2 框架处理异常的机制，整理 <code>struts.xml</code> 文件配置异常映射的方法以及相关标签的作用</strong> </p>\n<p> Struts2 的异常处理机制是通过在 <code>struts.xml</code> 文件中配置&lt;exception-mapping……/&gt;元素完成，配置该元素时，需要指定两个属性： </p>\n<p> <strong>exception</strong>：指定该异常类型的完全限定名。</p>\n<p> <strong>result</strong>：指定逻辑视图名。 </p>\n<p> 根据<code>&lt;exception-mapping…../&gt;</code>元素出现位置的不同，异常映射又可分为两种： </p>\n<p> <strong>局部异常映射</strong>：将<code>&lt;exception-mapping… /&gt;</code>元素作为<code>&lt;action…/&gt;</code>元素的子元素配置； </p>\n<p> <strong>全局异常映射</strong>：将<code>&lt;exception-mapping… /&gt;</code>元素作为<code>&lt;global-exception-mappings… /&gt;</code> 元素的子元素配置； </p>\n<p> 全局异常映射对所有的 Action 都有效，但局部异常映射仅对该异常映射所在的 Action 有 效。如果局部异常映射和全局异常映射配置了同一个异常类型，在<code>&lt;action…./&gt;</code> 元素内的局部异常映射将覆盖全局异常映射。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":null,"popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:50 GMT+0800 (中国标准时间)","title":"Struts 工作流程总结","path":"2020/02/24/Struts_Workflow/","eyeCatchImage":null,"excerpt":"<p>包含Struts 工作流程知识梳理、实验总结、实验步骤三方面的总结。</p>","date":{"_isAMomentObject":true,"_i":"2020-02-24T03:10:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-02-24T03:10:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["struts","JavaEE","总结","workflow"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":3289},{"title":"SwiftUI开发初探","date":"2021-07-15T07:20:20.000Z","copyright":true,"_content":"\n最近使用 SwiftUI 完成了一部分项目的编写，我将完成项目时使用 SwiftUI 进行开发的体验做简单的总结。本文也同时发表于网易KM平台。\n\n<!--more-->\n\n# 最近项目\n\n- 基于知识图谱的推荐系统的设计与实现（客户端部分采用 SwiftUI 实现）\n\n![](http://image.stephenfang.me/mweb/Recommender.png)\n\n![](http://image.stephenfang.me/mweb/Structure.png)\n\n- 知识图谱入门简介（UI 部分采用 SwiftUI 实现，WWDC Swift Student Challenge获奖项目）\n\n[iamStephenFang/KnowledgeGraph](https://github.com/iamStephenFang/KnowledgeGraph)\n\n![](http://image.stephenfang.me/mweb/KG.png)\n\n- FinMatters（一款采用 SwiftUI 编写的理财 App）\n\n![](http://image.stephenfang.me/mweb/Fin.png)\n\n# 哪些优点\n\n## 指令式编程 VS 声明式编程\n\n指令式编程逐条指示计算机**怎么做，**注重于**描述过程**\n\n- 运算语句：let a = 1 + 2\n- 循环语句: for while\n- 条件语句: if switch\n\n## 声明式编程教会计算机**做什么，**注重于**描述结果**\n\n- Map： let squares = nums.map {$0* $0}\n- Reduce： let total = nums.reduce(10.0,+)\n- Filter： let evens = nums.filter { $0% 2 == 0 }\n\n## 声明式UI\n\n1.View并不负责渲染，并非传统意义的视图层级，而是对视图组织关系的声明\n\n2.决定 UI 状态的状态 State 存储在对象之中\n\n3.View = func(State)通过控制和改变 State来得到确定的 View\n\n4.State 改变时调用上述函数获取新的 State 的 View，重新渲染更改部分\n\n## 开发体验\n\n- UIKit 组件混编成本不高\n- 复杂视图减少代码量\n- Model-View-ViewModel\n- 动画、效果、手势实现简单\n\n![](http://image.stephenfang.me/mweb/Code1.png)\n\n## 其他特性\n\n- 在 iPad 上的 Swift Playground编写 SwiftUI 相关代码\n\n![](http://image.stephenfang.me/mweb/PG.png)\n\n- 在 Xcode 中可以实现实时的、可响应的预览\n\n![](http://image.stephenfang.me/mweb/Demo.png)\n\n- 跨端开发压力小，实现iOS、iPadOS、watchOS、macOS同步开发\n\n![](http://image.stephenfang.me/mweb/CP.png)\n\n# 哪些缺点\n\n## 兼容性\n\n- 发布于 WWDC19\n- Xcode 11.0+\n- iOS 13.0+\n- 网易云音乐iOS 11.0+\n\n## 组件开发\n\n表面上 SwiftUI 集成了很多可用的组件，但在实现自定义组件时还是需要自行编写元组件相关的代码，并且目前三方组件库可选择的项目较少。\n\n![](http://image.stephenfang.me/mweb/Code2.png)\n\n![](http://image.stephenfang.me/mweb/Code3.png)\n\n![](http://image.stephenfang.me/mweb/Fin2.png)\n\n原生组件可供更改的样式极其有限，有时候一些问题的解决方案代码并不优雅，比如导航栏只能手动隐藏、全屏状态下无法展示Modal、List 的分割线无法移除等等。\n\n![](http://image.stephenfang.me/mweb/Code4.png)\n\n```swift\nvar body: some View {\n        NavigationView{\n            ZStack {\n                Color(\"Background\").ignoresSafeArea()\n                VStack{\n                    TopNavView(navDesc: “总览\")\n                        .padding(.horizontal)\n                        .padding(.top, 0)\n                    \n                    VStack{}\n\t      / *** 省略内容 ***/\n                .navigationTitle(\"\")\n                .navigationBarHidden(true)\n            }\n        }\n    }\n```\n\n## 组件缺失\n\n- WKWebView 混编\n\n![](http://image.stephenfang.me/mweb/Code4.png)\n\n- SwiftUIX [https://github.com/SwiftUIX/SwiftUIX](https://github.com/SwiftUIX/SwiftUIX)\n- SwiftUI-Introspect [https://github.com/SwiftUIX/SwiftUIX](https://github.com/SwiftUIX/SwiftUIX)\n\n## 开发体验问题\n\n- 寻找问题答案成本较高，Stack Overflow可能都未收录\n- API 在 SwiftUI 大版本更新时存在差别\n- View Hierarchy 检查器无法使用\n- Live Preview 渲染经常出错且消耗大量性能\n- 错误信息有时存在误导\n\n# 最后总结\n\n- 目前适合个人开发者开发个人项目\n- 两年内随着老款iOS设备的淘汰能够看到更多的 SwiftUI 应用\n- SwiftUI 与 Combine 的结合\n- 苹果平台应用有跨端需求可以减少开发成本\n- 开发体验上好于 Flutter、React Native\n\n# 参考链接\n\n1. https://designcode.io/swiftui2-course\n2. https://www.raywenderlich.com/19611194-multiplatform-app-tutorial-swiftui-and-xcode-12\n3. https://www.fivestars.blog/articles/custom-view-styles/\n4. https://objccn.io/products/functional-swift/\n5. https://objccn.io/products/swift-ui\n6. https://www.fivestars.blog/articles/swiftui-hud/","source":"_posts/SwiftUIExploration.md","raw":"---\ntitle: SwiftUI开发初探\ndate: 2021-07-15 15:20:20\ncategories: \n- 技术\ntags: \n- iOS\n- SwiftUI\n- Swift\ncopyright: true\n---\n\n最近使用 SwiftUI 完成了一部分项目的编写，我将完成项目时使用 SwiftUI 进行开发的体验做简单的总结。本文也同时发表于网易KM平台。\n\n<!--more-->\n\n# 最近项目\n\n- 基于知识图谱的推荐系统的设计与实现（客户端部分采用 SwiftUI 实现）\n\n![](http://image.stephenfang.me/mweb/Recommender.png)\n\n![](http://image.stephenfang.me/mweb/Structure.png)\n\n- 知识图谱入门简介（UI 部分采用 SwiftUI 实现，WWDC Swift Student Challenge获奖项目）\n\n[iamStephenFang/KnowledgeGraph](https://github.com/iamStephenFang/KnowledgeGraph)\n\n![](http://image.stephenfang.me/mweb/KG.png)\n\n- FinMatters（一款采用 SwiftUI 编写的理财 App）\n\n![](http://image.stephenfang.me/mweb/Fin.png)\n\n# 哪些优点\n\n## 指令式编程 VS 声明式编程\n\n指令式编程逐条指示计算机**怎么做，**注重于**描述过程**\n\n- 运算语句：let a = 1 + 2\n- 循环语句: for while\n- 条件语句: if switch\n\n## 声明式编程教会计算机**做什么，**注重于**描述结果**\n\n- Map： let squares = nums.map {$0* $0}\n- Reduce： let total = nums.reduce(10.0,+)\n- Filter： let evens = nums.filter { $0% 2 == 0 }\n\n## 声明式UI\n\n1.View并不负责渲染，并非传统意义的视图层级，而是对视图组织关系的声明\n\n2.决定 UI 状态的状态 State 存储在对象之中\n\n3.View = func(State)通过控制和改变 State来得到确定的 View\n\n4.State 改变时调用上述函数获取新的 State 的 View，重新渲染更改部分\n\n## 开发体验\n\n- UIKit 组件混编成本不高\n- 复杂视图减少代码量\n- Model-View-ViewModel\n- 动画、效果、手势实现简单\n\n![](http://image.stephenfang.me/mweb/Code1.png)\n\n## 其他特性\n\n- 在 iPad 上的 Swift Playground编写 SwiftUI 相关代码\n\n![](http://image.stephenfang.me/mweb/PG.png)\n\n- 在 Xcode 中可以实现实时的、可响应的预览\n\n![](http://image.stephenfang.me/mweb/Demo.png)\n\n- 跨端开发压力小，实现iOS、iPadOS、watchOS、macOS同步开发\n\n![](http://image.stephenfang.me/mweb/CP.png)\n\n# 哪些缺点\n\n## 兼容性\n\n- 发布于 WWDC19\n- Xcode 11.0+\n- iOS 13.0+\n- 网易云音乐iOS 11.0+\n\n## 组件开发\n\n表面上 SwiftUI 集成了很多可用的组件，但在实现自定义组件时还是需要自行编写元组件相关的代码，并且目前三方组件库可选择的项目较少。\n\n![](http://image.stephenfang.me/mweb/Code2.png)\n\n![](http://image.stephenfang.me/mweb/Code3.png)\n\n![](http://image.stephenfang.me/mweb/Fin2.png)\n\n原生组件可供更改的样式极其有限，有时候一些问题的解决方案代码并不优雅，比如导航栏只能手动隐藏、全屏状态下无法展示Modal、List 的分割线无法移除等等。\n\n![](http://image.stephenfang.me/mweb/Code4.png)\n\n```swift\nvar body: some View {\n        NavigationView{\n            ZStack {\n                Color(\"Background\").ignoresSafeArea()\n                VStack{\n                    TopNavView(navDesc: “总览\")\n                        .padding(.horizontal)\n                        .padding(.top, 0)\n                    \n                    VStack{}\n\t      / *** 省略内容 ***/\n                .navigationTitle(\"\")\n                .navigationBarHidden(true)\n            }\n        }\n    }\n```\n\n## 组件缺失\n\n- WKWebView 混编\n\n![](http://image.stephenfang.me/mweb/Code4.png)\n\n- SwiftUIX [https://github.com/SwiftUIX/SwiftUIX](https://github.com/SwiftUIX/SwiftUIX)\n- SwiftUI-Introspect [https://github.com/SwiftUIX/SwiftUIX](https://github.com/SwiftUIX/SwiftUIX)\n\n## 开发体验问题\n\n- 寻找问题答案成本较高，Stack Overflow可能都未收录\n- API 在 SwiftUI 大版本更新时存在差别\n- View Hierarchy 检查器无法使用\n- Live Preview 渲染经常出错且消耗大量性能\n- 错误信息有时存在误导\n\n# 最后总结\n\n- 目前适合个人开发者开发个人项目\n- 两年内随着老款iOS设备的淘汰能够看到更多的 SwiftUI 应用\n- SwiftUI 与 Combine 的结合\n- 苹果平台应用有跨端需求可以减少开发成本\n- 开发体验上好于 Flutter、React Native\n\n# 参考链接\n\n1. https://designcode.io/swiftui2-course\n2. https://www.raywenderlich.com/19611194-multiplatform-app-tutorial-swiftui-and-xcode-12\n3. https://www.fivestars.blog/articles/custom-view-styles/\n4. https://objccn.io/products/functional-swift/\n5. https://objccn.io/products/swift-ui\n6. https://www.fivestars.blog/articles/swiftui-hud/","slug":"SwiftUIExploration","published":1,"updated":"2022-07-24T16:01:12.019Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp37006io76f9bmq3khy","content":"<p>最近使用 SwiftUI 完成了一部分项目的编写，我将完成项目时使用 SwiftUI 进行开发的体验做简单的总结。本文也同时发表于网易KM平台。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"最近项目\"><a href=\"#最近项目\" class=\"headerlink\" title=\"最近项目\"></a>最近项目</h1><ul>\n<li>基于知识图谱的推荐系统的设计与实现（客户端部分采用 SwiftUI 实现）</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Recommender.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Structure.png\"></p>\n<ul>\n<li>知识图谱入门简介（UI 部分采用 SwiftUI 实现，WWDC Swift Student Challenge获奖项目）</li>\n</ul>\n<p><a href=\"https://github.com/iamStephenFang/KnowledgeGraph\">iamStephenFang/KnowledgeGraph</a></p>\n<p><img src=\"http://image.stephenfang.me/mweb/KG.png\"></p>\n<ul>\n<li>FinMatters（一款采用 SwiftUI 编写的理财 App）</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Fin.png\"></p>\n<h1 id=\"哪些优点\"><a href=\"#哪些优点\" class=\"headerlink\" title=\"哪些优点\"></a>哪些优点</h1><h2 id=\"指令式编程-VS-声明式编程\"><a href=\"#指令式编程-VS-声明式编程\" class=\"headerlink\" title=\"指令式编程 VS 声明式编程\"></a>指令式编程 VS 声明式编程</h2><p>指令式编程逐条指示计算机<strong>怎么做，</strong>注重于<strong>描述过程</strong></p>\n<ul>\n<li>运算语句：let a = 1 + 2</li>\n<li>循环语句: for while</li>\n<li>条件语句: if switch</li>\n</ul>\n<h2 id=\"声明式编程教会计算机做什么，注重于描述结果\"><a href=\"#声明式编程教会计算机做什么，注重于描述结果\" class=\"headerlink\" title=\"声明式编程教会计算机做什么，注重于描述结果\"></a>声明式编程教会计算机<strong>做什么，</strong>注重于<strong>描述结果</strong></h2><ul>\n<li>Map： let squares = nums.map {$0* $0}</li>\n<li>Reduce： let total = nums.reduce(10.0,+)</li>\n<li>Filter： let evens = nums.filter { $0% 2 == 0 }</li>\n</ul>\n<h2 id=\"声明式UI\"><a href=\"#声明式UI\" class=\"headerlink\" title=\"声明式UI\"></a>声明式UI</h2><p>1.View并不负责渲染，并非传统意义的视图层级，而是对视图组织关系的声明</p>\n<p>2.决定 UI 状态的状态 State 存储在对象之中</p>\n<p>3.View = func(State)通过控制和改变 State来得到确定的 View</p>\n<p>4.State 改变时调用上述函数获取新的 State 的 View，重新渲染更改部分</p>\n<h2 id=\"开发体验\"><a href=\"#开发体验\" class=\"headerlink\" title=\"开发体验\"></a>开发体验</h2><ul>\n<li>UIKit 组件混编成本不高</li>\n<li>复杂视图减少代码量</li>\n<li>Model-View-ViewModel</li>\n<li>动画、效果、手势实现简单</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Code1.png\"></p>\n<h2 id=\"其他特性\"><a href=\"#其他特性\" class=\"headerlink\" title=\"其他特性\"></a>其他特性</h2><ul>\n<li>在 iPad 上的 Swift Playground编写 SwiftUI 相关代码</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/PG.png\"></p>\n<ul>\n<li>在 Xcode 中可以实现实时的、可响应的预览</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Demo.png\"></p>\n<ul>\n<li>跨端开发压力小，实现iOS、iPadOS、watchOS、macOS同步开发</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/CP.png\"></p>\n<h1 id=\"哪些缺点\"><a href=\"#哪些缺点\" class=\"headerlink\" title=\"哪些缺点\"></a>哪些缺点</h1><h2 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h2><ul>\n<li>发布于 WWDC19</li>\n<li>Xcode 11.0+</li>\n<li>iOS 13.0+</li>\n<li>网易云音乐iOS 11.0+</li>\n</ul>\n<h2 id=\"组件开发\"><a href=\"#组件开发\" class=\"headerlink\" title=\"组件开发\"></a>组件开发</h2><p>表面上 SwiftUI 集成了很多可用的组件，但在实现自定义组件时还是需要自行编写元组件相关的代码，并且目前三方组件库可选择的项目较少。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Code2.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Code3.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Fin2.png\"></p>\n<p>原生组件可供更改的样式极其有限，有时候一些问题的解决方案代码并不优雅，比如导航栏只能手动隐藏、全屏状态下无法展示Modal、List 的分割线无法移除等等。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Code4.png\"></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> body: <span class=\"keyword\">some</span> <span class=\"type\">View</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">NavigationView</span>&#123;</span><br><span class=\"line\">            <span class=\"type\">ZStack</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">Color</span>(<span class=\"string\">&quot;Background&quot;</span>).ignoresSafeArea()</span><br><span class=\"line\">                <span class=\"type\">VStack</span>&#123;</span><br><span class=\"line\">                    <span class=\"type\">TopNavView</span>(navDesc: “总览<span class=\"string\">&quot;)</span></span><br><span class=\"line\"><span class=\"string\">                        .padding(.horizontal)</span></span><br><span class=\"line\"><span class=\"string\">                        .padding(.top, 0)</span></span><br><span class=\"line\"><span class=\"string\">                    </span></span><br><span class=\"line\"><span class=\"string\">                    VStack&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t      / *** 省略内容 ***/</span></span><br><span class=\"line\"><span class=\"string\">                .navigationTitle(&quot;</span><span class=\"string\">&quot;)</span></span><br><span class=\"line\"><span class=\"string\">                .navigationBarHidden(true)</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"组件缺失\"><a href=\"#组件缺失\" class=\"headerlink\" title=\"组件缺失\"></a>组件缺失</h2><ul>\n<li>WKWebView 混编</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Code4.png\"></p>\n<ul>\n<li>SwiftUIX <a href=\"https://github.com/SwiftUIX/SwiftUIX\">https://github.com/SwiftUIX/SwiftUIX</a></li>\n<li>SwiftUI-Introspect <a href=\"https://github.com/SwiftUIX/SwiftUIX\">https://github.com/SwiftUIX/SwiftUIX</a></li>\n</ul>\n<h2 id=\"开发体验问题\"><a href=\"#开发体验问题\" class=\"headerlink\" title=\"开发体验问题\"></a>开发体验问题</h2><ul>\n<li>寻找问题答案成本较高，Stack Overflow可能都未收录</li>\n<li>API 在 SwiftUI 大版本更新时存在差别</li>\n<li>View Hierarchy 检查器无法使用</li>\n<li>Live Preview 渲染经常出错且消耗大量性能</li>\n<li>错误信息有时存在误导</li>\n</ul>\n<h1 id=\"最后总结\"><a href=\"#最后总结\" class=\"headerlink\" title=\"最后总结\"></a>最后总结</h1><ul>\n<li>目前适合个人开发者开发个人项目</li>\n<li>两年内随着老款iOS设备的淘汰能够看到更多的 SwiftUI 应用</li>\n<li>SwiftUI 与 Combine 的结合</li>\n<li>苹果平台应用有跨端需求可以减少开发成本</li>\n<li>开发体验上好于 Flutter、React Native</li>\n</ul>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ol>\n<li><a href=\"https://designcode.io/swiftui2-course\">https://designcode.io/swiftui2-course</a></li>\n<li><a href=\"https://www.raywenderlich.com/19611194-multiplatform-app-tutorial-swiftui-and-xcode-12\">https://www.raywenderlich.com/19611194-multiplatform-app-tutorial-swiftui-and-xcode-12</a></li>\n<li><a href=\"https://www.fivestars.blog/articles/custom-view-styles/\">https://www.fivestars.blog/articles/custom-view-styles/</a></li>\n<li><a href=\"https://objccn.io/products/functional-swift/\">https://objccn.io/products/functional-swift/</a></li>\n<li><a href=\"https://objccn.io/products/swift-ui\">https://objccn.io/products/swift-ui</a></li>\n<li><a href=\"https://www.fivestars.blog/articles/swiftui-hud/\">https://www.fivestars.blog/articles/swiftui-hud/</a></li>\n</ol>\n","site":{"data":{}},"excerpt":"<p>最近使用 SwiftUI 完成了一部分项目的编写，我将完成项目时使用 SwiftUI 进行开发的体验做简单的总结。本文也同时发表于网易KM平台。</p>","more":"<h1 id=\"最近项目\"><a href=\"#最近项目\" class=\"headerlink\" title=\"最近项目\"></a>最近项目</h1><ul>\n<li>基于知识图谱的推荐系统的设计与实现（客户端部分采用 SwiftUI 实现）</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Recommender.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Structure.png\"></p>\n<ul>\n<li>知识图谱入门简介（UI 部分采用 SwiftUI 实现，WWDC Swift Student Challenge获奖项目）</li>\n</ul>\n<p><a href=\"https://github.com/iamStephenFang/KnowledgeGraph\">iamStephenFang/KnowledgeGraph</a></p>\n<p><img src=\"http://image.stephenfang.me/mweb/KG.png\"></p>\n<ul>\n<li>FinMatters（一款采用 SwiftUI 编写的理财 App）</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Fin.png\"></p>\n<h1 id=\"哪些优点\"><a href=\"#哪些优点\" class=\"headerlink\" title=\"哪些优点\"></a>哪些优点</h1><h2 id=\"指令式编程-VS-声明式编程\"><a href=\"#指令式编程-VS-声明式编程\" class=\"headerlink\" title=\"指令式编程 VS 声明式编程\"></a>指令式编程 VS 声明式编程</h2><p>指令式编程逐条指示计算机<strong>怎么做，</strong>注重于<strong>描述过程</strong></p>\n<ul>\n<li>运算语句：let a = 1 + 2</li>\n<li>循环语句: for while</li>\n<li>条件语句: if switch</li>\n</ul>\n<h2 id=\"声明式编程教会计算机做什么，注重于描述结果\"><a href=\"#声明式编程教会计算机做什么，注重于描述结果\" class=\"headerlink\" title=\"声明式编程教会计算机做什么，注重于描述结果\"></a>声明式编程教会计算机<strong>做什么，</strong>注重于<strong>描述结果</strong></h2><ul>\n<li>Map： let squares = nums.map {$0* $0}</li>\n<li>Reduce： let total = nums.reduce(10.0,+)</li>\n<li>Filter： let evens = nums.filter { $0% 2 == 0 }</li>\n</ul>\n<h2 id=\"声明式UI\"><a href=\"#声明式UI\" class=\"headerlink\" title=\"声明式UI\"></a>声明式UI</h2><p>1.View并不负责渲染，并非传统意义的视图层级，而是对视图组织关系的声明</p>\n<p>2.决定 UI 状态的状态 State 存储在对象之中</p>\n<p>3.View = func(State)通过控制和改变 State来得到确定的 View</p>\n<p>4.State 改变时调用上述函数获取新的 State 的 View，重新渲染更改部分</p>\n<h2 id=\"开发体验\"><a href=\"#开发体验\" class=\"headerlink\" title=\"开发体验\"></a>开发体验</h2><ul>\n<li>UIKit 组件混编成本不高</li>\n<li>复杂视图减少代码量</li>\n<li>Model-View-ViewModel</li>\n<li>动画、效果、手势实现简单</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Code1.png\"></p>\n<h2 id=\"其他特性\"><a href=\"#其他特性\" class=\"headerlink\" title=\"其他特性\"></a>其他特性</h2><ul>\n<li>在 iPad 上的 Swift Playground编写 SwiftUI 相关代码</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/PG.png\"></p>\n<ul>\n<li>在 Xcode 中可以实现实时的、可响应的预览</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Demo.png\"></p>\n<ul>\n<li>跨端开发压力小，实现iOS、iPadOS、watchOS、macOS同步开发</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/CP.png\"></p>\n<h1 id=\"哪些缺点\"><a href=\"#哪些缺点\" class=\"headerlink\" title=\"哪些缺点\"></a>哪些缺点</h1><h2 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h2><ul>\n<li>发布于 WWDC19</li>\n<li>Xcode 11.0+</li>\n<li>iOS 13.0+</li>\n<li>网易云音乐iOS 11.0+</li>\n</ul>\n<h2 id=\"组件开发\"><a href=\"#组件开发\" class=\"headerlink\" title=\"组件开发\"></a>组件开发</h2><p>表面上 SwiftUI 集成了很多可用的组件，但在实现自定义组件时还是需要自行编写元组件相关的代码，并且目前三方组件库可选择的项目较少。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Code2.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Code3.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/Fin2.png\"></p>\n<p>原生组件可供更改的样式极其有限，有时候一些问题的解决方案代码并不优雅，比如导航栏只能手动隐藏、全屏状态下无法展示Modal、List 的分割线无法移除等等。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Code4.png\"></p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> body: <span class=\"keyword\">some</span> <span class=\"type\">View</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">NavigationView</span>&#123;</span><br><span class=\"line\">            <span class=\"type\">ZStack</span> &#123;</span><br><span class=\"line\">                <span class=\"type\">Color</span>(<span class=\"string\">&quot;Background&quot;</span>).ignoresSafeArea()</span><br><span class=\"line\">                <span class=\"type\">VStack</span>&#123;</span><br><span class=\"line\">                    <span class=\"type\">TopNavView</span>(navDesc: “总览<span class=\"string\">&quot;)</span></span><br><span class=\"line\"><span class=\"string\">                        .padding(.horizontal)</span></span><br><span class=\"line\"><span class=\"string\">                        .padding(.top, 0)</span></span><br><span class=\"line\"><span class=\"string\">                    </span></span><br><span class=\"line\"><span class=\"string\">                    VStack&#123;&#125;</span></span><br><span class=\"line\"><span class=\"string\">\t      / *** 省略内容 ***/</span></span><br><span class=\"line\"><span class=\"string\">                .navigationTitle(&quot;</span><span class=\"string\">&quot;)</span></span><br><span class=\"line\"><span class=\"string\">                .navigationBarHidden(true)</span></span><br><span class=\"line\"><span class=\"string\">            &#125;</span></span><br><span class=\"line\"><span class=\"string\">        &#125;</span></span><br><span class=\"line\"><span class=\"string\">    &#125;</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"组件缺失\"><a href=\"#组件缺失\" class=\"headerlink\" title=\"组件缺失\"></a>组件缺失</h2><ul>\n<li>WKWebView 混编</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/Code4.png\"></p>\n<ul>\n<li>SwiftUIX <a href=\"https://github.com/SwiftUIX/SwiftUIX\">https://github.com/SwiftUIX/SwiftUIX</a></li>\n<li>SwiftUI-Introspect <a href=\"https://github.com/SwiftUIX/SwiftUIX\">https://github.com/SwiftUIX/SwiftUIX</a></li>\n</ul>\n<h2 id=\"开发体验问题\"><a href=\"#开发体验问题\" class=\"headerlink\" title=\"开发体验问题\"></a>开发体验问题</h2><ul>\n<li>寻找问题答案成本较高，Stack Overflow可能都未收录</li>\n<li>API 在 SwiftUI 大版本更新时存在差别</li>\n<li>View Hierarchy 检查器无法使用</li>\n<li>Live Preview 渲染经常出错且消耗大量性能</li>\n<li>错误信息有时存在误导</li>\n</ul>\n<h1 id=\"最后总结\"><a href=\"#最后总结\" class=\"headerlink\" title=\"最后总结\"></a>最后总结</h1><ul>\n<li>目前适合个人开发者开发个人项目</li>\n<li>两年内随着老款iOS设备的淘汰能够看到更多的 SwiftUI 应用</li>\n<li>SwiftUI 与 Combine 的结合</li>\n<li>苹果平台应用有跨端需求可以减少开发成本</li>\n<li>开发体验上好于 Flutter、React Native</li>\n</ul>\n<h1 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h1><ol>\n<li><a href=\"https://designcode.io/swiftui2-course\">https://designcode.io/swiftui2-course</a></li>\n<li><a href=\"https://www.raywenderlich.com/19611194-multiplatform-app-tutorial-swiftui-and-xcode-12\">https://www.raywenderlich.com/19611194-multiplatform-app-tutorial-swiftui-and-xcode-12</a></li>\n<li><a href=\"https://www.fivestars.blog/articles/custom-view-styles/\">https://www.fivestars.blog/articles/custom-view-styles/</a></li>\n<li><a href=\"https://objccn.io/products/functional-swift/\">https://objccn.io/products/functional-swift/</a></li>\n<li><a href=\"https://objccn.io/products/swift-ui\">https://objccn.io/products/swift-ui</a></li>\n<li><a href=\"https://www.fivestars.blog/articles/swiftui-hud/\">https://www.fivestars.blog/articles/swiftui-hud/</a></li>\n</ol>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/Recommender.png","popularPost_tmp_gaData":{"updated":"Mon Jul 25 2022 00:01:12 GMT+0800 (中国标准时间)","title":"SwiftUI开发初探","path":"2021/07/15/SwiftUIExploration/","eyeCatchImage":"http://image.stephenfang.me/mweb/Recommender.png","excerpt":"<p>最近使用 SwiftUI 完成了一部分项目的编写，我将完成项目时使用 SwiftUI 进行开发的体验做简单的总结。本文也同时发表于网易KM平台。</p>","date":{"_isAMomentObject":true,"_i":"2021-07-15T07:20:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2021-07-15T07:20:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","Swift","SwiftUI"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":1868},{"title":"WEKA数据挖掘 - 关联算法","date":"2020-04-22T04:23:20.000Z","copyright":true,"_content":"\n本文总结了 WEKA 中 Apriori关联 与 FPgrowth关联 的操作方法。\n\n<!--more-->\n\n### 实验简介\n关联规则表示不同数据项目在同一事件中出现的相关性，下图中超市市场分析员分析顾客购买商品的场景可以直观地理解关联规则。 \n\n![](http://image.stephenfang.me/mweb/15877849125580.jpg)\n\n顾客购买面包同时也购买牛奶的购物模式可以用以下关联规则表示：\n```\n面包 => 牛奶 [ 支持度 =2%, 置信度 =60%]\n```\n其中面包是规则前项（Antecedent），牛奶是规则后项 (Consequent)。实例数（Instances）表示所有购买记录中包含面包的记录的数量。支持度（Support）表示购买面包的记录数占所有购买记录数的百分比。规则支持度（Rule Support）表示同时购买面包和牛奶的记录数占所有的购买记录数的百分比。置信度（confidence）表示同时购买面包和牛奶的记录数占购买面包记录数的百分比。提升（Lift）表示置信度与已知购买牛奶的百分比的比值，提升大于 1 的规则才是有意义的。\n如果关联满足最小支持度阈值和最小置信度阈值就可以认为关联规则是有意义的。这些阈值由用户或领域专家设定。就顾客购物而言，根据以往的购买记录，找出满足最小支持度阈值和最小置信度阈值的关联规则，就找到顾客经常同时购买的商品。\n\n#### Apriori\nApriori算法是第一个关联规则挖掘算法，也是最经典的算法。它利用逐层搜索的迭代方法找出数据库中项集的关系，以形成规则，其过程由连接（类矩阵运算）与剪枝（去掉那些没必要的中间结果）组成。\n本次实验中有如下步骤：\n- 使用 WEKA 的 Apriori 策略对数据集进行关联操作\n- 查看并分析关联结果\n- 分析 Apriori 的算法与特征\n\n#### FPgrowth\nApriori算法在产生频繁模式完全集前需要对数据库进行多次扫描，同时产生大量的候选频繁集，这就使Apriori算法时间和空间复杂度较大。\nFP-Growth算法针对Apriori算法在挖掘长频繁模式时性能低下的特点提出了改进，它采取如下分治策略：将提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息。FP-Growth算法使用了一种称为频繁模式树（Frequent Pattern Tree）的数据结构，FP-tree是一种特殊的前缀树，由频繁项头表和项前缀树构成。FP-Growth算法基于以上的结构加快整个挖掘过程。\n实验包含如下步骤：\n- 使用 WEKA 的FPgrowth 策略对数据集进行关联操作\n- \t查看并分析关联结果\n- \t对比分析 FPgrowth 策略与 Apriori 策略的效果\n\n### 实验数据\n本次实验的数据我参照Waikato大学的数据挖掘教程，选择了vote.arff 数据集，这是一个关于1984年美国国会投票记录数据集，其中包含投票者的身份（民主党人或共和党人）以及多项议题的投票结果，如下图所示：\n![](http://image.stephenfang.me/mweb/15877850041138.jpg)\n![](http://image.stephenfang.me/test-1.png)\n这个数据集包含435条实例（投票信息），其中包含 267 位民主党人投票信息, 168 位共和党人投票信息。投票结果中有移民（immigration）、教育开支（education-spending）、、免税出口（duty-free-exports）等共16个议题。议员对于议题的表决不仅仅只用简单的“Y”、“N”标记，需要注意的是，被标记为“？”的数据并不是代表数据的缺失，可能代表议员持保留意见没有表决，部分数据集摘录如下：\n\n![](http://image.stephenfang.me/mweb/15877851693946.jpg)\n\n由于数据集经过实验验证，数据已完成去噪声处理，并且数据中的“？”并非代表数据缺失，前文交代了相关意义，故不复进行数据预处理的步骤。\n### 算法简介\n#### Apriori\nApriori算法的主要思想为：首先找出所有频繁性至少和预定义的最小支持度一样的频繁项集，由频繁项集产生满足最小支持度和最小可信度的强关联规则，然后使用频繁项集产生期望的规则，产生只包含集合的项的所有规则，每一条规则的右部只有一项。一旦这些规则生成，那么只有那些大于用户给定的最小可信度的规则才被保留。\nApriori算法利用了“任一频繁项集的所有非空子集必须是频繁的”这一个性质。举例说，如果 {0, 1} 是频繁的，那么 {0}, {1} 也是频繁的，将条件倒置，可得“如果一个项集是非频繁项集，那么它的所有超集也是非频繁项集”这一结论。在算法流程中，首先需要找出频繁1-项集，记为L1；然后用L1来产生候选项集C2，对C2中的项进行判定挖掘产生L2，即频繁2-项集；如此循环往复直至无法发现更多的频繁k-项集。\n由于Apriori算法每挖掘一层Lk就需要扫描整个数据库一遍，会产生大量的候选频繁集，使得Apriori算法时间和空间复杂度较大，以下为简单的算法示意图。\n\n![](http://image.stephenfang.me/mweb/15877852247683.jpg)\n\n#### FP-Growth\nFP-Growth算法针对Apriori算法在挖掘时可能出现的性能低下问题提出了改进，无论多少数据，只需要扫描两次数据集，提高了算法运行的效率。FP-Growth算法提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息，基于频繁模式树加快整个挖掘过程。\nFP-Growth算法思路即不断迭代FP-tree的构造和投影过程，其算法过程大致如下：\n1.\t扫描数据集一次，找到频繁1-项集(单项模式)\n2.\t按频率降序对频繁项排序\n3.\t再次扫描数据集，按F-list的逆序构造条件FP树\n4.\t按F-list的逆序构造条件FP树，生成频繁项目集\n\n### 实验过程\n#### Apriori\n使用WEKA进行Apriori相关性分析，其生成结果如下所示，WEKA默认显示十条最佳item sets结果。\n\n```\nApriori\n=======\n\nMinimum support: 0.45 (196 instances)\nMinimum metric <confidence>: 0.9\nNumber of cycles performed: 11\n\nGenerated sets of large itemsets:\n\nSize of set of large itemsets L(1): 20\n\nSize of set of large itemsets L(2): 17\n\nSize of set of large itemsets L(3): 6\n\nSize of set of large itemsets L(4): 1\n\nBest rules found:\n\n 1. adoption-of-the-budget-resolution=y physician-fee-freeze=n 219 ==> Class=democrat 219    <conf:(1)> lift:(1.63) lev:(0.19) [84] conv:(84.58)\n 2. adoption-of-the-budget-resolution=y physician-fee-freeze=n aid-to-nicaraguan-contras=y 198 ==> Class=democrat 198    <conf:(1)> lift:(1.63) lev:(0.18) [76] conv:(76.47)\n 3. physician-fee-freeze=n aid-to-nicaraguan-contras=y 211 ==> Class=democrat 210    <conf:(1)> lift:(1.62) lev:(0.19) [80] conv:(40.74)\n 4. physician-fee-freeze=n education-spending=n 202 ==> Class=democrat 201    <conf:(1)> lift:(1.62) lev:(0.18) [77] conv:(39.01)\n 5. physician-fee-freeze=n 247 ==> Class=democrat 245    <conf:(0.99)> lift:(1.62) lev:(0.21) [93] conv:(31.8)\n 6. el-salvador-aid=n Class=democrat 200 ==> aid-to-nicaraguan-contras=y 197    <conf:(0.98)> lift:(1.77) lev:(0.2) [85] conv:(22.18)\n 7. el-salvador-aid=n 208 ==> aid-to-nicaraguan-contras=y 204    <conf:(0.98)> lift:(1.76) lev:(0.2) [88] conv:(18.46)\n 8. adoption-of-the-budget-resolution=y aid-to-nicaraguan-contras=y Class=democrat 203 ==> physician-fee-freeze=n 198    <conf:(0.98)> lift:(1.72) lev:(0.19) [82] conv:(14.62)\n 9. el-salvador-aid=n aid-to-nicaraguan-contras=y 204 ==> Class=democrat 197    <conf:(0.97)> lift:(1.57) lev:(0.17) [71] conv:(9.85)\n10. aid-to-nicaraguan-contras=y Class=democrat 218 ==> physician-fee-freeze=n 210    <conf:(0.96)> lift:(1.7) lev:(0.2) [86] conv:(10.47)\n```\n\n由于对类进行关联分析，故度量类型为置信度，将最小支持度下界（lowerBoundMinSupport）设置为0.1，迭代递减单位（delta）设置为0.05，度量最小值（minMetric）保持默认值0.9，WEKA会重复运行Apriori 算法几次，从最小支持度上界（upperBoundMinSupport）开始，以delta为单位进行迭代运算，当迭代次数达到设定的numRules数值时，或数值达到最小支持度下界（lowerBoundMinSupport）时停止迭代操作。\n当前获取结果可以看出，最小支持度为0.45，包含196个实例，其中最小置信度为0.9，整个循环操作进行了11次，生成的频繁1-项集包含20个实例，频繁2-项集包含17个实例，频繁3-项集包含6个实例，而频繁4-项集只包含1个实例。\n关联挖掘结果中最好的Rule得到了219条数据的确认，简要查看一下这条数据代表的意义，若一个议员为收养开支预算投赞成票、为冻结医师的费用投反对票，那么他很可能是民主党人。这是一条很有意思的信息，得到这样的信息也就是关联规则算法的意义所在。\n评定Ranking Rules的方式不止有Confidence，还有Lift，Leverage和Conviction等，结果中对于每一个Rules也分别给出了各个排序规则的结果，如刚才列举的规则置信度达到了1，Lift值达到了1.63，Leverage值达到了0.19，等等，由于本次关联主要对类进行操作，由置信度的结果我们可以推断出这一规则可信度价值较高。\n\n#### FPgrowth\n\n使用WEKA进行FPgrowth相关性分析，将参数保持与Apriori相关性分析时不变，可见的效果是生成结果的时间缩短了不少，其生成结果如下图所示。\n\n```\n=== Associator model (full training set) ===\n\nFPGrowth found 41 rules (displaying top 10)\n\n 1. [el-salvador-aid=y, Class=republican]: 157 ==> [physician-fee-freeze=y]: 156   <conf:(0.99)> lift:(2.44) lev:(0.21) conv:(46.56) \n 2. [crime=y, Class=republican]: 158 ==> [physician-fee-freeze=y]: 155   <conf:(0.98)> lift:(2.41) lev:(0.21) conv:(23.43) \n 3. [religious-groups-in-schools=y, physician-fee-freeze=y]: 160 ==> [el-salvador-aid=y]: 156   <conf:(0.97)> lift:(2) lev:(0.18) conv:(16.4) \n 4. [Class=republican]: 168 ==> [physician-fee-freeze=y]: 163   <conf:(0.97)> lift:(2.38) lev:(0.22) conv:(16.61) \n 5. [adoption-of-the-budget-resolution=y, anti-satellite-test-ban=y, mx-missile=y]: 161 ==> [aid-to-nicaraguan-contras=y]: 155   <conf:(0.96)> lift:(1.73) lev:(0.15) conv:(10.2) \n 6. [physician-fee-freeze=y, Class=republican]: 163 ==> [el-salvador-aid=y]: 156   <conf:(0.96)> lift:(1.96) lev:(0.18) conv:(10.45) \n 7. [religious-groups-in-schools=y, el-salvador-aid=y, superfund-right-to-sue=y]: 160 ==> [crime=y]: 153   <conf:(0.96)> lift:(1.68) lev:(0.14) conv:(8.6) \n 8. [el-salvador-aid=y, superfund-right-to-sue=y]: 170 ==> [crime=y]: 162   <conf:(0.95)> lift:(1.67) lev:(0.15) conv:(8.12) \n 9. [crime=y, physician-fee-freeze=y]: 168 ==> [el-salvador-aid=y]: 160   <conf:(0.95)> lift:(1.95) lev:(0.18) conv:(9.57) \n10. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==> [crime=y]: 160   <conf:(0.95)> lift:(1.67) lev:(0.15) conv:(8.02) \n```\n\nWEKA中给予FPgrowth的描述是：实现FP-growth算法的类，用于查找大型项集而无需生成候选项。由于WEKA中的FPgrowth机制，无法实现对class进行关联分析（我没有找到相关选项），所以我使用FPgrowth得到的关联结果与之前Apriori关联分析的结果不同。\n得到的置信度最高的规则代表着如果医院对萨尔瓦多议题投了赞成票并且他的身份是共和党人，那么大概率他会给冻结医师的费用投赞成票，支持该Rule的记录存在156条，置信度达到了0.99，Lift值达到了2.44。\n至于计算的复杂度问题，运行过程花费的时间也可以预见一些结果，通过查资料得到一般性结论：Apriori算法的效率最低，因为需要很多次的扫描数据库；其次FP—Growth算法在长事物数据上表现很差，因为当事物很长时树的深度也很大，需要求解的子问题就变得特别多，因此效率会迅速下降。\n\n### 参考资料\n[Sample Weka Data Sets](https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html)\n[应用关联规则模型提高超市销量-IBM](https://www.ibm.com/developerworks/cn/data/library/techarticle/dm-1108zhangzy/index.html)\n[Association Rule Mining Algorithms ](http://athena.ecs.csus.edu/~associationcw/FpGrowth.html)\n[频繁模式挖掘中Apriori、FP-Growth和Eclat算法的实现和对比](https://www.cnblogs.com/infaraway/p/6774521.html)\n","source":"_posts/WEKA_Association.md","raw":"---\ntitle: WEKA数据挖掘 - 关联算法\ndate: 2020-04-22 12:23:20\ncategories: \n- 技术\ntags: \n- 数据挖掘\n- 关联算法\n- WEKA\ncopyright: true\n---\n\n本文总结了 WEKA 中 Apriori关联 与 FPgrowth关联 的操作方法。\n\n<!--more-->\n\n### 实验简介\n关联规则表示不同数据项目在同一事件中出现的相关性，下图中超市市场分析员分析顾客购买商品的场景可以直观地理解关联规则。 \n\n![](http://image.stephenfang.me/mweb/15877849125580.jpg)\n\n顾客购买面包同时也购买牛奶的购物模式可以用以下关联规则表示：\n```\n面包 => 牛奶 [ 支持度 =2%, 置信度 =60%]\n```\n其中面包是规则前项（Antecedent），牛奶是规则后项 (Consequent)。实例数（Instances）表示所有购买记录中包含面包的记录的数量。支持度（Support）表示购买面包的记录数占所有购买记录数的百分比。规则支持度（Rule Support）表示同时购买面包和牛奶的记录数占所有的购买记录数的百分比。置信度（confidence）表示同时购买面包和牛奶的记录数占购买面包记录数的百分比。提升（Lift）表示置信度与已知购买牛奶的百分比的比值，提升大于 1 的规则才是有意义的。\n如果关联满足最小支持度阈值和最小置信度阈值就可以认为关联规则是有意义的。这些阈值由用户或领域专家设定。就顾客购物而言，根据以往的购买记录，找出满足最小支持度阈值和最小置信度阈值的关联规则，就找到顾客经常同时购买的商品。\n\n#### Apriori\nApriori算法是第一个关联规则挖掘算法，也是最经典的算法。它利用逐层搜索的迭代方法找出数据库中项集的关系，以形成规则，其过程由连接（类矩阵运算）与剪枝（去掉那些没必要的中间结果）组成。\n本次实验中有如下步骤：\n- 使用 WEKA 的 Apriori 策略对数据集进行关联操作\n- 查看并分析关联结果\n- 分析 Apriori 的算法与特征\n\n#### FPgrowth\nApriori算法在产生频繁模式完全集前需要对数据库进行多次扫描，同时产生大量的候选频繁集，这就使Apriori算法时间和空间复杂度较大。\nFP-Growth算法针对Apriori算法在挖掘长频繁模式时性能低下的特点提出了改进，它采取如下分治策略：将提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息。FP-Growth算法使用了一种称为频繁模式树（Frequent Pattern Tree）的数据结构，FP-tree是一种特殊的前缀树，由频繁项头表和项前缀树构成。FP-Growth算法基于以上的结构加快整个挖掘过程。\n实验包含如下步骤：\n- 使用 WEKA 的FPgrowth 策略对数据集进行关联操作\n- \t查看并分析关联结果\n- \t对比分析 FPgrowth 策略与 Apriori 策略的效果\n\n### 实验数据\n本次实验的数据我参照Waikato大学的数据挖掘教程，选择了vote.arff 数据集，这是一个关于1984年美国国会投票记录数据集，其中包含投票者的身份（民主党人或共和党人）以及多项议题的投票结果，如下图所示：\n![](http://image.stephenfang.me/mweb/15877850041138.jpg)\n![](http://image.stephenfang.me/test-1.png)\n这个数据集包含435条实例（投票信息），其中包含 267 位民主党人投票信息, 168 位共和党人投票信息。投票结果中有移民（immigration）、教育开支（education-spending）、、免税出口（duty-free-exports）等共16个议题。议员对于议题的表决不仅仅只用简单的“Y”、“N”标记，需要注意的是，被标记为“？”的数据并不是代表数据的缺失，可能代表议员持保留意见没有表决，部分数据集摘录如下：\n\n![](http://image.stephenfang.me/mweb/15877851693946.jpg)\n\n由于数据集经过实验验证，数据已完成去噪声处理，并且数据中的“？”并非代表数据缺失，前文交代了相关意义，故不复进行数据预处理的步骤。\n### 算法简介\n#### Apriori\nApriori算法的主要思想为：首先找出所有频繁性至少和预定义的最小支持度一样的频繁项集，由频繁项集产生满足最小支持度和最小可信度的强关联规则，然后使用频繁项集产生期望的规则，产生只包含集合的项的所有规则，每一条规则的右部只有一项。一旦这些规则生成，那么只有那些大于用户给定的最小可信度的规则才被保留。\nApriori算法利用了“任一频繁项集的所有非空子集必须是频繁的”这一个性质。举例说，如果 {0, 1} 是频繁的，那么 {0}, {1} 也是频繁的，将条件倒置，可得“如果一个项集是非频繁项集，那么它的所有超集也是非频繁项集”这一结论。在算法流程中，首先需要找出频繁1-项集，记为L1；然后用L1来产生候选项集C2，对C2中的项进行判定挖掘产生L2，即频繁2-项集；如此循环往复直至无法发现更多的频繁k-项集。\n由于Apriori算法每挖掘一层Lk就需要扫描整个数据库一遍，会产生大量的候选频繁集，使得Apriori算法时间和空间复杂度较大，以下为简单的算法示意图。\n\n![](http://image.stephenfang.me/mweb/15877852247683.jpg)\n\n#### FP-Growth\nFP-Growth算法针对Apriori算法在挖掘时可能出现的性能低下问题提出了改进，无论多少数据，只需要扫描两次数据集，提高了算法运行的效率。FP-Growth算法提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息，基于频繁模式树加快整个挖掘过程。\nFP-Growth算法思路即不断迭代FP-tree的构造和投影过程，其算法过程大致如下：\n1.\t扫描数据集一次，找到频繁1-项集(单项模式)\n2.\t按频率降序对频繁项排序\n3.\t再次扫描数据集，按F-list的逆序构造条件FP树\n4.\t按F-list的逆序构造条件FP树，生成频繁项目集\n\n### 实验过程\n#### Apriori\n使用WEKA进行Apriori相关性分析，其生成结果如下所示，WEKA默认显示十条最佳item sets结果。\n\n```\nApriori\n=======\n\nMinimum support: 0.45 (196 instances)\nMinimum metric <confidence>: 0.9\nNumber of cycles performed: 11\n\nGenerated sets of large itemsets:\n\nSize of set of large itemsets L(1): 20\n\nSize of set of large itemsets L(2): 17\n\nSize of set of large itemsets L(3): 6\n\nSize of set of large itemsets L(4): 1\n\nBest rules found:\n\n 1. adoption-of-the-budget-resolution=y physician-fee-freeze=n 219 ==> Class=democrat 219    <conf:(1)> lift:(1.63) lev:(0.19) [84] conv:(84.58)\n 2. adoption-of-the-budget-resolution=y physician-fee-freeze=n aid-to-nicaraguan-contras=y 198 ==> Class=democrat 198    <conf:(1)> lift:(1.63) lev:(0.18) [76] conv:(76.47)\n 3. physician-fee-freeze=n aid-to-nicaraguan-contras=y 211 ==> Class=democrat 210    <conf:(1)> lift:(1.62) lev:(0.19) [80] conv:(40.74)\n 4. physician-fee-freeze=n education-spending=n 202 ==> Class=democrat 201    <conf:(1)> lift:(1.62) lev:(0.18) [77] conv:(39.01)\n 5. physician-fee-freeze=n 247 ==> Class=democrat 245    <conf:(0.99)> lift:(1.62) lev:(0.21) [93] conv:(31.8)\n 6. el-salvador-aid=n Class=democrat 200 ==> aid-to-nicaraguan-contras=y 197    <conf:(0.98)> lift:(1.77) lev:(0.2) [85] conv:(22.18)\n 7. el-salvador-aid=n 208 ==> aid-to-nicaraguan-contras=y 204    <conf:(0.98)> lift:(1.76) lev:(0.2) [88] conv:(18.46)\n 8. adoption-of-the-budget-resolution=y aid-to-nicaraguan-contras=y Class=democrat 203 ==> physician-fee-freeze=n 198    <conf:(0.98)> lift:(1.72) lev:(0.19) [82] conv:(14.62)\n 9. el-salvador-aid=n aid-to-nicaraguan-contras=y 204 ==> Class=democrat 197    <conf:(0.97)> lift:(1.57) lev:(0.17) [71] conv:(9.85)\n10. aid-to-nicaraguan-contras=y Class=democrat 218 ==> physician-fee-freeze=n 210    <conf:(0.96)> lift:(1.7) lev:(0.2) [86] conv:(10.47)\n```\n\n由于对类进行关联分析，故度量类型为置信度，将最小支持度下界（lowerBoundMinSupport）设置为0.1，迭代递减单位（delta）设置为0.05，度量最小值（minMetric）保持默认值0.9，WEKA会重复运行Apriori 算法几次，从最小支持度上界（upperBoundMinSupport）开始，以delta为单位进行迭代运算，当迭代次数达到设定的numRules数值时，或数值达到最小支持度下界（lowerBoundMinSupport）时停止迭代操作。\n当前获取结果可以看出，最小支持度为0.45，包含196个实例，其中最小置信度为0.9，整个循环操作进行了11次，生成的频繁1-项集包含20个实例，频繁2-项集包含17个实例，频繁3-项集包含6个实例，而频繁4-项集只包含1个实例。\n关联挖掘结果中最好的Rule得到了219条数据的确认，简要查看一下这条数据代表的意义，若一个议员为收养开支预算投赞成票、为冻结医师的费用投反对票，那么他很可能是民主党人。这是一条很有意思的信息，得到这样的信息也就是关联规则算法的意义所在。\n评定Ranking Rules的方式不止有Confidence，还有Lift，Leverage和Conviction等，结果中对于每一个Rules也分别给出了各个排序规则的结果，如刚才列举的规则置信度达到了1，Lift值达到了1.63，Leverage值达到了0.19，等等，由于本次关联主要对类进行操作，由置信度的结果我们可以推断出这一规则可信度价值较高。\n\n#### FPgrowth\n\n使用WEKA进行FPgrowth相关性分析，将参数保持与Apriori相关性分析时不变，可见的效果是生成结果的时间缩短了不少，其生成结果如下图所示。\n\n```\n=== Associator model (full training set) ===\n\nFPGrowth found 41 rules (displaying top 10)\n\n 1. [el-salvador-aid=y, Class=republican]: 157 ==> [physician-fee-freeze=y]: 156   <conf:(0.99)> lift:(2.44) lev:(0.21) conv:(46.56) \n 2. [crime=y, Class=republican]: 158 ==> [physician-fee-freeze=y]: 155   <conf:(0.98)> lift:(2.41) lev:(0.21) conv:(23.43) \n 3. [religious-groups-in-schools=y, physician-fee-freeze=y]: 160 ==> [el-salvador-aid=y]: 156   <conf:(0.97)> lift:(2) lev:(0.18) conv:(16.4) \n 4. [Class=republican]: 168 ==> [physician-fee-freeze=y]: 163   <conf:(0.97)> lift:(2.38) lev:(0.22) conv:(16.61) \n 5. [adoption-of-the-budget-resolution=y, anti-satellite-test-ban=y, mx-missile=y]: 161 ==> [aid-to-nicaraguan-contras=y]: 155   <conf:(0.96)> lift:(1.73) lev:(0.15) conv:(10.2) \n 6. [physician-fee-freeze=y, Class=republican]: 163 ==> [el-salvador-aid=y]: 156   <conf:(0.96)> lift:(1.96) lev:(0.18) conv:(10.45) \n 7. [religious-groups-in-schools=y, el-salvador-aid=y, superfund-right-to-sue=y]: 160 ==> [crime=y]: 153   <conf:(0.96)> lift:(1.68) lev:(0.14) conv:(8.6) \n 8. [el-salvador-aid=y, superfund-right-to-sue=y]: 170 ==> [crime=y]: 162   <conf:(0.95)> lift:(1.67) lev:(0.15) conv:(8.12) \n 9. [crime=y, physician-fee-freeze=y]: 168 ==> [el-salvador-aid=y]: 160   <conf:(0.95)> lift:(1.95) lev:(0.18) conv:(9.57) \n10. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==> [crime=y]: 160   <conf:(0.95)> lift:(1.67) lev:(0.15) conv:(8.02) \n```\n\nWEKA中给予FPgrowth的描述是：实现FP-growth算法的类，用于查找大型项集而无需生成候选项。由于WEKA中的FPgrowth机制，无法实现对class进行关联分析（我没有找到相关选项），所以我使用FPgrowth得到的关联结果与之前Apriori关联分析的结果不同。\n得到的置信度最高的规则代表着如果医院对萨尔瓦多议题投了赞成票并且他的身份是共和党人，那么大概率他会给冻结医师的费用投赞成票，支持该Rule的记录存在156条，置信度达到了0.99，Lift值达到了2.44。\n至于计算的复杂度问题，运行过程花费的时间也可以预见一些结果，通过查资料得到一般性结论：Apriori算法的效率最低，因为需要很多次的扫描数据库；其次FP—Growth算法在长事物数据上表现很差，因为当事物很长时树的深度也很大，需要求解的子问题就变得特别多，因此效率会迅速下降。\n\n### 参考资料\n[Sample Weka Data Sets](https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html)\n[应用关联规则模型提高超市销量-IBM](https://www.ibm.com/developerworks/cn/data/library/techarticle/dm-1108zhangzy/index.html)\n[Association Rule Mining Algorithms ](http://athena.ecs.csus.edu/~associationcw/FpGrowth.html)\n[频繁模式挖掘中Apriori、FP-Growth和Eclat算法的实现和对比](https://www.cnblogs.com/infaraway/p/6774521.html)\n","slug":"WEKA_Association","published":1,"updated":"2022-07-24T15:21:59.649Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp37006lo76f0mcr0hvx","content":"<p>本文总结了 WEKA 中 Apriori关联 与 FPgrowth关联 的操作方法。</p>\n<span id=\"more\"></span>\n\n<h3 id=\"实验简介\"><a href=\"#实验简介\" class=\"headerlink\" title=\"实验简介\"></a>实验简介</h3><p>关联规则表示不同数据项目在同一事件中出现的相关性，下图中超市市场分析员分析顾客购买商品的场景可以直观地理解关联规则。 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/15877849125580.jpg\"></p>\n<p>顾客购买面包同时也购买牛奶的购物模式可以用以下关联规则表示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">面包 =&gt; 牛奶 [ 支持度 =2%, 置信度 =60%]</span><br></pre></td></tr></table></figure>\n<p>其中面包是规则前项（Antecedent），牛奶是规则后项 (Consequent)。实例数（Instances）表示所有购买记录中包含面包的记录的数量。支持度（Support）表示购买面包的记录数占所有购买记录数的百分比。规则支持度（Rule Support）表示同时购买面包和牛奶的记录数占所有的购买记录数的百分比。置信度（confidence）表示同时购买面包和牛奶的记录数占购买面包记录数的百分比。提升（Lift）表示置信度与已知购买牛奶的百分比的比值，提升大于 1 的规则才是有意义的。<br>如果关联满足最小支持度阈值和最小置信度阈值就可以认为关联规则是有意义的。这些阈值由用户或领域专家设定。就顾客购物而言，根据以往的购买记录，找出满足最小支持度阈值和最小置信度阈值的关联规则，就找到顾客经常同时购买的商品。</p>\n<h4 id=\"Apriori\"><a href=\"#Apriori\" class=\"headerlink\" title=\"Apriori\"></a>Apriori</h4><p>Apriori算法是第一个关联规则挖掘算法，也是最经典的算法。它利用逐层搜索的迭代方法找出数据库中项集的关系，以形成规则，其过程由连接（类矩阵运算）与剪枝（去掉那些没必要的中间结果）组成。<br>本次实验中有如下步骤：</p>\n<ul>\n<li>使用 WEKA 的 Apriori 策略对数据集进行关联操作</li>\n<li>查看并分析关联结果</li>\n<li>分析 Apriori 的算法与特征</li>\n</ul>\n<h4 id=\"FPgrowth\"><a href=\"#FPgrowth\" class=\"headerlink\" title=\"FPgrowth\"></a>FPgrowth</h4><p>Apriori算法在产生频繁模式完全集前需要对数据库进行多次扫描，同时产生大量的候选频繁集，这就使Apriori算法时间和空间复杂度较大。<br>FP-Growth算法针对Apriori算法在挖掘长频繁模式时性能低下的特点提出了改进，它采取如下分治策略：将提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息。FP-Growth算法使用了一种称为频繁模式树（Frequent Pattern Tree）的数据结构，FP-tree是一种特殊的前缀树，由频繁项头表和项前缀树构成。FP-Growth算法基于以上的结构加快整个挖掘过程。<br>实验包含如下步骤：</p>\n<ul>\n<li>使用 WEKA 的FPgrowth 策略对数据集进行关联操作</li>\n<li><pre><code>查看并分析关联结果\n</code></pre>\n</li>\n<li><pre><code>对比分析 FPgrowth 策略与 Apriori 策略的效果\n</code></pre>\n</li>\n</ul>\n<h3 id=\"实验数据\"><a href=\"#实验数据\" class=\"headerlink\" title=\"实验数据\"></a>实验数据</h3><p>本次实验的数据我参照Waikato大学的数据挖掘教程，选择了vote.arff 数据集，这是一个关于1984年美国国会投票记录数据集，其中包含投票者的身份（民主党人或共和党人）以及多项议题的投票结果，如下图所示：<br><img src=\"http://image.stephenfang.me/mweb/15877850041138.jpg\"><br><img src=\"http://image.stephenfang.me/test-1.png\"><br>这个数据集包含435条实例（投票信息），其中包含 267 位民主党人投票信息, 168 位共和党人投票信息。投票结果中有移民（immigration）、教育开支（education-spending）、、免税出口（duty-free-exports）等共16个议题。议员对于议题的表决不仅仅只用简单的“Y”、“N”标记，需要注意的是，被标记为“？”的数据并不是代表数据的缺失，可能代表议员持保留意见没有表决，部分数据集摘录如下：</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15877851693946.jpg\"></p>\n<p>由于数据集经过实验验证，数据已完成去噪声处理，并且数据中的“？”并非代表数据缺失，前文交代了相关意义，故不复进行数据预处理的步骤。</p>\n<h3 id=\"算法简介\"><a href=\"#算法简介\" class=\"headerlink\" title=\"算法简介\"></a>算法简介</h3><h4 id=\"Apriori-1\"><a href=\"#Apriori-1\" class=\"headerlink\" title=\"Apriori\"></a>Apriori</h4><p>Apriori算法的主要思想为：首先找出所有频繁性至少和预定义的最小支持度一样的频繁项集，由频繁项集产生满足最小支持度和最小可信度的强关联规则，然后使用频繁项集产生期望的规则，产生只包含集合的项的所有规则，每一条规则的右部只有一项。一旦这些规则生成，那么只有那些大于用户给定的最小可信度的规则才被保留。<br>Apriori算法利用了“任一频繁项集的所有非空子集必须是频繁的”这一个性质。举例说，如果 {0, 1} 是频繁的，那么 {0}, {1} 也是频繁的，将条件倒置，可得“如果一个项集是非频繁项集，那么它的所有超集也是非频繁项集”这一结论。在算法流程中，首先需要找出频繁1-项集，记为L1；然后用L1来产生候选项集C2，对C2中的项进行判定挖掘产生L2，即频繁2-项集；如此循环往复直至无法发现更多的频繁k-项集。<br>由于Apriori算法每挖掘一层Lk就需要扫描整个数据库一遍，会产生大量的候选频繁集，使得Apriori算法时间和空间复杂度较大，以下为简单的算法示意图。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15877852247683.jpg\"></p>\n<h4 id=\"FP-Growth\"><a href=\"#FP-Growth\" class=\"headerlink\" title=\"FP-Growth\"></a>FP-Growth</h4><p>FP-Growth算法针对Apriori算法在挖掘时可能出现的性能低下问题提出了改进，无论多少数据，只需要扫描两次数据集，提高了算法运行的效率。FP-Growth算法提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息，基于频繁模式树加快整个挖掘过程。<br>FP-Growth算法思路即不断迭代FP-tree的构造和投影过程，其算法过程大致如下：</p>\n<ol>\n<li>   扫描数据集一次，找到频繁1-项集(单项模式)</li>\n<li>   按频率降序对频繁项排序</li>\n<li>   再次扫描数据集，按F-list的逆序构造条件FP树</li>\n<li>   按F-list的逆序构造条件FP树，生成频繁项目集</li>\n</ol>\n<h3 id=\"实验过程\"><a href=\"#实验过程\" class=\"headerlink\" title=\"实验过程\"></a>实验过程</h3><h4 id=\"Apriori-2\"><a href=\"#Apriori-2\" class=\"headerlink\" title=\"Apriori\"></a>Apriori</h4><p>使用WEKA进行Apriori相关性分析，其生成结果如下所示，WEKA默认显示十条最佳item sets结果。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Apriori</span><br><span class=\"line\">=======</span><br><span class=\"line\"></span><br><span class=\"line\">Minimum support: 0.45 (196 instances)</span><br><span class=\"line\">Minimum metric &lt;confidence&gt;: 0.9</span><br><span class=\"line\">Number of cycles performed: 11</span><br><span class=\"line\"></span><br><span class=\"line\">Generated sets of large itemsets:</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(1): 20</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(2): 17</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(3): 6</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(4): 1</span><br><span class=\"line\"></span><br><span class=\"line\">Best rules found:</span><br><span class=\"line\"></span><br><span class=\"line\"> 1. adoption-of-the-budget-resolution=y physician-fee-freeze=n 219 ==&gt; Class=democrat 219    &lt;conf:(1)&gt; lift:(1.63) lev:(0.19) [84] conv:(84.58)</span><br><span class=\"line\"> 2. adoption-of-the-budget-resolution=y physician-fee-freeze=n aid-to-nicaraguan-contras=y 198 ==&gt; Class=democrat 198    &lt;conf:(1)&gt; lift:(1.63) lev:(0.18) [76] conv:(76.47)</span><br><span class=\"line\"> 3. physician-fee-freeze=n aid-to-nicaraguan-contras=y 211 ==&gt; Class=democrat 210    &lt;conf:(1)&gt; lift:(1.62) lev:(0.19) [80] conv:(40.74)</span><br><span class=\"line\"> 4. physician-fee-freeze=n education-spending=n 202 ==&gt; Class=democrat 201    &lt;conf:(1)&gt; lift:(1.62) lev:(0.18) [77] conv:(39.01)</span><br><span class=\"line\"> 5. physician-fee-freeze=n 247 ==&gt; Class=democrat 245    &lt;conf:(0.99)&gt; lift:(1.62) lev:(0.21) [93] conv:(31.8)</span><br><span class=\"line\"> 6. el-salvador-aid=n Class=democrat 200 ==&gt; aid-to-nicaraguan-contras=y 197    &lt;conf:(0.98)&gt; lift:(1.77) lev:(0.2) [85] conv:(22.18)</span><br><span class=\"line\"> 7. el-salvador-aid=n 208 ==&gt; aid-to-nicaraguan-contras=y 204    &lt;conf:(0.98)&gt; lift:(1.76) lev:(0.2) [88] conv:(18.46)</span><br><span class=\"line\"> 8. adoption-of-the-budget-resolution=y aid-to-nicaraguan-contras=y Class=democrat 203 ==&gt; physician-fee-freeze=n 198    &lt;conf:(0.98)&gt; lift:(1.72) lev:(0.19) [82] conv:(14.62)</span><br><span class=\"line\"> 9. el-salvador-aid=n aid-to-nicaraguan-contras=y 204 ==&gt; Class=democrat 197    &lt;conf:(0.97)&gt; lift:(1.57) lev:(0.17) [71] conv:(9.85)</span><br><span class=\"line\">10. aid-to-nicaraguan-contras=y Class=democrat 218 ==&gt; physician-fee-freeze=n 210    &lt;conf:(0.96)&gt; lift:(1.7) lev:(0.2) [86] conv:(10.47)</span><br></pre></td></tr></table></figure>\n\n<p>由于对类进行关联分析，故度量类型为置信度，将最小支持度下界（lowerBoundMinSupport）设置为0.1，迭代递减单位（delta）设置为0.05，度量最小值（minMetric）保持默认值0.9，WEKA会重复运行Apriori 算法几次，从最小支持度上界（upperBoundMinSupport）开始，以delta为单位进行迭代运算，当迭代次数达到设定的numRules数值时，或数值达到最小支持度下界（lowerBoundMinSupport）时停止迭代操作。<br>当前获取结果可以看出，最小支持度为0.45，包含196个实例，其中最小置信度为0.9，整个循环操作进行了11次，生成的频繁1-项集包含20个实例，频繁2-项集包含17个实例，频繁3-项集包含6个实例，而频繁4-项集只包含1个实例。<br>关联挖掘结果中最好的Rule得到了219条数据的确认，简要查看一下这条数据代表的意义，若一个议员为收养开支预算投赞成票、为冻结医师的费用投反对票，那么他很可能是民主党人。这是一条很有意思的信息，得到这样的信息也就是关联规则算法的意义所在。<br>评定Ranking Rules的方式不止有Confidence，还有Lift，Leverage和Conviction等，结果中对于每一个Rules也分别给出了各个排序规则的结果，如刚才列举的规则置信度达到了1，Lift值达到了1.63，Leverage值达到了0.19，等等，由于本次关联主要对类进行操作，由置信度的结果我们可以推断出这一规则可信度价值较高。</p>\n<h4 id=\"FPgrowth-1\"><a href=\"#FPgrowth-1\" class=\"headerlink\" title=\"FPgrowth\"></a>FPgrowth</h4><p>使用WEKA进行FPgrowth相关性分析，将参数保持与Apriori相关性分析时不变，可见的效果是生成结果的时间缩短了不少，其生成结果如下图所示。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=== Associator model (full training set) ===</span><br><span class=\"line\"></span><br><span class=\"line\">FPGrowth found 41 rules (displaying top 10)</span><br><span class=\"line\"></span><br><span class=\"line\"> 1. [el-salvador-aid=y, Class=republican]: 157 ==&gt; [physician-fee-freeze=y]: 156   &lt;conf:(0.99)&gt; lift:(2.44) lev:(0.21) conv:(46.56) </span><br><span class=\"line\"> 2. [crime=y, Class=republican]: 158 ==&gt; [physician-fee-freeze=y]: 155   &lt;conf:(0.98)&gt; lift:(2.41) lev:(0.21) conv:(23.43) </span><br><span class=\"line\"> 3. [religious-groups-in-schools=y, physician-fee-freeze=y]: 160 ==&gt; [el-salvador-aid=y]: 156   &lt;conf:(0.97)&gt; lift:(2) lev:(0.18) conv:(16.4) </span><br><span class=\"line\"> 4. [Class=republican]: 168 ==&gt; [physician-fee-freeze=y]: 163   &lt;conf:(0.97)&gt; lift:(2.38) lev:(0.22) conv:(16.61) </span><br><span class=\"line\"> 5. [adoption-of-the-budget-resolution=y, anti-satellite-test-ban=y, mx-missile=y]: 161 ==&gt; [aid-to-nicaraguan-contras=y]: 155   &lt;conf:(0.96)&gt; lift:(1.73) lev:(0.15) conv:(10.2) </span><br><span class=\"line\"> 6. [physician-fee-freeze=y, Class=republican]: 163 ==&gt; [el-salvador-aid=y]: 156   &lt;conf:(0.96)&gt; lift:(1.96) lev:(0.18) conv:(10.45) </span><br><span class=\"line\"> 7. [religious-groups-in-schools=y, el-salvador-aid=y, superfund-right-to-sue=y]: 160 ==&gt; [crime=y]: 153   &lt;conf:(0.96)&gt; lift:(1.68) lev:(0.14) conv:(8.6) </span><br><span class=\"line\"> 8. [el-salvador-aid=y, superfund-right-to-sue=y]: 170 ==&gt; [crime=y]: 162   &lt;conf:(0.95)&gt; lift:(1.67) lev:(0.15) conv:(8.12) </span><br><span class=\"line\"> 9. [crime=y, physician-fee-freeze=y]: 168 ==&gt; [el-salvador-aid=y]: 160   &lt;conf:(0.95)&gt; lift:(1.95) lev:(0.18) conv:(9.57) </span><br><span class=\"line\">10. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==&gt; [crime=y]: 160   &lt;conf:(0.95)&gt; lift:(1.67) lev:(0.15) conv:(8.02) </span><br></pre></td></tr></table></figure>\n\n<p>WEKA中给予FPgrowth的描述是：实现FP-growth算法的类，用于查找大型项集而无需生成候选项。由于WEKA中的FPgrowth机制，无法实现对class进行关联分析（我没有找到相关选项），所以我使用FPgrowth得到的关联结果与之前Apriori关联分析的结果不同。<br>得到的置信度最高的规则代表着如果医院对萨尔瓦多议题投了赞成票并且他的身份是共和党人，那么大概率他会给冻结医师的费用投赞成票，支持该Rule的记录存在156条，置信度达到了0.99，Lift值达到了2.44。<br>至于计算的复杂度问题，运行过程花费的时间也可以预见一些结果，通过查资料得到一般性结论：Apriori算法的效率最低，因为需要很多次的扫描数据库；其次FP—Growth算法在长事物数据上表现很差，因为当事物很长时树的深度也很大，需要求解的子问题就变得特别多，因此效率会迅速下降。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p><a href=\"https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html\">Sample Weka Data Sets</a><br><a href=\"https://www.ibm.com/developerworks/cn/data/library/techarticle/dm-1108zhangzy/index.html\">应用关联规则模型提高超市销量-IBM</a><br><a href=\"http://athena.ecs.csus.edu/~associationcw/FpGrowth.html\">Association Rule Mining Algorithms </a><br><a href=\"https://www.cnblogs.com/infaraway/p/6774521.html\">频繁模式挖掘中Apriori、FP-Growth和Eclat算法的实现和对比</a></p>\n","site":{"data":{}},"excerpt":"<p>本文总结了 WEKA 中 Apriori关联 与 FPgrowth关联 的操作方法。</p>","more":"<h3 id=\"实验简介\"><a href=\"#实验简介\" class=\"headerlink\" title=\"实验简介\"></a>实验简介</h3><p>关联规则表示不同数据项目在同一事件中出现的相关性，下图中超市市场分析员分析顾客购买商品的场景可以直观地理解关联规则。 </p>\n<p><img src=\"http://image.stephenfang.me/mweb/15877849125580.jpg\"></p>\n<p>顾客购买面包同时也购买牛奶的购物模式可以用以下关联规则表示：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">面包 =&gt; 牛奶 [ 支持度 =2%, 置信度 =60%]</span><br></pre></td></tr></table></figure>\n<p>其中面包是规则前项（Antecedent），牛奶是规则后项 (Consequent)。实例数（Instances）表示所有购买记录中包含面包的记录的数量。支持度（Support）表示购买面包的记录数占所有购买记录数的百分比。规则支持度（Rule Support）表示同时购买面包和牛奶的记录数占所有的购买记录数的百分比。置信度（confidence）表示同时购买面包和牛奶的记录数占购买面包记录数的百分比。提升（Lift）表示置信度与已知购买牛奶的百分比的比值，提升大于 1 的规则才是有意义的。<br>如果关联满足最小支持度阈值和最小置信度阈值就可以认为关联规则是有意义的。这些阈值由用户或领域专家设定。就顾客购物而言，根据以往的购买记录，找出满足最小支持度阈值和最小置信度阈值的关联规则，就找到顾客经常同时购买的商品。</p>\n<h4 id=\"Apriori\"><a href=\"#Apriori\" class=\"headerlink\" title=\"Apriori\"></a>Apriori</h4><p>Apriori算法是第一个关联规则挖掘算法，也是最经典的算法。它利用逐层搜索的迭代方法找出数据库中项集的关系，以形成规则，其过程由连接（类矩阵运算）与剪枝（去掉那些没必要的中间结果）组成。<br>本次实验中有如下步骤：</p>\n<ul>\n<li>使用 WEKA 的 Apriori 策略对数据集进行关联操作</li>\n<li>查看并分析关联结果</li>\n<li>分析 Apriori 的算法与特征</li>\n</ul>\n<h4 id=\"FPgrowth\"><a href=\"#FPgrowth\" class=\"headerlink\" title=\"FPgrowth\"></a>FPgrowth</h4><p>Apriori算法在产生频繁模式完全集前需要对数据库进行多次扫描，同时产生大量的候选频繁集，这就使Apriori算法时间和空间复杂度较大。<br>FP-Growth算法针对Apriori算法在挖掘长频繁模式时性能低下的特点提出了改进，它采取如下分治策略：将提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息。FP-Growth算法使用了一种称为频繁模式树（Frequent Pattern Tree）的数据结构，FP-tree是一种特殊的前缀树，由频繁项头表和项前缀树构成。FP-Growth算法基于以上的结构加快整个挖掘过程。<br>实验包含如下步骤：</p>\n<ul>\n<li>使用 WEKA 的FPgrowth 策略对数据集进行关联操作</li>\n<li><pre><code>查看并分析关联结果\n</code></pre>\n</li>\n<li><pre><code>对比分析 FPgrowth 策略与 Apriori 策略的效果\n</code></pre>\n</li>\n</ul>\n<h3 id=\"实验数据\"><a href=\"#实验数据\" class=\"headerlink\" title=\"实验数据\"></a>实验数据</h3><p>本次实验的数据我参照Waikato大学的数据挖掘教程，选择了vote.arff 数据集，这是一个关于1984年美国国会投票记录数据集，其中包含投票者的身份（民主党人或共和党人）以及多项议题的投票结果，如下图所示：<br><img src=\"http://image.stephenfang.me/mweb/15877850041138.jpg\"><br><img src=\"http://image.stephenfang.me/test-1.png\"><br>这个数据集包含435条实例（投票信息），其中包含 267 位民主党人投票信息, 168 位共和党人投票信息。投票结果中有移民（immigration）、教育开支（education-spending）、、免税出口（duty-free-exports）等共16个议题。议员对于议题的表决不仅仅只用简单的“Y”、“N”标记，需要注意的是，被标记为“？”的数据并不是代表数据的缺失，可能代表议员持保留意见没有表决，部分数据集摘录如下：</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15877851693946.jpg\"></p>\n<p>由于数据集经过实验验证，数据已完成去噪声处理，并且数据中的“？”并非代表数据缺失，前文交代了相关意义，故不复进行数据预处理的步骤。</p>\n<h3 id=\"算法简介\"><a href=\"#算法简介\" class=\"headerlink\" title=\"算法简介\"></a>算法简介</h3><h4 id=\"Apriori-1\"><a href=\"#Apriori-1\" class=\"headerlink\" title=\"Apriori\"></a>Apriori</h4><p>Apriori算法的主要思想为：首先找出所有频繁性至少和预定义的最小支持度一样的频繁项集，由频繁项集产生满足最小支持度和最小可信度的强关联规则，然后使用频繁项集产生期望的规则，产生只包含集合的项的所有规则，每一条规则的右部只有一项。一旦这些规则生成，那么只有那些大于用户给定的最小可信度的规则才被保留。<br>Apriori算法利用了“任一频繁项集的所有非空子集必须是频繁的”这一个性质。举例说，如果 {0, 1} 是频繁的，那么 {0}, {1} 也是频繁的，将条件倒置，可得“如果一个项集是非频繁项集，那么它的所有超集也是非频繁项集”这一结论。在算法流程中，首先需要找出频繁1-项集，记为L1；然后用L1来产生候选项集C2，对C2中的项进行判定挖掘产生L2，即频繁2-项集；如此循环往复直至无法发现更多的频繁k-项集。<br>由于Apriori算法每挖掘一层Lk就需要扫描整个数据库一遍，会产生大量的候选频繁集，使得Apriori算法时间和空间复杂度较大，以下为简单的算法示意图。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/15877852247683.jpg\"></p>\n<h4 id=\"FP-Growth\"><a href=\"#FP-Growth\" class=\"headerlink\" title=\"FP-Growth\"></a>FP-Growth</h4><p>FP-Growth算法针对Apriori算法在挖掘时可能出现的性能低下问题提出了改进，无论多少数据，只需要扫描两次数据集，提高了算法运行的效率。FP-Growth算法提供频繁项集的数据库压缩到一棵频繁模式树（FP-tree），但仍保留项集关联信息，基于频繁模式树加快整个挖掘过程。<br>FP-Growth算法思路即不断迭代FP-tree的构造和投影过程，其算法过程大致如下：</p>\n<ol>\n<li>   扫描数据集一次，找到频繁1-项集(单项模式)</li>\n<li>   按频率降序对频繁项排序</li>\n<li>   再次扫描数据集，按F-list的逆序构造条件FP树</li>\n<li>   按F-list的逆序构造条件FP树，生成频繁项目集</li>\n</ol>\n<h3 id=\"实验过程\"><a href=\"#实验过程\" class=\"headerlink\" title=\"实验过程\"></a>实验过程</h3><h4 id=\"Apriori-2\"><a href=\"#Apriori-2\" class=\"headerlink\" title=\"Apriori\"></a>Apriori</h4><p>使用WEKA进行Apriori相关性分析，其生成结果如下所示，WEKA默认显示十条最佳item sets结果。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Apriori</span><br><span class=\"line\">=======</span><br><span class=\"line\"></span><br><span class=\"line\">Minimum support: 0.45 (196 instances)</span><br><span class=\"line\">Minimum metric &lt;confidence&gt;: 0.9</span><br><span class=\"line\">Number of cycles performed: 11</span><br><span class=\"line\"></span><br><span class=\"line\">Generated sets of large itemsets:</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(1): 20</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(2): 17</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(3): 6</span><br><span class=\"line\"></span><br><span class=\"line\">Size of set of large itemsets L(4): 1</span><br><span class=\"line\"></span><br><span class=\"line\">Best rules found:</span><br><span class=\"line\"></span><br><span class=\"line\"> 1. adoption-of-the-budget-resolution=y physician-fee-freeze=n 219 ==&gt; Class=democrat 219    &lt;conf:(1)&gt; lift:(1.63) lev:(0.19) [84] conv:(84.58)</span><br><span class=\"line\"> 2. adoption-of-the-budget-resolution=y physician-fee-freeze=n aid-to-nicaraguan-contras=y 198 ==&gt; Class=democrat 198    &lt;conf:(1)&gt; lift:(1.63) lev:(0.18) [76] conv:(76.47)</span><br><span class=\"line\"> 3. physician-fee-freeze=n aid-to-nicaraguan-contras=y 211 ==&gt; Class=democrat 210    &lt;conf:(1)&gt; lift:(1.62) lev:(0.19) [80] conv:(40.74)</span><br><span class=\"line\"> 4. physician-fee-freeze=n education-spending=n 202 ==&gt; Class=democrat 201    &lt;conf:(1)&gt; lift:(1.62) lev:(0.18) [77] conv:(39.01)</span><br><span class=\"line\"> 5. physician-fee-freeze=n 247 ==&gt; Class=democrat 245    &lt;conf:(0.99)&gt; lift:(1.62) lev:(0.21) [93] conv:(31.8)</span><br><span class=\"line\"> 6. el-salvador-aid=n Class=democrat 200 ==&gt; aid-to-nicaraguan-contras=y 197    &lt;conf:(0.98)&gt; lift:(1.77) lev:(0.2) [85] conv:(22.18)</span><br><span class=\"line\"> 7. el-salvador-aid=n 208 ==&gt; aid-to-nicaraguan-contras=y 204    &lt;conf:(0.98)&gt; lift:(1.76) lev:(0.2) [88] conv:(18.46)</span><br><span class=\"line\"> 8. adoption-of-the-budget-resolution=y aid-to-nicaraguan-contras=y Class=democrat 203 ==&gt; physician-fee-freeze=n 198    &lt;conf:(0.98)&gt; lift:(1.72) lev:(0.19) [82] conv:(14.62)</span><br><span class=\"line\"> 9. el-salvador-aid=n aid-to-nicaraguan-contras=y 204 ==&gt; Class=democrat 197    &lt;conf:(0.97)&gt; lift:(1.57) lev:(0.17) [71] conv:(9.85)</span><br><span class=\"line\">10. aid-to-nicaraguan-contras=y Class=democrat 218 ==&gt; physician-fee-freeze=n 210    &lt;conf:(0.96)&gt; lift:(1.7) lev:(0.2) [86] conv:(10.47)</span><br></pre></td></tr></table></figure>\n\n<p>由于对类进行关联分析，故度量类型为置信度，将最小支持度下界（lowerBoundMinSupport）设置为0.1，迭代递减单位（delta）设置为0.05，度量最小值（minMetric）保持默认值0.9，WEKA会重复运行Apriori 算法几次，从最小支持度上界（upperBoundMinSupport）开始，以delta为单位进行迭代运算，当迭代次数达到设定的numRules数值时，或数值达到最小支持度下界（lowerBoundMinSupport）时停止迭代操作。<br>当前获取结果可以看出，最小支持度为0.45，包含196个实例，其中最小置信度为0.9，整个循环操作进行了11次，生成的频繁1-项集包含20个实例，频繁2-项集包含17个实例，频繁3-项集包含6个实例，而频繁4-项集只包含1个实例。<br>关联挖掘结果中最好的Rule得到了219条数据的确认，简要查看一下这条数据代表的意义，若一个议员为收养开支预算投赞成票、为冻结医师的费用投反对票，那么他很可能是民主党人。这是一条很有意思的信息，得到这样的信息也就是关联规则算法的意义所在。<br>评定Ranking Rules的方式不止有Confidence，还有Lift，Leverage和Conviction等，结果中对于每一个Rules也分别给出了各个排序规则的结果，如刚才列举的规则置信度达到了1，Lift值达到了1.63，Leverage值达到了0.19，等等，由于本次关联主要对类进行操作，由置信度的结果我们可以推断出这一规则可信度价值较高。</p>\n<h4 id=\"FPgrowth-1\"><a href=\"#FPgrowth-1\" class=\"headerlink\" title=\"FPgrowth\"></a>FPgrowth</h4><p>使用WEKA进行FPgrowth相关性分析，将参数保持与Apriori相关性分析时不变，可见的效果是生成结果的时间缩短了不少，其生成结果如下图所示。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">=== Associator model (full training set) ===</span><br><span class=\"line\"></span><br><span class=\"line\">FPGrowth found 41 rules (displaying top 10)</span><br><span class=\"line\"></span><br><span class=\"line\"> 1. [el-salvador-aid=y, Class=republican]: 157 ==&gt; [physician-fee-freeze=y]: 156   &lt;conf:(0.99)&gt; lift:(2.44) lev:(0.21) conv:(46.56) </span><br><span class=\"line\"> 2. [crime=y, Class=republican]: 158 ==&gt; [physician-fee-freeze=y]: 155   &lt;conf:(0.98)&gt; lift:(2.41) lev:(0.21) conv:(23.43) </span><br><span class=\"line\"> 3. [religious-groups-in-schools=y, physician-fee-freeze=y]: 160 ==&gt; [el-salvador-aid=y]: 156   &lt;conf:(0.97)&gt; lift:(2) lev:(0.18) conv:(16.4) </span><br><span class=\"line\"> 4. [Class=republican]: 168 ==&gt; [physician-fee-freeze=y]: 163   &lt;conf:(0.97)&gt; lift:(2.38) lev:(0.22) conv:(16.61) </span><br><span class=\"line\"> 5. [adoption-of-the-budget-resolution=y, anti-satellite-test-ban=y, mx-missile=y]: 161 ==&gt; [aid-to-nicaraguan-contras=y]: 155   &lt;conf:(0.96)&gt; lift:(1.73) lev:(0.15) conv:(10.2) </span><br><span class=\"line\"> 6. [physician-fee-freeze=y, Class=republican]: 163 ==&gt; [el-salvador-aid=y]: 156   &lt;conf:(0.96)&gt; lift:(1.96) lev:(0.18) conv:(10.45) </span><br><span class=\"line\"> 7. [religious-groups-in-schools=y, el-salvador-aid=y, superfund-right-to-sue=y]: 160 ==&gt; [crime=y]: 153   &lt;conf:(0.96)&gt; lift:(1.68) lev:(0.14) conv:(8.6) </span><br><span class=\"line\"> 8. [el-salvador-aid=y, superfund-right-to-sue=y]: 170 ==&gt; [crime=y]: 162   &lt;conf:(0.95)&gt; lift:(1.67) lev:(0.15) conv:(8.12) </span><br><span class=\"line\"> 9. [crime=y, physician-fee-freeze=y]: 168 ==&gt; [el-salvador-aid=y]: 160   &lt;conf:(0.95)&gt; lift:(1.95) lev:(0.18) conv:(9.57) </span><br><span class=\"line\">10. [el-salvador-aid=y, physician-fee-freeze=y]: 168 ==&gt; [crime=y]: 160   &lt;conf:(0.95)&gt; lift:(1.67) lev:(0.15) conv:(8.02) </span><br></pre></td></tr></table></figure>\n\n<p>WEKA中给予FPgrowth的描述是：实现FP-growth算法的类，用于查找大型项集而无需生成候选项。由于WEKA中的FPgrowth机制，无法实现对class进行关联分析（我没有找到相关选项），所以我使用FPgrowth得到的关联结果与之前Apriori关联分析的结果不同。<br>得到的置信度最高的规则代表着如果医院对萨尔瓦多议题投了赞成票并且他的身份是共和党人，那么大概率他会给冻结医师的费用投赞成票，支持该Rule的记录存在156条，置信度达到了0.99，Lift值达到了2.44。<br>至于计算的复杂度问题，运行过程花费的时间也可以预见一些结果，通过查资料得到一般性结论：Apriori算法的效率最低，因为需要很多次的扫描数据库；其次FP—Growth算法在长事物数据上表现很差，因为当事物很长时树的深度也很大，需要求解的子问题就变得特别多，因此效率会迅速下降。</p>\n<h3 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h3><p><a href=\"https://storm.cis.fordham.edu/~gweiss/data-mining/datasets.html\">Sample Weka Data Sets</a><br><a href=\"https://www.ibm.com/developerworks/cn/data/library/techarticle/dm-1108zhangzy/index.html\">应用关联规则模型提高超市销量-IBM</a><br><a href=\"http://athena.ecs.csus.edu/~associationcw/FpGrowth.html\">Association Rule Mining Algorithms </a><br><a href=\"https://www.cnblogs.com/infaraway/p/6774521.html\">频繁模式挖掘中Apriori、FP-Growth和Eclat算法的实现和对比</a></p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/15877849125580.jpg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:21:59 GMT+0800 (中国标准时间)","title":"WEKA数据挖掘 - 关联算法","path":"2020/04/22/WEKA_Association/","eyeCatchImage":"http://image.stephenfang.me/mweb/15877849125580.jpg","excerpt":"<p>本文总结了 WEKA 中 Apriori关联 与 FPgrowth关联 的操作方法。</p>","date":{"_isAMomentObject":true,"_i":"2020-04-22T04:23:20.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2020-04-22T04:23:20.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["数据挖掘","关联算法","WEKA"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":6452},{"title":"WWDC22 UIKit 新变化","date":"2022-07-24T15:15:00.000Z","copyright":true,"_content":"\n最近几年的 WWDC 每年都能看到很多 SwiftUI 的新能力，但不能忽略的是 UIKit 框架的更新。\n\n今年的 [What’s New in UIKit Session](https://developer.apple.com/videos/play/wwdc2022/10068/) 主要包括以下几个方面\n\n- 生产力提升\n- 控制增强\n- API 改进\n- UIKit 与 SwiftUI 混编\n\n我按照业务理解和适配进度的优先级，对 session 内容进行了重新排序和整理，对 [@ferhanakkan](https://github.com/ferhanakkan) 的仓库进行了一些改动，以下为我的总结。\n\n<!--more-->\n\n[https://github.com/iamStephenFang/WhatsNewInUIKit](https://github.com/iamStephenFang/WhatsNewInUIKit)\n\n\n## API 改进\n\n在 iOS 16 中部分 API 废弃，需要开发者进行适配，同时有一些新能力可以实现。\n\n### UIDevice\n\n- 为了防止用户留下指纹， `UIDevice.name` 现在会报告模型名称而非用户自定义的设备名称。 使用自定义名称需要获得授权。\n    \n    ```objectivec\n    // iOS 16 之前 (e.g. \"My iPhone\")\n    // iOS 16 (e.g. \"iPhone 13\")\n    UIDevice().name\n    ```\n    \n- 不再支持 `UIDevice.orientation`， 应使用 `UIViewController` 相关API， 如 `preferredInterfaceOrientation` 来获取应用界面的预期呈现方向。\n    \n    ```objectivec\n    // UIDeviceOrientation(rawValue: 0) -> .unknown\n    UIDevice().orientation\n    \n    // UIInterfaceOrientation(rawValue: 1) -> .portrait (iPhone)\n    UIViewController().preferredInterfaceOrientationForPresentation\n    ```\n    \n\n### UIScreen\n\niOS 16 为 配备了 M1 芯片的 iPad 以及 Mac 带来了 Stage Manager （台前调度）功能，作为应用开发者无需对代码进行改动即可适用该功能。\n\n<aside>\n💡 在 iOS 13 前开发单窗口的 App，由 `UIApplication` 负责 App 状态，`UIApplicationDelegate`（`AppDelegate`）负责 App 事件和生命周期，然而这种模式不适用于开发多窗口的 iPad App 或 Mac Catalyst App。 iOS 13 引入了构建多窗口应用的 `UIScene`，并对功能职责进行了重新拆分，将 UI 相关的状态、事件和生命周期交与 `UIWindowScene` 和 `UIWindowSceneDelegate`（`SceneDelegate`）负责，`UISceneSession` 负责持久化的 UI 状态。\n\n</aside>\n\n如果仍在使用旧版本的 UIScreen API，有必要迁移到新的 `UITraitCollection` 和 `UIScene` API\n\n[Apple Developer Documentation](https://developer.apple.com/documentation/uikit/uiscreen/deprecated_symbols)\n\n- `UIScreen.main` 已废弃，需要使用`(UIApplication.shared.connectedScenes.first as? UIWindowScene)?.screen`\n- UIScreen 生命周期通知废弃，包括 `didConnectNotification`、`didDisconnectNotification`，需要使用 `UIScene`相关方法\n\n### 自适应大小 cell\n\n`UICollectionView` 和 `UITableView` 的 cell 支持了自适应调整大小能力。控制自适应调整大小的是 `selfSizingInvalidation` 属性，默认开启。\n\n```swift\nclass UICollectionView {\n\t\t// Default is .enabled\n    var.selfSizingInvalidation: SelfSizingInvalidation\n}\n\n@available(iOS 16.0, *)\n    public enum SelfSizingInvalidation : Int, @unchecked Sendable {\n\n        /// No updates will take place when -invalidateIntrinsicContentSize is called on a self-sizing cell or its contentView.\n        case disabled = 0\n\n        /// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary.\n        case enabled = 1\n\n        /// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary, and\n        /// any Auto Layout changes within the contentView of a self-sizing cell will automatically trigger -invalidateIntrinsicContentSize.\n        case enabledIncludingConstraints = 2\n    }\n```\n\n- 若使用了 `UIListContentConfiguration` 配置cell，每当 cell 的配置发生更改时会自动执行 invalidation。\n- 若不使用 `UIListContentConfiguration` 配置cell，可以调用 cell 的 `invalidateIntrinsicContentSize` 方法手动执行 invalidation。\n- 若使用 Auto Layout 布局cell，可以通过设置 `selfSizingInvalidation` 属性为`enabledInclingConstraints` 来使其接收 Auto Layout 变更。即当 cell 检测到 contentView 内部的任何自动布局变化时，将自动调用 `invalidateIntrinsicContentSize` 方法。\n\n默认情况下 cell 自适应调整大小会伴随着动画，可以在 `invalidateIntrinsicContentSize` 方法外包一层 `performWithoutAnimation` 从而取消调整大小时的动画。 \n\n```swift\n@objc private func didTapCollapseButton() {\n        label.text = Constants.shortText\n    }\n\n@objc private func didTapCollapseWithoutAnimationButton() {\n        label.text = Constants.shortText\n        UIView.performWithoutAnimation {\n            self.invalidateIntrinsicContentSize()\n        }\n    }\n```\n\n![SelfSizing.gif](http://image.stephenfang.me/mweb/SelfSizing.gif)\n\n`UICollectionView` 和 `UITableView` 将 cell 自适应大小的 invalidation 行为智能合并处理，并在最佳时间执行更新。\n\n### UISheetPresentationController\n\n在 iOS 15 上苹果推出了表单展示控件，可以通过简单的代码 present 出 `.medium()` 和 `.large()` 两种大小的底部表单。\n\n```swift\n// on iOS 15\nlet vc = UINavigationController(rootViewController: DemoViewController())\nif let sheet = vc.sheetPresentationController {\n\t\tsheet.detents = [.medium(), .large()]\n}\nself.present(vc, animated: true)\n```\n\n用户可以通过拖拽的方式实现高度的切换，但是当时底栏不具备自定义高度的能力。\n\n![UISheetPresentationController1.png](http://image.stephenfang.me/mweb/UISheetPresentationController1.png)\n\n![UISheetPresentationController2.png](http://image.stephenfang.me/mweb/UISheetPresentationController2.png)\n\n在 iOS 16 上苹果开放了 `UISheetPresentationController.Detent.Identifier` 提供了自定义的能力。\n\n可以简单返回一个常量值或最大高度的百分比来控制表单高度。\n\n```swift\n@MainActor open class Detent : NSObject {\n        open class func medium() -> Self\n        open class func large() -> Self\n\n        @available(iOS 16.0, *)\n        open var identifier: UISheetPresentationController.Detent.Identifier { get }\n    }\n\n// Create a custom detent\nsheet.detents = [\n    .large(),\n    .custom { context in\n        0.3 * context.maximumDetentValue\n    }\n]\n```\n\n更标准的做法是通过自定义 identifier 定制表单展示控件的高度。\n\n```swift\n// Define a custom identifier\nextension UISheetPresentationController.Detent.Identifier {\n    static let small = UISheetPresentationController.Detent.Identifier(\"small\")\n}\n\n// Assign identifier to custom detent\nsheet.detents = [\n    .large(),\n    .custom (identifier: .small) { context in\n        0.3 * context.maximumDetentValue\n    }\n]\n\n// Disable dimming above the custom detent\nsheet.largestUndimmedDetentIdentifier = .small\n```\n\n在使用的过程总需要注意表单展示控件高度不包含 `SafeAreaInsets`，计算布局时需要注意。\n\n![UISheetPresentationController](http://image.stephenfang.me/mweb/UISheetPresentationController.png)\n\n## UI 控件\n\n### UIPasteControl\n\n在 iOS 16 前在 app 内执行复制粘贴操作会在顶部显示banner，在 iOS 16上 banner 被 alert 所取代。仍然由系统自动提示，根据用户的选项允许剪贴板内容访问。\n\n![UIPasteControl0](http://image.stephenfang.me/mweb/UIPasteControl0.png)\n\n![UIPasteControl1](http://image.stephenfang.me/mweb/UIPasteControl1.png)\n\n开发者可以用新加入的 `UIPasteControl` 作为粘贴控件替换这个 alert，可以在[这里](https://developer.apple.com/documentation/uikit/uipastecontrol)找到相关文档。\n\n```swift\nfileprivate lazy var pasteControl: UIPasteControl = {\n        let pasteControlConfig = UIPasteControl.Configuration()\n        pasteControlConfig.baseBackgroundColor = .systemBlue\n        pasteControlConfig.baseForegroundColor = .white\n        pasteControlConfig.cornerRadius = 5.0\n        pasteControlConfig.displayMode = .iconAndLabel\n        \n        let pasteControl = UIPasteControl(configuration: pasteControlConfig)\n        pasteControl.target = self\n        return pasteControl\n    } ()\n\n// MARK: UIPasteConfigurationSupporting\n    \n    override func canPaste(_ itemProviders: [NSItemProvider]) -> Bool {\n        return true\n    }\n    \n    override func paste(itemProviders: [NSItemProvider]) {\n        if let itemProvider = itemProviders.first {\n            if itemProvider.canLoadObject(ofClass: NSString.self) {\n                itemProvider.loadObject(ofClass: NSString.self) { (text, error) in\n                    if text != nil {\n                        DispatchQueue.main.async {\n                            self.label.text = text as? String\n                        }\n                    }\n                }\n            }\n        }\n    }\n```\n\n![UIPasteControl2](http://image.stephenfang.me/mweb/UIPasteControl2.png)\n\n![UIPasteControl3](http://image.stephenfang.me/mweb/UIPasteControl3.png)\n\n这个适配虽然达成了必须有用户交互才能读取剪贴板的目的，但也等来了一些开发者的吐槽。\n\n[https://twitter.com/cyanapps/status/1535187013611438081](https://twitter.com/cyanapps/status/1535187013611438081)\n\n\n### UIPageControl\n\n`UIPageControl` 在 iOS 16 上得到了增强，主要包括以下两点\n\n1. 可以针对不同的选中状态展示不同的图像\n    \n    ```swift\n    /// The preferred image for the current page indicator. Symbol images are recommended. Default is nil.\n        /// If this value is nil, then UIPageControl will use \\c preferredPageIndicatorImage (or its per-page variant) as\n        /// the indicator image.\n        @available(iOS 16.0, *)\n        open var preferredCurrentPageIndicatorImage: UIImage?\n    ```\n    \n2. 可以设置布局方向为水平或垂直\n    \n    ```swift\n    /// The layout direction of the page indicators. The default value is \\c UIPageControlDirectionNatural.\n        @available(iOS 16.0, *)\n        open var direction: UIPageControl.Direction\n    \n    @available(iOS 16.0, *)\n        public enum Direction : Int, @unchecked Sendable {\n    \n            \n            /// Page indicators are laid out in the natural direction of the system locale.\n            /// By default, this is equivalent to @c UIPageControlDirectionLeftToRight on LTR locales, and\n            /// @c UIPageControlDirectionRightToLeft on RTL locales.\n            case natural = 0\n    \n            /// Page indicators are laid out from left to right.\n            case leftToRight = 1\n    \n            /// Page indicators are laid out from right to left.\n            case rightToLeft = 2\n    \n            /// Page indicators are laid out from top to bottom.\n            case topToBottom = 3\n    \n            /// Page indicators are laid out from bottom to top.\n            case bottomToTop = 4\n        }\n    ```\n    \n\nGitHub上的 [@ferhanakkan](https://github.com/ferhanakkan) 提供了以下 Demo。\n\n```swift\nprivate lazy var pageControl: UIPageControl = {\n        $0.backgroundColor = .orange\n        $0.layer.cornerRadius = 8\n        $0.layer.masksToBounds = true\n        $0.currentPage = .zero\n        $0.numberOfPages = collectionViewData.count\n        $0.direction = .leftToRight\n        $0.preferredIndicatorImage = UIImage(systemName: \"star\")\n        $0.preferredCurrentPageIndicatorImage = UIImage(systemName: \"star.fill\")\n        $0.translatesAutoresizingMaskIntoConstraints = false\n        return $0\n    }(UIPageControl())\n```\n\n![UIPageControl.gif](http://image.stephenfang.me/mweb/UIPageControl.gif)\n\n### UICalendarView\n\n之前一直希望 iOS 能够集成一个类似 [FSCalendar](https://github.com/WenchaoD/FSCalendar) 的日历组件，在 iOS 16上终于算是等到了。`UICalendarView` 是 `UIDatePicker` 的内联日历样式，它和 `UIDatePicker` 最主要的一个区别在于 `UICalendarView` 将日期表示为 `NSDateComponents` 而不是 `NSDate`。\n\n<aside>\n💡 `NSDateComponents` 能够更好、更精确地表示数据模型， `NSDate` 是时间点的表示。\n\n</aside>\n\n`UICalendarView`现在作为一个独立的全功能组件形式提供，它具备了以下几种特性。\n\n- 支持日期单选或多选\n- 支持在范围内框选日期和禁用个别日期\n- 支持对标注日期进行装饰\n- 明确由哪个 `NSCalendar` 表示\n\n接下来尝试构建一个多选日期日历。\n\n1. 创建一个 `UICalendarView` 对象，为其设置 `delegate` 并指定其 `calendar` 属性。如果需要采用农历，更改 `NSCalendar` 的初始化即可（ `Calendar(identifier: .chinese)`）\n2. 配置多日期选择需要创建一个 `UICalendarSelectionMultiDate` 对象，并为其 `selectedDates` 属性进行赋值，再将此对象作为 `selectionBehavior` 属性传给我们创建的 `UICalendarView` 对象\n3. 通过 `UICalendarViewDelegate` 中的 `multidateselect: canSelectDate:` 方法可以控制哪些日期可以被选择，如防止日历中选中单个日期。无法选择的日期会被置灰。\n\n```swift\n// Configuring a calendar view with multi-date selection\n\nlet calendarView = UICalendarView()\ncalendarView.delegate = self\ncalendarView.calendar = Calendar(identifier: .gregorian)\nview.addSubview(calendarView)\n\nlet multiDateSelection = UICalendarSelectionMultiDate(delegate: self)\nmultiDateSelection.selectedDates = myDatabase.selectedDates()\ncalendarView.selectionBehavior = multiDateSelection\n\nfunc multiDateSelection(\n    _ selection: UICalendarSelectionMultiDate,\n    canSelectDate dateComponents: DateComponents\n) -> Bool {\n    return myDatabase.hasAvailabilities(for: dateComponents)\n}\n```\n\n`UICalendarViewDelegate` 提供了 `calendarView: decorationForDateComponents:` 方法对日历中的日期进行装饰。\n\n- 如果不需要装饰直接返回 nil 即可\n- 可以通过简单的图像构造装饰日期\n- 可以通过自定义视图装饰日期\n- 自定义装饰视图不允许交互\n\n```swift\n// Configuring Decorations\nfunc calendarView(\n    _ calendarView: UICalendarView, \n    decorationFor dateComponents: DateComponents\n) -> UICalendarView.Decoration? {\n    switch myDatabase.eventType(on: dateComponents) {\n    case .none:\n        return nil\n    case .busy:\n        return .default()\n    case .travel:\n        return .image(airplaneImage, color: .systemOrange)\n    case .party:\n        return .customView {\n            MyPartyEmojiLabel()\n        }\n    }\n}\n```\n\n![UICalendarView](http://image.stephenfang.me/mweb/UICalendarView.png)\n\n## 导航栏提升\n\n### **UINavigationItemStyle**\n\n新引入了 `Browser`、`Editor` 两种导航样式，目前支持的`UINavigationItemStyle` 有以下几种\n\n![UINavigationItemStyle](http://image.stephenfang.me/mweb/UINavigationItemStyle.png)\n\n- `Navigator`：遵循传统的 push / pop 模型，如设置app\n- `Browser`：使用历史记录或文件夹结构导航，如 Safari、系统文件app\n- `Editor`：导航栏中间为文件相关操作，标题则在最左边\n\n```swift\n// Adopt the editor navigation style for the navigation item.\nnavigationItem.style = .editor\n```\n\n### Center Items\n\ncenter items 是展示在导航栏中间的的控件组，能够提供对应用程序最重要功能的快速访问。\n\n![CenterItems](http://image.stephenfang.me/mweb/CenterItems.png)\n\n用户可以移动、移除或添加来定制导航栏的 center items。默认不展示的 center items 出现在自定义弹出窗口中，可以通过点击更多按钮中的 Customize Toolbar 菜单访问。\n\n为了实现这一能力，应用程序需要为导航项的`customizationIdentifier`属性提供一个字符串，UIKit 能够根据这个 identifier 自动保存和恢复用户自定义设定。\n\n```swift\n/// Setting a non-nil customizationIdentifier enables customization and UIKit will automatically save & restore customizations based on this identifier. The identifier must be unique within the scope of the application.\n    @available(iOS 16.0, *)\n    open var customizationIdentifier: String?\n\n// Set a customizationIdentifier and add center item groups.\nnavigationItem.customizationIdentifier = \"editorViewCustomization\"\n```\n\n配置 center Items 需要为 `navigationItem.centerItemGroups` 属性赋值\n\n- 若需创建用户无法移动或移除的 item，需要调用 `UIBarButtonItem` 的实例方法 `createFixedGroup()`\n- 若需创建可调整的 `BarButtonItemGroup`\n    - 拟定 `customizationIdentifier` 作为唯一标识\n    - `UIBarButtonItems` 一次只能在一个 `UIBarButtonItemGroup` 中\n    - 将一个 bar button item添加到一个 group 中会将其从之前的任何 group 中移除\n    - `isInDefaultCustomization`属性设置默认是否出现在导航栏中\n    - `BarButtonItemGroup` 通常包含多个可以提供定制能力的 `UIAction`\n\n```swift\n\n/// Create a fixed group containing this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.\n    @available(iOS 16.0, *)\n    open func creatingFixedGroup() -> UIBarButtonItemGroup\n\n/// Create an optional BarButtonItemGroup containing only this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.\n    @available(iOS 16.0, *)\n    @available(tvOS, unavailable)\n    @available(watchOS, unavailable)\n    @MainActor public func creatingOptionalGroup(customizationIdentifier: String, isInDefaultCustomization: Bool = true) -> UIBarButtonItemGroup\n\nprivate func configureCenterItemGroups() {\n\n\t\t\t\t\tnavigationItem.centerItemGroups = [\n            UIBarButtonItem(primaryAction: UIAction(title: \"Sync Scrolling\", image: syncScrollingImage) { [unowned self] action in\n                syncScrolling.toggle()\n                if let barButtonItem = action.sender as? UIBarButtonItem {\n                    barButtonItem.image = syncScrollingImage\n                }\n            }).creatingFixedGroup(),\n            \n           UIBarButtonItem(primaryAction: UIAction(title: \"Add Link\", image: UIImage(systemName: \"link\")) { [unowned self] _ in\n                insertTag(.link)\n            }).creatingOptionalGroup(customizationIdentifier: \"addLink\")\n\t\t\t\t\t],\n\n\t\t\t\t\tUIBarButtonItem(title: \"Insert Image\", image: UIImage(systemName: \"photo\"), menu: UIMenu(title: \"Insert Image\", children: [\n                UIAction(title: \"From Photo Library\", image: UIImage(systemName: \"photo.on.rectangle\")) { [unowned self] _ in\n                    let picker = UIImagePickerController()\n                    picker.delegate = self\n                    present(picker, animated: true)\n                },\n                UIAction(title: \"From File\", image: UIImage(systemName: \"folder\")) { [unowned self] _ in\n                    let picker = UIDocumentPickerViewController(forOpeningContentTypes: [.image], asCopy: true)\n                    picker.delegate = self\n                    isPickingImageFromFile = true\n                    present(picker, animated: true)\n                },\n                UIAction(title: \"Blank Image Tag\", image: UIImage(systemName: \"tag\")) { [unowned self] _ in\n                    insertTag(.image)\n                }\n            ])).creatingOptionalGroup(customizationIdentifier: \"addImage\")\n}\n```\n\ncenter items 针对 Mac Catalyst 的 NSToolbar 和 iPad 并排模式能够实现自动适配。\n\n![NSToolbar](http://image.stephenfang.me/mweb/NSToolbar.png)\n\n![iPadSide](http://image.stephenfang.me/mweb/iPadSide.png)\n\n### 文件菜单\n\n当用户点击导航项目的标题时会出现文件菜单，从上到下可以将其拆分成三部分\n\n1. Document header：包含文件名、文件类型、文件大小、分享菜单等\n2. Suggested  title menu：与当前文档相关的建议操作\n3. Custom title menu：自定义操作\n\n![TitleMenu](http://image.stephenfang.me/mweb/TitleMenu.png)\n\n**Document header**\n\nDocument header 显示当前文档相关的信息，包括标题、文件类型和大小，还提供了分享或拖放文档的能力。\n\n```swift\n@available(iOS 16.0, *)\n@MainActor open class UIDocumentProperties : NSObject {\n\n    \n    /// When initializing with a url, UIKit will automatically lookup metadata based on the data at that url.\n    public init(url: URL)\n\n    \n    /// Initialize with metadata directly when the item is not backed by a url.\n    public init(metadata: LPLinkMetadata)\n\n    \n    /// The metadata to use. UIKit will generate this automatically if a url is given at initialization time.\n    @NSCopying open var metadata: LPLinkMetadata\n\n    \n    /// To support drag & drop, assign a closure to return an array of drag items corresponding to the represented document.\n    open var dragItemsProvider: ((UIDragSession) -> [UIDragItem])?\n\n    \n    /// To support sharing, assign a closure to return a UIActivityViewController configured to share the represented document.\n    open var activityViewControllerProvider: (() -> UIActivityViewController)?\n\n    \n    /// If enabled, shows an icon representation of the document in the navigation bar.\n    open var wantsIconRepresentation: Bool\n}\n```\n\n如果需要Document header相关能力**，**使用`UIDocumentProperties` 对象给`navigationItem.documentProperties`属性赋值即可。\n\n```swift\nlet documentProperties = UIDocumentProperties(url: document.fileURL)\nif let itemProvider = NSItemProvider(contentsOf: document.fileURL) {\n    documentProperties.dragItemsProvider = { _ in\n        [UIDragItem(itemProvider: itemProvider)]\n    }\n    documentProperties.activityViewControllerProvider = {\n        UIActivityViewController(activityItems: [itemProvider], applicationActivities: nil)\n    }\n}\n\nnavigationItem.title = document.localizedName\nnavigationItem.documentProperties = documentProperties\n```\n\n**Title Menu**\n\n配置 title menu 需要给 `navigationItem.titleMenuProvider` 返回菜单 closure。系统返回给closure了一组 suggested actions，包括移动和复制；应用定义了动作包括文档导出为 HTML 和 PDF。\n\n```swift\n/// When non-nil, UIKit will generate suggestedActions and call this block to generate a menu that is displayed from the title.\n    @available(iOS 16.0, *)\n    open var titleMenuProvider: (([UIMenuElement]) -> UIMenu?)?\n\nnavigationItem.titleMenuProvider = { suggested in\n    let custom = [\n        UIMenu(title: \"Export…\", image: UIImage(systemName: \"arrow.up.forward.square\"), children: [\n            UIAction(title: \"HTML\", image: UIImage(systemName: \"safari\")) { [unowned self] _ in\n                previewView.exportAsWebArchive(named: document.localizedName, presenter: self)\n            },\n            UIAction(title: \"PDF\", image: UIImage(systemName: \"doc.richtext\")) { [unowned self] _ in\n                previewView.exportAsPDF(named: document.localizedName, presenter: self)\n            }\n        ])\n    ]\n    return UIMenu(children: suggested + custom)\n}\n```\n\n`UINavigationItem`提供了对文件重命名的支持。\n\n```swift\npublic protocol UINavigationItemRenameDelegate : AnyObject {\n\n    /// This method is called when renaming has ended. The title on the navigation item has already been changed when this method is called but\n    /// clients can make further adjustments to it when necessary.\n    func navigationItem(_: UINavigationItem, didEndRenamingWith title: String)\n\n    /// Controls whether the rename action is supported for the given navigation item. For example this method is called when the navigation bar's\n    /// document menu is shown to validate if the rename action should be part of that menu.\n    func navigationItemShouldBeginRenaming(_: UINavigationItem) -> Bool\n\n    /// Called when we begin renaming. Implementing this method allows for customizing the initial text that will show up in the text field as well as the\n    /// selected range of that text.\n    func navigationItem(_: UINavigationItem, willBeginRenamingWith suggestedTitle: String, selectedRange: Range<String.Index>) -> (String, Range<String.Index>)\n\n    /// This method can be used to prevent renaming from happening. However there are cases (e.g. when a new navigation item is pushed on the navigation\n    /// bar) where this method will not be called and instead navigationItem:didEndRenamingWithTitle: is called right away. Clients are therefore expected to\n    /// handle titles in navigationItem:didEndRenamingWithTitle: for which they would return NO from navigationItem:shouldEndRenamingWithTitle:.\n    func navigationItem(_: UINavigationItem, shouldEndRenamingWith title: String) -> Bool\n}\n```\n\n启用该能力需要遵循`UINavigationItemRenameDelegate`，并使用 `navigationItem.renameDelegate` 绑定到 self。\n\n```swift\nnavigationItem.renameDelegate = self\n```\n\n## 体验提升\n\n如果你对这部分内容感兴趣可以移步此[Session](https://developer.apple.com/wwdc22/10071)\n\n### Find and Replace\n\n`UITextView`、`WKWebView`、`PDFView` 都支持了系统层级的查找与替换功能。\n\n![editorTextView](http://image.stephenfang.me/mweb/editorTextView.png)\n\n如果你在开发中的视图是上述 View 的子类，如`editorTextView` 是`UITextView` 的子类，启用查找和替换只需要一行代码。\n\n```swift\neditorTextView.isFindInteractionEnabled = true\n```\n\n\n### UIEditMenu\n\nEdit menu 交互菜单能够针对当前展示的内容提供诸如剪切、粘贴和粘贴等编辑动作。系统会针对当前用户的交互方式提供符合交互的菜单展示形式。\n\n![UIEditMenu0](http://image.stephenfang.me/mweb/UIEditMenu0.png)\n\n![UIEditMenu1](http://image.stephenfang.me/mweb/UIEditMenu1.png)\n\n- 对于触摸交互，动作以 editing menu 的形式展示\n- 对于指针的交互，动作以 context menu的形式展示\n\n标准的 UIKit 类，如 `UITextView` 或者 `UITextField`，已经预先支持了Edit Menu交互，你可以便捷地框选一个地址然后获得类似地图导航的交互菜单选项。\n\n![UIEditMenu2.png](http://image.stephenfang.me/mweb/UIEditMenu2.png)\n\n在通用视图中添加 Edit menu 交互菜单\n\n1. 创建一个 Edit menu 交互对象，并在默认 initializer 传入一个可选的 delegate。\n2. 在视图上调用 `addInteraction(_:)` 来添加交互对象\n3. 创建一个 gesture recognizer 来触发交互，并将其添加到视图中\n\n以下苹果提供的例子中创建了一个由长按触发的 Edit menu 交互菜单。\n\n```swift\noverride func viewDidLoad() {\n    super.viewDidLoad()\n\n    // Add the edit menu interaction.\n    editMenuInteraction = UIEditMenuInteraction(delegate: self)\n    interactionView.addInteraction(editMenuInteraction!)\n\n    // Create the gesture recognizer.\n    let longPress = UILongPressGestureRecognizer(target: self, action: #selector(didLongPress(_:)))\n    longPress.allowedTouchTypes = [UITouch.TouchType.direct.rawValue as NSNumber]\n    interactionView.addGestureRecognizer(longPress)\n}\n\n@objc func didLongPress(_ recognizer: UIGestureRecognizer) {\n    let location = recognizer.location(in: self.view)\n    let configuration = UIEditMenuConfiguration(identifier: nil, sourcePoint: location)\n\n    if let interaction = editMenuInteraction {\n        // Present the edit menu interaction.\n        interaction.presentEditMenu(with: configuration)\n    }\n}\n```\n\n- Edit menu 交互菜单包括标准编辑操作，包括剪贴、复制、删除等等，可参考`UIResponderStandardEditActions`。\n- 可以使用 `UIEditMenuInteractionDelegate` 提供的方法向Edit menu 交互菜单添加额外项目。\n- 对于文本视图可以使用`UITextViewDelegate`、`UITextFieldDelegate`或`UITextInput`中的方法为特定文本范围指定菜单显示的项目。\n\n### Sidebar\n\n在 iOS 16 中，侧边栏会在 Slide-over（侧拉）模式下自动显示。UIKit 会管理一组私有视图。\n\n![Sidebar](http://image.stephenfang.me/mweb/Sidebar.png)\n\n\n### SFSymbols\n\nSFSymbols 在 iOS 16 上支持四种 `renderingMode`，分别是 \n\n- monochrome\n- multicolor\n- hierarchical\n- palette\n\n![renderingMode](http://image.stephenfang.me/mweb/renderingMode.png)\n\n在 iOS 15 及之前的版本中，默认使用 monochrome 渲染 symbol。\n\n在 iOS 16 如果没有指定renderingMode，默认使用 hierarchical 渲染 symbol，可以通过 `UIImage.SymbolConfiguration.preferringMonochrome()` 指定渲染方式。\n\n![preferringMonochrome](http://image.stephenfang.me/mweb/preferringMonochrome.png)\n\n同时增加了对可变 symbol 的支持，即支持根据从 0 到 1 的值变化映射 symbol 的变化，当然，这需要 symbol 自身支持该能力。\n\n假设 App 使用了`speaker.3.wave.fill` 符号表示当前音量级别，在值为 0 时扬声器波纹消失表示最低音量水平，当该值增加到 1 时扬声器的波形逐渐填充完整，表示音量水平提高。\n\n![variableValue](http://image.stephenfang.me/mweb/variableValue.png)\n\n使用方法也非常简单直白，通过标准的 SF Symbols API 为 UIImage 设置 `variableValue` 参数即可，甚至将该属性与 `renderingMode` 组合使用以进一步设计符号的样式。\n\n以下为 GitHub上 [@ferhanakkan](https://github.com/ferhanakkan) 的 Demo。\n\n```swift\n@objc private func sliderDidValueChange(_ sender: UISlider) {\n        imageView.image = UIImage(\n            systemName: \"wifi\",\n            variableValue: Double(sender.value),\n            configuration: UIImage.SymbolConfiguration(paletteColors: [.orange])\n        )\n    }\n```\n\n![sfsymbols.gif](http://image.stephenfang.me/mweb/sfsymbols.gif)\n\n学习如何创建自定义变量符号可以观看 [Adopt variable color in SF Symbols](https://developer.apple.com/videos/play/wwdc2022/10158/) 和 [What's new in SF Symbols 4](https://developer.apple.com/videos/play/wwdc2022/10157/) 这两个Session。\n\n### Swift Concurrency and Sendable\n\nUIKit 现在可以与 Swift Concurrency 同时使用，包括 immutable 类型，如以下的类型遵循了 Sendable\n\n- `UIImage`\n- `UIColor`\n- `UIFont`\n- `UITraitCollection`\n\n对象可以在 MainActor 和自定义 actor 之间发送而不会收到编译器警告。\n\n苹果提供的例子中，有一个叫做 Processor 的自定义 actor，以及一个被绑定到 MainActor 的叫做 ImageViewer 的 ViewController。在 `sendImageForProcessing` 方法中 ImageViewer 将图像发送给 Processor进行处理，目前是安全的。\n\n因为 UIImage 是 immutable 类型， Processor 必须创建新的拷贝来执行操作。任何引用原始图像的代码都不会显示这些修改，共享状态也不会发生不安全的变化。\n\n![Concurrency0](http://image.stephenfang.me/mweb/Concurrency0.png)\n\n对比一下因为 mutable 而没有遵循 Sendable 的 UIBezierPath，以前只能在文档中表示，现在可以由编译器进行检查。\n\n![Concurrency1](http://image.stephenfang.me/mweb/Concurrency1.png)\n\n要了解更多关于 Sendable 和 Swift Concurrency 移步视频 [Eliminate data races using Swift Concurrency](https://developer.apple.com/videos/play/wwdc2022/110351/) 和 [Visualize and optimize Swift Concurrency](https://developer.apple.com/videos/play/wwdc2022/110350/)。\n\n## UIKit and SwiftUI\n\n过去如果想要实现将 SwiftUI 视图嵌入 UIView 视图，一般需要这么做。\n\n```swift\nlet controller = UIHostingController(rootView: SwiftUIView())\naddChild(controller)\nview.addSubview(controller.view)\ncontroller.didMove(toParent: self)\n```\n\n在 iOS 16上推出了 `UIHostingConfiguration` ，你可以在 `UICollectionView` 和 `UITableView` 中以 `contentConfiguration` 的方式将 SwiftUI 构建的 View 嵌入 cell。\n\n```swift\ncell.contentConfiguration = UIHostingConfiguration {\n    SwiftUIView()\n}\n```\n\n## 结束语\n\n最近几年的 WWDC 中看到苹果对于 UIKit 的理解，倡导使用 configuration 的方式构建组件、菜单，一方面参照人机交互指南构建组件能够确保交互不被滥用，另一方面降低了开发者的接入成本。\n\n作为开发者，一起尝试兼容 app 到 iOS 16，适配新的API，探索新的业务可能性吧。\n\n## 参考链接\n\n- [https://www.swiftjectivec.com/ios-16-notable-uikit-additions/](https://www.swiftjectivec.com/ios-16-notable-uikit-additions/)\n- [https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22](https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22)\n- [https://developer.apple.com/wwdc22/10068](https://developer.apple.com/wwdc22/10068)\n- [https://juejin.cn/post/7111173753668632584](https://juejin.cn/post/7111173753668632584)\n- [https://github.com/WenchaoD/FSCalendar](https://github.com/WenchaoD/FSCalendar)","source":"_posts/WWDC22-UIKit.md","raw":"---\ntitle: WWDC22 UIKit 新变化\ndate: 2022-07-24 23:15:00\ncategories: \n- 技术\ntags: \n- iOS\n- Swift\n- WWDC\ncopyright: true\n---\n\n最近几年的 WWDC 每年都能看到很多 SwiftUI 的新能力，但不能忽略的是 UIKit 框架的更新。\n\n今年的 [What’s New in UIKit Session](https://developer.apple.com/videos/play/wwdc2022/10068/) 主要包括以下几个方面\n\n- 生产力提升\n- 控制增强\n- API 改进\n- UIKit 与 SwiftUI 混编\n\n我按照业务理解和适配进度的优先级，对 session 内容进行了重新排序和整理，对 [@ferhanakkan](https://github.com/ferhanakkan) 的仓库进行了一些改动，以下为我的总结。\n\n<!--more-->\n\n[https://github.com/iamStephenFang/WhatsNewInUIKit](https://github.com/iamStephenFang/WhatsNewInUIKit)\n\n\n## API 改进\n\n在 iOS 16 中部分 API 废弃，需要开发者进行适配，同时有一些新能力可以实现。\n\n### UIDevice\n\n- 为了防止用户留下指纹， `UIDevice.name` 现在会报告模型名称而非用户自定义的设备名称。 使用自定义名称需要获得授权。\n    \n    ```objectivec\n    // iOS 16 之前 (e.g. \"My iPhone\")\n    // iOS 16 (e.g. \"iPhone 13\")\n    UIDevice().name\n    ```\n    \n- 不再支持 `UIDevice.orientation`， 应使用 `UIViewController` 相关API， 如 `preferredInterfaceOrientation` 来获取应用界面的预期呈现方向。\n    \n    ```objectivec\n    // UIDeviceOrientation(rawValue: 0) -> .unknown\n    UIDevice().orientation\n    \n    // UIInterfaceOrientation(rawValue: 1) -> .portrait (iPhone)\n    UIViewController().preferredInterfaceOrientationForPresentation\n    ```\n    \n\n### UIScreen\n\niOS 16 为 配备了 M1 芯片的 iPad 以及 Mac 带来了 Stage Manager （台前调度）功能，作为应用开发者无需对代码进行改动即可适用该功能。\n\n<aside>\n💡 在 iOS 13 前开发单窗口的 App，由 `UIApplication` 负责 App 状态，`UIApplicationDelegate`（`AppDelegate`）负责 App 事件和生命周期，然而这种模式不适用于开发多窗口的 iPad App 或 Mac Catalyst App。 iOS 13 引入了构建多窗口应用的 `UIScene`，并对功能职责进行了重新拆分，将 UI 相关的状态、事件和生命周期交与 `UIWindowScene` 和 `UIWindowSceneDelegate`（`SceneDelegate`）负责，`UISceneSession` 负责持久化的 UI 状态。\n\n</aside>\n\n如果仍在使用旧版本的 UIScreen API，有必要迁移到新的 `UITraitCollection` 和 `UIScene` API\n\n[Apple Developer Documentation](https://developer.apple.com/documentation/uikit/uiscreen/deprecated_symbols)\n\n- `UIScreen.main` 已废弃，需要使用`(UIApplication.shared.connectedScenes.first as? UIWindowScene)?.screen`\n- UIScreen 生命周期通知废弃，包括 `didConnectNotification`、`didDisconnectNotification`，需要使用 `UIScene`相关方法\n\n### 自适应大小 cell\n\n`UICollectionView` 和 `UITableView` 的 cell 支持了自适应调整大小能力。控制自适应调整大小的是 `selfSizingInvalidation` 属性，默认开启。\n\n```swift\nclass UICollectionView {\n\t\t// Default is .enabled\n    var.selfSizingInvalidation: SelfSizingInvalidation\n}\n\n@available(iOS 16.0, *)\n    public enum SelfSizingInvalidation : Int, @unchecked Sendable {\n\n        /// No updates will take place when -invalidateIntrinsicContentSize is called on a self-sizing cell or its contentView.\n        case disabled = 0\n\n        /// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary.\n        case enabled = 1\n\n        /// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary, and\n        /// any Auto Layout changes within the contentView of a self-sizing cell will automatically trigger -invalidateIntrinsicContentSize.\n        case enabledIncludingConstraints = 2\n    }\n```\n\n- 若使用了 `UIListContentConfiguration` 配置cell，每当 cell 的配置发生更改时会自动执行 invalidation。\n- 若不使用 `UIListContentConfiguration` 配置cell，可以调用 cell 的 `invalidateIntrinsicContentSize` 方法手动执行 invalidation。\n- 若使用 Auto Layout 布局cell，可以通过设置 `selfSizingInvalidation` 属性为`enabledInclingConstraints` 来使其接收 Auto Layout 变更。即当 cell 检测到 contentView 内部的任何自动布局变化时，将自动调用 `invalidateIntrinsicContentSize` 方法。\n\n默认情况下 cell 自适应调整大小会伴随着动画，可以在 `invalidateIntrinsicContentSize` 方法外包一层 `performWithoutAnimation` 从而取消调整大小时的动画。 \n\n```swift\n@objc private func didTapCollapseButton() {\n        label.text = Constants.shortText\n    }\n\n@objc private func didTapCollapseWithoutAnimationButton() {\n        label.text = Constants.shortText\n        UIView.performWithoutAnimation {\n            self.invalidateIntrinsicContentSize()\n        }\n    }\n```\n\n![SelfSizing.gif](http://image.stephenfang.me/mweb/SelfSizing.gif)\n\n`UICollectionView` 和 `UITableView` 将 cell 自适应大小的 invalidation 行为智能合并处理，并在最佳时间执行更新。\n\n### UISheetPresentationController\n\n在 iOS 15 上苹果推出了表单展示控件，可以通过简单的代码 present 出 `.medium()` 和 `.large()` 两种大小的底部表单。\n\n```swift\n// on iOS 15\nlet vc = UINavigationController(rootViewController: DemoViewController())\nif let sheet = vc.sheetPresentationController {\n\t\tsheet.detents = [.medium(), .large()]\n}\nself.present(vc, animated: true)\n```\n\n用户可以通过拖拽的方式实现高度的切换，但是当时底栏不具备自定义高度的能力。\n\n![UISheetPresentationController1.png](http://image.stephenfang.me/mweb/UISheetPresentationController1.png)\n\n![UISheetPresentationController2.png](http://image.stephenfang.me/mweb/UISheetPresentationController2.png)\n\n在 iOS 16 上苹果开放了 `UISheetPresentationController.Detent.Identifier` 提供了自定义的能力。\n\n可以简单返回一个常量值或最大高度的百分比来控制表单高度。\n\n```swift\n@MainActor open class Detent : NSObject {\n        open class func medium() -> Self\n        open class func large() -> Self\n\n        @available(iOS 16.0, *)\n        open var identifier: UISheetPresentationController.Detent.Identifier { get }\n    }\n\n// Create a custom detent\nsheet.detents = [\n    .large(),\n    .custom { context in\n        0.3 * context.maximumDetentValue\n    }\n]\n```\n\n更标准的做法是通过自定义 identifier 定制表单展示控件的高度。\n\n```swift\n// Define a custom identifier\nextension UISheetPresentationController.Detent.Identifier {\n    static let small = UISheetPresentationController.Detent.Identifier(\"small\")\n}\n\n// Assign identifier to custom detent\nsheet.detents = [\n    .large(),\n    .custom (identifier: .small) { context in\n        0.3 * context.maximumDetentValue\n    }\n]\n\n// Disable dimming above the custom detent\nsheet.largestUndimmedDetentIdentifier = .small\n```\n\n在使用的过程总需要注意表单展示控件高度不包含 `SafeAreaInsets`，计算布局时需要注意。\n\n![UISheetPresentationController](http://image.stephenfang.me/mweb/UISheetPresentationController.png)\n\n## UI 控件\n\n### UIPasteControl\n\n在 iOS 16 前在 app 内执行复制粘贴操作会在顶部显示banner，在 iOS 16上 banner 被 alert 所取代。仍然由系统自动提示，根据用户的选项允许剪贴板内容访问。\n\n![UIPasteControl0](http://image.stephenfang.me/mweb/UIPasteControl0.png)\n\n![UIPasteControl1](http://image.stephenfang.me/mweb/UIPasteControl1.png)\n\n开发者可以用新加入的 `UIPasteControl` 作为粘贴控件替换这个 alert，可以在[这里](https://developer.apple.com/documentation/uikit/uipastecontrol)找到相关文档。\n\n```swift\nfileprivate lazy var pasteControl: UIPasteControl = {\n        let pasteControlConfig = UIPasteControl.Configuration()\n        pasteControlConfig.baseBackgroundColor = .systemBlue\n        pasteControlConfig.baseForegroundColor = .white\n        pasteControlConfig.cornerRadius = 5.0\n        pasteControlConfig.displayMode = .iconAndLabel\n        \n        let pasteControl = UIPasteControl(configuration: pasteControlConfig)\n        pasteControl.target = self\n        return pasteControl\n    } ()\n\n// MARK: UIPasteConfigurationSupporting\n    \n    override func canPaste(_ itemProviders: [NSItemProvider]) -> Bool {\n        return true\n    }\n    \n    override func paste(itemProviders: [NSItemProvider]) {\n        if let itemProvider = itemProviders.first {\n            if itemProvider.canLoadObject(ofClass: NSString.self) {\n                itemProvider.loadObject(ofClass: NSString.self) { (text, error) in\n                    if text != nil {\n                        DispatchQueue.main.async {\n                            self.label.text = text as? String\n                        }\n                    }\n                }\n            }\n        }\n    }\n```\n\n![UIPasteControl2](http://image.stephenfang.me/mweb/UIPasteControl2.png)\n\n![UIPasteControl3](http://image.stephenfang.me/mweb/UIPasteControl3.png)\n\n这个适配虽然达成了必须有用户交互才能读取剪贴板的目的，但也等来了一些开发者的吐槽。\n\n[https://twitter.com/cyanapps/status/1535187013611438081](https://twitter.com/cyanapps/status/1535187013611438081)\n\n\n### UIPageControl\n\n`UIPageControl` 在 iOS 16 上得到了增强，主要包括以下两点\n\n1. 可以针对不同的选中状态展示不同的图像\n    \n    ```swift\n    /// The preferred image for the current page indicator. Symbol images are recommended. Default is nil.\n        /// If this value is nil, then UIPageControl will use \\c preferredPageIndicatorImage (or its per-page variant) as\n        /// the indicator image.\n        @available(iOS 16.0, *)\n        open var preferredCurrentPageIndicatorImage: UIImage?\n    ```\n    \n2. 可以设置布局方向为水平或垂直\n    \n    ```swift\n    /// The layout direction of the page indicators. The default value is \\c UIPageControlDirectionNatural.\n        @available(iOS 16.0, *)\n        open var direction: UIPageControl.Direction\n    \n    @available(iOS 16.0, *)\n        public enum Direction : Int, @unchecked Sendable {\n    \n            \n            /// Page indicators are laid out in the natural direction of the system locale.\n            /// By default, this is equivalent to @c UIPageControlDirectionLeftToRight on LTR locales, and\n            /// @c UIPageControlDirectionRightToLeft on RTL locales.\n            case natural = 0\n    \n            /// Page indicators are laid out from left to right.\n            case leftToRight = 1\n    \n            /// Page indicators are laid out from right to left.\n            case rightToLeft = 2\n    \n            /// Page indicators are laid out from top to bottom.\n            case topToBottom = 3\n    \n            /// Page indicators are laid out from bottom to top.\n            case bottomToTop = 4\n        }\n    ```\n    \n\nGitHub上的 [@ferhanakkan](https://github.com/ferhanakkan) 提供了以下 Demo。\n\n```swift\nprivate lazy var pageControl: UIPageControl = {\n        $0.backgroundColor = .orange\n        $0.layer.cornerRadius = 8\n        $0.layer.masksToBounds = true\n        $0.currentPage = .zero\n        $0.numberOfPages = collectionViewData.count\n        $0.direction = .leftToRight\n        $0.preferredIndicatorImage = UIImage(systemName: \"star\")\n        $0.preferredCurrentPageIndicatorImage = UIImage(systemName: \"star.fill\")\n        $0.translatesAutoresizingMaskIntoConstraints = false\n        return $0\n    }(UIPageControl())\n```\n\n![UIPageControl.gif](http://image.stephenfang.me/mweb/UIPageControl.gif)\n\n### UICalendarView\n\n之前一直希望 iOS 能够集成一个类似 [FSCalendar](https://github.com/WenchaoD/FSCalendar) 的日历组件，在 iOS 16上终于算是等到了。`UICalendarView` 是 `UIDatePicker` 的内联日历样式，它和 `UIDatePicker` 最主要的一个区别在于 `UICalendarView` 将日期表示为 `NSDateComponents` 而不是 `NSDate`。\n\n<aside>\n💡 `NSDateComponents` 能够更好、更精确地表示数据模型， `NSDate` 是时间点的表示。\n\n</aside>\n\n`UICalendarView`现在作为一个独立的全功能组件形式提供，它具备了以下几种特性。\n\n- 支持日期单选或多选\n- 支持在范围内框选日期和禁用个别日期\n- 支持对标注日期进行装饰\n- 明确由哪个 `NSCalendar` 表示\n\n接下来尝试构建一个多选日期日历。\n\n1. 创建一个 `UICalendarView` 对象，为其设置 `delegate` 并指定其 `calendar` 属性。如果需要采用农历，更改 `NSCalendar` 的初始化即可（ `Calendar(identifier: .chinese)`）\n2. 配置多日期选择需要创建一个 `UICalendarSelectionMultiDate` 对象，并为其 `selectedDates` 属性进行赋值，再将此对象作为 `selectionBehavior` 属性传给我们创建的 `UICalendarView` 对象\n3. 通过 `UICalendarViewDelegate` 中的 `multidateselect: canSelectDate:` 方法可以控制哪些日期可以被选择，如防止日历中选中单个日期。无法选择的日期会被置灰。\n\n```swift\n// Configuring a calendar view with multi-date selection\n\nlet calendarView = UICalendarView()\ncalendarView.delegate = self\ncalendarView.calendar = Calendar(identifier: .gregorian)\nview.addSubview(calendarView)\n\nlet multiDateSelection = UICalendarSelectionMultiDate(delegate: self)\nmultiDateSelection.selectedDates = myDatabase.selectedDates()\ncalendarView.selectionBehavior = multiDateSelection\n\nfunc multiDateSelection(\n    _ selection: UICalendarSelectionMultiDate,\n    canSelectDate dateComponents: DateComponents\n) -> Bool {\n    return myDatabase.hasAvailabilities(for: dateComponents)\n}\n```\n\n`UICalendarViewDelegate` 提供了 `calendarView: decorationForDateComponents:` 方法对日历中的日期进行装饰。\n\n- 如果不需要装饰直接返回 nil 即可\n- 可以通过简单的图像构造装饰日期\n- 可以通过自定义视图装饰日期\n- 自定义装饰视图不允许交互\n\n```swift\n// Configuring Decorations\nfunc calendarView(\n    _ calendarView: UICalendarView, \n    decorationFor dateComponents: DateComponents\n) -> UICalendarView.Decoration? {\n    switch myDatabase.eventType(on: dateComponents) {\n    case .none:\n        return nil\n    case .busy:\n        return .default()\n    case .travel:\n        return .image(airplaneImage, color: .systemOrange)\n    case .party:\n        return .customView {\n            MyPartyEmojiLabel()\n        }\n    }\n}\n```\n\n![UICalendarView](http://image.stephenfang.me/mweb/UICalendarView.png)\n\n## 导航栏提升\n\n### **UINavigationItemStyle**\n\n新引入了 `Browser`、`Editor` 两种导航样式，目前支持的`UINavigationItemStyle` 有以下几种\n\n![UINavigationItemStyle](http://image.stephenfang.me/mweb/UINavigationItemStyle.png)\n\n- `Navigator`：遵循传统的 push / pop 模型，如设置app\n- `Browser`：使用历史记录或文件夹结构导航，如 Safari、系统文件app\n- `Editor`：导航栏中间为文件相关操作，标题则在最左边\n\n```swift\n// Adopt the editor navigation style for the navigation item.\nnavigationItem.style = .editor\n```\n\n### Center Items\n\ncenter items 是展示在导航栏中间的的控件组，能够提供对应用程序最重要功能的快速访问。\n\n![CenterItems](http://image.stephenfang.me/mweb/CenterItems.png)\n\n用户可以移动、移除或添加来定制导航栏的 center items。默认不展示的 center items 出现在自定义弹出窗口中，可以通过点击更多按钮中的 Customize Toolbar 菜单访问。\n\n为了实现这一能力，应用程序需要为导航项的`customizationIdentifier`属性提供一个字符串，UIKit 能够根据这个 identifier 自动保存和恢复用户自定义设定。\n\n```swift\n/// Setting a non-nil customizationIdentifier enables customization and UIKit will automatically save & restore customizations based on this identifier. The identifier must be unique within the scope of the application.\n    @available(iOS 16.0, *)\n    open var customizationIdentifier: String?\n\n// Set a customizationIdentifier and add center item groups.\nnavigationItem.customizationIdentifier = \"editorViewCustomization\"\n```\n\n配置 center Items 需要为 `navigationItem.centerItemGroups` 属性赋值\n\n- 若需创建用户无法移动或移除的 item，需要调用 `UIBarButtonItem` 的实例方法 `createFixedGroup()`\n- 若需创建可调整的 `BarButtonItemGroup`\n    - 拟定 `customizationIdentifier` 作为唯一标识\n    - `UIBarButtonItems` 一次只能在一个 `UIBarButtonItemGroup` 中\n    - 将一个 bar button item添加到一个 group 中会将其从之前的任何 group 中移除\n    - `isInDefaultCustomization`属性设置默认是否出现在导航栏中\n    - `BarButtonItemGroup` 通常包含多个可以提供定制能力的 `UIAction`\n\n```swift\n\n/// Create a fixed group containing this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.\n    @available(iOS 16.0, *)\n    open func creatingFixedGroup() -> UIBarButtonItemGroup\n\n/// Create an optional BarButtonItemGroup containing only this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.\n    @available(iOS 16.0, *)\n    @available(tvOS, unavailable)\n    @available(watchOS, unavailable)\n    @MainActor public func creatingOptionalGroup(customizationIdentifier: String, isInDefaultCustomization: Bool = true) -> UIBarButtonItemGroup\n\nprivate func configureCenterItemGroups() {\n\n\t\t\t\t\tnavigationItem.centerItemGroups = [\n            UIBarButtonItem(primaryAction: UIAction(title: \"Sync Scrolling\", image: syncScrollingImage) { [unowned self] action in\n                syncScrolling.toggle()\n                if let barButtonItem = action.sender as? UIBarButtonItem {\n                    barButtonItem.image = syncScrollingImage\n                }\n            }).creatingFixedGroup(),\n            \n           UIBarButtonItem(primaryAction: UIAction(title: \"Add Link\", image: UIImage(systemName: \"link\")) { [unowned self] _ in\n                insertTag(.link)\n            }).creatingOptionalGroup(customizationIdentifier: \"addLink\")\n\t\t\t\t\t],\n\n\t\t\t\t\tUIBarButtonItem(title: \"Insert Image\", image: UIImage(systemName: \"photo\"), menu: UIMenu(title: \"Insert Image\", children: [\n                UIAction(title: \"From Photo Library\", image: UIImage(systemName: \"photo.on.rectangle\")) { [unowned self] _ in\n                    let picker = UIImagePickerController()\n                    picker.delegate = self\n                    present(picker, animated: true)\n                },\n                UIAction(title: \"From File\", image: UIImage(systemName: \"folder\")) { [unowned self] _ in\n                    let picker = UIDocumentPickerViewController(forOpeningContentTypes: [.image], asCopy: true)\n                    picker.delegate = self\n                    isPickingImageFromFile = true\n                    present(picker, animated: true)\n                },\n                UIAction(title: \"Blank Image Tag\", image: UIImage(systemName: \"tag\")) { [unowned self] _ in\n                    insertTag(.image)\n                }\n            ])).creatingOptionalGroup(customizationIdentifier: \"addImage\")\n}\n```\n\ncenter items 针对 Mac Catalyst 的 NSToolbar 和 iPad 并排模式能够实现自动适配。\n\n![NSToolbar](http://image.stephenfang.me/mweb/NSToolbar.png)\n\n![iPadSide](http://image.stephenfang.me/mweb/iPadSide.png)\n\n### 文件菜单\n\n当用户点击导航项目的标题时会出现文件菜单，从上到下可以将其拆分成三部分\n\n1. Document header：包含文件名、文件类型、文件大小、分享菜单等\n2. Suggested  title menu：与当前文档相关的建议操作\n3. Custom title menu：自定义操作\n\n![TitleMenu](http://image.stephenfang.me/mweb/TitleMenu.png)\n\n**Document header**\n\nDocument header 显示当前文档相关的信息，包括标题、文件类型和大小，还提供了分享或拖放文档的能力。\n\n```swift\n@available(iOS 16.0, *)\n@MainActor open class UIDocumentProperties : NSObject {\n\n    \n    /// When initializing with a url, UIKit will automatically lookup metadata based on the data at that url.\n    public init(url: URL)\n\n    \n    /// Initialize with metadata directly when the item is not backed by a url.\n    public init(metadata: LPLinkMetadata)\n\n    \n    /// The metadata to use. UIKit will generate this automatically if a url is given at initialization time.\n    @NSCopying open var metadata: LPLinkMetadata\n\n    \n    /// To support drag & drop, assign a closure to return an array of drag items corresponding to the represented document.\n    open var dragItemsProvider: ((UIDragSession) -> [UIDragItem])?\n\n    \n    /// To support sharing, assign a closure to return a UIActivityViewController configured to share the represented document.\n    open var activityViewControllerProvider: (() -> UIActivityViewController)?\n\n    \n    /// If enabled, shows an icon representation of the document in the navigation bar.\n    open var wantsIconRepresentation: Bool\n}\n```\n\n如果需要Document header相关能力**，**使用`UIDocumentProperties` 对象给`navigationItem.documentProperties`属性赋值即可。\n\n```swift\nlet documentProperties = UIDocumentProperties(url: document.fileURL)\nif let itemProvider = NSItemProvider(contentsOf: document.fileURL) {\n    documentProperties.dragItemsProvider = { _ in\n        [UIDragItem(itemProvider: itemProvider)]\n    }\n    documentProperties.activityViewControllerProvider = {\n        UIActivityViewController(activityItems: [itemProvider], applicationActivities: nil)\n    }\n}\n\nnavigationItem.title = document.localizedName\nnavigationItem.documentProperties = documentProperties\n```\n\n**Title Menu**\n\n配置 title menu 需要给 `navigationItem.titleMenuProvider` 返回菜单 closure。系统返回给closure了一组 suggested actions，包括移动和复制；应用定义了动作包括文档导出为 HTML 和 PDF。\n\n```swift\n/// When non-nil, UIKit will generate suggestedActions and call this block to generate a menu that is displayed from the title.\n    @available(iOS 16.0, *)\n    open var titleMenuProvider: (([UIMenuElement]) -> UIMenu?)?\n\nnavigationItem.titleMenuProvider = { suggested in\n    let custom = [\n        UIMenu(title: \"Export…\", image: UIImage(systemName: \"arrow.up.forward.square\"), children: [\n            UIAction(title: \"HTML\", image: UIImage(systemName: \"safari\")) { [unowned self] _ in\n                previewView.exportAsWebArchive(named: document.localizedName, presenter: self)\n            },\n            UIAction(title: \"PDF\", image: UIImage(systemName: \"doc.richtext\")) { [unowned self] _ in\n                previewView.exportAsPDF(named: document.localizedName, presenter: self)\n            }\n        ])\n    ]\n    return UIMenu(children: suggested + custom)\n}\n```\n\n`UINavigationItem`提供了对文件重命名的支持。\n\n```swift\npublic protocol UINavigationItemRenameDelegate : AnyObject {\n\n    /// This method is called when renaming has ended. The title on the navigation item has already been changed when this method is called but\n    /// clients can make further adjustments to it when necessary.\n    func navigationItem(_: UINavigationItem, didEndRenamingWith title: String)\n\n    /// Controls whether the rename action is supported for the given navigation item. For example this method is called when the navigation bar's\n    /// document menu is shown to validate if the rename action should be part of that menu.\n    func navigationItemShouldBeginRenaming(_: UINavigationItem) -> Bool\n\n    /// Called when we begin renaming. Implementing this method allows for customizing the initial text that will show up in the text field as well as the\n    /// selected range of that text.\n    func navigationItem(_: UINavigationItem, willBeginRenamingWith suggestedTitle: String, selectedRange: Range<String.Index>) -> (String, Range<String.Index>)\n\n    /// This method can be used to prevent renaming from happening. However there are cases (e.g. when a new navigation item is pushed on the navigation\n    /// bar) where this method will not be called and instead navigationItem:didEndRenamingWithTitle: is called right away. Clients are therefore expected to\n    /// handle titles in navigationItem:didEndRenamingWithTitle: for which they would return NO from navigationItem:shouldEndRenamingWithTitle:.\n    func navigationItem(_: UINavigationItem, shouldEndRenamingWith title: String) -> Bool\n}\n```\n\n启用该能力需要遵循`UINavigationItemRenameDelegate`，并使用 `navigationItem.renameDelegate` 绑定到 self。\n\n```swift\nnavigationItem.renameDelegate = self\n```\n\n## 体验提升\n\n如果你对这部分内容感兴趣可以移步此[Session](https://developer.apple.com/wwdc22/10071)\n\n### Find and Replace\n\n`UITextView`、`WKWebView`、`PDFView` 都支持了系统层级的查找与替换功能。\n\n![editorTextView](http://image.stephenfang.me/mweb/editorTextView.png)\n\n如果你在开发中的视图是上述 View 的子类，如`editorTextView` 是`UITextView` 的子类，启用查找和替换只需要一行代码。\n\n```swift\neditorTextView.isFindInteractionEnabled = true\n```\n\n\n### UIEditMenu\n\nEdit menu 交互菜单能够针对当前展示的内容提供诸如剪切、粘贴和粘贴等编辑动作。系统会针对当前用户的交互方式提供符合交互的菜单展示形式。\n\n![UIEditMenu0](http://image.stephenfang.me/mweb/UIEditMenu0.png)\n\n![UIEditMenu1](http://image.stephenfang.me/mweb/UIEditMenu1.png)\n\n- 对于触摸交互，动作以 editing menu 的形式展示\n- 对于指针的交互，动作以 context menu的形式展示\n\n标准的 UIKit 类，如 `UITextView` 或者 `UITextField`，已经预先支持了Edit Menu交互，你可以便捷地框选一个地址然后获得类似地图导航的交互菜单选项。\n\n![UIEditMenu2.png](http://image.stephenfang.me/mweb/UIEditMenu2.png)\n\n在通用视图中添加 Edit menu 交互菜单\n\n1. 创建一个 Edit menu 交互对象，并在默认 initializer 传入一个可选的 delegate。\n2. 在视图上调用 `addInteraction(_:)` 来添加交互对象\n3. 创建一个 gesture recognizer 来触发交互，并将其添加到视图中\n\n以下苹果提供的例子中创建了一个由长按触发的 Edit menu 交互菜单。\n\n```swift\noverride func viewDidLoad() {\n    super.viewDidLoad()\n\n    // Add the edit menu interaction.\n    editMenuInteraction = UIEditMenuInteraction(delegate: self)\n    interactionView.addInteraction(editMenuInteraction!)\n\n    // Create the gesture recognizer.\n    let longPress = UILongPressGestureRecognizer(target: self, action: #selector(didLongPress(_:)))\n    longPress.allowedTouchTypes = [UITouch.TouchType.direct.rawValue as NSNumber]\n    interactionView.addGestureRecognizer(longPress)\n}\n\n@objc func didLongPress(_ recognizer: UIGestureRecognizer) {\n    let location = recognizer.location(in: self.view)\n    let configuration = UIEditMenuConfiguration(identifier: nil, sourcePoint: location)\n\n    if let interaction = editMenuInteraction {\n        // Present the edit menu interaction.\n        interaction.presentEditMenu(with: configuration)\n    }\n}\n```\n\n- Edit menu 交互菜单包括标准编辑操作，包括剪贴、复制、删除等等，可参考`UIResponderStandardEditActions`。\n- 可以使用 `UIEditMenuInteractionDelegate` 提供的方法向Edit menu 交互菜单添加额外项目。\n- 对于文本视图可以使用`UITextViewDelegate`、`UITextFieldDelegate`或`UITextInput`中的方法为特定文本范围指定菜单显示的项目。\n\n### Sidebar\n\n在 iOS 16 中，侧边栏会在 Slide-over（侧拉）模式下自动显示。UIKit 会管理一组私有视图。\n\n![Sidebar](http://image.stephenfang.me/mweb/Sidebar.png)\n\n\n### SFSymbols\n\nSFSymbols 在 iOS 16 上支持四种 `renderingMode`，分别是 \n\n- monochrome\n- multicolor\n- hierarchical\n- palette\n\n![renderingMode](http://image.stephenfang.me/mweb/renderingMode.png)\n\n在 iOS 15 及之前的版本中，默认使用 monochrome 渲染 symbol。\n\n在 iOS 16 如果没有指定renderingMode，默认使用 hierarchical 渲染 symbol，可以通过 `UIImage.SymbolConfiguration.preferringMonochrome()` 指定渲染方式。\n\n![preferringMonochrome](http://image.stephenfang.me/mweb/preferringMonochrome.png)\n\n同时增加了对可变 symbol 的支持，即支持根据从 0 到 1 的值变化映射 symbol 的变化，当然，这需要 symbol 自身支持该能力。\n\n假设 App 使用了`speaker.3.wave.fill` 符号表示当前音量级别，在值为 0 时扬声器波纹消失表示最低音量水平，当该值增加到 1 时扬声器的波形逐渐填充完整，表示音量水平提高。\n\n![variableValue](http://image.stephenfang.me/mweb/variableValue.png)\n\n使用方法也非常简单直白，通过标准的 SF Symbols API 为 UIImage 设置 `variableValue` 参数即可，甚至将该属性与 `renderingMode` 组合使用以进一步设计符号的样式。\n\n以下为 GitHub上 [@ferhanakkan](https://github.com/ferhanakkan) 的 Demo。\n\n```swift\n@objc private func sliderDidValueChange(_ sender: UISlider) {\n        imageView.image = UIImage(\n            systemName: \"wifi\",\n            variableValue: Double(sender.value),\n            configuration: UIImage.SymbolConfiguration(paletteColors: [.orange])\n        )\n    }\n```\n\n![sfsymbols.gif](http://image.stephenfang.me/mweb/sfsymbols.gif)\n\n学习如何创建自定义变量符号可以观看 [Adopt variable color in SF Symbols](https://developer.apple.com/videos/play/wwdc2022/10158/) 和 [What's new in SF Symbols 4](https://developer.apple.com/videos/play/wwdc2022/10157/) 这两个Session。\n\n### Swift Concurrency and Sendable\n\nUIKit 现在可以与 Swift Concurrency 同时使用，包括 immutable 类型，如以下的类型遵循了 Sendable\n\n- `UIImage`\n- `UIColor`\n- `UIFont`\n- `UITraitCollection`\n\n对象可以在 MainActor 和自定义 actor 之间发送而不会收到编译器警告。\n\n苹果提供的例子中，有一个叫做 Processor 的自定义 actor，以及一个被绑定到 MainActor 的叫做 ImageViewer 的 ViewController。在 `sendImageForProcessing` 方法中 ImageViewer 将图像发送给 Processor进行处理，目前是安全的。\n\n因为 UIImage 是 immutable 类型， Processor 必须创建新的拷贝来执行操作。任何引用原始图像的代码都不会显示这些修改，共享状态也不会发生不安全的变化。\n\n![Concurrency0](http://image.stephenfang.me/mweb/Concurrency0.png)\n\n对比一下因为 mutable 而没有遵循 Sendable 的 UIBezierPath，以前只能在文档中表示，现在可以由编译器进行检查。\n\n![Concurrency1](http://image.stephenfang.me/mweb/Concurrency1.png)\n\n要了解更多关于 Sendable 和 Swift Concurrency 移步视频 [Eliminate data races using Swift Concurrency](https://developer.apple.com/videos/play/wwdc2022/110351/) 和 [Visualize and optimize Swift Concurrency](https://developer.apple.com/videos/play/wwdc2022/110350/)。\n\n## UIKit and SwiftUI\n\n过去如果想要实现将 SwiftUI 视图嵌入 UIView 视图，一般需要这么做。\n\n```swift\nlet controller = UIHostingController(rootView: SwiftUIView())\naddChild(controller)\nview.addSubview(controller.view)\ncontroller.didMove(toParent: self)\n```\n\n在 iOS 16上推出了 `UIHostingConfiguration` ，你可以在 `UICollectionView` 和 `UITableView` 中以 `contentConfiguration` 的方式将 SwiftUI 构建的 View 嵌入 cell。\n\n```swift\ncell.contentConfiguration = UIHostingConfiguration {\n    SwiftUIView()\n}\n```\n\n## 结束语\n\n最近几年的 WWDC 中看到苹果对于 UIKit 的理解，倡导使用 configuration 的方式构建组件、菜单，一方面参照人机交互指南构建组件能够确保交互不被滥用，另一方面降低了开发者的接入成本。\n\n作为开发者，一起尝试兼容 app 到 iOS 16，适配新的API，探索新的业务可能性吧。\n\n## 参考链接\n\n- [https://www.swiftjectivec.com/ios-16-notable-uikit-additions/](https://www.swiftjectivec.com/ios-16-notable-uikit-additions/)\n- [https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22](https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22)\n- [https://developer.apple.com/wwdc22/10068](https://developer.apple.com/wwdc22/10068)\n- [https://juejin.cn/post/7111173753668632584](https://juejin.cn/post/7111173753668632584)\n- [https://github.com/WenchaoD/FSCalendar](https://github.com/WenchaoD/FSCalendar)","slug":"WWDC22-UIKit","published":1,"updated":"2022-07-24T15:58:50.272Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp38006po76fefec0ou4","content":"<p>最近几年的 WWDC 每年都能看到很多 SwiftUI 的新能力，但不能忽略的是 UIKit 框架的更新。</p>\n<p>今年的 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10068/\">What’s New in UIKit Session</a> 主要包括以下几个方面</p>\n<ul>\n<li>生产力提升</li>\n<li>控制增强</li>\n<li>API 改进</li>\n<li>UIKit 与 SwiftUI 混编</li>\n</ul>\n<p>我按照业务理解和适配进度的优先级，对 session 内容进行了重新排序和整理，对 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 的仓库进行了一些改动，以下为我的总结。</p>\n<span id=\"more\"></span>\n\n<p><a href=\"https://github.com/iamStephenFang/WhatsNewInUIKit\">https://github.com/iamStephenFang/WhatsNewInUIKit</a></p>\n<h2 id=\"API-改进\"><a href=\"#API-改进\" class=\"headerlink\" title=\"API 改进\"></a>API 改进</h2><p>在 iOS 16 中部分 API 废弃，需要开发者进行适配，同时有一些新能力可以实现。</p>\n<h3 id=\"UIDevice\"><a href=\"#UIDevice\" class=\"headerlink\" title=\"UIDevice\"></a>UIDevice</h3><ul>\n<li>为了防止用户留下指纹， <code>UIDevice.name</code> 现在会报告模型名称而非用户自定义的设备名称。 使用自定义名称需要获得授权。  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// iOS 16 之前 (e.g. &quot;My iPhone&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">// iOS 16 (e.g. &quot;iPhone 13&quot;)</span></span><br><span class=\"line\"><span class=\"built_in\">UIDevice</span>().name</span><br></pre></td></tr></table></figure>\n</li>\n<li>不再支持 <code>UIDevice.orientation</code>， 应使用 <code>UIViewController</code> 相关API， 如 <code>preferredInterfaceOrientation</code> 来获取应用界面的预期呈现方向。  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// UIDeviceOrientation(rawValue: 0) -&gt; .unknown</span></span><br><span class=\"line\"><span class=\"built_in\">UIDevice</span>().orientation</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// UIInterfaceOrientation(rawValue: 1) -&gt; .portrait (iPhone)</span></span><br><span class=\"line\"><span class=\"built_in\">UIViewController</span>().preferredInterfaceOrientationForPresentation</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"UIScreen\"><a href=\"#UIScreen\" class=\"headerlink\" title=\"UIScreen\"></a>UIScreen</h3><p>iOS 16 为 配备了 M1 芯片的 iPad 以及 Mac 带来了 Stage Manager （台前调度）功能，作为应用开发者无需对代码进行改动即可适用该功能。</p>\n<aside>\n💡 在 iOS 13 前开发单窗口的 App，由 `UIApplication` 负责 App 状态，`UIApplicationDelegate`（`AppDelegate`）负责 App 事件和生命周期，然而这种模式不适用于开发多窗口的 iPad App 或 Mac Catalyst App。 iOS 13 引入了构建多窗口应用的 `UIScene`，并对功能职责进行了重新拆分，将 UI 相关的状态、事件和生命周期交与 `UIWindowScene` 和 `UIWindowSceneDelegate`（`SceneDelegate`）负责，`UISceneSession` 负责持久化的 UI 状态。\n\n</aside>\n\n<p>如果仍在使用旧版本的 UIScreen API，有必要迁移到新的 <code>UITraitCollection</code> 和 <code>UIScene</code> API</p>\n<p><a href=\"https://developer.apple.com/documentation/uikit/uiscreen/deprecated_symbols\">Apple Developer Documentation</a></p>\n<ul>\n<li><code>UIScreen.main</code> 已废弃，需要使用<code>(UIApplication.shared.connectedScenes.first as? UIWindowScene)?.screen</code></li>\n<li>UIScreen 生命周期通知废弃，包括 <code>didConnectNotification</code>、<code>didDisconnectNotification</code>，需要使用 <code>UIScene</code>相关方法</li>\n</ul>\n<h3 id=\"自适应大小-cell\"><a href=\"#自适应大小-cell\" class=\"headerlink\" title=\"自适应大小 cell\"></a>自适应大小 cell</h3><p><code>UICollectionView</code> 和 <code>UITableView</code> 的 cell 支持了自适应调整大小能力。控制自适应调整大小的是 <code>selfSizingInvalidation</code> 属性，默认开启。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UICollectionView</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Default is .enabled</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span>.selfSizingInvalidation: <span class=\"type\">SelfSizingInvalidation</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">SelfSizingInvalidation</span> : <span class=\"title\">Int</span>, @<span class=\"title\">unchecked</span> <span class=\"title\">Sendable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// No updates will take place when -invalidateIntrinsicContentSize is called on a self-sizing cell or its contentView.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> disabled <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> enabled <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary, and</span></span><br><span class=\"line\">        <span class=\"comment\">/// any Auto Layout changes within the contentView of a self-sizing cell will automatically trigger -invalidateIntrinsicContentSize.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> enabledIncludingConstraints <span class=\"operator\">=</span> <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>若使用了 <code>UIListContentConfiguration</code> 配置cell，每当 cell 的配置发生更改时会自动执行 invalidation。</li>\n<li>若不使用 <code>UIListContentConfiguration</code> 配置cell，可以调用 cell 的 <code>invalidateIntrinsicContentSize</code> 方法手动执行 invalidation。</li>\n<li>若使用 Auto Layout 布局cell，可以通过设置 <code>selfSizingInvalidation</code> 属性为<code>enabledInclingConstraints</code> 来使其接收 Auto Layout 变更。即当 cell 检测到 contentView 内部的任何自动布局变化时，将自动调用 <code>invalidateIntrinsicContentSize</code> 方法。</li>\n</ul>\n<p>默认情况下 cell 自适应调整大小会伴随着动画，可以在 <code>invalidateIntrinsicContentSize</code> 方法外包一层 <code>performWithoutAnimation</code> 从而取消调整大小时的动画。 </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapCollapseButton</span>()</span> &#123;</span><br><span class=\"line\">        label.text <span class=\"operator\">=</span> <span class=\"type\">Constants</span>.shortText</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapCollapseWithoutAnimationButton</span>()</span> &#123;</span><br><span class=\"line\">        label.text <span class=\"operator\">=</span> <span class=\"type\">Constants</span>.shortText</span><br><span class=\"line\">        <span class=\"type\">UIView</span>.performWithoutAnimation &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.invalidateIntrinsicContentSize()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/SelfSizing.gif\" alt=\"SelfSizing.gif\"></p>\n<p><code>UICollectionView</code> 和 <code>UITableView</code> 将 cell 自适应大小的 invalidation 行为智能合并处理，并在最佳时间执行更新。</p>\n<h3 id=\"UISheetPresentationController\"><a href=\"#UISheetPresentationController\" class=\"headerlink\" title=\"UISheetPresentationController\"></a>UISheetPresentationController</h3><p>在 iOS 15 上苹果推出了表单展示控件，可以通过简单的代码 present 出 <code>.medium()</code> 和 <code>.large()</code> 两种大小的底部表单。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// on iOS 15</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> vc <span class=\"operator\">=</span> <span class=\"type\">UINavigationController</span>(rootViewController: <span class=\"type\">DemoViewController</span>())</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> sheet <span class=\"operator\">=</span> vc.sheetPresentationController &#123;</span><br><span class=\"line\">\t\tsheet.detents <span class=\"operator\">=</span> [.medium(), .large()]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">self</span>.present(vc, animated: <span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<p>用户可以通过拖拽的方式实现高度的切换，但是当时底栏不具备自定义高度的能力。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UISheetPresentationController1.png\" alt=\"UISheetPresentationController1.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UISheetPresentationController2.png\" alt=\"UISheetPresentationController2.png\"></p>\n<p>在 iOS 16 上苹果开放了 <code>UISheetPresentationController.Detent.Identifier</code> 提供了自定义的能力。</p>\n<p>可以简单返回一个常量值或最大高度的百分比来控制表单高度。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@MainActor</span> <span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Detent</span> : <span class=\"title\">NSObject</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">medium</span>() -&gt; <span class=\"title\">Self</span></span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">open</span> <span class=\"title\">class</span> <span class=\"title\">func</span> <span class=\"title\">large</span>() -&gt; <span class=\"title\">Self</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">        @<span class=\"title\">available</span>(<span class=\"title\">iOS</span> 16.0, *)</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">open</span> <span class=\"title\">var</span> <span class=\"title\">identifier</span>: <span class=\"title\">UISheetPresentationController</span>.<span class=\"title\">Detent</span>.<span class=\"title\">Identifier</span> </span>&#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create a custom detent</span></span><br><span class=\"line\">sheet.detents <span class=\"operator\">=</span> [</span><br><span class=\"line\">    .large(),</span><br><span class=\"line\">    .custom &#123; context <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"number\">0.3</span> <span class=\"operator\">*</span> context.maximumDetentValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>更标准的做法是通过自定义 identifier 定制表单展示控件的高度。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Define a custom identifier</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UISheetPresentationController</span>.<span class=\"title\">Detent</span>.<span class=\"title\">Identifier</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> small <span class=\"operator\">=</span> <span class=\"type\">UISheetPresentationController</span>.<span class=\"type\">Detent</span>.<span class=\"type\">Identifier</span>(<span class=\"string\">&quot;small&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Assign identifier to custom detent</span></span><br><span class=\"line\">sheet.detents <span class=\"operator\">=</span> [</span><br><span class=\"line\">    .large(),</span><br><span class=\"line\">    .custom (identifier: .small) &#123; context <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"number\">0.3</span> <span class=\"operator\">*</span> context.maximumDetentValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Disable dimming above the custom detent</span></span><br><span class=\"line\">sheet.largestUndimmedDetentIdentifier <span class=\"operator\">=</span> .small</span><br></pre></td></tr></table></figure>\n\n<p>在使用的过程总需要注意表单展示控件高度不包含 <code>SafeAreaInsets</code>，计算布局时需要注意。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UISheetPresentationController.png\" alt=\"UISheetPresentationController\"></p>\n<h2 id=\"UI-控件\"><a href=\"#UI-控件\" class=\"headerlink\" title=\"UI 控件\"></a>UI 控件</h2><h3 id=\"UIPasteControl\"><a href=\"#UIPasteControl\" class=\"headerlink\" title=\"UIPasteControl\"></a>UIPasteControl</h3><p>在 iOS 16 前在 app 内执行复制粘贴操作会在顶部显示banner，在 iOS 16上 banner 被 alert 所取代。仍然由系统自动提示，根据用户的选项允许剪贴板内容访问。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl0.png\" alt=\"UIPasteControl0\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl1.png\" alt=\"UIPasteControl1\"></p>\n<p>开发者可以用新加入的 <code>UIPasteControl</code> 作为粘贴控件替换这个 alert，可以在<a href=\"https://developer.apple.com/documentation/uikit/uipastecontrol\">这里</a>找到相关文档。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fileprivate</span> <span class=\"keyword\">lazy</span> <span class=\"keyword\">var</span> pasteControl: <span class=\"type\">UIPasteControl</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> pasteControlConfig <span class=\"operator\">=</span> <span class=\"type\">UIPasteControl</span>.<span class=\"type\">Configuration</span>()</span><br><span class=\"line\">        pasteControlConfig.baseBackgroundColor <span class=\"operator\">=</span> .systemBlue</span><br><span class=\"line\">        pasteControlConfig.baseForegroundColor <span class=\"operator\">=</span> .white</span><br><span class=\"line\">        pasteControlConfig.cornerRadius <span class=\"operator\">=</span> <span class=\"number\">5.0</span></span><br><span class=\"line\">        pasteControlConfig.displayMode <span class=\"operator\">=</span> .iconAndLabel</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> pasteControl <span class=\"operator\">=</span> <span class=\"type\">UIPasteControl</span>(configuration: pasteControlConfig)</span><br><span class=\"line\">        pasteControl.target <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pasteControl</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// MARK: UIPasteConfigurationSupporting</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">canPaste</span>(<span class=\"keyword\">_</span> <span class=\"params\">itemProviders</span>: [<span class=\"type\">NSItemProvider</span>])</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">paste</span>(<span class=\"params\">itemProviders</span>: [<span class=\"type\">NSItemProvider</span>])</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> itemProvider <span class=\"operator\">=</span> itemProviders.first &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> itemProvider.canLoadObject(ofClass: <span class=\"type\">NSString</span>.<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">                itemProvider.loadObject(ofClass: <span class=\"type\">NSString</span>.<span class=\"keyword\">self</span>) &#123; (text, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> text <span class=\"operator\">!=</span> <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                        <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">self</span>.label.text <span class=\"operator\">=</span> text <span class=\"keyword\">as?</span> <span class=\"type\">String</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl2.png\" alt=\"UIPasteControl2\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl3.png\" alt=\"UIPasteControl3\"></p>\n<p>这个适配虽然达成了必须有用户交互才能读取剪贴板的目的，但也等来了一些开发者的吐槽。</p>\n<p><a href=\"https://twitter.com/cyanapps/status/1535187013611438081\">https://twitter.com/cyanapps/status/1535187013611438081</a></p>\n<h3 id=\"UIPageControl\"><a href=\"#UIPageControl\" class=\"headerlink\" title=\"UIPageControl\"></a>UIPageControl</h3><p><code>UIPageControl</code> 在 iOS 16 上得到了增强，主要包括以下两点</p>\n<ol>\n<li>可以针对不同的选中状态展示不同的图像 <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// The preferred image for the current page indicator. Symbol images are recommended. Default is nil.</span></span><br><span class=\"line\">    <span class=\"comment\">/// If this value is nil, then UIPageControl will use \\c preferredPageIndicatorImage (or its per-page variant) as</span></span><br><span class=\"line\">    <span class=\"comment\">/// the indicator image.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> preferredCurrentPageIndicatorImage: <span class=\"type\">UIImage</span>?</span><br></pre></td></tr></table></figure>\n</li>\n<li>可以设置布局方向为水平或垂直 <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// The layout direction of the page indicators. The default value is \\c UIPageControlDirectionNatural.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> direction: <span class=\"type\">UIPageControl</span>.<span class=\"type\">Direction</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Direction</span> : <span class=\"title\">Int</span>, @<span class=\"title\">unchecked</span> <span class=\"title\">Sendable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out in the natural direction of the system locale.</span></span><br><span class=\"line\">        <span class=\"comment\">/// By default, this is equivalent to @c UIPageControlDirectionLeftToRight on LTR locales, and</span></span><br><span class=\"line\">        <span class=\"comment\">/// @c UIPageControlDirectionRightToLeft on RTL locales.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> natural <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from left to right.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> leftToRight <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from right to left.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> rightToLeft <span class=\"operator\">=</span> <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from top to bottom.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> topToBottom <span class=\"operator\">=</span> <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from bottom to top.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> bottomToTop <span class=\"operator\">=</span> <span class=\"number\">4</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>GitHub上的 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 提供了以下 Demo。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">lazy</span> <span class=\"keyword\">var</span> pageControl: <span class=\"type\">UIPageControl</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.backgroundColor <span class=\"operator\">=</span> .orange</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.layer.cornerRadius <span class=\"operator\">=</span> <span class=\"number\">8</span></span><br><span class=\"line\">        <span class=\"variable\">$0</span>.layer.masksToBounds <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"variable\">$0</span>.currentPage <span class=\"operator\">=</span> .zero</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.numberOfPages <span class=\"operator\">=</span> collectionViewData.count</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.direction <span class=\"operator\">=</span> .leftToRight</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.preferredIndicatorImage <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;star&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.preferredCurrentPageIndicatorImage <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;star.fill&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.translatesAutoresizingMaskIntoConstraints <span class=\"operator\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$0</span></span><br><span class=\"line\">    &#125;(<span class=\"type\">UIPageControl</span>())</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/UIPageControl.gif\" alt=\"UIPageControl.gif\"></p>\n<h3 id=\"UICalendarView\"><a href=\"#UICalendarView\" class=\"headerlink\" title=\"UICalendarView\"></a>UICalendarView</h3><p>之前一直希望 iOS 能够集成一个类似 <a href=\"https://github.com/WenchaoD/FSCalendar\">FSCalendar</a> 的日历组件，在 iOS 16上终于算是等到了。<code>UICalendarView</code> 是 <code>UIDatePicker</code> 的内联日历样式，它和 <code>UIDatePicker</code> 最主要的一个区别在于 <code>UICalendarView</code> 将日期表示为 <code>NSDateComponents</code> 而不是 <code>NSDate</code>。</p>\n<aside>\n💡 `NSDateComponents` 能够更好、更精确地表示数据模型， `NSDate` 是时间点的表示。\n\n</aside>\n\n<p><code>UICalendarView</code>现在作为一个独立的全功能组件形式提供，它具备了以下几种特性。</p>\n<ul>\n<li>支持日期单选或多选</li>\n<li>支持在范围内框选日期和禁用个别日期</li>\n<li>支持对标注日期进行装饰</li>\n<li>明确由哪个 <code>NSCalendar</code> 表示</li>\n</ul>\n<p>接下来尝试构建一个多选日期日历。</p>\n<ol>\n<li>创建一个 <code>UICalendarView</code> 对象，为其设置 <code>delegate</code> 并指定其 <code>calendar</code> 属性。如果需要采用农历，更改 <code>NSCalendar</code> 的初始化即可（ <code>Calendar(identifier: .chinese)</code>）</li>\n<li>配置多日期选择需要创建一个 <code>UICalendarSelectionMultiDate</code> 对象，并为其 <code>selectedDates</code> 属性进行赋值，再将此对象作为 <code>selectionBehavior</code> 属性传给我们创建的 <code>UICalendarView</code> 对象</li>\n<li>通过 <code>UICalendarViewDelegate</code> 中的 <code>multidateselect: canSelectDate:</code> 方法可以控制哪些日期可以被选择，如防止日历中选中单个日期。无法选择的日期会被置灰。</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Configuring a calendar view with multi-date selection</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> calendarView <span class=\"operator\">=</span> <span class=\"type\">UICalendarView</span>()</span><br><span class=\"line\">calendarView.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">calendarView.calendar <span class=\"operator\">=</span> <span class=\"type\">Calendar</span>(identifier: .gregorian)</span><br><span class=\"line\">view.addSubview(calendarView)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> multiDateSelection <span class=\"operator\">=</span> <span class=\"type\">UICalendarSelectionMultiDate</span>(delegate: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">multiDateSelection.selectedDates <span class=\"operator\">=</span> myDatabase.selectedDates()</span><br><span class=\"line\">calendarView.selectionBehavior <span class=\"operator\">=</span> multiDateSelection</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">multiDateSelection</span>(</span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">_</span> <span class=\"params\">selection</span>: <span class=\"type\">UICalendarSelectionMultiDate</span>,</span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"params\">canSelectDate</span> <span class=\"params\">dateComponents</span>: <span class=\"type\">DateComponents</span></span></span><br><span class=\"line\"><span class=\"function\">)</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> myDatabase.hasAvailabilities(for: dateComponents)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>UICalendarViewDelegate</code> 提供了 <code>calendarView: decorationForDateComponents:</code> 方法对日历中的日期进行装饰。</p>\n<ul>\n<li>如果不需要装饰直接返回 nil 即可</li>\n<li>可以通过简单的图像构造装饰日期</li>\n<li>可以通过自定义视图装饰日期</li>\n<li>自定义装饰视图不允许交互</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Configuring Decorations</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">calendarView</span>(</span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">_</span> <span class=\"params\">calendarView</span>: <span class=\"type\">UICalendarView</span>, </span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"params\">decorationFor</span> <span class=\"params\">dateComponents</span>: <span class=\"type\">DateComponents</span></span></span><br><span class=\"line\"><span class=\"function\">)</span> -&gt; <span class=\"type\">UICalendarView</span>.<span class=\"type\">Decoration</span>? &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> myDatabase.eventType(on: dateComponents) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> .none:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> .busy:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .default()</span><br><span class=\"line\">    <span class=\"keyword\">case</span> .travel:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .image(airplaneImage, color: .systemOrange)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> .party:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .customView &#123;</span><br><span class=\"line\">            <span class=\"type\">MyPartyEmojiLabel</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/UICalendarView.png\" alt=\"UICalendarView\"></p>\n<h2 id=\"导航栏提升\"><a href=\"#导航栏提升\" class=\"headerlink\" title=\"导航栏提升\"></a>导航栏提升</h2><h3 id=\"UINavigationItemStyle\"><a href=\"#UINavigationItemStyle\" class=\"headerlink\" title=\"UINavigationItemStyle\"></a><strong>UINavigationItemStyle</strong></h3><p>新引入了 <code>Browser</code>、<code>Editor</code> 两种导航样式，目前支持的<code>UINavigationItemStyle</code> 有以下几种</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UINavigationItemStyle.png\" alt=\"UINavigationItemStyle\"></p>\n<ul>\n<li><code>Navigator</code>：遵循传统的 push / pop 模型，如设置app</li>\n<li><code>Browser</code>：使用历史记录或文件夹结构导航，如 Safari、系统文件app</li>\n<li><code>Editor</code>：导航栏中间为文件相关操作，标题则在最左边</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Adopt the editor navigation style for the navigation item.</span></span><br><span class=\"line\">navigationItem.style <span class=\"operator\">=</span> .editor</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Center-Items\"><a href=\"#Center-Items\" class=\"headerlink\" title=\"Center Items\"></a>Center Items</h3><p>center items 是展示在导航栏中间的的控件组，能够提供对应用程序最重要功能的快速访问。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/CenterItems.png\" alt=\"CenterItems\"></p>\n<p>用户可以移动、移除或添加来定制导航栏的 center items。默认不展示的 center items 出现在自定义弹出窗口中，可以通过点击更多按钮中的 Customize Toolbar 菜单访问。</p>\n<p>为了实现这一能力，应用程序需要为导航项的<code>customizationIdentifier</code>属性提供一个字符串，UIKit 能够根据这个 identifier 自动保存和恢复用户自定义设定。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// Setting a non-nil customizationIdentifier enables customization and UIKit will automatically save &amp; restore customizations based on this identifier. The identifier must be unique within the scope of the application.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> customizationIdentifier: <span class=\"type\">String</span>?</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set a customizationIdentifier and add center item groups.</span></span><br><span class=\"line\">navigationItem.customizationIdentifier <span class=\"operator\">=</span> <span class=\"string\">&quot;editorViewCustomization&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>配置 center Items 需要为 <code>navigationItem.centerItemGroups</code> 属性赋值</p>\n<ul>\n<li>若需创建用户无法移动或移除的 item，需要调用 <code>UIBarButtonItem</code> 的实例方法 <code>createFixedGroup()</code></li>\n<li>若需创建可调整的 <code>BarButtonItemGroup</code><ul>\n<li>拟定 <code>customizationIdentifier</code> 作为唯一标识</li>\n<li><code>UIBarButtonItems</code> 一次只能在一个 <code>UIBarButtonItemGroup</code> 中</li>\n<li>将一个 bar button item添加到一个 group 中会将其从之前的任何 group 中移除</li>\n<li><code>isInDefaultCustomization</code>属性设置默认是否出现在导航栏中</li>\n<li><code>BarButtonItemGroup</code> 通常包含多个可以提供定制能力的 <code>UIAction</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Create a fixed group containing this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">creatingFixedGroup</span>()</span> -&gt; <span class=\"type\">UIBarButtonItemGroup</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Create an optional BarButtonItemGroup containing only this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">tvOS</span>, unavailable)</span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">watchOS</span>, unavailable)</span><br><span class=\"line\">    <span class=\"meta\">@MainActor</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">creatingOptionalGroup</span>(<span class=\"params\">customizationIdentifier</span>: <span class=\"type\">String</span>, <span class=\"params\">isInDefaultCustomization</span>: <span class=\"type\">Bool</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>)</span> -&gt; <span class=\"type\">UIBarButtonItemGroup</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureCenterItemGroups</span>()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tnavigationItem.centerItemGroups <span class=\"operator\">=</span> [</span><br><span class=\"line\">            <span class=\"type\">UIBarButtonItem</span>(primaryAction: <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;Sync Scrolling&quot;</span>, image: syncScrollingImage) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] action <span class=\"keyword\">in</span></span><br><span class=\"line\">                syncScrolling.toggle()</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> barButtonItem <span class=\"operator\">=</span> action.sender <span class=\"keyword\">as?</span> <span class=\"type\">UIBarButtonItem</span> &#123;</span><br><span class=\"line\">                    barButtonItem.image <span class=\"operator\">=</span> syncScrollingImage</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;).creatingFixedGroup(),</span><br><span class=\"line\">            </span><br><span class=\"line\">           <span class=\"type\">UIBarButtonItem</span>(primaryAction: <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;Add Link&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;link&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                insertTag(.link)</span><br><span class=\"line\">            &#125;).creatingOptionalGroup(customizationIdentifier: <span class=\"string\">&quot;addLink&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t],</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">UIBarButtonItem</span>(title: <span class=\"string\">&quot;Insert Image&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;photo&quot;</span>), menu: <span class=\"type\">UIMenu</span>(title: <span class=\"string\">&quot;Insert Image&quot;</span>, children: [</span><br><span class=\"line\">                <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;From Photo Library&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;photo.on.rectangle&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                    <span class=\"keyword\">let</span> picker <span class=\"operator\">=</span> <span class=\"type\">UIImagePickerController</span>()</span><br><span class=\"line\">                    picker.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">                    present(picker, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;From File&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;folder&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                    <span class=\"keyword\">let</span> picker <span class=\"operator\">=</span> <span class=\"type\">UIDocumentPickerViewController</span>(forOpeningContentTypes: [.image], asCopy: <span class=\"literal\">true</span>)</span><br><span class=\"line\">                    picker.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">                    isPickingImageFromFile <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                    present(picker, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;Blank Image Tag&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;tag&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                    insertTag(.image)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ])).creatingOptionalGroup(customizationIdentifier: <span class=\"string\">&quot;addImage&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>center items 针对 Mac Catalyst 的 NSToolbar 和 iPad 并排模式能够实现自动适配。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/NSToolbar.png\" alt=\"NSToolbar\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/iPadSide.png\" alt=\"iPadSide\"></p>\n<h3 id=\"文件菜单\"><a href=\"#文件菜单\" class=\"headerlink\" title=\"文件菜单\"></a>文件菜单</h3><p>当用户点击导航项目的标题时会出现文件菜单，从上到下可以将其拆分成三部分</p>\n<ol>\n<li>Document header：包含文件名、文件类型、文件大小、分享菜单等</li>\n<li>Suggested  title menu：与当前文档相关的建议操作</li>\n<li>Custom title menu：自定义操作</li>\n</ol>\n<p><img src=\"http://image.stephenfang.me/mweb/TitleMenu.png\" alt=\"TitleMenu\"></p>\n<p><strong>Document header</strong></p>\n<p>Document header 显示当前文档相关的信息，包括标题、文件类型和大小，还提供了分享或拖放文档的能力。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\"><span class=\"meta\">@MainActor</span> <span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UIDocumentProperties</span> : <span class=\"title\">NSObject</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// When initializing with a url, UIKit will automatically lookup metadata based on the data at that url.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">url</span>: <span class=\"type\">URL</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// Initialize with metadata directly when the item is not backed by a url.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">metadata</span>: <span class=\"type\">LPLinkMetadata</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// The metadata to use. UIKit will generate this automatically if a url is given at initialization time.</span></span><br><span class=\"line\">    <span class=\"keyword\">@NSCopying</span> <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> metadata: <span class=\"type\">LPLinkMetadata</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// To support drag &amp; drop, assign a closure to return an array of drag items corresponding to the represented document.</span></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> dragItemsProvider: ((<span class=\"type\">UIDragSession</span>) -&gt; [<span class=\"type\">UIDragItem</span>])<span class=\"operator\">?</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// To support sharing, assign a closure to return a UIActivityViewController configured to share the represented document.</span></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> activityViewControllerProvider: (() -&gt; <span class=\"type\">UIActivityViewController</span>)<span class=\"operator\">?</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// If enabled, shows an icon representation of the document in the navigation bar.</span></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> wantsIconRepresentation: <span class=\"type\">Bool</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果需要Document header相关能力<strong>，</strong>使用<code>UIDocumentProperties</code> 对象给<code>navigationItem.documentProperties</code>属性赋值即可。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> documentProperties <span class=\"operator\">=</span> <span class=\"type\">UIDocumentProperties</span>(url: document.fileURL)</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> itemProvider <span class=\"operator\">=</span> <span class=\"type\">NSItemProvider</span>(contentsOf: document.fileURL) &#123;</span><br><span class=\"line\">    documentProperties.dragItemsProvider <span class=\"operator\">=</span> &#123; <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">        [<span class=\"type\">UIDragItem</span>(itemProvider: itemProvider)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    documentProperties.activityViewControllerProvider <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">UIActivityViewController</span>(activityItems: [itemProvider], applicationActivities: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">navigationItem.title <span class=\"operator\">=</span> document.localizedName</span><br><span class=\"line\">navigationItem.documentProperties <span class=\"operator\">=</span> documentProperties</span><br></pre></td></tr></table></figure>\n\n<p><strong>Title Menu</strong></p>\n<p>配置 title menu 需要给 <code>navigationItem.titleMenuProvider</code> 返回菜单 closure。系统返回给closure了一组 suggested actions，包括移动和复制；应用定义了动作包括文档导出为 HTML 和 PDF。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// When non-nil, UIKit will generate suggestedActions and call this block to generate a menu that is displayed from the title.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> titleMenuProvider: (([<span class=\"type\">UIMenuElement</span>]) -&gt; <span class=\"type\">UIMenu</span>?)<span class=\"operator\">?</span></span><br><span class=\"line\"></span><br><span class=\"line\">navigationItem.titleMenuProvider <span class=\"operator\">=</span> &#123; suggested <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> custom <span class=\"operator\">=</span> [</span><br><span class=\"line\">        <span class=\"type\">UIMenu</span>(title: <span class=\"string\">&quot;Export…&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;arrow.up.forward.square&quot;</span>), children: [</span><br><span class=\"line\">            <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;HTML&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;safari&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                previewView.exportAsWebArchive(named: document.localizedName, presenter: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;PDF&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;doc.richtext&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                previewView.exportAsPDF(named: document.localizedName, presenter: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ])</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">UIMenu</span>(children: suggested <span class=\"operator\">+</span> custom)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>UINavigationItem</code>提供了对文件重命名的支持。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">UINavigationItemRenameDelegate</span> : <span class=\"title\">AnyObject</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// This method is called when renaming has ended. The title on the navigation item has already been changed when this method is called but</span></span><br><span class=\"line\">    <span class=\"comment\">/// clients can make further adjustments to it when necessary.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItem</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>, <span class=\"params\">didEndRenamingWith</span> <span class=\"params\">title</span>: <span class=\"type\">String</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Controls whether the rename action is supported for the given navigation item. For example this method is called when the navigation bar&#x27;s</span></span><br><span class=\"line\">    <span class=\"comment\">/// document menu is shown to validate if the rename action should be part of that menu.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItemShouldBeginRenaming</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>)</span> -&gt; <span class=\"type\">Bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Called when we begin renaming. Implementing this method allows for customizing the initial text that will show up in the text field as well as the</span></span><br><span class=\"line\">    <span class=\"comment\">/// selected range of that text.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItem</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>, <span class=\"params\">willBeginRenamingWith</span> <span class=\"params\">suggestedTitle</span>: <span class=\"type\">String</span>, <span class=\"params\">selectedRange</span>: <span class=\"type\">Range</span>&lt;<span class=\"type\">String</span>.<span class=\"type\">Index</span>&gt;)</span> -&gt; (<span class=\"type\">String</span>, <span class=\"type\">Range</span>&lt;<span class=\"type\">String</span>.<span class=\"type\">Index</span>&gt;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// This method can be used to prevent renaming from happening. However there are cases (e.g. when a new navigation item is pushed on the navigation</span></span><br><span class=\"line\">    <span class=\"comment\">/// bar) where this method will not be called and instead navigationItem:didEndRenamingWithTitle: is called right away. Clients are therefore expected to</span></span><br><span class=\"line\">    <span class=\"comment\">/// handle titles in navigationItem:didEndRenamingWithTitle: for which they would return NO from navigationItem:shouldEndRenamingWithTitle:.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItem</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>, <span class=\"params\">shouldEndRenamingWith</span> <span class=\"params\">title</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Bool</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>启用该能力需要遵循<code>UINavigationItemRenameDelegate</code>，并使用 <code>navigationItem.renameDelegate</code> 绑定到 self。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">navigationItem.renameDelegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"体验提升\"><a href=\"#体验提升\" class=\"headerlink\" title=\"体验提升\"></a>体验提升</h2><p>如果你对这部分内容感兴趣可以移步此<a href=\"https://developer.apple.com/wwdc22/10071\">Session</a></p>\n<h3 id=\"Find-and-Replace\"><a href=\"#Find-and-Replace\" class=\"headerlink\" title=\"Find and Replace\"></a>Find and Replace</h3><p><code>UITextView</code>、<code>WKWebView</code>、<code>PDFView</code> 都支持了系统层级的查找与替换功能。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/editorTextView.png\" alt=\"editorTextView\"></p>\n<p>如果你在开发中的视图是上述 View 的子类，如<code>editorTextView</code> 是<code>UITextView</code> 的子类，启用查找和替换只需要一行代码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">editorTextView.isFindInteractionEnabled <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"UIEditMenu\"><a href=\"#UIEditMenu\" class=\"headerlink\" title=\"UIEditMenu\"></a>UIEditMenu</h3><p>Edit menu 交互菜单能够针对当前展示的内容提供诸如剪切、粘贴和粘贴等编辑动作。系统会针对当前用户的交互方式提供符合交互的菜单展示形式。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIEditMenu0.png\" alt=\"UIEditMenu0\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIEditMenu1.png\" alt=\"UIEditMenu1\"></p>\n<ul>\n<li>对于触摸交互，动作以 editing menu 的形式展示</li>\n<li>对于指针的交互，动作以 context menu的形式展示</li>\n</ul>\n<p>标准的 UIKit 类，如 <code>UITextView</code> 或者 <code>UITextField</code>，已经预先支持了Edit Menu交互，你可以便捷地框选一个地址然后获得类似地图导航的交互菜单选项。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIEditMenu2.png\" alt=\"UIEditMenu2.png\"></p>\n<p>在通用视图中添加 Edit menu 交互菜单</p>\n<ol>\n<li>创建一个 Edit menu 交互对象，并在默认 initializer 传入一个可选的 delegate。</li>\n<li>在视图上调用 <code>addInteraction(_:)</code> 来添加交互对象</li>\n<li>创建一个 gesture recognizer 来触发交互，并将其添加到视图中</li>\n</ol>\n<p>以下苹果提供的例子中创建了一个由长按触发的 Edit menu 交互菜单。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Add the edit menu interaction.</span></span><br><span class=\"line\">    editMenuInteraction <span class=\"operator\">=</span> <span class=\"type\">UIEditMenuInteraction</span>(delegate: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">    interactionView.addInteraction(editMenuInteraction<span class=\"operator\">!</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Create the gesture recognizer.</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> longPress <span class=\"operator\">=</span> <span class=\"type\">UILongPressGestureRecognizer</span>(target: <span class=\"keyword\">self</span>, action: #selector(didLongPress(<span class=\"keyword\">_</span>:)))</span><br><span class=\"line\">    longPress.allowedTouchTypes <span class=\"operator\">=</span> [<span class=\"type\">UITouch</span>.<span class=\"type\">TouchType</span>.direct.rawValue <span class=\"keyword\">as</span> <span class=\"type\">NSNumber</span>]</span><br><span class=\"line\">    interactionView.addGestureRecognizer(longPress)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didLongPress</span>(<span class=\"keyword\">_</span> <span class=\"params\">recognizer</span>: <span class=\"type\">UIGestureRecognizer</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> location <span class=\"operator\">=</span> recognizer.location(in: <span class=\"keyword\">self</span>.view)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> configuration <span class=\"operator\">=</span> <span class=\"type\">UIEditMenuConfiguration</span>(identifier: <span class=\"literal\">nil</span>, sourcePoint: location)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> interaction <span class=\"operator\">=</span> editMenuInteraction &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Present the edit menu interaction.</span></span><br><span class=\"line\">        interaction.presentEditMenu(with: configuration)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Edit menu 交互菜单包括标准编辑操作，包括剪贴、复制、删除等等，可参考<code>UIResponderStandardEditActions</code>。</li>\n<li>可以使用 <code>UIEditMenuInteractionDelegate</code> 提供的方法向Edit menu 交互菜单添加额外项目。</li>\n<li>对于文本视图可以使用<code>UITextViewDelegate</code>、<code>UITextFieldDelegate</code>或<code>UITextInput</code>中的方法为特定文本范围指定菜单显示的项目。</li>\n</ul>\n<h3 id=\"Sidebar\"><a href=\"#Sidebar\" class=\"headerlink\" title=\"Sidebar\"></a>Sidebar</h3><p>在 iOS 16 中，侧边栏会在 Slide-over（侧拉）模式下自动显示。UIKit 会管理一组私有视图。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Sidebar.png\" alt=\"Sidebar\"></p>\n<h3 id=\"SFSymbols\"><a href=\"#SFSymbols\" class=\"headerlink\" title=\"SFSymbols\"></a>SFSymbols</h3><p>SFSymbols 在 iOS 16 上支持四种 <code>renderingMode</code>，分别是 </p>\n<ul>\n<li>monochrome</li>\n<li>multicolor</li>\n<li>hierarchical</li>\n<li>palette</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/renderingMode.png\" alt=\"renderingMode\"></p>\n<p>在 iOS 15 及之前的版本中，默认使用 monochrome 渲染 symbol。</p>\n<p>在 iOS 16 如果没有指定renderingMode，默认使用 hierarchical 渲染 symbol，可以通过 <code>UIImage.SymbolConfiguration.preferringMonochrome()</code> 指定渲染方式。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/preferringMonochrome.png\" alt=\"preferringMonochrome\"></p>\n<p>同时增加了对可变 symbol 的支持，即支持根据从 0 到 1 的值变化映射 symbol 的变化，当然，这需要 symbol 自身支持该能力。</p>\n<p>假设 App 使用了<code>speaker.3.wave.fill</code> 符号表示当前音量级别，在值为 0 时扬声器波纹消失表示最低音量水平，当该值增加到 1 时扬声器的波形逐渐填充完整，表示音量水平提高。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/variableValue.png\" alt=\"variableValue\"></p>\n<p>使用方法也非常简单直白，通过标准的 SF Symbols API 为 UIImage 设置 <code>variableValue</code> 参数即可，甚至将该属性与 <code>renderingMode</code> 组合使用以进一步设计符号的样式。</p>\n<p>以下为 GitHub上 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 的 Demo。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sliderDidValueChange</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"type\">UISlider</span>)</span> &#123;</span><br><span class=\"line\">        imageView.image <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(</span><br><span class=\"line\">            systemName: <span class=\"string\">&quot;wifi&quot;</span>,</span><br><span class=\"line\">            variableValue: <span class=\"type\">Double</span>(sender.value),</span><br><span class=\"line\">            configuration: <span class=\"type\">UIImage</span>.<span class=\"type\">SymbolConfiguration</span>(paletteColors: [.orange])</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/sfsymbols.gif\" alt=\"sfsymbols.gif\"></p>\n<p>学习如何创建自定义变量符号可以观看 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10158/\">Adopt variable color in SF Symbols</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10157/\">What’s new in SF Symbols 4</a> 这两个Session。</p>\n<h3 id=\"Swift-Concurrency-and-Sendable\"><a href=\"#Swift-Concurrency-and-Sendable\" class=\"headerlink\" title=\"Swift Concurrency and Sendable\"></a>Swift Concurrency and Sendable</h3><p>UIKit 现在可以与 Swift Concurrency 同时使用，包括 immutable 类型，如以下的类型遵循了 Sendable</p>\n<ul>\n<li><code>UIImage</code></li>\n<li><code>UIColor</code></li>\n<li><code>UIFont</code></li>\n<li><code>UITraitCollection</code></li>\n</ul>\n<p>对象可以在 MainActor 和自定义 actor 之间发送而不会收到编译器警告。</p>\n<p>苹果提供的例子中，有一个叫做 Processor 的自定义 actor，以及一个被绑定到 MainActor 的叫做 ImageViewer 的 ViewController。在 <code>sendImageForProcessing</code> 方法中 ImageViewer 将图像发送给 Processor进行处理，目前是安全的。</p>\n<p>因为 UIImage 是 immutable 类型， Processor 必须创建新的拷贝来执行操作。任何引用原始图像的代码都不会显示这些修改，共享状态也不会发生不安全的变化。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Concurrency0.png\" alt=\"Concurrency0\"></p>\n<p>对比一下因为 mutable 而没有遵循 Sendable 的 UIBezierPath，以前只能在文档中表示，现在可以由编译器进行检查。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Concurrency1.png\" alt=\"Concurrency1\"></p>\n<p>要了解更多关于 Sendable 和 Swift Concurrency 移步视频 <a href=\"https://developer.apple.com/videos/play/wwdc2022/110351/\">Eliminate data races using Swift Concurrency</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2022/110350/\">Visualize and optimize Swift Concurrency</a>。</p>\n<h2 id=\"UIKit-and-SwiftUI\"><a href=\"#UIKit-and-SwiftUI\" class=\"headerlink\" title=\"UIKit and SwiftUI\"></a>UIKit and SwiftUI</h2><p>过去如果想要实现将 SwiftUI 视图嵌入 UIView 视图，一般需要这么做。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> controller <span class=\"operator\">=</span> <span class=\"type\">UIHostingController</span>(rootView: <span class=\"type\">SwiftUIView</span>())</span><br><span class=\"line\">addChild(controller)</span><br><span class=\"line\">view.addSubview(controller.view)</span><br><span class=\"line\">controller.didMove(toParent: <span class=\"keyword\">self</span>)</span><br></pre></td></tr></table></figure>\n\n<p>在 iOS 16上推出了 <code>UIHostingConfiguration</code> ，你可以在 <code>UICollectionView</code> 和 <code>UITableView</code> 中以 <code>contentConfiguration</code> 的方式将 SwiftUI 构建的 View 嵌入 cell。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cell.contentConfiguration <span class=\"operator\">=</span> <span class=\"type\">UIHostingConfiguration</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">SwiftUIView</span>()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结束语\"><a href=\"#结束语\" class=\"headerlink\" title=\"结束语\"></a>结束语</h2><p>最近几年的 WWDC 中看到苹果对于 UIKit 的理解，倡导使用 configuration 的方式构建组件、菜单，一方面参照人机交互指南构建组件能够确保交互不被滥用，另一方面降低了开发者的接入成本。</p>\n<p>作为开发者，一起尝试兼容 app 到 iOS 16，适配新的API，探索新的业务可能性吧。</p>\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><ul>\n<li><a href=\"https://www.swiftjectivec.com/ios-16-notable-uikit-additions/\">https://www.swiftjectivec.com/ios-16-notable-uikit-additions/</a></li>\n<li><a href=\"https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22\">https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22</a></li>\n<li><a href=\"https://developer.apple.com/wwdc22/10068\">https://developer.apple.com/wwdc22/10068</a></li>\n<li><a href=\"https://juejin.cn/post/7111173753668632584\">https://juejin.cn/post/7111173753668632584</a></li>\n<li><a href=\"https://github.com/WenchaoD/FSCalendar\">https://github.com/WenchaoD/FSCalendar</a></li>\n</ul>\n","site":{"data":{}},"excerpt":"<p>最近几年的 WWDC 每年都能看到很多 SwiftUI 的新能力，但不能忽略的是 UIKit 框架的更新。</p>\n<p>今年的 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10068/\">What’s New in UIKit Session</a> 主要包括以下几个方面</p>\n<ul>\n<li>生产力提升</li>\n<li>控制增强</li>\n<li>API 改进</li>\n<li>UIKit 与 SwiftUI 混编</li>\n</ul>\n<p>我按照业务理解和适配进度的优先级，对 session 内容进行了重新排序和整理，对 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 的仓库进行了一些改动，以下为我的总结。</p>","more":"<p><a href=\"https://github.com/iamStephenFang/WhatsNewInUIKit\">https://github.com/iamStephenFang/WhatsNewInUIKit</a></p>\n<h2 id=\"API-改进\"><a href=\"#API-改进\" class=\"headerlink\" title=\"API 改进\"></a>API 改进</h2><p>在 iOS 16 中部分 API 废弃，需要开发者进行适配，同时有一些新能力可以实现。</p>\n<h3 id=\"UIDevice\"><a href=\"#UIDevice\" class=\"headerlink\" title=\"UIDevice\"></a>UIDevice</h3><ul>\n<li>为了防止用户留下指纹， <code>UIDevice.name</code> 现在会报告模型名称而非用户自定义的设备名称。 使用自定义名称需要获得授权。  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// iOS 16 之前 (e.g. &quot;My iPhone&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">// iOS 16 (e.g. &quot;iPhone 13&quot;)</span></span><br><span class=\"line\"><span class=\"built_in\">UIDevice</span>().name</span><br></pre></td></tr></table></figure>\n</li>\n<li>不再支持 <code>UIDevice.orientation</code>， 应使用 <code>UIViewController</code> 相关API， 如 <code>preferredInterfaceOrientation</code> 来获取应用界面的预期呈现方向。  <figure class=\"highlight objectivec\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// UIDeviceOrientation(rawValue: 0) -&gt; .unknown</span></span><br><span class=\"line\"><span class=\"built_in\">UIDevice</span>().orientation</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// UIInterfaceOrientation(rawValue: 1) -&gt; .portrait (iPhone)</span></span><br><span class=\"line\"><span class=\"built_in\">UIViewController</span>().preferredInterfaceOrientationForPresentation</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<h3 id=\"UIScreen\"><a href=\"#UIScreen\" class=\"headerlink\" title=\"UIScreen\"></a>UIScreen</h3><p>iOS 16 为 配备了 M1 芯片的 iPad 以及 Mac 带来了 Stage Manager （台前调度）功能，作为应用开发者无需对代码进行改动即可适用该功能。</p>\n<aside>\n💡 在 iOS 13 前开发单窗口的 App，由 `UIApplication` 负责 App 状态，`UIApplicationDelegate`（`AppDelegate`）负责 App 事件和生命周期，然而这种模式不适用于开发多窗口的 iPad App 或 Mac Catalyst App。 iOS 13 引入了构建多窗口应用的 `UIScene`，并对功能职责进行了重新拆分，将 UI 相关的状态、事件和生命周期交与 `UIWindowScene` 和 `UIWindowSceneDelegate`（`SceneDelegate`）负责，`UISceneSession` 负责持久化的 UI 状态。\n\n</aside>\n\n<p>如果仍在使用旧版本的 UIScreen API，有必要迁移到新的 <code>UITraitCollection</code> 和 <code>UIScene</code> API</p>\n<p><a href=\"https://developer.apple.com/documentation/uikit/uiscreen/deprecated_symbols\">Apple Developer Documentation</a></p>\n<ul>\n<li><code>UIScreen.main</code> 已废弃，需要使用<code>(UIApplication.shared.connectedScenes.first as? UIWindowScene)?.screen</code></li>\n<li>UIScreen 生命周期通知废弃，包括 <code>didConnectNotification</code>、<code>didDisconnectNotification</code>，需要使用 <code>UIScene</code>相关方法</li>\n</ul>\n<h3 id=\"自适应大小-cell\"><a href=\"#自适应大小-cell\" class=\"headerlink\" title=\"自适应大小 cell\"></a>自适应大小 cell</h3><p><code>UICollectionView</code> 和 <code>UITableView</code> 的 cell 支持了自适应调整大小能力。控制自适应调整大小的是 <code>selfSizingInvalidation</code> 属性，默认开启。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UICollectionView</span> </span>&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Default is .enabled</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span>.selfSizingInvalidation: <span class=\"type\">SelfSizingInvalidation</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">SelfSizingInvalidation</span> : <span class=\"title\">Int</span>, @<span class=\"title\">unchecked</span> <span class=\"title\">Sendable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// No updates will take place when -invalidateIntrinsicContentSize is called on a self-sizing cell or its contentView.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> disabled <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> enabled <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Calling -invalidateIntrinsicContentSize on a self-sizing cell or its contentView will cause it to be resized if necessary, and</span></span><br><span class=\"line\">        <span class=\"comment\">/// any Auto Layout changes within the contentView of a self-sizing cell will automatically trigger -invalidateIntrinsicContentSize.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> enabledIncludingConstraints <span class=\"operator\">=</span> <span class=\"number\">2</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>若使用了 <code>UIListContentConfiguration</code> 配置cell，每当 cell 的配置发生更改时会自动执行 invalidation。</li>\n<li>若不使用 <code>UIListContentConfiguration</code> 配置cell，可以调用 cell 的 <code>invalidateIntrinsicContentSize</code> 方法手动执行 invalidation。</li>\n<li>若使用 Auto Layout 布局cell，可以通过设置 <code>selfSizingInvalidation</code> 属性为<code>enabledInclingConstraints</code> 来使其接收 Auto Layout 变更。即当 cell 检测到 contentView 内部的任何自动布局变化时，将自动调用 <code>invalidateIntrinsicContentSize</code> 方法。</li>\n</ul>\n<p>默认情况下 cell 自适应调整大小会伴随着动画，可以在 <code>invalidateIntrinsicContentSize</code> 方法外包一层 <code>performWithoutAnimation</code> 从而取消调整大小时的动画。 </p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapCollapseButton</span>()</span> &#123;</span><br><span class=\"line\">        label.text <span class=\"operator\">=</span> <span class=\"type\">Constants</span>.shortText</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didTapCollapseWithoutAnimationButton</span>()</span> &#123;</span><br><span class=\"line\">        label.text <span class=\"operator\">=</span> <span class=\"type\">Constants</span>.shortText</span><br><span class=\"line\">        <span class=\"type\">UIView</span>.performWithoutAnimation &#123;</span><br><span class=\"line\">            <span class=\"keyword\">self</span>.invalidateIntrinsicContentSize()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/SelfSizing.gif\" alt=\"SelfSizing.gif\"></p>\n<p><code>UICollectionView</code> 和 <code>UITableView</code> 将 cell 自适应大小的 invalidation 行为智能合并处理，并在最佳时间执行更新。</p>\n<h3 id=\"UISheetPresentationController\"><a href=\"#UISheetPresentationController\" class=\"headerlink\" title=\"UISheetPresentationController\"></a>UISheetPresentationController</h3><p>在 iOS 15 上苹果推出了表单展示控件，可以通过简单的代码 present 出 <code>.medium()</code> 和 <code>.large()</code> 两种大小的底部表单。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// on iOS 15</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> vc <span class=\"operator\">=</span> <span class=\"type\">UINavigationController</span>(rootViewController: <span class=\"type\">DemoViewController</span>())</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> sheet <span class=\"operator\">=</span> vc.sheetPresentationController &#123;</span><br><span class=\"line\">\t\tsheet.detents <span class=\"operator\">=</span> [.medium(), .large()]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">self</span>.present(vc, animated: <span class=\"literal\">true</span>)</span><br></pre></td></tr></table></figure>\n\n<p>用户可以通过拖拽的方式实现高度的切换，但是当时底栏不具备自定义高度的能力。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UISheetPresentationController1.png\" alt=\"UISheetPresentationController1.png\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UISheetPresentationController2.png\" alt=\"UISheetPresentationController2.png\"></p>\n<p>在 iOS 16 上苹果开放了 <code>UISheetPresentationController.Detent.Identifier</code> 提供了自定义的能力。</p>\n<p>可以简单返回一个常量值或最大高度的百分比来控制表单高度。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@MainActor</span> <span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Detent</span> : <span class=\"title\">NSObject</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">func</span> <span class=\"title\">medium</span>() -&gt; <span class=\"title\">Self</span></span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">open</span> <span class=\"title\">class</span> <span class=\"title\">func</span> <span class=\"title\">large</span>() -&gt; <span class=\"title\">Self</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\">        @<span class=\"title\">available</span>(<span class=\"title\">iOS</span> 16.0, *)</span></span><br><span class=\"line\"><span class=\"class\">        <span class=\"title\">open</span> <span class=\"title\">var</span> <span class=\"title\">identifier</span>: <span class=\"title\">UISheetPresentationController</span>.<span class=\"title\">Detent</span>.<span class=\"title\">Identifier</span> </span>&#123; <span class=\"keyword\">get</span> &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Create a custom detent</span></span><br><span class=\"line\">sheet.detents <span class=\"operator\">=</span> [</span><br><span class=\"line\">    .large(),</span><br><span class=\"line\">    .custom &#123; context <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"number\">0.3</span> <span class=\"operator\">*</span> context.maximumDetentValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n\n<p>更标准的做法是通过自定义 identifier 定制表单展示控件的高度。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Define a custom identifier</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">UISheetPresentationController</span>.<span class=\"title\">Detent</span>.<span class=\"title\">Identifier</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">static</span> <span class=\"keyword\">let</span> small <span class=\"operator\">=</span> <span class=\"type\">UISheetPresentationController</span>.<span class=\"type\">Detent</span>.<span class=\"type\">Identifier</span>(<span class=\"string\">&quot;small&quot;</span>)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Assign identifier to custom detent</span></span><br><span class=\"line\">sheet.detents <span class=\"operator\">=</span> [</span><br><span class=\"line\">    .large(),</span><br><span class=\"line\">    .custom (identifier: .small) &#123; context <span class=\"keyword\">in</span></span><br><span class=\"line\">        <span class=\"number\">0.3</span> <span class=\"operator\">*</span> context.maximumDetentValue</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Disable dimming above the custom detent</span></span><br><span class=\"line\">sheet.largestUndimmedDetentIdentifier <span class=\"operator\">=</span> .small</span><br></pre></td></tr></table></figure>\n\n<p>在使用的过程总需要注意表单展示控件高度不包含 <code>SafeAreaInsets</code>，计算布局时需要注意。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UISheetPresentationController.png\" alt=\"UISheetPresentationController\"></p>\n<h2 id=\"UI-控件\"><a href=\"#UI-控件\" class=\"headerlink\" title=\"UI 控件\"></a>UI 控件</h2><h3 id=\"UIPasteControl\"><a href=\"#UIPasteControl\" class=\"headerlink\" title=\"UIPasteControl\"></a>UIPasteControl</h3><p>在 iOS 16 前在 app 内执行复制粘贴操作会在顶部显示banner，在 iOS 16上 banner 被 alert 所取代。仍然由系统自动提示，根据用户的选项允许剪贴板内容访问。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl0.png\" alt=\"UIPasteControl0\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl1.png\" alt=\"UIPasteControl1\"></p>\n<p>开发者可以用新加入的 <code>UIPasteControl</code> 作为粘贴控件替换这个 alert，可以在<a href=\"https://developer.apple.com/documentation/uikit/uipastecontrol\">这里</a>找到相关文档。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">fileprivate</span> <span class=\"keyword\">lazy</span> <span class=\"keyword\">var</span> pasteControl: <span class=\"type\">UIPasteControl</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> pasteControlConfig <span class=\"operator\">=</span> <span class=\"type\">UIPasteControl</span>.<span class=\"type\">Configuration</span>()</span><br><span class=\"line\">        pasteControlConfig.baseBackgroundColor <span class=\"operator\">=</span> .systemBlue</span><br><span class=\"line\">        pasteControlConfig.baseForegroundColor <span class=\"operator\">=</span> .white</span><br><span class=\"line\">        pasteControlConfig.cornerRadius <span class=\"operator\">=</span> <span class=\"number\">5.0</span></span><br><span class=\"line\">        pasteControlConfig.displayMode <span class=\"operator\">=</span> .iconAndLabel</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"keyword\">let</span> pasteControl <span class=\"operator\">=</span> <span class=\"type\">UIPasteControl</span>(configuration: pasteControlConfig)</span><br><span class=\"line\">        pasteControl.target <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> pasteControl</span><br><span class=\"line\">    &#125; ()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// MARK: UIPasteConfigurationSupporting</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">canPaste</span>(<span class=\"keyword\">_</span> <span class=\"params\">itemProviders</span>: [<span class=\"type\">NSItemProvider</span>])</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">paste</span>(<span class=\"params\">itemProviders</span>: [<span class=\"type\">NSItemProvider</span>])</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> itemProvider <span class=\"operator\">=</span> itemProviders.first &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> itemProvider.canLoadObject(ofClass: <span class=\"type\">NSString</span>.<span class=\"keyword\">self</span>) &#123;</span><br><span class=\"line\">                itemProvider.loadObject(ofClass: <span class=\"type\">NSString</span>.<span class=\"keyword\">self</span>) &#123; (text, error) <span class=\"keyword\">in</span></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> text <span class=\"operator\">!=</span> <span class=\"literal\">nil</span> &#123;</span><br><span class=\"line\">                        <span class=\"type\">DispatchQueue</span>.main.async &#123;</span><br><span class=\"line\">                            <span class=\"keyword\">self</span>.label.text <span class=\"operator\">=</span> text <span class=\"keyword\">as?</span> <span class=\"type\">String</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl2.png\" alt=\"UIPasteControl2\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIPasteControl3.png\" alt=\"UIPasteControl3\"></p>\n<p>这个适配虽然达成了必须有用户交互才能读取剪贴板的目的，但也等来了一些开发者的吐槽。</p>\n<p><a href=\"https://twitter.com/cyanapps/status/1535187013611438081\">https://twitter.com/cyanapps/status/1535187013611438081</a></p>\n<h3 id=\"UIPageControl\"><a href=\"#UIPageControl\" class=\"headerlink\" title=\"UIPageControl\"></a>UIPageControl</h3><p><code>UIPageControl</code> 在 iOS 16 上得到了增强，主要包括以下两点</p>\n<ol>\n<li>可以针对不同的选中状态展示不同的图像 <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// The preferred image for the current page indicator. Symbol images are recommended. Default is nil.</span></span><br><span class=\"line\">    <span class=\"comment\">/// If this value is nil, then UIPageControl will use \\c preferredPageIndicatorImage (or its per-page variant) as</span></span><br><span class=\"line\">    <span class=\"comment\">/// the indicator image.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> preferredCurrentPageIndicatorImage: <span class=\"type\">UIImage</span>?</span><br></pre></td></tr></table></figure>\n</li>\n<li>可以设置布局方向为水平或垂直 <figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// The layout direction of the page indicators. The default value is \\c UIPageControlDirectionNatural.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> direction: <span class=\"type\">UIPageControl</span>.<span class=\"type\">Direction</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">enum</span> <span class=\"title\">Direction</span> : <span class=\"title\">Int</span>, @<span class=\"title\">unchecked</span> <span class=\"title\">Sendable</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out in the natural direction of the system locale.</span></span><br><span class=\"line\">        <span class=\"comment\">/// By default, this is equivalent to @c UIPageControlDirectionLeftToRight on LTR locales, and</span></span><br><span class=\"line\">        <span class=\"comment\">/// @c UIPageControlDirectionRightToLeft on RTL locales.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> natural <span class=\"operator\">=</span> <span class=\"number\">0</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from left to right.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> leftToRight <span class=\"operator\">=</span> <span class=\"number\">1</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from right to left.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> rightToLeft <span class=\"operator\">=</span> <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from top to bottom.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> topToBottom <span class=\"operator\">=</span> <span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/// Page indicators are laid out from bottom to top.</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> bottomToTop <span class=\"operator\">=</span> <span class=\"number\">4</span></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<p>GitHub上的 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 提供了以下 Demo。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">lazy</span> <span class=\"keyword\">var</span> pageControl: <span class=\"type\">UIPageControl</span> <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.backgroundColor <span class=\"operator\">=</span> .orange</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.layer.cornerRadius <span class=\"operator\">=</span> <span class=\"number\">8</span></span><br><span class=\"line\">        <span class=\"variable\">$0</span>.layer.masksToBounds <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br><span class=\"line\">        <span class=\"variable\">$0</span>.currentPage <span class=\"operator\">=</span> .zero</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.numberOfPages <span class=\"operator\">=</span> collectionViewData.count</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.direction <span class=\"operator\">=</span> .leftToRight</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.preferredIndicatorImage <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;star&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.preferredCurrentPageIndicatorImage <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;star.fill&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable\">$0</span>.translatesAutoresizingMaskIntoConstraints <span class=\"operator\">=</span> <span class=\"literal\">false</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable\">$0</span></span><br><span class=\"line\">    &#125;(<span class=\"type\">UIPageControl</span>())</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/UIPageControl.gif\" alt=\"UIPageControl.gif\"></p>\n<h3 id=\"UICalendarView\"><a href=\"#UICalendarView\" class=\"headerlink\" title=\"UICalendarView\"></a>UICalendarView</h3><p>之前一直希望 iOS 能够集成一个类似 <a href=\"https://github.com/WenchaoD/FSCalendar\">FSCalendar</a> 的日历组件，在 iOS 16上终于算是等到了。<code>UICalendarView</code> 是 <code>UIDatePicker</code> 的内联日历样式，它和 <code>UIDatePicker</code> 最主要的一个区别在于 <code>UICalendarView</code> 将日期表示为 <code>NSDateComponents</code> 而不是 <code>NSDate</code>。</p>\n<aside>\n💡 `NSDateComponents` 能够更好、更精确地表示数据模型， `NSDate` 是时间点的表示。\n\n</aside>\n\n<p><code>UICalendarView</code>现在作为一个独立的全功能组件形式提供，它具备了以下几种特性。</p>\n<ul>\n<li>支持日期单选或多选</li>\n<li>支持在范围内框选日期和禁用个别日期</li>\n<li>支持对标注日期进行装饰</li>\n<li>明确由哪个 <code>NSCalendar</code> 表示</li>\n</ul>\n<p>接下来尝试构建一个多选日期日历。</p>\n<ol>\n<li>创建一个 <code>UICalendarView</code> 对象，为其设置 <code>delegate</code> 并指定其 <code>calendar</code> 属性。如果需要采用农历，更改 <code>NSCalendar</code> 的初始化即可（ <code>Calendar(identifier: .chinese)</code>）</li>\n<li>配置多日期选择需要创建一个 <code>UICalendarSelectionMultiDate</code> 对象，并为其 <code>selectedDates</code> 属性进行赋值，再将此对象作为 <code>selectionBehavior</code> 属性传给我们创建的 <code>UICalendarView</code> 对象</li>\n<li>通过 <code>UICalendarViewDelegate</code> 中的 <code>multidateselect: canSelectDate:</code> 方法可以控制哪些日期可以被选择，如防止日历中选中单个日期。无法选择的日期会被置灰。</li>\n</ol>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Configuring a calendar view with multi-date selection</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> calendarView <span class=\"operator\">=</span> <span class=\"type\">UICalendarView</span>()</span><br><span class=\"line\">calendarView.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">calendarView.calendar <span class=\"operator\">=</span> <span class=\"type\">Calendar</span>(identifier: .gregorian)</span><br><span class=\"line\">view.addSubview(calendarView)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> multiDateSelection <span class=\"operator\">=</span> <span class=\"type\">UICalendarSelectionMultiDate</span>(delegate: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">multiDateSelection.selectedDates <span class=\"operator\">=</span> myDatabase.selectedDates()</span><br><span class=\"line\">calendarView.selectionBehavior <span class=\"operator\">=</span> multiDateSelection</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">multiDateSelection</span>(</span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">_</span> <span class=\"params\">selection</span>: <span class=\"type\">UICalendarSelectionMultiDate</span>,</span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"params\">canSelectDate</span> <span class=\"params\">dateComponents</span>: <span class=\"type\">DateComponents</span></span></span><br><span class=\"line\"><span class=\"function\">)</span> -&gt; <span class=\"type\">Bool</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> myDatabase.hasAvailabilities(for: dateComponents)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>UICalendarViewDelegate</code> 提供了 <code>calendarView: decorationForDateComponents:</code> 方法对日历中的日期进行装饰。</p>\n<ul>\n<li>如果不需要装饰直接返回 nil 即可</li>\n<li>可以通过简单的图像构造装饰日期</li>\n<li>可以通过自定义视图装饰日期</li>\n<li>自定义装饰视图不允许交互</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Configuring Decorations</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">calendarView</span>(</span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"keyword\">_</span> <span class=\"params\">calendarView</span>: <span class=\"type\">UICalendarView</span>, </span></span><br><span class=\"line\"><span class=\"function\">    <span class=\"params\">decorationFor</span> <span class=\"params\">dateComponents</span>: <span class=\"type\">DateComponents</span></span></span><br><span class=\"line\"><span class=\"function\">)</span> -&gt; <span class=\"type\">UICalendarView</span>.<span class=\"type\">Decoration</span>? &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> myDatabase.eventType(on: dateComponents) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">case</span> .none:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">nil</span></span><br><span class=\"line\">    <span class=\"keyword\">case</span> .busy:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .default()</span><br><span class=\"line\">    <span class=\"keyword\">case</span> .travel:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .image(airplaneImage, color: .systemOrange)</span><br><span class=\"line\">    <span class=\"keyword\">case</span> .party:</span><br><span class=\"line\">        <span class=\"keyword\">return</span> .customView &#123;</span><br><span class=\"line\">            <span class=\"type\">MyPartyEmojiLabel</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/UICalendarView.png\" alt=\"UICalendarView\"></p>\n<h2 id=\"导航栏提升\"><a href=\"#导航栏提升\" class=\"headerlink\" title=\"导航栏提升\"></a>导航栏提升</h2><h3 id=\"UINavigationItemStyle\"><a href=\"#UINavigationItemStyle\" class=\"headerlink\" title=\"UINavigationItemStyle\"></a><strong>UINavigationItemStyle</strong></h3><p>新引入了 <code>Browser</code>、<code>Editor</code> 两种导航样式，目前支持的<code>UINavigationItemStyle</code> 有以下几种</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UINavigationItemStyle.png\" alt=\"UINavigationItemStyle\"></p>\n<ul>\n<li><code>Navigator</code>：遵循传统的 push / pop 模型，如设置app</li>\n<li><code>Browser</code>：使用历史记录或文件夹结构导航，如 Safari、系统文件app</li>\n<li><code>Editor</code>：导航栏中间为文件相关操作，标题则在最左边</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Adopt the editor navigation style for the navigation item.</span></span><br><span class=\"line\">navigationItem.style <span class=\"operator\">=</span> .editor</span><br></pre></td></tr></table></figure>\n\n<h3 id=\"Center-Items\"><a href=\"#Center-Items\" class=\"headerlink\" title=\"Center Items\"></a>Center Items</h3><p>center items 是展示在导航栏中间的的控件组，能够提供对应用程序最重要功能的快速访问。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/CenterItems.png\" alt=\"CenterItems\"></p>\n<p>用户可以移动、移除或添加来定制导航栏的 center items。默认不展示的 center items 出现在自定义弹出窗口中，可以通过点击更多按钮中的 Customize Toolbar 菜单访问。</p>\n<p>为了实现这一能力，应用程序需要为导航项的<code>customizationIdentifier</code>属性提供一个字符串，UIKit 能够根据这个 identifier 自动保存和恢复用户自定义设定。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// Setting a non-nil customizationIdentifier enables customization and UIKit will automatically save &amp; restore customizations based on this identifier. The identifier must be unique within the scope of the application.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> customizationIdentifier: <span class=\"type\">String</span>?</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Set a customizationIdentifier and add center item groups.</span></span><br><span class=\"line\">navigationItem.customizationIdentifier <span class=\"operator\">=</span> <span class=\"string\">&quot;editorViewCustomization&quot;</span></span><br></pre></td></tr></table></figure>\n\n<p>配置 center Items 需要为 <code>navigationItem.centerItemGroups</code> 属性赋值</p>\n<ul>\n<li>若需创建用户无法移动或移除的 item，需要调用 <code>UIBarButtonItem</code> 的实例方法 <code>createFixedGroup()</code></li>\n<li>若需创建可调整的 <code>BarButtonItemGroup</code><ul>\n<li>拟定 <code>customizationIdentifier</code> 作为唯一标识</li>\n<li><code>UIBarButtonItems</code> 一次只能在一个 <code>UIBarButtonItemGroup</code> 中</li>\n<li>将一个 bar button item添加到一个 group 中会将其从之前的任何 group 中移除</li>\n<li><code>isInDefaultCustomization</code>属性设置默认是否出现在导航栏中</li>\n<li><code>BarButtonItemGroup</code> 通常包含多个可以提供定制能力的 <code>UIAction</code></li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Create a fixed group containing this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">creatingFixedGroup</span>()</span> -&gt; <span class=\"type\">UIBarButtonItemGroup</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/// Create an optional BarButtonItemGroup containing only this bar button item. UIBarButtonItems may only be in a single UIBarButtonItemGroup at a time, adding a bar button item to a group removes it from any previous group.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">tvOS</span>, unavailable)</span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">watchOS</span>, unavailable)</span><br><span class=\"line\">    <span class=\"meta\">@MainActor</span> <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">creatingOptionalGroup</span>(<span class=\"params\">customizationIdentifier</span>: <span class=\"type\">String</span>, <span class=\"params\">isInDefaultCustomization</span>: <span class=\"type\">Bool</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>)</span> -&gt; <span class=\"type\">UIBarButtonItemGroup</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">configureCenterItemGroups</span>()</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\tnavigationItem.centerItemGroups <span class=\"operator\">=</span> [</span><br><span class=\"line\">            <span class=\"type\">UIBarButtonItem</span>(primaryAction: <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;Sync Scrolling&quot;</span>, image: syncScrollingImage) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] action <span class=\"keyword\">in</span></span><br><span class=\"line\">                syncScrolling.toggle()</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> barButtonItem <span class=\"operator\">=</span> action.sender <span class=\"keyword\">as?</span> <span class=\"type\">UIBarButtonItem</span> &#123;</span><br><span class=\"line\">                    barButtonItem.image <span class=\"operator\">=</span> syncScrollingImage</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;).creatingFixedGroup(),</span><br><span class=\"line\">            </span><br><span class=\"line\">           <span class=\"type\">UIBarButtonItem</span>(primaryAction: <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;Add Link&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;link&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                insertTag(.link)</span><br><span class=\"line\">            &#125;).creatingOptionalGroup(customizationIdentifier: <span class=\"string\">&quot;addLink&quot;</span>)</span><br><span class=\"line\">\t\t\t\t\t],</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t\t\t<span class=\"type\">UIBarButtonItem</span>(title: <span class=\"string\">&quot;Insert Image&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;photo&quot;</span>), menu: <span class=\"type\">UIMenu</span>(title: <span class=\"string\">&quot;Insert Image&quot;</span>, children: [</span><br><span class=\"line\">                <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;From Photo Library&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;photo.on.rectangle&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                    <span class=\"keyword\">let</span> picker <span class=\"operator\">=</span> <span class=\"type\">UIImagePickerController</span>()</span><br><span class=\"line\">                    picker.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">                    present(picker, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;From File&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;folder&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                    <span class=\"keyword\">let</span> picker <span class=\"operator\">=</span> <span class=\"type\">UIDocumentPickerViewController</span>(forOpeningContentTypes: [.image], asCopy: <span class=\"literal\">true</span>)</span><br><span class=\"line\">                    picker.delegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br><span class=\"line\">                    isPickingImageFromFile <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br><span class=\"line\">                    present(picker, animated: <span class=\"literal\">true</span>)</span><br><span class=\"line\">                &#125;,</span><br><span class=\"line\">                <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;Blank Image Tag&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;tag&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                    insertTag(.image)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            ])).creatingOptionalGroup(customizationIdentifier: <span class=\"string\">&quot;addImage&quot;</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>center items 针对 Mac Catalyst 的 NSToolbar 和 iPad 并排模式能够实现自动适配。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/NSToolbar.png\" alt=\"NSToolbar\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/iPadSide.png\" alt=\"iPadSide\"></p>\n<h3 id=\"文件菜单\"><a href=\"#文件菜单\" class=\"headerlink\" title=\"文件菜单\"></a>文件菜单</h3><p>当用户点击导航项目的标题时会出现文件菜单，从上到下可以将其拆分成三部分</p>\n<ol>\n<li>Document header：包含文件名、文件类型、文件大小、分享菜单等</li>\n<li>Suggested  title menu：与当前文档相关的建议操作</li>\n<li>Custom title menu：自定义操作</li>\n</ol>\n<p><img src=\"http://image.stephenfang.me/mweb/TitleMenu.png\" alt=\"TitleMenu\"></p>\n<p><strong>Document header</strong></p>\n<p>Document header 显示当前文档相关的信息，包括标题、文件类型和大小，还提供了分享或拖放文档的能力。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\"><span class=\"meta\">@MainActor</span> <span class=\"keyword\">open</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UIDocumentProperties</span> : <span class=\"title\">NSObject</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// When initializing with a url, UIKit will automatically lookup metadata based on the data at that url.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">url</span>: <span class=\"type\">URL</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// Initialize with metadata directly when the item is not backed by a url.</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">init</span>(<span class=\"params\">metadata</span>: <span class=\"type\">LPLinkMetadata</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// The metadata to use. UIKit will generate this automatically if a url is given at initialization time.</span></span><br><span class=\"line\">    <span class=\"keyword\">@NSCopying</span> <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> metadata: <span class=\"type\">LPLinkMetadata</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// To support drag &amp; drop, assign a closure to return an array of drag items corresponding to the represented document.</span></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> dragItemsProvider: ((<span class=\"type\">UIDragSession</span>) -&gt; [<span class=\"type\">UIDragItem</span>])<span class=\"operator\">?</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// To support sharing, assign a closure to return a UIActivityViewController configured to share the represented document.</span></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> activityViewControllerProvider: (() -&gt; <span class=\"type\">UIActivityViewController</span>)<span class=\"operator\">?</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">/// If enabled, shows an icon representation of the document in the navigation bar.</span></span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> wantsIconRepresentation: <span class=\"type\">Bool</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>如果需要Document header相关能力<strong>，</strong>使用<code>UIDocumentProperties</code> 对象给<code>navigationItem.documentProperties</code>属性赋值即可。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> documentProperties <span class=\"operator\">=</span> <span class=\"type\">UIDocumentProperties</span>(url: document.fileURL)</span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"keyword\">let</span> itemProvider <span class=\"operator\">=</span> <span class=\"type\">NSItemProvider</span>(contentsOf: document.fileURL) &#123;</span><br><span class=\"line\">    documentProperties.dragItemsProvider <span class=\"operator\">=</span> &#123; <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">        [<span class=\"type\">UIDragItem</span>(itemProvider: itemProvider)]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    documentProperties.activityViewControllerProvider <span class=\"operator\">=</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">UIActivityViewController</span>(activityItems: [itemProvider], applicationActivities: <span class=\"literal\">nil</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">navigationItem.title <span class=\"operator\">=</span> document.localizedName</span><br><span class=\"line\">navigationItem.documentProperties <span class=\"operator\">=</span> documentProperties</span><br></pre></td></tr></table></figure>\n\n<p><strong>Title Menu</strong></p>\n<p>配置 title menu 需要给 <code>navigationItem.titleMenuProvider</code> 返回菜单 closure。系统返回给closure了一组 suggested actions，包括移动和复制；应用定义了动作包括文档导出为 HTML 和 PDF。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/// When non-nil, UIKit will generate suggestedActions and call this block to generate a menu that is displayed from the title.</span></span><br><span class=\"line\">    <span class=\"keyword\">@available</span>(<span class=\"keyword\">iOS</span> <span class=\"number\">16.0</span>, <span class=\"operator\">*</span>)</span><br><span class=\"line\">    <span class=\"keyword\">open</span> <span class=\"keyword\">var</span> titleMenuProvider: (([<span class=\"type\">UIMenuElement</span>]) -&gt; <span class=\"type\">UIMenu</span>?)<span class=\"operator\">?</span></span><br><span class=\"line\"></span><br><span class=\"line\">navigationItem.titleMenuProvider <span class=\"operator\">=</span> &#123; suggested <span class=\"keyword\">in</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> custom <span class=\"operator\">=</span> [</span><br><span class=\"line\">        <span class=\"type\">UIMenu</span>(title: <span class=\"string\">&quot;Export…&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;arrow.up.forward.square&quot;</span>), children: [</span><br><span class=\"line\">            <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;HTML&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;safari&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                previewView.exportAsWebArchive(named: document.localizedName, presenter: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            <span class=\"type\">UIAction</span>(title: <span class=\"string\">&quot;PDF&quot;</span>, image: <span class=\"type\">UIImage</span>(systemName: <span class=\"string\">&quot;doc.richtext&quot;</span>)) &#123; [<span class=\"keyword\">unowned</span> <span class=\"keyword\">self</span>] <span class=\"keyword\">_</span> <span class=\"keyword\">in</span></span><br><span class=\"line\">                previewView.exportAsPDF(named: document.localizedName, presenter: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ])</span><br><span class=\"line\">    ]</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"type\">UIMenu</span>(children: suggested <span class=\"operator\">+</span> custom)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><code>UINavigationItem</code>提供了对文件重命名的支持。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">protocol</span> <span class=\"title\">UINavigationItemRenameDelegate</span> : <span class=\"title\">AnyObject</span> </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// This method is called when renaming has ended. The title on the navigation item has already been changed when this method is called but</span></span><br><span class=\"line\">    <span class=\"comment\">/// clients can make further adjustments to it when necessary.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItem</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>, <span class=\"params\">didEndRenamingWith</span> <span class=\"params\">title</span>: <span class=\"type\">String</span>)</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Controls whether the rename action is supported for the given navigation item. For example this method is called when the navigation bar&#x27;s</span></span><br><span class=\"line\">    <span class=\"comment\">/// document menu is shown to validate if the rename action should be part of that menu.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItemShouldBeginRenaming</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>)</span> -&gt; <span class=\"type\">Bool</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// Called when we begin renaming. Implementing this method allows for customizing the initial text that will show up in the text field as well as the</span></span><br><span class=\"line\">    <span class=\"comment\">/// selected range of that text.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItem</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>, <span class=\"params\">willBeginRenamingWith</span> <span class=\"params\">suggestedTitle</span>: <span class=\"type\">String</span>, <span class=\"params\">selectedRange</span>: <span class=\"type\">Range</span>&lt;<span class=\"type\">String</span>.<span class=\"type\">Index</span>&gt;)</span> -&gt; (<span class=\"type\">String</span>, <span class=\"type\">Range</span>&lt;<span class=\"type\">String</span>.<span class=\"type\">Index</span>&gt;)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/// This method can be used to prevent renaming from happening. However there are cases (e.g. when a new navigation item is pushed on the navigation</span></span><br><span class=\"line\">    <span class=\"comment\">/// bar) where this method will not be called and instead navigationItem:didEndRenamingWithTitle: is called right away. Clients are therefore expected to</span></span><br><span class=\"line\">    <span class=\"comment\">/// handle titles in navigationItem:didEndRenamingWithTitle: for which they would return NO from navigationItem:shouldEndRenamingWithTitle:.</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">navigationItem</span>(<span class=\"keyword\">_</span>: <span class=\"type\">UINavigationItem</span>, <span class=\"params\">shouldEndRenamingWith</span> <span class=\"params\">title</span>: <span class=\"type\">String</span>)</span> -&gt; <span class=\"type\">Bool</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>启用该能力需要遵循<code>UINavigationItemRenameDelegate</code>，并使用 <code>navigationItem.renameDelegate</code> 绑定到 self。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">navigationItem.renameDelegate <span class=\"operator\">=</span> <span class=\"keyword\">self</span></span><br></pre></td></tr></table></figure>\n\n<h2 id=\"体验提升\"><a href=\"#体验提升\" class=\"headerlink\" title=\"体验提升\"></a>体验提升</h2><p>如果你对这部分内容感兴趣可以移步此<a href=\"https://developer.apple.com/wwdc22/10071\">Session</a></p>\n<h3 id=\"Find-and-Replace\"><a href=\"#Find-and-Replace\" class=\"headerlink\" title=\"Find and Replace\"></a>Find and Replace</h3><p><code>UITextView</code>、<code>WKWebView</code>、<code>PDFView</code> 都支持了系统层级的查找与替换功能。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/editorTextView.png\" alt=\"editorTextView\"></p>\n<p>如果你在开发中的视图是上述 View 的子类，如<code>editorTextView</code> 是<code>UITextView</code> 的子类，启用查找和替换只需要一行代码。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">editorTextView.isFindInteractionEnabled <span class=\"operator\">=</span> <span class=\"literal\">true</span></span><br></pre></td></tr></table></figure>\n\n\n<h3 id=\"UIEditMenu\"><a href=\"#UIEditMenu\" class=\"headerlink\" title=\"UIEditMenu\"></a>UIEditMenu</h3><p>Edit menu 交互菜单能够针对当前展示的内容提供诸如剪切、粘贴和粘贴等编辑动作。系统会针对当前用户的交互方式提供符合交互的菜单展示形式。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIEditMenu0.png\" alt=\"UIEditMenu0\"></p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIEditMenu1.png\" alt=\"UIEditMenu1\"></p>\n<ul>\n<li>对于触摸交互，动作以 editing menu 的形式展示</li>\n<li>对于指针的交互，动作以 context menu的形式展示</li>\n</ul>\n<p>标准的 UIKit 类，如 <code>UITextView</code> 或者 <code>UITextField</code>，已经预先支持了Edit Menu交互，你可以便捷地框选一个地址然后获得类似地图导航的交互菜单选项。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/UIEditMenu2.png\" alt=\"UIEditMenu2.png\"></p>\n<p>在通用视图中添加 Edit menu 交互菜单</p>\n<ol>\n<li>创建一个 Edit menu 交互对象，并在默认 initializer 传入一个可选的 delegate。</li>\n<li>在视图上调用 <code>addInteraction(_:)</code> 来添加交互对象</li>\n<li>创建一个 gesture recognizer 来触发交互，并将其添加到视图中</li>\n</ol>\n<p>以下苹果提供的例子中创建了一个由长按触发的 Edit menu 交互菜单。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">override</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">viewDidLoad</span>()</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">super</span>.viewDidLoad()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Add the edit menu interaction.</span></span><br><span class=\"line\">    editMenuInteraction <span class=\"operator\">=</span> <span class=\"type\">UIEditMenuInteraction</span>(delegate: <span class=\"keyword\">self</span>)</span><br><span class=\"line\">    interactionView.addInteraction(editMenuInteraction<span class=\"operator\">!</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// Create the gesture recognizer.</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> longPress <span class=\"operator\">=</span> <span class=\"type\">UILongPressGestureRecognizer</span>(target: <span class=\"keyword\">self</span>, action: #selector(didLongPress(<span class=\"keyword\">_</span>:)))</span><br><span class=\"line\">    longPress.allowedTouchTypes <span class=\"operator\">=</span> [<span class=\"type\">UITouch</span>.<span class=\"type\">TouchType</span>.direct.rawValue <span class=\"keyword\">as</span> <span class=\"type\">NSNumber</span>]</span><br><span class=\"line\">    interactionView.addGestureRecognizer(longPress)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">didLongPress</span>(<span class=\"keyword\">_</span> <span class=\"params\">recognizer</span>: <span class=\"type\">UIGestureRecognizer</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> location <span class=\"operator\">=</span> recognizer.location(in: <span class=\"keyword\">self</span>.view)</span><br><span class=\"line\">    <span class=\"keyword\">let</span> configuration <span class=\"operator\">=</span> <span class=\"type\">UIEditMenuConfiguration</span>(identifier: <span class=\"literal\">nil</span>, sourcePoint: location)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">let</span> interaction <span class=\"operator\">=</span> editMenuInteraction &#123;</span><br><span class=\"line\">        <span class=\"comment\">// Present the edit menu interaction.</span></span><br><span class=\"line\">        interaction.presentEditMenu(with: configuration)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<ul>\n<li>Edit menu 交互菜单包括标准编辑操作，包括剪贴、复制、删除等等，可参考<code>UIResponderStandardEditActions</code>。</li>\n<li>可以使用 <code>UIEditMenuInteractionDelegate</code> 提供的方法向Edit menu 交互菜单添加额外项目。</li>\n<li>对于文本视图可以使用<code>UITextViewDelegate</code>、<code>UITextFieldDelegate</code>或<code>UITextInput</code>中的方法为特定文本范围指定菜单显示的项目。</li>\n</ul>\n<h3 id=\"Sidebar\"><a href=\"#Sidebar\" class=\"headerlink\" title=\"Sidebar\"></a>Sidebar</h3><p>在 iOS 16 中，侧边栏会在 Slide-over（侧拉）模式下自动显示。UIKit 会管理一组私有视图。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Sidebar.png\" alt=\"Sidebar\"></p>\n<h3 id=\"SFSymbols\"><a href=\"#SFSymbols\" class=\"headerlink\" title=\"SFSymbols\"></a>SFSymbols</h3><p>SFSymbols 在 iOS 16 上支持四种 <code>renderingMode</code>，分别是 </p>\n<ul>\n<li>monochrome</li>\n<li>multicolor</li>\n<li>hierarchical</li>\n<li>palette</li>\n</ul>\n<p><img src=\"http://image.stephenfang.me/mweb/renderingMode.png\" alt=\"renderingMode\"></p>\n<p>在 iOS 15 及之前的版本中，默认使用 monochrome 渲染 symbol。</p>\n<p>在 iOS 16 如果没有指定renderingMode，默认使用 hierarchical 渲染 symbol，可以通过 <code>UIImage.SymbolConfiguration.preferringMonochrome()</code> 指定渲染方式。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/preferringMonochrome.png\" alt=\"preferringMonochrome\"></p>\n<p>同时增加了对可变 symbol 的支持，即支持根据从 0 到 1 的值变化映射 symbol 的变化，当然，这需要 symbol 自身支持该能力。</p>\n<p>假设 App 使用了<code>speaker.3.wave.fill</code> 符号表示当前音量级别，在值为 0 时扬声器波纹消失表示最低音量水平，当该值增加到 1 时扬声器的波形逐渐填充完整，表示音量水平提高。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/variableValue.png\" alt=\"variableValue\"></p>\n<p>使用方法也非常简单直白，通过标准的 SF Symbols API 为 UIImage 设置 <code>variableValue</code> 参数即可，甚至将该属性与 <code>renderingMode</code> 组合使用以进一步设计符号的样式。</p>\n<p>以下为 GitHub上 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 的 Demo。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">@objc</span> <span class=\"keyword\">private</span> <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">sliderDidValueChange</span>(<span class=\"keyword\">_</span> <span class=\"params\">sender</span>: <span class=\"type\">UISlider</span>)</span> &#123;</span><br><span class=\"line\">        imageView.image <span class=\"operator\">=</span> <span class=\"type\">UIImage</span>(</span><br><span class=\"line\">            systemName: <span class=\"string\">&quot;wifi&quot;</span>,</span><br><span class=\"line\">            variableValue: <span class=\"type\">Double</span>(sender.value),</span><br><span class=\"line\">            configuration: <span class=\"type\">UIImage</span>.<span class=\"type\">SymbolConfiguration</span>(paletteColors: [.orange])</span><br><span class=\"line\">        )</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"http://image.stephenfang.me/mweb/sfsymbols.gif\" alt=\"sfsymbols.gif\"></p>\n<p>学习如何创建自定义变量符号可以观看 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10158/\">Adopt variable color in SF Symbols</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10157/\">What’s new in SF Symbols 4</a> 这两个Session。</p>\n<h3 id=\"Swift-Concurrency-and-Sendable\"><a href=\"#Swift-Concurrency-and-Sendable\" class=\"headerlink\" title=\"Swift Concurrency and Sendable\"></a>Swift Concurrency and Sendable</h3><p>UIKit 现在可以与 Swift Concurrency 同时使用，包括 immutable 类型，如以下的类型遵循了 Sendable</p>\n<ul>\n<li><code>UIImage</code></li>\n<li><code>UIColor</code></li>\n<li><code>UIFont</code></li>\n<li><code>UITraitCollection</code></li>\n</ul>\n<p>对象可以在 MainActor 和自定义 actor 之间发送而不会收到编译器警告。</p>\n<p>苹果提供的例子中，有一个叫做 Processor 的自定义 actor，以及一个被绑定到 MainActor 的叫做 ImageViewer 的 ViewController。在 <code>sendImageForProcessing</code> 方法中 ImageViewer 将图像发送给 Processor进行处理，目前是安全的。</p>\n<p>因为 UIImage 是 immutable 类型， Processor 必须创建新的拷贝来执行操作。任何引用原始图像的代码都不会显示这些修改，共享状态也不会发生不安全的变化。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Concurrency0.png\" alt=\"Concurrency0\"></p>\n<p>对比一下因为 mutable 而没有遵循 Sendable 的 UIBezierPath，以前只能在文档中表示，现在可以由编译器进行检查。</p>\n<p><img src=\"http://image.stephenfang.me/mweb/Concurrency1.png\" alt=\"Concurrency1\"></p>\n<p>要了解更多关于 Sendable 和 Swift Concurrency 移步视频 <a href=\"https://developer.apple.com/videos/play/wwdc2022/110351/\">Eliminate data races using Swift Concurrency</a> 和 <a href=\"https://developer.apple.com/videos/play/wwdc2022/110350/\">Visualize and optimize Swift Concurrency</a>。</p>\n<h2 id=\"UIKit-and-SwiftUI\"><a href=\"#UIKit-and-SwiftUI\" class=\"headerlink\" title=\"UIKit and SwiftUI\"></a>UIKit and SwiftUI</h2><p>过去如果想要实现将 SwiftUI 视图嵌入 UIView 视图，一般需要这么做。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> controller <span class=\"operator\">=</span> <span class=\"type\">UIHostingController</span>(rootView: <span class=\"type\">SwiftUIView</span>())</span><br><span class=\"line\">addChild(controller)</span><br><span class=\"line\">view.addSubview(controller.view)</span><br><span class=\"line\">controller.didMove(toParent: <span class=\"keyword\">self</span>)</span><br></pre></td></tr></table></figure>\n\n<p>在 iOS 16上推出了 <code>UIHostingConfiguration</code> ，你可以在 <code>UICollectionView</code> 和 <code>UITableView</code> 中以 <code>contentConfiguration</code> 的方式将 SwiftUI 构建的 View 嵌入 cell。</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cell.contentConfiguration <span class=\"operator\">=</span> <span class=\"type\">UIHostingConfiguration</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">SwiftUIView</span>()</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"结束语\"><a href=\"#结束语\" class=\"headerlink\" title=\"结束语\"></a>结束语</h2><p>最近几年的 WWDC 中看到苹果对于 UIKit 的理解，倡导使用 configuration 的方式构建组件、菜单，一方面参照人机交互指南构建组件能够确保交互不被滥用，另一方面降低了开发者的接入成本。</p>\n<p>作为开发者，一起尝试兼容 app 到 iOS 16，适配新的API，探索新的业务可能性吧。</p>\n<h2 id=\"参考链接\"><a href=\"#参考链接\" class=\"headerlink\" title=\"参考链接\"></a>参考链接</h2><ul>\n<li><a href=\"https://www.swiftjectivec.com/ios-16-notable-uikit-additions/\">https://www.swiftjectivec.com/ios-16-notable-uikit-additions/</a></li>\n<li><a href=\"https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22\">https://blog.appcircle.io/whats-new-in-uikit-at-ios-16-wwdc22</a></li>\n<li><a href=\"https://developer.apple.com/wwdc22/10068\">https://developer.apple.com/wwdc22/10068</a></li>\n<li><a href=\"https://juejin.cn/post/7111173753668632584\">https://juejin.cn/post/7111173753668632584</a></li>\n<li><a href=\"https://github.com/WenchaoD/FSCalendar\">https://github.com/WenchaoD/FSCalendar</a></li>\n</ul>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/mweb/SelfSizing.gif","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:58:50 GMT+0800 (中国标准时间)","title":"WWDC22 UIKit 新变化","path":"2022/07/24/WWDC22-UIKit/","eyeCatchImage":"http://image.stephenfang.me/mweb/SelfSizing.gif","excerpt":"<p>最近几年的 WWDC 每年都能看到很多 SwiftUI 的新能力，但不能忽略的是 UIKit 框架的更新。</p>\n<p>今年的 <a href=\"https://developer.apple.com/videos/play/wwdc2022/10068/\">What’s New in UIKit Session</a> 主要包括以下几个方面</p>\n<ul>\n<li>生产力提升</li>\n<li>控制增强</li>\n<li>API 改进</li>\n<li>UIKit 与 SwiftUI 混编</li>\n</ul>\n<p>我按照业务理解和适配进度的优先级，对 session 内容进行了重新排序和整理，对 <a href=\"https://github.com/ferhanakkan\">@ferhanakkan</a> 的仓库进行了一些改动，以下为我的总结。</p>","date":{"_isAMomentObject":true,"_i":"2022-07-24T15:15:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-07-24T15:15:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"技术","tags":["iOS","Swift","WWDC"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":19892},{"title":"云南旅行流水账","date":"2022-02-20T08:00:00.000Z","copyright":true,"_content":"\n去年国庆期间和朋友一起去了趟云南，起初安排的路线是 **丽江 -> 香格里拉 -> 泸沽湖 -> 昆明**，在旅程中我们从时间和成本上考量，加上路人给予的一些建议，最终的路线是 **丽江 -> 大理 -> 昆明**。\n\n由于工作较忙一直没有时间整理旅行中的见闻，最近在整理博客的时候静下心来完善之前写的日记，花了一下午将六天的经历整理成一片流水账，发表在个人博客上图一乐。\n\n<!--more-->\n\n# 第一天\n为了让旅程显得没有那么劳累，特地选择了一个出发时间较晚的航班，同时为了节省费用，预定了需要转机的机票。这次旅行不能说是一时兴起，应该说是弥补了暑假没有毕业旅行的遗憾。\n10点从萧山机场出发，到达丽江已是下午三点，一下飞机就能感受到离天空的距离更近了，作为一个从平原来的人并没有明显感觉空气稀薄了。\n\n![ff6659d985f90f0c02800c28ab472fda](http://image.stephenfang.me/yunnan/ff6659d985f90f0c02800c28ab472fda.jpeg)\n\n这是我第一次来云南。在网上冲浪的时候时常能刷到云南的名山大川，也想着有一天能来看看，碰巧朋友对云南也抱着很深的念想。\n对于云南我比较熟悉的是大理、丽江这些旅游城市的名字，时常能在热门旅游排行榜上看到他们的位置，由于同事强烈推荐了泸沽湖，在安排行程的时候我也将其考虑在内。\n在飞机上就能够感受到云南的山是磅礴的，完全不同于江南的柔美风格。\n\n![ebf28efdfe345106d0894026adf5c5d7](http://image.stephenfang.me/yunnan/ebf28efdfe345106d0894026adf5c5d7.jpeg)\n\n从三义机场坐大巴到丽江古城有一个小时的车程。在规划旅程的时候没有特别调查过丽江古城是否那么值得去住下，只是草草在Airbnb上检索和筛选了几家我和同伴都满意的民宿。拎着行李穿过大半个古城，总算到达了我们的民宿。\n\n![e22ae0331bbbd911244cac0de7e40b07](http://image.stephenfang.me/yunnan/e22ae0331bbbd911244cac0de7e40b07.jpeg)\n![095486935be166df4f6d224b8006b0fb](http://image.stephenfang.me/yunnan/095486935be166df4f6d224b8006b0fb.jpeg)\n\n丽江古城的开发不能说好，它在保留着一些古城风貌的同时植入了太多的商业元素，路边的花卉就像是不要钱似的堆积着。让我感到欣慰的就是民宿整体让人满意，里面的配套设施十分扎实，还可以吃到房东准备的高山苹果。\n![](http://image.stephenfang.me/yunnan/16453260665672.jpg)\n\n从民宿的院子里可以痴痴地望上天空好久，在杭州几乎没有看到蓝色饱和度这么高的天空。院子里还有一只慵懒的猫咪在晒太阳，爬上二楼可以望到远处的高山。\n\n![fe0b10442075f57e72b60acdf5ad2b98](http://image.stephenfang.me/yunnan/fe0b10442075f57e72b60acdf5ad2b98.jpeg)\n\n差不多到了吃饭的点，初来乍到怕在古城里被宰，咨询了房东的意见后选择了古城北门附近的一家腊排骨火锅。我和同伴对于腊肉并没有那么钟意，吃前几块的时候感觉是很新奇的味道，再往后吃只能感到油腻，不过望着远山吃饭真的称得上是一种享受。\n\n![356e4921d91f036d68ce3affe6876d23](http://image.stephenfang.me/yunnan/356e4921d91f036d68ce3affe6876d23.jpeg)\n\n大概是在古城里逛了很久才动了回民宿的念头，正遇上两位准备退房的广东大学生。在交谈中得知他们从大理一路玩过来，没有抢到上玉龙雪山的票，正准备赶往下一站。正巧我们也没有决定第二天去哪里玩，本想着去香格里拉——所谓的「小拉萨」朝圣，无奈经费和时间都不太宽裕，不如按部就班去一趟必去的玉龙雪山。\n记忆中两个男生都挺健谈的，给予了我们不少旅行的建议，我认为在旅行中和他人的沟通是旅行中很重要的一部分，和不同行业、不同年龄、不同地方的人对话总会有新的启发。\n\n\tDate:\t2021年10月4日 GMT+8 13:12:03\n\tWeather:\t15 °C Mostly Cloudy\n\tLocation:\t大具乡, 丽江市, 云南省, 中国\n\n# 第二天\n云南的早晨就应该从一碗米线开始。\n考虑到米线的价格不会太贵，这一次没有选择古城外的店铺，而是在古城内参考大众点评选择了一家米线店。这家店生意很旺，来就餐的排队到了院子之外，然而实话说这碗米线的味道只能说十分平淡，烤豆腐做的也烧欠火候，汤头在江浙人看来不能说是鲜。\n\n![48d24d21aa00d5d4e7bc1e3ba5c5f49c](http://image.stephenfang.me/yunnan/48d24d21aa00d5d4e7bc1e3ba5c5f49c.jpeg)\n\n一大早约到了玉龙雪山中午的上山票，于是整个行程可以安排的较为轻松些。\n六点多兴奋的睡不着觉，走上二楼拍了一张早晨的天空，狠狠的呼吸着属于丽江早晨的空气。这个画面几乎是永久性地储存在我的记忆里，文件名大概是是丽江古城。\n\n![f04c219816bdd3bfe2ab16565bc11c39](http://image.stephenfang.me/yunnan/f04c219816bdd3bfe2ab16565bc11c39.jpeg)\n\n\n在红太阳广场遇到了本地人私家车揽客被警察带走的囧事，等待了许久和一对情侣一起坐上了车身写着监督电话的客运小巴。\n一路上健谈的司机都在吐槽「丽江已经不是丽江人的丽江了」，由于政府拿到的投资多为外地人控制，导致不少本地人丢失了工作，如开车上山这件事，在许多年前一直是本地人重要的收入来源，而目前上山的公交车为司机口中的「上海人」所垄断，从事车辆营运需要获得政府的许可，同时政府也不允许司机们口头吆喝。其实这样的事情在全国各地都多有发生，我倒不认为规范营运和所谓的「垄断」是一种坏事，但从某种程度上而言部分本地人赖以维持生计的权益确实收到了侵害。\n\n![08c598b790ebfa3719b52f832fdabbe3](http://image.stephenfang.me/yunnan/08c598b790ebfa3719b52f832fdabbe3.jpeg)\n\n在快到达玉龙雪山的地方有一个收费站，进山需要缴纳小一百元，目前仍然维持着停车人工买票的经营模式，效率十分低下，国庆期间卡在这个流程大概得有半个小时之久，真希望当地部门能认真把这个流程优化一下，但整个进山过程中的路大多是平坦而宽阔的，如果是自驾会有比较好的驾驶体验（如果不考虑之后的停车成本）。\n![6660eb08e1d26b5a0659f59b2f5e2420](http://image.stephenfang.me/yunnan/6660eb08e1d26b5a0659f59b2f5e2420.jpeg)\n![a87fd3ce6194d05bac05f3b2a25eadfb](http://image.stephenfang.me/yunnan/a87fd3ce6194d05bac05f3b2a25eadfb.jpeg)\n\n在古城外20元买了中型的氧气罐，足够支撑上山使用了，晚上其实并没有休息好但事实证明登上4680打卡点并没有那么劳累，必要的时候吸上几口氧气就能缓解略微头晕的症状，但还是不建议以比较快的速度登顶。\n\n![316100ee6464e5da3b992e9067d49e08](http://image.stephenfang.me/yunnan/316100ee6464e5da3b992e9067d49e08.jpeg)\n\n天公不作美，甚至伴着一点小雨，没有欣赏到雪山远处的美景，只见之处都是灰茫茫的一片。\n![cc978145478ad3e23a52935829d89939](http://image.stephenfang.me/yunnan/cc978145478ad3e23a52935829d89939.jpeg)\n\n休息处的核桃饼还蛮值得一试，10块钱的价格勉强可以把午饭解决。\n\n![704d2973e79389ad94887d6134a716c8](http://image.stephenfang.me/yunnan/704d2973e79389ad94887d6134a716c8.jpeg)\n\n下山前往蓝月谷的路程有了中国式旅游那味儿，上车睡觉下车拍照。从蓝月谷有很多平台可以望向远处的雪山，就什么也不做搁那儿坐着也十分惬意。\n\n![2acfd9c02a752ea35fb36dac8a3e200f](http://image.stephenfang.me/yunnan/2acfd9c02a752ea35fb36dac8a3e200f.jpeg)\n\n来云南第一次吃上与菇有关的菜，云南菜大概是中油重盐，也或许是店家做的有点问题，吃这一碗饭我喝了整整五杯水仍不解渴，但饭的味道还是不错的，以后不想再尝试了。\n之所以吃上商场里的这家店是因为没排上大众点评上那家知名的云南菜馆，票据上写着过号顺延，紧赶慢赶到达等来的是服务员的一句前面有客人闹了不给号了，瞬间感觉服务水平摆在这儿，这家店也不会太好吃。\n\n![57ec94ff173d417e84f559ab75e353c9](http://image.stephenfang.me/yunnan/57ec94ff173d417e84f559ab75e353c9.jpeg)\n\n陪同学去星巴克处理了一些工作，回到民宿已经是10点多了。古城里的星巴克格外的安静，要想这可是国庆期间，上了二楼找一个位置坐下，听不到一点吵闹。\n民宿的书架上放了不少供取阅的「真书」，老板似乎是一对建筑师夫妻，我花了一个小时翻完了这本《MUJI HOME》，不知道中国的一二线城市房地产发展会不会在之后也走上日本的老路，年轻人在思想上也有所转变，一些老房子经过适当的装修也能够化腐朽为神奇，按照自己的想法装修自己的家绝对是一件非常幸福的事情。\n\n# 第三天\n![61a143f375f819ee4186829a62215429](http://image.stephenfang.me/yunnan/61a143f375f819ee4186829a62215429.jpeg)\n离开丽江前去了在民宿看的旅游书里推荐的黑龙潭公园，这个公园给我的感觉实在是过于好了，我愿意将其称为丽江人民公园。相较于茶马古道这些商业化的景点，我觉得来看看当地人会去的地方或许更有意义，旅游书诚不欺我。\n\n![a8c5c140d69f1154cbda5277e92f039c](http://image.stephenfang.me/yunnan/a8c5c140d69f1154cbda5277e92f039c.jpeg)\n\n在这里可以看到丽江古城的变迁摄影展，可以看到年轻人在河边挥洒着画笔，还可以看到当地居民缅怀的一位官员。\n\n![4651b6bb2e85a93273df870e4a60045c](http://image.stephenfang.me/yunnan/4651b6bb2e85a93273df870e4a60045c.jpeg)\n\n从古城打车去火车站也没有花上太久的时间，丽江站的外形还是很有地方特色的，内部建设就是典型的小型站，类似于之前去过的富阳站、瑞安站。\n\n![6b21b5f176b03681159c0a1c7a5a58e4](http://image.stephenfang.me/yunnan/6b21b5f176b03681159c0a1c7a5a58e4.jpeg)\n\n国庆期间出游另一个坏处就是会遇上各种各样的人，先有一对情侣要求和我换靠窗的位置，后有熊孩子在后座踢椅子，他们的家长不仅坐视不管还一直叽叽喳喳交谈。这趟高铁并没有给我留下比较好的印象。\n\n由于来大理也是临时决定，在大理入住的民宿就没有丽江那么宜居，宣传的海景民宿在二层根本不用指望能看到海，房间里放着积灰严重的洗衣机也没有提供洗衣粉，客厅放了一个杆子弯的网红日落灯，除了一本影集是真的书，书架上就全是标准廉价装修的假书了。最离谱的是退房后客服还强行要求给五星好评，给我恶心坏了。\n\n![108d5fd13d35506b472ed33f9a2497f9](http://image.stephenfang.me/yunnan/108d5fd13d35506b472ed33f9a2497f9.jpeg)\n\n大理应该是旅游开发和经济发展都比较好的城市了，最明显的感受是商场比丽江的上档次不少，晚饭必须把菌菇火锅安排上。这间店也有不少本地人来吃，价格基本也和大城市平齐了，好在服务不错、干净卫生。菌菇确实如宣传那般鲜，吃完也没有躺板板，安全下车，这也或许是我在云南吃过最满意的一顿。\n\n![2e1f673192e99c97b4910d7aab1e75e6](http://image.stephenfang.me/yunnan/2e1f673192e99c97b4910d7aab1e75e6.jpeg)\n\n来大理之前就在冲浪的时候看到了不少租车环海的视频，我们自然也想享受这个待遇。国庆期间的溢价还是过于严重了，一辆甲壳虫一天的租金超出了500元，所谓丰田才是真正的生活，花了300多元租了一辆雷凌。\n当地的商家估计也就准备等着这个时候赚一票，不在这个时候发力疫情期间的业绩会差很多。\n\n![ce2006588d71ddde28cb01a190c03ae2](http://image.stephenfang.me/yunnan/ce2006588d71ddde28cb01a190c03ae2.jpeg)\n\n晚上和同伴开车去了一趟大理古城，在民宿闲着也是闲着。嘴上是说着去完丽江古城再也不去古城，结果是自己又把自己坑了，更何况是在国庆期间毫无旅游体验。唯一让我感到值得的就是城内城外的一些古建筑，没有在大理找到博物馆这样的公共设施，我是记得在历史上有大理国这样的存在，但在大理没有系统的了解过这边的历史。\n\n# 第四天\n\n![3290cecf78f33c0e065609cde15b6de7](http://image.stephenfang.me/yunnan/3290cecf78f33c0e065609cde15b6de7.jpeg)\n在同伴的一个朋友推荐下，我们起了个大早来到体育馆边上的湿地公园看日出。整个公园的视野非常开阔，除了随风轻拂的草还有许多叫不出名的鸟类，远远看和整个天空慢慢被照亮，欣喜油然而生。\n\n![30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c](http://image.stephenfang.me/yunnan/30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c.jpeg)\n\n在湿地公园碰到了一位来拍延时的当地大叔，他自称是在这里看日出的常客。大叔就拍摄的机位和大理的游览线路做了一些推荐，包括绕海的线路可以倒着来，事实上这条建议帮了我们大忙，避免了国庆期间堵车的风险。\n\n![51079b511ac7f74a0fe197abda5541d3](http://image.stephenfang.me/yunnan/51079b511ac7f74a0fe197abda5541d3.jpeg)\n\n大叔说洱海是值得细细品味的，我现在也认同他说的这句话，洱海在大理人心中的地位不亚于西湖在杭州人心中的地位。\n\n![4a313a162a1f22dc95af102404a712f7](http://image.stephenfang.me/yunnan/4a313a162a1f22dc95af102404a712f7.jpeg)\n\n来云南几天看到过不少的饵丝招牌却一直不知是何物，既然起了个大早就不能放弃吃早饭的机会，遂驱车20分钟赶往附近的一条老街。大理相较于丽江公共交通的体系还是相当完善的，但如果能在大理租车出行上的体验会是翻倍的。\n\n饵丝是由饵块演变出来的，饵块切丝便做成了饵丝，可以理解成口感不同的米线，饵丝的硬度会更扎实，加上各种料味道还算不错。\n\n![c5e72ddcf812bb34166acb276181cfeb](http://image.stephenfang.me/yunnan/c5e72ddcf812bb34166acb276181cfeb.jpeg)\n\n回到民宿还只是早上8点多，稍作休息将行李搬运到车上就正式开始了今天的自驾游。\n云南的天渲染的比游戏里还蓝，一路上心情都十分愉悦，硬要说有什么不好就是日照过于充足隔一段时间就需要补一下防晒。\n\n![beaaf91430d33942c6d443f4cebd0d4a](http://image.stephenfang.me/yunnan/beaaf91430d33942c6d443f4cebd0d4a.jpeg)\n![072c7b06cde8ef5dc980cebf835dc163](http://image.stephenfang.me/yunnan/072c7b06cde8ef5dc980cebf835dc163.jpeg)\n\n不少80后会选择来大理寻找自由，这句话放在90后身上也不过时。中饭是在双廊的一家音乐餐厅解决的，价格基本上与一线城市物价持平，吉他小哥大概是李志的迷弟，弹唱了很多逼哥的冷门歌曲，再配合这般景致这顿饭吃的蛮值得。\n\n![cf832aeed47083beeca1bfcc88230025](http://image.stephenfang.me/yunnan/cf832aeed47083beeca1bfcc88230025.jpeg)\n\n三塔是大叔推荐的景点，当时查阅了一下维基百科就决定去了。\n\n> 崇圣寺始建于南诏蒙劝丰佑统治时期（公元823～859年），在大理国时期扩展为890间屋子、11400尊佛像、三阁、七楼、九殿及百厦，被称为“佛都”。大理国22代国王中，就先后有9位到崇圣寺出家为僧。\n> \n> 崇圣寺曾有五大重器：三塔、南诏建极大钟、雨铜观音铜像、元代高僧圆护大师书写的“证道歌碑”及“佛都匾”、明代的“三圣金像”。崇圣寺经明清战争、清军围剿杜文秀、文化大革命等浩劫最终被毁，五大重器只剩下三塔。\n\n![0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c](http://image.stephenfang.me/yunnan/0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c.jpeg)\n\n由于时间上不太充裕没有爬上苍山俯瞰三塔，但三塔的气魄着实给我还是留下了很深的印象。从崇圣寺等级最高的中心建筑大雄宝殿可以俯瞰整个洱海，符合石牌坊上「山海大观」这四个字。需要注意的这个景点有高铁票证明是可以享受折半票价的，非常值得一来。\n\n![5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a](http://image.stephenfang.me/yunnan/5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a.heic)\n\n这次旅行的景点路线基本都是当天决定的，基本没有心理上的负担，虽然赶来赶去还会有些疲乏，但比以前有计划性的出行要惬意不少。\n\n![90926a9797e2ec14b83e09df8b4299d2](http://image.stephenfang.me/yunnan/90926a9797e2ec14b83e09df8b4299d2.jpeg)\n\n大理到昆明其实有高铁直达，而从丽江到昆明有K9634号豪华卧铺车。我和同伴都从未坐过卧铺车，当时一拍脑袋就决定试试坐一晚上的卧铺，第二天醒来就已经在昆明了，还能剩下一晚的房钱。事实上这趟车票价非常高，一路上多是走走停停，但如果是为了体验也无妨性价比。\n\n![ef6bea43d3d26a1624ebccb97a30ebb3](http://image.stephenfang.me/yunnan/ef6bea43d3d26a1624ebccb97a30ebb3.jpeg)\n![2e42842beac0ba05459cdb5d294de2d6](http://image.stephenfang.me/yunnan/2e42842beac0ba05459cdb5d294de2d6.jpeg)\n\n昆明客运段这趟车的宣传还是不错的，车厢内十分整洁，毯子被子枕头该有的一个不少，承诺有的设施如K房、餐车也都有，但我没有up主那种社交技能只是走马观花逛了一圈。只要你不抱有洗澡的念头卧铺还是不错的。\n\n# 第五天\n与我同车厢的有一对武汉来的情侣，还有一位在深圳工作的毕业生，我们一直聊到12点多也没有一点不适，话题包括了这几天的所见所闻，交换了各自对旅行的看法。与我差不多大的毕业生刚从香格里拉徒步回来，我还蛮羡慕这种旅行方式，但自己没有这种魄力。\n卧铺旅行的感受就像是抽盲盒，同行的小伙伴就没有那么幸运，被抽到的车厢里大家互不交谈，还被请求换了铺位。\n\n![9504afa8c61a7633bf37c39002d915cb](http://image.stephenfang.me/yunnan/9504afa8c61a7633bf37c39002d915cb.jpeg)\n\n一觉醒来已是8点，进行了简单的洗漱后泡上了火车站买的方便面。一晚上车厢略有颠簸但睡得挺香，发呆看着窗外城市的轮廓越来越接近。\n\n![af993427107372b2886b63b7c9c396c0](http://image.stephenfang.me/yunnan/af993427107372b2886b63b7c9c396c0.jpeg)\n\n到达昆明站的时候终于有了一缕阳光，工作中9点起床的日子久了已经没有了早晨身体被唤醒的感觉，拎着行李走过站台感觉不到一丝疲惫。\n\n![d42fba4b5eff5a699e567ca8d36f3c63](http://image.stephenfang.me/yunnan/d42fba4b5eff5a699e567ca8d36f3c63.jpeg)\n\n联系上了Airbnb上昆明的房东，由于不能提前入住，房东给我们打点了一间存放行李的屋子，安放妥当后就坐上出租车去往了必到的景点——滇池。\n这个季节的滇池和我想象中的有很大出入，首先海鸥要在冬季才能见到，其次滇池的水是碧绿碧绿的，作为一个刚从大理来的人我觉得还是洱海更胜一筹。\n\n![46757eadeec04da52def179f08bd4668](http://image.stephenfang.me/yunnan/46757eadeec04da52def179f08bd4668.jpeg)\n\n来春城前我最想去的景点是西南联大博物馆，最近也在读重走西南联大，对此景点期许有加。事实上目前整个建筑是云南师范大学的一部分，在疫情期间不再对外开放，等到达师范大学门口的时候失望到达了顶点。\n只能在学校附近找了一家米线店安抚一下自己，点了一碗状元米线还送了一碗汽锅鸡，整个吃米线的过程仪式感很足。\n\n![4904f2c886474b702ec5da3cdf7b2258](http://image.stephenfang.me/yunnan/4904f2c886474b702ec5da3cdf7b2258.jpeg)\n\n昆明的地铁饮料几乎是被百事承包了，这个橘味的微笑泡泡在杭州我从未见过，喝起来和芬达的味道非常相似。\n\n![32e8d9681f300e3335b74c1b8aa1a2b5](http://image.stephenfang.me/yunnan/32e8d9681f300e3335b74c1b8aa1a2b5.jpeg)\n![b18fec1a67bac4a8a609d80d6ad46b83](http://image.stephenfang.me/yunnan/b18fec1a67bac4a8a609d80d6ad46b83.jpeg)\n\n春城的花市是很有名的，在这里能够以极低的价格采购到鲜花并且当天快递发货，多肉也都是白菜价十块钱能买到品种不同的四五株，把这里当作一个景点来逛也非常合适。\n\n![d999d61dfe2d1e2749c967e131b44192](http://image.stephenfang.me/yunnan/d999d61dfe2d1e2749c967e131b44192.jpeg)\n\n每个地方都有每个地方的人民广场，丽江是黑龙潭广场，昆明便是翠湖公园，配合着还潮乐队的《慈城公园交谊舞》整个散步的过程都惬意了不少。\n\n![2e182c6678ec1152380f6ec24ee58f60](http://image.stephenfang.me/yunnan/2e182c6678ec1152380f6ec24ee58f60.jpeg)\n\n云倒映在水潭里的样子还蛮好看的，可能去公园走走在年轻人看来依旧是一种老掉牙的行为吧。\n\n![977c252e72092f9da3a94edf9c4ef98c](http://image.stephenfang.me/yunnan/977c252e72092f9da3a94edf9c4ef98c.jpeg)\n\n昆明有许多博物馆，包括云南省博、昆明市博、云南民族博物馆、铁路博物馆，每一个我都很想去。当天没能进去西南联大博物馆，又没能约上陆军讲武堂，第二天就要从这座城市离开了。\n花了半小时研究翠湖公园附近的可去之处来度过这个下午，发现公园的出口就有一个砖石结构的法式建筑，是前云南省主席卢汉的住宅。\n\n![bc57c0074c571a7efaeea3c883024211](http://image.stephenfang.me/yunnan/bc57c0074c571a7efaeea3c883024211.jpeg)\n\n![c5720fb9d797408c126bbcd968cd7ea7](http://image.stephenfang.me/yunnan/c5720fb9d797408c126bbcd968cd7ea7.jpeg)\n\n卢汉公馆的参观过程十分有序，严格限制了同时参观人数。这个建筑见证了昆明和平起义，保留十分完好，装修风格非常豪华，庭院的形制与电视里看过的民国电视剧里的大户人家宅邸几乎一致。\n\n![e963ec748d29ef90eae9b24d3535d898](http://image.stephenfang.me/yunnan/e963ec748d29ef90eae9b24d3535d898.jpeg)\n\n由于有些不甘心没去成博物馆，况且离饭点还有不少时间，就打车去云南市博溜达了一圈。馆内整体设施都比较陈旧了，三个展中关于飞虎队的展览挺有意思，看到了迪士尼给飞虎队设计的Logo。\n\n![d7335431c71cb8fef2427fc7879ac848](http://image.stephenfang.me/yunnan/d7335431c71cb8fef2427fc7879ac848.jpeg)\n\n从滇池载我们回来的当地司机推荐给我们的饭馆叫外婆味道，这家店的菜还蛮对江浙人胃口，性价比也足够高，79元的套餐内有三个菜。干锅包菜的名字叫手撕莲花白还蛮意外的，套餐外另点的豆腐也非常好吃，可能是除火锅外在云南吃的最舒心的一顿。\n\n![c3777d824991be041e7b7af642017f43](http://image.stephenfang.me/yunnan/c3777d824991be041e7b7af642017f43.jpeg)\n![562ce2e3de9e87a94fbde1b4e1dd14e3](http://image.stephenfang.me/yunnan/562ce2e3de9e87a94fbde1b4e1dd14e3.jpeg)\n\n这家店是连锁店，我们选的这家在比较市中心的位置了，走上个几百米就是恒隆广场。整个昆明的高楼并不是很多，走上恒隆的观景台看昆明的天际线（并不是）还蛮开心的，心里却想着是第二天就要赶回去上班了还没有好好放松。\n\n![030e7c01c93a7b0b8dbcfa893440cf94](http://image.stephenfang.me/yunnan/030e7c01c93a7b0b8dbcfa893440cf94.jpeg)\n![0b4718d1a680f3f5b69c632195d5387a](http://image.stephenfang.me/yunnan/0b4718d1a680f3f5b69c632195d5387a.jpeg)\n\n我们住的民宿可以远眺昆明的市中心。开上一瓶恒隆买的果酒，在旅行的倒数第二天，总算是可以歇下来整理照片玩会儿游戏了。\n\n# 第六天\n\n![48c733ee259ed52252243a3979983a6c](http://image.stephenfang.me/yunnan/48c733ee259ed52252243a3979983a6c.jpeg)\n\n一大早在车笛声中醒来，就准备着和云南道别了。\n\n![c2b58a28831d3b476798e23ba616bf0c](http://image.stephenfang.me/yunnan/c2b58a28831d3b476798e23ba616bf0c.jpeg)\n\n今天的安排只安排了一个目的地，就是云南省博物馆。\n在省级博物馆中我已经打卡过了浙江省博、湖北省博、广东省博、上海市博，几乎每个博物馆都有和国家宝藏的梦幻联动，为参观的过程添加了许多趣味。云南省博物馆的外立面取意于云南传统民居“一颗印”，外形源自石林风化地貌特征。\n\n![8af47fc3fb3fe1ef67dd6b8efd5742be](http://image.stephenfang.me/yunnan/8af47fc3fb3fe1ef67dd6b8efd5742be.jpeg)\n\n三层的展览一上午根本来不及看完，为了尽可能多的看到展品，只能走马观花式的有选择性的看了一圈。精美如这件贝器盖，远看有些像小时候玩的工兵，实则表现的是滇族与昆明族军队交战。\n\n![f1eade5b620f110d31ad54902fb8e5d2](http://image.stephenfang.me/yunnan/f1eade5b620f110d31ad54902fb8e5d2.jpeg)\n\n这件与博物馆前巨型雕塑一致的金翅鸟自然来头不小，以下是摘录对它的描述。\n\n> 宋代大理国银鎏金镶珠金翅鸟，1978年出土于大理崇圣寺主塔。金翅鸟梵名为“迦楼罗”，被尊为大理的保护神，是佛教护法中的天龙八部之一。传说金翅鸟原来十分凶悍，以龙为食。后来金翅鸟皈依佛教，成为了佛教的护法神。这只金翅鸟头饰羽冠，两只利爪立于莲座之上。镂花火焰形背光插在尾身之间，镶饰有5粒水晶珠。体态雄健圆浑，生机勃勃，工艺可谓精美绝伦。\n\n![1d0d2098ad7d1fb5b380aeb17dd1aa3c](http://image.stephenfang.me/yunnan/1d0d2098ad7d1fb5b380aeb17dd1aa3c.jpeg)\n\n价值连城的宝物还有不少，工艺精湛的如这件明代金镶红蓝宝石冠，值得驻足许久欣赏。\n\n![37beddf0ed48d168e6423345197cf381](http://image.stephenfang.me/yunnan/37beddf0ed48d168e6423345197cf381.jpeg)\n\n\n结束了博物馆的游览整个云南之旅也就告一段落了，几年前转机经过昆明长水机场，心里想着以后还会来到这里，如今算是了却了这个念想，一点都不感到意外。以后还会不会来昆明不好说，但一定会再来到云南去更多的城市走走看看。","source":"_posts/Yunnan_Travelling.md","raw":"---\ntitle: 云南旅行流水账\ndate: 2022-02-20 16:00:00\ncategories: \n- 生活\ntags: \n- 旅行\n- 云南\n- 中国\ncopyright: true\n---\n\n去年国庆期间和朋友一起去了趟云南，起初安排的路线是 **丽江 -> 香格里拉 -> 泸沽湖 -> 昆明**，在旅程中我们从时间和成本上考量，加上路人给予的一些建议，最终的路线是 **丽江 -> 大理 -> 昆明**。\n\n由于工作较忙一直没有时间整理旅行中的见闻，最近在整理博客的时候静下心来完善之前写的日记，花了一下午将六天的经历整理成一片流水账，发表在个人博客上图一乐。\n\n<!--more-->\n\n# 第一天\n为了让旅程显得没有那么劳累，特地选择了一个出发时间较晚的航班，同时为了节省费用，预定了需要转机的机票。这次旅行不能说是一时兴起，应该说是弥补了暑假没有毕业旅行的遗憾。\n10点从萧山机场出发，到达丽江已是下午三点，一下飞机就能感受到离天空的距离更近了，作为一个从平原来的人并没有明显感觉空气稀薄了。\n\n![ff6659d985f90f0c02800c28ab472fda](http://image.stephenfang.me/yunnan/ff6659d985f90f0c02800c28ab472fda.jpeg)\n\n这是我第一次来云南。在网上冲浪的时候时常能刷到云南的名山大川，也想着有一天能来看看，碰巧朋友对云南也抱着很深的念想。\n对于云南我比较熟悉的是大理、丽江这些旅游城市的名字，时常能在热门旅游排行榜上看到他们的位置，由于同事强烈推荐了泸沽湖，在安排行程的时候我也将其考虑在内。\n在飞机上就能够感受到云南的山是磅礴的，完全不同于江南的柔美风格。\n\n![ebf28efdfe345106d0894026adf5c5d7](http://image.stephenfang.me/yunnan/ebf28efdfe345106d0894026adf5c5d7.jpeg)\n\n从三义机场坐大巴到丽江古城有一个小时的车程。在规划旅程的时候没有特别调查过丽江古城是否那么值得去住下，只是草草在Airbnb上检索和筛选了几家我和同伴都满意的民宿。拎着行李穿过大半个古城，总算到达了我们的民宿。\n\n![e22ae0331bbbd911244cac0de7e40b07](http://image.stephenfang.me/yunnan/e22ae0331bbbd911244cac0de7e40b07.jpeg)\n![095486935be166df4f6d224b8006b0fb](http://image.stephenfang.me/yunnan/095486935be166df4f6d224b8006b0fb.jpeg)\n\n丽江古城的开发不能说好，它在保留着一些古城风貌的同时植入了太多的商业元素，路边的花卉就像是不要钱似的堆积着。让我感到欣慰的就是民宿整体让人满意，里面的配套设施十分扎实，还可以吃到房东准备的高山苹果。\n![](http://image.stephenfang.me/yunnan/16453260665672.jpg)\n\n从民宿的院子里可以痴痴地望上天空好久，在杭州几乎没有看到蓝色饱和度这么高的天空。院子里还有一只慵懒的猫咪在晒太阳，爬上二楼可以望到远处的高山。\n\n![fe0b10442075f57e72b60acdf5ad2b98](http://image.stephenfang.me/yunnan/fe0b10442075f57e72b60acdf5ad2b98.jpeg)\n\n差不多到了吃饭的点，初来乍到怕在古城里被宰，咨询了房东的意见后选择了古城北门附近的一家腊排骨火锅。我和同伴对于腊肉并没有那么钟意，吃前几块的时候感觉是很新奇的味道，再往后吃只能感到油腻，不过望着远山吃饭真的称得上是一种享受。\n\n![356e4921d91f036d68ce3affe6876d23](http://image.stephenfang.me/yunnan/356e4921d91f036d68ce3affe6876d23.jpeg)\n\n大概是在古城里逛了很久才动了回民宿的念头，正遇上两位准备退房的广东大学生。在交谈中得知他们从大理一路玩过来，没有抢到上玉龙雪山的票，正准备赶往下一站。正巧我们也没有决定第二天去哪里玩，本想着去香格里拉——所谓的「小拉萨」朝圣，无奈经费和时间都不太宽裕，不如按部就班去一趟必去的玉龙雪山。\n记忆中两个男生都挺健谈的，给予了我们不少旅行的建议，我认为在旅行中和他人的沟通是旅行中很重要的一部分，和不同行业、不同年龄、不同地方的人对话总会有新的启发。\n\n\tDate:\t2021年10月4日 GMT+8 13:12:03\n\tWeather:\t15 °C Mostly Cloudy\n\tLocation:\t大具乡, 丽江市, 云南省, 中国\n\n# 第二天\n云南的早晨就应该从一碗米线开始。\n考虑到米线的价格不会太贵，这一次没有选择古城外的店铺，而是在古城内参考大众点评选择了一家米线店。这家店生意很旺，来就餐的排队到了院子之外，然而实话说这碗米线的味道只能说十分平淡，烤豆腐做的也烧欠火候，汤头在江浙人看来不能说是鲜。\n\n![48d24d21aa00d5d4e7bc1e3ba5c5f49c](http://image.stephenfang.me/yunnan/48d24d21aa00d5d4e7bc1e3ba5c5f49c.jpeg)\n\n一大早约到了玉龙雪山中午的上山票，于是整个行程可以安排的较为轻松些。\n六点多兴奋的睡不着觉，走上二楼拍了一张早晨的天空，狠狠的呼吸着属于丽江早晨的空气。这个画面几乎是永久性地储存在我的记忆里，文件名大概是是丽江古城。\n\n![f04c219816bdd3bfe2ab16565bc11c39](http://image.stephenfang.me/yunnan/f04c219816bdd3bfe2ab16565bc11c39.jpeg)\n\n\n在红太阳广场遇到了本地人私家车揽客被警察带走的囧事，等待了许久和一对情侣一起坐上了车身写着监督电话的客运小巴。\n一路上健谈的司机都在吐槽「丽江已经不是丽江人的丽江了」，由于政府拿到的投资多为外地人控制，导致不少本地人丢失了工作，如开车上山这件事，在许多年前一直是本地人重要的收入来源，而目前上山的公交车为司机口中的「上海人」所垄断，从事车辆营运需要获得政府的许可，同时政府也不允许司机们口头吆喝。其实这样的事情在全国各地都多有发生，我倒不认为规范营运和所谓的「垄断」是一种坏事，但从某种程度上而言部分本地人赖以维持生计的权益确实收到了侵害。\n\n![08c598b790ebfa3719b52f832fdabbe3](http://image.stephenfang.me/yunnan/08c598b790ebfa3719b52f832fdabbe3.jpeg)\n\n在快到达玉龙雪山的地方有一个收费站，进山需要缴纳小一百元，目前仍然维持着停车人工买票的经营模式，效率十分低下，国庆期间卡在这个流程大概得有半个小时之久，真希望当地部门能认真把这个流程优化一下，但整个进山过程中的路大多是平坦而宽阔的，如果是自驾会有比较好的驾驶体验（如果不考虑之后的停车成本）。\n![6660eb08e1d26b5a0659f59b2f5e2420](http://image.stephenfang.me/yunnan/6660eb08e1d26b5a0659f59b2f5e2420.jpeg)\n![a87fd3ce6194d05bac05f3b2a25eadfb](http://image.stephenfang.me/yunnan/a87fd3ce6194d05bac05f3b2a25eadfb.jpeg)\n\n在古城外20元买了中型的氧气罐，足够支撑上山使用了，晚上其实并没有休息好但事实证明登上4680打卡点并没有那么劳累，必要的时候吸上几口氧气就能缓解略微头晕的症状，但还是不建议以比较快的速度登顶。\n\n![316100ee6464e5da3b992e9067d49e08](http://image.stephenfang.me/yunnan/316100ee6464e5da3b992e9067d49e08.jpeg)\n\n天公不作美，甚至伴着一点小雨，没有欣赏到雪山远处的美景，只见之处都是灰茫茫的一片。\n![cc978145478ad3e23a52935829d89939](http://image.stephenfang.me/yunnan/cc978145478ad3e23a52935829d89939.jpeg)\n\n休息处的核桃饼还蛮值得一试，10块钱的价格勉强可以把午饭解决。\n\n![704d2973e79389ad94887d6134a716c8](http://image.stephenfang.me/yunnan/704d2973e79389ad94887d6134a716c8.jpeg)\n\n下山前往蓝月谷的路程有了中国式旅游那味儿，上车睡觉下车拍照。从蓝月谷有很多平台可以望向远处的雪山，就什么也不做搁那儿坐着也十分惬意。\n\n![2acfd9c02a752ea35fb36dac8a3e200f](http://image.stephenfang.me/yunnan/2acfd9c02a752ea35fb36dac8a3e200f.jpeg)\n\n来云南第一次吃上与菇有关的菜，云南菜大概是中油重盐，也或许是店家做的有点问题，吃这一碗饭我喝了整整五杯水仍不解渴，但饭的味道还是不错的，以后不想再尝试了。\n之所以吃上商场里的这家店是因为没排上大众点评上那家知名的云南菜馆，票据上写着过号顺延，紧赶慢赶到达等来的是服务员的一句前面有客人闹了不给号了，瞬间感觉服务水平摆在这儿，这家店也不会太好吃。\n\n![57ec94ff173d417e84f559ab75e353c9](http://image.stephenfang.me/yunnan/57ec94ff173d417e84f559ab75e353c9.jpeg)\n\n陪同学去星巴克处理了一些工作，回到民宿已经是10点多了。古城里的星巴克格外的安静，要想这可是国庆期间，上了二楼找一个位置坐下，听不到一点吵闹。\n民宿的书架上放了不少供取阅的「真书」，老板似乎是一对建筑师夫妻，我花了一个小时翻完了这本《MUJI HOME》，不知道中国的一二线城市房地产发展会不会在之后也走上日本的老路，年轻人在思想上也有所转变，一些老房子经过适当的装修也能够化腐朽为神奇，按照自己的想法装修自己的家绝对是一件非常幸福的事情。\n\n# 第三天\n![61a143f375f819ee4186829a62215429](http://image.stephenfang.me/yunnan/61a143f375f819ee4186829a62215429.jpeg)\n离开丽江前去了在民宿看的旅游书里推荐的黑龙潭公园，这个公园给我的感觉实在是过于好了，我愿意将其称为丽江人民公园。相较于茶马古道这些商业化的景点，我觉得来看看当地人会去的地方或许更有意义，旅游书诚不欺我。\n\n![a8c5c140d69f1154cbda5277e92f039c](http://image.stephenfang.me/yunnan/a8c5c140d69f1154cbda5277e92f039c.jpeg)\n\n在这里可以看到丽江古城的变迁摄影展，可以看到年轻人在河边挥洒着画笔，还可以看到当地居民缅怀的一位官员。\n\n![4651b6bb2e85a93273df870e4a60045c](http://image.stephenfang.me/yunnan/4651b6bb2e85a93273df870e4a60045c.jpeg)\n\n从古城打车去火车站也没有花上太久的时间，丽江站的外形还是很有地方特色的，内部建设就是典型的小型站，类似于之前去过的富阳站、瑞安站。\n\n![6b21b5f176b03681159c0a1c7a5a58e4](http://image.stephenfang.me/yunnan/6b21b5f176b03681159c0a1c7a5a58e4.jpeg)\n\n国庆期间出游另一个坏处就是会遇上各种各样的人，先有一对情侣要求和我换靠窗的位置，后有熊孩子在后座踢椅子，他们的家长不仅坐视不管还一直叽叽喳喳交谈。这趟高铁并没有给我留下比较好的印象。\n\n由于来大理也是临时决定，在大理入住的民宿就没有丽江那么宜居，宣传的海景民宿在二层根本不用指望能看到海，房间里放着积灰严重的洗衣机也没有提供洗衣粉，客厅放了一个杆子弯的网红日落灯，除了一本影集是真的书，书架上就全是标准廉价装修的假书了。最离谱的是退房后客服还强行要求给五星好评，给我恶心坏了。\n\n![108d5fd13d35506b472ed33f9a2497f9](http://image.stephenfang.me/yunnan/108d5fd13d35506b472ed33f9a2497f9.jpeg)\n\n大理应该是旅游开发和经济发展都比较好的城市了，最明显的感受是商场比丽江的上档次不少，晚饭必须把菌菇火锅安排上。这间店也有不少本地人来吃，价格基本也和大城市平齐了，好在服务不错、干净卫生。菌菇确实如宣传那般鲜，吃完也没有躺板板，安全下车，这也或许是我在云南吃过最满意的一顿。\n\n![2e1f673192e99c97b4910d7aab1e75e6](http://image.stephenfang.me/yunnan/2e1f673192e99c97b4910d7aab1e75e6.jpeg)\n\n来大理之前就在冲浪的时候看到了不少租车环海的视频，我们自然也想享受这个待遇。国庆期间的溢价还是过于严重了，一辆甲壳虫一天的租金超出了500元，所谓丰田才是真正的生活，花了300多元租了一辆雷凌。\n当地的商家估计也就准备等着这个时候赚一票，不在这个时候发力疫情期间的业绩会差很多。\n\n![ce2006588d71ddde28cb01a190c03ae2](http://image.stephenfang.me/yunnan/ce2006588d71ddde28cb01a190c03ae2.jpeg)\n\n晚上和同伴开车去了一趟大理古城，在民宿闲着也是闲着。嘴上是说着去完丽江古城再也不去古城，结果是自己又把自己坑了，更何况是在国庆期间毫无旅游体验。唯一让我感到值得的就是城内城外的一些古建筑，没有在大理找到博物馆这样的公共设施，我是记得在历史上有大理国这样的存在，但在大理没有系统的了解过这边的历史。\n\n# 第四天\n\n![3290cecf78f33c0e065609cde15b6de7](http://image.stephenfang.me/yunnan/3290cecf78f33c0e065609cde15b6de7.jpeg)\n在同伴的一个朋友推荐下，我们起了个大早来到体育馆边上的湿地公园看日出。整个公园的视野非常开阔，除了随风轻拂的草还有许多叫不出名的鸟类，远远看和整个天空慢慢被照亮，欣喜油然而生。\n\n![30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c](http://image.stephenfang.me/yunnan/30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c.jpeg)\n\n在湿地公园碰到了一位来拍延时的当地大叔，他自称是在这里看日出的常客。大叔就拍摄的机位和大理的游览线路做了一些推荐，包括绕海的线路可以倒着来，事实上这条建议帮了我们大忙，避免了国庆期间堵车的风险。\n\n![51079b511ac7f74a0fe197abda5541d3](http://image.stephenfang.me/yunnan/51079b511ac7f74a0fe197abda5541d3.jpeg)\n\n大叔说洱海是值得细细品味的，我现在也认同他说的这句话，洱海在大理人心中的地位不亚于西湖在杭州人心中的地位。\n\n![4a313a162a1f22dc95af102404a712f7](http://image.stephenfang.me/yunnan/4a313a162a1f22dc95af102404a712f7.jpeg)\n\n来云南几天看到过不少的饵丝招牌却一直不知是何物，既然起了个大早就不能放弃吃早饭的机会，遂驱车20分钟赶往附近的一条老街。大理相较于丽江公共交通的体系还是相当完善的，但如果能在大理租车出行上的体验会是翻倍的。\n\n饵丝是由饵块演变出来的，饵块切丝便做成了饵丝，可以理解成口感不同的米线，饵丝的硬度会更扎实，加上各种料味道还算不错。\n\n![c5e72ddcf812bb34166acb276181cfeb](http://image.stephenfang.me/yunnan/c5e72ddcf812bb34166acb276181cfeb.jpeg)\n\n回到民宿还只是早上8点多，稍作休息将行李搬运到车上就正式开始了今天的自驾游。\n云南的天渲染的比游戏里还蓝，一路上心情都十分愉悦，硬要说有什么不好就是日照过于充足隔一段时间就需要补一下防晒。\n\n![beaaf91430d33942c6d443f4cebd0d4a](http://image.stephenfang.me/yunnan/beaaf91430d33942c6d443f4cebd0d4a.jpeg)\n![072c7b06cde8ef5dc980cebf835dc163](http://image.stephenfang.me/yunnan/072c7b06cde8ef5dc980cebf835dc163.jpeg)\n\n不少80后会选择来大理寻找自由，这句话放在90后身上也不过时。中饭是在双廊的一家音乐餐厅解决的，价格基本上与一线城市物价持平，吉他小哥大概是李志的迷弟，弹唱了很多逼哥的冷门歌曲，再配合这般景致这顿饭吃的蛮值得。\n\n![cf832aeed47083beeca1bfcc88230025](http://image.stephenfang.me/yunnan/cf832aeed47083beeca1bfcc88230025.jpeg)\n\n三塔是大叔推荐的景点，当时查阅了一下维基百科就决定去了。\n\n> 崇圣寺始建于南诏蒙劝丰佑统治时期（公元823～859年），在大理国时期扩展为890间屋子、11400尊佛像、三阁、七楼、九殿及百厦，被称为“佛都”。大理国22代国王中，就先后有9位到崇圣寺出家为僧。\n> \n> 崇圣寺曾有五大重器：三塔、南诏建极大钟、雨铜观音铜像、元代高僧圆护大师书写的“证道歌碑”及“佛都匾”、明代的“三圣金像”。崇圣寺经明清战争、清军围剿杜文秀、文化大革命等浩劫最终被毁，五大重器只剩下三塔。\n\n![0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c](http://image.stephenfang.me/yunnan/0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c.jpeg)\n\n由于时间上不太充裕没有爬上苍山俯瞰三塔，但三塔的气魄着实给我还是留下了很深的印象。从崇圣寺等级最高的中心建筑大雄宝殿可以俯瞰整个洱海，符合石牌坊上「山海大观」这四个字。需要注意的这个景点有高铁票证明是可以享受折半票价的，非常值得一来。\n\n![5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a](http://image.stephenfang.me/yunnan/5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a.heic)\n\n这次旅行的景点路线基本都是当天决定的，基本没有心理上的负担，虽然赶来赶去还会有些疲乏，但比以前有计划性的出行要惬意不少。\n\n![90926a9797e2ec14b83e09df8b4299d2](http://image.stephenfang.me/yunnan/90926a9797e2ec14b83e09df8b4299d2.jpeg)\n\n大理到昆明其实有高铁直达，而从丽江到昆明有K9634号豪华卧铺车。我和同伴都从未坐过卧铺车，当时一拍脑袋就决定试试坐一晚上的卧铺，第二天醒来就已经在昆明了，还能剩下一晚的房钱。事实上这趟车票价非常高，一路上多是走走停停，但如果是为了体验也无妨性价比。\n\n![ef6bea43d3d26a1624ebccb97a30ebb3](http://image.stephenfang.me/yunnan/ef6bea43d3d26a1624ebccb97a30ebb3.jpeg)\n![2e42842beac0ba05459cdb5d294de2d6](http://image.stephenfang.me/yunnan/2e42842beac0ba05459cdb5d294de2d6.jpeg)\n\n昆明客运段这趟车的宣传还是不错的，车厢内十分整洁，毯子被子枕头该有的一个不少，承诺有的设施如K房、餐车也都有，但我没有up主那种社交技能只是走马观花逛了一圈。只要你不抱有洗澡的念头卧铺还是不错的。\n\n# 第五天\n与我同车厢的有一对武汉来的情侣，还有一位在深圳工作的毕业生，我们一直聊到12点多也没有一点不适，话题包括了这几天的所见所闻，交换了各自对旅行的看法。与我差不多大的毕业生刚从香格里拉徒步回来，我还蛮羡慕这种旅行方式，但自己没有这种魄力。\n卧铺旅行的感受就像是抽盲盒，同行的小伙伴就没有那么幸运，被抽到的车厢里大家互不交谈，还被请求换了铺位。\n\n![9504afa8c61a7633bf37c39002d915cb](http://image.stephenfang.me/yunnan/9504afa8c61a7633bf37c39002d915cb.jpeg)\n\n一觉醒来已是8点，进行了简单的洗漱后泡上了火车站买的方便面。一晚上车厢略有颠簸但睡得挺香，发呆看着窗外城市的轮廓越来越接近。\n\n![af993427107372b2886b63b7c9c396c0](http://image.stephenfang.me/yunnan/af993427107372b2886b63b7c9c396c0.jpeg)\n\n到达昆明站的时候终于有了一缕阳光，工作中9点起床的日子久了已经没有了早晨身体被唤醒的感觉，拎着行李走过站台感觉不到一丝疲惫。\n\n![d42fba4b5eff5a699e567ca8d36f3c63](http://image.stephenfang.me/yunnan/d42fba4b5eff5a699e567ca8d36f3c63.jpeg)\n\n联系上了Airbnb上昆明的房东，由于不能提前入住，房东给我们打点了一间存放行李的屋子，安放妥当后就坐上出租车去往了必到的景点——滇池。\n这个季节的滇池和我想象中的有很大出入，首先海鸥要在冬季才能见到，其次滇池的水是碧绿碧绿的，作为一个刚从大理来的人我觉得还是洱海更胜一筹。\n\n![46757eadeec04da52def179f08bd4668](http://image.stephenfang.me/yunnan/46757eadeec04da52def179f08bd4668.jpeg)\n\n来春城前我最想去的景点是西南联大博物馆，最近也在读重走西南联大，对此景点期许有加。事实上目前整个建筑是云南师范大学的一部分，在疫情期间不再对外开放，等到达师范大学门口的时候失望到达了顶点。\n只能在学校附近找了一家米线店安抚一下自己，点了一碗状元米线还送了一碗汽锅鸡，整个吃米线的过程仪式感很足。\n\n![4904f2c886474b702ec5da3cdf7b2258](http://image.stephenfang.me/yunnan/4904f2c886474b702ec5da3cdf7b2258.jpeg)\n\n昆明的地铁饮料几乎是被百事承包了，这个橘味的微笑泡泡在杭州我从未见过，喝起来和芬达的味道非常相似。\n\n![32e8d9681f300e3335b74c1b8aa1a2b5](http://image.stephenfang.me/yunnan/32e8d9681f300e3335b74c1b8aa1a2b5.jpeg)\n![b18fec1a67bac4a8a609d80d6ad46b83](http://image.stephenfang.me/yunnan/b18fec1a67bac4a8a609d80d6ad46b83.jpeg)\n\n春城的花市是很有名的，在这里能够以极低的价格采购到鲜花并且当天快递发货，多肉也都是白菜价十块钱能买到品种不同的四五株，把这里当作一个景点来逛也非常合适。\n\n![d999d61dfe2d1e2749c967e131b44192](http://image.stephenfang.me/yunnan/d999d61dfe2d1e2749c967e131b44192.jpeg)\n\n每个地方都有每个地方的人民广场，丽江是黑龙潭广场，昆明便是翠湖公园，配合着还潮乐队的《慈城公园交谊舞》整个散步的过程都惬意了不少。\n\n![2e182c6678ec1152380f6ec24ee58f60](http://image.stephenfang.me/yunnan/2e182c6678ec1152380f6ec24ee58f60.jpeg)\n\n云倒映在水潭里的样子还蛮好看的，可能去公园走走在年轻人看来依旧是一种老掉牙的行为吧。\n\n![977c252e72092f9da3a94edf9c4ef98c](http://image.stephenfang.me/yunnan/977c252e72092f9da3a94edf9c4ef98c.jpeg)\n\n昆明有许多博物馆，包括云南省博、昆明市博、云南民族博物馆、铁路博物馆，每一个我都很想去。当天没能进去西南联大博物馆，又没能约上陆军讲武堂，第二天就要从这座城市离开了。\n花了半小时研究翠湖公园附近的可去之处来度过这个下午，发现公园的出口就有一个砖石结构的法式建筑，是前云南省主席卢汉的住宅。\n\n![bc57c0074c571a7efaeea3c883024211](http://image.stephenfang.me/yunnan/bc57c0074c571a7efaeea3c883024211.jpeg)\n\n![c5720fb9d797408c126bbcd968cd7ea7](http://image.stephenfang.me/yunnan/c5720fb9d797408c126bbcd968cd7ea7.jpeg)\n\n卢汉公馆的参观过程十分有序，严格限制了同时参观人数。这个建筑见证了昆明和平起义，保留十分完好，装修风格非常豪华，庭院的形制与电视里看过的民国电视剧里的大户人家宅邸几乎一致。\n\n![e963ec748d29ef90eae9b24d3535d898](http://image.stephenfang.me/yunnan/e963ec748d29ef90eae9b24d3535d898.jpeg)\n\n由于有些不甘心没去成博物馆，况且离饭点还有不少时间，就打车去云南市博溜达了一圈。馆内整体设施都比较陈旧了，三个展中关于飞虎队的展览挺有意思，看到了迪士尼给飞虎队设计的Logo。\n\n![d7335431c71cb8fef2427fc7879ac848](http://image.stephenfang.me/yunnan/d7335431c71cb8fef2427fc7879ac848.jpeg)\n\n从滇池载我们回来的当地司机推荐给我们的饭馆叫外婆味道，这家店的菜还蛮对江浙人胃口，性价比也足够高，79元的套餐内有三个菜。干锅包菜的名字叫手撕莲花白还蛮意外的，套餐外另点的豆腐也非常好吃，可能是除火锅外在云南吃的最舒心的一顿。\n\n![c3777d824991be041e7b7af642017f43](http://image.stephenfang.me/yunnan/c3777d824991be041e7b7af642017f43.jpeg)\n![562ce2e3de9e87a94fbde1b4e1dd14e3](http://image.stephenfang.me/yunnan/562ce2e3de9e87a94fbde1b4e1dd14e3.jpeg)\n\n这家店是连锁店，我们选的这家在比较市中心的位置了，走上个几百米就是恒隆广场。整个昆明的高楼并不是很多，走上恒隆的观景台看昆明的天际线（并不是）还蛮开心的，心里却想着是第二天就要赶回去上班了还没有好好放松。\n\n![030e7c01c93a7b0b8dbcfa893440cf94](http://image.stephenfang.me/yunnan/030e7c01c93a7b0b8dbcfa893440cf94.jpeg)\n![0b4718d1a680f3f5b69c632195d5387a](http://image.stephenfang.me/yunnan/0b4718d1a680f3f5b69c632195d5387a.jpeg)\n\n我们住的民宿可以远眺昆明的市中心。开上一瓶恒隆买的果酒，在旅行的倒数第二天，总算是可以歇下来整理照片玩会儿游戏了。\n\n# 第六天\n\n![48c733ee259ed52252243a3979983a6c](http://image.stephenfang.me/yunnan/48c733ee259ed52252243a3979983a6c.jpeg)\n\n一大早在车笛声中醒来，就准备着和云南道别了。\n\n![c2b58a28831d3b476798e23ba616bf0c](http://image.stephenfang.me/yunnan/c2b58a28831d3b476798e23ba616bf0c.jpeg)\n\n今天的安排只安排了一个目的地，就是云南省博物馆。\n在省级博物馆中我已经打卡过了浙江省博、湖北省博、广东省博、上海市博，几乎每个博物馆都有和国家宝藏的梦幻联动，为参观的过程添加了许多趣味。云南省博物馆的外立面取意于云南传统民居“一颗印”，外形源自石林风化地貌特征。\n\n![8af47fc3fb3fe1ef67dd6b8efd5742be](http://image.stephenfang.me/yunnan/8af47fc3fb3fe1ef67dd6b8efd5742be.jpeg)\n\n三层的展览一上午根本来不及看完，为了尽可能多的看到展品，只能走马观花式的有选择性的看了一圈。精美如这件贝器盖，远看有些像小时候玩的工兵，实则表现的是滇族与昆明族军队交战。\n\n![f1eade5b620f110d31ad54902fb8e5d2](http://image.stephenfang.me/yunnan/f1eade5b620f110d31ad54902fb8e5d2.jpeg)\n\n这件与博物馆前巨型雕塑一致的金翅鸟自然来头不小，以下是摘录对它的描述。\n\n> 宋代大理国银鎏金镶珠金翅鸟，1978年出土于大理崇圣寺主塔。金翅鸟梵名为“迦楼罗”，被尊为大理的保护神，是佛教护法中的天龙八部之一。传说金翅鸟原来十分凶悍，以龙为食。后来金翅鸟皈依佛教，成为了佛教的护法神。这只金翅鸟头饰羽冠，两只利爪立于莲座之上。镂花火焰形背光插在尾身之间，镶饰有5粒水晶珠。体态雄健圆浑，生机勃勃，工艺可谓精美绝伦。\n\n![1d0d2098ad7d1fb5b380aeb17dd1aa3c](http://image.stephenfang.me/yunnan/1d0d2098ad7d1fb5b380aeb17dd1aa3c.jpeg)\n\n价值连城的宝物还有不少，工艺精湛的如这件明代金镶红蓝宝石冠，值得驻足许久欣赏。\n\n![37beddf0ed48d168e6423345197cf381](http://image.stephenfang.me/yunnan/37beddf0ed48d168e6423345197cf381.jpeg)\n\n\n结束了博物馆的游览整个云南之旅也就告一段落了，几年前转机经过昆明长水机场，心里想着以后还会来到这里，如今算是了却了这个念想，一点都不感到意外。以后还会不会来昆明不好说，但一定会再来到云南去更多的城市走走看看。","slug":"Yunnan_Travelling","published":1,"updated":"2022-07-24T15:18:00.328Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cl6mfpp39006so76f5lomfyhu","content":"<p>去年国庆期间和朋友一起去了趟云南，起初安排的路线是 <strong>丽江 -&gt; 香格里拉 -&gt; 泸沽湖 -&gt; 昆明</strong>，在旅程中我们从时间和成本上考量，加上路人给予的一些建议，最终的路线是 <strong>丽江 -&gt; 大理 -&gt; 昆明</strong>。</p>\n<p>由于工作较忙一直没有时间整理旅行中的见闻，最近在整理博客的时候静下心来完善之前写的日记，花了一下午将六天的经历整理成一片流水账，发表在个人博客上图一乐。</p>\n<span id=\"more\"></span>\n\n<h1 id=\"第一天\"><a href=\"#第一天\" class=\"headerlink\" title=\"第一天\"></a>第一天</h1><p>为了让旅程显得没有那么劳累，特地选择了一个出发时间较晚的航班，同时为了节省费用，预定了需要转机的机票。这次旅行不能说是一时兴起，应该说是弥补了暑假没有毕业旅行的遗憾。<br>10点从萧山机场出发，到达丽江已是下午三点，一下飞机就能感受到离天空的距离更近了，作为一个从平原来的人并没有明显感觉空气稀薄了。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ff6659d985f90f0c02800c28ab472fda.jpeg\" alt=\"ff6659d985f90f0c02800c28ab472fda\"></p>\n<p>这是我第一次来云南。在网上冲浪的时候时常能刷到云南的名山大川，也想着有一天能来看看，碰巧朋友对云南也抱着很深的念想。<br>对于云南我比较熟悉的是大理、丽江这些旅游城市的名字，时常能在热门旅游排行榜上看到他们的位置，由于同事强烈推荐了泸沽湖，在安排行程的时候我也将其考虑在内。<br>在飞机上就能够感受到云南的山是磅礴的，完全不同于江南的柔美风格。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ebf28efdfe345106d0894026adf5c5d7.jpeg\" alt=\"ebf28efdfe345106d0894026adf5c5d7\"></p>\n<p>从三义机场坐大巴到丽江古城有一个小时的车程。在规划旅程的时候没有特别调查过丽江古城是否那么值得去住下，只是草草在Airbnb上检索和筛选了几家我和同伴都满意的民宿。拎着行李穿过大半个古城，总算到达了我们的民宿。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/e22ae0331bbbd911244cac0de7e40b07.jpeg\" alt=\"e22ae0331bbbd911244cac0de7e40b07\"><br><img src=\"http://image.stephenfang.me/yunnan/095486935be166df4f6d224b8006b0fb.jpeg\" alt=\"095486935be166df4f6d224b8006b0fb\"></p>\n<p>丽江古城的开发不能说好，它在保留着一些古城风貌的同时植入了太多的商业元素，路边的花卉就像是不要钱似的堆积着。让我感到欣慰的就是民宿整体让人满意，里面的配套设施十分扎实，还可以吃到房东准备的高山苹果。<br><img src=\"http://image.stephenfang.me/yunnan/16453260665672.jpg\"></p>\n<p>从民宿的院子里可以痴痴地望上天空好久，在杭州几乎没有看到蓝色饱和度这么高的天空。院子里还有一只慵懒的猫咪在晒太阳，爬上二楼可以望到远处的高山。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/fe0b10442075f57e72b60acdf5ad2b98.jpeg\" alt=\"fe0b10442075f57e72b60acdf5ad2b98\"></p>\n<p>差不多到了吃饭的点，初来乍到怕在古城里被宰，咨询了房东的意见后选择了古城北门附近的一家腊排骨火锅。我和同伴对于腊肉并没有那么钟意，吃前几块的时候感觉是很新奇的味道，再往后吃只能感到油腻，不过望着远山吃饭真的称得上是一种享受。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/356e4921d91f036d68ce3affe6876d23.jpeg\" alt=\"356e4921d91f036d68ce3affe6876d23\"></p>\n<p>大概是在古城里逛了很久才动了回民宿的念头，正遇上两位准备退房的广东大学生。在交谈中得知他们从大理一路玩过来，没有抢到上玉龙雪山的票，正准备赶往下一站。正巧我们也没有决定第二天去哪里玩，本想着去香格里拉——所谓的「小拉萨」朝圣，无奈经费和时间都不太宽裕，不如按部就班去一趟必去的玉龙雪山。<br>记忆中两个男生都挺健谈的，给予了我们不少旅行的建议，我认为在旅行中和他人的沟通是旅行中很重要的一部分，和不同行业、不同年龄、不同地方的人对话总会有新的启发。</p>\n<pre><code>Date:    2021年10月4日 GMT+8 13:12:03\nWeather:    15 °C Mostly Cloudy\nLocation:    大具乡, 丽江市, 云南省, 中国\n</code></pre>\n<h1 id=\"第二天\"><a href=\"#第二天\" class=\"headerlink\" title=\"第二天\"></a>第二天</h1><p>云南的早晨就应该从一碗米线开始。<br>考虑到米线的价格不会太贵，这一次没有选择古城外的店铺，而是在古城内参考大众点评选择了一家米线店。这家店生意很旺，来就餐的排队到了院子之外，然而实话说这碗米线的味道只能说十分平淡，烤豆腐做的也烧欠火候，汤头在江浙人看来不能说是鲜。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/48d24d21aa00d5d4e7bc1e3ba5c5f49c.jpeg\" alt=\"48d24d21aa00d5d4e7bc1e3ba5c5f49c\"></p>\n<p>一大早约到了玉龙雪山中午的上山票，于是整个行程可以安排的较为轻松些。<br>六点多兴奋的睡不着觉，走上二楼拍了一张早晨的天空，狠狠的呼吸着属于丽江早晨的空气。这个画面几乎是永久性地储存在我的记忆里，文件名大概是是丽江古城。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/f04c219816bdd3bfe2ab16565bc11c39.jpeg\" alt=\"f04c219816bdd3bfe2ab16565bc11c39\"></p>\n<p>在红太阳广场遇到了本地人私家车揽客被警察带走的囧事，等待了许久和一对情侣一起坐上了车身写着监督电话的客运小巴。<br>一路上健谈的司机都在吐槽「丽江已经不是丽江人的丽江了」，由于政府拿到的投资多为外地人控制，导致不少本地人丢失了工作，如开车上山这件事，在许多年前一直是本地人重要的收入来源，而目前上山的公交车为司机口中的「上海人」所垄断，从事车辆营运需要获得政府的许可，同时政府也不允许司机们口头吆喝。其实这样的事情在全国各地都多有发生，我倒不认为规范营运和所谓的「垄断」是一种坏事，但从某种程度上而言部分本地人赖以维持生计的权益确实收到了侵害。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/08c598b790ebfa3719b52f832fdabbe3.jpeg\" alt=\"08c598b790ebfa3719b52f832fdabbe3\"></p>\n<p>在快到达玉龙雪山的地方有一个收费站，进山需要缴纳小一百元，目前仍然维持着停车人工买票的经营模式，效率十分低下，国庆期间卡在这个流程大概得有半个小时之久，真希望当地部门能认真把这个流程优化一下，但整个进山过程中的路大多是平坦而宽阔的，如果是自驾会有比较好的驾驶体验（如果不考虑之后的停车成本）。<br><img src=\"http://image.stephenfang.me/yunnan/6660eb08e1d26b5a0659f59b2f5e2420.jpeg\" alt=\"6660eb08e1d26b5a0659f59b2f5e2420\"><br><img src=\"http://image.stephenfang.me/yunnan/a87fd3ce6194d05bac05f3b2a25eadfb.jpeg\" alt=\"a87fd3ce6194d05bac05f3b2a25eadfb\"></p>\n<p>在古城外20元买了中型的氧气罐，足够支撑上山使用了，晚上其实并没有休息好但事实证明登上4680打卡点并没有那么劳累，必要的时候吸上几口氧气就能缓解略微头晕的症状，但还是不建议以比较快的速度登顶。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/316100ee6464e5da3b992e9067d49e08.jpeg\" alt=\"316100ee6464e5da3b992e9067d49e08\"></p>\n<p>天公不作美，甚至伴着一点小雨，没有欣赏到雪山远处的美景，只见之处都是灰茫茫的一片。<br><img src=\"http://image.stephenfang.me/yunnan/cc978145478ad3e23a52935829d89939.jpeg\" alt=\"cc978145478ad3e23a52935829d89939\"></p>\n<p>休息处的核桃饼还蛮值得一试，10块钱的价格勉强可以把午饭解决。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/704d2973e79389ad94887d6134a716c8.jpeg\" alt=\"704d2973e79389ad94887d6134a716c8\"></p>\n<p>下山前往蓝月谷的路程有了中国式旅游那味儿，上车睡觉下车拍照。从蓝月谷有很多平台可以望向远处的雪山，就什么也不做搁那儿坐着也十分惬意。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/2acfd9c02a752ea35fb36dac8a3e200f.jpeg\" alt=\"2acfd9c02a752ea35fb36dac8a3e200f\"></p>\n<p>来云南第一次吃上与菇有关的菜，云南菜大概是中油重盐，也或许是店家做的有点问题，吃这一碗饭我喝了整整五杯水仍不解渴，但饭的味道还是不错的，以后不想再尝试了。<br>之所以吃上商场里的这家店是因为没排上大众点评上那家知名的云南菜馆，票据上写着过号顺延，紧赶慢赶到达等来的是服务员的一句前面有客人闹了不给号了，瞬间感觉服务水平摆在这儿，这家店也不会太好吃。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/57ec94ff173d417e84f559ab75e353c9.jpeg\" alt=\"57ec94ff173d417e84f559ab75e353c9\"></p>\n<p>陪同学去星巴克处理了一些工作，回到民宿已经是10点多了。古城里的星巴克格外的安静，要想这可是国庆期间，上了二楼找一个位置坐下，听不到一点吵闹。<br>民宿的书架上放了不少供取阅的「真书」，老板似乎是一对建筑师夫妻，我花了一个小时翻完了这本《MUJI HOME》，不知道中国的一二线城市房地产发展会不会在之后也走上日本的老路，年轻人在思想上也有所转变，一些老房子经过适当的装修也能够化腐朽为神奇，按照自己的想法装修自己的家绝对是一件非常幸福的事情。</p>\n<h1 id=\"第三天\"><a href=\"#第三天\" class=\"headerlink\" title=\"第三天\"></a>第三天</h1><p><img src=\"http://image.stephenfang.me/yunnan/61a143f375f819ee4186829a62215429.jpeg\" alt=\"61a143f375f819ee4186829a62215429\"><br>离开丽江前去了在民宿看的旅游书里推荐的黑龙潭公园，这个公园给我的感觉实在是过于好了，我愿意将其称为丽江人民公园。相较于茶马古道这些商业化的景点，我觉得来看看当地人会去的地方或许更有意义，旅游书诚不欺我。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/a8c5c140d69f1154cbda5277e92f039c.jpeg\" alt=\"a8c5c140d69f1154cbda5277e92f039c\"></p>\n<p>在这里可以看到丽江古城的变迁摄影展，可以看到年轻人在河边挥洒着画笔，还可以看到当地居民缅怀的一位官员。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/4651b6bb2e85a93273df870e4a60045c.jpeg\" alt=\"4651b6bb2e85a93273df870e4a60045c\"></p>\n<p>从古城打车去火车站也没有花上太久的时间，丽江站的外形还是很有地方特色的，内部建设就是典型的小型站，类似于之前去过的富阳站、瑞安站。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/6b21b5f176b03681159c0a1c7a5a58e4.jpeg\" alt=\"6b21b5f176b03681159c0a1c7a5a58e4\"></p>\n<p>国庆期间出游另一个坏处就是会遇上各种各样的人，先有一对情侣要求和我换靠窗的位置，后有熊孩子在后座踢椅子，他们的家长不仅坐视不管还一直叽叽喳喳交谈。这趟高铁并没有给我留下比较好的印象。</p>\n<p>由于来大理也是临时决定，在大理入住的民宿就没有丽江那么宜居，宣传的海景民宿在二层根本不用指望能看到海，房间里放着积灰严重的洗衣机也没有提供洗衣粉，客厅放了一个杆子弯的网红日落灯，除了一本影集是真的书，书架上就全是标准廉价装修的假书了。最离谱的是退房后客服还强行要求给五星好评，给我恶心坏了。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/108d5fd13d35506b472ed33f9a2497f9.jpeg\" alt=\"108d5fd13d35506b472ed33f9a2497f9\"></p>\n<p>大理应该是旅游开发和经济发展都比较好的城市了，最明显的感受是商场比丽江的上档次不少，晚饭必须把菌菇火锅安排上。这间店也有不少本地人来吃，价格基本也和大城市平齐了，好在服务不错、干净卫生。菌菇确实如宣传那般鲜，吃完也没有躺板板，安全下车，这也或许是我在云南吃过最满意的一顿。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/2e1f673192e99c97b4910d7aab1e75e6.jpeg\" alt=\"2e1f673192e99c97b4910d7aab1e75e6\"></p>\n<p>来大理之前就在冲浪的时候看到了不少租车环海的视频，我们自然也想享受这个待遇。国庆期间的溢价还是过于严重了，一辆甲壳虫一天的租金超出了500元，所谓丰田才是真正的生活，花了300多元租了一辆雷凌。<br>当地的商家估计也就准备等着这个时候赚一票，不在这个时候发力疫情期间的业绩会差很多。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ce2006588d71ddde28cb01a190c03ae2.jpeg\" alt=\"ce2006588d71ddde28cb01a190c03ae2\"></p>\n<p>晚上和同伴开车去了一趟大理古城，在民宿闲着也是闲着。嘴上是说着去完丽江古城再也不去古城，结果是自己又把自己坑了，更何况是在国庆期间毫无旅游体验。唯一让我感到值得的就是城内城外的一些古建筑，没有在大理找到博物馆这样的公共设施，我是记得在历史上有大理国这样的存在，但在大理没有系统的了解过这边的历史。</p>\n<h1 id=\"第四天\"><a href=\"#第四天\" class=\"headerlink\" title=\"第四天\"></a>第四天</h1><p><img src=\"http://image.stephenfang.me/yunnan/3290cecf78f33c0e065609cde15b6de7.jpeg\" alt=\"3290cecf78f33c0e065609cde15b6de7\"><br>在同伴的一个朋友推荐下，我们起了个大早来到体育馆边上的湿地公园看日出。整个公园的视野非常开阔，除了随风轻拂的草还有许多叫不出名的鸟类，远远看和整个天空慢慢被照亮，欣喜油然而生。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c.jpeg\" alt=\"30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c\"></p>\n<p>在湿地公园碰到了一位来拍延时的当地大叔，他自称是在这里看日出的常客。大叔就拍摄的机位和大理的游览线路做了一些推荐，包括绕海的线路可以倒着来，事实上这条建议帮了我们大忙，避免了国庆期间堵车的风险。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/51079b511ac7f74a0fe197abda5541d3.jpeg\" alt=\"51079b511ac7f74a0fe197abda5541d3\"></p>\n<p>大叔说洱海是值得细细品味的，我现在也认同他说的这句话，洱海在大理人心中的地位不亚于西湖在杭州人心中的地位。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/4a313a162a1f22dc95af102404a712f7.jpeg\" alt=\"4a313a162a1f22dc95af102404a712f7\"></p>\n<p>来云南几天看到过不少的饵丝招牌却一直不知是何物，既然起了个大早就不能放弃吃早饭的机会，遂驱车20分钟赶往附近的一条老街。大理相较于丽江公共交通的体系还是相当完善的，但如果能在大理租车出行上的体验会是翻倍的。</p>\n<p>饵丝是由饵块演变出来的，饵块切丝便做成了饵丝，可以理解成口感不同的米线，饵丝的硬度会更扎实，加上各种料味道还算不错。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c5e72ddcf812bb34166acb276181cfeb.jpeg\" alt=\"c5e72ddcf812bb34166acb276181cfeb\"></p>\n<p>回到民宿还只是早上8点多，稍作休息将行李搬运到车上就正式开始了今天的自驾游。<br>云南的天渲染的比游戏里还蓝，一路上心情都十分愉悦，硬要说有什么不好就是日照过于充足隔一段时间就需要补一下防晒。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/beaaf91430d33942c6d443f4cebd0d4a.jpeg\" alt=\"beaaf91430d33942c6d443f4cebd0d4a\"><br><img src=\"http://image.stephenfang.me/yunnan/072c7b06cde8ef5dc980cebf835dc163.jpeg\" alt=\"072c7b06cde8ef5dc980cebf835dc163\"></p>\n<p>不少80后会选择来大理寻找自由，这句话放在90后身上也不过时。中饭是在双廊的一家音乐餐厅解决的，价格基本上与一线城市物价持平，吉他小哥大概是李志的迷弟，弹唱了很多逼哥的冷门歌曲，再配合这般景致这顿饭吃的蛮值得。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/cf832aeed47083beeca1bfcc88230025.jpeg\" alt=\"cf832aeed47083beeca1bfcc88230025\"></p>\n<p>三塔是大叔推荐的景点，当时查阅了一下维基百科就决定去了。</p>\n<blockquote>\n<p>崇圣寺始建于南诏蒙劝丰佑统治时期（公元823～859年），在大理国时期扩展为890间屋子、11400尊佛像、三阁、七楼、九殿及百厦，被称为“佛都”。大理国22代国王中，就先后有9位到崇圣寺出家为僧。</p>\n<p>崇圣寺曾有五大重器：三塔、南诏建极大钟、雨铜观音铜像、元代高僧圆护大师书写的“证道歌碑”及“佛都匾”、明代的“三圣金像”。崇圣寺经明清战争、清军围剿杜文秀、文化大革命等浩劫最终被毁，五大重器只剩下三塔。</p>\n</blockquote>\n<p><img src=\"http://image.stephenfang.me/yunnan/0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c.jpeg\" alt=\"0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c\"></p>\n<p>由于时间上不太充裕没有爬上苍山俯瞰三塔，但三塔的气魄着实给我还是留下了很深的印象。从崇圣寺等级最高的中心建筑大雄宝殿可以俯瞰整个洱海，符合石牌坊上「山海大观」这四个字。需要注意的这个景点有高铁票证明是可以享受折半票价的，非常值得一来。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a.heic\" alt=\"5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a\"></p>\n<p>这次旅行的景点路线基本都是当天决定的，基本没有心理上的负担，虽然赶来赶去还会有些疲乏，但比以前有计划性的出行要惬意不少。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/90926a9797e2ec14b83e09df8b4299d2.jpeg\" alt=\"90926a9797e2ec14b83e09df8b4299d2\"></p>\n<p>大理到昆明其实有高铁直达，而从丽江到昆明有K9634号豪华卧铺车。我和同伴都从未坐过卧铺车，当时一拍脑袋就决定试试坐一晚上的卧铺，第二天醒来就已经在昆明了，还能剩下一晚的房钱。事实上这趟车票价非常高，一路上多是走走停停，但如果是为了体验也无妨性价比。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ef6bea43d3d26a1624ebccb97a30ebb3.jpeg\" alt=\"ef6bea43d3d26a1624ebccb97a30ebb3\"><br><img src=\"http://image.stephenfang.me/yunnan/2e42842beac0ba05459cdb5d294de2d6.jpeg\" alt=\"2e42842beac0ba05459cdb5d294de2d6\"></p>\n<p>昆明客运段这趟车的宣传还是不错的，车厢内十分整洁，毯子被子枕头该有的一个不少，承诺有的设施如K房、餐车也都有，但我没有up主那种社交技能只是走马观花逛了一圈。只要你不抱有洗澡的念头卧铺还是不错的。</p>\n<h1 id=\"第五天\"><a href=\"#第五天\" class=\"headerlink\" title=\"第五天\"></a>第五天</h1><p>与我同车厢的有一对武汉来的情侣，还有一位在深圳工作的毕业生，我们一直聊到12点多也没有一点不适，话题包括了这几天的所见所闻，交换了各自对旅行的看法。与我差不多大的毕业生刚从香格里拉徒步回来，我还蛮羡慕这种旅行方式，但自己没有这种魄力。<br>卧铺旅行的感受就像是抽盲盒，同行的小伙伴就没有那么幸运，被抽到的车厢里大家互不交谈，还被请求换了铺位。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/9504afa8c61a7633bf37c39002d915cb.jpeg\" alt=\"9504afa8c61a7633bf37c39002d915cb\"></p>\n<p>一觉醒来已是8点，进行了简单的洗漱后泡上了火车站买的方便面。一晚上车厢略有颠簸但睡得挺香，发呆看着窗外城市的轮廓越来越接近。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/af993427107372b2886b63b7c9c396c0.jpeg\" alt=\"af993427107372b2886b63b7c9c396c0\"></p>\n<p>到达昆明站的时候终于有了一缕阳光，工作中9点起床的日子久了已经没有了早晨身体被唤醒的感觉，拎着行李走过站台感觉不到一丝疲惫。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/d42fba4b5eff5a699e567ca8d36f3c63.jpeg\" alt=\"d42fba4b5eff5a699e567ca8d36f3c63\"></p>\n<p>联系上了Airbnb上昆明的房东，由于不能提前入住，房东给我们打点了一间存放行李的屋子，安放妥当后就坐上出租车去往了必到的景点——滇池。<br>这个季节的滇池和我想象中的有很大出入，首先海鸥要在冬季才能见到，其次滇池的水是碧绿碧绿的，作为一个刚从大理来的人我觉得还是洱海更胜一筹。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/46757eadeec04da52def179f08bd4668.jpeg\" alt=\"46757eadeec04da52def179f08bd4668\"></p>\n<p>来春城前我最想去的景点是西南联大博物馆，最近也在读重走西南联大，对此景点期许有加。事实上目前整个建筑是云南师范大学的一部分，在疫情期间不再对外开放，等到达师范大学门口的时候失望到达了顶点。<br>只能在学校附近找了一家米线店安抚一下自己，点了一碗状元米线还送了一碗汽锅鸡，整个吃米线的过程仪式感很足。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/4904f2c886474b702ec5da3cdf7b2258.jpeg\" alt=\"4904f2c886474b702ec5da3cdf7b2258\"></p>\n<p>昆明的地铁饮料几乎是被百事承包了，这个橘味的微笑泡泡在杭州我从未见过，喝起来和芬达的味道非常相似。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/32e8d9681f300e3335b74c1b8aa1a2b5.jpeg\" alt=\"32e8d9681f300e3335b74c1b8aa1a2b5\"><br><img src=\"http://image.stephenfang.me/yunnan/b18fec1a67bac4a8a609d80d6ad46b83.jpeg\" alt=\"b18fec1a67bac4a8a609d80d6ad46b83\"></p>\n<p>春城的花市是很有名的，在这里能够以极低的价格采购到鲜花并且当天快递发货，多肉也都是白菜价十块钱能买到品种不同的四五株，把这里当作一个景点来逛也非常合适。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/d999d61dfe2d1e2749c967e131b44192.jpeg\" alt=\"d999d61dfe2d1e2749c967e131b44192\"></p>\n<p>每个地方都有每个地方的人民广场，丽江是黑龙潭广场，昆明便是翠湖公园，配合着还潮乐队的《慈城公园交谊舞》整个散步的过程都惬意了不少。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/2e182c6678ec1152380f6ec24ee58f60.jpeg\" alt=\"2e182c6678ec1152380f6ec24ee58f60\"></p>\n<p>云倒映在水潭里的样子还蛮好看的，可能去公园走走在年轻人看来依旧是一种老掉牙的行为吧。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/977c252e72092f9da3a94edf9c4ef98c.jpeg\" alt=\"977c252e72092f9da3a94edf9c4ef98c\"></p>\n<p>昆明有许多博物馆，包括云南省博、昆明市博、云南民族博物馆、铁路博物馆，每一个我都很想去。当天没能进去西南联大博物馆，又没能约上陆军讲武堂，第二天就要从这座城市离开了。<br>花了半小时研究翠湖公园附近的可去之处来度过这个下午，发现公园的出口就有一个砖石结构的法式建筑，是前云南省主席卢汉的住宅。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/bc57c0074c571a7efaeea3c883024211.jpeg\" alt=\"bc57c0074c571a7efaeea3c883024211\"></p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c5720fb9d797408c126bbcd968cd7ea7.jpeg\" alt=\"c5720fb9d797408c126bbcd968cd7ea7\"></p>\n<p>卢汉公馆的参观过程十分有序，严格限制了同时参观人数。这个建筑见证了昆明和平起义，保留十分完好，装修风格非常豪华，庭院的形制与电视里看过的民国电视剧里的大户人家宅邸几乎一致。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/e963ec748d29ef90eae9b24d3535d898.jpeg\" alt=\"e963ec748d29ef90eae9b24d3535d898\"></p>\n<p>由于有些不甘心没去成博物馆，况且离饭点还有不少时间，就打车去云南市博溜达了一圈。馆内整体设施都比较陈旧了，三个展中关于飞虎队的展览挺有意思，看到了迪士尼给飞虎队设计的Logo。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/d7335431c71cb8fef2427fc7879ac848.jpeg\" alt=\"d7335431c71cb8fef2427fc7879ac848\"></p>\n<p>从滇池载我们回来的当地司机推荐给我们的饭馆叫外婆味道，这家店的菜还蛮对江浙人胃口，性价比也足够高，79元的套餐内有三个菜。干锅包菜的名字叫手撕莲花白还蛮意外的，套餐外另点的豆腐也非常好吃，可能是除火锅外在云南吃的最舒心的一顿。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c3777d824991be041e7b7af642017f43.jpeg\" alt=\"c3777d824991be041e7b7af642017f43\"><br><img src=\"http://image.stephenfang.me/yunnan/562ce2e3de9e87a94fbde1b4e1dd14e3.jpeg\" alt=\"562ce2e3de9e87a94fbde1b4e1dd14e3\"></p>\n<p>这家店是连锁店，我们选的这家在比较市中心的位置了，走上个几百米就是恒隆广场。整个昆明的高楼并不是很多，走上恒隆的观景台看昆明的天际线（并不是）还蛮开心的，心里却想着是第二天就要赶回去上班了还没有好好放松。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/030e7c01c93a7b0b8dbcfa893440cf94.jpeg\" alt=\"030e7c01c93a7b0b8dbcfa893440cf94\"><br><img src=\"http://image.stephenfang.me/yunnan/0b4718d1a680f3f5b69c632195d5387a.jpeg\" alt=\"0b4718d1a680f3f5b69c632195d5387a\"></p>\n<p>我们住的民宿可以远眺昆明的市中心。开上一瓶恒隆买的果酒，在旅行的倒数第二天，总算是可以歇下来整理照片玩会儿游戏了。</p>\n<h1 id=\"第六天\"><a href=\"#第六天\" class=\"headerlink\" title=\"第六天\"></a>第六天</h1><p><img src=\"http://image.stephenfang.me/yunnan/48c733ee259ed52252243a3979983a6c.jpeg\" alt=\"48c733ee259ed52252243a3979983a6c\"></p>\n<p>一大早在车笛声中醒来，就准备着和云南道别了。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c2b58a28831d3b476798e23ba616bf0c.jpeg\" alt=\"c2b58a28831d3b476798e23ba616bf0c\"></p>\n<p>今天的安排只安排了一个目的地，就是云南省博物馆。<br>在省级博物馆中我已经打卡过了浙江省博、湖北省博、广东省博、上海市博，几乎每个博物馆都有和国家宝藏的梦幻联动，为参观的过程添加了许多趣味。云南省博物馆的外立面取意于云南传统民居“一颗印”，外形源自石林风化地貌特征。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/8af47fc3fb3fe1ef67dd6b8efd5742be.jpeg\" alt=\"8af47fc3fb3fe1ef67dd6b8efd5742be\"></p>\n<p>三层的展览一上午根本来不及看完，为了尽可能多的看到展品，只能走马观花式的有选择性的看了一圈。精美如这件贝器盖，远看有些像小时候玩的工兵，实则表现的是滇族与昆明族军队交战。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/f1eade5b620f110d31ad54902fb8e5d2.jpeg\" alt=\"f1eade5b620f110d31ad54902fb8e5d2\"></p>\n<p>这件与博物馆前巨型雕塑一致的金翅鸟自然来头不小，以下是摘录对它的描述。</p>\n<blockquote>\n<p>宋代大理国银鎏金镶珠金翅鸟，1978年出土于大理崇圣寺主塔。金翅鸟梵名为“迦楼罗”，被尊为大理的保护神，是佛教护法中的天龙八部之一。传说金翅鸟原来十分凶悍，以龙为食。后来金翅鸟皈依佛教，成为了佛教的护法神。这只金翅鸟头饰羽冠，两只利爪立于莲座之上。镂花火焰形背光插在尾身之间，镶饰有5粒水晶珠。体态雄健圆浑，生机勃勃，工艺可谓精美绝伦。</p>\n</blockquote>\n<p><img src=\"http://image.stephenfang.me/yunnan/1d0d2098ad7d1fb5b380aeb17dd1aa3c.jpeg\" alt=\"1d0d2098ad7d1fb5b380aeb17dd1aa3c\"></p>\n<p>价值连城的宝物还有不少，工艺精湛的如这件明代金镶红蓝宝石冠，值得驻足许久欣赏。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/37beddf0ed48d168e6423345197cf381.jpeg\" alt=\"37beddf0ed48d168e6423345197cf381\"></p>\n<p>结束了博物馆的游览整个云南之旅也就告一段落了，几年前转机经过昆明长水机场，心里想着以后还会来到这里，如今算是了却了这个念想，一点都不感到意外。以后还会不会来昆明不好说，但一定会再来到云南去更多的城市走走看看。</p>\n","site":{"data":{}},"excerpt":"<p>去年国庆期间和朋友一起去了趟云南，起初安排的路线是 <strong>丽江 -&gt; 香格里拉 -&gt; 泸沽湖 -&gt; 昆明</strong>，在旅程中我们从时间和成本上考量，加上路人给予的一些建议，最终的路线是 <strong>丽江 -&gt; 大理 -&gt; 昆明</strong>。</p>\n<p>由于工作较忙一直没有时间整理旅行中的见闻，最近在整理博客的时候静下心来完善之前写的日记，花了一下午将六天的经历整理成一片流水账，发表在个人博客上图一乐。</p>","more":"<h1 id=\"第一天\"><a href=\"#第一天\" class=\"headerlink\" title=\"第一天\"></a>第一天</h1><p>为了让旅程显得没有那么劳累，特地选择了一个出发时间较晚的航班，同时为了节省费用，预定了需要转机的机票。这次旅行不能说是一时兴起，应该说是弥补了暑假没有毕业旅行的遗憾。<br>10点从萧山机场出发，到达丽江已是下午三点，一下飞机就能感受到离天空的距离更近了，作为一个从平原来的人并没有明显感觉空气稀薄了。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ff6659d985f90f0c02800c28ab472fda.jpeg\" alt=\"ff6659d985f90f0c02800c28ab472fda\"></p>\n<p>这是我第一次来云南。在网上冲浪的时候时常能刷到云南的名山大川，也想着有一天能来看看，碰巧朋友对云南也抱着很深的念想。<br>对于云南我比较熟悉的是大理、丽江这些旅游城市的名字，时常能在热门旅游排行榜上看到他们的位置，由于同事强烈推荐了泸沽湖，在安排行程的时候我也将其考虑在内。<br>在飞机上就能够感受到云南的山是磅礴的，完全不同于江南的柔美风格。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ebf28efdfe345106d0894026adf5c5d7.jpeg\" alt=\"ebf28efdfe345106d0894026adf5c5d7\"></p>\n<p>从三义机场坐大巴到丽江古城有一个小时的车程。在规划旅程的时候没有特别调查过丽江古城是否那么值得去住下，只是草草在Airbnb上检索和筛选了几家我和同伴都满意的民宿。拎着行李穿过大半个古城，总算到达了我们的民宿。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/e22ae0331bbbd911244cac0de7e40b07.jpeg\" alt=\"e22ae0331bbbd911244cac0de7e40b07\"><br><img src=\"http://image.stephenfang.me/yunnan/095486935be166df4f6d224b8006b0fb.jpeg\" alt=\"095486935be166df4f6d224b8006b0fb\"></p>\n<p>丽江古城的开发不能说好，它在保留着一些古城风貌的同时植入了太多的商业元素，路边的花卉就像是不要钱似的堆积着。让我感到欣慰的就是民宿整体让人满意，里面的配套设施十分扎实，还可以吃到房东准备的高山苹果。<br><img src=\"http://image.stephenfang.me/yunnan/16453260665672.jpg\"></p>\n<p>从民宿的院子里可以痴痴地望上天空好久，在杭州几乎没有看到蓝色饱和度这么高的天空。院子里还有一只慵懒的猫咪在晒太阳，爬上二楼可以望到远处的高山。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/fe0b10442075f57e72b60acdf5ad2b98.jpeg\" alt=\"fe0b10442075f57e72b60acdf5ad2b98\"></p>\n<p>差不多到了吃饭的点，初来乍到怕在古城里被宰，咨询了房东的意见后选择了古城北门附近的一家腊排骨火锅。我和同伴对于腊肉并没有那么钟意，吃前几块的时候感觉是很新奇的味道，再往后吃只能感到油腻，不过望着远山吃饭真的称得上是一种享受。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/356e4921d91f036d68ce3affe6876d23.jpeg\" alt=\"356e4921d91f036d68ce3affe6876d23\"></p>\n<p>大概是在古城里逛了很久才动了回民宿的念头，正遇上两位准备退房的广东大学生。在交谈中得知他们从大理一路玩过来，没有抢到上玉龙雪山的票，正准备赶往下一站。正巧我们也没有决定第二天去哪里玩，本想着去香格里拉——所谓的「小拉萨」朝圣，无奈经费和时间都不太宽裕，不如按部就班去一趟必去的玉龙雪山。<br>记忆中两个男生都挺健谈的，给予了我们不少旅行的建议，我认为在旅行中和他人的沟通是旅行中很重要的一部分，和不同行业、不同年龄、不同地方的人对话总会有新的启发。</p>\n<pre><code>Date:    2021年10月4日 GMT+8 13:12:03\nWeather:    15 °C Mostly Cloudy\nLocation:    大具乡, 丽江市, 云南省, 中国\n</code></pre>\n<h1 id=\"第二天\"><a href=\"#第二天\" class=\"headerlink\" title=\"第二天\"></a>第二天</h1><p>云南的早晨就应该从一碗米线开始。<br>考虑到米线的价格不会太贵，这一次没有选择古城外的店铺，而是在古城内参考大众点评选择了一家米线店。这家店生意很旺，来就餐的排队到了院子之外，然而实话说这碗米线的味道只能说十分平淡，烤豆腐做的也烧欠火候，汤头在江浙人看来不能说是鲜。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/48d24d21aa00d5d4e7bc1e3ba5c5f49c.jpeg\" alt=\"48d24d21aa00d5d4e7bc1e3ba5c5f49c\"></p>\n<p>一大早约到了玉龙雪山中午的上山票，于是整个行程可以安排的较为轻松些。<br>六点多兴奋的睡不着觉，走上二楼拍了一张早晨的天空，狠狠的呼吸着属于丽江早晨的空气。这个画面几乎是永久性地储存在我的记忆里，文件名大概是是丽江古城。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/f04c219816bdd3bfe2ab16565bc11c39.jpeg\" alt=\"f04c219816bdd3bfe2ab16565bc11c39\"></p>\n<p>在红太阳广场遇到了本地人私家车揽客被警察带走的囧事，等待了许久和一对情侣一起坐上了车身写着监督电话的客运小巴。<br>一路上健谈的司机都在吐槽「丽江已经不是丽江人的丽江了」，由于政府拿到的投资多为外地人控制，导致不少本地人丢失了工作，如开车上山这件事，在许多年前一直是本地人重要的收入来源，而目前上山的公交车为司机口中的「上海人」所垄断，从事车辆营运需要获得政府的许可，同时政府也不允许司机们口头吆喝。其实这样的事情在全国各地都多有发生，我倒不认为规范营运和所谓的「垄断」是一种坏事，但从某种程度上而言部分本地人赖以维持生计的权益确实收到了侵害。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/08c598b790ebfa3719b52f832fdabbe3.jpeg\" alt=\"08c598b790ebfa3719b52f832fdabbe3\"></p>\n<p>在快到达玉龙雪山的地方有一个收费站，进山需要缴纳小一百元，目前仍然维持着停车人工买票的经营模式，效率十分低下，国庆期间卡在这个流程大概得有半个小时之久，真希望当地部门能认真把这个流程优化一下，但整个进山过程中的路大多是平坦而宽阔的，如果是自驾会有比较好的驾驶体验（如果不考虑之后的停车成本）。<br><img src=\"http://image.stephenfang.me/yunnan/6660eb08e1d26b5a0659f59b2f5e2420.jpeg\" alt=\"6660eb08e1d26b5a0659f59b2f5e2420\"><br><img src=\"http://image.stephenfang.me/yunnan/a87fd3ce6194d05bac05f3b2a25eadfb.jpeg\" alt=\"a87fd3ce6194d05bac05f3b2a25eadfb\"></p>\n<p>在古城外20元买了中型的氧气罐，足够支撑上山使用了，晚上其实并没有休息好但事实证明登上4680打卡点并没有那么劳累，必要的时候吸上几口氧气就能缓解略微头晕的症状，但还是不建议以比较快的速度登顶。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/316100ee6464e5da3b992e9067d49e08.jpeg\" alt=\"316100ee6464e5da3b992e9067d49e08\"></p>\n<p>天公不作美，甚至伴着一点小雨，没有欣赏到雪山远处的美景，只见之处都是灰茫茫的一片。<br><img src=\"http://image.stephenfang.me/yunnan/cc978145478ad3e23a52935829d89939.jpeg\" alt=\"cc978145478ad3e23a52935829d89939\"></p>\n<p>休息处的核桃饼还蛮值得一试，10块钱的价格勉强可以把午饭解决。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/704d2973e79389ad94887d6134a716c8.jpeg\" alt=\"704d2973e79389ad94887d6134a716c8\"></p>\n<p>下山前往蓝月谷的路程有了中国式旅游那味儿，上车睡觉下车拍照。从蓝月谷有很多平台可以望向远处的雪山，就什么也不做搁那儿坐着也十分惬意。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/2acfd9c02a752ea35fb36dac8a3e200f.jpeg\" alt=\"2acfd9c02a752ea35fb36dac8a3e200f\"></p>\n<p>来云南第一次吃上与菇有关的菜，云南菜大概是中油重盐，也或许是店家做的有点问题，吃这一碗饭我喝了整整五杯水仍不解渴，但饭的味道还是不错的，以后不想再尝试了。<br>之所以吃上商场里的这家店是因为没排上大众点评上那家知名的云南菜馆，票据上写着过号顺延，紧赶慢赶到达等来的是服务员的一句前面有客人闹了不给号了，瞬间感觉服务水平摆在这儿，这家店也不会太好吃。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/57ec94ff173d417e84f559ab75e353c9.jpeg\" alt=\"57ec94ff173d417e84f559ab75e353c9\"></p>\n<p>陪同学去星巴克处理了一些工作，回到民宿已经是10点多了。古城里的星巴克格外的安静，要想这可是国庆期间，上了二楼找一个位置坐下，听不到一点吵闹。<br>民宿的书架上放了不少供取阅的「真书」，老板似乎是一对建筑师夫妻，我花了一个小时翻完了这本《MUJI HOME》，不知道中国的一二线城市房地产发展会不会在之后也走上日本的老路，年轻人在思想上也有所转变，一些老房子经过适当的装修也能够化腐朽为神奇，按照自己的想法装修自己的家绝对是一件非常幸福的事情。</p>\n<h1 id=\"第三天\"><a href=\"#第三天\" class=\"headerlink\" title=\"第三天\"></a>第三天</h1><p><img src=\"http://image.stephenfang.me/yunnan/61a143f375f819ee4186829a62215429.jpeg\" alt=\"61a143f375f819ee4186829a62215429\"><br>离开丽江前去了在民宿看的旅游书里推荐的黑龙潭公园，这个公园给我的感觉实在是过于好了，我愿意将其称为丽江人民公园。相较于茶马古道这些商业化的景点，我觉得来看看当地人会去的地方或许更有意义，旅游书诚不欺我。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/a8c5c140d69f1154cbda5277e92f039c.jpeg\" alt=\"a8c5c140d69f1154cbda5277e92f039c\"></p>\n<p>在这里可以看到丽江古城的变迁摄影展，可以看到年轻人在河边挥洒着画笔，还可以看到当地居民缅怀的一位官员。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/4651b6bb2e85a93273df870e4a60045c.jpeg\" alt=\"4651b6bb2e85a93273df870e4a60045c\"></p>\n<p>从古城打车去火车站也没有花上太久的时间，丽江站的外形还是很有地方特色的，内部建设就是典型的小型站，类似于之前去过的富阳站、瑞安站。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/6b21b5f176b03681159c0a1c7a5a58e4.jpeg\" alt=\"6b21b5f176b03681159c0a1c7a5a58e4\"></p>\n<p>国庆期间出游另一个坏处就是会遇上各种各样的人，先有一对情侣要求和我换靠窗的位置，后有熊孩子在后座踢椅子，他们的家长不仅坐视不管还一直叽叽喳喳交谈。这趟高铁并没有给我留下比较好的印象。</p>\n<p>由于来大理也是临时决定，在大理入住的民宿就没有丽江那么宜居，宣传的海景民宿在二层根本不用指望能看到海，房间里放着积灰严重的洗衣机也没有提供洗衣粉，客厅放了一个杆子弯的网红日落灯，除了一本影集是真的书，书架上就全是标准廉价装修的假书了。最离谱的是退房后客服还强行要求给五星好评，给我恶心坏了。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/108d5fd13d35506b472ed33f9a2497f9.jpeg\" alt=\"108d5fd13d35506b472ed33f9a2497f9\"></p>\n<p>大理应该是旅游开发和经济发展都比较好的城市了，最明显的感受是商场比丽江的上档次不少，晚饭必须把菌菇火锅安排上。这间店也有不少本地人来吃，价格基本也和大城市平齐了，好在服务不错、干净卫生。菌菇确实如宣传那般鲜，吃完也没有躺板板，安全下车，这也或许是我在云南吃过最满意的一顿。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/2e1f673192e99c97b4910d7aab1e75e6.jpeg\" alt=\"2e1f673192e99c97b4910d7aab1e75e6\"></p>\n<p>来大理之前就在冲浪的时候看到了不少租车环海的视频，我们自然也想享受这个待遇。国庆期间的溢价还是过于严重了，一辆甲壳虫一天的租金超出了500元，所谓丰田才是真正的生活，花了300多元租了一辆雷凌。<br>当地的商家估计也就准备等着这个时候赚一票，不在这个时候发力疫情期间的业绩会差很多。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ce2006588d71ddde28cb01a190c03ae2.jpeg\" alt=\"ce2006588d71ddde28cb01a190c03ae2\"></p>\n<p>晚上和同伴开车去了一趟大理古城，在民宿闲着也是闲着。嘴上是说着去完丽江古城再也不去古城，结果是自己又把自己坑了，更何况是在国庆期间毫无旅游体验。唯一让我感到值得的就是城内城外的一些古建筑，没有在大理找到博物馆这样的公共设施，我是记得在历史上有大理国这样的存在，但在大理没有系统的了解过这边的历史。</p>\n<h1 id=\"第四天\"><a href=\"#第四天\" class=\"headerlink\" title=\"第四天\"></a>第四天</h1><p><img src=\"http://image.stephenfang.me/yunnan/3290cecf78f33c0e065609cde15b6de7.jpeg\" alt=\"3290cecf78f33c0e065609cde15b6de7\"><br>在同伴的一个朋友推荐下，我们起了个大早来到体育馆边上的湿地公园看日出。整个公园的视野非常开阔，除了随风轻拂的草还有许多叫不出名的鸟类，远远看和整个天空慢慢被照亮，欣喜油然而生。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c.jpeg\" alt=\"30CE04A9-36BB-46EF-971A-72B005C5BA5F_1_105_c\"></p>\n<p>在湿地公园碰到了一位来拍延时的当地大叔，他自称是在这里看日出的常客。大叔就拍摄的机位和大理的游览线路做了一些推荐，包括绕海的线路可以倒着来，事实上这条建议帮了我们大忙，避免了国庆期间堵车的风险。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/51079b511ac7f74a0fe197abda5541d3.jpeg\" alt=\"51079b511ac7f74a0fe197abda5541d3\"></p>\n<p>大叔说洱海是值得细细品味的，我现在也认同他说的这句话，洱海在大理人心中的地位不亚于西湖在杭州人心中的地位。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/4a313a162a1f22dc95af102404a712f7.jpeg\" alt=\"4a313a162a1f22dc95af102404a712f7\"></p>\n<p>来云南几天看到过不少的饵丝招牌却一直不知是何物，既然起了个大早就不能放弃吃早饭的机会，遂驱车20分钟赶往附近的一条老街。大理相较于丽江公共交通的体系还是相当完善的，但如果能在大理租车出行上的体验会是翻倍的。</p>\n<p>饵丝是由饵块演变出来的，饵块切丝便做成了饵丝，可以理解成口感不同的米线，饵丝的硬度会更扎实，加上各种料味道还算不错。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c5e72ddcf812bb34166acb276181cfeb.jpeg\" alt=\"c5e72ddcf812bb34166acb276181cfeb\"></p>\n<p>回到民宿还只是早上8点多，稍作休息将行李搬运到车上就正式开始了今天的自驾游。<br>云南的天渲染的比游戏里还蓝，一路上心情都十分愉悦，硬要说有什么不好就是日照过于充足隔一段时间就需要补一下防晒。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/beaaf91430d33942c6d443f4cebd0d4a.jpeg\" alt=\"beaaf91430d33942c6d443f4cebd0d4a\"><br><img src=\"http://image.stephenfang.me/yunnan/072c7b06cde8ef5dc980cebf835dc163.jpeg\" alt=\"072c7b06cde8ef5dc980cebf835dc163\"></p>\n<p>不少80后会选择来大理寻找自由，这句话放在90后身上也不过时。中饭是在双廊的一家音乐餐厅解决的，价格基本上与一线城市物价持平，吉他小哥大概是李志的迷弟，弹唱了很多逼哥的冷门歌曲，再配合这般景致这顿饭吃的蛮值得。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/cf832aeed47083beeca1bfcc88230025.jpeg\" alt=\"cf832aeed47083beeca1bfcc88230025\"></p>\n<p>三塔是大叔推荐的景点，当时查阅了一下维基百科就决定去了。</p>\n<blockquote>\n<p>崇圣寺始建于南诏蒙劝丰佑统治时期（公元823～859年），在大理国时期扩展为890间屋子、11400尊佛像、三阁、七楼、九殿及百厦，被称为“佛都”。大理国22代国王中，就先后有9位到崇圣寺出家为僧。</p>\n<p>崇圣寺曾有五大重器：三塔、南诏建极大钟、雨铜观音铜像、元代高僧圆护大师书写的“证道歌碑”及“佛都匾”、明代的“三圣金像”。崇圣寺经明清战争、清军围剿杜文秀、文化大革命等浩劫最终被毁，五大重器只剩下三塔。</p>\n</blockquote>\n<p><img src=\"http://image.stephenfang.me/yunnan/0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c.jpeg\" alt=\"0B31E373-1185-4390-8F68-D14FA0FD6FC1_1_105_c\"></p>\n<p>由于时间上不太充裕没有爬上苍山俯瞰三塔，但三塔的气魄着实给我还是留下了很深的印象。从崇圣寺等级最高的中心建筑大雄宝殿可以俯瞰整个洱海，符合石牌坊上「山海大观」这四个字。需要注意的这个景点有高铁票证明是可以享受折半票价的，非常值得一来。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a.heic\" alt=\"5ABC1848-5190-411F-8CA2-B640A4DE26D1_1_201_a\"></p>\n<p>这次旅行的景点路线基本都是当天决定的，基本没有心理上的负担，虽然赶来赶去还会有些疲乏，但比以前有计划性的出行要惬意不少。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/90926a9797e2ec14b83e09df8b4299d2.jpeg\" alt=\"90926a9797e2ec14b83e09df8b4299d2\"></p>\n<p>大理到昆明其实有高铁直达，而从丽江到昆明有K9634号豪华卧铺车。我和同伴都从未坐过卧铺车，当时一拍脑袋就决定试试坐一晚上的卧铺，第二天醒来就已经在昆明了，还能剩下一晚的房钱。事实上这趟车票价非常高，一路上多是走走停停，但如果是为了体验也无妨性价比。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/ef6bea43d3d26a1624ebccb97a30ebb3.jpeg\" alt=\"ef6bea43d3d26a1624ebccb97a30ebb3\"><br><img src=\"http://image.stephenfang.me/yunnan/2e42842beac0ba05459cdb5d294de2d6.jpeg\" alt=\"2e42842beac0ba05459cdb5d294de2d6\"></p>\n<p>昆明客运段这趟车的宣传还是不错的，车厢内十分整洁，毯子被子枕头该有的一个不少，承诺有的设施如K房、餐车也都有，但我没有up主那种社交技能只是走马观花逛了一圈。只要你不抱有洗澡的念头卧铺还是不错的。</p>\n<h1 id=\"第五天\"><a href=\"#第五天\" class=\"headerlink\" title=\"第五天\"></a>第五天</h1><p>与我同车厢的有一对武汉来的情侣，还有一位在深圳工作的毕业生，我们一直聊到12点多也没有一点不适，话题包括了这几天的所见所闻，交换了各自对旅行的看法。与我差不多大的毕业生刚从香格里拉徒步回来，我还蛮羡慕这种旅行方式，但自己没有这种魄力。<br>卧铺旅行的感受就像是抽盲盒，同行的小伙伴就没有那么幸运，被抽到的车厢里大家互不交谈，还被请求换了铺位。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/9504afa8c61a7633bf37c39002d915cb.jpeg\" alt=\"9504afa8c61a7633bf37c39002d915cb\"></p>\n<p>一觉醒来已是8点，进行了简单的洗漱后泡上了火车站买的方便面。一晚上车厢略有颠簸但睡得挺香，发呆看着窗外城市的轮廓越来越接近。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/af993427107372b2886b63b7c9c396c0.jpeg\" alt=\"af993427107372b2886b63b7c9c396c0\"></p>\n<p>到达昆明站的时候终于有了一缕阳光，工作中9点起床的日子久了已经没有了早晨身体被唤醒的感觉，拎着行李走过站台感觉不到一丝疲惫。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/d42fba4b5eff5a699e567ca8d36f3c63.jpeg\" alt=\"d42fba4b5eff5a699e567ca8d36f3c63\"></p>\n<p>联系上了Airbnb上昆明的房东，由于不能提前入住，房东给我们打点了一间存放行李的屋子，安放妥当后就坐上出租车去往了必到的景点——滇池。<br>这个季节的滇池和我想象中的有很大出入，首先海鸥要在冬季才能见到，其次滇池的水是碧绿碧绿的，作为一个刚从大理来的人我觉得还是洱海更胜一筹。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/46757eadeec04da52def179f08bd4668.jpeg\" alt=\"46757eadeec04da52def179f08bd4668\"></p>\n<p>来春城前我最想去的景点是西南联大博物馆，最近也在读重走西南联大，对此景点期许有加。事实上目前整个建筑是云南师范大学的一部分，在疫情期间不再对外开放，等到达师范大学门口的时候失望到达了顶点。<br>只能在学校附近找了一家米线店安抚一下自己，点了一碗状元米线还送了一碗汽锅鸡，整个吃米线的过程仪式感很足。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/4904f2c886474b702ec5da3cdf7b2258.jpeg\" alt=\"4904f2c886474b702ec5da3cdf7b2258\"></p>\n<p>昆明的地铁饮料几乎是被百事承包了，这个橘味的微笑泡泡在杭州我从未见过，喝起来和芬达的味道非常相似。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/32e8d9681f300e3335b74c1b8aa1a2b5.jpeg\" alt=\"32e8d9681f300e3335b74c1b8aa1a2b5\"><br><img src=\"http://image.stephenfang.me/yunnan/b18fec1a67bac4a8a609d80d6ad46b83.jpeg\" alt=\"b18fec1a67bac4a8a609d80d6ad46b83\"></p>\n<p>春城的花市是很有名的，在这里能够以极低的价格采购到鲜花并且当天快递发货，多肉也都是白菜价十块钱能买到品种不同的四五株，把这里当作一个景点来逛也非常合适。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/d999d61dfe2d1e2749c967e131b44192.jpeg\" alt=\"d999d61dfe2d1e2749c967e131b44192\"></p>\n<p>每个地方都有每个地方的人民广场，丽江是黑龙潭广场，昆明便是翠湖公园，配合着还潮乐队的《慈城公园交谊舞》整个散步的过程都惬意了不少。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/2e182c6678ec1152380f6ec24ee58f60.jpeg\" alt=\"2e182c6678ec1152380f6ec24ee58f60\"></p>\n<p>云倒映在水潭里的样子还蛮好看的，可能去公园走走在年轻人看来依旧是一种老掉牙的行为吧。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/977c252e72092f9da3a94edf9c4ef98c.jpeg\" alt=\"977c252e72092f9da3a94edf9c4ef98c\"></p>\n<p>昆明有许多博物馆，包括云南省博、昆明市博、云南民族博物馆、铁路博物馆，每一个我都很想去。当天没能进去西南联大博物馆，又没能约上陆军讲武堂，第二天就要从这座城市离开了。<br>花了半小时研究翠湖公园附近的可去之处来度过这个下午，发现公园的出口就有一个砖石结构的法式建筑，是前云南省主席卢汉的住宅。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/bc57c0074c571a7efaeea3c883024211.jpeg\" alt=\"bc57c0074c571a7efaeea3c883024211\"></p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c5720fb9d797408c126bbcd968cd7ea7.jpeg\" alt=\"c5720fb9d797408c126bbcd968cd7ea7\"></p>\n<p>卢汉公馆的参观过程十分有序，严格限制了同时参观人数。这个建筑见证了昆明和平起义，保留十分完好，装修风格非常豪华，庭院的形制与电视里看过的民国电视剧里的大户人家宅邸几乎一致。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/e963ec748d29ef90eae9b24d3535d898.jpeg\" alt=\"e963ec748d29ef90eae9b24d3535d898\"></p>\n<p>由于有些不甘心没去成博物馆，况且离饭点还有不少时间，就打车去云南市博溜达了一圈。馆内整体设施都比较陈旧了，三个展中关于飞虎队的展览挺有意思，看到了迪士尼给飞虎队设计的Logo。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/d7335431c71cb8fef2427fc7879ac848.jpeg\" alt=\"d7335431c71cb8fef2427fc7879ac848\"></p>\n<p>从滇池载我们回来的当地司机推荐给我们的饭馆叫外婆味道，这家店的菜还蛮对江浙人胃口，性价比也足够高，79元的套餐内有三个菜。干锅包菜的名字叫手撕莲花白还蛮意外的，套餐外另点的豆腐也非常好吃，可能是除火锅外在云南吃的最舒心的一顿。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c3777d824991be041e7b7af642017f43.jpeg\" alt=\"c3777d824991be041e7b7af642017f43\"><br><img src=\"http://image.stephenfang.me/yunnan/562ce2e3de9e87a94fbde1b4e1dd14e3.jpeg\" alt=\"562ce2e3de9e87a94fbde1b4e1dd14e3\"></p>\n<p>这家店是连锁店，我们选的这家在比较市中心的位置了，走上个几百米就是恒隆广场。整个昆明的高楼并不是很多，走上恒隆的观景台看昆明的天际线（并不是）还蛮开心的，心里却想着是第二天就要赶回去上班了还没有好好放松。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/030e7c01c93a7b0b8dbcfa893440cf94.jpeg\" alt=\"030e7c01c93a7b0b8dbcfa893440cf94\"><br><img src=\"http://image.stephenfang.me/yunnan/0b4718d1a680f3f5b69c632195d5387a.jpeg\" alt=\"0b4718d1a680f3f5b69c632195d5387a\"></p>\n<p>我们住的民宿可以远眺昆明的市中心。开上一瓶恒隆买的果酒，在旅行的倒数第二天，总算是可以歇下来整理照片玩会儿游戏了。</p>\n<h1 id=\"第六天\"><a href=\"#第六天\" class=\"headerlink\" title=\"第六天\"></a>第六天</h1><p><img src=\"http://image.stephenfang.me/yunnan/48c733ee259ed52252243a3979983a6c.jpeg\" alt=\"48c733ee259ed52252243a3979983a6c\"></p>\n<p>一大早在车笛声中醒来，就准备着和云南道别了。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/c2b58a28831d3b476798e23ba616bf0c.jpeg\" alt=\"c2b58a28831d3b476798e23ba616bf0c\"></p>\n<p>今天的安排只安排了一个目的地，就是云南省博物馆。<br>在省级博物馆中我已经打卡过了浙江省博、湖北省博、广东省博、上海市博，几乎每个博物馆都有和国家宝藏的梦幻联动，为参观的过程添加了许多趣味。云南省博物馆的外立面取意于云南传统民居“一颗印”，外形源自石林风化地貌特征。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/8af47fc3fb3fe1ef67dd6b8efd5742be.jpeg\" alt=\"8af47fc3fb3fe1ef67dd6b8efd5742be\"></p>\n<p>三层的展览一上午根本来不及看完，为了尽可能多的看到展品，只能走马观花式的有选择性的看了一圈。精美如这件贝器盖，远看有些像小时候玩的工兵，实则表现的是滇族与昆明族军队交战。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/f1eade5b620f110d31ad54902fb8e5d2.jpeg\" alt=\"f1eade5b620f110d31ad54902fb8e5d2\"></p>\n<p>这件与博物馆前巨型雕塑一致的金翅鸟自然来头不小，以下是摘录对它的描述。</p>\n<blockquote>\n<p>宋代大理国银鎏金镶珠金翅鸟，1978年出土于大理崇圣寺主塔。金翅鸟梵名为“迦楼罗”，被尊为大理的保护神，是佛教护法中的天龙八部之一。传说金翅鸟原来十分凶悍，以龙为食。后来金翅鸟皈依佛教，成为了佛教的护法神。这只金翅鸟头饰羽冠，两只利爪立于莲座之上。镂花火焰形背光插在尾身之间，镶饰有5粒水晶珠。体态雄健圆浑，生机勃勃，工艺可谓精美绝伦。</p>\n</blockquote>\n<p><img src=\"http://image.stephenfang.me/yunnan/1d0d2098ad7d1fb5b380aeb17dd1aa3c.jpeg\" alt=\"1d0d2098ad7d1fb5b380aeb17dd1aa3c\"></p>\n<p>价值连城的宝物还有不少，工艺精湛的如这件明代金镶红蓝宝石冠，值得驻足许久欣赏。</p>\n<p><img src=\"http://image.stephenfang.me/yunnan/37beddf0ed48d168e6423345197cf381.jpeg\" alt=\"37beddf0ed48d168e6423345197cf381\"></p>\n<p>结束了博物馆的游览整个云南之旅也就告一段落了，几年前转机经过昆明长水机场，心里想着以后还会来到这里，如今算是了却了这个念想，一点都不感到意外。以后还会不会来昆明不好说，但一定会再来到云南去更多的城市走走看看。</p>","popularPost_tmp_postPath":true,"eyeCatchImage":"http://image.stephenfang.me/yunnan/ff6659d985f90f0c02800c28ab472fda.jpeg","popularPost_tmp_gaData":{"updated":"Sun Jul 24 2022 23:18:00 GMT+0800 (中国标准时间)","title":"云南旅行流水账","path":"2022/02/20/Yunnan_Travelling/","eyeCatchImage":"http://image.stephenfang.me/yunnan/ff6659d985f90f0c02800c28ab472fda.jpeg","excerpt":"<p>去年国庆期间和朋友一起去了趟云南，起初安排的路线是 <strong>丽江 -&gt; 香格里拉 -&gt; 泸沽湖 -&gt; 昆明</strong>，在旅程中我们从时间和成本上考量，加上路人给予的一些建议，最终的路线是 <strong>丽江 -&gt; 大理 -&gt; 昆明</strong>。</p>\n<p>由于工作较忙一直没有时间整理旅行中的见闻，最近在整理博客的时候静下心来完善之前写的日记，花了一下午将六天的经历整理成一片流水账，发表在个人博客上图一乐。</p>","date":{"_isAMomentObject":true,"_i":"2022-02-20T08:00:00.000Z","_isUTC":false,"_pf":{"empty":false,"unusedTokens":[],"unusedInput":[],"overflow":-2,"charsLeftOver":0,"nullInput":false,"invalidEra":null,"invalidMonth":null,"invalidFormat":false,"userInvalidated":false,"iso":false,"parsedDateParts":[],"era":null,"meridiem":null,"rfc2822":false,"weekdayMismatch":false},"_locale":{"_calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"_longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"_invalidDate":"Invalid date","_dayOfMonthOrdinalParse":{},"_relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"_months":["January","February","March","April","May","June","July","August","September","October","November","December"],"_monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"_week":{"dow":0,"doy":6},"_weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"_weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"_weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"_meridiemParse":{},"_eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"_abbr":"en","_config":{"calendar":{"sameDay":"[Today at] LT","nextDay":"[Tomorrow at] LT","nextWeek":"dddd [at] LT","lastDay":"[Yesterday at] LT","lastWeek":"[Last] dddd [at] LT","sameElse":"L"},"longDateFormat":{"LTS":"h:mm:ss A","LT":"h:mm A","L":"MM/DD/YYYY","LL":"MMMM D, YYYY","LLL":"MMMM D, YYYY h:mm A","LLLL":"dddd, MMMM D, YYYY h:mm A"},"invalidDate":"Invalid date","dayOfMonthOrdinalParse":{},"relativeTime":{"future":"in %s","past":"%s ago","s":"a few seconds","ss":"%d seconds","m":"a minute","mm":"%d minutes","h":"an hour","hh":"%d hours","d":"a day","dd":"%d days","w":"a week","ww":"%d weeks","M":"a month","MM":"%d months","y":"a year","yy":"%d years"},"months":["January","February","March","April","May","June","July","August","September","October","November","December"],"monthsShort":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"week":{"dow":0,"doy":6},"weekdays":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],"weekdaysMin":["Su","Mo","Tu","We","Th","Fr","Sa"],"weekdaysShort":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"meridiemParse":{},"eras":[{"since":"0001-01-01","until":null,"offset":1,"name":"Anno Domini","narrow":"AD","abbr":"AD"},{"since":"0000-12-31","until":null,"offset":1,"name":"Before Christ","narrow":"BC","abbr":"BC"}],"abbr":"en"},"_dayOfMonthOrdinalParseLenient":{}},"_d":"2022-02-20T08:00:00.000Z","_isValid":true,"_z":null},"pv":0,"totalPV":0,"categories":"生活","tags":["旅行","云南","中国"],"internalLinks":[],"keywords":[],"keywordsLength":0},"length":6547}],"PostAsset":[],"PostCategory":[{"post_id":"cl6mfpp1c0001o76fa4dkgwde","category_id":"cl6mfpp1h0004o76fd0r34u05","_id":"cl6mfpp1p000go76f6ldgdlzk"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","category_id":"cl6mfpp1h0004o76fd0r34u05","_id":"cl6mfpp1r000ko76f51mz0zsd"},{"post_id":"cl6mfpp1o000eo76fguus7ny0","category_id":"cl6mfpp1h0004o76fd0r34u05","_id":"cl6mfpp1s000oo76fho277t7f"},{"post_id":"cl6mfpp1q000io76fapdcbkak","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1t000qo76fce1479g6"},{"post_id":"cl6mfpp1j0007o76fg1h70z6p","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1u000uo76faz298ray"},{"post_id":"cl6mfpp1q000jo76f5spw3w86","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1v000wo76fezu7cqcl"},{"post_id":"cl6mfpp1s000no76fhrax6tc4","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1w000zo76fdfjma9lt"},{"post_id":"cl6mfpp1l0009o76f1ydl7liw","category_id":"cl6mfpp1r000lo76f396f164u","_id":"cl6mfpp1w0012o76f9w8o8s2s"},{"post_id":"cl6mfpp1s000po76f51yp3zpd","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1x0014o76fef3cgc7j"},{"post_id":"cl6mfpp1u000to76fh1854xd1","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1y0017o76f83dp8lnw"},{"post_id":"cl6mfpp1m000ao76f6oofbwih","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1y0019o76f0vm80lrb"},{"post_id":"cl6mfpp1u000vo76fe6k72xdb","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp1z001co76ffbk154fz"},{"post_id":"cl6mfpp1v000yo76fgunc37fo","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp20001eo76fbt6394x0"},{"post_id":"cl6mfpp1o000do76f0eik87gd","category_id":"cl6mfpp1r000lo76f396f164u","_id":"cl6mfpp21001ho76fa2qkfcwj"},{"post_id":"cl6mfpp1w0011o76fguyu7bfw","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp23001ko76f972h0vbq"},{"post_id":"cl6mfpp1x0013o76fh3sg2jlf","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp24001oo76fcki45zgy"},{"post_id":"cl6mfpp1x0016o76ffhdz8ik8","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp24001ro76f3haxdb8g"},{"post_id":"cl6mfpp1y0018o76fgj402cuc","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp27001uo76fa6xn2x1k"},{"post_id":"cl6mfpp1z001bo76f8cft4r7t","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp29001yo76f82a0dthw"},{"post_id":"cl6mfpp1z001do76fgv9d1818","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2a0020o76fgcjkazb5"},{"post_id":"cl6mfpp21001go76fblrh339o","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2a0023o76f4zaf10xk"},{"post_id":"cl6mfpp22001jo76f4sjdhidf","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2b0025o76f4a6e8qz9"},{"post_id":"cl6mfpp23001no76fha5zdwqo","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2b0027o76fcwcgg938"},{"post_id":"cl6mfpp24001qo76f3zu4h4hh","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2b0028o76f0k7x9rli"},{"post_id":"cl6mfpp26001to76f73g9ey2m","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2b002ao76fcupc9yy6"},{"post_id":"cl6mfpp28001xo76fhk85gbau","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp2b002bo76fd92s396a"},{"post_id":"cl6mfpp34006do76feopr9z3r","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp37006jo76f7x3w7rdk"},{"post_id":"cl6mfpp35006eo76fb8v60tn2","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp38006mo76fgr613681"},{"post_id":"cl6mfpp36006go76fdh1rck2d","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp39006qo76fcf5k7s3j"},{"post_id":"cl6mfpp37006io76f9bmq3khy","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp39006to76f0vfh09ha"},{"post_id":"cl6mfpp37006lo76f0mcr0hvx","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp3a006vo76f1g1bh9ps"},{"post_id":"cl6mfpp38006po76fefec0ou4","category_id":"cl6mfpp1p000fo76fdl3d3jap","_id":"cl6mfpp3a006xo76f1m1xfzub"},{"post_id":"cl6mfpp39006so76f5lomfyhu","category_id":"cl6mfpp3a006wo76f072t7oaj","_id":"cl6mfpp3b0073o76fcrpk67hg"}],"PostTag":[{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1i0005o76f45t4b7uo","_id":"cl6mfpp22001io76ffnzm7nmb"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1m000co76fdfjle9kd","_id":"cl6mfpp23001lo76f94ayb7dx"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1p000ho76f5mz88988","_id":"cl6mfpp24001po76f8cwddsrw"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1r000mo76f7mb0h3f7","_id":"cl6mfpp26001so76f29qz4rq9"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1t000so76f1k9d27d7","_id":"cl6mfpp28001wo76f87w2cnkl"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1w0010o76f9ur11xpy","_id":"cl6mfpp29001zo76ffgpk5tv5"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1x0015o76f5884dszb","_id":"cl6mfpp2a0022o76f9jcleeb6"},{"post_id":"cl6mfpp1c0001o76fa4dkgwde","tag_id":"cl6mfpp1y001ao76f5wvadtiv","_id":"cl6mfpp2b0024o76f9ihuc30m"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","tag_id":"cl6mfpp1i0005o76f45t4b7uo","_id":"cl6mfpp2c002do76f0hhz9jg9"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","tag_id":"cl6mfpp23001mo76f45cnbksi","_id":"cl6mfpp2c002eo76ffurl6cuo"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","tag_id":"cl6mfpp27001vo76f3x2xdkcj","_id":"cl6mfpp2d002go76f1m766wm8"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","tag_id":"cl6mfpp2a0021o76f6giubgl6","_id":"cl6mfpp2d002ho76fbjnvadq9"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","tag_id":"cl6mfpp2b0026o76f13e34zsv","_id":"cl6mfpp2d002jo76f5fro415y"},{"post_id":"cl6mfpp1g0003o76f8hbn9xvu","tag_id":"cl6mfpp2b0029o76fc28e0kr8","_id":"cl6mfpp2d002ko76faq08cnvh"},{"post_id":"cl6mfpp1j0007o76fg1h70z6p","tag_id":"cl6mfpp2c002co76fg9ff2c5x","_id":"cl6mfpp2e002no76f5z8s55yv"},{"post_id":"cl6mfpp1j0007o76fg1h70z6p","tag_id":"cl6mfpp2c002fo76f06j38hi9","_id":"cl6mfpp2e002oo76fgosk1shm"},{"post_id":"cl6mfpp1j0007o76fg1h70z6p","tag_id":"cl6mfpp2d002io76f2xzlc7jn","_id":"cl6mfpp2e002qo76f5rsb6y6u"},{"post_id":"cl6mfpp1j0007o76fg1h70z6p","tag_id":"cl6mfpp2d002lo76f3cc48opc","_id":"cl6mfpp2e002ro76ffzfjhgwq"},{"post_id":"cl6mfpp1l0009o76f1ydl7liw","tag_id":"cl6mfpp2d002mo76f7ta2a2no","_id":"cl6mfpp2e002to76fecyo4ucy"},{"post_id":"cl6mfpp1l0009o76f1ydl7liw","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2e002uo76f26oiei9d"},{"post_id":"cl6mfpp1m000ao76f6oofbwih","tag_id":"cl6mfpp2e002so76f3eqoa6qa","_id":"cl6mfpp2f002xo76fhw8g3at1"},{"post_id":"cl6mfpp1m000ao76f6oofbwih","tag_id":"cl6mfpp2e002vo76f72e5c209","_id":"cl6mfpp2f002yo76f4spxgs2c"},{"post_id":"cl6mfpp1o000do76f0eik87gd","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2g0032o76feq5k61kx"},{"post_id":"cl6mfpp1o000do76f0eik87gd","tag_id":"cl6mfpp2f002zo76f3o426t6s","_id":"cl6mfpp2g0033o76f5es9e9vq"},{"post_id":"cl6mfpp1o000do76f0eik87gd","tag_id":"cl6mfpp2f0030o76f7aze9clq","_id":"cl6mfpp2g0035o76fekcl2dm6"},{"post_id":"cl6mfpp1o000eo76fguus7ny0","tag_id":"cl6mfpp1i0005o76f45t4b7uo","_id":"cl6mfpp2h0039o76f90ivedzp"},{"post_id":"cl6mfpp1o000eo76fguus7ny0","tag_id":"cl6mfpp2f0031o76f22lcbf9l","_id":"cl6mfpp2h003ao76fgjyxcdg4"},{"post_id":"cl6mfpp1o000eo76fguus7ny0","tag_id":"cl6mfpp2g0034o76ffw8ecmw5","_id":"cl6mfpp2h003co76fa3hddw6t"},{"post_id":"cl6mfpp1o000eo76fguus7ny0","tag_id":"cl6mfpp2g0036o76fb3530h14","_id":"cl6mfpp2h003do76fdxy62i00"},{"post_id":"cl6mfpp1o000eo76fguus7ny0","tag_id":"cl6mfpp2g0037o76f4mambvzx","_id":"cl6mfpp2h003fo76fcaecd0do"},{"post_id":"cl6mfpp1q000io76fapdcbkak","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2i003go76fe7y24umx"},{"post_id":"cl6mfpp1q000io76fapdcbkak","tag_id":"cl6mfpp2h003bo76fbjwadkmj","_id":"cl6mfpp2i003io76f1wyhda8v"},{"post_id":"cl6mfpp1q000jo76f5spw3w86","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2i003lo76f7m8x6r8j"},{"post_id":"cl6mfpp1q000jo76f5spw3w86","tag_id":"cl6mfpp2i003ho76fa7i1cgpr","_id":"cl6mfpp2i003mo76f73g36p6b"},{"post_id":"cl6mfpp1q000jo76f5spw3w86","tag_id":"cl6mfpp2i003jo76f3eur5kef","_id":"cl6mfpp2j003oo76f3t3m5uvx"},{"post_id":"cl6mfpp1s000no76fhrax6tc4","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2k003ro76f3uad7cee"},{"post_id":"cl6mfpp1s000no76fhrax6tc4","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2k003so76fc81ocgq7"},{"post_id":"cl6mfpp1s000no76fhrax6tc4","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2k003uo76f6hub1vba"},{"post_id":"cl6mfpp1s000po76f51yp3zpd","tag_id":"cl6mfpp2j003qo76f3sna3vl8","_id":"cl6mfpp2l003xo76f9e0chavs"},{"post_id":"cl6mfpp1s000po76f51yp3zpd","tag_id":"cl6mfpp2c002fo76f06j38hi9","_id":"cl6mfpp2l003yo76f9t0a730j"},{"post_id":"cl6mfpp1s000po76f51yp3zpd","tag_id":"cl6mfpp2d002io76f2xzlc7jn","_id":"cl6mfpp2l0040o76fdu8u5ipa"},{"post_id":"cl6mfpp1u000to76fh1854xd1","tag_id":"cl6mfpp2k003wo76f39d9gkkm","_id":"cl6mfpp2l0042o76fhrt74842"},{"post_id":"cl6mfpp1u000to76fh1854xd1","tag_id":"cl6mfpp2l003zo76fer6409yb","_id":"cl6mfpp2l0043o76fbi3p4qu2"},{"post_id":"cl6mfpp1u000vo76fe6k72xdb","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2m0047o76f3wdagr9e"},{"post_id":"cl6mfpp1u000vo76fe6k72xdb","tag_id":"cl6mfpp2l0044o76fhvq06kpv","_id":"cl6mfpp2m0048o76f6z334mdx"},{"post_id":"cl6mfpp1u000vo76fe6k72xdb","tag_id":"cl6mfpp2i003jo76f3eur5kef","_id":"cl6mfpp2n004ao76fe51ccnt8"},{"post_id":"cl6mfpp1v000yo76fgunc37fo","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2o004do76f6his5v25"},{"post_id":"cl6mfpp1v000yo76fgunc37fo","tag_id":"cl6mfpp2i003jo76f3eur5kef","_id":"cl6mfpp2o004eo76f9lhreivd"},{"post_id":"cl6mfpp1v000yo76fgunc37fo","tag_id":"cl6mfpp2n004bo76fad331jzh","_id":"cl6mfpp2o004go76f2jveex4r"},{"post_id":"cl6mfpp1w0011o76fguyu7bfw","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2p004jo76fccjbbkdm"},{"post_id":"cl6mfpp1w0011o76fguyu7bfw","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2p004ko76fciip1dz6"},{"post_id":"cl6mfpp1w0011o76fguyu7bfw","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2p004mo76fba4zbfz7"},{"post_id":"cl6mfpp1x0013o76fh3sg2jlf","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2q004po76f6xk75rr5"},{"post_id":"cl6mfpp1x0013o76fh3sg2jlf","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2q004qo76f7yqc4jrx"},{"post_id":"cl6mfpp1x0013o76fh3sg2jlf","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2q004so76fdatr95wl"},{"post_id":"cl6mfpp1x0016o76ffhdz8ik8","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2r004vo76f6yscalf8"},{"post_id":"cl6mfpp1x0016o76ffhdz8ik8","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2r004wo76f5vh65a9o"},{"post_id":"cl6mfpp1x0016o76ffhdz8ik8","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2r004yo76fd1zu71a6"},{"post_id":"cl6mfpp1y0018o76fgj402cuc","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2r0051o76fdtytfpn9"},{"post_id":"cl6mfpp1y0018o76fgj402cuc","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2s0052o76f420d98fl"},{"post_id":"cl6mfpp1y0018o76fgj402cuc","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2s0054o76fa8dqa8qb"},{"post_id":"cl6mfpp1z001bo76f8cft4r7t","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2s0057o76fgzrt4a3v"},{"post_id":"cl6mfpp1z001bo76f8cft4r7t","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2s0058o76fc7h1b7tt"},{"post_id":"cl6mfpp1z001bo76f8cft4r7t","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2s005ao76fhqere8gm"},{"post_id":"cl6mfpp1z001do76fgv9d1818","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2t005do76f3n4h0xkl"},{"post_id":"cl6mfpp1z001do76fgv9d1818","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2t005eo76f8wrlggqq"},{"post_id":"cl6mfpp1z001do76fgv9d1818","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2t005go76fhg4fgilv"},{"post_id":"cl6mfpp21001go76fblrh339o","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2u005jo76fdbjkeeko"},{"post_id":"cl6mfpp21001go76fblrh339o","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2u005ko76ffaht77h7"},{"post_id":"cl6mfpp21001go76fblrh339o","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2u005mo76f6p8pc85l"},{"post_id":"cl6mfpp22001jo76f4sjdhidf","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp2v005qo76f38gjf7ba"},{"post_id":"cl6mfpp22001jo76f4sjdhidf","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2v005ro76f3mg1b64d"},{"post_id":"cl6mfpp22001jo76f4sjdhidf","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp2v005to76faqmy159m"},{"post_id":"cl6mfpp22001jo76f4sjdhidf","tag_id":"cl6mfpp2u005oo76f0rz796b5","_id":"cl6mfpp2v005uo76f3ug0b1x8"},{"post_id":"cl6mfpp23001no76fha5zdwqo","tag_id":"cl6mfpp2i003ho76fa7i1cgpr","_id":"cl6mfpp2w005wo76fg5gtdwc1"},{"post_id":"cl6mfpp23001no76fha5zdwqo","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2w005xo76f94xt87og"},{"post_id":"cl6mfpp24001qo76f3zu4h4hh","tag_id":"cl6mfpp2i003ho76fa7i1cgpr","_id":"cl6mfpp2x0061o76fevge0ne7"},{"post_id":"cl6mfpp24001qo76f3zu4h4hh","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2x0062o76ff9284vdt"},{"post_id":"cl6mfpp24001qo76f3zu4h4hh","tag_id":"cl6mfpp2w005zo76f1kf74uwm","_id":"cl6mfpp2x0064o76fdw6nfrfi"},{"post_id":"cl6mfpp26001to76f73g9ey2m","tag_id":"cl6mfpp2i003ho76fa7i1cgpr","_id":"cl6mfpp2x0067o76f69c89rxb"},{"post_id":"cl6mfpp26001to76f73g9ey2m","tag_id":"cl6mfpp2e002po76f10as9gou","_id":"cl6mfpp2x0068o76f2x31bv2x"},{"post_id":"cl6mfpp26001to76f73g9ey2m","tag_id":"cl6mfpp2d002mo76f7ta2a2no","_id":"cl6mfpp2y006ao76f2x6b4kh0"},{"post_id":"cl6mfpp28001xo76fhk85gbau","tag_id":"cl6mfpp2k003wo76f39d9gkkm","_id":"cl6mfpp2y006bo76f096zced1"},{"post_id":"cl6mfpp28001xo76fhk85gbau","tag_id":"cl6mfpp2l003zo76fer6409yb","_id":"cl6mfpp2y006co76ffa8x4is3"},{"post_id":"cl6mfpp35006eo76fb8v60tn2","tag_id":"cl6mfpp2c002co76fg9ff2c5x","_id":"cl6mfpp37006ho76f18207uli"},{"post_id":"cl6mfpp35006eo76fb8v60tn2","tag_id":"cl6mfpp2c002fo76f06j38hi9","_id":"cl6mfpp37006ko76fbivo7qbz"},{"post_id":"cl6mfpp35006eo76fb8v60tn2","tag_id":"cl6mfpp2d002io76f2xzlc7jn","_id":"cl6mfpp38006oo76f84rzcuac"},{"post_id":"cl6mfpp35006eo76fb8v60tn2","tag_id":"cl6mfpp2d002lo76f3cc48opc","_id":"cl6mfpp39006ro76fel5ld7ay"},{"post_id":"cl6mfpp34006do76feopr9z3r","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp3a006zo76f6d3rhdq4"},{"post_id":"cl6mfpp34006do76feopr9z3r","tag_id":"cl6mfpp36006fo76f3aj9ducd","_id":"cl6mfpp3a0070o76f7fm1fd54"},{"post_id":"cl6mfpp34006do76feopr9z3r","tag_id":"cl6mfpp2i003no76f222n7fny","_id":"cl6mfpp3b0072o76f8u1g57xx"},{"post_id":"cl6mfpp34006do76feopr9z3r","tag_id":"cl6mfpp2i003jo76f3eur5kef","_id":"cl6mfpp3b0074o76fgzu1gwr7"},{"post_id":"cl6mfpp34006do76feopr9z3r","tag_id":"cl6mfpp38006no76fc1ltbsm8","_id":"cl6mfpp3b0076o76fg52b8nhv"},{"post_id":"cl6mfpp34006do76feopr9z3r","tag_id":"cl6mfpp3a006uo76fbbsq3zw0","_id":"cl6mfpp3b0077o76f5ur67cqq"},{"post_id":"cl6mfpp36006go76fdh1rck2d","tag_id":"cl6mfpp2c002co76fg9ff2c5x","_id":"cl6mfpp3b0079o76fcdbp27o1"},{"post_id":"cl6mfpp36006go76fdh1rck2d","tag_id":"cl6mfpp3a006yo76f5wvn2z1j","_id":"cl6mfpp3b007ao76f2wq4dryw"},{"post_id":"cl6mfpp36006go76fdh1rck2d","tag_id":"cl6mfpp2c002fo76f06j38hi9","_id":"cl6mfpp3c007bo76fcahwhuwk"},{"post_id":"cl6mfpp36006go76fdh1rck2d","tag_id":"cl6mfpp2d002io76f2xzlc7jn","_id":"cl6mfpp3c007do76f3ri3dq6z"},{"post_id":"cl6mfpp37006io76f9bmq3khy","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp3c007eo76f5ps9h0sp"},{"post_id":"cl6mfpp37006io76f9bmq3khy","tag_id":"cl6mfpp3a0071o76fcmph5zui","_id":"cl6mfpp3c007go76f9easa4it"},{"post_id":"cl6mfpp37006io76f9bmq3khy","tag_id":"cl6mfpp2i003jo76f3eur5kef","_id":"cl6mfpp3c007ho76fadaidrsz"},{"post_id":"cl6mfpp37006lo76f0mcr0hvx","tag_id":"cl6mfpp3b0075o76f3ni4g5yj","_id":"cl6mfpp3d007jo76fd1sfg6jc"},{"post_id":"cl6mfpp37006lo76f0mcr0hvx","tag_id":"cl6mfpp3b0078o76f2m9v25vd","_id":"cl6mfpp3d007ko76f8z34b37k"},{"post_id":"cl6mfpp37006lo76f0mcr0hvx","tag_id":"cl6mfpp3c007co76f9qmc8bmc","_id":"cl6mfpp3d007mo76ffqc6ch7e"},{"post_id":"cl6mfpp38006po76fefec0ou4","tag_id":"cl6mfpp2f002wo76f4fkecuc9","_id":"cl6mfpp3d007no76fexf3c2lh"},{"post_id":"cl6mfpp38006po76fefec0ou4","tag_id":"cl6mfpp2i003jo76f3eur5kef","_id":"cl6mfpp3d007oo76ffll47mpl"},{"post_id":"cl6mfpp38006po76fefec0ou4","tag_id":"cl6mfpp3c007fo76f3lq13sjs","_id":"cl6mfpp3d007qo76f7pnm5ap4"},{"post_id":"cl6mfpp39006so76f5lomfyhu","tag_id":"cl6mfpp3c007io76f6wn8elkc","_id":"cl6mfpp3d007ro76fefy2dgy1"},{"post_id":"cl6mfpp39006so76f5lomfyhu","tag_id":"cl6mfpp3d007lo76f1genb2r9","_id":"cl6mfpp3d007so76f1itv1vus"},{"post_id":"cl6mfpp39006so76f5lomfyhu","tag_id":"cl6mfpp3d007po76f061t4mf3","_id":"cl6mfpp3e007to76f0qqodulj"}],"Tag":[{"name":"读书","_id":"cl6mfpp1i0005o76f45t4b7uo"},{"name":"长安的荔枝","_id":"cl6mfpp1m000co76fdfjle9kd"},{"name":"马伯庸","_id":"cl6mfpp1p000ho76f5mz88988"},{"name":"失落的卫星","_id":"cl6mfpp1r000mo76f7mb0h3f7"},{"name":"午夜降临前抵达","_id":"cl6mfpp1t000so76f1k9d27d7"},{"name":"刘子超","_id":"cl6mfpp1w0010o76f9ur11xpy"},{"name":"工作、消费主义和新穷人","_id":"cl6mfpp1x0015o76f5884dszb"},{"name":"克拉拉与太阳","_id":"cl6mfpp1y001ao76f5wvadtiv"},{"name":"乔纳森传","_id":"cl6mfpp23001mo76f45cnbksi"},{"name":"平成十二年","_id":"cl6mfpp27001vo76f3x2xdkcj"},{"name":"UNIX传奇","_id":"cl6mfpp2a0021o76f6giubgl6"},{"name":"西南联大","_id":"cl6mfpp2b0026o76f13e34zsv"},{"name":"重走","_id":"cl6mfpp2b0029o76fc28e0kr8"},{"name":"struts","_id":"cl6mfpp2c002co76fg9ff2c5x"},{"name":"JavaEE","_id":"cl6mfpp2c002fo76f06j38hi9"},{"name":"总结","_id":"cl6mfpp2d002io76f2xzlc7jn"},{"name":"实验","_id":"cl6mfpp2d002lo76f3cc48opc"},{"name":"Apple","_id":"cl6mfpp2d002mo76f7ta2a2no"},{"name":"Xcode","_id":"cl6mfpp2e002po76f10as9gou"},{"name":"Vue.js","_id":"cl6mfpp2e002so76f3eqoa6qa"},{"name":"前端框架","_id":"cl6mfpp2e002vo76f72e5c209"},{"name":"iOS","_id":"cl6mfpp2f002wo76f4fkecuc9"},{"name":"UI","_id":"cl6mfpp2f002zo76f3o426t6s"},{"name":"UX","_id":"cl6mfpp2f0030o76f7aze9clq"},{"name":"考试脑科学","_id":"cl6mfpp2f0031o76f22lcbf9l"},{"name":"苦才是人生","_id":"cl6mfpp2g0034o76ffw8ecmw5"},{"name":"成为乔布斯","_id":"cl6mfpp2g0036o76fb3530h14"},{"name":"失去的三十年","_id":"cl6mfpp2g0037o76f4mambvzx"},{"name":"数字生活","_id":"cl6mfpp2h003bo76fbjwadkmj"},{"name":"OpenCV","_id":"cl6mfpp2i003ho76fa7i1cgpr"},{"name":"Swift","_id":"cl6mfpp2i003jo76f3eur5kef"},{"name":"Objective-C","_id":"cl6mfpp2i003no76f222n7fny"},{"name":"Hibernate","_id":"cl6mfpp2j003qo76f3sna3vl8"},{"name":"设计模式","_id":"cl6mfpp2k003wo76f39d9gkkm"},{"name":"Java","_id":"cl6mfpp2l003zo76fer6409yb"},{"name":"AudioPlayer","_id":"cl6mfpp2l0044o76fhvq06kpv"},{"name":"音乐App","_id":"cl6mfpp2n004bo76fad331jzh"},{"name":"ARC","_id":"cl6mfpp2u005oo76f0rz796b5"},{"name":"Grayscale","_id":"cl6mfpp2w005zo76f1kf74uwm"},{"name":"Photo","_id":"cl6mfpp36006fo76f3aj9ducd"},{"name":"iOS 15","_id":"cl6mfpp38006no76fc1ltbsm8"},{"name":"iOS 14","_id":"cl6mfpp3a006uo76fbbsq3zw0"},{"name":"workflow","_id":"cl6mfpp3a006yo76f5wvn2z1j"},{"name":"SwiftUI","_id":"cl6mfpp3a0071o76fcmph5zui"},{"name":"数据挖掘","_id":"cl6mfpp3b0075o76f3ni4g5yj"},{"name":"关联算法","_id":"cl6mfpp3b0078o76f2m9v25vd"},{"name":"WEKA","_id":"cl6mfpp3c007co76f9qmc8bmc"},{"name":"WWDC","_id":"cl6mfpp3c007fo76f3lq13sjs"},{"name":"旅行","_id":"cl6mfpp3c007io76f6wn8elkc"},{"name":"云南","_id":"cl6mfpp3d007lo76f1genb2r9"},{"name":"中国","_id":"cl6mfpp3d007po76f061t4mf3"}]}}